# üó∫Ô∏è –†–µ–∞–ª–∏–∑–∞—Ü–∏—è —Å–∏—Å—Ç–µ–º—ã Map Points –¥–ª—è Grenzwanderer

## ‚úÖ –ß—Ç–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞–Ω–æ

### 1. **–†–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è —Å—Ö–µ–º–∞ –¥–∞–Ω–Ω—ã—Ö (Convex)**

#### –ù–æ–≤—ã–µ —Ç–∏–ø—ã —Ç–æ—á–µ–∫:
- `poi` - Point of Interest
- `quest` - –ö–≤–µ—Å—Ç–æ–≤—ã–µ —Ç–æ—á–∫–∏
- `npc` - NPC –ø–µ—Ä—Å–æ–Ω–∞–∂–∏
- `location` - –õ–æ–∫–∞—Ü–∏–∏
- `board` - –î–æ—Å–∫–∏ –æ–±—ä—è–≤–ª–µ–Ω–∏–π ‚≠ê –ù–û–í–û–ï
- `settlement` - –ü–æ—Å–µ–ª–µ–Ω–∏—è ‚≠ê –ù–û–í–û–ï
- `anomaly` - –ê–Ω–æ–º–∞–ª—å–Ω—ã–µ –∑–æ–Ω—ã ‚≠ê –ù–û–í–û–ï

#### –§–∞–π–ª—ã:
- `client/convex/schema.ts` - –û–±–Ω–æ–≤–ª–µ–Ω–∞ —Å—Ö–µ–º–∞ map_points
- `client/convex/mapPointsSeed.ts` - –°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ 12+ —Ç–æ—á–µ–∫ –∫–∞—Ä—Ç—ã

### 2. **TypeScript —Ç–∏–ø—ã (Client-side)**

#### –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã:
```typescript
// client/src/entities/map-point/model/types.ts
- MapPointType (7 —Ç–∏–ø–æ–≤)
- MapPointCategory (10 –∫–∞—Ç–µ–≥–æ—Ä–∏–π)
- FactionType (5 —Ñ—Ä–∞–∫—Ü–∏–π)
- ServiceType (22 —Ç–∏–ø–∞ —É—Å–ª—É–≥)
- MapPointMetadata (–¥–µ—Ç–∞–ª—å–Ω—ã–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ)
```

#### –ö–∞—Ç–µ–≥–æ—Ä–∏–∏ —Ç–æ—á–µ–∫:
- **–¢–æ—Ä–≥–æ–≤—ã–µ**: storage, workshop
- **–ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ**: medical
- **–í–æ–µ–Ω–Ω—ã–µ**: bulletin_board, briefing_point
- **–†–µ–ª–∏–≥–∏–æ–∑–Ω—ã–µ**: religious
- **–ê–Ω–∞—Ä—Ö–∏—Å—Ç—Å–∫–∏–µ**: anarchist_zone, hideout
- **–°–æ—Ü–∏–∞–ª—å–Ω—ã–µ**: bar
- **–û–ø–∞—Å–Ω—ã–µ**: anomaly

### 3. **UI –ö–æ–º–ø–æ–Ω–µ–Ω—Ç—ã**

#### MapPointMarker (–æ–±–Ω–æ–≤–ª–µ–Ω)
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ 7 —Ç–∏–ø–æ–≤ –º–∞—Ä–∫–µ—Ä–æ–≤
- –¶–≤–µ—Ç–æ–≤–∞—è –∫–æ–¥–∏—Ä–æ–≤–∫–∞ –ø–æ —É—Ä–æ–≤–Ω—é –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- –ü—É–ª—å—Å–∏—Ä—É—é—â–∏–µ —ç—Ñ—Ñ–µ–∫—Ç—ã –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω
- –ò–Ω–¥–∏–∫–∞—Ç–æ—Ä—ã —Å—Ç–∞—Ç—É—Å–∞ (not_found, discovered, researched)

#### MapPointDetails (–Ω–æ–≤—ã–π)
- –î–µ—Ç–∞–ª—å–Ω—ã–π –ø—Ä–æ—Å–º–æ—Ç—Ä —Ç–æ—á–∫–∏
- –û—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –º–µ—Ç–∞–¥–∞–Ω–Ω—ã—Ö (–∞—Ç–º–æ—Å—Ñ–µ—Ä–∞, —Ñ—Ä–∞–∫—Ü–∏—è, NPC)
- –°–ø–∏—Å–æ–∫ –¥–æ—Å—Ç—É–ø–Ω—ã—Ö —É—Å–ª—É–≥
- –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç—è—Ö –∏ –Ω–∞–≥—Ä–∞–¥–∞—Ö
- –¢—Ä–µ–±–æ–≤–∞–Ω–∏—è –¥–æ—Å—Ç—É–ø–∞ –∏ —Ä–µ–ø—É—Ç–∞—Ü–∏—è
- –ö–Ω–æ–ø–∫–∏ –¥–µ–π—Å—Ç–≤–∏–π (–∏—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å, –ø–æ–≥–æ–≤–æ—Ä–∏—Ç—å, —Ç–æ—Ä–≥–æ–≤–∞—Ç—å)

### 4. **Hooks –∏ –ª–æ–≥–∏–∫–∞ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–∏—è**

#### useMapPointInteraction
```typescript
// client/src/entities/map-point/lib/useMapPointInteraction.ts
- researchPoint() - –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏
- checkAccessibility() - –ü—Ä–æ–≤–µ—Ä–∫–∞ –¥–æ—Å—Ç—É–ø–Ω–æ—Å—Ç–∏
- getAvailableActions() - –î–æ—Å—Ç—É–ø–Ω—ã–µ –¥–µ–π—Å—Ç–≤–∏—è
- getDangerInfo() - –ò–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è –æ–± –æ–ø–∞—Å–Ω–æ—Å—Ç–∏
- checkEquipment() - –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–Ω–∞—Ä—è–∂–µ–Ω–∏—è
```

### 5. **–î–∞–Ω–Ω—ã–µ —Ç–æ—á–µ–∫ –∫–∞—Ä—Ç—ã**

#### üèïÔ∏è –í—Ä–µ–º–µ–Ω–Ω—ã–π –ª–∞–≥–µ—Ä—å
- **synthesis_camp_storage** - –°–∫–ª–∞–¥ "–°–∏–Ω—Ç–µ–∑–∞"

#### üîß –ú–∞—Å—Ç–µ—Ä—Å–∫–∏–µ (2 —Ç–æ—á–∫–∏)
- **workshop_center** - –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –î–∏—Ç–µ—Ä–∞ (—Ü–µ–Ω—Ç—Ä–∞–ª—å–Ω–∞—è)
- **carl_private_workshop** - –ú–∞—Å—Ç–µ—Ä—Å–∫–∞—è –ö–∞—Ä–ª–∞ "–®–µ—Å—Ç–µ—Ä—ë–Ω–∫–∏"

#### üè• –ú–µ–¥–∏—Ü–∏–Ω–∞ (1 —Ç–æ—á–∫–∞)
- **synthesis_medical_center** - –ú–µ–¥–ø—É–Ω–∫—Ç "–°–∏–Ω—Ç–µ–∑–∞"

#### ‚öîÔ∏è –í–æ–µ–Ω–Ω—ã–µ FJR (2 —Ç–æ—á–∫–∏)
- **fjr_board** - –î–æ—Å–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
- **fjr_briefing_point** - –ë—Ä–∏—Ñ–∏–Ω–≥ FJR

#### üèõÔ∏è –†–µ–ª–∏–≥–∏—è (1 —Ç–æ—á–∫–∞)
- **old_believers_square** - –û—Ç–µ—Ü –ò–æ–∞–Ω–Ω

#### üè¥‚Äç‚ò†Ô∏è –ê–Ω–∞—Ä—Ö–∏—Å—Ç—ã (2 —Ç–æ—á–∫–∏)
- **anarchist_hole** - ¬´–î—ã—Ä–∞¬ª (—Å–≤–æ–±–æ–¥–Ω–∞—è –∑–æ–Ω–∞)
- **anarchist_arena_basement** - –ü–æ–¥–≤–∞–ª –ê—Ä–µ–Ω—ã (–ó–∞–∫–ª—ë–ø–∫–∞)

#### üé≠ –†–∞–∑–≤–ª–µ—á–µ–Ω–∏—è (1 —Ç–æ—á–∫–∞)
- **quiet_cove_bar** - –ë–∞—Ä "–¢–∏—Ö–∞—è –ó–∞–≤–æ–¥—å" (–õ—é–¥–∞)

#### ‚öóÔ∏è –ê–Ω–æ–º–∞–ª–∏–∏ (1 —Ç–æ—á–∫–∞)
- **northern_anomaly** - –°–µ–≤–µ—Ä–Ω–∞—è –∞–Ω–æ–º–∞–ª—å–Ω–∞—è –∑–æ–Ω–∞

**–ò–¢–û–ì–û: 12 —Ç–æ—á–µ–∫ –∫–∞—Ä—Ç—ã**

## üéØ –°–≤—è–∑–∏ —Å –∏–≥—Ä–æ–≤—ã–º–∏ —Å–∏—Å—Ç–µ–º–∞–º–∏

### –°–≤—è–∑—å —Å NPC
```typescript
metadata: {
  npcId: 'dieter_craftsman',
  characterName: '–î–∏—Ç–µ—Ä "–ú–æ–ª–æ—Ç"',
  dialogues: ['craftsman_meeting_dialog'],
  relationship: {
    initialLevel: 0,
    maxLevel: 100
  }
}
```

### –°–≤—è–∑—å —Å –∫–≤–µ—Å—Ç–∞–º–∏
```typescript
metadata: {
  questBindings: ['craftsman_quest_chain'],
  dialogues: ['field_medicine_quest']
}
```

### –°–≤—è–∑—å —Å —Ñ—Ä–∞–∫—Ü–∏—è–º–∏
```typescript
metadata: {
  faction: 'synthesis' | 'fjr' | 'old_believers' | 'anarchists',
  requiresFaction: 'fjr',
  minReputation: 20
}
```

### –°–µ—Ä–≤–∏—Å—ã –∏ —Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω–æ—Å—Ç—å
```typescript
metadata: {
  services: ['repair', 'crafting', 'upgrade'],
  tradeOptions: {
    blackMarket: true,
    stolenGoods: true
  }
}
```

## üì¶ –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ

### 1. –°–∏–¥–∏—Ä–æ–≤–∞–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö
```bash
# –°–æ–∑–¥–∞—Ç—å —Ç–æ—á–∫–∏ –≤ –±–∞–∑–µ
npx convex run mapPointsSeed:seedMapPoints

# –û—á–∏—Å—Ç–∏—Ç—å —Ç–æ—á–∫–∏
npx convex run mapPointsSeed:clearMapPoints

# –ü–µ—Ä–µ—Å–æ–∑–¥–∞—Ç—å
npx convex run mapPointsSeed:reseedMapPoints
```

### 2. –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ—á–µ–∫
```typescript
import { useQuery } from 'convex/react'
import { api } from '@/convex/_generated/api'

const points = useQuery(api.mapPoints.listVisible, {
  deviceId: 'your-device-id',
  phase: 1,
  bbox: { minLat, maxLat, minLng, maxLng }
})
```

### 3. –ò—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∏–µ —Ç–æ—á–∫–∏
```typescript
import { useMapPointInteraction } from '@/entities/map-point/lib/useMapPointInteraction'

const { researchPoint } = useMapPointInteraction()

await researchPoint(point)
```

### 4. –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤
```tsx
import { MapPointMarker } from '@/entities/map-point/ui/MapPointMarker'
import { MapPointDetails } from '@/entities/map-point/ui/MapPointDetails'

<MapPointMarker
  type={point.type}
  status={point.status}
  dangerLevel={point.metadata?.danger_level}
  onClick={() => selectPoint(point)}
/>

<MapPointDetails
  point={selectedPoint}
  distance={calculateDistance(userLocation, point.coordinates)}
  onClose={() => setSelectedPoint(null)}
  onInteract={handleInteract}
/>
```

## üîÑ –°—Ç–∞—Ç—É—Å—ã —Ç–æ—á–µ–∫

1. **not_found** - –¢–æ—á–∫–∞ –µ—â–µ –Ω–µ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞
   - –ù–µ –æ—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ
   - –¢—Ä–µ–±—É–µ—Ç proximity detection –∏–ª–∏ path tracking

2. **discovered** - –¢–æ—á–∫–∞ –æ–±–Ω–∞—Ä—É–∂–µ–Ω–∞
   - –û—Ç–æ–±—Ä–∞–∂–∞–µ—Ç—Å—è –Ω–∞ –∫–∞—Ä—Ç–µ
   - –ú–æ–∂–Ω–æ –ø—Ä–æ—Å–º–æ—Ç—Ä–µ—Ç—å –±–∞–∑–æ–≤—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é
   - –î–æ—Å—Ç—É–ø–Ω–∞ –∫–Ω–æ–ø–∫–∞ "–ò—Å—Å–ª–µ–¥–æ–≤–∞—Ç—å"

3. **researched** - –¢–æ—á–∫–∞ –∏—Å—Å–ª–µ–¥–æ–≤–∞–Ω–∞
   - –ü–æ–ª–Ω—ã–π –¥–æ—Å—Ç—É–ø –∫–æ –≤—Å–µ–º —Ñ—É–Ω–∫—Ü–∏—è–º
   - –ú–æ–∂–Ω–æ –≤–∑–∞–∏–º–æ–¥–µ–π—Å—Ç–≤–æ–≤–∞—Ç—å —Å NPC
   - –î–æ—Å—Ç—É–ø–Ω—ã –∫–≤–µ—Å—Ç—ã –∏ —Ç–æ—Ä–≥–æ–≤–ª—è

## üé® –í–∏–∑—É–∞–ª—å–Ω—ã–µ –æ—Å–æ–±–µ–Ω–Ω–æ—Å—Ç–∏

### –¶–≤–µ—Ç–æ–≤–∞—è —Å—Ö–µ–º–∞ –º–∞—Ä–∫–µ—Ä–æ–≤:
- **–û–±—ã—á–Ω—ã–µ**: —Å–µ—Ä—ã–π (not_found), —Å–∏–Ω–∏–π (discovered), –∑–µ–ª–µ–Ω—ã–π (researched)
- **–û–ø–∞—Å–Ω—ã–µ –∑–æ–Ω—ã**:
  - –ñ–µ–ª—Ç—ã–π (low danger)
  - –û—Ä–∞–Ω–∂–µ–≤—ã–π (medium danger)
  - –ö—Ä–∞—Å–Ω—ã–π (high danger)
  - –§–∏–æ–ª–µ—Ç–æ–≤—ã–π (extreme danger)

### –ê–Ω–∏–º–∞—Ü–∏–∏:
- –ü—É–ª—å—Å–∞—Ü–∏—è –ø—Ä–∏ –≤—ã–±–æ—Ä–µ —Ç–æ—á–∫–∏
- –ü—É–ª—å—Å–∞—Ü–∏—è –¥–ª—è –æ–ø–∞—Å–Ω—ã—Ö –∑–æ–Ω (high/extreme)
- Hover —ç—Ñ—Ñ–µ–∫—Ç—ã

## üìã –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏

### –¢—Ä–µ–±—É–µ—Ç—Å—è —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å:

1. **–ó–∞–ø—É—Å—Ç–∏—Ç—å seed –∫–æ–º–∞–Ω–¥—É**
   ```bash
   npx convex run mapPointsSeed:seedMapPoints
   ```

2. **–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å –∫–∞—Ä—Ç–æ–π**
   - –î–æ–±–∞–≤–∏—Ç—å MapPointDetails –≤ MapWidget
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å useMapPointInteraction
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∫–ª–∏–∫–∏ –ø–æ –º–∞—Ä–∫–µ—Ä–∞–º

3. **–°–≤—è–∑—å —Å –¥–∏–∞–ª–æ–≥–∞–º–∏**
   - –ü–æ–¥–∫–ª—é—á–∏—Ç—å metadata.dialogues –∫ –≤–∏–∑—É–∞–ª—å–Ω–æ–π –Ω–æ–≤–µ–ª–ª–µ
   - –°–æ–∑–¥–∞—Ç—å —Ç—Ä–∏–≥–≥–µ—Ä—ã –¥–ª—è –∑–∞–ø—É—Å–∫–∞ –¥–∏–∞–ª–æ–≥–æ–≤

4. **–°–≤—è–∑—å —Å –∫–≤–µ—Å—Ç–∞–º–∏**
   - –°–æ–∑–¥–∞—Ç—å –∑–∞–ø–∏—Å–∏ –≤ mappoint_bindings
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –∞–∫—Ç–∏–≤–∞—Ü–∏—é –∫–≤–µ—Å—Ç–æ–≤ –∏–∑ —Ç–æ—á–µ–∫

5. **–°–∏—Å—Ç–µ–º–∞ —Ñ—Ä–∞–∫—Ü–∏–π**
   - –†–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å –ø—Ä–æ–≤–µ—Ä–∫—É —Ä–µ–ø—É—Ç–∞—Ü–∏–∏
   - –î–æ–±–∞–≤–∏—Ç—å –±–æ–Ω—É—Å—ã –æ—Ç –æ—Ç–Ω–æ—à–µ–Ω–∏–π —Å NPC

## üêõ –ò–∑–≤–µ—Å—Ç–Ω—ã–µ –ø—Ä–æ–±–ª–µ–º—ã

- –¢—Ä–µ–±—É–µ—Ç—Å—è –ø—Ä–æ–≤–µ—Ä–∫–∞ –ª–∏–Ω—Ç–µ—Ä–∞ –¥–ª—è –Ω–æ–≤—ã—Ö —Ñ–∞–π–ª–æ–≤
- –ù—É–∂–Ω–æ –ø—Ä–æ—Ç–µ—Å—Ç–∏—Ä–æ–≤–∞—Ç—å –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ –Ω–∞ —Ä–µ–∞–ª—å–Ω–æ–π –∫–∞—Ä—Ç–µ
- –¢—Ä–µ–±—É–µ—Ç—Å—è —Å–æ–∑–¥–∞—Ç—å bindings –¥–ª—è –∫–≤–µ—Å—Ç–æ–≤

## üìö –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è

- `client/convex/README_SEED.md` - –ü–æ–¥—Ä–æ–±–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –ø–æ —Å–∏–¥–∏—Ä–æ–≤–∞–Ω–∏—é
- `client/MAP_POINTS_IMPLEMENTATION.md` - –≠—Ç–æ—Ç —Ñ–∞–π–ª
- `Plan.md` - –û–±—â–∏–π –ø–ª–∞–Ω –ø—Ä–æ–µ–∫—Ç–∞ (–æ–±–Ω–æ–≤–ª–µ–Ω)

---

**–°—Ç–∞—Ç—É—Å**: ‚úÖ –ë–∞–∑–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è –∑–∞–≤–µ—Ä—à–µ–Ω–∞, —Ç—Ä–µ–±—É–µ—Ç—Å—è –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è –∏ —Ç–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ


