(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const h of document.querySelectorAll('link[rel="modulepreload"]'))l(h);new MutationObserver(h=>{for(const m of h)if(m.type==="childList")for(const b of m.addedNodes)b.tagName==="LINK"&&b.rel==="modulepreload"&&l(b)}).observe(document,{childList:!0,subtree:!0});function o(h){const m={};return h.integrity&&(m.integrity=h.integrity),h.referrerPolicy&&(m.referrerPolicy=h.referrerPolicy),h.crossOrigin==="use-credentials"?m.credentials="include":h.crossOrigin==="anonymous"?m.credentials="omit":m.credentials="same-origin",m}function l(h){if(h.ep)return;h.ep=!0;const m=o(h);fetch(h.href,m)}})();function Lw(r){return r&&r.__esModule&&Object.prototype.hasOwnProperty.call(r,"default")?r.default:r}var Jx={exports:{}},Z0={};/**
 * @license React
 * react-jsx-runtime.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var yA;function OO(){if(yA)return Z0;yA=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.fragment");function o(l,h,m){var b=null;if(m!==void 0&&(b=""+m),h.key!==void 0&&(b=""+h.key),"key"in h){m={};for(var n in h)n!=="key"&&(m[n]=h[n])}else m=h;return h=m.ref,{$$typeof:r,type:l,key:b,ref:h!==void 0?h:null,props:m}}return Z0.Fragment=e,Z0.jsx=o,Z0.jsxs=o,Z0}var vA;function PO(){return vA||(vA=1,Jx.exports=OO()),Jx.exports}var rt=PO(),eb={exports:{}},Ki={};/**
 * @license React
 * react.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var xA;function LO(){if(xA)return Ki;xA=1;var r=Symbol.for("react.transitional.element"),e=Symbol.for("react.portal"),o=Symbol.for("react.fragment"),l=Symbol.for("react.strict_mode"),h=Symbol.for("react.profiler"),m=Symbol.for("react.consumer"),b=Symbol.for("react.context"),n=Symbol.for("react.forward_ref"),C=Symbol.for("react.suspense"),D=Symbol.for("react.memo"),L=Symbol.for("react.lazy"),U=Symbol.iterator;function q(it){return it===null||typeof it!="object"?null:(it=U&&it[U]||it["@@iterator"],typeof it=="function"?it:null)}var Z={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},ie=Object.assign,ne={};function be(it,Vt,Er){this.props=it,this.context=Vt,this.refs=ne,this.updater=Er||Z}be.prototype.isReactComponent={},be.prototype.setState=function(it,Vt){if(typeof it!="object"&&typeof it!="function"&&it!=null)throw Error("takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,it,Vt,"setState")},be.prototype.forceUpdate=function(it){this.updater.enqueueForceUpdate(this,it,"forceUpdate")};function ve(){}ve.prototype=be.prototype;function we(it,Vt,Er){this.props=it,this.context=Vt,this.refs=ne,this.updater=Er||Z}var Pe=we.prototype=new ve;Pe.constructor=we,ie(Pe,be.prototype),Pe.isPureReactComponent=!0;var Ze=Array.isArray,$e={H:null,A:null,T:null,S:null,V:null},xt=Object.prototype.hasOwnProperty;function Ct(it,Vt,Er,Rr,oi,Gi){return Er=Gi.ref,{$$typeof:r,type:it,key:Vt,ref:Er!==void 0?Er:null,props:Gi}}function Ft(it,Vt){return Ct(it.type,Vt,void 0,void 0,void 0,it.props)}function Yt(it){return typeof it=="object"&&it!==null&&it.$$typeof===r}function hr(it){var Vt={"=":"=0",":":"=2"};return"$"+it.replace(/[=:]/g,function(Er){return Vt[Er]})}var pr=/\/+/g;function Kr(it,Vt){return typeof it=="object"&&it!==null&&it.key!=null?hr(""+it.key):Vt.toString(36)}function ui(){}function zi(it){switch(it.status){case"fulfilled":return it.value;case"rejected":throw it.reason;default:switch(typeof it.status=="string"?it.then(ui,ui):(it.status="pending",it.then(function(Vt){it.status==="pending"&&(it.status="fulfilled",it.value=Vt)},function(Vt){it.status==="pending"&&(it.status="rejected",it.reason=Vt)})),it.status){case"fulfilled":return it.value;case"rejected":throw it.reason}}throw it}function Qr(it,Vt,Er,Rr,oi){var Gi=typeof it;(Gi==="undefined"||Gi==="boolean")&&(it=null);var Cr=!1;if(it===null)Cr=!0;else switch(Gi){case"bigint":case"string":case"number":Cr=!0;break;case"object":switch(it.$$typeof){case r:case e:Cr=!0;break;case L:return Cr=it._init,Qr(Cr(it._payload),Vt,Er,Rr,oi)}}if(Cr)return oi=oi(it),Cr=Rr===""?"."+Kr(it,0):Rr,Ze(oi)?(Er="",Cr!=null&&(Er=Cr.replace(pr,"$&/")+"/"),Qr(oi,Vt,Er,"",function(ho){return ho})):oi!=null&&(Yt(oi)&&(oi=Ft(oi,Er+(oi.key==null||it&&it.key===oi.key?"":(""+oi.key).replace(pr,"$&/")+"/")+Cr)),Vt.push(oi)),1;Cr=0;var Vi=Rr===""?".":Rr+":";if(Ze(it))for(var vi=0;vi<it.length;vi++)Rr=it[vi],Gi=Vi+Kr(Rr,vi),Cr+=Qr(Rr,Vt,Er,Gi,oi);else if(vi=q(it),typeof vi=="function")for(it=vi.call(it),vi=0;!(Rr=it.next()).done;)Rr=Rr.value,Gi=Vi+Kr(Rr,vi++),Cr+=Qr(Rr,Vt,Er,Gi,oi);else if(Gi==="object"){if(typeof it.then=="function")return Qr(zi(it),Vt,Er,Rr,oi);throw Vt=String(it),Error("Objects are not valid as a React child (found: "+(Vt==="[object Object]"?"object with keys {"+Object.keys(it).join(", ")+"}":Vt)+"). If you meant to render a collection of children, use an array instead.")}return Cr}function Ot(it,Vt,Er){if(it==null)return it;var Rr=[],oi=0;return Qr(it,Rr,"","",function(Gi){return Vt.call(Er,Gi,oi++)}),Rr}function sr(it){if(it._status===-1){var Vt=it._result;Vt=Vt(),Vt.then(function(Er){(it._status===0||it._status===-1)&&(it._status=1,it._result=Er)},function(Er){(it._status===0||it._status===-1)&&(it._status=2,it._result=Er)}),it._status===-1&&(it._status=0,it._result=Vt)}if(it._status===1)return it._result.default;throw it._result}var Fr=typeof reportError=="function"?reportError:function(it){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var Vt=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof it=="object"&&it!==null&&typeof it.message=="string"?String(it.message):String(it),error:it});if(!window.dispatchEvent(Vt))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",it);return}console.error(it)};function Pi(){}return Ki.Children={map:Ot,forEach:function(it,Vt,Er){Ot(it,function(){Vt.apply(this,arguments)},Er)},count:function(it){var Vt=0;return Ot(it,function(){Vt++}),Vt},toArray:function(it){return Ot(it,function(Vt){return Vt})||[]},only:function(it){if(!Yt(it))throw Error("React.Children.only expected to receive a single React element child.");return it}},Ki.Component=be,Ki.Fragment=o,Ki.Profiler=h,Ki.PureComponent=we,Ki.StrictMode=l,Ki.Suspense=C,Ki.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=$e,Ki.__COMPILER_RUNTIME={__proto__:null,c:function(it){return $e.H.useMemoCache(it)}},Ki.cache=function(it){return function(){return it.apply(null,arguments)}},Ki.cloneElement=function(it,Vt,Er){if(it==null)throw Error("The argument must be a React element, but you passed "+it+".");var Rr=ie({},it.props),oi=it.key,Gi=void 0;if(Vt!=null)for(Cr in Vt.ref!==void 0&&(Gi=void 0),Vt.key!==void 0&&(oi=""+Vt.key),Vt)!xt.call(Vt,Cr)||Cr==="key"||Cr==="__self"||Cr==="__source"||Cr==="ref"&&Vt.ref===void 0||(Rr[Cr]=Vt[Cr]);var Cr=arguments.length-2;if(Cr===1)Rr.children=Er;else if(1<Cr){for(var Vi=Array(Cr),vi=0;vi<Cr;vi++)Vi[vi]=arguments[vi+2];Rr.children=Vi}return Ct(it.type,oi,void 0,void 0,Gi,Rr)},Ki.createContext=function(it){return it={$$typeof:b,_currentValue:it,_currentValue2:it,_threadCount:0,Provider:null,Consumer:null},it.Provider=it,it.Consumer={$$typeof:m,_context:it},it},Ki.createElement=function(it,Vt,Er){var Rr,oi={},Gi=null;if(Vt!=null)for(Rr in Vt.key!==void 0&&(Gi=""+Vt.key),Vt)xt.call(Vt,Rr)&&Rr!=="key"&&Rr!=="__self"&&Rr!=="__source"&&(oi[Rr]=Vt[Rr]);var Cr=arguments.length-2;if(Cr===1)oi.children=Er;else if(1<Cr){for(var Vi=Array(Cr),vi=0;vi<Cr;vi++)Vi[vi]=arguments[vi+2];oi.children=Vi}if(it&&it.defaultProps)for(Rr in Cr=it.defaultProps,Cr)oi[Rr]===void 0&&(oi[Rr]=Cr[Rr]);return Ct(it,Gi,void 0,void 0,null,oi)},Ki.createRef=function(){return{current:null}},Ki.forwardRef=function(it){return{$$typeof:n,render:it}},Ki.isValidElement=Yt,Ki.lazy=function(it){return{$$typeof:L,_payload:{_status:-1,_result:it},_init:sr}},Ki.memo=function(it,Vt){return{$$typeof:D,type:it,compare:Vt===void 0?null:Vt}},Ki.startTransition=function(it){var Vt=$e.T,Er={};$e.T=Er;try{var Rr=it(),oi=$e.S;oi!==null&&oi(Er,Rr),typeof Rr=="object"&&Rr!==null&&typeof Rr.then=="function"&&Rr.then(Pi,Fr)}catch(Gi){Fr(Gi)}finally{$e.T=Vt}},Ki.unstable_useCacheRefresh=function(){return $e.H.useCacheRefresh()},Ki.use=function(it){return $e.H.use(it)},Ki.useActionState=function(it,Vt,Er){return $e.H.useActionState(it,Vt,Er)},Ki.useCallback=function(it,Vt){return $e.H.useCallback(it,Vt)},Ki.useContext=function(it){return $e.H.useContext(it)},Ki.useDebugValue=function(){},Ki.useDeferredValue=function(it,Vt){return $e.H.useDeferredValue(it,Vt)},Ki.useEffect=function(it,Vt,Er){var Rr=$e.H;if(typeof Er=="function")throw Error("useEffect CRUD overload is not enabled in this build of React.");return Rr.useEffect(it,Vt)},Ki.useId=function(){return $e.H.useId()},Ki.useImperativeHandle=function(it,Vt,Er){return $e.H.useImperativeHandle(it,Vt,Er)},Ki.useInsertionEffect=function(it,Vt){return $e.H.useInsertionEffect(it,Vt)},Ki.useLayoutEffect=function(it,Vt){return $e.H.useLayoutEffect(it,Vt)},Ki.useMemo=function(it,Vt){return $e.H.useMemo(it,Vt)},Ki.useOptimistic=function(it,Vt){return $e.H.useOptimistic(it,Vt)},Ki.useReducer=function(it,Vt,Er){return $e.H.useReducer(it,Vt,Er)},Ki.useRef=function(it){return $e.H.useRef(it)},Ki.useState=function(it){return $e.H.useState(it)},Ki.useSyncExternalStore=function(it,Vt,Er){return $e.H.useSyncExternalStore(it,Vt,Er)},Ki.useTransition=function(){return $e.H.useTransition()},Ki.version="19.1.1",Ki}var bA;function Bw(){return bA||(bA=1,eb.exports=LO()),eb.exports}var Xe=Bw();const sm=Lw(Xe);var tb={exports:{}},W0={},rb={exports:{}},ib={};/**
 * @license React
 * scheduler.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var wA;function BO(){return wA||(wA=1,(function(r){function e(Ot,sr){var Fr=Ot.length;Ot.push(sr);e:for(;0<Fr;){var Pi=Fr-1>>>1,it=Ot[Pi];if(0<h(it,sr))Ot[Pi]=sr,Ot[Fr]=it,Fr=Pi;else break e}}function o(Ot){return Ot.length===0?null:Ot[0]}function l(Ot){if(Ot.length===0)return null;var sr=Ot[0],Fr=Ot.pop();if(Fr!==sr){Ot[0]=Fr;e:for(var Pi=0,it=Ot.length,Vt=it>>>1;Pi<Vt;){var Er=2*(Pi+1)-1,Rr=Ot[Er],oi=Er+1,Gi=Ot[oi];if(0>h(Rr,Fr))oi<it&&0>h(Gi,Rr)?(Ot[Pi]=Gi,Ot[oi]=Fr,Pi=oi):(Ot[Pi]=Rr,Ot[Er]=Fr,Pi=Er);else if(oi<it&&0>h(Gi,Fr))Ot[Pi]=Gi,Ot[oi]=Fr,Pi=oi;else break e}}return sr}function h(Ot,sr){var Fr=Ot.sortIndex-sr.sortIndex;return Fr!==0?Fr:Ot.id-sr.id}if(r.unstable_now=void 0,typeof performance=="object"&&typeof performance.now=="function"){var m=performance;r.unstable_now=function(){return m.now()}}else{var b=Date,n=b.now();r.unstable_now=function(){return b.now()-n}}var C=[],D=[],L=1,U=null,q=3,Z=!1,ie=!1,ne=!1,be=!1,ve=typeof setTimeout=="function"?setTimeout:null,we=typeof clearTimeout=="function"?clearTimeout:null,Pe=typeof setImmediate<"u"?setImmediate:null;function Ze(Ot){for(var sr=o(D);sr!==null;){if(sr.callback===null)l(D);else if(sr.startTime<=Ot)l(D),sr.sortIndex=sr.expirationTime,e(C,sr);else break;sr=o(D)}}function $e(Ot){if(ne=!1,Ze(Ot),!ie)if(o(C)!==null)ie=!0,xt||(xt=!0,Kr());else{var sr=o(D);sr!==null&&Qr($e,sr.startTime-Ot)}}var xt=!1,Ct=-1,Ft=5,Yt=-1;function hr(){return be?!0:!(r.unstable_now()-Yt<Ft)}function pr(){if(be=!1,xt){var Ot=r.unstable_now();Yt=Ot;var sr=!0;try{e:{ie=!1,ne&&(ne=!1,we(Ct),Ct=-1),Z=!0;var Fr=q;try{t:{for(Ze(Ot),U=o(C);U!==null&&!(U.expirationTime>Ot&&hr());){var Pi=U.callback;if(typeof Pi=="function"){U.callback=null,q=U.priorityLevel;var it=Pi(U.expirationTime<=Ot);if(Ot=r.unstable_now(),typeof it=="function"){U.callback=it,Ze(Ot),sr=!0;break t}U===o(C)&&l(C),Ze(Ot)}else l(C);U=o(C)}if(U!==null)sr=!0;else{var Vt=o(D);Vt!==null&&Qr($e,Vt.startTime-Ot),sr=!1}}break e}finally{U=null,q=Fr,Z=!1}sr=void 0}}finally{sr?Kr():xt=!1}}}var Kr;if(typeof Pe=="function")Kr=function(){Pe(pr)};else if(typeof MessageChannel<"u"){var ui=new MessageChannel,zi=ui.port2;ui.port1.onmessage=pr,Kr=function(){zi.postMessage(null)}}else Kr=function(){ve(pr,0)};function Qr(Ot,sr){Ct=ve(function(){Ot(r.unstable_now())},sr)}r.unstable_IdlePriority=5,r.unstable_ImmediatePriority=1,r.unstable_LowPriority=4,r.unstable_NormalPriority=3,r.unstable_Profiling=null,r.unstable_UserBlockingPriority=2,r.unstable_cancelCallback=function(Ot){Ot.callback=null},r.unstable_forceFrameRate=function(Ot){0>Ot||125<Ot?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):Ft=0<Ot?Math.floor(1e3/Ot):5},r.unstable_getCurrentPriorityLevel=function(){return q},r.unstable_next=function(Ot){switch(q){case 1:case 2:case 3:var sr=3;break;default:sr=q}var Fr=q;q=sr;try{return Ot()}finally{q=Fr}},r.unstable_requestPaint=function(){be=!0},r.unstable_runWithPriority=function(Ot,sr){switch(Ot){case 1:case 2:case 3:case 4:case 5:break;default:Ot=3}var Fr=q;q=Ot;try{return sr()}finally{q=Fr}},r.unstable_scheduleCallback=function(Ot,sr,Fr){var Pi=r.unstable_now();switch(typeof Fr=="object"&&Fr!==null?(Fr=Fr.delay,Fr=typeof Fr=="number"&&0<Fr?Pi+Fr:Pi):Fr=Pi,Ot){case 1:var it=-1;break;case 2:it=250;break;case 5:it=1073741823;break;case 4:it=1e4;break;default:it=5e3}return it=Fr+it,Ot={id:L++,callback:sr,priorityLevel:Ot,startTime:Fr,expirationTime:it,sortIndex:-1},Fr>Pi?(Ot.sortIndex=Fr,e(D,Ot),o(C)===null&&Ot===o(D)&&(ne?(we(Ct),Ct=-1):ne=!0,Qr($e,Fr-Pi))):(Ot.sortIndex=it,e(C,Ot),ie||Z||(ie=!0,xt||(xt=!0,Kr()))),Ot},r.unstable_shouldYield=hr,r.unstable_wrapCallback=function(Ot){var sr=q;return function(){var Fr=q;q=sr;try{return Ot.apply(this,arguments)}finally{q=Fr}}}})(ib)),ib}var SA;function zO(){return SA||(SA=1,rb.exports=BO()),rb.exports}var nb={exports:{}},Vs={};/**
 * @license React
 * react-dom.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var TA;function FO(){if(TA)return Vs;TA=1;var r=Bw();function e(C){var D="https://react.dev/errors/"+C;if(1<arguments.length){D+="?args[]="+encodeURIComponent(arguments[1]);for(var L=2;L<arguments.length;L++)D+="&args[]="+encodeURIComponent(arguments[L])}return"Minified React error #"+C+"; visit "+D+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function o(){}var l={d:{f:o,r:function(){throw Error(e(522))},D:o,C:o,L:o,m:o,X:o,S:o,M:o},p:0,findDOMNode:null},h=Symbol.for("react.portal");function m(C,D,L){var U=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:h,key:U==null?null:""+U,children:C,containerInfo:D,implementation:L}}var b=r.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE;function n(C,D){if(C==="font")return"";if(typeof D=="string")return D==="use-credentials"?D:""}return Vs.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE=l,Vs.createPortal=function(C,D){var L=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!D||D.nodeType!==1&&D.nodeType!==9&&D.nodeType!==11)throw Error(e(299));return m(C,D,null,L)},Vs.flushSync=function(C){var D=b.T,L=l.p;try{if(b.T=null,l.p=2,C)return C()}finally{b.T=D,l.p=L,l.d.f()}},Vs.preconnect=function(C,D){typeof C=="string"&&(D?(D=D.crossOrigin,D=typeof D=="string"?D==="use-credentials"?D:"":void 0):D=null,l.d.C(C,D))},Vs.prefetchDNS=function(C){typeof C=="string"&&l.d.D(C)},Vs.preinit=function(C,D){if(typeof C=="string"&&D&&typeof D.as=="string"){var L=D.as,U=n(L,D.crossOrigin),q=typeof D.integrity=="string"?D.integrity:void 0,Z=typeof D.fetchPriority=="string"?D.fetchPriority:void 0;L==="style"?l.d.S(C,typeof D.precedence=="string"?D.precedence:void 0,{crossOrigin:U,integrity:q,fetchPriority:Z}):L==="script"&&l.d.X(C,{crossOrigin:U,integrity:q,fetchPriority:Z,nonce:typeof D.nonce=="string"?D.nonce:void 0})}},Vs.preinitModule=function(C,D){if(typeof C=="string")if(typeof D=="object"&&D!==null){if(D.as==null||D.as==="script"){var L=n(D.as,D.crossOrigin);l.d.M(C,{crossOrigin:L,integrity:typeof D.integrity=="string"?D.integrity:void 0,nonce:typeof D.nonce=="string"?D.nonce:void 0})}}else D==null&&l.d.M(C)},Vs.preload=function(C,D){if(typeof C=="string"&&typeof D=="object"&&D!==null&&typeof D.as=="string"){var L=D.as,U=n(L,D.crossOrigin);l.d.L(C,L,{crossOrigin:U,integrity:typeof D.integrity=="string"?D.integrity:void 0,nonce:typeof D.nonce=="string"?D.nonce:void 0,type:typeof D.type=="string"?D.type:void 0,fetchPriority:typeof D.fetchPriority=="string"?D.fetchPriority:void 0,referrerPolicy:typeof D.referrerPolicy=="string"?D.referrerPolicy:void 0,imageSrcSet:typeof D.imageSrcSet=="string"?D.imageSrcSet:void 0,imageSizes:typeof D.imageSizes=="string"?D.imageSizes:void 0,media:typeof D.media=="string"?D.media:void 0})}},Vs.preloadModule=function(C,D){if(typeof C=="string")if(D){var L=n(D.as,D.crossOrigin);l.d.m(C,{as:typeof D.as=="string"&&D.as!=="script"?D.as:void 0,crossOrigin:L,integrity:typeof D.integrity=="string"?D.integrity:void 0})}else l.d.m(C)},Vs.requestFormReset=function(C){l.d.r(C)},Vs.unstable_batchedUpdates=function(C,D){return C(D)},Vs.useFormState=function(C,D,L){return b.H.useFormState(C,D,L)},Vs.useFormStatus=function(){return b.H.useHostTransitionStatus()},Vs.version="19.1.1",Vs}var AA;function a3(){if(AA)return nb.exports;AA=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),nb.exports=FO(),nb.exports}/**
 * @license React
 * react-dom-client.production.js
 *
 * Copyright (c) Meta Platforms, Inc. and affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var EA;function kO(){if(EA)return W0;EA=1;var r=zO(),e=Bw(),o=a3();function l(f){var y="https://react.dev/errors/"+f;if(1<arguments.length){y+="?args[]="+encodeURIComponent(arguments[1]);for(var T=2;T<arguments.length;T++)y+="&args[]="+encodeURIComponent(arguments[T])}return"Minified React error #"+f+"; visit "+y+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}function h(f){return!(!f||f.nodeType!==1&&f.nodeType!==9&&f.nodeType!==11)}function m(f){var y=f,T=f;if(f.alternate)for(;y.return;)y=y.return;else{f=y;do y=f,(y.flags&4098)!==0&&(T=y.return),f=y.return;while(f)}return y.tag===3?T:null}function b(f){if(f.tag===13){var y=f.memoizedState;if(y===null&&(f=f.alternate,f!==null&&(y=f.memoizedState)),y!==null)return y.dehydrated}return null}function n(f){if(m(f)!==f)throw Error(l(188))}function C(f){var y=f.alternate;if(!y){if(y=m(f),y===null)throw Error(l(188));return y!==f?null:f}for(var T=f,M=y;;){var N=T.return;if(N===null)break;var $=N.alternate;if($===null){if(M=N.return,M!==null){T=M;continue}break}if(N.child===$.child){for($=N.child;$;){if($===T)return n(N),f;if($===M)return n(N),y;$=$.sibling}throw Error(l(188))}if(T.return!==M.return)T=N,M=$;else{for(var ce=!1,Ae=N.child;Ae;){if(Ae===T){ce=!0,T=N,M=$;break}if(Ae===M){ce=!0,M=N,T=$;break}Ae=Ae.sibling}if(!ce){for(Ae=$.child;Ae;){if(Ae===T){ce=!0,T=$,M=N;break}if(Ae===M){ce=!0,M=$,T=N;break}Ae=Ae.sibling}if(!ce)throw Error(l(189))}}if(T.alternate!==M)throw Error(l(190))}if(T.tag!==3)throw Error(l(188));return T.stateNode.current===T?f:y}function D(f){var y=f.tag;if(y===5||y===26||y===27||y===6)return f;for(f=f.child;f!==null;){if(y=D(f),y!==null)return y;f=f.sibling}return null}var L=Object.assign,U=Symbol.for("react.element"),q=Symbol.for("react.transitional.element"),Z=Symbol.for("react.portal"),ie=Symbol.for("react.fragment"),ne=Symbol.for("react.strict_mode"),be=Symbol.for("react.profiler"),ve=Symbol.for("react.provider"),we=Symbol.for("react.consumer"),Pe=Symbol.for("react.context"),Ze=Symbol.for("react.forward_ref"),$e=Symbol.for("react.suspense"),xt=Symbol.for("react.suspense_list"),Ct=Symbol.for("react.memo"),Ft=Symbol.for("react.lazy"),Yt=Symbol.for("react.activity"),hr=Symbol.for("react.memo_cache_sentinel"),pr=Symbol.iterator;function Kr(f){return f===null||typeof f!="object"?null:(f=pr&&f[pr]||f["@@iterator"],typeof f=="function"?f:null)}var ui=Symbol.for("react.client.reference");function zi(f){if(f==null)return null;if(typeof f=="function")return f.$$typeof===ui?null:f.displayName||f.name||null;if(typeof f=="string")return f;switch(f){case ie:return"Fragment";case be:return"Profiler";case ne:return"StrictMode";case $e:return"Suspense";case xt:return"SuspenseList";case Yt:return"Activity"}if(typeof f=="object")switch(f.$$typeof){case Z:return"Portal";case Pe:return(f.displayName||"Context")+".Provider";case we:return(f._context.displayName||"Context")+".Consumer";case Ze:var y=f.render;return f=f.displayName,f||(f=y.displayName||y.name||"",f=f!==""?"ForwardRef("+f+")":"ForwardRef"),f;case Ct:return y=f.displayName||null,y!==null?y:zi(f.type)||"Memo";case Ft:y=f._payload,f=f._init;try{return zi(f(y))}catch{}}return null}var Qr=Array.isArray,Ot=e.__CLIENT_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,sr=o.__DOM_INTERNALS_DO_NOT_USE_OR_WARN_USERS_THEY_CANNOT_UPGRADE,Fr={pending:!1,data:null,method:null,action:null},Pi=[],it=-1;function Vt(f){return{current:f}}function Er(f){0>it||(f.current=Pi[it],Pi[it]=null,it--)}function Rr(f,y){it++,Pi[it]=f.current,f.current=y}var oi=Vt(null),Gi=Vt(null),Cr=Vt(null),Vi=Vt(null);function vi(f,y){switch(Rr(Cr,y),Rr(Gi,f),Rr(oi,null),y.nodeType){case 9:case 11:f=(f=y.documentElement)&&(f=f.namespaceURI)?Hy(f):0;break;default:if(f=y.tagName,y=y.namespaceURI)y=Hy(y),f=qy(y,f);else switch(f){case"svg":f=1;break;case"math":f=2;break;default:f=0}}Er(oi),Rr(oi,f)}function ho(){Er(oi),Er(Gi),Er(Cr)}function Tn(f){f.memoizedState!==null&&Rr(Vi,f);var y=oi.current,T=qy(y,f.type);y!==T&&(Rr(Gi,f),Rr(oi,T))}function qs(f){Gi.current===f&&(Er(oi),Er(Gi)),Vi.current===f&&(Er(Vi),vf._currentValue=Fr)}var gl=Object.prototype.hasOwnProperty,zu=r.unstable_scheduleCallback,Va=r.unstable_cancelCallback,On=r.unstable_shouldYield,Mf=r.unstable_requestPaint,Zo=r.unstable_now,Df=r.unstable_getCurrentPriorityLevel,na=r.unstable_ImmediatePriority,Zl=r.unstable_UserBlockingPriority,Wo=r.unstable_NormalPriority,Wl=r.unstable_LowPriority,_l=r.unstable_IdlePriority,Fu=r.log,ku=r.unstable_setDisableYieldValue,Ro=null,$n=null;function ys(f){if(typeof Fu=="function"&&ku(f),$n&&typeof $n.setStrictMode=="function")try{$n.setStrictMode(Ro,f)}catch{}}var vo=Math.clz32?Math.clz32:$s,Ah=Math.log,Mo=Math.LN2;function $s(f){return f>>>=0,f===0?32:31-(Ah(f)/Mo|0)|0}var Nc=256,Xs=4194304;function oa(f){var y=f&42;if(y!==0)return y;switch(f&-f){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:return 64;case 128:return 128;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return f&4194048;case 4194304:case 8388608:case 16777216:case 33554432:return f&62914560;case 67108864:return 67108864;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 0;default:return f}}function vs(f,y,T){var M=f.pendingLanes;if(M===0)return 0;var N=0,$=f.suspendedLanes,ce=f.pingedLanes;f=f.warmLanes;var Ae=M&134217727;return Ae!==0?(M=Ae&~$,M!==0?N=oa(M):(ce&=Ae,ce!==0?N=oa(ce):T||(T=Ae&~f,T!==0&&(N=oa(T))))):(Ae=M&~$,Ae!==0?N=oa(Ae):ce!==0?N=oa(ce):T||(T=M&~f,T!==0&&(N=oa(T)))),N===0?0:y!==0&&y!==N&&(y&$)===0&&($=N&-N,T=y&-y,$>=T||$===32&&(T&4194048)!==0)?y:N}function Zs(f,y){return(f.pendingLanes&~(f.suspendedLanes&~f.pingedLanes)&y)===0}function gn(f,y){switch(f){case 1:case 2:case 4:case 8:case 64:return y+250;case 16:case 32:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return y+5e3;case 4194304:case 8388608:case 16777216:case 33554432:return-1;case 67108864:case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function xo(){var f=Nc;return Nc<<=1,(Nc&4194048)===0&&(Nc=256),f}function Eh(){var f=Xs;return Xs<<=1,(Xs&62914560)===0&&(Xs=4194304),f}function Yl(f){for(var y=[],T=0;31>T;T++)y.push(f);return y}function ya(f,y){f.pendingLanes|=y,y!==268435456&&(f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0)}function Of(f,y,T,M,N,$){var ce=f.pendingLanes;f.pendingLanes=T,f.suspendedLanes=0,f.pingedLanes=0,f.warmLanes=0,f.expiredLanes&=T,f.entangledLanes&=T,f.errorRecoveryDisabledLanes&=T,f.shellSuspendCounter=0;var Ae=f.entanglements,Ye=f.expirationTimes,Mt=f.hiddenUpdates;for(T=ce&~T;0<T;){var Wt=31-vo(T),ir=1<<Wt;Ae[Wt]=0,Ye[Wt]=-1;var zt=Mt[Wt];if(zt!==null)for(Mt[Wt]=null,Wt=0;Wt<zt.length;Wt++){var kt=zt[Wt];kt!==null&&(kt.lane&=-536870913)}T&=~ir}M!==0&&Ch(f,M,0),$!==0&&N===0&&f.tag!==0&&(f.suspendedLanes|=$&~(ce&~y))}function Ch(f,y,T){f.pendingLanes|=y,f.suspendedLanes&=~y;var M=31-vo(y);f.entangledLanes|=y,f.entanglements[M]=f.entanglements[M]|1073741824|T&4194090}function Pf(f,y){var T=f.entangledLanes|=y;for(f=f.entanglements;T;){var M=31-vo(T),N=1<<M;N&y|f[M]&y&&(f[M]|=y),T&=~N}}function Tt(f){switch(f){case 2:f=1;break;case 8:f=4;break;case 32:f=16;break;case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:f=128;break;case 268435456:f=134217728;break;default:f=0}return f}function Ws(f){return f&=-f,2<f?8<f?(f&134217727)!==0?32:268435456:8:2}function Ud(){var f=sr.p;return f!==0?f:(f=window.event,f===void 0?32:mh(f.type))}function Ih(f,y){var T=sr.p;try{return sr.p=f,y()}finally{sr.p=T}}var Ne=Math.random().toString(36).slice(2),te="__reactFiber$"+Ne,oe="__reactProps$"+Ne,me="__reactContainer$"+Ne,Me="__reactEvents$"+Ne,Re="__reactListeners$"+Ne,Ie="__reactHandles$"+Ne,Qe="__reactResources$"+Ne,Be="__reactMarker$"+Ne;function Je(f){delete f[te],delete f[oe],delete f[Me],delete f[Re],delete f[Ie]}function Pt(f){var y=f[te];if(y)return y;for(var T=f.parentNode;T;){if(y=T[me]||T[te]){if(T=y.alternate,y.child!==null||T!==null&&T.child!==null)for(f=p0(f);f!==null;){if(T=f[te])return T;f=p0(f)}return y}f=T,T=f.parentNode}return null}function _t(f){if(f=f[te]||f[me]){var y=f.tag;if(y===5||y===6||y===13||y===26||y===27||y===3)return f}return null}function lr(f){var y=f.tag;if(y===5||y===26||y===27||y===6)return f.stateNode;throw Error(l(33))}function yr(f){var y=f[Qe];return y||(y=f[Qe]={hoistableStyles:new Map,hoistableScripts:new Map}),y}function gr(f){f[Be]=!0}var Jr=new Set,qr={};function Yr(f,y){Ri(f,y),Ri(f+"Capture",y)}function Ri(f,y){for(qr[f]=y,f=0;f<y.length;f++)Jr.add(y[f])}var ri=RegExp("^[:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD][:A-Z_a-z\\u00C0-\\u00D6\\u00D8-\\u00F6\\u00F8-\\u02FF\\u0370-\\u037D\\u037F-\\u1FFF\\u200C-\\u200D\\u2070-\\u218F\\u2C00-\\u2FEF\\u3001-\\uD7FF\\uF900-\\uFDCF\\uFDF0-\\uFFFD\\-.0-9\\u00B7\\u0300-\\u036F\\u203F-\\u2040]*$"),An={},Xn={};function eo(f){return gl.call(Xn,f)?!0:gl.call(An,f)?!1:ri.test(f)?Xn[f]=!0:(An[f]=!0,!1)}function Li(f,y,T){if(eo(y))if(T===null)f.removeAttribute(y);else{switch(typeof T){case"undefined":case"function":case"symbol":f.removeAttribute(y);return;case"boolean":var M=y.toLowerCase().slice(0,5);if(M!=="data-"&&M!=="aria-"){f.removeAttribute(y);return}}f.setAttribute(y,""+T)}}function mi(f,y,T){if(T===null)f.removeAttribute(y);else{switch(typeof T){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(y);return}f.setAttribute(y,""+T)}}function $i(f,y,T,M){if(M===null)f.removeAttribute(T);else{switch(typeof M){case"undefined":case"function":case"symbol":case"boolean":f.removeAttribute(T);return}f.setAttributeNS(y,T,""+M)}}var _n,Wi;function to(f){if(_n===void 0)try{throw Error()}catch(T){var y=T.stack.trim().match(/\n( *(at )?)/);_n=y&&y[1]||"",Wi=-1<T.stack.indexOf(`
    at`)?" (<anonymous>)":-1<T.stack.indexOf("@")?"@unknown:0:0":""}return`
`+_n+f+Wi}var No=!1;function va(f,y){if(!f||No)return"";No=!0;var T=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{var M={DetermineComponentFrameRoot:function(){try{if(y){var ir=function(){throw Error()};if(Object.defineProperty(ir.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(ir,[])}catch(kt){var zt=kt}Reflect.construct(f,[],ir)}else{try{ir.call()}catch(kt){zt=kt}f.call(ir.prototype)}}else{try{throw Error()}catch(kt){zt=kt}(ir=f())&&typeof ir.catch=="function"&&ir.catch(function(){})}}catch(kt){if(kt&&zt&&typeof kt.stack=="string")return[kt.stack,zt.stack]}return[null,null]}};M.DetermineComponentFrameRoot.displayName="DetermineComponentFrameRoot";var N=Object.getOwnPropertyDescriptor(M.DetermineComponentFrameRoot,"name");N&&N.configurable&&Object.defineProperty(M.DetermineComponentFrameRoot,"name",{value:"DetermineComponentFrameRoot"});var $=M.DetermineComponentFrameRoot(),ce=$[0],Ae=$[1];if(ce&&Ae){var Ye=ce.split(`
`),Mt=Ae.split(`
`);for(N=M=0;M<Ye.length&&!Ye[M].includes("DetermineComponentFrameRoot");)M++;for(;N<Mt.length&&!Mt[N].includes("DetermineComponentFrameRoot");)N++;if(M===Ye.length||N===Mt.length)for(M=Ye.length-1,N=Mt.length-1;1<=M&&0<=N&&Ye[M]!==Mt[N];)N--;for(;1<=M&&0<=N;M--,N--)if(Ye[M]!==Mt[N]){if(M!==1||N!==1)do if(M--,N--,0>N||Ye[M]!==Mt[N]){var Wt=`
`+Ye[M].replace(" at new "," at ");return f.displayName&&Wt.includes("<anonymous>")&&(Wt=Wt.replace("<anonymous>",f.displayName)),Wt}while(1<=M&&0<=N);break}}}finally{No=!1,Error.prepareStackTrace=T}return(T=f?f.displayName||f.name:"")?to(T):""}function Ql(f){switch(f.tag){case 26:case 27:case 5:return to(f.type);case 16:return to("Lazy");case 13:return to("Suspense");case 19:return to("SuspenseList");case 0:case 15:return va(f.type,!1);case 11:return va(f.type.render,!1);case 1:return va(f.type,!0);case 31:return to("Activity");default:return""}}function Vo(f){try{var y="";do y+=Ql(f),f=f.return;while(f);return y}catch(T){return`
Error generating stack: `+T.message+`
`+T.stack}}function Yo(f){switch(typeof f){case"bigint":case"boolean":case"number":case"string":case"undefined":return f;case"object":return f;default:return""}}function pm(f){var y=f.type;return(f=f.nodeName)&&f.toLowerCase()==="input"&&(y==="checkbox"||y==="radio")}function Vc(f){var y=pm(f)?"checked":"value",T=Object.getOwnPropertyDescriptor(f.constructor.prototype,y),M=""+f[y];if(!f.hasOwnProperty(y)&&typeof T<"u"&&typeof T.get=="function"&&typeof T.set=="function"){var N=T.get,$=T.set;return Object.defineProperty(f,y,{configurable:!0,get:function(){return N.call(this)},set:function(ce){M=""+ce,$.call(this,ce)}}),Object.defineProperty(f,y,{enumerable:T.enumerable}),{getValue:function(){return M},setValue:function(ce){M=""+ce},stopTracking:function(){f._valueTracker=null,delete f[y]}}}}function Kl(f){f._valueTracker||(f._valueTracker=Vc(f))}function Rh(f){if(!f)return!1;var y=f._valueTracker;if(!y)return!0;var T=y.getValue(),M="";return f&&(M=pm(f)?f.checked?"true":"false":f.value),f=M,f!==T?(y.setValue(f),!0):!1}function Uc(f){if(f=f||(typeof document<"u"?document:void 0),typeof f>"u")return null;try{return f.activeElement||f.body}catch{return f.body}}var jc=/[\n"\\]/g;function aa(f){return f.replace(jc,function(y){return"\\"+y.charCodeAt(0).toString(16)+" "})}function Lf(f,y,T,M,N,$,ce,Ae){f.name="",ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"?f.type=ce:f.removeAttribute("type"),y!=null?ce==="number"?(y===0&&f.value===""||f.value!=y)&&(f.value=""+Yo(y)):f.value!==""+Yo(y)&&(f.value=""+Yo(y)):ce!=="submit"&&ce!=="reset"||f.removeAttribute("value"),y!=null?Bf(f,ce,Yo(y)):T!=null?Bf(f,ce,Yo(T)):M!=null&&f.removeAttribute("value"),N==null&&$!=null&&(f.defaultChecked=!!$),N!=null&&(f.checked=N&&typeof N!="function"&&typeof N!="symbol"),Ae!=null&&typeof Ae!="function"&&typeof Ae!="symbol"&&typeof Ae!="boolean"?f.name=""+Yo(Ae):f.removeAttribute("name")}function Ys(f,y,T,M,N,$,ce,Ae){if($!=null&&typeof $!="function"&&typeof $!="symbol"&&typeof $!="boolean"&&(f.type=$),y!=null||T!=null){if(!($!=="submit"&&$!=="reset"||y!=null))return;T=T!=null?""+Yo(T):"",y=y!=null?""+Yo(y):T,Ae||y===f.value||(f.value=y),f.defaultValue=y}M=M??N,M=typeof M!="function"&&typeof M!="symbol"&&!!M,f.checked=Ae?f.checked:!!M,f.defaultChecked=!!M,ce!=null&&typeof ce!="function"&&typeof ce!="symbol"&&typeof ce!="boolean"&&(f.name=ce)}function Bf(f,y,T){y==="number"&&Uc(f.ownerDocument)===f||f.defaultValue===""+T||(f.defaultValue=""+T)}function Jl(f,y,T,M){if(f=f.options,y){y={};for(var N=0;N<T.length;N++)y["$"+T[N]]=!0;for(T=0;T<f.length;T++)N=y.hasOwnProperty("$"+f[T].value),f[T].selected!==N&&(f[T].selected=N),N&&M&&(f[T].defaultSelected=!0)}else{for(T=""+Yo(T),y=null,N=0;N<f.length;N++){if(f[N].value===T){f[N].selected=!0,M&&(f[N].defaultSelected=!0);return}y!==null||f[N].disabled||(y=f[N])}y!==null&&(y.selected=!0)}}function Ua(f,y,T){if(y!=null&&(y=""+Yo(y),y!==f.value&&(f.value=y),T==null)){f.defaultValue!==y&&(f.defaultValue=y);return}f.defaultValue=T!=null?""+Yo(T):""}function xs(f,y,T,M){if(y==null){if(M!=null){if(T!=null)throw Error(l(92));if(Qr(M)){if(1<M.length)throw Error(l(93));M=M[0]}T=M}T==null&&(T=""),y=T}T=Yo(y),f.defaultValue=T,M=f.textContent,M===T&&M!==""&&M!==null&&(f.value=M)}function ja(f,y){if(y){var T=f.firstChild;if(T&&T===f.lastChild&&T.nodeType===3){T.nodeValue=y;return}}f.textContent=y}var Qs=new Set("animationIterationCount aspectRatio borderImageOutset borderImageSlice borderImageWidth boxFlex boxFlexGroup boxOrdinalGroup columnCount columns flex flexGrow flexPositive flexShrink flexNegative flexOrder gridArea gridRow gridRowEnd gridRowSpan gridRowStart gridColumn gridColumnEnd gridColumnSpan gridColumnStart fontWeight lineClamp lineHeight opacity order orphans scale tabSize widows zIndex zoom fillOpacity floodOpacity stopOpacity strokeDasharray strokeDashoffset strokeMiterlimit strokeOpacity strokeWidth MozAnimationIterationCount MozBoxFlex MozBoxFlexGroup MozLineClamp msAnimationIterationCount msFlex msZoom msFlexGrow msFlexNegative msFlexOrder msFlexPositive msFlexShrink msGridColumn msGridColumnSpan msGridRow msGridRowSpan WebkitAnimationIterationCount WebkitBoxFlex WebKitBoxFlexGroup WebkitBoxOrdinalGroup WebkitColumnCount WebkitColumns WebkitFlex WebkitFlexGrow WebkitFlexPositive WebkitFlexShrink WebkitLineClamp".split(" "));function Qo(f,y,T){var M=y.indexOf("--")===0;T==null||typeof T=="boolean"||T===""?M?f.setProperty(y,""):y==="float"?f.cssFloat="":f[y]="":M?f.setProperty(y,T):typeof T!="number"||T===0||Qs.has(y)?y==="float"?f.cssFloat=T:f[y]=(""+T).trim():f[y]=T+"px"}function Gc(f,y,T){if(y!=null&&typeof y!="object")throw Error(l(62));if(f=f.style,T!=null){for(var M in T)!T.hasOwnProperty(M)||y!=null&&y.hasOwnProperty(M)||(M.indexOf("--")===0?f.setProperty(M,""):M==="float"?f.cssFloat="":f[M]="");for(var N in y)M=y[N],y.hasOwnProperty(N)&&T[N]!==M&&Qo(f,N,M)}else for(var $ in y)y.hasOwnProperty($)&&Qo(f,$,y[$])}function zf(f){if(f.indexOf("-")===-1)return!1;switch(f){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var Ff=new Map([["acceptCharset","accept-charset"],["htmlFor","for"],["httpEquiv","http-equiv"],["crossOrigin","crossorigin"],["accentHeight","accent-height"],["alignmentBaseline","alignment-baseline"],["arabicForm","arabic-form"],["baselineShift","baseline-shift"],["capHeight","cap-height"],["clipPath","clip-path"],["clipRule","clip-rule"],["colorInterpolation","color-interpolation"],["colorInterpolationFilters","color-interpolation-filters"],["colorProfile","color-profile"],["colorRendering","color-rendering"],["dominantBaseline","dominant-baseline"],["enableBackground","enable-background"],["fillOpacity","fill-opacity"],["fillRule","fill-rule"],["floodColor","flood-color"],["floodOpacity","flood-opacity"],["fontFamily","font-family"],["fontSize","font-size"],["fontSizeAdjust","font-size-adjust"],["fontStretch","font-stretch"],["fontStyle","font-style"],["fontVariant","font-variant"],["fontWeight","font-weight"],["glyphName","glyph-name"],["glyphOrientationHorizontal","glyph-orientation-horizontal"],["glyphOrientationVertical","glyph-orientation-vertical"],["horizAdvX","horiz-adv-x"],["horizOriginX","horiz-origin-x"],["imageRendering","image-rendering"],["letterSpacing","letter-spacing"],["lightingColor","lighting-color"],["markerEnd","marker-end"],["markerMid","marker-mid"],["markerStart","marker-start"],["overlinePosition","overline-position"],["overlineThickness","overline-thickness"],["paintOrder","paint-order"],["panose-1","panose-1"],["pointerEvents","pointer-events"],["renderingIntent","rendering-intent"],["shapeRendering","shape-rendering"],["stopColor","stop-color"],["stopOpacity","stop-opacity"],["strikethroughPosition","strikethrough-position"],["strikethroughThickness","strikethrough-thickness"],["strokeDasharray","stroke-dasharray"],["strokeDashoffset","stroke-dashoffset"],["strokeLinecap","stroke-linecap"],["strokeLinejoin","stroke-linejoin"],["strokeMiterlimit","stroke-miterlimit"],["strokeOpacity","stroke-opacity"],["strokeWidth","stroke-width"],["textAnchor","text-anchor"],["textDecoration","text-decoration"],["textRendering","text-rendering"],["transformOrigin","transform-origin"],["underlinePosition","underline-position"],["underlineThickness","underline-thickness"],["unicodeBidi","unicode-bidi"],["unicodeRange","unicode-range"],["unitsPerEm","units-per-em"],["vAlphabetic","v-alphabetic"],["vHanging","v-hanging"],["vIdeographic","v-ideographic"],["vMathematical","v-mathematical"],["vectorEffect","vector-effect"],["vertAdvY","vert-adv-y"],["vertOriginX","vert-origin-x"],["vertOriginY","vert-origin-y"],["wordSpacing","word-spacing"],["writingMode","writing-mode"],["xmlnsXlink","xmlns:xlink"],["xHeight","x-height"]]),Hc=/^[\u0000-\u001F ]*j[\r\n\t]*a[\r\n\t]*v[\r\n\t]*a[\r\n\t]*s[\r\n\t]*c[\r\n\t]*r[\r\n\t]*i[\r\n\t]*p[\r\n\t]*t[\r\n\t]*:/i;function qc(f){return Hc.test(""+f)?"javascript:throw new Error('React has blocked a javascript: URL as a security precaution.')":f}var Nu=null;function $c(f){return f=f.target||f.srcElement||window,f.correspondingUseElement&&(f=f.correspondingUseElement),f.nodeType===3?f.parentNode:f}var Uo=null,Xc=null;function kf(f){var y=_t(f);if(y&&(f=y.stateNode)){var T=f[oe]||null;e:switch(f=y.stateNode,y.type){case"input":if(Lf(f,T.value,T.defaultValue,T.defaultValue,T.checked,T.defaultChecked,T.type,T.name),y=T.name,T.type==="radio"&&y!=null){for(T=f;T.parentNode;)T=T.parentNode;for(T=T.querySelectorAll('input[name="'+aa(""+y)+'"][type="radio"]'),y=0;y<T.length;y++){var M=T[y];if(M!==f&&M.form===f.form){var N=M[oe]||null;if(!N)throw Error(l(90));Lf(M,N.value,N.defaultValue,N.defaultValue,N.checked,N.defaultChecked,N.type,N.name)}}for(y=0;y<T.length;y++)M=T[y],M.form===f.form&&Rh(M)}break e;case"textarea":Ua(f,T.value,T.defaultValue);break e;case"select":y=T.value,y!=null&&Jl(f,!!T.multiple,y,!1)}}}var Zc=!1;function Nf(f,y,T){if(Zc)return f(y,T);Zc=!0;try{var M=f(y);return M}finally{if(Zc=!1,(Uo!==null||Xc!==null)&&(Xa(),Uo&&(y=Uo,f=Xc,Xc=Uo=null,kf(y),f)))for(y=0;y<f.length;y++)kf(f[y])}}function Vu(f,y){var T=f.stateNode;if(T===null)return null;var M=T[oe]||null;if(M===null)return null;T=M[y];e:switch(y){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(M=!M.disabled)||(f=f.type,M=!(f==="button"||f==="input"||f==="select"||f==="textarea")),f=!M;break e;default:f=!1}if(f)return null;if(T&&typeof T!="function")throw Error(l(231,y,typeof T));return T}var bs=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),ai=!1;if(bs)try{var yl={};Object.defineProperty(yl,"passive",{get:function(){ai=!0}}),window.addEventListener("test",yl,yl),window.removeEventListener("test",yl,yl)}catch{ai=!1}var ec=null,jd=null,Uu=null;function tc(){if(Uu)return Uu;var f,y=jd,T=y.length,M,N="value"in ec?ec.value:ec.textContent,$=N.length;for(f=0;f<T&&y[f]===N[f];f++);var ce=T-f;for(M=1;M<=ce&&y[T-M]===N[$-M];M++);return Uu=N.slice(f,1<M?1-M:void 0)}function rc(f){var y=f.keyCode;return"charCode"in f?(f=f.charCode,f===0&&y===13&&(f=13)):f=y,f===10&&(f=13),32<=f||f===13?f:0}function Wc(){return!0}function Vf(){return!1}function xa(f){function y(T,M,N,$,ce){this._reactName=T,this._targetInst=N,this.type=M,this.nativeEvent=$,this.target=ce,this.currentTarget=null;for(var Ae in f)f.hasOwnProperty(Ae)&&(T=f[Ae],this[Ae]=T?T($):$[Ae]);return this.isDefaultPrevented=($.defaultPrevented!=null?$.defaultPrevented:$.returnValue===!1)?Wc:Vf,this.isPropagationStopped=Vf,this}return L(y.prototype,{preventDefault:function(){this.defaultPrevented=!0;var T=this.nativeEvent;T&&(T.preventDefault?T.preventDefault():typeof T.returnValue!="unknown"&&(T.returnValue=!1),this.isDefaultPrevented=Wc)},stopPropagation:function(){var T=this.nativeEvent;T&&(T.stopPropagation?T.stopPropagation():typeof T.cancelBubble!="unknown"&&(T.cancelBubble=!0),this.isPropagationStopped=Wc)},persist:function(){},isPersistent:Wc}),y}var es={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(f){return f.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Uf=xa(es),ju=L({},es,{view:0,detail:0}),Mh=xa(ju),Dh,ts,ic,Gu=L({},ju,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:ws,button:0,buttons:0,relatedTarget:function(f){return f.relatedTarget===void 0?f.fromElement===f.srcElement?f.toElement:f.fromElement:f.relatedTarget},movementX:function(f){return"movementX"in f?f.movementX:(f!==ic&&(ic&&f.type==="mousemove"?(Dh=f.screenX-ic.screenX,ts=f.screenY-ic.screenY):ts=Dh=0,ic=f),Dh)},movementY:function(f){return"movementY"in f?f.movementY:ts}}),Ga=xa(Gu),Hu=L({},Gu,{dataTransfer:0}),rs=xa(Hu),mm=L({},ju,{relatedTarget:0}),Oh=xa(mm),gm=L({},es,{animationName:0,elapsedTime:0,pseudoElement:0}),Ei=xa(gm),_m=L({},es,{clipboardData:function(f){return"clipboardData"in f?f.clipboardData:window.clipboardData}}),Eg=xa(_m),Gd=L({},es,{data:0}),xr=xa(Gd),ym={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},is={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},Ks={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function Hd(f){var y=this.nativeEvent;return y.getModifierState?y.getModifierState(f):(f=Ks[f])?!!y[f]:!1}function ws(){return Hd}var cr=L({},ju,{key:function(f){if(f.key){var y=ym[f.key]||f.key;if(y!=="Unidentified")return y}return f.type==="keypress"?(f=rc(f),f===13?"Enter":String.fromCharCode(f)):f.type==="keydown"||f.type==="keyup"?is[f.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:ws,charCode:function(f){return f.type==="keypress"?rc(f):0},keyCode:function(f){return f.type==="keydown"||f.type==="keyup"?f.keyCode:0},which:function(f){return f.type==="keypress"?rc(f):f.type==="keydown"||f.type==="keyup"?f.keyCode:0}}),Ci=xa(cr),Mi=L({},Gu,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),ba=xa(Mi),qu=L({},ju,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:ws}),wi=xa(qu),qd=L({},es,{propertyName:0,elapsedTime:0,pseudoElement:0}),Yc=xa(qd),jf=L({},Gu,{deltaX:function(f){return"deltaX"in f?f.deltaX:"wheelDeltaX"in f?-f.wheelDeltaX:0},deltaY:function(f){return"deltaY"in f?f.deltaY:"wheelDeltaY"in f?-f.wheelDeltaY:"wheelDelta"in f?-f.wheelDelta:0},deltaZ:0,deltaMode:0}),Ko=xa(jf),ro=L({},es,{newState:0,oldState:0}),e0=xa(ro),Gf=[9,13,27,32],Hf=bs&&"CompositionEvent"in window,nc=null;bs&&"documentMode"in document&&(nc=document.documentMode);var qf=bs&&"TextEvent"in window&&!nc,oc=bs&&(!Hf||nc&&8<nc&&11>=nc),$f=" ",Jo=!1;function Ss(f,y){switch(f){case"keyup":return Gf.indexOf(y.keyCode)!==-1;case"keydown":return y.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function sa(f){return f=f.detail,typeof f=="object"&&"data"in f?f.data:null}var $u=!1;function Ph(f,y){switch(f){case"compositionend":return sa(y);case"keypress":return y.which!==32?null:(Jo=!0,$f);case"textInput":return f=y.data,f===$f&&Jo?null:f;default:return null}}function fo(f,y){if($u)return f==="compositionend"||!Hf&&Ss(f,y)?(f=tc(),Uu=jd=ec=null,$u=!1,f):null;switch(f){case"paste":return null;case"keypress":if(!(y.ctrlKey||y.altKey||y.metaKey)||y.ctrlKey&&y.altKey){if(y.char&&1<y.char.length)return y.char;if(y.which)return String.fromCharCode(y.which)}return null;case"compositionend":return oc&&y.locale!=="ko"?null:y.data;default:return null}}var wa={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function kr(f){var y=f&&f.nodeName&&f.nodeName.toLowerCase();return y==="input"?!!wa[f.type]:y==="textarea"}function qt(f,y,T,M){Uo?Xc?Xc.push(M):Xc=[M]:Uo=M,y=Xm(y,"onChange"),0<y.length&&(T=new Uf("onChange","change",null,T,M),f.push({event:T,listeners:y}))}var ac=null,vr=null;function Xu(f){s0(f,0)}function sc(f){var y=lr(f);if(Rh(y))return f}function Tr(f,y){if(f==="change")return y}var $d=!1;if(bs){var Zu;if(bs){var Wu="oninput"in document;if(!Wu){var Xd=document.createElement("div");Xd.setAttribute("oninput","return;"),Wu=typeof Xd.oninput=="function"}Zu=Wu}else Zu=!1;$d=Zu&&(!document.documentMode||9<document.documentMode)}function Xf(){ac&&(ac.detachEvent("onpropertychange",kn),vr=ac=null)}function kn(f){if(f.propertyName==="value"&&sc(vr)){var y=[];qt(y,vr,f,$c(f)),Nf(Xu,y)}}function vm(f,y,T){f==="focusin"?(Xf(),ac=y,vr=T,ac.attachEvent("onpropertychange",kn)):f==="focusout"&&Xf()}function lc(f){if(f==="selectionchange"||f==="keyup"||f==="keydown")return sc(vr)}function la(f,y){if(f==="click")return sc(y)}function Qc(f,y){if(f==="input"||f==="change")return sc(y)}function Do(f,y){return f===y&&(f!==0||1/f===1/y)||f!==f&&y!==y}var Ha=typeof Object.is=="function"?Object.is:Do;function cc(f,y){if(Ha(f,y))return!0;if(typeof f!="object"||f===null||typeof y!="object"||y===null)return!1;var T=Object.keys(f),M=Object.keys(y);if(T.length!==M.length)return!1;for(M=0;M<T.length;M++){var N=T[M];if(!gl.call(y,N)||!Ha(f[N],y[N]))return!1}return!0}function Cg(f){for(;f&&f.firstChild;)f=f.firstChild;return f}function Zf(f,y){var T=Cg(f);f=0;for(var M;T;){if(T.nodeType===3){if(M=f+T.textContent.length,f<=y&&M>=y)return{node:T,offset:y-f};f=M}e:{for(;T;){if(T.nextSibling){T=T.nextSibling;break e}T=T.parentNode}T=void 0}T=Cg(T)}}function Yu(f,y){return f&&y?f===y?!0:f&&f.nodeType===3?!1:y&&y.nodeType===3?Yu(f,y.parentNode):"contains"in f?f.contains(y):f.compareDocumentPosition?!!(f.compareDocumentPosition(y)&16):!1:!1}function Ts(f){f=f!=null&&f.ownerDocument!=null&&f.ownerDocument.defaultView!=null?f.ownerDocument.defaultView:window;for(var y=Uc(f.document);y instanceof f.HTMLIFrameElement;){try{var T=typeof y.contentWindow.location.href=="string"}catch{T=!1}if(T)f=y.contentWindow;else break;y=Uc(f.document)}return y}function xm(f){var y=f&&f.nodeName&&f.nodeName.toLowerCase();return y&&(y==="input"&&(f.type==="text"||f.type==="search"||f.type==="tel"||f.type==="url"||f.type==="password")||y==="textarea"||f.contentEditable==="true")}var Lh=bs&&"documentMode"in document&&11>=document.documentMode,Qu=null,Bh=null,Kc=null,vl=!1;function Jc(f,y,T){var M=T.window===T?T.document:T.nodeType===9?T:T.ownerDocument;vl||Qu==null||Qu!==Uc(M)||(M=Qu,"selectionStart"in M&&xm(M)?M={start:M.selectionStart,end:M.selectionEnd}:(M=(M.ownerDocument&&M.ownerDocument.defaultView||window).getSelection(),M={anchorNode:M.anchorNode,anchorOffset:M.anchorOffset,focusNode:M.focusNode,focusOffset:M.focusOffset}),Kc&&cc(Kc,M)||(Kc=M,M=Xm(Bh,"onSelect"),0<M.length&&(y=new Uf("onSelect","select",null,y,T),f.push({event:y,listeners:M}),y.target=Qu)))}function Ku(f,y){var T={};return T[f.toLowerCase()]=y.toLowerCase(),T["Webkit"+f]="webkit"+y,T["Moz"+f]="moz"+y,T}var zh={animationend:Ku("Animation","AnimationEnd"),animationiteration:Ku("Animation","AnimationIteration"),animationstart:Ku("Animation","AnimationStart"),transitionrun:Ku("Transition","TransitionRun"),transitionstart:Ku("Transition","TransitionStart"),transitioncancel:Ku("Transition","TransitionCancel"),transitionend:Ku("Transition","TransitionEnd")},Fh={},bm={};bs&&(bm=document.createElement("div").style,"AnimationEvent"in window||(delete zh.animationend.animation,delete zh.animationiteration.animation,delete zh.animationstart.animation),"TransitionEvent"in window||delete zh.transitionend.transition);function xl(f){if(Fh[f])return Fh[f];if(!zh[f])return f;var y=zh[f],T;for(T in y)if(y.hasOwnProperty(T)&&T in bm)return Fh[f]=y[T];return f}var ns=xl("animationend"),wm=xl("animationiteration"),Sm=xl("animationstart"),Ig=xl("transitionrun"),Ju=xl("transitionstart"),Wf=xl("transitioncancel"),Zd=xl("transitionend"),Wd=new Map,eu="abort auxClick beforeToggle cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");eu.push("scrollEnd");function ca(f,y){Wd.set(f,y),Yr(y,[f])}var Yd=new WeakMap;function Sa(f,y){if(typeof f=="object"&&f!==null){var T=Yd.get(f);return T!==void 0?T:(y={value:f,source:y,stack:Vo(y)},Yd.set(f,y),y)}return{value:f,source:y,stack:Vo(y)}}var io=[],uc=0,Bt=0;function kh(){for(var f=uc,y=Bt=uc=0;y<f;){var T=io[y];io[y++]=null;var M=io[y];io[y++]=null;var N=io[y];io[y++]=null;var $=io[y];if(io[y++]=null,M!==null&&N!==null){var ce=M.pending;ce===null?N.next=N:(N.next=ce.next,ce.next=N),M.pending=N}$!==0&&Nh(T,N,$)}}function hc(f,y,T,M){io[uc++]=f,io[uc++]=y,io[uc++]=T,io[uc++]=M,Bt|=M,f.lanes|=M,f=f.alternate,f!==null&&(f.lanes|=M)}function tu(f,y,T,M){return hc(f,y,T,M),os(f)}function bl(f,y){return hc(f,null,null,y),os(f)}function Nh(f,y,T){f.lanes|=T;var M=f.alternate;M!==null&&(M.lanes|=T);for(var N=!1,$=f.return;$!==null;)$.childLanes|=T,M=$.alternate,M!==null&&(M.childLanes|=T),$.tag===22&&(f=$.stateNode,f===null||f._visibility&1||(N=!0)),f=$,$=$.return;return f.tag===3?($=f.stateNode,N&&y!==null&&(N=31-vo(T),f=$.hiddenUpdates,M=f[N],M===null?f[N]=[y]:M.push(y),y.lane=T|536870912),$):null}function os(f){if(50<Xi)throw Xi=0,Bn=null,Error(l(185));for(var y=f.return;y!==null;)f=y,y=f.return;return f.tag===3?f.stateNode:null}var fc={};function As(f,y,T,M){this.tag=f,this.key=T,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.refCleanup=this.ref=null,this.pendingProps=y,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=M,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function Nr(f,y,T,M){return new As(f,y,T,M)}function ru(f){return f=f.prototype,!(!f||!f.isReactComponent)}function dc(f,y){var T=f.alternate;return T===null?(T=Nr(f.tag,y,f.key,f.mode),T.elementType=f.elementType,T.type=f.type,T.stateNode=f.stateNode,T.alternate=f,f.alternate=T):(T.pendingProps=y,T.type=f.type,T.flags=0,T.subtreeFlags=0,T.deletions=null),T.flags=f.flags&65011712,T.childLanes=f.childLanes,T.lanes=f.lanes,T.child=f.child,T.memoizedProps=f.memoizedProps,T.memoizedState=f.memoizedState,T.updateQueue=f.updateQueue,y=f.dependencies,T.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext},T.sibling=f.sibling,T.index=f.index,T.ref=f.ref,T.refCleanup=f.refCleanup,T}function Rg(f,y){f.flags&=65011714;var T=f.alternate;return T===null?(f.childLanes=0,f.lanes=y,f.child=null,f.subtreeFlags=0,f.memoizedProps=null,f.memoizedState=null,f.updateQueue=null,f.dependencies=null,f.stateNode=null):(f.childLanes=T.childLanes,f.lanes=T.lanes,f.child=T.child,f.subtreeFlags=0,f.deletions=null,f.memoizedProps=T.memoizedProps,f.memoizedState=T.memoizedState,f.updateQueue=T.updateQueue,f.type=T.type,y=T.dependencies,f.dependencies=y===null?null:{lanes:y.lanes,firstContext:y.firstContext}),f}function eh(f,y,T,M,N,$){var ce=0;if(M=f,typeof f=="function")ru(f)&&(ce=1);else if(typeof f=="string")ce=nx(f,T,oi.current)?26:f==="html"||f==="head"||f==="body"?27:5;else e:switch(f){case Yt:return f=Nr(31,T,y,N),f.elementType=Yt,f.lanes=$,f;case ie:return th(T.children,N,$,y);case ne:ce=8,N|=24;break;case be:return f=Nr(12,T,y,N|2),f.elementType=be,f.lanes=$,f;case $e:return f=Nr(13,T,y,N),f.elementType=$e,f.lanes=$,f;case xt:return f=Nr(19,T,y,N),f.elementType=xt,f.lanes=$,f;default:if(typeof f=="object"&&f!==null)switch(f.$$typeof){case ve:case Pe:ce=10;break e;case we:ce=9;break e;case Ze:ce=11;break e;case Ct:ce=14;break e;case Ft:ce=16,M=null;break e}ce=29,T=Error(l(130,f===null?"null":typeof f,"")),M=null}return y=Nr(ce,T,y,N),y.elementType=f,y.type=M,y.lanes=$,y}function th(f,y,T,M){return f=Nr(7,f,M,y),f.lanes=T,f}function tn(f,y,T){return f=Nr(6,f,null,y),f.lanes=T,f}function Qd(f,y,T){return y=Nr(4,f.children!==null?f.children:[],f.key,y),y.lanes=T,y.stateNode={containerInfo:f.containerInfo,pendingChildren:null,implementation:f.implementation},y}var iu=[],Vh=0,Kd=null,Jd=0,Es=[],as=0,rh=null,Cs=1,pc="";function nu(f,y){iu[Vh++]=Jd,iu[Vh++]=Kd,Kd=f,Jd=y}function ep(f,y,T){Es[as++]=Cs,Es[as++]=pc,Es[as++]=rh,rh=f;var M=Cs;f=pc;var N=32-vo(M)-1;M&=~(1<<N),T+=1;var $=32-vo(y)+N;if(30<$){var ce=N-N%5;$=(M&(1<<ce)-1).toString(32),M>>=ce,N-=ce,Cs=1<<32-vo(y)+N|T<<N|M,pc=$+f}else Cs=1<<$|T<<N|M,pc=f}function Uh(f){f.return!==null&&(nu(f,1),ep(f,1,0))}function Yf(f){for(;f===Kd;)Kd=iu[--Vh],iu[Vh]=null,Jd=iu[--Vh],iu[Vh]=null;for(;f===rh;)rh=Es[--as],Es[as]=null,pc=Es[--as],Es[as]=null,Cs=Es[--as],Es[as]=null}var bo=null,Nn=null,un=!1,wl=null,Ta=!1,tp=Error(l(519));function mc(f){var y=Error(l(418,""));throw su(Sa(y,f)),tp}function Tm(f){var y=f.stateNode,T=f.type,M=f.memoizedProps;switch(y[te]=f,y[oe]=M,T){case"dialog":nn("cancel",y),nn("close",y);break;case"iframe":case"object":case"embed":nn("load",y);break;case"video":case"audio":for(T=0;T<Fp.length;T++)nn(Fp[T],y);break;case"source":nn("error",y);break;case"img":case"image":case"link":nn("error",y),nn("load",y);break;case"details":nn("toggle",y);break;case"input":nn("invalid",y),Ys(y,M.value,M.defaultValue,M.checked,M.defaultChecked,M.type,M.name,!0),Kl(y);break;case"select":nn("invalid",y);break;case"textarea":nn("invalid",y),xs(y,M.value,M.defaultValue,M.children),Kl(y)}T=M.children,typeof T!="string"&&typeof T!="number"&&typeof T!="bigint"||y.textContent===""+T||M.suppressHydrationWarning===!0||Np(y.textContent,T)?(M.popover!=null&&(nn("beforetoggle",y),nn("toggle",y)),M.onScroll!=null&&nn("scroll",y),M.onScrollEnd!=null&&nn("scrollend",y),M.onClick!=null&&(y.onclick=Jg),y=!0):y=!1,y||mc(f)}function ih(f){for(bo=f.return;bo;)switch(bo.tag){case 5:case 13:Ta=!1;return;case 27:case 3:Ta=!0;return;default:bo=bo.return}}function ou(f){if(f!==bo)return!1;if(!un)return ih(f),un=!0,!1;var y=f.tag,T;if((T=y!==3&&y!==27)&&((T=y===5)&&(T=f.type,T=!(T!=="form"&&T!=="button")||f0(f.type,f.memoizedProps)),T=!T),T&&Nn&&mc(f),ih(f),y===13){if(f=f.memoizedState,f=f!==null?f.dehydrated:null,!f)throw Error(l(317));e:{for(f=f.nextSibling,y=0;f;){if(f.nodeType===8)if(T=f.data,T==="/$"){if(y===0){Nn=us(f.nextSibling);break e}y--}else T!=="$"&&T!=="$!"&&T!=="$?"||y++;f=f.nextSibling}Nn=null}}else y===27?(y=Nn,Vl(f.type)?(f=i_,i_=null,Nn=f):Nn=y):Nn=bo?us(f.stateNode.nextSibling):null;return!0}function au(){Nn=bo=null,un=!1}function rp(){var f=wl;return f!==null&&(_i===null?_i=f:_i.push.apply(_i,f),wl=null),f}function su(f){wl===null?wl=[f]:wl.push(f)}var nh=Vt(null),lu=null,Sl=null;function gc(f,y,T){Rr(nh,y._currentValue),y._currentValue=T}function ua(f){f._currentValue=nh.current,Er(nh)}function ip(f,y,T){for(;f!==null;){var M=f.alternate;if((f.childLanes&y)!==y?(f.childLanes|=y,M!==null&&(M.childLanes|=y)):M!==null&&(M.childLanes&y)!==y&&(M.childLanes|=y),f===T)break;f=f.return}}function np(f,y,T,M){var N=f.child;for(N!==null&&(N.return=f);N!==null;){var $=N.dependencies;if($!==null){var ce=N.child;$=$.firstContext;e:for(;$!==null;){var Ae=$;$=N;for(var Ye=0;Ye<y.length;Ye++)if(Ae.context===y[Ye]){$.lanes|=T,Ae=$.alternate,Ae!==null&&(Ae.lanes|=T),ip($.return,T,f),M||(ce=null);break e}$=Ae.next}}else if(N.tag===18){if(ce=N.return,ce===null)throw Error(l(341));ce.lanes|=T,$=ce.alternate,$!==null&&($.lanes|=T),ip(ce,T,f),ce=null}else ce=N.child;if(ce!==null)ce.return=N;else for(ce=N;ce!==null;){if(ce===f){ce=null;break}if(N=ce.sibling,N!==null){N.return=ce.return,ce=N;break}ce=ce.return}N=ce}}function Qf(f,y,T,M){f=null;for(var N=y,$=!1;N!==null;){if(!$){if((N.flags&524288)!==0)$=!0;else if((N.flags&262144)!==0)break}if(N.tag===10){var ce=N.alternate;if(ce===null)throw Error(l(387));if(ce=ce.memoizedProps,ce!==null){var Ae=N.type;Ha(N.pendingProps.value,ce.value)||(f!==null?f.push(Ae):f=[Ae])}}else if(N===Vi.current){if(ce=N.alternate,ce===null)throw Error(l(387));ce.memoizedState.memoizedState!==N.memoizedState.memoizedState&&(f!==null?f.push(vf):f=[vf])}N=N.return}f!==null&&np(y,f,T,M),y.flags|=262144}function op(f){for(f=f.firstContext;f!==null;){if(!Ha(f.context._currentValue,f.memoizedValue))return!0;f=f.next}return!1}function _c(f){lu=f,Sl=null,f=f.dependencies,f!==null&&(f.firstContext=null)}function Oo(f){return yc(lu,f)}function oh(f,y){return lu===null&&_c(f),yc(f,y)}function yc(f,y){var T=y._currentValue;if(y={context:y,memoizedValue:T,next:null},Sl===null){if(f===null)throw Error(l(308));Sl=y,f.dependencies={lanes:0,firstContext:y},f.flags|=524288}else Sl=Sl.next=y;return T}var Am=typeof AbortController<"u"?AbortController:function(){var f=[],y=this.signal={aborted:!1,addEventListener:function(T,M){f.push(M)}};this.abort=function(){y.aborted=!0,f.forEach(function(T){return T()})}},Em=r.unstable_scheduleCallback,t0=r.unstable_NormalPriority,Zn={$$typeof:Pe,Consumer:null,Provider:null,_currentValue:null,_currentValue2:null,_threadCount:0};function vc(){return{controller:new Am,data:new Map,refCount:0}}function jh(f){f.refCount--,f.refCount===0&&Em(t0,function(){f.controller.abort()})}var ea=null,Gh=0,Tl=0,xc=null;function Cm(f,y){if(ea===null){var T=ea=[];Gh=0,Tl=Tu(),xc={status:"pending",value:void 0,then:function(M){T.push(M)}}}return Gh++,y.then(ap,ap),y}function ap(){if(--Gh===0&&ea!==null){xc!==null&&(xc.status="fulfilled");var f=ea;ea=null,Tl=0,xc=null;for(var y=0;y<f.length;y++)(0,f[y])()}}function sp(f,y){var T=[],M={status:"pending",value:null,reason:null,then:function(N){T.push(N)}};return f.then(function(){M.status="fulfilled",M.value=y;for(var N=0;N<T.length;N++)(0,T[N])(y)},function(N){for(M.status="rejected",M.reason=N,N=0;N<T.length;N++)(0,T[N])(void 0)}),M}var Hh=Ot.S;Ot.S=function(f,y){typeof y=="object"&&y!==null&&typeof y.then=="function"&&Cm(f,y),Hh!==null&&Hh(f,y)};var Is=Vt(null);function Kf(){var f=Is.current;return f!==null?f:at.pooledCache}function cu(f,y){y===null?Rr(Is,Is.current):Rr(Is,y.pool)}function lp(){var f=Kf();return f===null?null:{parent:Zn._currentValue,pool:f}}var qh=Error(l(460)),cp=Error(l(474)),Al=Error(l(542)),Im={then:function(){}};function Mg(f){return f=f.status,f==="fulfilled"||f==="rejected"}function up(){}function Jf(f,y,T){switch(T=f[T],T===void 0?f.push(y):T!==y&&(y.then(up,up),y=T),y.status){case"fulfilled":return y.value;case"rejected":throw f=y.reason,hp(f),f;default:if(typeof y.status=="string")y.then(up,up);else{if(f=at,f!==null&&100<f.shellSuspendCounter)throw Error(l(482));f=y,f.status="pending",f.then(function(M){if(y.status==="pending"){var N=y;N.status="fulfilled",N.value=M}},function(M){if(y.status==="pending"){var N=y;N.status="rejected",N.reason=M}})}switch(y.status){case"fulfilled":return y.value;case"rejected":throw f=y.reason,hp(f),f}throw ed=y,qh}}var ed=null;function Dg(){if(ed===null)throw Error(l(459));var f=ed;return ed=null,f}function hp(f){if(f===qh||f===Al)throw Error(l(483))}var El=!1;function td(f){f.updateQueue={baseState:f.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,lanes:0,hiddenCallbacks:null},callbacks:null}}function uu(f,y){f=f.updateQueue,y.updateQueue===f&&(y.updateQueue={baseState:f.baseState,firstBaseUpdate:f.firstBaseUpdate,lastBaseUpdate:f.lastBaseUpdate,shared:f.shared,callbacks:null})}function bc(f){return{lane:f,tag:0,payload:null,callback:null,next:null}}function Cl(f,y,T){var M=f.updateQueue;if(M===null)return null;if(M=M.shared,(je&2)!==0){var N=M.pending;return N===null?y.next=y:(y.next=N.next,N.next=y),M.pending=y,y=os(f),Nh(f,null,T),y}return hc(f,M,y,T),os(f)}function ah(f,y,T){if(y=y.updateQueue,y!==null&&(y=y.shared,(T&4194048)!==0)){var M=y.lanes;M&=f.pendingLanes,T|=M,y.lanes=T,Pf(f,T)}}function $h(f,y){var T=f.updateQueue,M=f.alternate;if(M!==null&&(M=M.updateQueue,T===M)){var N=null,$=null;if(T=T.firstBaseUpdate,T!==null){do{var ce={lane:T.lane,tag:T.tag,payload:T.payload,callback:null,next:null};$===null?N=$=ce:$=$.next=ce,T=T.next}while(T!==null);$===null?N=$=y:$=$.next=y}else N=$=y;T={baseState:M.baseState,firstBaseUpdate:N,lastBaseUpdate:$,shared:M.shared,callbacks:M.callbacks},f.updateQueue=T;return}f=T.lastBaseUpdate,f===null?T.firstBaseUpdate=y:f.next=y,T.lastBaseUpdate=y}var wc=!1;function Js(){if(wc){var f=xc;if(f!==null)throw f}}function Rs(f,y,T,M){wc=!1;var N=f.updateQueue;El=!1;var $=N.firstBaseUpdate,ce=N.lastBaseUpdate,Ae=N.shared.pending;if(Ae!==null){N.shared.pending=null;var Ye=Ae,Mt=Ye.next;Ye.next=null,ce===null?$=Mt:ce.next=Mt,ce=Ye;var Wt=f.alternate;Wt!==null&&(Wt=Wt.updateQueue,Ae=Wt.lastBaseUpdate,Ae!==ce&&(Ae===null?Wt.firstBaseUpdate=Mt:Ae.next=Mt,Wt.lastBaseUpdate=Ye))}if($!==null){var ir=N.baseState;ce=0,Wt=Mt=Ye=null,Ae=$;do{var zt=Ae.lane&-536870913,kt=zt!==Ae.lane;if(kt?(wt&zt)===zt:(M&zt)===zt){zt!==0&&zt===Tl&&(wc=!0),Wt!==null&&(Wt=Wt.next={lane:0,tag:Ae.tag,payload:Ae.payload,callback:null,next:null});e:{var xi=f,ni=Ae;zt=y;var wn=T;switch(ni.tag){case 1:if(xi=ni.payload,typeof xi=="function"){ir=xi.call(wn,ir,zt);break e}ir=xi;break e;case 3:xi.flags=xi.flags&-65537|128;case 0:if(xi=ni.payload,zt=typeof xi=="function"?xi.call(wn,ir,zt):xi,zt==null)break e;ir=L({},ir,zt);break e;case 2:El=!0}}zt=Ae.callback,zt!==null&&(f.flags|=64,kt&&(f.flags|=8192),kt=N.callbacks,kt===null?N.callbacks=[zt]:kt.push(zt))}else kt={lane:zt,tag:Ae.tag,payload:Ae.payload,callback:Ae.callback,next:null},Wt===null?(Mt=Wt=kt,Ye=ir):Wt=Wt.next=kt,ce|=zt;if(Ae=Ae.next,Ae===null){if(Ae=N.shared.pending,Ae===null)break;kt=Ae,Ae=kt.next,kt.next=null,N.lastBaseUpdate=kt,N.shared.pending=null}}while(!0);Wt===null&&(Ye=ir),N.baseState=Ye,N.firstBaseUpdate=Mt,N.lastBaseUpdate=Wt,$===null&&(N.shared.lanes=0),Mr|=ce,f.lanes=ce,f.memoizedState=ir}}function fp(f,y){if(typeof f!="function")throw Error(l(191,f));f.call(y)}function rd(f,y){var T=f.callbacks;if(T!==null)for(f.callbacks=null,f=0;f<T.length;f++)fp(T[f],y)}var hu=Vt(null),Xh=Vt(0);function id(f,y){f=Qt,Rr(Xh,f),Rr(hu,y),Qt=f|y.baseLanes}function Zh(){Rr(Xh,Qt),Rr(hu,hu.current)}function nd(){Qt=Xh.current,Er(hu),Er(Xh)}var el=0,Di=null,Pn=null,Vn=null,od=!1,Wh=!1,Il=!1,Yh=0,qa=0,Rl=null,fu=0;function ao(){throw Error(l(321))}function Qh(f,y){if(y===null)return!1;for(var T=0;T<y.length&&T<f.length;T++)if(!Ha(f[T],y[T]))return!1;return!0}function Kh(f,y,T,M,N,$){return el=$,Di=y,y.memoizedState=null,y.updateQueue=null,y.lanes=0,Ot.H=f===null||f.memoizedState===null?Yi:ei,Il=!1,$=T(M,N),Il=!1,Wh&&($=ad(y,T,M,N)),Jh(f),$}function Jh(f){Ot.H=Ic;var y=Pn!==null&&Pn.next!==null;if(el=0,Vn=Pn=Di=null,od=!1,qa=0,Rl=null,y)throw Error(l(300));f===null||so||(f=f.dependencies,f!==null&&op(f)&&(so=!0))}function ad(f,y,T,M){Di=f;var N=0;do{if(Wh&&(Rl=null),qa=0,Wh=!1,25<=N)throw Error(l(301));if(N+=1,Vn=Pn=null,f.updateQueue!=null){var $=f.updateQueue;$.lastEffect=null,$.events=null,$.stores=null,$.memoCache!=null&&($.memoCache.index=0)}Ot.H=Ng,$=y(T,M)}while(Wh);return $}function Og(){var f=Ot.H,y=f.useState()[0];return y=typeof y.then=="function"?Ms(y):y,f=f.useState()[0],(Pn!==null?Pn.memoizedState:null)!==f&&(Di.flags|=1024),y}function Sc(){var f=Yh!==0;return Yh=0,f}function du(f,y,T){y.updateQueue=f.updateQueue,y.flags&=-2053,f.lanes&=~T}function $t(f){if(od){for(f=f.memoizedState;f!==null;){var y=f.queue;y!==null&&(y.pending=null),f=f.next}od=!1}el=0,Vn=Pn=Di=null,Wh=!1,qa=Yh=0,Rl=null}function ha(){var f={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return Vn===null?Di.memoizedState=Vn=f:Vn=Vn.next=f,Vn}function Ln(){if(Pn===null){var f=Di.alternate;f=f!==null?f.memoizedState:null}else f=Pn.next;var y=Vn===null?Di.memoizedState:Vn.next;if(y!==null)Vn=y,Pn=f;else{if(f===null)throw Di.alternate===null?Error(l(467)):Error(l(310));Pn=f,f={memoizedState:Pn.memoizedState,baseState:Pn.baseState,baseQueue:Pn.baseQueue,queue:Pn.queue,next:null},Vn===null?Di.memoizedState=Vn=f:Vn=Vn.next=f}return Vn}function Ml(){return{lastEffect:null,events:null,stores:null,memoCache:null}}function Ms(f){var y=qa;return qa+=1,Rl===null&&(Rl=[]),f=Jf(Rl,f,y),y=Di,(Vn===null?y.memoizedState:Vn.next)===null&&(y=y.alternate,Ot.H=y===null||y.memoizedState===null?Yi:ei),f}function _r(f){if(f!==null&&typeof f=="object"){if(typeof f.then=="function")return Ms(f);if(f.$$typeof===Pe)return Oo(f)}throw Error(l(438,String(f)))}function sd(f){var y=null,T=Di.updateQueue;if(T!==null&&(y=T.memoCache),y==null){var M=Di.alternate;M!==null&&(M=M.updateQueue,M!==null&&(M=M.memoCache,M!=null&&(y={data:M.data.map(function(N){return N.slice()}),index:0})))}if(y==null&&(y={data:[],index:0}),T===null&&(T=Ml(),Di.updateQueue=T),T.memoCache=y,T=y.data[y.index],T===void 0)for(T=y.data[y.index]=Array(f),M=0;M<f;M++)T[M]=hr;return y.index++,T}function Dl(f,y){return typeof y=="function"?y(f):y}function sh(f){var y=Ln();return ef(y,Pn,f)}function ef(f,y,T){var M=f.queue;if(M===null)throw Error(l(311));M.lastRenderedReducer=T;var N=f.baseQueue,$=M.pending;if($!==null){if(N!==null){var ce=N.next;N.next=$.next,$.next=ce}y.baseQueue=N=$,M.pending=null}if($=f.baseState,N===null)f.memoizedState=$;else{y=N.next;var Ae=ce=null,Ye=null,Mt=y,Wt=!1;do{var ir=Mt.lane&-536870913;if(ir!==Mt.lane?(wt&ir)===ir:(el&ir)===ir){var zt=Mt.revertLane;if(zt===0)Ye!==null&&(Ye=Ye.next={lane:0,revertLane:0,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null}),ir===Tl&&(Wt=!0);else if((el&zt)===zt){Mt=Mt.next,zt===Tl&&(Wt=!0);continue}else ir={lane:0,revertLane:Mt.revertLane,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null},Ye===null?(Ae=Ye=ir,ce=$):Ye=Ye.next=ir,Di.lanes|=zt,Mr|=zt;ir=Mt.action,Il&&T($,ir),$=Mt.hasEagerState?Mt.eagerState:T($,ir)}else zt={lane:ir,revertLane:Mt.revertLane,action:Mt.action,hasEagerState:Mt.hasEagerState,eagerState:Mt.eagerState,next:null},Ye===null?(Ae=Ye=zt,ce=$):Ye=Ye.next=zt,Di.lanes|=ir,Mr|=ir;Mt=Mt.next}while(Mt!==null&&Mt!==y);if(Ye===null?ce=$:Ye.next=Ae,!Ha($,f.memoizedState)&&(so=!0,Wt&&(T=xc,T!==null)))throw T;f.memoizedState=$,f.baseState=ce,f.baseQueue=Ye,M.lastRenderedState=$}return N===null&&(M.lanes=0),[f.memoizedState,M.dispatch]}function tf(f){var y=Ln(),T=y.queue;if(T===null)throw Error(l(311));T.lastRenderedReducer=f;var M=T.dispatch,N=T.pending,$=y.memoizedState;if(N!==null){T.pending=null;var ce=N=N.next;do $=f($,ce.action),ce=ce.next;while(ce!==N);Ha($,y.memoizedState)||(so=!0),y.memoizedState=$,y.baseQueue===null&&(y.baseState=$),T.lastRenderedState=$}return[$,M]}function Pg(f,y,T){var M=Di,N=Ln(),$=un;if($){if(T===void 0)throw Error(l(407));T=T()}else T=y();var ce=!Ha((Pn||N).memoizedState,T);ce&&(N.memoizedState=T,so=!0),N=N.queue;var Ae=Bg.bind(null,M,N,f);if(Ut(2048,8,Ae,[f]),N.getSnapshot!==y||ce||Vn!==null&&Vn.memoizedState.tag&1){if(M.flags|=2048,Ds(9,Ol(),Lg.bind(null,M,N,T,y),null),at===null)throw Error(l(349));$||(el&124)!==0||Rm(M,y,T)}return T}function Rm(f,y,T){f.flags|=16384,f={getSnapshot:y,value:T},y=Di.updateQueue,y===null?(y=Ml(),Di.updateQueue=y,y.stores=[f]):(T=y.stores,T===null?y.stores=[f]:T.push(f))}function Lg(f,y,T,M){y.value=T,y.getSnapshot=M,Aa(y)&&dp(f)}function Bg(f,y,T){return T(function(){Aa(y)&&dp(f)})}function Aa(f){var y=f.getSnapshot;f=f.value;try{var T=y();return!Ha(f,T)}catch{return!0}}function dp(f){var y=bl(f,2);y!==null&&Wn(y,f,2)}function jo(f){var y=ha();if(typeof f=="function"){var T=f;if(f=T(),Il){ys(!0);try{T()}finally{ys(!1)}}}return y.memoizedState=y.baseState=f,y.queue={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dl,lastRenderedState:f},y}function Tc(f,y,T,M){return f.baseState=T,ef(f,Pn,typeof M=="function"?M:Dl)}function zg(f,y,T,M,N){if(dd(f))throw Error(l(485));if(f=y.action,f!==null){var $={payload:N,action:f,next:null,isTransition:!0,status:"pending",value:null,reason:null,listeners:[],then:function(ce){$.listeners.push(ce)}};Ot.T!==null?T(!0):$.isTransition=!1,M($),T=y.pending,T===null?($.next=y.pending=$,pp(y,$)):($.next=T.next,y.pending=T.next=$)}}function pp(f,y){var T=y.action,M=y.payload,N=f.state;if(y.isTransition){var $=Ot.T,ce={};Ot.T=ce;try{var Ae=T(N,M),Ye=Ot.S;Ye!==null&&Ye(ce,Ae),mp(f,y,Ae)}catch(Mt){Ac(f,y,Mt)}finally{Ot.T=$}}else try{$=T(N,M),mp(f,y,$)}catch(Mt){Ac(f,y,Mt)}}function mp(f,y,T){T!==null&&typeof T=="object"&&typeof T.then=="function"?T.then(function(M){ld(f,y,M)},function(M){return Ac(f,y,M)}):ld(f,y,T)}function ld(f,y,T){y.status="fulfilled",y.value=T,tl(y),f.state=T,y=f.pending,y!==null&&(T=y.next,T===y?f.pending=null:(T=T.next,y.next=T,pp(f,T)))}function Ac(f,y,T){var M=f.pending;if(f.pending=null,M!==null){M=M.next;do y.status="rejected",y.reason=T,tl(y),y=y.next;while(y!==M)}f.action=null}function tl(f){f=f.listeners;for(var y=0;y<f.length;y++)(0,f[y])()}function Hi(f,y){return y}function pu(f,y){if(un){var T=at.formState;if(T!==null){e:{var M=Di;if(un){if(Nn){t:{for(var N=Nn,$=Ta;N.nodeType!==8;){if(!$){N=null;break t}if(N=us(N.nextSibling),N===null){N=null;break t}}$=N.data,N=$==="F!"||$==="F"?N:null}if(N){Nn=us(N.nextSibling),M=N.data==="F!";break e}}mc(M)}M=!1}M&&(y=T[0])}}return T=ha(),T.memoizedState=T.baseState=y,M={pending:null,lanes:0,dispatch:null,lastRenderedReducer:Hi,lastRenderedState:y},T.queue=M,T=Bm.bind(null,Di,M),M.dispatch=T,M=jo(!1),$=xp.bind(null,Di,!1,M.queue),M=ha(),N={state:y,dispatch:null,action:f,pending:null},M.queue=N,T=zg.bind(null,Di,N,$,T),N.dispatch=T,M.memoizedState=f,[y,T,!1]}function gp(f){var y=Ln();return Mm(y,Pn,f)}function Mm(f,y,T){if(y=ef(f,y,Hi)[0],f=sh(Dl)[0],typeof y=="object"&&y!==null&&typeof y.then=="function")try{var M=Ms(y)}catch(ce){throw ce===qh?Al:ce}else M=y;y=Ln();var N=y.queue,$=N.dispatch;return T!==y.memoizedState&&(Di.flags|=2048,Ds(9,Ol(),Ec.bind(null,N,T),null)),[M,$,f]}function Ec(f,y){f.action=y}function _p(f){var y=Ln(),T=Pn;if(T!==null)return Mm(y,T,f);Ln(),y=y.memoizedState,T=Ln();var M=T.queue.dispatch;return T.memoizedState=f,[y,M,!1]}function Ds(f,y,T,M){return f={tag:f,create:T,deps:M,inst:y,next:null},y=Di.updateQueue,y===null&&(y=Ml(),Di.updateQueue=y),T=y.lastEffect,T===null?y.lastEffect=f.next=f:(M=T.next,T.next=f,f.next=M,y.lastEffect=f),f}function Ol(){return{destroy:void 0,resource:void 0}}function mu(){return Ln().memoizedState}function At(f,y,T,M){var N=ha();M=M===void 0?null:M,Di.flags|=f,N.memoizedState=Ds(1|y,Ol(),T,M)}function Ut(f,y,T,M){var N=Ln();M=M===void 0?null:M;var $=N.memoizedState.inst;Pn!==null&&M!==null&&Qh(M,Pn.memoizedState.deps)?N.memoizedState=Ds(y,$,T,M):(Di.flags|=f,N.memoizedState=Ds(1|y,$,T,M))}function lh(f,y){At(8390656,8,f,y)}function yn(f,y){Ut(2048,8,f,y)}function Ve(f,y){return Ut(4,2,f,y)}function cd(f,y){return Ut(4,4,f,y)}function gu(f,y){if(typeof y=="function"){f=f();var T=y(f);return function(){typeof T=="function"?T():y(null)}}if(y!=null)return f=f(),y.current=f,function(){y.current=null}}function ud(f,y,T){T=T!=null?T.concat([f]):null,Ut(4,4,gu.bind(null,y,f),T)}function ch(){}function Dm(f,y){var T=Ln();y=y===void 0?null:y;var M=T.memoizedState;return y!==null&&Qh(y,M[1])?M[0]:(T.memoizedState=[f,y],f)}function Os(f,y){var T=Ln();y=y===void 0?null:y;var M=T.memoizedState;if(y!==null&&Qh(y,M[1]))return M[0];if(M=f(),Il){ys(!0);try{f()}finally{ys(!1)}}return T.memoizedState=[M,y],M}function _u(f,y,T){return T===void 0||(el&1073741824)!==0?f.memoizedState=y:(f.memoizedState=T,f=$a(),Di.lanes|=f,Mr|=f,T)}function Om(f,y,T,M){return Ha(T,y)?T:hu.current!==null?(f=_u(f,T,M),Ha(f,y)||(so=!0),f):(el&42)===0?(so=!0,f.memoizedState=T):(f=$a(),Di.lanes|=f,Mr|=f,y)}function Fg(f,y,T,M,N){var $=sr.p;sr.p=$!==0&&8>$?$:8;var ce=Ot.T,Ae={};Ot.T=Ae,xp(f,!1,y,T);try{var Ye=N(),Mt=Ot.S;if(Mt!==null&&Mt(Ae,Ye),Ye!==null&&typeof Ye=="object"&&typeof Ye.then=="function"){var Wt=sp(Ye,M);fd(f,y,Wt,xn(f))}else fd(f,y,M,xn(f))}catch(ir){fd(f,y,{then:function(){},status:"rejected",reason:ir},xn())}finally{sr.p=$,Ot.T=ce}}function kg(){}function rf(f,y,T,M){if(f.tag!==5)throw Error(l(476));var N=yp(f).queue;Fg(f,N,y,Fr,T===null?kg:function(){return Pm(f),T(M)})}function yp(f){var y=f.memoizedState;if(y!==null)return y;y={memoizedState:Fr,baseState:Fr,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dl,lastRenderedState:Fr},next:null};var T={};return y.next={memoizedState:T,baseState:T,baseQueue:null,queue:{pending:null,lanes:0,dispatch:null,lastRenderedReducer:Dl,lastRenderedState:T},next:null},f.memoizedState=y,f=f.alternate,f!==null&&(f.memoizedState=y),y}function Pm(f){var y=yp(f).next.queue;fd(f,y,{},xn())}function vp(){return Oo(vf)}function hd(){return Ln().memoizedState}function nf(){return Ln().memoizedState}function of(f){for(var y=f.return;y!==null;){switch(y.tag){case 24:case 3:var T=xn();f=bc(T);var M=Cl(y,f,T);M!==null&&(Wn(M,y,T),ah(M,y,T)),y={cache:vc()},f.payload=y;return}y=y.return}}function Lm(f,y,T){var M=xn();T={lane:M,revertLane:0,action:T,hasEagerState:!1,eagerState:null,next:null},dd(f)?Go(y,T):(T=tu(f,y,T,M),T!==null&&(Wn(T,f,M),Cc(T,y,M)))}function Bm(f,y,T){var M=xn();fd(f,y,T,M)}function fd(f,y,T,M){var N={lane:M,revertLane:0,action:T,hasEagerState:!1,eagerState:null,next:null};if(dd(f))Go(y,N);else{var $=f.alternate;if(f.lanes===0&&($===null||$.lanes===0)&&($=y.lastRenderedReducer,$!==null))try{var ce=y.lastRenderedState,Ae=$(ce,T);if(N.hasEagerState=!0,N.eagerState=Ae,Ha(Ae,ce))return hc(f,y,N,0),at===null&&kh(),!1}catch{}finally{}if(T=tu(f,y,N,M),T!==null)return Wn(T,f,M),Cc(T,y,M),!0}return!1}function xp(f,y,T,M){if(M={lane:2,revertLane:Tu(),action:M,hasEagerState:!1,eagerState:null,next:null},dd(f)){if(y)throw Error(l(479))}else y=tu(f,T,M,2),y!==null&&Wn(y,f,2)}function dd(f){var y=f.alternate;return f===Di||y!==null&&y===Di}function Go(f,y){Wh=od=!0;var T=f.pending;T===null?y.next=y:(y.next=T.next,T.next=y),f.pending=y}function Cc(f,y,T){if((T&4194048)!==0){var M=y.lanes;M&=f.pendingLanes,T|=M,y.lanes=T,Pf(f,T)}}var Ic={readContext:Oo,use:_r,useCallback:ao,useContext:ao,useEffect:ao,useImperativeHandle:ao,useLayoutEffect:ao,useInsertionEffect:ao,useMemo:ao,useReducer:ao,useRef:ao,useState:ao,useDebugValue:ao,useDeferredValue:ao,useTransition:ao,useSyncExternalStore:ao,useId:ao,useHostTransitionStatus:ao,useFormState:ao,useActionState:ao,useOptimistic:ao,useMemoCache:ao,useCacheRefresh:ao},Yi={readContext:Oo,use:_r,useCallback:function(f,y){return ha().memoizedState=[f,y===void 0?null:y],f},useContext:Oo,useEffect:lh,useImperativeHandle:function(f,y,T){T=T!=null?T.concat([f]):null,At(4194308,4,gu.bind(null,y,f),T)},useLayoutEffect:function(f,y){return At(4194308,4,f,y)},useInsertionEffect:function(f,y){At(4,2,f,y)},useMemo:function(f,y){var T=ha();y=y===void 0?null:y;var M=f();if(Il){ys(!0);try{f()}finally{ys(!1)}}return T.memoizedState=[M,y],M},useReducer:function(f,y,T){var M=ha();if(T!==void 0){var N=T(y);if(Il){ys(!0);try{T(y)}finally{ys(!1)}}}else N=y;return M.memoizedState=M.baseState=N,f={pending:null,lanes:0,dispatch:null,lastRenderedReducer:f,lastRenderedState:N},M.queue=f,f=f.dispatch=Lm.bind(null,Di,f),[M.memoizedState,f]},useRef:function(f){var y=ha();return f={current:f},y.memoizedState=f},useState:function(f){f=jo(f);var y=f.queue,T=Bm.bind(null,Di,y);return y.dispatch=T,[f.memoizedState,T]},useDebugValue:ch,useDeferredValue:function(f,y){var T=ha();return _u(T,f,y)},useTransition:function(){var f=jo(!1);return f=Fg.bind(null,Di,f.queue,!0,!1),ha().memoizedState=f,[!1,f]},useSyncExternalStore:function(f,y,T){var M=Di,N=ha();if(un){if(T===void 0)throw Error(l(407));T=T()}else{if(T=y(),at===null)throw Error(l(349));(wt&124)!==0||Rm(M,y,T)}N.memoizedState=T;var $={value:T,getSnapshot:y};return N.queue=$,lh(Bg.bind(null,M,$,f),[f]),M.flags|=2048,Ds(9,Ol(),Lg.bind(null,M,$,T,y),null),T},useId:function(){var f=ha(),y=at.identifierPrefix;if(un){var T=pc,M=Cs;T=(M&~(1<<32-vo(M)-1)).toString(32)+T,y="«"+y+"R"+T,T=Yh++,0<T&&(y+="H"+T.toString(32)),y+="»"}else T=fu++,y="«"+y+"r"+T.toString(32)+"»";return f.memoizedState=y},useHostTransitionStatus:vp,useFormState:pu,useActionState:pu,useOptimistic:function(f){var y=ha();y.memoizedState=y.baseState=f;var T={pending:null,lanes:0,dispatch:null,lastRenderedReducer:null,lastRenderedState:null};return y.queue=T,y=xp.bind(null,Di,!0,T),T.dispatch=y,[f,y]},useMemoCache:sd,useCacheRefresh:function(){return ha().memoizedState=of.bind(null,Di)}},ei={readContext:Oo,use:_r,useCallback:Dm,useContext:Oo,useEffect:yn,useImperativeHandle:ud,useInsertionEffect:Ve,useLayoutEffect:cd,useMemo:Os,useReducer:sh,useRef:mu,useState:function(){return sh(Dl)},useDebugValue:ch,useDeferredValue:function(f,y){var T=Ln();return Om(T,Pn.memoizedState,f,y)},useTransition:function(){var f=sh(Dl)[0],y=Ln().memoizedState;return[typeof f=="boolean"?f:Ms(f),y]},useSyncExternalStore:Pg,useId:hd,useHostTransitionStatus:vp,useFormState:gp,useActionState:gp,useOptimistic:function(f,y){var T=Ln();return Tc(T,Pn,f,y)},useMemoCache:sd,useCacheRefresh:nf},Ng={readContext:Oo,use:_r,useCallback:Dm,useContext:Oo,useEffect:yn,useImperativeHandle:ud,useInsertionEffect:Ve,useLayoutEffect:cd,useMemo:Os,useReducer:tf,useRef:mu,useState:function(){return tf(Dl)},useDebugValue:ch,useDeferredValue:function(f,y){var T=Ln();return Pn===null?_u(T,f,y):Om(T,Pn.memoizedState,f,y)},useTransition:function(){var f=tf(Dl)[0],y=Ln().memoizedState;return[typeof f=="boolean"?f:Ms(f),y]},useSyncExternalStore:Pg,useId:hd,useHostTransitionStatus:vp,useFormState:_p,useActionState:_p,useOptimistic:function(f,y){var T=Ln();return Pn!==null?Tc(T,Pn,f,y):(T.baseState=f,[f,T.queue.dispatch])},useMemoCache:sd,useCacheRefresh:nf},ss=null,rl=0;function Pl(f){var y=rl;return rl+=1,ss===null&&(ss=[]),Jf(ss,f,y)}function Ps(f,y){y=y.props.ref,f.ref=y!==void 0?y:null}function af(f,y){throw y.$$typeof===U?Error(l(525)):(f=Object.prototype.toString.call(y),Error(l(31,f==="[object Object]"?"object with keys {"+Object.keys(y).join(", ")+"}":f)))}function pd(f){var y=f._init;return y(f._payload)}function bp(f){function y(mt,st){if(f){var bt=mt.deletions;bt===null?(mt.deletions=[st],mt.flags|=16):bt.push(st)}}function T(mt,st){if(!f)return null;for(;st!==null;)y(mt,st),st=st.sibling;return null}function M(mt){for(var st=new Map;mt!==null;)mt.key!==null?st.set(mt.key,mt):st.set(mt.index,mt),mt=mt.sibling;return st}function N(mt,st){return mt=dc(mt,st),mt.index=0,mt.sibling=null,mt}function $(mt,st,bt){return mt.index=bt,f?(bt=mt.alternate,bt!==null?(bt=bt.index,bt<st?(mt.flags|=67108866,st):bt):(mt.flags|=67108866,st)):(mt.flags|=1048576,st)}function ce(mt){return f&&mt.alternate===null&&(mt.flags|=67108866),mt}function Ae(mt,st,bt,Jt){return st===null||st.tag!==6?(st=tn(bt,mt.mode,Jt),st.return=mt,st):(st=N(st,bt),st.return=mt,st)}function Ye(mt,st,bt,Jt){var Ur=bt.type;return Ur===ie?Wt(mt,st,bt.props.children,Jt,bt.key):st!==null&&(st.elementType===Ur||typeof Ur=="object"&&Ur!==null&&Ur.$$typeof===Ft&&pd(Ur)===st.type)?(st=N(st,bt.props),Ps(st,bt),st.return=mt,st):(st=eh(bt.type,bt.key,bt.props,null,mt.mode,Jt),Ps(st,bt),st.return=mt,st)}function Mt(mt,st,bt,Jt){return st===null||st.tag!==4||st.stateNode.containerInfo!==bt.containerInfo||st.stateNode.implementation!==bt.implementation?(st=Qd(bt,mt.mode,Jt),st.return=mt,st):(st=N(st,bt.children||[]),st.return=mt,st)}function Wt(mt,st,bt,Jt,Ur){return st===null||st.tag!==7?(st=th(bt,mt.mode,Jt,Ur),st.return=mt,st):(st=N(st,bt),st.return=mt,st)}function ir(mt,st,bt){if(typeof st=="string"&&st!==""||typeof st=="number"||typeof st=="bigint")return st=tn(""+st,mt.mode,bt),st.return=mt,st;if(typeof st=="object"&&st!==null){switch(st.$$typeof){case q:return bt=eh(st.type,st.key,st.props,null,mt.mode,bt),Ps(bt,st),bt.return=mt,bt;case Z:return st=Qd(st,mt.mode,bt),st.return=mt,st;case Ft:var Jt=st._init;return st=Jt(st._payload),ir(mt,st,bt)}if(Qr(st)||Kr(st))return st=th(st,mt.mode,bt,null),st.return=mt,st;if(typeof st.then=="function")return ir(mt,Pl(st),bt);if(st.$$typeof===Pe)return ir(mt,oh(mt,st),bt);af(mt,st)}return null}function zt(mt,st,bt,Jt){var Ur=st!==null?st.key:null;if(typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint")return Ur!==null?null:Ae(mt,st,""+bt,Jt);if(typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case q:return bt.key===Ur?Ye(mt,st,bt,Jt):null;case Z:return bt.key===Ur?Mt(mt,st,bt,Jt):null;case Ft:return Ur=bt._init,bt=Ur(bt._payload),zt(mt,st,bt,Jt)}if(Qr(bt)||Kr(bt))return Ur!==null?null:Wt(mt,st,bt,Jt,null);if(typeof bt.then=="function")return zt(mt,st,Pl(bt),Jt);if(bt.$$typeof===Pe)return zt(mt,st,oh(mt,bt),Jt);af(mt,bt)}return null}function kt(mt,st,bt,Jt,Ur){if(typeof Jt=="string"&&Jt!==""||typeof Jt=="number"||typeof Jt=="bigint")return mt=mt.get(bt)||null,Ae(st,mt,""+Jt,Ur);if(typeof Jt=="object"&&Jt!==null){switch(Jt.$$typeof){case q:return mt=mt.get(Jt.key===null?bt:Jt.key)||null,Ye(st,mt,Jt,Ur);case Z:return mt=mt.get(Jt.key===null?bt:Jt.key)||null,Mt(st,mt,Jt,Ur);case Ft:var Zi=Jt._init;return Jt=Zi(Jt._payload),kt(mt,st,bt,Jt,Ur)}if(Qr(Jt)||Kr(Jt))return mt=mt.get(bt)||null,Wt(st,mt,Jt,Ur,null);if(typeof Jt.then=="function")return kt(mt,st,bt,Pl(Jt),Ur);if(Jt.$$typeof===Pe)return kt(mt,st,bt,oh(st,Jt),Ur);af(st,Jt)}return null}function xi(mt,st,bt,Jt){for(var Ur=null,Zi=null,Gr=st,si=st=0,qo=null;Gr!==null&&si<bt.length;si++){Gr.index>si?(qo=Gr,Gr=null):qo=Gr.sibling;var on=zt(mt,Gr,bt[si],Jt);if(on===null){Gr===null&&(Gr=qo);break}f&&Gr&&on.alternate===null&&y(mt,Gr),st=$(on,st,si),Zi===null?Ur=on:Zi.sibling=on,Zi=on,Gr=qo}if(si===bt.length)return T(mt,Gr),un&&nu(mt,si),Ur;if(Gr===null){for(;si<bt.length;si++)Gr=ir(mt,bt[si],Jt),Gr!==null&&(st=$(Gr,st,si),Zi===null?Ur=Gr:Zi.sibling=Gr,Zi=Gr);return un&&nu(mt,si),Ur}for(Gr=M(Gr);si<bt.length;si++)qo=kt(Gr,mt,si,bt[si],Jt),qo!==null&&(f&&qo.alternate!==null&&Gr.delete(qo.key===null?si:qo.key),st=$(qo,st,si),Zi===null?Ur=qo:Zi.sibling=qo,Zi=qo);return f&&Gr.forEach(function(cl){return y(mt,cl)}),un&&nu(mt,si),Ur}function ni(mt,st,bt,Jt){if(bt==null)throw Error(l(151));for(var Ur=null,Zi=null,Gr=st,si=st=0,qo=null,on=bt.next();Gr!==null&&!on.done;si++,on=bt.next()){Gr.index>si?(qo=Gr,Gr=null):qo=Gr.sibling;var cl=zt(mt,Gr,on.value,Jt);if(cl===null){Gr===null&&(Gr=qo);break}f&&Gr&&cl.alternate===null&&y(mt,Gr),st=$(cl,st,si),Zi===null?Ur=cl:Zi.sibling=cl,Zi=cl,Gr=qo}if(on.done)return T(mt,Gr),un&&nu(mt,si),Ur;if(Gr===null){for(;!on.done;si++,on=bt.next())on=ir(mt,on.value,Jt),on!==null&&(st=$(on,st,si),Zi===null?Ur=on:Zi.sibling=on,Zi=on);return un&&nu(mt,si),Ur}for(Gr=M(Gr);!on.done;si++,on=bt.next())on=kt(Gr,mt,si,on.value,Jt),on!==null&&(f&&on.alternate!==null&&Gr.delete(on.key===null?si:on.key),st=$(on,st,si),Zi===null?Ur=on:Zi.sibling=on,Zi=on);return f&&Gr.forEach(function(m1){return y(mt,m1)}),un&&nu(mt,si),Ur}function wn(mt,st,bt,Jt){if(typeof bt=="object"&&bt!==null&&bt.type===ie&&bt.key===null&&(bt=bt.props.children),typeof bt=="object"&&bt!==null){switch(bt.$$typeof){case q:e:{for(var Ur=bt.key;st!==null;){if(st.key===Ur){if(Ur=bt.type,Ur===ie){if(st.tag===7){T(mt,st.sibling),Jt=N(st,bt.props.children),Jt.return=mt,mt=Jt;break e}}else if(st.elementType===Ur||typeof Ur=="object"&&Ur!==null&&Ur.$$typeof===Ft&&pd(Ur)===st.type){T(mt,st.sibling),Jt=N(st,bt.props),Ps(Jt,bt),Jt.return=mt,mt=Jt;break e}T(mt,st);break}else y(mt,st);st=st.sibling}bt.type===ie?(Jt=th(bt.props.children,mt.mode,Jt,bt.key),Jt.return=mt,mt=Jt):(Jt=eh(bt.type,bt.key,bt.props,null,mt.mode,Jt),Ps(Jt,bt),Jt.return=mt,mt=Jt)}return ce(mt);case Z:e:{for(Ur=bt.key;st!==null;){if(st.key===Ur)if(st.tag===4&&st.stateNode.containerInfo===bt.containerInfo&&st.stateNode.implementation===bt.implementation){T(mt,st.sibling),Jt=N(st,bt.children||[]),Jt.return=mt,mt=Jt;break e}else{T(mt,st);break}else y(mt,st);st=st.sibling}Jt=Qd(bt,mt.mode,Jt),Jt.return=mt,mt=Jt}return ce(mt);case Ft:return Ur=bt._init,bt=Ur(bt._payload),wn(mt,st,bt,Jt)}if(Qr(bt))return xi(mt,st,bt,Jt);if(Kr(bt)){if(Ur=Kr(bt),typeof Ur!="function")throw Error(l(150));return bt=Ur.call(bt),ni(mt,st,bt,Jt)}if(typeof bt.then=="function")return wn(mt,st,Pl(bt),Jt);if(bt.$$typeof===Pe)return wn(mt,st,oh(mt,bt),Jt);af(mt,bt)}return typeof bt=="string"&&bt!==""||typeof bt=="number"||typeof bt=="bigint"?(bt=""+bt,st!==null&&st.tag===6?(T(mt,st.sibling),Jt=N(st,bt),Jt.return=mt,mt=Jt):(T(mt,st),Jt=tn(bt,mt.mode,Jt),Jt.return=mt,mt=Jt),ce(mt)):T(mt,st)}return function(mt,st,bt,Jt){try{rl=0;var Ur=wn(mt,st,bt,Jt);return ss=null,Ur}catch(Gr){if(Gr===qh||Gr===Al)throw Gr;var Zi=Nr(29,Gr,null,mt.mode);return Zi.lanes=Jt,Zi.return=mt,Zi}finally{}}}var Rc=bp(!0),fa=bp(!1),Po=Vt(null),Ea=null;function il(f){var y=f.alternate;Rr(no,no.current&1),Rr(Po,f),Ea===null&&(y===null||hu.current!==null||y.memoizedState!==null)&&(Ea=f)}function wp(f){if(f.tag===22){if(Rr(no,no.current),Rr(Po,f),Ea===null){var y=f.alternate;y!==null&&y.memoizedState!==null&&(Ea=f)}}else Ll()}function Ll(){Rr(no,no.current),Rr(Po,Po.current)}function Lo(f){Er(Po),Ea===f&&(Ea=null),Er(no)}var no=Vt(0);function Un(f){for(var y=f;y!==null;){if(y.tag===13){var T=y.memoizedState;if(T!==null&&(T=T.dehydrated,T===null||T.data==="$?"||jp(T)))return y}else if(y.tag===19&&y.memoizedProps.revealOrder!==void 0){if((y.flags&128)!==0)return y}else if(y.child!==null){y.child.return=y,y=y.child;continue}if(y===f)break;for(;y.sibling===null;){if(y.return===null||y.return===f)return null;y=y.return}y.sibling.return=y.return,y=y.sibling}return null}function yu(f,y,T,M){y=f.memoizedState,T=T(M,y),T=T==null?y:L({},y,T),f.memoizedState=T,f.lanes===0&&(f.updateQueue.baseState=T)}var sf={enqueueSetState:function(f,y,T){f=f._reactInternals;var M=xn(),N=bc(M);N.payload=y,T!=null&&(N.callback=T),y=Cl(f,N,M),y!==null&&(Wn(y,f,M),ah(y,f,M))},enqueueReplaceState:function(f,y,T){f=f._reactInternals;var M=xn(),N=bc(M);N.tag=1,N.payload=y,T!=null&&(N.callback=T),y=Cl(f,N,M),y!==null&&(Wn(y,f,M),ah(y,f,M))},enqueueForceUpdate:function(f,y){f=f._reactInternals;var T=xn(),M=bc(T);M.tag=2,y!=null&&(M.callback=y),y=Cl(f,M,T),y!==null&&(Wn(y,f,T),ah(y,f,T))}};function Sp(f,y,T,M,N,$,ce){return f=f.stateNode,typeof f.shouldComponentUpdate=="function"?f.shouldComponentUpdate(M,$,ce):y.prototype&&y.prototype.isPureReactComponent?!cc(T,M)||!cc(N,$):!0}function Tp(f,y,T,M){f=y.state,typeof y.componentWillReceiveProps=="function"&&y.componentWillReceiveProps(T,M),typeof y.UNSAFE_componentWillReceiveProps=="function"&&y.UNSAFE_componentWillReceiveProps(T,M),y.state!==f&&sf.enqueueReplaceState(y,y.state,null)}function Cn(f,y){var T=y;if("ref"in y){T={};for(var M in y)M!=="ref"&&(T[M]=y[M])}if(f=f.defaultProps){T===y&&(T=L({},T));for(var N in f)T[N]===void 0&&(T[N]=f[N])}return T}var vu=typeof reportError=="function"?reportError:function(f){if(typeof window=="object"&&typeof window.ErrorEvent=="function"){var y=new window.ErrorEvent("error",{bubbles:!0,cancelable:!0,message:typeof f=="object"&&f!==null&&typeof f.message=="string"?String(f.message):String(f),error:f});if(!window.dispatchEvent(y))return}else if(typeof process=="object"&&typeof process.emit=="function"){process.emit("uncaughtException",f);return}console.error(f)};function Ap(f){vu(f)}function lf(f){console.error(f)}function xu(f){vu(f)}function cf(f,y){try{var T=f.onUncaughtError;T(y.value,{componentStack:y.stack})}catch(M){setTimeout(function(){throw M})}}function md(f,y,T){try{var M=f.onCaughtError;M(T.value,{componentStack:T.stack,errorBoundary:y.tag===1?y.stateNode:null})}catch(N){setTimeout(function(){throw N})}}function uh(f,y,T){return T=bc(T),T.tag=3,T.payload={element:null},T.callback=function(){cf(f,y)},T}function hh(f){return f=bc(f),f.tag=3,f}function gd(f,y,T,M){var N=T.type.getDerivedStateFromError;if(typeof N=="function"){var $=M.value;f.payload=function(){return N($)},f.callback=function(){md(y,T,M)}}var ce=T.stateNode;ce!==null&&typeof ce.componentDidCatch=="function"&&(f.callback=function(){md(y,T,M),typeof N!="function"&&(Fi===null?Fi=new Set([this]):Fi.add(this));var Ae=M.stack;this.componentDidCatch(M.value,{componentStack:Ae!==null?Ae:""})})}function Ep(f,y,T,M,N){if(T.flags|=32768,M!==null&&typeof M=="object"&&typeof M.then=="function"){if(y=T.alternate,y!==null&&Qf(y,T,N,!0),T=Po.current,T!==null){switch(T.tag){case 13:return Ea===null?Rn():T.alternate===null&&fr===0&&(fr=3),T.flags&=-257,T.flags|=65536,T.lanes=N,M===Im?T.flags|=16384:(y=T.updateQueue,y===null?T.updateQueue=new Set([M]):y.add(M),Hg(f,M,N)),!1;case 22:return T.flags|=65536,M===Im?T.flags|=16384:(y=T.updateQueue,y===null?(y={transitions:null,markerInstances:null,retryQueue:new Set([M])},T.updateQueue=y):(T=y.retryQueue,T===null?y.retryQueue=new Set([M]):T.add(M)),Hg(f,M,N)),!1}throw Error(l(435,T.tag))}return Hg(f,M,N),Rn(),!1}if(un)return y=Po.current,y!==null?((y.flags&65536)===0&&(y.flags|=256),y.flags|=65536,y.lanes=N,M!==tp&&(f=Error(l(422),{cause:M}),su(Sa(f,T)))):(M!==tp&&(y=Error(l(423),{cause:M}),su(Sa(y,T))),f=f.current.alternate,f.flags|=65536,N&=-N,f.lanes|=N,M=Sa(M,T),N=uh(f.stateNode,M,N),$h(f,N),fr!==4&&(fr=2)),!1;var $=Error(l(520),{cause:M});if($=Sa($,T),hi===null?hi=[$]:hi.push($),fr!==4&&(fr=2),y===null)return!0;M=Sa(M,T),T=y;do{switch(T.tag){case 3:return T.flags|=65536,f=N&-N,T.lanes|=f,f=uh(T.stateNode,M,f),$h(T,f),!1;case 1:if(y=T.type,$=T.stateNode,(T.flags&128)===0&&(typeof y.getDerivedStateFromError=="function"||$!==null&&typeof $.componentDidCatch=="function"&&(Fi===null||!Fi.has($))))return T.flags|=65536,N&=-N,T.lanes|=N,N=hh(N),gd(N,f,T,M),$h(T,N),!1}T=T.return}while(T!==null);return!1}var Cp=Error(l(461)),so=!1;function po(f,y,T,M){y.child=f===null?fa(y,null,T,M):Rc(y,f.child,T,M)}function _d(f,y,T,M,N){T=T.render;var $=y.ref;if("ref"in M){var ce={};for(var Ae in M)Ae!=="ref"&&(ce[Ae]=M[Ae])}else ce=M;return _c(y),M=Kh(f,y,T,ce,$,N),Ae=Sc(),f!==null&&!so?(du(f,y,N),Mc(f,y,N)):(un&&Ae&&Uh(y),y.flags|=1,po(f,y,M,N),y.child)}function zm(f,y,T,M,N){if(f===null){var $=T.type;return typeof $=="function"&&!ru($)&&$.defaultProps===void 0&&T.compare===null?(y.tag=15,y.type=$,Ip(f,y,$,M,N)):(f=eh(T.type,null,M,y,y.mode,N),f.ref=y.ref,f.return=y,y.child=f)}if($=f.child,!uf(f,N)){var ce=$.memoizedProps;if(T=T.compare,T=T!==null?T:cc,T(ce,M)&&f.ref===y.ref)return Mc(f,y,N)}return y.flags|=1,f=dc($,M),f.ref=y.ref,f.return=y,y.child=f}function Ip(f,y,T,M,N){if(f!==null){var $=f.memoizedProps;if(cc($,M)&&f.ref===y.ref)if(so=!1,y.pendingProps=M=$,uf(f,N))(f.flags&131072)!==0&&(so=!0);else return y.lanes=f.lanes,Mc(f,y,N)}return Rp(f,y,T,M,N)}function Fm(f,y,T){var M=y.pendingProps,N=M.children,$=f!==null?f.memoizedState:null;if(M.mode==="hidden"){if((y.flags&128)!==0){if(M=$!==null?$.baseLanes|T:T,f!==null){for(N=y.child=f.child,$=0;N!==null;)$=$|N.lanes|N.childLanes,N=N.sibling;y.childLanes=$&~M}else y.childLanes=0,y.child=null;return yd(f,y,M,T)}if((T&536870912)!==0)y.memoizedState={baseLanes:0,cachePool:null},f!==null&&cu(y,$!==null?$.cachePool:null),$!==null?id(y,$):Zh(),wp(y);else return y.lanes=y.childLanes=536870912,yd(f,y,$!==null?$.baseLanes|T:T,T)}else $!==null?(cu(y,$.cachePool),id(y,$),Ll(),y.memoizedState=null):(f!==null&&cu(y,null),Zh(),Ll());return po(f,y,N,T),y.child}function yd(f,y,T,M){var N=Kf();return N=N===null?null:{parent:Zn._currentValue,pool:N},y.memoizedState={baseLanes:T,cachePool:N},f!==null&&cu(y,null),Zh(),wp(y),f!==null&&Qf(f,y,M,!0),null}function vd(f,y){var T=y.ref;if(T===null)f!==null&&f.ref!==null&&(y.flags|=4194816);else{if(typeof T!="function"&&typeof T!="object")throw Error(l(284));(f===null||f.ref!==T)&&(y.flags|=4194816)}}function Rp(f,y,T,M,N){return _c(y),T=Kh(f,y,T,M,void 0,N),M=Sc(),f!==null&&!so?(du(f,y,N),Mc(f,y,N)):(un&&M&&Uh(y),y.flags|=1,po(f,y,T,N),y.child)}function km(f,y,T,M,N,$){return _c(y),y.updateQueue=null,T=ad(y,M,T,N),Jh(f),M=Sc(),f!==null&&!so?(du(f,y,$),Mc(f,y,$)):(un&&M&&Uh(y),y.flags|=1,po(f,y,T,$),y.child)}function Nm(f,y,T,M,N){if(_c(y),y.stateNode===null){var $=fc,ce=T.contextType;typeof ce=="object"&&ce!==null&&($=Oo(ce)),$=new T(M,$),y.memoizedState=$.state!==null&&$.state!==void 0?$.state:null,$.updater=sf,y.stateNode=$,$._reactInternals=y,$=y.stateNode,$.props=M,$.state=y.memoizedState,$.refs={},td(y),ce=T.contextType,$.context=typeof ce=="object"&&ce!==null?Oo(ce):fc,$.state=y.memoizedState,ce=T.getDerivedStateFromProps,typeof ce=="function"&&(yu(y,T,ce,M),$.state=y.memoizedState),typeof T.getDerivedStateFromProps=="function"||typeof $.getSnapshotBeforeUpdate=="function"||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(ce=$.state,typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount(),ce!==$.state&&sf.enqueueReplaceState($,$.state,null),Rs(y,M,$,N),Js(),$.state=y.memoizedState),typeof $.componentDidMount=="function"&&(y.flags|=4194308),M=!0}else if(f===null){$=y.stateNode;var Ae=y.memoizedProps,Ye=Cn(T,Ae);$.props=Ye;var Mt=$.context,Wt=T.contextType;ce=fc,typeof Wt=="object"&&Wt!==null&&(ce=Oo(Wt));var ir=T.getDerivedStateFromProps;Wt=typeof ir=="function"||typeof $.getSnapshotBeforeUpdate=="function",Ae=y.pendingProps!==Ae,Wt||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(Ae||Mt!==ce)&&Tp(y,$,M,ce),El=!1;var zt=y.memoizedState;$.state=zt,Rs(y,M,$,N),Js(),Mt=y.memoizedState,Ae||zt!==Mt||El?(typeof ir=="function"&&(yu(y,T,ir,M),Mt=y.memoizedState),(Ye=El||Sp(y,T,Ye,M,zt,Mt,ce))?(Wt||typeof $.UNSAFE_componentWillMount!="function"&&typeof $.componentWillMount!="function"||(typeof $.componentWillMount=="function"&&$.componentWillMount(),typeof $.UNSAFE_componentWillMount=="function"&&$.UNSAFE_componentWillMount()),typeof $.componentDidMount=="function"&&(y.flags|=4194308)):(typeof $.componentDidMount=="function"&&(y.flags|=4194308),y.memoizedProps=M,y.memoizedState=Mt),$.props=M,$.state=Mt,$.context=ce,M=Ye):(typeof $.componentDidMount=="function"&&(y.flags|=4194308),M=!1)}else{$=y.stateNode,uu(f,y),ce=y.memoizedProps,Wt=Cn(T,ce),$.props=Wt,ir=y.pendingProps,zt=$.context,Mt=T.contextType,Ye=fc,typeof Mt=="object"&&Mt!==null&&(Ye=Oo(Mt)),Ae=T.getDerivedStateFromProps,(Mt=typeof Ae=="function"||typeof $.getSnapshotBeforeUpdate=="function")||typeof $.UNSAFE_componentWillReceiveProps!="function"&&typeof $.componentWillReceiveProps!="function"||(ce!==ir||zt!==Ye)&&Tp(y,$,M,Ye),El=!1,zt=y.memoizedState,$.state=zt,Rs(y,M,$,N),Js();var kt=y.memoizedState;ce!==ir||zt!==kt||El||f!==null&&f.dependencies!==null&&op(f.dependencies)?(typeof Ae=="function"&&(yu(y,T,Ae,M),kt=y.memoizedState),(Wt=El||Sp(y,T,Wt,M,zt,kt,Ye)||f!==null&&f.dependencies!==null&&op(f.dependencies))?(Mt||typeof $.UNSAFE_componentWillUpdate!="function"&&typeof $.componentWillUpdate!="function"||(typeof $.componentWillUpdate=="function"&&$.componentWillUpdate(M,kt,Ye),typeof $.UNSAFE_componentWillUpdate=="function"&&$.UNSAFE_componentWillUpdate(M,kt,Ye)),typeof $.componentDidUpdate=="function"&&(y.flags|=4),typeof $.getSnapshotBeforeUpdate=="function"&&(y.flags|=1024)):(typeof $.componentDidUpdate!="function"||ce===f.memoizedProps&&zt===f.memoizedState||(y.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||ce===f.memoizedProps&&zt===f.memoizedState||(y.flags|=1024),y.memoizedProps=M,y.memoizedState=kt),$.props=M,$.state=kt,$.context=Ye,M=Wt):(typeof $.componentDidUpdate!="function"||ce===f.memoizedProps&&zt===f.memoizedState||(y.flags|=4),typeof $.getSnapshotBeforeUpdate!="function"||ce===f.memoizedProps&&zt===f.memoizedState||(y.flags|=1024),M=!1)}return $=M,vd(f,y),M=(y.flags&128)!==0,$||M?($=y.stateNode,T=M&&typeof T.getDerivedStateFromError!="function"?null:$.render(),y.flags|=1,f!==null&&M?(y.child=Rc(y,f.child,null,N),y.child=Rc(y,null,T,N)):po(f,y,T,N),y.memoizedState=$.state,f=y.child):f=Mc(f,y,N),f}function Mp(f,y,T,M){return au(),y.flags|=256,po(f,y,T,M),y.child}var Dp={dehydrated:null,treeContext:null,retryLane:0,hydrationErrors:null};function Op(f){return{baseLanes:f,cachePool:lp()}}function Pp(f,y,T){return f=f!==null?f.childLanes&~T:0,y&&(f|=wr),f}function Vm(f,y,T){var M=y.pendingProps,N=!1,$=(y.flags&128)!==0,ce;if((ce=$)||(ce=f!==null&&f.memoizedState===null?!1:(no.current&2)!==0),ce&&(N=!0,y.flags&=-129),ce=(y.flags&32)!==0,y.flags&=-33,f===null){if(un){if(N?il(y):Ll(),un){var Ae=Nn,Ye;if(Ye=Ae){e:{for(Ye=Ae,Ae=Ta;Ye.nodeType!==8;){if(!Ae){Ae=null;break e}if(Ye=us(Ye.nextSibling),Ye===null){Ae=null;break e}}Ae=Ye}Ae!==null?(y.memoizedState={dehydrated:Ae,treeContext:rh!==null?{id:Cs,overflow:pc}:null,retryLane:536870912,hydrationErrors:null},Ye=Nr(18,null,null,0),Ye.stateNode=Ae,Ye.return=y,y.child=Ye,bo=y,Nn=null,Ye=!0):Ye=!1}Ye||mc(y)}if(Ae=y.memoizedState,Ae!==null&&(Ae=Ae.dehydrated,Ae!==null))return jp(Ae)?y.lanes=32:y.lanes=536870912,null;Lo(y)}return Ae=M.children,M=M.fallback,N?(Ll(),N=y.mode,Ae=Lp({mode:"hidden",children:Ae},N),M=th(M,N,T,null),Ae.return=y,M.return=y,Ae.sibling=M,y.child=Ae,N=y.child,N.memoizedState=Op(T),N.childLanes=Pp(f,ce,T),y.memoizedState=Dp,M):(il(y),Um(y,Ae))}if(Ye=f.memoizedState,Ye!==null&&(Ae=Ye.dehydrated,Ae!==null)){if($)y.flags&256?(il(y),y.flags&=-257,y=jm(f,y,T)):y.memoizedState!==null?(Ll(),y.child=f.child,y.flags|=128,y=null):(Ll(),N=M.fallback,Ae=y.mode,M=Lp({mode:"visible",children:M.children},Ae),N=th(N,Ae,T,null),N.flags|=2,M.return=y,N.return=y,M.sibling=N,y.child=M,Rc(y,f.child,null,T),M=y.child,M.memoizedState=Op(T),M.childLanes=Pp(f,ce,T),y.memoizedState=Dp,y=N);else if(il(y),jp(Ae)){if(ce=Ae.nextSibling&&Ae.nextSibling.dataset,ce)var Mt=ce.dgst;ce=Mt,M=Error(l(419)),M.stack="",M.digest=ce,su({value:M,source:null,stack:null}),y=jm(f,y,T)}else if(so||Qf(f,y,T,!1),ce=(T&f.childLanes)!==0,so||ce){if(ce=at,ce!==null&&(M=T&-T,M=(M&42)!==0?1:Tt(M),M=(M&(ce.suspendedLanes|T))!==0?0:M,M!==0&&M!==Ye.retryLane))throw Ye.retryLane=M,bl(f,M),Wn(ce,f,M),Cp;Ae.data==="$?"||Rn(),y=jm(f,y,T)}else Ae.data==="$?"?(y.flags|=192,y.child=f.child,y=null):(f=Ye.treeContext,Nn=us(Ae.nextSibling),bo=y,un=!0,wl=null,Ta=!1,f!==null&&(Es[as++]=Cs,Es[as++]=pc,Es[as++]=rh,Cs=f.id,pc=f.overflow,rh=y),y=Um(y,M.children),y.flags|=4096);return y}return N?(Ll(),N=M.fallback,Ae=y.mode,Ye=f.child,Mt=Ye.sibling,M=dc(Ye,{mode:"hidden",children:M.children}),M.subtreeFlags=Ye.subtreeFlags&65011712,Mt!==null?N=dc(Mt,N):(N=th(N,Ae,T,null),N.flags|=2),N.return=y,M.return=y,M.sibling=N,y.child=M,M=N,N=y.child,Ae=f.child.memoizedState,Ae===null?Ae=Op(T):(Ye=Ae.cachePool,Ye!==null?(Mt=Zn._currentValue,Ye=Ye.parent!==Mt?{parent:Mt,pool:Mt}:Ye):Ye=lp(),Ae={baseLanes:Ae.baseLanes|T,cachePool:Ye}),N.memoizedState=Ae,N.childLanes=Pp(f,ce,T),y.memoizedState=Dp,M):(il(y),T=f.child,f=T.sibling,T=dc(T,{mode:"visible",children:M.children}),T.return=y,T.sibling=null,f!==null&&(ce=y.deletions,ce===null?(y.deletions=[f],y.flags|=16):ce.push(f)),y.child=T,y.memoizedState=null,T)}function Um(f,y){return y=Lp({mode:"visible",children:y},f.mode),y.return=f,f.child=y}function Lp(f,y){return f=Nr(22,f,null,y),f.lanes=0,f.stateNode={_visibility:1,_pendingMarkers:null,_retryCache:null,_transitions:null},f}function jm(f,y,T){return Rc(y,f.child,null,T),f=Um(y,y.pendingProps.children),f.flags|=2,y.memoizedState=null,f}function hn(f,y,T){f.lanes|=y;var M=f.alternate;M!==null&&(M.lanes|=y),ip(f.return,y,T)}function fh(f,y,T,M,N){var $=f.memoizedState;$===null?f.memoizedState={isBackwards:y,rendering:null,renderingStartTime:0,last:M,tail:T,tailMode:N}:($.isBackwards=y,$.rendering=null,$.renderingStartTime=0,$.last=M,$.tail=T,$.tailMode=N)}function Vg(f,y,T){var M=y.pendingProps,N=M.revealOrder,$=M.tail;if(po(f,y,M.children,T),M=no.current,(M&2)!==0)M=M&1|2,y.flags|=128;else{if(f!==null&&(f.flags&128)!==0)e:for(f=y.child;f!==null;){if(f.tag===13)f.memoizedState!==null&&hn(f,T,y);else if(f.tag===19)hn(f,T,y);else if(f.child!==null){f.child.return=f,f=f.child;continue}if(f===y)break e;for(;f.sibling===null;){if(f.return===null||f.return===y)break e;f=f.return}f.sibling.return=f.return,f=f.sibling}M&=1}switch(Rr(no,M),N){case"forwards":for(T=y.child,N=null;T!==null;)f=T.alternate,f!==null&&Un(f)===null&&(N=T),T=T.sibling;T=N,T===null?(N=y.child,y.child=null):(N=T.sibling,T.sibling=null),fh(y,!1,N,T,$);break;case"backwards":for(T=null,N=y.child,y.child=null;N!==null;){if(f=N.alternate,f!==null&&Un(f)===null){y.child=N;break}f=N.sibling,N.sibling=T,T=N,N=f}fh(y,!0,T,null,$);break;case"together":fh(y,!1,null,null,void 0);break;default:y.memoizedState=null}return y.child}function Mc(f,y,T){if(f!==null&&(y.dependencies=f.dependencies),Mr|=y.lanes,(T&y.childLanes)===0)if(f!==null){if(Qf(f,y,T,!1),(T&y.childLanes)===0)return null}else return null;if(f!==null&&y.child!==f.child)throw Error(l(153));if(y.child!==null){for(f=y.child,T=dc(f,f.pendingProps),y.child=T,T.return=y;f.sibling!==null;)f=f.sibling,T=T.sibling=dc(f,f.pendingProps),T.return=y;T.sibling=null}return y.child}function uf(f,y){return(f.lanes&y)!==0?!0:(f=f.dependencies,!!(f!==null&&op(f)))}function xd(f,y,T){switch(y.tag){case 3:vi(y,y.stateNode.containerInfo),gc(y,Zn,f.memoizedState.cache),au();break;case 27:case 5:Tn(y);break;case 4:vi(y,y.stateNode.containerInfo);break;case 10:gc(y,y.type,y.memoizedProps.value);break;case 13:var M=y.memoizedState;if(M!==null)return M.dehydrated!==null?(il(y),y.flags|=128,null):(T&y.child.childLanes)!==0?Vm(f,y,T):(il(y),f=Mc(f,y,T),f!==null?f.sibling:null);il(y);break;case 19:var N=(f.flags&128)!==0;if(M=(T&y.childLanes)!==0,M||(Qf(f,y,T,!1),M=(T&y.childLanes)!==0),N){if(M)return Vg(f,y,T);y.flags|=128}if(N=y.memoizedState,N!==null&&(N.rendering=null,N.tail=null,N.lastEffect=null),Rr(no,no.current),M)break;return null;case 22:case 23:return y.lanes=0,Fm(f,y,T);case 24:gc(y,Zn,f.memoizedState.cache)}return Mc(f,y,T)}function Bp(f,y,T){if(f!==null)if(f.memoizedProps!==y.pendingProps)so=!0;else{if(!uf(f,T)&&(y.flags&128)===0)return so=!1,xd(f,y,T);so=(f.flags&131072)!==0}else so=!1,un&&(y.flags&1048576)!==0&&ep(y,Jd,y.index);switch(y.lanes=0,y.tag){case 16:e:{f=y.pendingProps;var M=y.elementType,N=M._init;if(M=N(M._payload),y.type=M,typeof M=="function")ru(M)?(f=Cn(M,f),y.tag=1,y=Nm(null,y,M,f,T)):(y.tag=0,y=Rp(null,y,M,f,T));else{if(M!=null){if(N=M.$$typeof,N===Ze){y.tag=11,y=_d(null,y,M,f,T);break e}else if(N===Ct){y.tag=14,y=zm(null,y,M,f,T);break e}}throw y=zi(M)||M,Error(l(306,y,""))}}return y;case 0:return Rp(f,y,y.type,y.pendingProps,T);case 1:return M=y.type,N=Cn(M,y.pendingProps),Nm(f,y,M,N,T);case 3:e:{if(vi(y,y.stateNode.containerInfo),f===null)throw Error(l(387));M=y.pendingProps;var $=y.memoizedState;N=$.element,uu(f,y),Rs(y,M,null,T);var ce=y.memoizedState;if(M=ce.cache,gc(y,Zn,M),M!==$.cache&&np(y,[Zn],T,!0),Js(),M=ce.element,$.isDehydrated)if($={element:M,isDehydrated:!1,cache:ce.cache},y.updateQueue.baseState=$,y.memoizedState=$,y.flags&256){y=Mp(f,y,M,T);break e}else if(M!==N){N=Sa(Error(l(424)),y),su(N),y=Mp(f,y,M,T);break e}else{switch(f=y.stateNode.containerInfo,f.nodeType){case 9:f=f.body;break;default:f=f.nodeName==="HTML"?f.ownerDocument.body:f}for(Nn=us(f.firstChild),bo=y,un=!0,wl=null,Ta=!0,T=fa(y,null,M,T),y.child=T;T;)T.flags=T.flags&-3|4096,T=T.sibling}else{if(au(),M===N){y=Mc(f,y,T);break e}po(f,y,M,T)}y=y.child}return y;case 26:return vd(f,y),f===null?(T=o_(y.type,null,y.pendingProps,null))?y.memoizedState=T:un||(T=y.type,f=y.pendingProps,M=yf(Cr.current).createElement(T),M[te]=y,M[oe]=f,Da(M,T,f),gr(M),y.stateNode=M):y.memoizedState=o_(y.type,f.memoizedProps,y.pendingProps,f.memoizedState),null;case 27:return Tn(y),f===null&&un&&(M=y.stateNode=Gp(y.type,y.pendingProps,Cr.current),bo=y,Ta=!0,N=Nn,Vl(y.type)?(i_=N,Nn=us(M.firstChild)):Nn=N),po(f,y,y.pendingProps.children,T),vd(f,y),f===null&&(y.flags|=4194304),y.child;case 5:return f===null&&un&&((N=M=Nn)&&(M=Up(M,y.type,y.pendingProps,Ta),M!==null?(y.stateNode=M,bo=y,Nn=us(M.firstChild),Ta=!1,N=!0):N=!1),N||mc(y)),Tn(y),N=y.type,$=y.pendingProps,ce=f!==null?f.memoizedProps:null,M=$.children,f0(N,$)?M=null:ce!==null&&f0(N,ce)&&(y.flags|=32),y.memoizedState!==null&&(N=Kh(f,y,Og,null,null,T),vf._currentValue=N),vd(f,y),po(f,y,M,T),y.child;case 6:return f===null&&un&&((f=T=Nn)&&(T=Wy(T,y.pendingProps,Ta),T!==null?(y.stateNode=T,bo=y,Nn=null,f=!0):f=!1),f||mc(y)),null;case 13:return Vm(f,y,T);case 4:return vi(y,y.stateNode.containerInfo),M=y.pendingProps,f===null?y.child=Rc(y,null,M,T):po(f,y,M,T),y.child;case 11:return _d(f,y,y.type,y.pendingProps,T);case 7:return po(f,y,y.pendingProps,T),y.child;case 8:return po(f,y,y.pendingProps.children,T),y.child;case 12:return po(f,y,y.pendingProps.children,T),y.child;case 10:return M=y.pendingProps,gc(y,y.type,M.value),po(f,y,M.children,T),y.child;case 9:return N=y.type._context,M=y.pendingProps.children,_c(y),N=Oo(N),M=M(N),y.flags|=1,po(f,y,M,T),y.child;case 14:return zm(f,y,y.type,y.pendingProps,T);case 15:return Ip(f,y,y.type,y.pendingProps,T);case 19:return Vg(f,y,T);case 31:return M=y.pendingProps,T=y.mode,M={mode:M.mode,children:M.children},f===null?(T=Lp(M,T),T.ref=y.ref,y.child=T,T.return=y,y=T):(T=dc(f.child,M),T.ref=y.ref,y.child=T,T.return=y,y=T),y;case 22:return Fm(f,y,T);case 24:return _c(y),M=Oo(Zn),f===null?(N=Kf(),N===null&&(N=at,$=vc(),N.pooledCache=$,$.refCount++,$!==null&&(N.pooledCacheLanes|=T),N=$),y.memoizedState={parent:M,cache:N},td(y),gc(y,Zn,N)):((f.lanes&T)!==0&&(uu(f,y),Rs(y,null,null,T),Js()),N=f.memoizedState,$=y.memoizedState,N.parent!==M?(N={parent:M,cache:M},y.memoizedState=N,y.lanes===0&&(y.memoizedState=y.updateQueue.baseState=N),gc(y,Zn,M)):(M=$.cache,gc(y,Zn,M),M!==N.cache&&np(y,[Zn],T,!0))),po(f,y,y.pendingProps.children,T),y.child;case 29:throw y.pendingProps}throw Error(l(156,y.tag))}function nl(f){f.flags|=4}function hf(f,y){if(y.type!=="stylesheet"||(y.state.loading&4)!==0)f.flags&=-16777217;else if(f.flags|=16777216,!o1(y)){if(y=Po.current,y!==null&&((wt&4194048)===wt?Ea!==null:(wt&62914560)!==wt&&(wt&536870912)===0||y!==Ea))throw ed=Im,cp;f.flags|=8192}}function ls(f,y){y!==null&&(f.flags|=4),f.flags&16384&&(y=f.tag!==22?Eh():536870912,f.lanes|=y,ii|=y)}function Dc(f,y){if(!un)switch(f.tailMode){case"hidden":y=f.tail;for(var T=null;y!==null;)y.alternate!==null&&(T=y),y=y.sibling;T===null?f.tail=null:T.sibling=null;break;case"collapsed":T=f.tail;for(var M=null;T!==null;)T.alternate!==null&&(M=T),T=T.sibling;M===null?y||f.tail===null?f.tail=null:f.tail.sibling=null:M.sibling=null}}function gi(f){var y=f.alternate!==null&&f.alternate.child===f.child,T=0,M=0;if(y)for(var N=f.child;N!==null;)T|=N.lanes|N.childLanes,M|=N.subtreeFlags&65011712,M|=N.flags&65011712,N.return=f,N=N.sibling;else for(N=f.child;N!==null;)T|=N.lanes|N.childLanes,M|=N.subtreeFlags,M|=N.flags,N.return=f,N=N.sibling;return f.subtreeFlags|=M,f.childLanes=T,y}function Bl(f,y,T){var M=y.pendingProps;switch(Yf(y),y.tag){case 31:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return gi(y),null;case 1:return gi(y),null;case 3:return T=y.stateNode,M=null,f!==null&&(M=f.memoizedState.cache),y.memoizedState.cache!==M&&(y.flags|=2048),ua(Zn),ho(),T.pendingContext&&(T.context=T.pendingContext,T.pendingContext=null),(f===null||f.child===null)&&(ou(y)?nl(y):f===null||f.memoizedState.isDehydrated&&(y.flags&256)===0||(y.flags|=1024,rp())),gi(y),null;case 26:return T=y.memoizedState,f===null?(nl(y),T!==null?(gi(y),hf(y,T)):(gi(y),y.flags&=-16777217)):T?T!==f.memoizedState?(nl(y),gi(y),hf(y,T)):(gi(y),y.flags&=-16777217):(f.memoizedProps!==M&&nl(y),gi(y),y.flags&=-16777217),null;case 27:qs(y),T=Cr.current;var N=y.type;if(f!==null&&y.stateNode!=null)f.memoizedProps!==M&&nl(y);else{if(!M){if(y.stateNode===null)throw Error(l(166));return gi(y),null}f=oi.current,ou(y)?Tm(y):(f=Gp(N,M,T),y.stateNode=f,nl(y))}return gi(y),null;case 5:if(qs(y),T=y.type,f!==null&&y.stateNode!=null)f.memoizedProps!==M&&nl(y);else{if(!M){if(y.stateNode===null)throw Error(l(166));return gi(y),null}if(f=oi.current,ou(y))Tm(y);else{switch(N=yf(Cr.current),f){case 1:f=N.createElementNS("http://www.w3.org/2000/svg",T);break;case 2:f=N.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;default:switch(T){case"svg":f=N.createElementNS("http://www.w3.org/2000/svg",T);break;case"math":f=N.createElementNS("http://www.w3.org/1998/Math/MathML",T);break;case"script":f=N.createElement("div"),f.innerHTML="<script><\/script>",f=f.removeChild(f.firstChild);break;case"select":f=typeof M.is=="string"?N.createElement("select",{is:M.is}):N.createElement("select"),M.multiple?f.multiple=!0:M.size&&(f.size=M.size);break;default:f=typeof M.is=="string"?N.createElement(T,{is:M.is}):N.createElement(T)}}f[te]=y,f[oe]=M;e:for(N=y.child;N!==null;){if(N.tag===5||N.tag===6)f.appendChild(N.stateNode);else if(N.tag!==4&&N.tag!==27&&N.child!==null){N.child.return=N,N=N.child;continue}if(N===y)break e;for(;N.sibling===null;){if(N.return===null||N.return===y)break e;N=N.return}N.sibling.return=N.return,N=N.sibling}y.stateNode=f;e:switch(Da(f,T,M),T){case"button":case"input":case"select":case"textarea":f=!!M.autoFocus;break e;case"img":f=!0;break e;default:f=!1}f&&nl(y)}}return gi(y),y.flags&=-16777217,null;case 6:if(f&&y.stateNode!=null)f.memoizedProps!==M&&nl(y);else{if(typeof M!="string"&&y.stateNode===null)throw Error(l(166));if(f=Cr.current,ou(y)){if(f=y.stateNode,T=y.memoizedProps,M=null,N=bo,N!==null)switch(N.tag){case 27:case 5:M=N.memoizedProps}f[te]=y,f=!!(f.nodeValue===T||M!==null&&M.suppressHydrationWarning===!0||Np(f.nodeValue,T)),f||mc(y)}else f=yf(f).createTextNode(M),f[te]=y,y.stateNode=f}return gi(y),null;case 13:if(M=y.memoizedState,f===null||f.memoizedState!==null&&f.memoizedState.dehydrated!==null){if(N=ou(y),M!==null&&M.dehydrated!==null){if(f===null){if(!N)throw Error(l(318));if(N=y.memoizedState,N=N!==null?N.dehydrated:null,!N)throw Error(l(317));N[te]=y}else au(),(y.flags&128)===0&&(y.memoizedState=null),y.flags|=4;gi(y),N=!1}else N=rp(),f!==null&&f.memoizedState!==null&&(f.memoizedState.hydrationErrors=N),N=!0;if(!N)return y.flags&256?(Lo(y),y):(Lo(y),null)}if(Lo(y),(y.flags&128)!==0)return y.lanes=T,y;if(T=M!==null,f=f!==null&&f.memoizedState!==null,T){M=y.child,N=null,M.alternate!==null&&M.alternate.memoizedState!==null&&M.alternate.memoizedState.cachePool!==null&&(N=M.alternate.memoizedState.cachePool.pool);var $=null;M.memoizedState!==null&&M.memoizedState.cachePool!==null&&($=M.memoizedState.cachePool.pool),$!==N&&(M.flags|=2048)}return T!==f&&T&&(y.child.flags|=8192),ls(y,y.updateQueue),gi(y),null;case 4:return ho(),f===null&&Yg(y.stateNode.containerInfo),gi(y),null;case 10:return ua(y.type),gi(y),null;case 19:if(Er(no),N=y.memoizedState,N===null)return gi(y),null;if(M=(y.flags&128)!==0,$=N.rendering,$===null)if(M)Dc(N,!1);else{if(fr!==0||f!==null&&(f.flags&128)!==0)for(f=y.child;f!==null;){if($=Un(f),$!==null){for(y.flags|=128,Dc(N,!1),f=$.updateQueue,y.updateQueue=f,ls(y,f),y.subtreeFlags=0,f=T,T=y.child;T!==null;)Rg(T,f),T=T.sibling;return Rr(no,no.current&1|2),y.child}f=f.sibling}N.tail!==null&&Zo()>li&&(y.flags|=128,M=!0,Dc(N,!1),y.lanes=4194304)}else{if(!M)if(f=Un($),f!==null){if(y.flags|=128,M=!0,f=f.updateQueue,y.updateQueue=f,ls(y,f),Dc(N,!0),N.tail===null&&N.tailMode==="hidden"&&!$.alternate&&!un)return gi(y),null}else 2*Zo()-N.renderingStartTime>li&&T!==536870912&&(y.flags|=128,M=!0,Dc(N,!1),y.lanes=4194304);N.isBackwards?($.sibling=y.child,y.child=$):(f=N.last,f!==null?f.sibling=$:y.child=$,N.last=$)}return N.tail!==null?(y=N.tail,N.rendering=y,N.tail=y.sibling,N.renderingStartTime=Zo(),y.sibling=null,f=no.current,Rr(no,M?f&1|2:f&1),y):(gi(y),null);case 22:case 23:return Lo(y),nd(),M=y.memoizedState!==null,f!==null?f.memoizedState!==null!==M&&(y.flags|=8192):M&&(y.flags|=8192),M?(T&536870912)!==0&&(y.flags&128)===0&&(gi(y),y.subtreeFlags&6&&(y.flags|=8192)):gi(y),T=y.updateQueue,T!==null&&ls(y,T.retryQueue),T=null,f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),M=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(M=y.memoizedState.cachePool.pool),M!==T&&(y.flags|=2048),f!==null&&Er(Is),null;case 24:return T=null,f!==null&&(T=f.memoizedState.cache),y.memoizedState.cache!==T&&(y.flags|=2048),ua(Zn),gi(y),null;case 25:return null;case 30:return null}throw Error(l(156,y.tag))}function bd(f,y){switch(Yf(y),y.tag){case 1:return f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 3:return ua(Zn),ho(),f=y.flags,(f&65536)!==0&&(f&128)===0?(y.flags=f&-65537|128,y):null;case 26:case 27:case 5:return qs(y),null;case 13:if(Lo(y),f=y.memoizedState,f!==null&&f.dehydrated!==null){if(y.alternate===null)throw Error(l(340));au()}return f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 19:return Er(no),null;case 4:return ho(),null;case 10:return ua(y.type),null;case 22:case 23:return Lo(y),nd(),f!==null&&Er(Is),f=y.flags,f&65536?(y.flags=f&-65537|128,y):null;case 24:return ua(Zn),null;case 25:return null;default:return null}}function ff(f,y){switch(Yf(y),y.tag){case 3:ua(Zn),ho();break;case 26:case 27:case 5:qs(y);break;case 4:ho();break;case 13:Lo(y);break;case 19:Er(no);break;case 10:ua(y.type);break;case 22:case 23:Lo(y),nd(),f!==null&&Er(Is);break;case 24:ua(Zn)}}function df(f,y){try{var T=y.updateQueue,M=T!==null?T.lastEffect:null;if(M!==null){var N=M.next;T=N;do{if((T.tag&f)===f){M=void 0;var $=T.create,ce=T.inst;M=$(),ce.destroy=M}T=T.next}while(T!==N)}}catch(Ae){Qn(y,y.return,Ae)}}function bu(f,y,T){try{var M=y.updateQueue,N=M!==null?M.lastEffect:null;if(N!==null){var $=N.next;M=$;do{if((M.tag&f)===f){var ce=M.inst,Ae=ce.destroy;if(Ae!==void 0){ce.destroy=void 0,N=y;var Ye=T,Mt=Ae;try{Mt()}catch(Wt){Qn(N,Ye,Wt)}}}M=M.next}while(M!==$)}}catch(Wt){Qn(y,y.return,Wt)}}function pf(f){var y=f.updateQueue;if(y!==null){var T=f.stateNode;try{rd(y,T)}catch(M){Qn(f,f.return,M)}}}function Ug(f,y,T){T.props=Cn(f.type,f.memoizedProps),T.state=f.memoizedState;try{T.componentWillUnmount()}catch(M){Qn(f,y,M)}}function wd(f,y){try{var T=f.ref;if(T!==null){switch(f.tag){case 26:case 27:case 5:var M=f.stateNode;break;case 30:M=f.stateNode;break;default:M=f.stateNode}typeof T=="function"?f.refCleanup=T(M):T.current=M}}catch(N){Qn(f,y,N)}}function cs(f,y){var T=f.ref,M=f.refCleanup;if(T!==null)if(typeof M=="function")try{M()}catch(N){Qn(f,y,N)}finally{f.refCleanup=null,f=f.alternate,f!=null&&(f.refCleanup=null)}else if(typeof T=="function")try{T(null)}catch(N){Qn(f,y,N)}else T.current=null}function mf(f){var y=f.type,T=f.memoizedProps,M=f.stateNode;try{e:switch(y){case"button":case"input":case"select":case"textarea":T.autoFocus&&M.focus();break e;case"img":T.src?M.src=T.src:T.srcSet&&(M.srcset=T.srcSet)}}catch(N){Qn(f,f.return,N)}}function Ca(f,y,T){try{var M=f.stateNode;Vp(M,f.type,T,y),M[oe]=y}catch(N){Qn(f,f.return,N)}}function wu(f){return f.tag===5||f.tag===3||f.tag===26||f.tag===27&&Vl(f.type)||f.tag===4}function zl(f){e:for(;;){for(;f.sibling===null;){if(f.return===null||wu(f.return))return null;f=f.return}for(f.sibling.return=f.return,f=f.sibling;f.tag!==5&&f.tag!==6&&f.tag!==18;){if(f.tag===27&&Vl(f.type)||f.flags&2||f.child===null||f.tag===4)continue e;f.child.return=f,f=f.child}if(!(f.flags&2))return f.stateNode}}function ol(f,y,T){var M=f.tag;if(M===5||M===6)f=f.stateNode,y?(T.nodeType===9?T.body:T.nodeName==="HTML"?T.ownerDocument.body:T).insertBefore(f,y):(y=T.nodeType===9?T.body:T.nodeName==="HTML"?T.ownerDocument.body:T,y.appendChild(f),T=T._reactRootContainer,T!=null||y.onclick!==null||(y.onclick=Jg));else if(M!==4&&(M===27&&Vl(f.type)&&(T=f.stateNode,y=null),f=f.child,f!==null))for(ol(f,y,T),f=f.sibling;f!==null;)ol(f,y,T),f=f.sibling}function Ls(f,y,T){var M=f.tag;if(M===5||M===6)f=f.stateNode,y?T.insertBefore(f,y):T.appendChild(f);else if(M!==4&&(M===27&&Vl(f.type)&&(T=f.stateNode),f=f.child,f!==null))for(Ls(f,y,T),f=f.sibling;f!==null;)Ls(f,y,T),f=f.sibling}function Su(f){var y=f.stateNode,T=f.memoizedProps;try{for(var M=f.type,N=y.attributes;N.length;)y.removeAttributeNode(N[0]);Da(y,M,T),y[te]=f,y[oe]=T}catch($){Qn(f,f.return,$)}}var Bo=!1,mo=!1,jg=!1,g=typeof WeakSet=="function"?WeakSet:Set,i=null;function c(f,y){if(f=f.containerInfo,e_=Jm,f=Ts(f),xm(f)){if("selectionStart"in f)var T={start:f.selectionStart,end:f.selectionEnd};else e:{T=(T=f.ownerDocument)&&T.defaultView||window;var M=T.getSelection&&T.getSelection();if(M&&M.rangeCount!==0){T=M.anchorNode;var N=M.anchorOffset,$=M.focusNode;M=M.focusOffset;try{T.nodeType,$.nodeType}catch{T=null;break e}var ce=0,Ae=-1,Ye=-1,Mt=0,Wt=0,ir=f,zt=null;t:for(;;){for(var kt;ir!==T||N!==0&&ir.nodeType!==3||(Ae=ce+N),ir!==$||M!==0&&ir.nodeType!==3||(Ye=ce+M),ir.nodeType===3&&(ce+=ir.nodeValue.length),(kt=ir.firstChild)!==null;)zt=ir,ir=kt;for(;;){if(ir===f)break t;if(zt===T&&++Mt===N&&(Ae=ce),zt===$&&++Wt===M&&(Ye=ce),(kt=ir.nextSibling)!==null)break;ir=zt,zt=ir.parentNode}ir=kt}T=Ae===-1||Ye===-1?null:{start:Ae,end:Ye}}else T=null}T=T||{start:0,end:0}}else T=null;for(ph={focusedElem:f,selectionRange:T},Jm=!1,i=y;i!==null;)if(y=i,f=y.child,(y.subtreeFlags&1024)!==0&&f!==null)f.return=y,i=f;else for(;i!==null;){switch(y=i,$=y.alternate,f=y.flags,y.tag){case 0:break;case 11:case 15:break;case 1:if((f&1024)!==0&&$!==null){f=void 0,T=y,N=$.memoizedProps,$=$.memoizedState,M=T.stateNode;try{var xi=Cn(T.type,N,T.elementType===T.type);f=M.getSnapshotBeforeUpdate(xi,$),M.__reactInternalSnapshotBeforeUpdate=f}catch(ni){Qn(T,T.return,ni)}}break;case 3:if((f&1024)!==0){if(f=y.stateNode.containerInfo,T=f.nodeType,T===9)co(f);else if(T===1)switch(f.nodeName){case"HEAD":case"HTML":case"BODY":co(f);break;default:f.textContent=""}}break;case 5:case 26:case 27:case 6:case 4:case 17:break;default:if((f&1024)!==0)throw Error(l(163))}if(f=y.sibling,f!==null){f.return=y.return,i=f;break}i=y.return}}function p(f,y,T){var M=T.flags;switch(T.tag){case 0:case 11:case 15:K(f,T),M&4&&df(5,T);break;case 1:if(K(f,T),M&4)if(f=T.stateNode,y===null)try{f.componentDidMount()}catch(ce){Qn(T,T.return,ce)}else{var N=Cn(T.type,y.memoizedProps);y=y.memoizedState;try{f.componentDidUpdate(N,y,f.__reactInternalSnapshotBeforeUpdate)}catch(ce){Qn(T,T.return,ce)}}M&64&&pf(T),M&512&&wd(T,T.return);break;case 3:if(K(f,T),M&64&&(f=T.updateQueue,f!==null)){if(y=null,T.child!==null)switch(T.child.tag){case 27:case 5:y=T.child.stateNode;break;case 1:y=T.child.stateNode}try{rd(f,y)}catch(ce){Qn(T,T.return,ce)}}break;case 27:y===null&&M&4&&Su(T);case 26:case 5:K(f,T),y===null&&M&4&&mf(T),M&512&&wd(T,T.return);break;case 12:K(f,T);break;case 13:K(f,T),M&4&&z(f,T),M&64&&(f=T.memoizedState,f!==null&&(f=f.dehydrated,f!==null&&(T=Ny.bind(null,T),r_(f,T))));break;case 22:if(M=T.memoizedState!==null||Bo,!M){y=y!==null&&y.memoizedState!==null||mo,N=Bo;var $=mo;Bo=M,(mo=y)&&!$?ue(f,T,(T.subtreeFlags&8772)!==0):K(f,T),Bo=N,mo=$}break;case 30:break;default:K(f,T)}}function x(f){var y=f.alternate;y!==null&&(f.alternate=null,x(y)),f.child=null,f.deletions=null,f.sibling=null,f.tag===5&&(y=f.stateNode,y!==null&&Je(y)),f.stateNode=null,f.return=null,f.dependencies=null,f.memoizedProps=null,f.memoizedState=null,f.pendingProps=null,f.stateNode=null,f.updateQueue=null}var w=null,A=!1;function I(f,y,T){for(T=T.child;T!==null;)O(f,y,T),T=T.sibling}function O(f,y,T){if($n&&typeof $n.onCommitFiberUnmount=="function")try{$n.onCommitFiberUnmount(Ro,T)}catch{}switch(T.tag){case 26:mo||cs(T,y),I(f,y,T),T.memoizedState?T.memoizedState.count--:T.stateNode&&(T=T.stateNode,T.parentNode.removeChild(T));break;case 27:mo||cs(T,y);var M=w,N=A;Vl(T.type)&&(w=T.stateNode,A=!1),I(f,y,T),Ed(T.stateNode),w=M,A=N;break;case 5:mo||cs(T,y);case 6:if(M=w,N=A,w=null,I(f,y,T),w=M,A=N,w!==null)if(A)try{(w.nodeType===9?w.body:w.nodeName==="HTML"?w.ownerDocument.body:w).removeChild(T.stateNode)}catch($){Qn(T,y,$)}else try{w.removeChild(T.stateNode)}catch($){Qn(T,y,$)}break;case 18:w!==null&&(A?(f=w,Zy(f.nodeType===9?f.body:f.nodeName==="HTML"?f.ownerDocument.body:f,T.stateNode),Zp(f)):Zy(w,T.stateNode));break;case 4:M=w,N=A,w=T.stateNode.containerInfo,A=!0,I(f,y,T),w=M,A=N;break;case 0:case 11:case 14:case 15:mo||bu(2,T,y),mo||bu(4,T,y),I(f,y,T);break;case 1:mo||(cs(T,y),M=T.stateNode,typeof M.componentWillUnmount=="function"&&Ug(T,y,M)),I(f,y,T);break;case 21:I(f,y,T);break;case 22:mo=(M=mo)||T.memoizedState!==null,I(f,y,T),mo=M;break;default:I(f,y,T)}}function z(f,y){if(y.memoizedState===null&&(f=y.alternate,f!==null&&(f=f.memoizedState,f!==null&&(f=f.dehydrated,f!==null))))try{Zp(f)}catch(T){Qn(y,y.return,T)}}function k(f){switch(f.tag){case 13:case 19:var y=f.stateNode;return y===null&&(y=f.stateNode=new g),y;case 22:return f=f.stateNode,y=f._retryCache,y===null&&(y=f._retryCache=new g),y;default:throw Error(l(435,f.tag))}}function H(f,y){var T=k(f);y.forEach(function(M){var N=Yv.bind(null,f,M);T.has(M)||(T.add(M),M.then(N,N))})}function V(f,y){var T=y.deletions;if(T!==null)for(var M=0;M<T.length;M++){var N=T[M],$=f,ce=y,Ae=ce;e:for(;Ae!==null;){switch(Ae.tag){case 27:if(Vl(Ae.type)){w=Ae.stateNode,A=!1;break e}break;case 5:w=Ae.stateNode,A=!1;break e;case 3:case 4:w=Ae.stateNode.containerInfo,A=!0;break e}Ae=Ae.return}if(w===null)throw Error(l(160));O($,ce,N),w=null,A=!1,$=N.alternate,$!==null&&($.return=null),N.return=null}if(y.subtreeFlags&13878)for(y=y.child;y!==null;)Y(y,f),y=y.sibling}var X=null;function Y(f,y){var T=f.alternate,M=f.flags;switch(f.tag){case 0:case 11:case 14:case 15:V(y,f),W(f),M&4&&(bu(3,f,f.return),df(3,f),bu(5,f,f.return));break;case 1:V(y,f),W(f),M&512&&(mo||T===null||cs(T,T.return)),M&64&&Bo&&(f=f.updateQueue,f!==null&&(M=f.callbacks,M!==null&&(T=f.shared.hiddenCallbacks,f.shared.hiddenCallbacks=T===null?M:T.concat(M))));break;case 26:var N=X;if(V(y,f),W(f),M&512&&(mo||T===null||cs(T,T.return)),M&4){var $=T!==null?T.memoizedState:null;if(M=f.memoizedState,T===null)if(M===null)if(f.stateNode===null){e:{M=f.type,T=f.memoizedProps,N=N.ownerDocument||N;t:switch(M){case"title":$=N.getElementsByTagName("title")[0],(!$||$[Be]||$[te]||$.namespaceURI==="http://www.w3.org/2000/svg"||$.hasAttribute("itemprop"))&&($=N.createElement(M),N.head.insertBefore($,N.querySelector("head > title"))),Da($,M,T),$[te]=f,gr($),M=$;break e;case"link":var ce=i1("link","href",N).get(M+(T.href||""));if(ce){for(var Ae=0;Ae<ce.length;Ae++)if($=ce[Ae],$.getAttribute("href")===(T.href==null||T.href===""?null:T.href)&&$.getAttribute("rel")===(T.rel==null?null:T.rel)&&$.getAttribute("title")===(T.title==null?null:T.title)&&$.getAttribute("crossorigin")===(T.crossOrigin==null?null:T.crossOrigin)){ce.splice(Ae,1);break t}}$=N.createElement(M),Da($,M,T),N.head.appendChild($);break;case"meta":if(ce=i1("meta","content",N).get(M+(T.content||""))){for(Ae=0;Ae<ce.length;Ae++)if($=ce[Ae],$.getAttribute("content")===(T.content==null?null:""+T.content)&&$.getAttribute("name")===(T.name==null?null:T.name)&&$.getAttribute("property")===(T.property==null?null:T.property)&&$.getAttribute("http-equiv")===(T.httpEquiv==null?null:T.httpEquiv)&&$.getAttribute("charset")===(T.charSet==null?null:T.charSet)){ce.splice(Ae,1);break t}}$=N.createElement(M),Da($,M,T),N.head.appendChild($);break;default:throw Error(l(468,M))}$[te]=f,gr($),M=$}f.stateNode=M}else n1(N,f.type,f.stateNode);else f.stateNode=g0(N,M,f.memoizedProps);else $!==M?($===null?T.stateNode!==null&&(T=T.stateNode,T.parentNode.removeChild(T)):$.count--,M===null?n1(N,f.type,f.stateNode):g0(N,M,f.memoizedProps)):M===null&&f.stateNode!==null&&Ca(f,f.memoizedProps,T.memoizedProps)}break;case 27:V(y,f),W(f),M&512&&(mo||T===null||cs(T,T.return)),T!==null&&M&4&&Ca(f,f.memoizedProps,T.memoizedProps);break;case 5:if(V(y,f),W(f),M&512&&(mo||T===null||cs(T,T.return)),f.flags&32){N=f.stateNode;try{ja(N,"")}catch(kt){Qn(f,f.return,kt)}}M&4&&f.stateNode!=null&&(N=f.memoizedProps,Ca(f,N,T!==null?T.memoizedProps:N)),M&1024&&(jg=!0);break;case 6:if(V(y,f),W(f),M&4){if(f.stateNode===null)throw Error(l(162));M=f.memoizedProps,T=f.stateNode;try{T.nodeValue=M}catch(kt){Qn(f,f.return,kt)}}break;case 3:if(l_=null,N=X,X=Zm(y.containerInfo),V(y,f),X=N,W(f),M&4&&T!==null&&T.memoizedState.isDehydrated)try{Zp(y.containerInfo)}catch(kt){Qn(f,f.return,kt)}jg&&(jg=!1,re(f));break;case 4:M=X,X=Zm(f.stateNode.containerInfo),V(y,f),W(f),X=M;break;case 12:V(y,f),W(f);break;case 13:V(y,f),W(f),f.child.flags&8192&&f.memoizedState!==null!=(T!==null&&T.memoizedState!==null)&&(fi=Zo()),M&4&&(M=f.updateQueue,M!==null&&(f.updateQueue=null,H(f,M)));break;case 22:N=f.memoizedState!==null;var Ye=T!==null&&T.memoizedState!==null,Mt=Bo,Wt=mo;if(Bo=Mt||N,mo=Wt||Ye,V(y,f),mo=Wt,Bo=Mt,W(f),M&8192)e:for(y=f.stateNode,y._visibility=N?y._visibility&-2:y._visibility|1,N&&(T===null||Ye||Bo||mo||ae(f)),T=null,y=f;;){if(y.tag===5||y.tag===26){if(T===null){Ye=T=y;try{if($=Ye.stateNode,N)ce=$.style,typeof ce.setProperty=="function"?ce.setProperty("display","none","important"):ce.display="none";else{Ae=Ye.stateNode;var ir=Ye.memoizedProps.style,zt=ir!=null&&ir.hasOwnProperty("display")?ir.display:null;Ae.style.display=zt==null||typeof zt=="boolean"?"":(""+zt).trim()}}catch(kt){Qn(Ye,Ye.return,kt)}}}else if(y.tag===6){if(T===null){Ye=y;try{Ye.stateNode.nodeValue=N?"":Ye.memoizedProps}catch(kt){Qn(Ye,Ye.return,kt)}}}else if((y.tag!==22&&y.tag!==23||y.memoizedState===null||y===f)&&y.child!==null){y.child.return=y,y=y.child;continue}if(y===f)break e;for(;y.sibling===null;){if(y.return===null||y.return===f)break e;T===y&&(T=null),y=y.return}T===y&&(T=null),y.sibling.return=y.return,y=y.sibling}M&4&&(M=f.updateQueue,M!==null&&(T=M.retryQueue,T!==null&&(M.retryQueue=null,H(f,T))));break;case 19:V(y,f),W(f),M&4&&(M=f.updateQueue,M!==null&&(f.updateQueue=null,H(f,M)));break;case 30:break;case 21:break;default:V(y,f),W(f)}}function W(f){var y=f.flags;if(y&2){try{for(var T,M=f.return;M!==null;){if(wu(M)){T=M;break}M=M.return}if(T==null)throw Error(l(160));switch(T.tag){case 27:var N=T.stateNode,$=zl(f);Ls(f,$,N);break;case 5:var ce=T.stateNode;T.flags&32&&(ja(ce,""),T.flags&=-33);var Ae=zl(f);Ls(f,Ae,ce);break;case 3:case 4:var Ye=T.stateNode.containerInfo,Mt=zl(f);ol(f,Mt,Ye);break;default:throw Error(l(161))}}catch(Wt){Qn(f,f.return,Wt)}f.flags&=-3}y&4096&&(f.flags&=-4097)}function re(f){if(f.subtreeFlags&1024)for(f=f.child;f!==null;){var y=f;re(y),y.tag===5&&y.flags&1024&&y.stateNode.reset(),f=f.sibling}}function K(f,y){if(y.subtreeFlags&8772)for(y=y.child;y!==null;)p(f,y.alternate,y),y=y.sibling}function ae(f){for(f=f.child;f!==null;){var y=f;switch(y.tag){case 0:case 11:case 14:case 15:bu(4,y,y.return),ae(y);break;case 1:cs(y,y.return);var T=y.stateNode;typeof T.componentWillUnmount=="function"&&Ug(y,y.return,T),ae(y);break;case 27:Ed(y.stateNode);case 26:case 5:cs(y,y.return),ae(y);break;case 22:y.memoizedState===null&&ae(y);break;case 30:ae(y);break;default:ae(y)}f=f.sibling}}function ue(f,y,T){for(T=T&&(y.subtreeFlags&8772)!==0,y=y.child;y!==null;){var M=y.alternate,N=f,$=y,ce=$.flags;switch($.tag){case 0:case 11:case 15:ue(N,$,T),df(4,$);break;case 1:if(ue(N,$,T),M=$,N=M.stateNode,typeof N.componentDidMount=="function")try{N.componentDidMount()}catch(Mt){Qn(M,M.return,Mt)}if(M=$,N=M.updateQueue,N!==null){var Ae=M.stateNode;try{var Ye=N.shared.hiddenCallbacks;if(Ye!==null)for(N.shared.hiddenCallbacks=null,N=0;N<Ye.length;N++)fp(Ye[N],Ae)}catch(Mt){Qn(M,M.return,Mt)}}T&&ce&64&&pf($),wd($,$.return);break;case 27:Su($);case 26:case 5:ue(N,$,T),T&&M===null&&ce&4&&mf($),wd($,$.return);break;case 12:ue(N,$,T);break;case 13:ue(N,$,T),T&&ce&4&&z(N,$);break;case 22:$.memoizedState===null&&ue(N,$,T),wd($,$.return);break;case 30:break;default:ue(N,$,T)}y=y.sibling}}function fe(f,y){var T=null;f!==null&&f.memoizedState!==null&&f.memoizedState.cachePool!==null&&(T=f.memoizedState.cachePool.pool),f=null,y.memoizedState!==null&&y.memoizedState.cachePool!==null&&(f=y.memoizedState.cachePool.pool),f!==T&&(f!=null&&f.refCount++,T!=null&&jh(T))}function xe(f,y){f=null,y.alternate!==null&&(f=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==f&&(y.refCount++,f!=null&&jh(f))}function ge(f,y,T,M){if(y.subtreeFlags&10256)for(y=y.child;y!==null;)Te(f,y,T,M),y=y.sibling}function Te(f,y,T,M){var N=y.flags;switch(y.tag){case 0:case 11:case 15:ge(f,y,T,M),N&2048&&df(9,y);break;case 1:ge(f,y,T,M);break;case 3:ge(f,y,T,M),N&2048&&(f=null,y.alternate!==null&&(f=y.alternate.memoizedState.cache),y=y.memoizedState.cache,y!==f&&(y.refCount++,f!=null&&jh(f)));break;case 12:if(N&2048){ge(f,y,T,M),f=y.stateNode;try{var $=y.memoizedProps,ce=$.id,Ae=$.onPostCommit;typeof Ae=="function"&&Ae(ce,y.alternate===null?"mount":"update",f.passiveEffectDuration,-0)}catch(Ye){Qn(y,y.return,Ye)}}else ge(f,y,T,M);break;case 13:ge(f,y,T,M);break;case 23:break;case 22:$=y.stateNode,ce=y.alternate,y.memoizedState!==null?$._visibility&2?ge(f,y,T,M):_e(f,y):$._visibility&2?ge(f,y,T,M):($._visibility|=2,ye(f,y,T,M,(y.subtreeFlags&10256)!==0)),N&2048&&fe(ce,y);break;case 24:ge(f,y,T,M),N&2048&&xe(y.alternate,y);break;default:ge(f,y,T,M)}}function ye(f,y,T,M,N){for(N=N&&(y.subtreeFlags&10256)!==0,y=y.child;y!==null;){var $=f,ce=y,Ae=T,Ye=M,Mt=ce.flags;switch(ce.tag){case 0:case 11:case 15:ye($,ce,Ae,Ye,N),df(8,ce);break;case 23:break;case 22:var Wt=ce.stateNode;ce.memoizedState!==null?Wt._visibility&2?ye($,ce,Ae,Ye,N):_e($,ce):(Wt._visibility|=2,ye($,ce,Ae,Ye,N)),N&&Mt&2048&&fe(ce.alternate,ce);break;case 24:ye($,ce,Ae,Ye,N),N&&Mt&2048&&xe(ce.alternate,ce);break;default:ye($,ce,Ae,Ye,N)}y=y.sibling}}function _e(f,y){if(y.subtreeFlags&10256)for(y=y.child;y!==null;){var T=f,M=y,N=M.flags;switch(M.tag){case 22:_e(T,M),N&2048&&fe(M.alternate,M);break;case 24:_e(T,M),N&2048&&xe(M.alternate,M);break;default:_e(T,M)}y=y.sibling}}var Se=8192;function He(f){if(f.subtreeFlags&Se)for(f=f.child;f!==null;)ze(f),f=f.sibling}function ze(f){switch(f.tag){case 26:He(f),f.flags&Se&&f.memoizedState!==null&&Ym(X,f.memoizedState,f.memoizedProps);break;case 5:He(f);break;case 3:case 4:var y=X;X=Zm(f.stateNode.containerInfo),He(f),X=y;break;case 22:f.memoizedState===null&&(y=f.alternate,y!==null&&y.memoizedState!==null?(y=Se,Se=16777216,He(f),Se=y):He(f));break;default:He(f)}}function nt(f){var y=f.alternate;if(y!==null&&(f=y.child,f!==null)){y.child=null;do y=f.sibling,f.sibling=null,f=y;while(f!==null)}}function Ge(f){var y=f.deletions;if((f.flags&16)!==0){if(y!==null)for(var T=0;T<y.length;T++){var M=y[T];i=M,qe(M,f)}nt(f)}if(f.subtreeFlags&10256)for(f=f.child;f!==null;)tt(f),f=f.sibling}function tt(f){switch(f.tag){case 0:case 11:case 15:Ge(f),f.flags&2048&&bu(9,f,f.return);break;case 3:Ge(f);break;case 12:Ge(f);break;case 22:var y=f.stateNode;f.memoizedState!==null&&y._visibility&2&&(f.return===null||f.return.tag!==13)?(y._visibility&=-3,It(f)):Ge(f);break;default:Ge(f)}}function It(f){var y=f.deletions;if((f.flags&16)!==0){if(y!==null)for(var T=0;T<y.length;T++){var M=y[T];i=M,qe(M,f)}nt(f)}for(f=f.child;f!==null;){switch(y=f,y.tag){case 0:case 11:case 15:bu(8,y,y.return),It(y);break;case 22:T=y.stateNode,T._visibility&2&&(T._visibility&=-3,It(y));break;default:It(y)}f=f.sibling}}function qe(f,y){for(;i!==null;){var T=i;switch(T.tag){case 0:case 11:case 15:bu(8,T,y);break;case 23:case 22:if(T.memoizedState!==null&&T.memoizedState.cachePool!==null){var M=T.memoizedState.cachePool.pool;M!=null&&M.refCount++}break;case 24:jh(T.memoizedState.cache)}if(M=T.child,M!==null)M.return=T,i=M;else e:for(T=f;i!==null;){M=i;var N=M.sibling,$=M.return;if(x(M),M===T){i=null;break e}if(N!==null){N.return=$,i=N;break e}i=$}}}var Oe={getCacheForType:function(f){var y=Oo(Zn),T=y.data.get(f);return T===void 0&&(T=f(),y.data.set(f,T)),T}},ot=typeof WeakMap=="function"?WeakMap:Map,je=0,at=null,ht=null,wt=0,ft=0,pt=null,rr=!1,tr=!1,or=!1,Qt=0,fr=0,Mr=0,Or=0,Si=0,wr=0,ii=0,hi=null,_i=null,Lr=!1,fi=0,li=1/0,di=null,Fi=null,Ii=0,In=null,Ui=null,Pr=0,br=0,Ti=null,vn=null,Xi=0,Bn=null;function xn(){if((je&2)!==0&&wt!==0)return wt&-wt;if(Ot.T!==null){var f=Tl;return f!==0?f:Tu()}return Ud()}function $a(){wr===0&&(wr=(wt&536870912)===0||un?xo():536870912);var f=Po.current;return f!==null&&(f.flags|=32),wr}function Wn(f,y,T){(f===at&&(ft===2||ft===9)||f.cancelPendingCommit!==null)&&(fn(f,0),zo(f,wt,wr,!1)),ya(f,T),((je&2)===0||f!==at)&&(f===at&&((je&2)===0&&(Or|=T),fr===4&&zo(f,wt,wr,!1)),zs(f))}function Ia(f,y,T){if((je&6)!==0)throw Error(l(327));var M=!T&&(y&124)===0&&(y&f.expiredLanes)===0||Zs(f,y),N=M?Oc(f,y):Ao(f,y,!0),$=M;do{if(N===0){tr&&!M&&zo(f,y,0,!1);break}else{if(T=f.current.alternate,$&&!da(T)){N=Ao(f,y,!1),$=!1;continue}if(N===2){if($=y,f.errorRecoveryDisabledLanes&$)var ce=0;else ce=f.pendingLanes&-536870913,ce=ce!==0?ce:ce&536870912?536870912:0;if(ce!==0){y=ce;e:{var Ae=f;N=hi;var Ye=Ae.current.memoizedState.isDehydrated;if(Ye&&(fn(Ae,ce).flags|=256),ce=Ao(Ae,ce,!1),ce!==2){if(or&&!Ye){Ae.errorRecoveryDisabledLanes|=$,Or|=$,N=4;break e}$=_i,_i=N,$!==null&&(_i===null?_i=$:_i.push.apply(_i,$))}N=ce}if($=!1,N!==2)continue}}if(N===1){fn(f,0),zo(f,y,0,!0);break}e:{switch(M=f,$=N,$){case 0:case 1:throw Error(l(345));case 4:if((y&4194048)!==y)break;case 6:zo(M,y,wr,!rr);break e;case 2:_i=null;break;case 3:case 5:break;default:throw Error(l(329))}if((y&62914560)===y&&(N=fi+300-Zo(),10<N)){if(zo(M,y,wr,!rr),vs(M,0,!0)!==0)break e;M.timeoutHandle=$y(Ra.bind(null,M,T,_i,di,Lr,y,wr,Or,ii,rr,$,2,-0,0),N);break e}Ra(M,T,_i,di,Lr,y,wr,Or,ii,rr,$,0,-0,0)}}break}while(!0);zs(f)}function Ra(f,y,T,M,N,$,ce,Ae,Ye,Mt,Wt,ir,zt,kt){if(f.timeoutHandle=-1,ir=y.subtreeFlags,(ir&8192||(ir&16785408)===16785408)&&(Wm={stylesheets:null,count:0,unsuspend:ox},ze(y),ir=a1(),ir!==null)){f.cancelPendingCommit=ir(sl.bind(null,f,y,$,T,M,N,ce,Ae,Ye,Wt,1,zt,kt)),zo(f,$,ce,!Mt);return}sl(f,y,$,T,M,N,ce,Ae,Ye)}function da(f){for(var y=f;;){var T=y.tag;if((T===0||T===11||T===15)&&y.flags&16384&&(T=y.updateQueue,T!==null&&(T=T.stores,T!==null)))for(var M=0;M<T.length;M++){var N=T[M],$=N.getSnapshot;N=N.value;try{if(!Ha($(),N))return!1}catch{return!1}}if(T=y.child,y.subtreeFlags&16384&&T!==null)T.return=y,y=T;else{if(y===f)break;for(;y.sibling===null;){if(y.return===null||y.return===f)return!0;y=y.return}y.sibling.return=y.return,y=y.sibling}}return!0}function zo(f,y,T,M){y&=~Si,y&=~Or,f.suspendedLanes|=y,f.pingedLanes&=~y,M&&(f.warmLanes|=y),M=f.expirationTimes;for(var N=y;0<N;){var $=31-vo(N),ce=1<<$;M[$]=-1,N&=~ce}T!==0&&Ch(f,T,y)}function Xa(){return(je&6)===0?(gf(0),!1):!0}function bn(){if(ht!==null){if(ft===0)var f=ht.return;else f=ht,Sl=lu=null,$t(f),ss=null,rl=0,f=ht;for(;f!==null;)ff(f.alternate,f),f=f.return;ht=null}}function fn(f,y){var T=f.timeoutHandle;T!==-1&&(f.timeoutHandle=-1,ex(T)),T=f.cancelPendingCommit,T!==null&&(f.cancelPendingCommit=null,T()),bn(),at=f,ht=T=dc(f.current,null),wt=y,ft=0,pt=null,rr=!1,tr=Zs(f,y),or=!1,ii=wr=Si=Or=Mr=fr=0,_i=hi=null,Lr=!1,(y&8)!==0&&(y|=y&32);var M=f.entangledLanes;if(M!==0)for(f=f.entanglements,M&=y;0<M;){var N=31-vo(M),$=1<<N;y|=f[N],M&=~$}return Qt=y,kh(),T}function rn(f,y){Di=null,Ot.H=Ic,y===qh||y===Al?(y=Dg(),ft=3):y===cp?(y=Dg(),ft=4):ft=y===Cp?8:y!==null&&typeof y=="object"&&typeof y.then=="function"?6:1,pt=y,ht===null&&(fr=1,cf(f,Sa(y,f.current)))}function Yn(){var f=Ot.H;return Ot.H=Ic,f===null?Ic:f}function lo(){var f=Ot.A;return Ot.A=Oe,f}function Rn(){fr=4,rr||(wt&4194048)!==wt&&Po.current!==null||(tr=!0),(Mr&134217727)===0&&(Or&134217727)===0||at===null||zo(at,wt,wr,!1)}function Ao(f,y,T){var M=je;je|=2;var N=Yn(),$=lo();(at!==f||wt!==y)&&(di=null,fn(f,y)),y=!1;var ce=fr;e:do try{if(ft!==0&&ht!==null){var Ae=ht,Ye=pt;switch(ft){case 8:bn(),ce=6;break e;case 3:case 2:case 9:case 6:Po.current===null&&(y=!0);var Mt=ft;if(ft=0,pt=null,Ma(f,Ae,Ye,Mt),T&&tr){ce=0;break e}break;default:Mt=ft,ft=0,pt=null,Ma(f,Ae,Ye,Mt)}}Fl(),ce=fr;break}catch(Wt){rn(f,Wt)}while(!0);return y&&f.shellSuspendCounter++,Sl=lu=null,je=M,Ot.H=N,Ot.A=$,ht===null&&(at=null,wt=0,kh()),ce}function Fl(){for(;ht!==null;)Pc(ht)}function Oc(f,y){var T=je;je|=2;var M=Yn(),N=lo();at!==f||wt!==y?(di=null,li=Zo()+500,fn(f,y)):tr=Zs(f,y);e:do try{if(ft!==0&&ht!==null){y=ht;var $=pt;t:switch(ft){case 1:ft=0,pt=null,Ma(f,y,$,1);break;case 2:case 9:if(Mg($)){ft=0,pt=null,Lc(y);break}y=function(){ft!==2&&ft!==9||at!==f||(ft=7),zs(f)},$.then(y,y);break e;case 3:ft=7;break e;case 4:ft=5;break e;case 7:Mg($)?(ft=0,pt=null,Lc(y)):(ft=0,pt=null,Ma(f,y,$,7));break;case 5:var ce=null;switch(ht.tag){case 26:ce=ht.memoizedState;case 5:case 27:var Ae=ht;if(!ce||o1(ce)){ft=0,pt=null;var Ye=Ae.sibling;if(Ye!==null)ht=Ye;else{var Mt=Ae.return;Mt!==null?(ht=Mt,Bc(Mt)):ht=null}break t}}ft=0,pt=null,Ma(f,y,$,5);break;case 6:ft=0,pt=null,Ma(f,y,$,6);break;case 8:bn(),fr=6;break e;default:throw Error(l(462))}}al();break}catch(Wt){rn(f,Wt)}while(!0);return Sl=lu=null,Ot.H=M,Ot.A=N,je=T,ht!==null?0:(at=null,wt=0,kh(),fr)}function al(){for(;ht!==null&&!On();)Pc(ht)}function Pc(f){var y=Bp(f.alternate,f,Qt);f.memoizedProps=f.pendingProps,y===null?Bc(f):ht=y}function Lc(f){var y=f,T=y.alternate;switch(y.tag){case 15:case 0:y=km(T,y,y.pendingProps,y.type,void 0,wt);break;case 11:y=km(T,y,y.pendingProps,y.type.render,y.ref,wt);break;case 5:$t(y);default:ff(T,y),y=ht=Rg(y,Qt),y=Bp(T,y,Qt)}f.memoizedProps=f.pendingProps,y===null?Bc(f):ht=y}function Ma(f,y,T,M){Sl=lu=null,$t(y),ss=null,rl=0;var N=y.return;try{if(Ep(f,N,y,T,wt)){fr=1,cf(f,Sa(T,f.current)),ht=null;return}}catch($){if(N!==null)throw ht=N,$;fr=1,cf(f,Sa(T,f.current)),ht=null;return}y.flags&32768?(un||M===1?f=!0:tr||(wt&536870912)!==0?f=!1:(rr=f=!0,(M===2||M===9||M===3||M===6)&&(M=Po.current,M!==null&&M.tag===13&&(M.flags|=16384))),kl(y,f)):Bc(y)}function Bc(f){var y=f;do{if((y.flags&32768)!==0){kl(y,rr);return}f=y.return;var T=Bl(y.alternate,y,Qt);if(T!==null){ht=T;return}if(y=y.sibling,y!==null){ht=y;return}ht=y=f}while(y!==null);fr===0&&(fr=5)}function kl(f,y){do{var T=bd(f.alternate,f);if(T!==null){T.flags&=32767,ht=T;return}if(T=f.return,T!==null&&(T.flags|=32768,T.subtreeFlags=0,T.deletions=null),!y&&(f=f.sibling,f!==null)){ht=f;return}ht=f=T}while(f!==null);fr=6,ht=null}function sl(f,y,T,M,N,$,ce,Ae,Ye){f.cancelPendingCommit=null;do Gg();while(Ii!==0);if((je&6)!==0)throw Error(l(327));if(y!==null){if(y===f.current)throw Error(l(177));if($=y.lanes|y.childLanes,$|=Bt,Of(f,T,$,ce,Ae,Ye),f===at&&(ht=at=null,wt=0),Ui=y,In=f,Pr=T,br=$,Ti=N,vn=M,(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?(f.callbackNode=null,f.callbackPriority=0,r0(Wo,function(){return Fy(),null})):(f.callbackNode=null,f.callbackPriority=0),M=(y.flags&13878)!==0,(y.subtreeFlags&13878)!==0||M){M=Ot.T,Ot.T=null,N=sr.p,sr.p=2,ce=je,je|=4;try{c(f,y,T)}finally{je=ce,sr.p=N,Ot.T=M}}Ii=1,Nl(),Sd(),ta()}}function Nl(){if(Ii===1){Ii=0;var f=In,y=Ui,T=(y.flags&13878)!==0;if((y.subtreeFlags&13878)!==0||T){T=Ot.T,Ot.T=null;var M=sr.p;sr.p=2;var N=je;je|=4;try{Y(y,f);var $=ph,ce=Ts(f.containerInfo),Ae=$.focusedElem,Ye=$.selectionRange;if(ce!==Ae&&Ae&&Ae.ownerDocument&&Yu(Ae.ownerDocument.documentElement,Ae)){if(Ye!==null&&xm(Ae)){var Mt=Ye.start,Wt=Ye.end;if(Wt===void 0&&(Wt=Mt),"selectionStart"in Ae)Ae.selectionStart=Mt,Ae.selectionEnd=Math.min(Wt,Ae.value.length);else{var ir=Ae.ownerDocument||document,zt=ir&&ir.defaultView||window;if(zt.getSelection){var kt=zt.getSelection(),xi=Ae.textContent.length,ni=Math.min(Ye.start,xi),wn=Ye.end===void 0?ni:Math.min(Ye.end,xi);!kt.extend&&ni>wn&&(ce=wn,wn=ni,ni=ce);var mt=Zf(Ae,ni),st=Zf(Ae,wn);if(mt&&st&&(kt.rangeCount!==1||kt.anchorNode!==mt.node||kt.anchorOffset!==mt.offset||kt.focusNode!==st.node||kt.focusOffset!==st.offset)){var bt=ir.createRange();bt.setStart(mt.node,mt.offset),kt.removeAllRanges(),ni>wn?(kt.addRange(bt),kt.extend(st.node,st.offset)):(bt.setEnd(st.node,st.offset),kt.addRange(bt))}}}}for(ir=[],kt=Ae;kt=kt.parentNode;)kt.nodeType===1&&ir.push({element:kt,left:kt.scrollLeft,top:kt.scrollTop});for(typeof Ae.focus=="function"&&Ae.focus(),Ae=0;Ae<ir.length;Ae++){var Jt=ir[Ae];Jt.element.scrollLeft=Jt.left,Jt.element.scrollTop=Jt.top}}Jm=!!e_,ph=e_=null}finally{je=N,sr.p=M,Ot.T=T}}f.current=y,Ii=2}}function Sd(){if(Ii===2){Ii=0;var f=In,y=Ui,T=(y.flags&8772)!==0;if((y.subtreeFlags&8772)!==0||T){T=Ot.T,Ot.T=null;var M=sr.p;sr.p=2;var N=je;je|=4;try{p(f,y.alternate,y)}finally{je=N,sr.p=M,Ot.T=T}}Ii=3}}function ta(){if(Ii===4||Ii===3){Ii=0,Mf();var f=In,y=Ui,T=Pr,M=vn;(y.subtreeFlags&10256)!==0||(y.flags&10256)!==0?Ii=5:(Ii=0,Ui=In=null,Td(f,f.pendingLanes));var N=f.pendingLanes;if(N===0&&(Fi=null),Ws(T),y=y.stateNode,$n&&typeof $n.onCommitFiberRoot=="function")try{$n.onCommitFiberRoot(Ro,y,void 0,(y.current.flags&128)===128)}catch{}if(M!==null){y=Ot.T,N=sr.p,sr.p=2,Ot.T=null;try{for(var $=f.onRecoverableError,ce=0;ce<M.length;ce++){var Ae=M[ce];$(Ae.value,{componentStack:Ae.stack})}}finally{Ot.T=y,sr.p=N}}(Pr&3)!==0&&Gg(),zs(f),N=f.pendingLanes,(T&4194090)!==0&&(N&42)!==0?f===Bn?Xi++:(Xi=0,Bn=f):Xi=0,gf(0)}}function Td(f,y){(f.pooledCacheLanes&=y)===0&&(y=f.pooledCache,y!=null&&(f.pooledCache=null,jh(y)))}function Gg(f){return Nl(),Sd(),ta(),Fy()}function Fy(){if(Ii!==5)return!1;var f=In,y=br;br=0;var T=Ws(Pr),M=Ot.T,N=sr.p;try{sr.p=32>T?32:T,Ot.T=null,T=Ti,Ti=null;var $=In,ce=Pr;if(Ii=0,Ui=In=null,Pr=0,(je&6)!==0)throw Error(l(331));var Ae=je;if(je|=4,tt($.current),Te($,$.current,ce,T),je=Ae,gf(0,!1),$n&&typeof $n.onPostCommitFiberRoot=="function")try{$n.onPostCommitFiberRoot(Ro,$)}catch{}return!0}finally{sr.p=N,Ot.T=M,Td(f,y)}}function Gm(f,y,T){y=Sa(T,y),y=uh(f.stateNode,y,2),f=Cl(f,y,2),f!==null&&(ya(f,2),zs(f))}function Qn(f,y,T){if(f.tag===3)Gm(f,f,T);else for(;y!==null;){if(y.tag===3){Gm(y,f,T);break}else if(y.tag===1){var M=y.stateNode;if(typeof y.type.getDerivedStateFromError=="function"||typeof M.componentDidCatch=="function"&&(Fi===null||!Fi.has(M))){f=Sa(T,f),T=hh(2),M=Cl(y,T,2),M!==null&&(gd(T,M,y,f),ya(M,2),zs(M));break}}y=y.return}}function Hg(f,y,T){var M=f.pingCache;if(M===null){M=f.pingCache=new ot;var N=new Set;M.set(y,N)}else N=M.get(y),N===void 0&&(N=new Set,M.set(y,N));N.has(T)||(or=!0,N.add(T),f=qg.bind(null,f,y,T),y.then(f,f))}function qg(f,y,T){var M=f.pingCache;M!==null&&M.delete(y),f.pingedLanes|=f.suspendedLanes&T,f.warmLanes&=~T,at===f&&(wt&T)===T&&(fr===4||fr===3&&(wt&62914560)===wt&&300>Zo()-fi?(je&2)===0&&fn(f,0):Si|=T,ii===wt&&(ii=0)),zs(f)}function ky(f,y){y===0&&(y=Eh()),f=bl(f,y),f!==null&&(ya(f,y),zs(f))}function Ny(f){var y=f.memoizedState,T=0;y!==null&&(T=y.retryLane),ky(f,T)}function Yv(f,y){var T=0;switch(f.tag){case 13:var M=f.stateNode,N=f.memoizedState;N!==null&&(T=N.retryLane);break;case 19:M=f.stateNode;break;case 22:M=f.stateNode._retryCache;break;default:throw Error(l(314))}M!==null&&M.delete(y),ky(f,T)}function r0(f,y){return zu(f,y)}var ll=null,Bs=null,$g=!1,Hm=!1,zp=!1,dh=0;function zs(f){f!==Bs&&f.next===null&&(Bs===null?ll=Bs=f:Bs=Bs.next=f),Hm=!0,$g||($g=!0,Uy())}function gf(f,y){if(!zp&&Hm){zp=!0;do for(var T=!1,M=ll;M!==null;){if(f!==0){var N=M.pendingLanes;if(N===0)var $=0;else{var ce=M.suspendedLanes,Ae=M.pingedLanes;$=(1<<31-vo(42|f)+1)-1,$&=N&~(ce&~Ae),$=$&201326741?$&201326741|1:$?$|2:0}$!==0&&(T=!0,i0(M,$))}else $=wt,$=vs(M,M===at?$:0,M.cancelPendingCommit!==null||M.timeoutHandle!==-1),($&3)===0||Zs(M,$)||(T=!0,i0(M,$));M=M.next}while(T);zp=!1}}function Vy(){qm()}function qm(){Hm=$g=!1;var f=0;dh!==0&&(Jv()&&(f=dh),dh=0);for(var y=Zo(),T=null,M=ll;M!==null;){var N=M.next,$=Xg(M,y);$===0?(M.next=null,T===null?ll=N:T.next=N,N===null&&(Bs=T)):(T=M,(f!==0||($&3)!==0)&&(Hm=!0)),M=N}gf(f)}function Xg(f,y){for(var T=f.suspendedLanes,M=f.pingedLanes,N=f.expirationTimes,$=f.pendingLanes&-62914561;0<$;){var ce=31-vo($),Ae=1<<ce,Ye=N[ce];Ye===-1?((Ae&T)===0||(Ae&M)!==0)&&(N[ce]=gn(Ae,y)):Ye<=y&&(f.expiredLanes|=Ae),$&=~Ae}if(y=at,T=wt,T=vs(f,f===y?T:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),M=f.callbackNode,T===0||f===y&&(ft===2||ft===9)||f.cancelPendingCommit!==null)return M!==null&&M!==null&&Va(M),f.callbackNode=null,f.callbackPriority=0;if((T&3)===0||Zs(f,T)){if(y=T&-T,y===f.callbackPriority)return y;switch(M!==null&&Va(M),Ws(T)){case 2:case 8:T=Zl;break;case 32:T=Wo;break;case 268435456:T=_l;break;default:T=Wo}return M=Zg.bind(null,f),T=zu(T,M),f.callbackPriority=y,f.callbackNode=T,y}return M!==null&&M!==null&&Va(M),f.callbackPriority=2,f.callbackNode=null,2}function Zg(f,y){if(Ii!==0&&Ii!==5)return f.callbackNode=null,f.callbackPriority=0,null;var T=f.callbackNode;if(Gg()&&f.callbackNode!==T)return null;var M=wt;return M=vs(f,f===at?M:0,f.cancelPendingCommit!==null||f.timeoutHandle!==-1),M===0?null:(Ia(f,M,y),Xg(f,Zo()),f.callbackNode!=null&&f.callbackNode===T?Zg.bind(null,f):null)}function i0(f,y){if(Gg())return null;Ia(f,y,!0)}function Uy(){tx(function(){(je&6)!==0?zu(na,Vy):qm()})}function Tu(){return dh===0&&(dh=xo()),dh}function n0(f){return f==null||typeof f=="symbol"||typeof f=="boolean"?null:typeof f=="function"?f:qc(""+f)}function Wg(f,y){var T=y.ownerDocument.createElement("input");return T.name=y.name,T.value=y.value,f.id&&T.setAttribute("form",f.id),y.parentNode.insertBefore(T,y),f=new FormData(f),T.parentNode.removeChild(T),f}function jy(f,y,T,M,N){if(y==="submit"&&T&&T.stateNode===N){var $=n0((N[oe]||null).action),ce=M.submitter;ce&&(y=(y=ce[oe]||null)?n0(y.formAction):ce.getAttribute("formAction"),y!==null&&($=y,ce=null));var Ae=new Uf("action","action",null,M,N);f.push({event:Ae,listeners:[{instance:null,listener:function(){if(M.defaultPrevented){if(dh!==0){var Ye=ce?Wg(N,ce):new FormData(N);rf(T,{pending:!0,data:Ye,method:N.method,action:$},null,Ye)}}else typeof $=="function"&&(Ae.preventDefault(),Ye=ce?Wg(N,ce):new FormData(N),rf(T,{pending:!0,data:Ye,method:N.method,action:$},$,Ye))},currentTarget:N}]})}}for(var o0=0;o0<eu.length;o0++){var a0=eu[o0],Qv=a0.toLowerCase(),Gy=a0[0].toUpperCase()+a0.slice(1);ca(Qv,"on"+Gy)}ca(ns,"onAnimationEnd"),ca(wm,"onAnimationIteration"),ca(Sm,"onAnimationStart"),ca("dblclick","onDoubleClick"),ca("focusin","onFocus"),ca("focusout","onBlur"),ca(Ig,"onTransitionRun"),ca(Ju,"onTransitionStart"),ca(Wf,"onTransitionCancel"),ca(Zd,"onTransitionEnd"),Ri("onMouseEnter",["mouseout","mouseover"]),Ri("onMouseLeave",["mouseout","mouseover"]),Ri("onPointerEnter",["pointerout","pointerover"]),Ri("onPointerLeave",["pointerout","pointerover"]),Yr("onChange","change click focusin focusout input keydown keyup selectionchange".split(" ")),Yr("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" ")),Yr("onBeforeInput",["compositionend","keypress","textInput","paste"]),Yr("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" ")),Yr("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" ")),Yr("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Fp="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),Kv=new Set("beforetoggle cancel close invalid load scroll scrollend toggle".split(" ").concat(Fp));function s0(f,y){y=(y&4)!==0;for(var T=0;T<f.length;T++){var M=f[T],N=M.event;M=M.listeners;e:{var $=void 0;if(y)for(var ce=M.length-1;0<=ce;ce--){var Ae=M[ce],Ye=Ae.instance,Mt=Ae.currentTarget;if(Ae=Ae.listener,Ye!==$&&N.isPropagationStopped())break e;$=Ae,N.currentTarget=Mt;try{$(N)}catch(Wt){vu(Wt)}N.currentTarget=null,$=Ye}else for(ce=0;ce<M.length;ce++){if(Ae=M[ce],Ye=Ae.instance,Mt=Ae.currentTarget,Ae=Ae.listener,Ye!==$&&N.isPropagationStopped())break e;$=Ae,N.currentTarget=Mt;try{$(N)}catch(Wt){vu(Wt)}N.currentTarget=null,$=Ye}}}}function nn(f,y){var T=y[Me];T===void 0&&(T=y[Me]=new Set);var M=f+"__bubble";T.has(M)||(c0(y,f,2,!1),T.add(M))}function l0(f,y,T){var M=0;y&&(M|=4),c0(T,f,M,y)}var $m="_reactListening"+Math.random().toString(36).slice(2);function Yg(f){if(!f[$m]){f[$m]=!0,Jr.forEach(function(T){T!=="selectionchange"&&(Kv.has(T)||l0(T,!1,f),l0(T,!0,f))});var y=f.nodeType===9?f:f.ownerDocument;y===null||y[$m]||(y[$m]=!0,l0("selectionchange",!1,y))}}function c0(f,y,T,M){switch(mh(y)){case 2:var N=x0;break;case 8:N=ax;break;default:N=b0}T=N.bind(null,y,T,f),N=void 0,!ai||y!=="touchstart"&&y!=="touchmove"&&y!=="wheel"||(N=!0),M?N!==void 0?f.addEventListener(y,T,{capture:!0,passive:N}):f.addEventListener(y,T,!0):N!==void 0?f.addEventListener(y,T,{passive:N}):f.addEventListener(y,T,!1)}function Qg(f,y,T,M,N){var $=M;if((y&1)===0&&(y&2)===0&&M!==null)e:for(;;){if(M===null)return;var ce=M.tag;if(ce===3||ce===4){var Ae=M.stateNode.containerInfo;if(Ae===N)break;if(ce===4)for(ce=M.return;ce!==null;){var Ye=ce.tag;if((Ye===3||Ye===4)&&ce.stateNode.containerInfo===N)return;ce=ce.return}for(;Ae!==null;){if(ce=Pt(Ae),ce===null)return;if(Ye=ce.tag,Ye===5||Ye===6||Ye===26||Ye===27){M=$=ce;continue e}Ae=Ae.parentNode}}M=M.return}Nf(function(){var Mt=$,Wt=$c(T),ir=[];e:{var zt=Wd.get(f);if(zt!==void 0){var kt=Uf,xi=f;switch(f){case"keypress":if(rc(T)===0)break e;case"keydown":case"keyup":kt=Ci;break;case"focusin":xi="focus",kt=Oh;break;case"focusout":xi="blur",kt=Oh;break;case"beforeblur":case"afterblur":kt=Oh;break;case"click":if(T.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":kt=Ga;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":kt=rs;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":kt=wi;break;case ns:case wm:case Sm:kt=Ei;break;case Zd:kt=Yc;break;case"scroll":case"scrollend":kt=Mh;break;case"wheel":kt=Ko;break;case"copy":case"cut":case"paste":kt=Eg;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":kt=ba;break;case"toggle":case"beforetoggle":kt=e0}var ni=(y&4)!==0,wn=!ni&&(f==="scroll"||f==="scrollend"),mt=ni?zt!==null?zt+"Capture":null:zt;ni=[];for(var st=Mt,bt;st!==null;){var Jt=st;if(bt=Jt.stateNode,Jt=Jt.tag,Jt!==5&&Jt!==26&&Jt!==27||bt===null||mt===null||(Jt=Vu(st,mt),Jt!=null&&ni.push(kp(st,Jt,bt))),wn)break;st=st.return}0<ni.length&&(zt=new kt(zt,xi,null,T,Wt),ir.push({event:zt,listeners:ni}))}}if((y&7)===0){e:{if(zt=f==="mouseover"||f==="pointerover",kt=f==="mouseout"||f==="pointerout",zt&&T!==Nu&&(xi=T.relatedTarget||T.fromElement)&&(Pt(xi)||xi[me]))break e;if((kt||zt)&&(zt=Wt.window===Wt?Wt:(zt=Wt.ownerDocument)?zt.defaultView||zt.parentWindow:window,kt?(xi=T.relatedTarget||T.toElement,kt=Mt,xi=xi?Pt(xi):null,xi!==null&&(wn=m(xi),ni=xi.tag,xi!==wn||ni!==5&&ni!==27&&ni!==6)&&(xi=null)):(kt=null,xi=Mt),kt!==xi)){if(ni=Ga,Jt="onMouseLeave",mt="onMouseEnter",st="mouse",(f==="pointerout"||f==="pointerover")&&(ni=ba,Jt="onPointerLeave",mt="onPointerEnter",st="pointer"),wn=kt==null?zt:lr(kt),bt=xi==null?zt:lr(xi),zt=new ni(Jt,st+"leave",kt,T,Wt),zt.target=wn,zt.relatedTarget=bt,Jt=null,Pt(Wt)===Mt&&(ni=new ni(mt,st+"enter",xi,T,Wt),ni.target=bt,ni.relatedTarget=wn,Jt=ni),wn=Jt,kt&&xi)t:{for(ni=kt,mt=xi,st=0,bt=ni;bt;bt=Ad(bt))st++;for(bt=0,Jt=mt;Jt;Jt=Ad(Jt))bt++;for(;0<st-bt;)ni=Ad(ni),st--;for(;0<bt-st;)mt=Ad(mt),bt--;for(;st--;){if(ni===mt||mt!==null&&ni===mt.alternate)break t;ni=Ad(ni),mt=Ad(mt)}ni=null}else ni=null;kt!==null&&Kg(ir,zt,kt,ni,!1),xi!==null&&wn!==null&&Kg(ir,wn,xi,ni,!0)}}e:{if(zt=Mt?lr(Mt):window,kt=zt.nodeName&&zt.nodeName.toLowerCase(),kt==="select"||kt==="input"&&zt.type==="file")var Ur=Tr;else if(kr(zt))if($d)Ur=Qc;else{Ur=lc;var Zi=vm}else kt=zt.nodeName,!kt||kt.toLowerCase()!=="input"||zt.type!=="checkbox"&&zt.type!=="radio"?Mt&&zf(Mt.elementType)&&(Ur=Tr):Ur=la;if(Ur&&(Ur=Ur(f,Mt))){qt(ir,Ur,T,Wt);break e}Zi&&Zi(f,zt,Mt),f==="focusout"&&Mt&&zt.type==="number"&&Mt.memoizedProps.value!=null&&Bf(zt,"number",zt.value)}switch(Zi=Mt?lr(Mt):window,f){case"focusin":(kr(Zi)||Zi.contentEditable==="true")&&(Qu=Zi,Bh=Mt,Kc=null);break;case"focusout":Kc=Bh=Qu=null;break;case"mousedown":vl=!0;break;case"contextmenu":case"mouseup":case"dragend":vl=!1,Jc(ir,T,Wt);break;case"selectionchange":if(Lh)break;case"keydown":case"keyup":Jc(ir,T,Wt)}var Gr;if(Hf)e:{switch(f){case"compositionstart":var si="onCompositionStart";break e;case"compositionend":si="onCompositionEnd";break e;case"compositionupdate":si="onCompositionUpdate";break e}si=void 0}else $u?Ss(f,T)&&(si="onCompositionEnd"):f==="keydown"&&T.keyCode===229&&(si="onCompositionStart");si&&(oc&&T.locale!=="ko"&&($u||si!=="onCompositionStart"?si==="onCompositionEnd"&&$u&&(Gr=tc()):(ec=Wt,jd="value"in ec?ec.value:ec.textContent,$u=!0)),Zi=Xm(Mt,si),0<Zi.length&&(si=new xr(si,f,null,T,Wt),ir.push({event:si,listeners:Zi}),Gr?si.data=Gr:(Gr=sa(T),Gr!==null&&(si.data=Gr)))),(Gr=qf?Ph(f,T):fo(f,T))&&(si=Xm(Mt,"onBeforeInput"),0<si.length&&(Zi=new xr("onBeforeInput","beforeinput",null,T,Wt),ir.push({event:Zi,listeners:si}),Zi.data=Gr)),jy(ir,f,Mt,T,Wt)}s0(ir,y)})}function kp(f,y,T){return{instance:f,listener:y,currentTarget:T}}function Xm(f,y){for(var T=y+"Capture",M=[];f!==null;){var N=f,$=N.stateNode;if(N=N.tag,N!==5&&N!==26&&N!==27||$===null||(N=Vu(f,T),N!=null&&M.unshift(kp(f,N,$)),N=Vu(f,y),N!=null&&M.push(kp(f,N,$))),f.tag===3)return M;f=f.return}return[]}function Ad(f){if(f===null)return null;do f=f.return;while(f&&f.tag!==5&&f.tag!==27);return f||null}function Kg(f,y,T,M,N){for(var $=y._reactName,ce=[];T!==null&&T!==M;){var Ae=T,Ye=Ae.alternate,Mt=Ae.stateNode;if(Ae=Ae.tag,Ye!==null&&Ye===M)break;Ae!==5&&Ae!==26&&Ae!==27||Mt===null||(Ye=Mt,N?(Mt=Vu(T,$),Mt!=null&&ce.unshift(kp(T,Mt,Ye))):N||(Mt=Vu(T,$),Mt!=null&&ce.push(kp(T,Mt,Ye)))),T=T.return}ce.length!==0&&f.push({event:y,listeners:ce})}var _f=/\r\n?/g,Ho=/\u0000|\uFFFD/g;function u0(f){return(typeof f=="string"?f:""+f).replace(_f,`
`).replace(Ho,"")}function Np(f,y){return y=u0(y),u0(f)===y}function Jg(){}function Hn(f,y,T,M,N,$){switch(T){case"children":typeof M=="string"?y==="body"||y==="textarea"&&M===""||ja(f,M):(typeof M=="number"||typeof M=="bigint")&&y!=="body"&&ja(f,""+M);break;case"className":mi(f,"class",M);break;case"tabIndex":mi(f,"tabindex",M);break;case"dir":case"role":case"viewBox":case"width":case"height":mi(f,T,M);break;case"style":Gc(f,M,$);break;case"data":if(y!=="object"){mi(f,"data",M);break}case"src":case"href":if(M===""&&(y!=="a"||T!=="href")){f.removeAttribute(T);break}if(M==null||typeof M=="function"||typeof M=="symbol"||typeof M=="boolean"){f.removeAttribute(T);break}M=qc(""+M),f.setAttribute(T,M);break;case"action":case"formAction":if(typeof M=="function"){f.setAttribute(T,"javascript:throw new Error('A React form was unexpectedly submitted. If you called form.submit() manually, consider using form.requestSubmit() instead. If you\\'re trying to use event.stopPropagation() in a submit event handler, consider also calling event.preventDefault().')");break}else typeof $=="function"&&(T==="formAction"?(y!=="input"&&Hn(f,y,"name",N.name,N,null),Hn(f,y,"formEncType",N.formEncType,N,null),Hn(f,y,"formMethod",N.formMethod,N,null),Hn(f,y,"formTarget",N.formTarget,N,null)):(Hn(f,y,"encType",N.encType,N,null),Hn(f,y,"method",N.method,N,null),Hn(f,y,"target",N.target,N,null)));if(M==null||typeof M=="symbol"||typeof M=="boolean"){f.removeAttribute(T);break}M=qc(""+M),f.setAttribute(T,M);break;case"onClick":M!=null&&(f.onclick=Jg);break;case"onScroll":M!=null&&nn("scroll",f);break;case"onScrollEnd":M!=null&&nn("scrollend",f);break;case"dangerouslySetInnerHTML":if(M!=null){if(typeof M!="object"||!("__html"in M))throw Error(l(61));if(T=M.__html,T!=null){if(N.children!=null)throw Error(l(60));f.innerHTML=T}}break;case"multiple":f.multiple=M&&typeof M!="function"&&typeof M!="symbol";break;case"muted":f.muted=M&&typeof M!="function"&&typeof M!="symbol";break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"defaultValue":case"defaultChecked":case"innerHTML":case"ref":break;case"autoFocus":break;case"xlinkHref":if(M==null||typeof M=="function"||typeof M=="boolean"||typeof M=="symbol"){f.removeAttribute("xlink:href");break}T=qc(""+M),f.setAttributeNS("http://www.w3.org/1999/xlink","xlink:href",T);break;case"contentEditable":case"spellCheck":case"draggable":case"value":case"autoReverse":case"externalResourcesRequired":case"focusable":case"preserveAlpha":M!=null&&typeof M!="function"&&typeof M!="symbol"?f.setAttribute(T,""+M):f.removeAttribute(T);break;case"inert":case"allowFullScreen":case"async":case"autoPlay":case"controls":case"default":case"defer":case"disabled":case"disablePictureInPicture":case"disableRemotePlayback":case"formNoValidate":case"hidden":case"loop":case"noModule":case"noValidate":case"open":case"playsInline":case"readOnly":case"required":case"reversed":case"scoped":case"seamless":case"itemScope":M&&typeof M!="function"&&typeof M!="symbol"?f.setAttribute(T,""):f.removeAttribute(T);break;case"capture":case"download":M===!0?f.setAttribute(T,""):M!==!1&&M!=null&&typeof M!="function"&&typeof M!="symbol"?f.setAttribute(T,M):f.removeAttribute(T);break;case"cols":case"rows":case"size":case"span":M!=null&&typeof M!="function"&&typeof M!="symbol"&&!isNaN(M)&&1<=M?f.setAttribute(T,M):f.removeAttribute(T);break;case"rowSpan":case"start":M==null||typeof M=="function"||typeof M=="symbol"||isNaN(M)?f.removeAttribute(T):f.setAttribute(T,M);break;case"popover":nn("beforetoggle",f),nn("toggle",f),Li(f,"popover",M);break;case"xlinkActuate":$i(f,"http://www.w3.org/1999/xlink","xlink:actuate",M);break;case"xlinkArcrole":$i(f,"http://www.w3.org/1999/xlink","xlink:arcrole",M);break;case"xlinkRole":$i(f,"http://www.w3.org/1999/xlink","xlink:role",M);break;case"xlinkShow":$i(f,"http://www.w3.org/1999/xlink","xlink:show",M);break;case"xlinkTitle":$i(f,"http://www.w3.org/1999/xlink","xlink:title",M);break;case"xlinkType":$i(f,"http://www.w3.org/1999/xlink","xlink:type",M);break;case"xmlBase":$i(f,"http://www.w3.org/XML/1998/namespace","xml:base",M);break;case"xmlLang":$i(f,"http://www.w3.org/XML/1998/namespace","xml:lang",M);break;case"xmlSpace":$i(f,"http://www.w3.org/XML/1998/namespace","xml:space",M);break;case"is":Li(f,"is",M);break;case"innerText":case"textContent":break;default:(!(2<T.length)||T[0]!=="o"&&T[0]!=="O"||T[1]!=="n"&&T[1]!=="N")&&(T=Ff.get(T)||T,Li(f,T,M))}}function h0(f,y,T,M,N,$){switch(T){case"style":Gc(f,M,$);break;case"dangerouslySetInnerHTML":if(M!=null){if(typeof M!="object"||!("__html"in M))throw Error(l(61));if(T=M.__html,T!=null){if(N.children!=null)throw Error(l(60));f.innerHTML=T}}break;case"children":typeof M=="string"?ja(f,M):(typeof M=="number"||typeof M=="bigint")&&ja(f,""+M);break;case"onScroll":M!=null&&nn("scroll",f);break;case"onScrollEnd":M!=null&&nn("scrollend",f);break;case"onClick":M!=null&&(f.onclick=Jg);break;case"suppressContentEditableWarning":case"suppressHydrationWarning":case"innerHTML":case"ref":break;case"innerText":case"textContent":break;default:if(!qr.hasOwnProperty(T))e:{if(T[0]==="o"&&T[1]==="n"&&(N=T.endsWith("Capture"),y=T.slice(2,N?T.length-7:void 0),$=f[oe]||null,$=$!=null?$[T]:null,typeof $=="function"&&f.removeEventListener(y,$,N),typeof M=="function")){typeof $!="function"&&$!==null&&(T in f?f[T]=null:f.hasAttribute(T)&&f.removeAttribute(T)),f.addEventListener(y,M,N);break e}T in f?f[T]=M:M===!0?f.setAttribute(T,""):Li(f,T,M)}}}function Da(f,y,T){switch(y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"img":nn("error",f),nn("load",f);var M=!1,N=!1,$;for($ in T)if(T.hasOwnProperty($)){var ce=T[$];if(ce!=null)switch($){case"src":M=!0;break;case"srcSet":N=!0;break;case"children":case"dangerouslySetInnerHTML":throw Error(l(137,y));default:Hn(f,y,$,ce,T,null)}}N&&Hn(f,y,"srcSet",T.srcSet,T,null),M&&Hn(f,y,"src",T.src,T,null);return;case"input":nn("invalid",f);var Ae=$=ce=N=null,Ye=null,Mt=null;for(M in T)if(T.hasOwnProperty(M)){var Wt=T[M];if(Wt!=null)switch(M){case"name":N=Wt;break;case"type":ce=Wt;break;case"checked":Ye=Wt;break;case"defaultChecked":Mt=Wt;break;case"value":$=Wt;break;case"defaultValue":Ae=Wt;break;case"children":case"dangerouslySetInnerHTML":if(Wt!=null)throw Error(l(137,y));break;default:Hn(f,y,M,Wt,T,null)}}Ys(f,$,Ae,Ye,Mt,ce,N,!1),Kl(f);return;case"select":nn("invalid",f),M=ce=$=null;for(N in T)if(T.hasOwnProperty(N)&&(Ae=T[N],Ae!=null))switch(N){case"value":$=Ae;break;case"defaultValue":ce=Ae;break;case"multiple":M=Ae;default:Hn(f,y,N,Ae,T,null)}y=$,T=ce,f.multiple=!!M,y!=null?Jl(f,!!M,y,!1):T!=null&&Jl(f,!!M,T,!0);return;case"textarea":nn("invalid",f),$=N=M=null;for(ce in T)if(T.hasOwnProperty(ce)&&(Ae=T[ce],Ae!=null))switch(ce){case"value":M=Ae;break;case"defaultValue":N=Ae;break;case"children":$=Ae;break;case"dangerouslySetInnerHTML":if(Ae!=null)throw Error(l(91));break;default:Hn(f,y,ce,Ae,T,null)}xs(f,M,N,$),Kl(f);return;case"option":for(Ye in T)if(T.hasOwnProperty(Ye)&&(M=T[Ye],M!=null))switch(Ye){case"selected":f.selected=M&&typeof M!="function"&&typeof M!="symbol";break;default:Hn(f,y,Ye,M,T,null)}return;case"dialog":nn("beforetoggle",f),nn("toggle",f),nn("cancel",f),nn("close",f);break;case"iframe":case"object":nn("load",f);break;case"video":case"audio":for(M=0;M<Fp.length;M++)nn(Fp[M],f);break;case"image":nn("error",f),nn("load",f);break;case"details":nn("toggle",f);break;case"embed":case"source":case"link":nn("error",f),nn("load",f);case"area":case"base":case"br":case"col":case"hr":case"keygen":case"meta":case"param":case"track":case"wbr":case"menuitem":for(Mt in T)if(T.hasOwnProperty(Mt)&&(M=T[Mt],M!=null))switch(Mt){case"children":case"dangerouslySetInnerHTML":throw Error(l(137,y));default:Hn(f,y,Mt,M,T,null)}return;default:if(zf(y)){for(Wt in T)T.hasOwnProperty(Wt)&&(M=T[Wt],M!==void 0&&h0(f,y,Wt,M,T,void 0));return}}for(Ae in T)T.hasOwnProperty(Ae)&&(M=T[Ae],M!=null&&Hn(f,y,Ae,M,T,null))}function Vp(f,y,T,M){switch(y){case"div":case"span":case"svg":case"path":case"a":case"g":case"p":case"li":break;case"input":var N=null,$=null,ce=null,Ae=null,Ye=null,Mt=null,Wt=null;for(kt in T){var ir=T[kt];if(T.hasOwnProperty(kt)&&ir!=null)switch(kt){case"checked":break;case"value":break;case"defaultValue":Ye=ir;default:M.hasOwnProperty(kt)||Hn(f,y,kt,null,M,ir)}}for(var zt in M){var kt=M[zt];if(ir=T[zt],M.hasOwnProperty(zt)&&(kt!=null||ir!=null))switch(zt){case"type":$=kt;break;case"name":N=kt;break;case"checked":Mt=kt;break;case"defaultChecked":Wt=kt;break;case"value":ce=kt;break;case"defaultValue":Ae=kt;break;case"children":case"dangerouslySetInnerHTML":if(kt!=null)throw Error(l(137,y));break;default:kt!==ir&&Hn(f,y,zt,kt,M,ir)}}Lf(f,ce,Ae,Ye,Mt,Wt,$,N);return;case"select":kt=ce=Ae=zt=null;for($ in T)if(Ye=T[$],T.hasOwnProperty($)&&Ye!=null)switch($){case"value":break;case"multiple":kt=Ye;default:M.hasOwnProperty($)||Hn(f,y,$,null,M,Ye)}for(N in M)if($=M[N],Ye=T[N],M.hasOwnProperty(N)&&($!=null||Ye!=null))switch(N){case"value":zt=$;break;case"defaultValue":Ae=$;break;case"multiple":ce=$;default:$!==Ye&&Hn(f,y,N,$,M,Ye)}y=Ae,T=ce,M=kt,zt!=null?Jl(f,!!T,zt,!1):!!M!=!!T&&(y!=null?Jl(f,!!T,y,!0):Jl(f,!!T,T?[]:"",!1));return;case"textarea":kt=zt=null;for(Ae in T)if(N=T[Ae],T.hasOwnProperty(Ae)&&N!=null&&!M.hasOwnProperty(Ae))switch(Ae){case"value":break;case"children":break;default:Hn(f,y,Ae,null,M,N)}for(ce in M)if(N=M[ce],$=T[ce],M.hasOwnProperty(ce)&&(N!=null||$!=null))switch(ce){case"value":zt=N;break;case"defaultValue":kt=N;break;case"children":break;case"dangerouslySetInnerHTML":if(N!=null)throw Error(l(91));break;default:N!==$&&Hn(f,y,ce,N,M,$)}Ua(f,zt,kt);return;case"option":for(var xi in T)if(zt=T[xi],T.hasOwnProperty(xi)&&zt!=null&&!M.hasOwnProperty(xi))switch(xi){case"selected":f.selected=!1;break;default:Hn(f,y,xi,null,M,zt)}for(Ye in M)if(zt=M[Ye],kt=T[Ye],M.hasOwnProperty(Ye)&&zt!==kt&&(zt!=null||kt!=null))switch(Ye){case"selected":f.selected=zt&&typeof zt!="function"&&typeof zt!="symbol";break;default:Hn(f,y,Ye,zt,M,kt)}return;case"img":case"link":case"area":case"base":case"br":case"col":case"embed":case"hr":case"keygen":case"meta":case"param":case"source":case"track":case"wbr":case"menuitem":for(var ni in T)zt=T[ni],T.hasOwnProperty(ni)&&zt!=null&&!M.hasOwnProperty(ni)&&Hn(f,y,ni,null,M,zt);for(Mt in M)if(zt=M[Mt],kt=T[Mt],M.hasOwnProperty(Mt)&&zt!==kt&&(zt!=null||kt!=null))switch(Mt){case"children":case"dangerouslySetInnerHTML":if(zt!=null)throw Error(l(137,y));break;default:Hn(f,y,Mt,zt,M,kt)}return;default:if(zf(y)){for(var wn in T)zt=T[wn],T.hasOwnProperty(wn)&&zt!==void 0&&!M.hasOwnProperty(wn)&&h0(f,y,wn,void 0,M,zt);for(Wt in M)zt=M[Wt],kt=T[Wt],!M.hasOwnProperty(Wt)||zt===kt||zt===void 0&&kt===void 0||h0(f,y,Wt,zt,M,kt);return}}for(var mt in T)zt=T[mt],T.hasOwnProperty(mt)&&zt!=null&&!M.hasOwnProperty(mt)&&Hn(f,y,mt,null,M,zt);for(ir in M)zt=M[ir],kt=T[ir],!M.hasOwnProperty(ir)||zt===kt||zt==null&&kt==null||Hn(f,y,ir,zt,M,kt)}var e_=null,ph=null;function yf(f){return f.nodeType===9?f:f.ownerDocument}function Hy(f){switch(f){case"http://www.w3.org/2000/svg":return 1;case"http://www.w3.org/1998/Math/MathML":return 2;default:return 0}}function qy(f,y){if(f===0)switch(y){case"svg":return 1;case"math":return 2;default:return 0}return f===1&&y==="foreignObject"?0:f}function f0(f,y){return f==="textarea"||f==="noscript"||typeof y.children=="string"||typeof y.children=="number"||typeof y.children=="bigint"||typeof y.dangerouslySetInnerHTML=="object"&&y.dangerouslySetInnerHTML!==null&&y.dangerouslySetInnerHTML.__html!=null}var d0=null;function Jv(){var f=window.event;return f&&f.type==="popstate"?f===d0?!1:(d0=f,!0):(d0=null,!1)}var $y=typeof setTimeout=="function"?setTimeout:void 0,ex=typeof clearTimeout=="function"?clearTimeout:void 0,t_=typeof Promise=="function"?Promise:void 0,tx=typeof queueMicrotask=="function"?queueMicrotask:typeof t_<"u"?function(f){return t_.resolve(null).then(f).catch(Xy)}:$y;function Xy(f){setTimeout(function(){throw f})}function Vl(f){return f==="head"}function Zy(f,y){var T=y,M=0,N=0;do{var $=T.nextSibling;if(f.removeChild(T),$&&$.nodeType===8)if(T=$.data,T==="/$"){if(0<M&&8>M){T=M;var ce=f.ownerDocument;if(T&1&&Ed(ce.documentElement),T&2&&Ed(ce.body),T&4)for(T=ce.head,Ed(T),ce=T.firstChild;ce;){var Ae=ce.nextSibling,Ye=ce.nodeName;ce[Be]||Ye==="SCRIPT"||Ye==="STYLE"||Ye==="LINK"&&ce.rel.toLowerCase()==="stylesheet"||T.removeChild(ce),ce=Ae}}if(N===0){f.removeChild($),Zp(y);return}N--}else T==="$"||T==="$?"||T==="$!"?N++:M=T.charCodeAt(0)-48;else M=0;T=$}while(T);Zp(y)}function co(f){var y=f.firstChild;for(y&&y.nodeType===10&&(y=y.nextSibling);y;){var T=y;switch(y=y.nextSibling,T.nodeName){case"HTML":case"HEAD":case"BODY":co(T),Je(T);continue;case"SCRIPT":case"STYLE":continue;case"LINK":if(T.rel.toLowerCase()==="stylesheet")continue}f.removeChild(T)}}function Up(f,y,T,M){for(;f.nodeType===1;){var N=T;if(f.nodeName.toLowerCase()!==y.toLowerCase()){if(!M&&(f.nodeName!=="INPUT"||f.type!=="hidden"))break}else if(M){if(!f[Be])switch(y){case"meta":if(!f.hasAttribute("itemprop"))break;return f;case"link":if($=f.getAttribute("rel"),$==="stylesheet"&&f.hasAttribute("data-precedence"))break;if($!==N.rel||f.getAttribute("href")!==(N.href==null||N.href===""?null:N.href)||f.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin)||f.getAttribute("title")!==(N.title==null?null:N.title))break;return f;case"style":if(f.hasAttribute("data-precedence"))break;return f;case"script":if($=f.getAttribute("src"),($!==(N.src==null?null:N.src)||f.getAttribute("type")!==(N.type==null?null:N.type)||f.getAttribute("crossorigin")!==(N.crossOrigin==null?null:N.crossOrigin))&&$&&f.hasAttribute("async")&&!f.hasAttribute("itemprop"))break;return f;default:return f}}else if(y==="input"&&f.type==="hidden"){var $=N.name==null?null:""+N.name;if(N.type==="hidden"&&f.getAttribute("name")===$)return f}else return f;if(f=us(f.nextSibling),f===null)break}return null}function Wy(f,y,T){if(y==="")return null;for(;f.nodeType!==3;)if((f.nodeType!==1||f.nodeName!=="INPUT"||f.type!=="hidden")&&!T||(f=us(f.nextSibling),f===null))return null;return f}function jp(f){return f.data==="$!"||f.data==="$?"&&f.ownerDocument.readyState==="complete"}function r_(f,y){var T=f.ownerDocument;if(f.data!=="$?"||T.readyState==="complete")y();else{var M=function(){y(),T.removeEventListener("DOMContentLoaded",M)};T.addEventListener("DOMContentLoaded",M),f._reactRetry=M}}function us(f){for(;f!=null;f=f.nextSibling){var y=f.nodeType;if(y===1||y===3)break;if(y===8){if(y=f.data,y==="$"||y==="$!"||y==="$?"||y==="F!"||y==="F")break;if(y==="/$")return null}}return f}var i_=null;function p0(f){f=f.previousSibling;for(var y=0;f;){if(f.nodeType===8){var T=f.data;if(T==="$"||T==="$!"||T==="$?"){if(y===0)return f;y--}else T==="/$"&&y++}f=f.previousSibling}return null}function Gp(f,y,T){switch(y=yf(T),f){case"html":if(f=y.documentElement,!f)throw Error(l(452));return f;case"head":if(f=y.head,!f)throw Error(l(453));return f;case"body":if(f=y.body,!f)throw Error(l(454));return f;default:throw Error(l(451))}}function Ed(f){for(var y=f.attributes;y.length;)f.removeAttributeNode(y[0]);Je(f)}var Za=new Map,Yy=new Set;function Zm(f){return typeof f.getRootNode=="function"?f.getRootNode():f.nodeType===9?f:f.ownerDocument}var zc=sr.d;sr.d={f:m0,r:Qy,D:hs,C:Jy,L:e1,m:t1,X:rx,S:n_,M:ix};function m0(){var f=zc.f(),y=Xa();return f||y}function Qy(f){var y=_t(f);y!==null&&y.tag===5&&y.type==="form"?Pm(y):zc.r(f)}var Fs=typeof document>"u"?null:document;function Ky(f,y,T){var M=Fs;if(M&&typeof y=="string"&&y){var N=aa(y);N='link[rel="'+f+'"][href="'+N+'"]',typeof T=="string"&&(N+='[crossorigin="'+T+'"]'),Yy.has(N)||(Yy.add(N),f={rel:f,crossOrigin:T,href:y},M.querySelector(N)===null&&(y=M.createElement("link"),Da(y,"link",f),gr(y),M.head.appendChild(y)))}}function hs(f){zc.D(f),Ky("dns-prefetch",f,null)}function Jy(f,y){zc.C(f,y),Ky("preconnect",f,y)}function e1(f,y,T){zc.L(f,y,T);var M=Fs;if(M&&f&&y){var N='link[rel="preload"][as="'+aa(y)+'"]';y==="image"&&T&&T.imageSrcSet?(N+='[imagesrcset="'+aa(T.imageSrcSet)+'"]',typeof T.imageSizes=="string"&&(N+='[imagesizes="'+aa(T.imageSizes)+'"]')):N+='[href="'+aa(f)+'"]';var $=N;switch(y){case"style":$=Cd(f);break;case"script":$=Rd(f)}Za.has($)||(f=L({rel:"preload",href:y==="image"&&T&&T.imageSrcSet?void 0:f,as:y},T),Za.set($,f),M.querySelector(N)!==null||y==="style"&&M.querySelector(Id($))||y==="script"&&M.querySelector(Hp($))||(y=M.createElement("link"),Da(y,"link",f),gr(y),M.head.appendChild(y)))}}function t1(f,y){zc.m(f,y);var T=Fs;if(T&&f){var M=y&&typeof y.as=="string"?y.as:"script",N='link[rel="modulepreload"][as="'+aa(M)+'"][href="'+aa(f)+'"]',$=N;switch(M){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":$=Rd(f)}if(!Za.has($)&&(f=L({rel:"modulepreload",href:f},y),Za.set($,f),T.querySelector(N)===null)){switch(M){case"audioworklet":case"paintworklet":case"serviceworker":case"sharedworker":case"worker":case"script":if(T.querySelector(Hp($)))return}M=T.createElement("link"),Da(M,"link",f),gr(M),T.head.appendChild(M)}}}function n_(f,y,T){zc.S(f,y,T);var M=Fs;if(M&&f){var N=yr(M).hoistableStyles,$=Cd(f);y=y||"default";var ce=N.get($);if(!ce){var Ae={loading:0,preload:null};if(ce=M.querySelector(Id($)))Ae.loading=5;else{f=L({rel:"stylesheet",href:f,"data-precedence":y},T),(T=Za.get($))&&Ul(f,T);var Ye=ce=M.createElement("link");gr(Ye),Da(Ye,"link",f),Ye._p=new Promise(function(Mt,Wt){Ye.onload=Mt,Ye.onerror=Wt}),Ye.addEventListener("load",function(){Ae.loading|=1}),Ye.addEventListener("error",function(){Ae.loading|=2}),Ae.loading|=4,Md(ce,y,M)}ce={type:"stylesheet",instance:ce,count:1,state:Ae},N.set($,ce)}}}function rx(f,y){zc.X(f,y);var T=Fs;if(T&&f){var M=yr(T).hoistableScripts,N=Rd(f),$=M.get(N);$||($=T.querySelector(Hp(N)),$||(f=L({src:f,async:!0},y),(y=Za.get(N))&&s_(f,y),$=T.createElement("script"),gr($),Da($,"link",f),T.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},M.set(N,$))}}function ix(f,y){zc.M(f,y);var T=Fs;if(T&&f){var M=yr(T).hoistableScripts,N=Rd(f),$=M.get(N);$||($=T.querySelector(Hp(N)),$||(f=L({src:f,async:!0,type:"module"},y),(y=Za.get(N))&&s_(f,y),$=T.createElement("script"),gr($),Da($,"link",f),T.head.appendChild($)),$={type:"script",instance:$,count:1,state:null},M.set(N,$))}}function o_(f,y,T,M){var N=(N=Cr.current)?Zm(N):null;if(!N)throw Error(l(446));switch(f){case"meta":case"title":return null;case"style":return typeof T.precedence=="string"&&typeof T.href=="string"?(y=Cd(T.href),T=yr(N).hoistableStyles,M=T.get(y),M||(M={type:"style",instance:null,count:0,state:null},T.set(y,M)),M):{type:"void",instance:null,count:0,state:null};case"link":if(T.rel==="stylesheet"&&typeof T.href=="string"&&typeof T.precedence=="string"){f=Cd(T.href);var $=yr(N).hoistableStyles,ce=$.get(f);if(ce||(N=N.ownerDocument||N,ce={type:"stylesheet",instance:null,count:0,state:{loading:0,preload:null}},$.set(f,ce),($=N.querySelector(Id(f)))&&!$._p&&(ce.instance=$,ce.state.loading=5),Za.has(f)||(T={rel:"preload",as:"style",href:T.href,crossOrigin:T.crossOrigin,integrity:T.integrity,media:T.media,hrefLang:T.hrefLang,referrerPolicy:T.referrerPolicy},Za.set(f,T),$||r1(N,f,T,ce.state))),y&&M===null)throw Error(l(528,""));return ce}if(y&&M!==null)throw Error(l(529,""));return null;case"script":return y=T.async,T=T.src,typeof T=="string"&&y&&typeof y!="function"&&typeof y!="symbol"?(y=Rd(T),T=yr(N).hoistableScripts,M=T.get(y),M||(M={type:"script",instance:null,count:0,state:null},T.set(y,M)),M):{type:"void",instance:null,count:0,state:null};default:throw Error(l(444,f))}}function Cd(f){return'href="'+aa(f)+'"'}function Id(f){return'link[rel="stylesheet"]['+f+"]"}function a_(f){return L({},f,{"data-precedence":f.precedence,precedence:null})}function r1(f,y,T,M){f.querySelector('link[rel="preload"][as="style"]['+y+"]")?M.loading=1:(y=f.createElement("link"),M.preload=y,y.addEventListener("load",function(){return M.loading|=1}),y.addEventListener("error",function(){return M.loading|=2}),Da(y,"link",T),gr(y),f.head.appendChild(y))}function Rd(f){return'[src="'+aa(f)+'"]'}function Hp(f){return"script[async]"+f}function g0(f,y,T){if(y.count++,y.instance===null)switch(y.type){case"style":var M=f.querySelector('style[data-href~="'+aa(T.href)+'"]');if(M)return y.instance=M,gr(M),M;var N=L({},T,{"data-href":T.href,"data-precedence":T.precedence,href:null,precedence:null});return M=(f.ownerDocument||f).createElement("style"),gr(M),Da(M,"style",N),Md(M,T.precedence,f),y.instance=M;case"stylesheet":N=Cd(T.href);var $=f.querySelector(Id(N));if($)return y.state.loading|=4,y.instance=$,gr($),$;M=a_(T),(N=Za.get(N))&&Ul(M,N),$=(f.ownerDocument||f).createElement("link"),gr($);var ce=$;return ce._p=new Promise(function(Ae,Ye){ce.onload=Ae,ce.onerror=Ye}),Da($,"link",M),y.state.loading|=4,Md($,T.precedence,f),y.instance=$;case"script":return $=Rd(T.src),(N=f.querySelector(Hp($)))?(y.instance=N,gr(N),N):(M=T,(N=Za.get($))&&(M=L({},T),s_(M,N)),f=f.ownerDocument||f,N=f.createElement("script"),gr(N),Da(N,"link",M),f.head.appendChild(N),y.instance=N);case"void":return null;default:throw Error(l(443,y.type))}else y.type==="stylesheet"&&(y.state.loading&4)===0&&(M=y.instance,y.state.loading|=4,Md(M,T.precedence,f));return y.instance}function Md(f,y,T){for(var M=T.querySelectorAll('link[rel="stylesheet"][data-precedence],style[data-precedence]'),N=M.length?M[M.length-1]:null,$=N,ce=0;ce<M.length;ce++){var Ae=M[ce];if(Ae.dataset.precedence===y)$=Ae;else if($!==N)break}$?$.parentNode.insertBefore(f,$.nextSibling):(y=T.nodeType===9?T.head:T,y.insertBefore(f,y.firstChild))}function Ul(f,y){f.crossOrigin==null&&(f.crossOrigin=y.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=y.referrerPolicy),f.title==null&&(f.title=y.title)}function s_(f,y){f.crossOrigin==null&&(f.crossOrigin=y.crossOrigin),f.referrerPolicy==null&&(f.referrerPolicy=y.referrerPolicy),f.integrity==null&&(f.integrity=y.integrity)}var l_=null;function i1(f,y,T){if(l_===null){var M=new Map,N=l_=new Map;N.set(T,M)}else N=l_,M=N.get(T),M||(M=new Map,N.set(T,M));if(M.has(f))return M;for(M.set(f,null),T=T.getElementsByTagName(f),N=0;N<T.length;N++){var $=T[N];if(!($[Be]||$[te]||f==="link"&&$.getAttribute("rel")==="stylesheet")&&$.namespaceURI!=="http://www.w3.org/2000/svg"){var ce=$.getAttribute(y)||"";ce=f+ce;var Ae=M.get(ce);Ae?Ae.push($):M.set(ce,[$])}}return M}function n1(f,y,T){f=f.ownerDocument||f,f.head.insertBefore(T,y==="title"?f.querySelector("head > title"):null)}function nx(f,y,T){if(T===1||y.itemProp!=null)return!1;switch(f){case"meta":case"title":return!0;case"style":if(typeof y.precedence!="string"||typeof y.href!="string"||y.href==="")break;return!0;case"link":if(typeof y.rel!="string"||typeof y.href!="string"||y.href===""||y.onLoad||y.onError)break;switch(y.rel){case"stylesheet":return f=y.disabled,typeof y.precedence=="string"&&f==null;default:return!0}case"script":if(y.async&&typeof y.async!="function"&&typeof y.async!="symbol"&&!y.onLoad&&!y.onError&&y.src&&typeof y.src=="string")return!0}return!1}function o1(f){return!(f.type==="stylesheet"&&(f.state.loading&3)===0)}var Wm=null;function ox(){}function Ym(f,y,T){if(Wm===null)throw Error(l(475));var M=Wm;if(y.type==="stylesheet"&&(typeof T.media!="string"||matchMedia(T.media).matches!==!1)&&(y.state.loading&4)===0){if(y.instance===null){var N=Cd(T.href),$=f.querySelector(Id(N));if($){f=$._p,f!==null&&typeof f=="object"&&typeof f.then=="function"&&(M.count++,M=Qm.bind(M),f.then(M,M)),y.state.loading|=4,y.instance=$,gr($);return}$=f.ownerDocument||f,T=a_(T),(N=Za.get(N))&&Ul(T,N),$=$.createElement("link"),gr($);var ce=$;ce._p=new Promise(function(Ae,Ye){ce.onload=Ae,ce.onerror=Ye}),Da($,"link",T),y.instance=$}M.stylesheets===null&&(M.stylesheets=new Map),M.stylesheets.set(y,f),(f=y.state.preload)&&(y.state.loading&3)===0&&(M.count++,y=Qm.bind(M),f.addEventListener("load",y),f.addEventListener("error",y))}}function a1(){if(Wm===null)throw Error(l(475));var f=Wm;return f.stylesheets&&f.count===0&&c_(f,f.stylesheets),0<f.count?function(y){var T=setTimeout(function(){if(f.stylesheets&&c_(f,f.stylesheets),f.unsuspend){var M=f.unsuspend;f.unsuspend=null,M()}},6e4);return f.unsuspend=y,function(){f.unsuspend=null,clearTimeout(T)}}:null}function Qm(){if(this.count--,this.count===0){if(this.stylesheets)c_(this,this.stylesheets);else if(this.unsuspend){var f=this.unsuspend;this.unsuspend=null,f()}}}var Dd=null;function c_(f,y){f.stylesheets=null,f.unsuspend!==null&&(f.count++,Dd=new Map,y.forEach(_0,f),Dd=null,Qm.call(f))}function _0(f,y){if(!(y.state.loading&4)){var T=Dd.get(f);if(T)var M=T.get(null);else{T=new Map,Dd.set(f,T);for(var N=f.querySelectorAll("link[data-precedence],style[data-precedence]"),$=0;$<N.length;$++){var ce=N[$];(ce.nodeName==="LINK"||ce.getAttribute("media")!=="not all")&&(T.set(ce.dataset.precedence,ce),M=ce)}M&&T.set(null,M)}N=y.instance,ce=N.getAttribute("data-precedence"),$=T.get(ce)||M,$===M&&T.set(null,N),T.set(ce,N),this.count++,M=Qm.bind(this),N.addEventListener("load",M),N.addEventListener("error",M),$?$.parentNode.insertBefore(N,$.nextSibling):(f=f.nodeType===9?f.head:f,f.insertBefore(N,f.firstChild)),y.state.loading|=4}}var vf={$$typeof:Pe,Provider:null,Consumer:null,_currentValue:Fr,_currentValue2:Fr,_threadCount:0};function s1(f,y,T,M,N,$,ce,Ae){this.tag=1,this.containerInfo=f,this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.next=this.pendingContext=this.context=this.cancelPendingCommit=null,this.callbackPriority=0,this.expirationTimes=Yl(-1),this.entangledLanes=this.shellSuspendCounter=this.errorRecoveryDisabledLanes=this.expiredLanes=this.warmLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=Yl(0),this.hiddenUpdates=Yl(null),this.identifierPrefix=M,this.onUncaughtError=N,this.onCaughtError=$,this.onRecoverableError=ce,this.pooledCache=null,this.pooledCacheLanes=0,this.formState=Ae,this.incompleteTransitions=new Map}function l1(f,y,T,M,N,$,ce,Ae,Ye,Mt,Wt,ir){return f=new s1(f,y,T,ce,Ae,Ye,Mt,ir),y=1,$===!0&&(y|=24),$=Nr(3,null,null,y),f.current=$,$.stateNode=f,y=vc(),y.refCount++,f.pooledCache=y,y.refCount++,$.memoizedState={element:M,isDehydrated:T,cache:y},td($),f}function u_(f){return f?(f=fc,f):fc}function y0(f,y,T,M,N,$){N=u_(N),M.context===null?M.context=N:M.pendingContext=N,M=bc(y),M.payload={element:T},$=$===void 0?null:$,$!==null&&(M.callback=$),T=Cl(f,M,y),T!==null&&(Wn(T,f,y),ah(T,f,y))}function v0(f,y){if(f=f.memoizedState,f!==null&&f.dehydrated!==null){var T=f.retryLane;f.retryLane=T!==0&&T<y?T:y}}function Km(f,y){v0(f,y),(f=f.alternate)&&v0(f,y)}function h_(f){if(f.tag===13){var y=bl(f,67108864);y!==null&&Wn(y,f,67108864),Km(f,67108864)}}var Jm=!0;function x0(f,y,T,M){var N=Ot.T;Ot.T=null;var $=sr.p;try{sr.p=2,b0(f,y,T,M)}finally{sr.p=$,Ot.T=N}}function ax(f,y,T,M){var N=Ot.T;Ot.T=null;var $=sr.p;try{sr.p=8,b0(f,y,T,M)}finally{sr.p=$,Ot.T=N}}function b0(f,y,T,M){if(Jm){var N=w0(M);if(N===null)Qg(f,y,M,f_,T),u1(f,M);else if(S0(N,f,y,T,M))M.stopPropagation();else if(u1(f,M),y&4&&-1<c1.indexOf(f)){for(;N!==null;){var $=_t(N);if($!==null)switch($.tag){case 3:if($=$.stateNode,$.current.memoizedState.isDehydrated){var ce=oa($.pendingLanes);if(ce!==0){var Ae=$;for(Ae.pendingLanes|=2,Ae.entangledLanes|=2;ce;){var Ye=1<<31-vo(ce);Ae.entanglements[1]|=Ye,ce&=~Ye}zs($),(je&6)===0&&(li=Zo()+500,gf(0))}}break;case 13:Ae=bl($,2),Ae!==null&&Wn(Ae,$,2),Xa(),Km($,2)}if($=w0(M),$===null&&Qg(f,y,M,f_,T),$===N)break;N=$}N!==null&&M.stopPropagation()}else Qg(f,y,M,null,T)}}function w0(f){return f=$c(f),d_(f)}var f_=null;function d_(f){if(f_=null,f=Pt(f),f!==null){var y=m(f);if(y===null)f=null;else{var T=y.tag;if(T===13){if(f=b(y),f!==null)return f;f=null}else if(T===3){if(y.stateNode.current.memoizedState.isDehydrated)return y.tag===3?y.stateNode.containerInfo:null;f=null}else y!==f&&(f=null)}}return f_=f,null}function mh(f){switch(f){case"beforetoggle":case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"toggle":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 2;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 8;case"message":switch(Df()){case na:return 2;case Zl:return 8;case Wo:case Wl:return 32;case _l:return 268435456;default:return 32}default:return 32}}var Od=!1,jl=null,Fc=null,Gl=null,qp=new Map,$p=new Map,gh=[],c1="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset".split(" ");function u1(f,y){switch(f){case"focusin":case"focusout":jl=null;break;case"dragenter":case"dragleave":Fc=null;break;case"mouseover":case"mouseout":Gl=null;break;case"pointerover":case"pointerout":qp.delete(y.pointerId);break;case"gotpointercapture":case"lostpointercapture":$p.delete(y.pointerId)}}function eg(f,y,T,M,N,$){return f===null||f.nativeEvent!==$?(f={blockedOn:y,domEventName:T,eventSystemFlags:M,nativeEvent:$,targetContainers:[N]},y!==null&&(y=_t(y),y!==null&&h_(y)),f):(f.eventSystemFlags|=M,y=f.targetContainers,N!==null&&y.indexOf(N)===-1&&y.push(N),f)}function S0(f,y,T,M,N){switch(y){case"focusin":return jl=eg(jl,f,y,T,M,N),!0;case"dragenter":return Fc=eg(Fc,f,y,T,M,N),!0;case"mouseover":return Gl=eg(Gl,f,y,T,M,N),!0;case"pointerover":var $=N.pointerId;return qp.set($,eg(qp.get($)||null,f,y,T,M,N)),!0;case"gotpointercapture":return $=N.pointerId,$p.set($,eg($p.get($)||null,f,y,T,M,N)),!0}return!1}function tg(f){var y=Pt(f.target);if(y!==null){var T=m(y);if(T!==null){if(y=T.tag,y===13){if(y=b(T),y!==null){f.blockedOn=y,Ih(f.priority,function(){if(T.tag===13){var M=xn();M=Tt(M);var N=bl(T,M);N!==null&&Wn(N,T,M),Km(T,M)}});return}}else if(y===3&&T.stateNode.current.memoizedState.isDehydrated){f.blockedOn=T.tag===3?T.stateNode.containerInfo:null;return}}}f.blockedOn=null}function rg(f){if(f.blockedOn!==null)return!1;for(var y=f.targetContainers;0<y.length;){var T=w0(f.nativeEvent);if(T===null){T=f.nativeEvent;var M=new T.constructor(T.type,T);Nu=M,T.target.dispatchEvent(M),Nu=null}else return y=_t(T),y!==null&&h_(y),f.blockedOn=T,!1;y.shift()}return!0}function h1(f,y,T){rg(f)&&T.delete(y)}function f1(){Od=!1,jl!==null&&rg(jl)&&(jl=null),Fc!==null&&rg(Fc)&&(Fc=null),Gl!==null&&rg(Gl)&&(Gl=null),qp.forEach(h1),$p.forEach(h1)}function Xp(f,y){f.blockedOn===y&&(f.blockedOn=null,Od||(Od=!0,r.unstable_scheduleCallback(r.unstable_NormalPriority,f1)))}var ig=null;function T0(f){ig!==f&&(ig=f,r.unstable_scheduleCallback(r.unstable_NormalPriority,function(){ig===f&&(ig=null);for(var y=0;y<f.length;y+=3){var T=f[y],M=f[y+1],N=f[y+2];if(typeof M!="function"){if(d_(M||T)===null)continue;break}var $=_t(T);$!==null&&(f.splice(y,3),y-=3,rf($,{pending:!0,data:N,method:T.method,action:M},M,N))}}))}function Zp(f){function y(Ye){return Xp(Ye,f)}jl!==null&&Xp(jl,f),Fc!==null&&Xp(Fc,f),Gl!==null&&Xp(Gl,f),qp.forEach(y),$p.forEach(y);for(var T=0;T<gh.length;T++){var M=gh[T];M.blockedOn===f&&(M.blockedOn=null)}for(;0<gh.length&&(T=gh[0],T.blockedOn===null);)tg(T),T.blockedOn===null&&gh.shift();if(T=(f.ownerDocument||f).$$reactFormReplay,T!=null)for(M=0;M<T.length;M+=3){var N=T[M],$=T[M+1],ce=N[oe]||null;if(typeof $=="function")ce||T0(T);else if(ce){var Ae=null;if($&&$.hasAttribute("formAction")){if(N=$,ce=$[oe]||null)Ae=ce.formAction;else if(d_(N)!==null)continue}else Ae=ce.action;typeof Ae=="function"?T[M+1]=Ae:(T.splice(M,3),M-=3),T0(T)}}}function p_(f){this._internalRoot=f}ng.prototype.render=p_.prototype.render=function(f){var y=this._internalRoot;if(y===null)throw Error(l(409));var T=y.current,M=xn();y0(T,M,f,y,null,null)},ng.prototype.unmount=p_.prototype.unmount=function(){var f=this._internalRoot;if(f!==null){this._internalRoot=null;var y=f.containerInfo;y0(f.current,2,null,f,null,null),Xa(),y[me]=null}};function ng(f){this._internalRoot=f}ng.prototype.unstable_scheduleHydration=function(f){if(f){var y=Ud();f={blockedOn:null,target:f,priority:y};for(var T=0;T<gh.length&&y!==0&&y<gh[T].priority;T++);gh.splice(T,0,f),T===0&&tg(f)}};var d1=e.version;if(d1!=="19.1.1")throw Error(l(527,d1,"19.1.1"));sr.findDOMNode=function(f){var y=f._reactInternals;if(y===void 0)throw typeof f.render=="function"?Error(l(188)):(f=Object.keys(f).join(","),Error(l(268,f)));return f=C(y),f=f!==null?D(f):null,f=f===null?null:f.stateNode,f};var p1={bundleType:0,version:"19.1.1",rendererPackageName:"react-dom",currentDispatcherRef:Ot,reconcilerVersion:"19.1.1"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var og=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!og.isDisabled&&og.supportsFiber)try{Ro=og.inject(p1),$n=og}catch{}}return W0.createRoot=function(f,y){if(!h(f))throw Error(l(299));var T=!1,M="",N=Ap,$=lf,ce=xu,Ae=null;return y!=null&&(y.unstable_strictMode===!0&&(T=!0),y.identifierPrefix!==void 0&&(M=y.identifierPrefix),y.onUncaughtError!==void 0&&(N=y.onUncaughtError),y.onCaughtError!==void 0&&($=y.onCaughtError),y.onRecoverableError!==void 0&&(ce=y.onRecoverableError),y.unstable_transitionCallbacks!==void 0&&(Ae=y.unstable_transitionCallbacks)),y=l1(f,1,!1,null,null,T,M,N,$,ce,Ae,null),f[me]=y.current,Yg(f),new p_(y)},W0.hydrateRoot=function(f,y,T){if(!h(f))throw Error(l(299));var M=!1,N="",$=Ap,ce=lf,Ae=xu,Ye=null,Mt=null;return T!=null&&(T.unstable_strictMode===!0&&(M=!0),T.identifierPrefix!==void 0&&(N=T.identifierPrefix),T.onUncaughtError!==void 0&&($=T.onUncaughtError),T.onCaughtError!==void 0&&(ce=T.onCaughtError),T.onRecoverableError!==void 0&&(Ae=T.onRecoverableError),T.unstable_transitionCallbacks!==void 0&&(Ye=T.unstable_transitionCallbacks),T.formState!==void 0&&(Mt=T.formState)),y=l1(f,1,!0,y,T??null,M,N,$,ce,Ae,Ye,Mt),y.context=u_(null),T=y.current,M=xn(),M=Tt(M),N=bc(M),N.callback=null,Cl(T,N,M),T=M,y.current.lanes=T,ya(y,T),zs(y),f[me]=y.current,Yg(f),new ng(y)},W0.version="19.1.1",W0}var CA;function NO(){if(CA)return tb.exports;CA=1;function r(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(r)}catch(e){console.error(e)}}return r(),tb.exports=kO(),tb.exports}var VO=NO();const UO=Lw(VO);/**
 * react-router v7.9.3
 *
 * Copyright (c) Remix Software Inc.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE.md file in the root directory of this source tree.
 *
 * @license MIT
 */var IA="popstate";function jO(r={}){function e(l,h){let{pathname:m,search:b,hash:n}=l.location;return Nb("",{pathname:m,search:b,hash:n},h.state&&h.state.usr||null,h.state&&h.state.key||"default")}function o(l,h){return typeof h=="string"?h:py(h)}return HO(e,o,null,r)}function ko(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function Cf(r,e){if(!r){typeof console<"u"&&console.warn(e);try{throw new Error(e)}catch{}}}function GO(){return Math.random().toString(36).substring(2,10)}function RA(r,e){return{usr:r.state,key:r.key,idx:e}}function Nb(r,e,o=null,l){return{pathname:typeof r=="string"?r:r.pathname,search:"",hash:"",...typeof e=="string"?$_(e):e,state:o,key:e&&e.key||l||GO()}}function py({pathname:r="/",search:e="",hash:o=""}){return e&&e!=="?"&&(r+=e.charAt(0)==="?"?e:"?"+e),o&&o!=="#"&&(r+=o.charAt(0)==="#"?o:"#"+o),r}function $_(r){let e={};if(r){let o=r.indexOf("#");o>=0&&(e.hash=r.substring(o),r=r.substring(0,o));let l=r.indexOf("?");l>=0&&(e.search=r.substring(l),r=r.substring(0,l)),r&&(e.pathname=r)}return e}function HO(r,e,o,l={}){let{window:h=document.defaultView,v5Compat:m=!1}=l,b=h.history,n="POP",C=null,D=L();D==null&&(D=0,b.replaceState({...b.state,idx:D},""));function L(){return(b.state||{idx:null}).idx}function U(){n="POP";let be=L(),ve=be==null?null:be-D;D=be,C&&C({action:n,location:ne.location,delta:ve})}function q(be,ve){n="PUSH";let we=Nb(ne.location,be,ve);D=L()+1;let Pe=RA(we,D),Ze=ne.createHref(we);try{b.pushState(Pe,"",Ze)}catch($e){if($e instanceof DOMException&&$e.name==="DataCloneError")throw $e;h.location.assign(Ze)}m&&C&&C({action:n,location:ne.location,delta:1})}function Z(be,ve){n="REPLACE";let we=Nb(ne.location,be,ve);D=L();let Pe=RA(we,D),Ze=ne.createHref(we);b.replaceState(Pe,"",Ze),m&&C&&C({action:n,location:ne.location,delta:0})}function ie(be){return qO(be)}let ne={get action(){return n},get location(){return r(h,b)},listen(be){if(C)throw new Error("A history only accepts one active listener");return h.addEventListener(IA,U),C=be,()=>{h.removeEventListener(IA,U),C=null}},createHref(be){return e(h,be)},createURL:ie,encodeLocation(be){let ve=ie(be);return{pathname:ve.pathname,search:ve.search,hash:ve.hash}},push:q,replace:Z,go(be){return b.go(be)}};return ne}function qO(r,e=!1){let o="http://localhost";typeof window<"u"&&(o=window.location.origin!=="null"?window.location.origin:window.location.href),ko(o,"No window.location.(origin|href) available to create URL");let l=typeof r=="string"?r:py(r);return l=l.replace(/ $/,"%20"),!e&&l.startsWith("//")&&(l=o+l),new URL(l,o)}function s3(r,e,o="/"){return $O(r,e,o,!1)}function $O(r,e,o,l){let h=typeof e=="string"?$_(e):e,m=Fd(h.pathname||"/",o);if(m==null)return null;let b=l3(r);XO(b);let n=null;for(let C=0;n==null&&C<b.length;++C){let D=nP(m);n=rP(b[C],D,l)}return n}function l3(r,e=[],o=[],l="",h=!1){let m=(b,n,C=h,D)=>{let L={relativePath:D===void 0?b.path||"":D,caseSensitive:b.caseSensitive===!0,childrenIndex:n,route:b};if(L.relativePath.startsWith("/")){if(!L.relativePath.startsWith(l)&&C)return;ko(L.relativePath.startsWith(l),`Absolute route path "${L.relativePath}" nested under path "${l}" is not valid. An absolute child route path must start with the combined path of all its parent routes.`),L.relativePath=L.relativePath.slice(l.length)}let U=zd([l,L.relativePath]),q=o.concat(L);b.children&&b.children.length>0&&(ko(b.index!==!0,`Index routes must not have child routes. Please remove all child routes from route path "${U}".`),l3(b.children,e,q,U,C)),!(b.path==null&&!b.index)&&e.push({path:U,score:eP(U,b.index),routesMeta:q})};return r.forEach((b,n)=>{if(b.path===""||!b.path?.includes("?"))m(b,n);else for(let C of c3(b.path))m(b,n,!0,C)}),e}function c3(r){let e=r.split("/");if(e.length===0)return[];let[o,...l]=e,h=o.endsWith("?"),m=o.replace(/\?$/,"");if(l.length===0)return h?[m,""]:[m];let b=c3(l.join("/")),n=[];return n.push(...b.map(C=>C===""?m:[m,C].join("/"))),h&&n.push(...b),n.map(C=>r.startsWith("/")&&C===""?"/":C)}function XO(r){r.sort((e,o)=>e.score!==o.score?o.score-e.score:tP(e.routesMeta.map(l=>l.childrenIndex),o.routesMeta.map(l=>l.childrenIndex)))}var ZO=/^:[\w-]+$/,WO=3,YO=2,QO=1,KO=10,JO=-2,MA=r=>r==="*";function eP(r,e){let o=r.split("/"),l=o.length;return o.some(MA)&&(l+=JO),e&&(l+=YO),o.filter(h=>!MA(h)).reduce((h,m)=>h+(ZO.test(m)?WO:m===""?QO:KO),l)}function tP(r,e){return r.length===e.length&&r.slice(0,-1).every((l,h)=>l===e[h])?r[r.length-1]-e[e.length-1]:0}function rP(r,e,o=!1){let{routesMeta:l}=r,h={},m="/",b=[];for(let n=0;n<l.length;++n){let C=l[n],D=n===l.length-1,L=m==="/"?e:e.slice(m.length)||"/",U=Sv({path:C.relativePath,caseSensitive:C.caseSensitive,end:D},L),q=C.route;if(!U&&D&&o&&!l[l.length-1].route.index&&(U=Sv({path:C.relativePath,caseSensitive:C.caseSensitive,end:!1},L)),!U)return null;Object.assign(h,U.params),b.push({params:h,pathname:zd([m,U.pathname]),pathnameBase:lP(zd([m,U.pathnameBase])),route:q}),U.pathnameBase!=="/"&&(m=zd([m,U.pathnameBase]))}return b}function Sv(r,e){typeof r=="string"&&(r={path:r,caseSensitive:!1,end:!0});let[o,l]=iP(r.path,r.caseSensitive,r.end),h=e.match(o);if(!h)return null;let m=h[0],b=m.replace(/(.)\/+$/,"$1"),n=h.slice(1);return{params:l.reduce((D,{paramName:L,isOptional:U},q)=>{if(L==="*"){let ie=n[q]||"";b=m.slice(0,m.length-ie.length).replace(/(.)\/+$/,"$1")}const Z=n[q];return U&&!Z?D[L]=void 0:D[L]=(Z||"").replace(/%2F/g,"/"),D},{}),pathname:m,pathnameBase:b,pattern:r}}function iP(r,e=!1,o=!0){Cf(r==="*"||!r.endsWith("*")||r.endsWith("/*"),`Route path "${r}" will be treated as if it were "${r.replace(/\*$/,"/*")}" because the \`*\` character must always follow a \`/\` in the pattern. To get rid of this warning, please change the route path to "${r.replace(/\*$/,"/*")}".`);let l=[],h="^"+r.replace(/\/*\*?$/,"").replace(/^\/*/,"/").replace(/[\\.*+^${}|()[\]]/g,"\\$&").replace(/\/:([\w-]+)(\?)?/g,(b,n,C)=>(l.push({paramName:n,isOptional:C!=null}),C?"/?([^\\/]+)?":"/([^\\/]+)")).replace(/\/([\w-]+)\?(\/|$)/g,"(/$1)?$2");return r.endsWith("*")?(l.push({paramName:"*"}),h+=r==="*"||r==="/*"?"(.*)$":"(?:\\/(.+)|\\/*)$"):o?h+="\\/*$":r!==""&&r!=="/"&&(h+="(?:(?=\\/|$))"),[new RegExp(h,e?void 0:"i"),l]}function nP(r){try{return r.split("/").map(e=>decodeURIComponent(e).replace(/\//g,"%2F")).join("/")}catch(e){return Cf(!1,`The URL path "${r}" could not be decoded because it is a malformed URL segment. This is probably due to a bad percent encoding (${e}).`),r}}function Fd(r,e){if(e==="/")return r;if(!r.toLowerCase().startsWith(e.toLowerCase()))return null;let o=e.endsWith("/")?e.length-1:e.length,l=r.charAt(o);return l&&l!=="/"?null:r.slice(o)||"/"}function oP(r,e="/"){let{pathname:o,search:l="",hash:h=""}=typeof r=="string"?$_(r):r;return{pathname:o?o.startsWith("/")?o:aP(o,e):e,search:cP(l),hash:uP(h)}}function aP(r,e){let o=e.replace(/\/+$/,"").split("/");return r.split("/").forEach(h=>{h===".."?o.length>1&&o.pop():h!=="."&&o.push(h)}),o.length>1?o.join("/"):"/"}function ob(r,e,o,l){return`Cannot include a '${r}' character in a manually specified \`to.${e}\` field [${JSON.stringify(l)}].  Please separate it out to the \`to.${o}\` field. Alternatively you may provide the full path as a string in <Link to="..."> and the router will parse it for you.`}function sP(r){return r.filter((e,o)=>o===0||e.route.path&&e.route.path.length>0)}function u3(r){let e=sP(r);return e.map((o,l)=>l===e.length-1?o.pathname:o.pathnameBase)}function h3(r,e,o,l=!1){let h;typeof r=="string"?h=$_(r):(h={...r},ko(!h.pathname||!h.pathname.includes("?"),ob("?","pathname","search",h)),ko(!h.pathname||!h.pathname.includes("#"),ob("#","pathname","hash",h)),ko(!h.search||!h.search.includes("#"),ob("#","search","hash",h)));let m=r===""||h.pathname==="",b=m?"/":h.pathname,n;if(b==null)n=o;else{let U=e.length-1;if(!l&&b.startsWith("..")){let q=b.split("/");for(;q[0]==="..";)q.shift(),U-=1;h.pathname=q.join("/")}n=U>=0?e[U]:"/"}let C=oP(h,n),D=b&&b!=="/"&&b.endsWith("/"),L=(m||b===".")&&o.endsWith("/");return!C.pathname.endsWith("/")&&(D||L)&&(C.pathname+="/"),C}var zd=r=>r.join("/").replace(/\/\/+/g,"/"),lP=r=>r.replace(/\/+$/,"").replace(/^\/*/,"/"),cP=r=>!r||r==="?"?"":r.startsWith("?")?r:"?"+r,uP=r=>!r||r==="#"?"":r.startsWith("#")?r:"#"+r;function hP(r){return r!=null&&typeof r.status=="number"&&typeof r.statusText=="string"&&typeof r.internal=="boolean"&&"data"in r}var f3=["POST","PUT","PATCH","DELETE"];new Set(f3);var fP=["GET",...f3];new Set(fP);var X_=Xe.createContext(null);X_.displayName="DataRouter";var Fv=Xe.createContext(null);Fv.displayName="DataRouterState";Xe.createContext(!1);var d3=Xe.createContext({isTransitioning:!1});d3.displayName="ViewTransition";var dP=Xe.createContext(new Map);dP.displayName="Fetchers";var pP=Xe.createContext(null);pP.displayName="Await";var Rf=Xe.createContext(null);Rf.displayName="Navigation";var Cy=Xe.createContext(null);Cy.displayName="Location";var Vd=Xe.createContext({outlet:null,matches:[],isDataRoute:!1});Vd.displayName="Route";var zw=Xe.createContext(null);zw.displayName="RouteError";function mP(r,{relative:e}={}){ko(Iy(),"useHref() may be used only in the context of a <Router> component.");let{basename:o,navigator:l}=Xe.useContext(Rf),{hash:h,pathname:m,search:b}=Ry(r,{relative:e}),n=m;return o!=="/"&&(n=m==="/"?o:zd([o,m])),l.createHref({pathname:n,search:b,hash:h})}function Iy(){return Xe.useContext(Cy)!=null}function Ag(){return ko(Iy(),"useLocation() may be used only in the context of a <Router> component."),Xe.useContext(Cy).location}var p3="You should call navigate() in a React.useEffect(), not when your component is first rendered.";function m3(r){Xe.useContext(Rf).static||Xe.useLayoutEffect(r)}function gP(){let{isDataRoute:r}=Xe.useContext(Vd);return r?RP():_P()}function _P(){ko(Iy(),"useNavigate() may be used only in the context of a <Router> component.");let r=Xe.useContext(X_),{basename:e,navigator:o}=Xe.useContext(Rf),{matches:l}=Xe.useContext(Vd),{pathname:h}=Ag(),m=JSON.stringify(u3(l)),b=Xe.useRef(!1);return m3(()=>{b.current=!0}),Xe.useCallback((C,D={})=>{if(Cf(b.current,p3),!b.current)return;if(typeof C=="number"){o.go(C);return}let L=h3(C,JSON.parse(m),h,D.relative==="path");r==null&&e!=="/"&&(L.pathname=L.pathname==="/"?e:zd([e,L.pathname])),(D.replace?o.replace:o.push)(L,D.state,D)},[e,o,m,h,r])}Xe.createContext(null);function Ry(r,{relative:e}={}){let{matches:o}=Xe.useContext(Vd),{pathname:l}=Ag(),h=JSON.stringify(u3(o));return Xe.useMemo(()=>h3(r,JSON.parse(h),l,e==="path"),[r,h,l,e])}function yP(r,e){return g3(r,e)}function g3(r,e,o,l,h){ko(Iy(),"useRoutes() may be used only in the context of a <Router> component.");let{navigator:m}=Xe.useContext(Rf),{matches:b}=Xe.useContext(Vd),n=b[b.length-1],C=n?n.params:{},D=n?n.pathname:"/",L=n?n.pathnameBase:"/",U=n&&n.route;{let we=U&&U.path||"";_3(D,!U||we.endsWith("*")||we.endsWith("*?"),`You rendered descendant <Routes> (or called \`useRoutes()\`) at "${D}" (under <Route path="${we}">) but the parent route path has no trailing "*". This means if you navigate deeper, the parent won't match anymore and therefore the child routes will never render.

Please change the parent <Route path="${we}"> to <Route path="${we==="/"?"*":`${we}/*`}">.`)}let q=Ag(),Z;if(e){let we=typeof e=="string"?$_(e):e;ko(L==="/"||we.pathname?.startsWith(L),`When overriding the location using \`<Routes location>\` or \`useRoutes(routes, location)\`, the location pathname must begin with the portion of the URL pathname that was matched by all parent routes. The current pathname base is "${L}" but pathname "${we.pathname}" was given in the \`location\` prop.`),Z=we}else Z=q;let ie=Z.pathname||"/",ne=ie;if(L!=="/"){let we=L.replace(/^\//,"").split("/");ne="/"+ie.replace(/^\//,"").split("/").slice(we.length).join("/")}let be=s3(r,{pathname:ne});Cf(U||be!=null,`No routes matched location "${Z.pathname}${Z.search}${Z.hash}" `),Cf(be==null||be[be.length-1].route.element!==void 0||be[be.length-1].route.Component!==void 0||be[be.length-1].route.lazy!==void 0,`Matched leaf route at location "${Z.pathname}${Z.search}${Z.hash}" does not have an element or Component. This means it will render an <Outlet /> with a null value by default resulting in an "empty" page.`);let ve=SP(be&&be.map(we=>Object.assign({},we,{params:Object.assign({},C,we.params),pathname:zd([L,m.encodeLocation?m.encodeLocation(we.pathname.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:we.pathname]),pathnameBase:we.pathnameBase==="/"?L:zd([L,m.encodeLocation?m.encodeLocation(we.pathnameBase.replace(/\?/g,"%3F").replace(/#/g,"%23")).pathname:we.pathnameBase])})),b,o,l,h);return e&&ve?Xe.createElement(Cy.Provider,{value:{location:{pathname:"/",search:"",hash:"",state:null,key:"default",...Z},navigationType:"POP"}},ve):ve}function vP(){let r=IP(),e=hP(r)?`${r.status} ${r.statusText}`:r instanceof Error?r.message:JSON.stringify(r),o=r instanceof Error?r.stack:null,l="rgba(200,200,200, 0.5)",h={padding:"0.5rem",backgroundColor:l},m={padding:"2px 4px",backgroundColor:l},b=null;return console.error("Error handled by React Router default ErrorBoundary:",r),b=Xe.createElement(Xe.Fragment,null,Xe.createElement("p",null,"💿 Hey developer 👋"),Xe.createElement("p",null,"You can provide a way better UX than this when your app throws errors by providing your own ",Xe.createElement("code",{style:m},"ErrorBoundary")," or"," ",Xe.createElement("code",{style:m},"errorElement")," prop on your route.")),Xe.createElement(Xe.Fragment,null,Xe.createElement("h2",null,"Unexpected Application Error!"),Xe.createElement("h3",{style:{fontStyle:"italic"}},e),o?Xe.createElement("pre",{style:h},o):null,b)}var xP=Xe.createElement(vP,null),bP=class extends Xe.Component{constructor(r){super(r),this.state={location:r.location,revalidation:r.revalidation,error:r.error}}static getDerivedStateFromError(r){return{error:r}}static getDerivedStateFromProps(r,e){return e.location!==r.location||e.revalidation!=="idle"&&r.revalidation==="idle"?{error:r.error,location:r.location,revalidation:r.revalidation}:{error:r.error!==void 0?r.error:e.error,location:e.location,revalidation:r.revalidation||e.revalidation}}componentDidCatch(r,e){this.props.unstable_onError?this.props.unstable_onError(r,e):console.error("React Router caught the following error during render",r)}render(){return this.state.error!==void 0?Xe.createElement(Vd.Provider,{value:this.props.routeContext},Xe.createElement(zw.Provider,{value:this.state.error,children:this.props.component})):this.props.children}};function wP({routeContext:r,match:e,children:o}){let l=Xe.useContext(X_);return l&&l.static&&l.staticContext&&(e.route.errorElement||e.route.ErrorBoundary)&&(l.staticContext._deepestRenderedBoundaryId=e.route.id),Xe.createElement(Vd.Provider,{value:r},o)}function SP(r,e=[],o=null,l=null,h=null){if(r==null){if(!o)return null;if(o.errors)r=o.matches;else if(e.length===0&&!o.initialized&&o.matches.length>0)r=o.matches;else return null}let m=r,b=o?.errors;if(b!=null){let D=m.findIndex(L=>L.route.id&&b?.[L.route.id]!==void 0);ko(D>=0,`Could not find a matching route for errors on route IDs: ${Object.keys(b).join(",")}`),m=m.slice(0,Math.min(m.length,D+1))}let n=!1,C=-1;if(o)for(let D=0;D<m.length;D++){let L=m[D];if((L.route.HydrateFallback||L.route.hydrateFallbackElement)&&(C=D),L.route.id){let{loaderData:U,errors:q}=o,Z=L.route.loader&&!U.hasOwnProperty(L.route.id)&&(!q||q[L.route.id]===void 0);if(L.route.lazy||Z){n=!0,C>=0?m=m.slice(0,C+1):m=[m[0]];break}}}return m.reduceRight((D,L,U)=>{let q,Z=!1,ie=null,ne=null;o&&(q=b&&L.route.id?b[L.route.id]:void 0,ie=L.route.errorElement||xP,n&&(C<0&&U===0?(_3("route-fallback",!1,"No `HydrateFallback` element provided to render during initial hydration"),Z=!0,ne=null):C===U&&(Z=!0,ne=L.route.hydrateFallbackElement||null)));let be=e.concat(m.slice(0,U+1)),ve=()=>{let we;return q?we=ie:Z?we=ne:L.route.Component?we=Xe.createElement(L.route.Component,null):L.route.element?we=L.route.element:we=D,Xe.createElement(wP,{match:L,routeContext:{outlet:D,matches:be,isDataRoute:o!=null},children:we})};return o&&(L.route.ErrorBoundary||L.route.errorElement||U===0)?Xe.createElement(bP,{location:o.location,revalidation:o.revalidation,component:ie,error:q,children:ve(),routeContext:{outlet:null,matches:be,isDataRoute:!0},unstable_onError:l}):ve()},null)}function Fw(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function TP(r){let e=Xe.useContext(X_);return ko(e,Fw(r)),e}function AP(r){let e=Xe.useContext(Fv);return ko(e,Fw(r)),e}function EP(r){let e=Xe.useContext(Vd);return ko(e,Fw(r)),e}function kw(r){let e=EP(r),o=e.matches[e.matches.length-1];return ko(o.route.id,`${r} can only be used on routes that contain a unique "id"`),o.route.id}function CP(){return kw("useRouteId")}function IP(){let r=Xe.useContext(zw),e=AP("useRouteError"),o=kw("useRouteError");return r!==void 0?r:e.errors?.[o]}function RP(){let{router:r}=TP("useNavigate"),e=kw("useNavigate"),o=Xe.useRef(!1);return m3(()=>{o.current=!0}),Xe.useCallback(async(h,m={})=>{Cf(o.current,p3),o.current&&(typeof h=="number"?r.navigate(h):await r.navigate(h,{fromRouteId:e,...m}))},[r,e])}var DA={};function _3(r,e,o){!e&&!DA[r]&&(DA[r]=!0,Cf(!1,o))}Xe.memo(MP);function MP({routes:r,future:e,state:o,unstable_onError:l}){return g3(r,void 0,o,l,e)}function uv(r){ko(!1,"A <Route> is only ever to be used as the child of <Routes> element, never rendered directly. Please wrap your <Route> in a <Routes>.")}function DP({basename:r="/",children:e=null,location:o,navigationType:l="POP",navigator:h,static:m=!1}){ko(!Iy(),"You cannot render a <Router> inside another <Router>. You should never have more than one in your app.");let b=r.replace(/^\/*/,"/"),n=Xe.useMemo(()=>({basename:b,navigator:h,static:m,future:{}}),[b,h,m]);typeof o=="string"&&(o=$_(o));let{pathname:C="/",search:D="",hash:L="",state:U=null,key:q="default"}=o,Z=Xe.useMemo(()=>{let ie=Fd(C,b);return ie==null?null:{location:{pathname:ie,search:D,hash:L,state:U,key:q},navigationType:l}},[b,C,D,L,U,q,l]);return Cf(Z!=null,`<Router basename="${b}"> is not able to match the URL "${C}${D}${L}" because it does not start with the basename, so the <Router> won't render anything.`),Z==null?null:Xe.createElement(Rf.Provider,{value:n},Xe.createElement(Cy.Provider,{children:e,value:Z}))}function OP({children:r,location:e}){return yP(Vb(r),e)}function Vb(r,e=[]){let o=[];return Xe.Children.forEach(r,(l,h)=>{if(!Xe.isValidElement(l))return;let m=[...e,h];if(l.type===Xe.Fragment){o.push.apply(o,Vb(l.props.children,m));return}ko(l.type===uv,`[${typeof l.type=="string"?l.type:l.type.name}] is not a <Route> component. All component children of <Routes> must be a <Route> or <React.Fragment>`),ko(!l.props.index||!l.props.children,"An index route cannot have child routes.");let b={id:l.props.id||m.join("-"),caseSensitive:l.props.caseSensitive,element:l.props.element,Component:l.props.Component,index:l.props.index,path:l.props.path,middleware:l.props.middleware,loader:l.props.loader,action:l.props.action,hydrateFallbackElement:l.props.hydrateFallbackElement,HydrateFallback:l.props.HydrateFallback,errorElement:l.props.errorElement,ErrorBoundary:l.props.ErrorBoundary,hasErrorBoundary:l.props.hasErrorBoundary===!0||l.props.ErrorBoundary!=null||l.props.errorElement!=null,shouldRevalidate:l.props.shouldRevalidate,handle:l.props.handle,lazy:l.props.lazy};l.props.children&&(b.children=Vb(l.props.children,m)),o.push(b)}),o}var hv="get",fv="application/x-www-form-urlencoded";function kv(r){return r!=null&&typeof r.tagName=="string"}function PP(r){return kv(r)&&r.tagName.toLowerCase()==="button"}function LP(r){return kv(r)&&r.tagName.toLowerCase()==="form"}function BP(r){return kv(r)&&r.tagName.toLowerCase()==="input"}function zP(r){return!!(r.metaKey||r.altKey||r.ctrlKey||r.shiftKey)}function FP(r,e){return r.button===0&&(!e||e==="_self")&&!zP(r)}var W1=null;function kP(){if(W1===null)try{new FormData(document.createElement("form"),0),W1=!1}catch{W1=!0}return W1}var NP=new Set(["application/x-www-form-urlencoded","multipart/form-data","text/plain"]);function ab(r){return r!=null&&!NP.has(r)?(Cf(!1,`"${r}" is not a valid \`encType\` for \`<Form>\`/\`<fetcher.Form>\` and will default to "${fv}"`),null):r}function VP(r,e){let o,l,h,m,b;if(LP(r)){let n=r.getAttribute("action");l=n?Fd(n,e):null,o=r.getAttribute("method")||hv,h=ab(r.getAttribute("enctype"))||fv,m=new FormData(r)}else if(PP(r)||BP(r)&&(r.type==="submit"||r.type==="image")){let n=r.form;if(n==null)throw new Error('Cannot submit a <button> or <input type="submit"> without a <form>');let C=r.getAttribute("formaction")||n.getAttribute("action");if(l=C?Fd(C,e):null,o=r.getAttribute("formmethod")||n.getAttribute("method")||hv,h=ab(r.getAttribute("formenctype"))||ab(n.getAttribute("enctype"))||fv,m=new FormData(n,r),!kP()){let{name:D,type:L,value:U}=r;if(L==="image"){let q=D?`${D}.`:"";m.append(`${q}x`,"0"),m.append(`${q}y`,"0")}else D&&m.append(D,U)}}else{if(kv(r))throw new Error('Cannot submit element that is not <form>, <button>, or <input type="submit|image">');o=hv,l=null,h=fv,b=r}return m&&h==="text/plain"&&(b=m,m=void 0),{action:l,method:o.toLowerCase(),encType:h,formData:m,body:b}}Object.getOwnPropertyNames(Object.prototype).sort().join("\0");function Nw(r,e){if(r===!1||r===null||typeof r>"u")throw new Error(e)}function UP(r,e,o){let l=typeof r=="string"?new URL(r,typeof window>"u"?"server://singlefetch/":window.location.origin):r;return l.pathname==="/"?l.pathname=`_root.${o}`:e&&Fd(l.pathname,e)==="/"?l.pathname=`${e.replace(/\/$/,"")}/_root.${o}`:l.pathname=`${l.pathname.replace(/\/$/,"")}.${o}`,l}async function jP(r,e){if(r.id in e)return e[r.id];try{let o=await import(r.module);return e[r.id]=o,o}catch(o){return console.error(`Error loading route module \`${r.module}\`, reloading page...`),console.error(o),window.__reactRouterContext&&window.__reactRouterContext.isSpaMode,window.location.reload(),new Promise(()=>{})}}function GP(r){return r==null?!1:r.href==null?r.rel==="preload"&&typeof r.imageSrcSet=="string"&&typeof r.imageSizes=="string":typeof r.rel=="string"&&typeof r.href=="string"}async function HP(r,e,o){let l=await Promise.all(r.map(async h=>{let m=e.routes[h.route.id];if(m){let b=await jP(m,o);return b.links?b.links():[]}return[]}));return ZP(l.flat(1).filter(GP).filter(h=>h.rel==="stylesheet"||h.rel==="preload").map(h=>h.rel==="stylesheet"?{...h,rel:"prefetch",as:"style"}:{...h,rel:"prefetch"}))}function OA(r,e,o,l,h,m){let b=(C,D)=>o[D]?C.route.id!==o[D].route.id:!0,n=(C,D)=>o[D].pathname!==C.pathname||o[D].route.path?.endsWith("*")&&o[D].params["*"]!==C.params["*"];return m==="assets"?e.filter((C,D)=>b(C,D)||n(C,D)):m==="data"?e.filter((C,D)=>{let L=l.routes[C.route.id];if(!L||!L.hasLoader)return!1;if(b(C,D)||n(C,D))return!0;if(C.route.shouldRevalidate){let U=C.route.shouldRevalidate({currentUrl:new URL(h.pathname+h.search+h.hash,window.origin),currentParams:o[0]?.params||{},nextUrl:new URL(r,window.origin),nextParams:C.params,defaultShouldRevalidate:!0});if(typeof U=="boolean")return U}return!0}):[]}function qP(r,e,{includeHydrateFallback:o}={}){return $P(r.map(l=>{let h=e.routes[l.route.id];if(!h)return[];let m=[h.module];return h.clientActionModule&&(m=m.concat(h.clientActionModule)),h.clientLoaderModule&&(m=m.concat(h.clientLoaderModule)),o&&h.hydrateFallbackModule&&(m=m.concat(h.hydrateFallbackModule)),h.imports&&(m=m.concat(h.imports)),m}).flat(1))}function $P(r){return[...new Set(r)]}function XP(r){let e={},o=Object.keys(r).sort();for(let l of o)e[l]=r[l];return e}function ZP(r,e){let o=new Set;return new Set(e),r.reduce((l,h)=>{let m=JSON.stringify(XP(h));return o.has(m)||(o.add(m),l.push({key:m,link:h})),l},[])}function y3(){let r=Xe.useContext(X_);return Nw(r,"You must render this element inside a <DataRouterContext.Provider> element"),r}function WP(){let r=Xe.useContext(Fv);return Nw(r,"You must render this element inside a <DataRouterStateContext.Provider> element"),r}var Vw=Xe.createContext(void 0);Vw.displayName="FrameworkContext";function v3(){let r=Xe.useContext(Vw);return Nw(r,"You must render this element inside a <HydratedRouter> element"),r}function YP(r,e){let o=Xe.useContext(Vw),[l,h]=Xe.useState(!1),[m,b]=Xe.useState(!1),{onFocus:n,onBlur:C,onMouseEnter:D,onMouseLeave:L,onTouchStart:U}=e,q=Xe.useRef(null);Xe.useEffect(()=>{if(r==="render"&&b(!0),r==="viewport"){let ne=ve=>{ve.forEach(we=>{b(we.isIntersecting)})},be=new IntersectionObserver(ne,{threshold:.5});return q.current&&be.observe(q.current),()=>{be.disconnect()}}},[r]),Xe.useEffect(()=>{if(l){let ne=setTimeout(()=>{b(!0)},100);return()=>{clearTimeout(ne)}}},[l]);let Z=()=>{h(!0)},ie=()=>{h(!1),b(!1)};return o?r!=="intent"?[m,q,{}]:[m,q,{onFocus:Y0(n,Z),onBlur:Y0(C,ie),onMouseEnter:Y0(D,Z),onMouseLeave:Y0(L,ie),onTouchStart:Y0(U,Z)}]:[!1,q,{}]}function Y0(r,e){return o=>{r&&r(o),o.defaultPrevented||e(o)}}function QP({page:r,...e}){let{router:o}=y3(),l=Xe.useMemo(()=>s3(o.routes,r,o.basename),[o.routes,r,o.basename]);return l?Xe.createElement(JP,{page:r,matches:l,...e}):null}function KP(r){let{manifest:e,routeModules:o}=v3(),[l,h]=Xe.useState([]);return Xe.useEffect(()=>{let m=!1;return HP(r,e,o).then(b=>{m||h(b)}),()=>{m=!0}},[r,e,o]),l}function JP({page:r,matches:e,...o}){let l=Ag(),{manifest:h,routeModules:m}=v3(),{basename:b}=y3(),{loaderData:n,matches:C}=WP(),D=Xe.useMemo(()=>OA(r,e,C,h,l,"data"),[r,e,C,h,l]),L=Xe.useMemo(()=>OA(r,e,C,h,l,"assets"),[r,e,C,h,l]),U=Xe.useMemo(()=>{if(r===l.pathname+l.search+l.hash)return[];let ie=new Set,ne=!1;if(e.forEach(ve=>{let we=h.routes[ve.route.id];!we||!we.hasLoader||(!D.some(Pe=>Pe.route.id===ve.route.id)&&ve.route.id in n&&m[ve.route.id]?.shouldRevalidate||we.hasClientLoader?ne=!0:ie.add(ve.route.id))}),ie.size===0)return[];let be=UP(r,b,"data");return ne&&ie.size>0&&be.searchParams.set("_routes",e.filter(ve=>ie.has(ve.route.id)).map(ve=>ve.route.id).join(",")),[be.pathname+be.search]},[b,n,l,h,D,e,r,m]),q=Xe.useMemo(()=>qP(L,h),[L,h]),Z=KP(L);return Xe.createElement(Xe.Fragment,null,U.map(ie=>Xe.createElement("link",{key:ie,rel:"prefetch",as:"fetch",href:ie,...o})),q.map(ie=>Xe.createElement("link",{key:ie,rel:"modulepreload",href:ie,...o})),Z.map(({key:ie,link:ne})=>Xe.createElement("link",{key:ie,nonce:o.nonce,...ne})))}function e4(...r){return e=>{r.forEach(o=>{typeof o=="function"?o(e):o!=null&&(o.current=e)})}}var x3=typeof window<"u"&&typeof window.document<"u"&&typeof window.document.createElement<"u";try{x3&&(window.__reactRouterVersion="7.9.3")}catch{}function t4({basename:r,children:e,window:o}){let l=Xe.useRef();l.current==null&&(l.current=jO({window:o,v5Compat:!0}));let h=l.current,[m,b]=Xe.useState({action:h.action,location:h.location}),n=Xe.useCallback(C=>{Xe.startTransition(()=>b(C))},[b]);return Xe.useLayoutEffect(()=>h.listen(n),[h,n]),Xe.createElement(DP,{basename:r,children:e,location:m.location,navigationType:m.action,navigator:h})}var b3=/^(?:[a-z][a-z0-9+.-]*:|\/\/)/i,My=Xe.forwardRef(function({onClick:e,discover:o="render",prefetch:l="none",relative:h,reloadDocument:m,replace:b,state:n,target:C,to:D,preventScrollReset:L,viewTransition:U,...q},Z){let{basename:ie}=Xe.useContext(Rf),ne=typeof D=="string"&&b3.test(D),be,ve=!1;if(typeof D=="string"&&ne&&(be=D,x3))try{let Yt=new URL(window.location.href),hr=D.startsWith("//")?new URL(Yt.protocol+D):new URL(D),pr=Fd(hr.pathname,ie);hr.origin===Yt.origin&&pr!=null?D=pr+hr.search+hr.hash:ve=!0}catch{Cf(!1,`<Link to="${D}"> contains an invalid URL which will probably break when clicked - please update to a valid URL path.`)}let we=mP(D,{relative:h}),[Pe,Ze,$e]=YP(l,q),xt=o4(D,{replace:b,state:n,target:C,preventScrollReset:L,relative:h,viewTransition:U});function Ct(Yt){e&&e(Yt),Yt.defaultPrevented||xt(Yt)}let Ft=Xe.createElement("a",{...q,...$e,href:be||we,onClick:ve||m?e:Ct,ref:e4(Z,Ze),target:C,"data-discover":!ne&&o==="render"?"true":void 0});return Pe&&!ne?Xe.createElement(Xe.Fragment,null,Ft,Xe.createElement(QP,{page:we})):Ft});My.displayName="Link";var r4=Xe.forwardRef(function({"aria-current":e="page",caseSensitive:o=!1,className:l="",end:h=!1,style:m,to:b,viewTransition:n,children:C,...D},L){let U=Ry(b,{relative:D.relative}),q=Ag(),Z=Xe.useContext(Fv),{navigator:ie,basename:ne}=Xe.useContext(Rf),be=Z!=null&&u4(U)&&n===!0,ve=ie.encodeLocation?ie.encodeLocation(U).pathname:U.pathname,we=q.pathname,Pe=Z&&Z.navigation&&Z.navigation.location?Z.navigation.location.pathname:null;o||(we=we.toLowerCase(),Pe=Pe?Pe.toLowerCase():null,ve=ve.toLowerCase()),Pe&&ne&&(Pe=Fd(Pe,ne)||Pe);const Ze=ve!=="/"&&ve.endsWith("/")?ve.length-1:ve.length;let $e=we===ve||!h&&we.startsWith(ve)&&we.charAt(Ze)==="/",xt=Pe!=null&&(Pe===ve||!h&&Pe.startsWith(ve)&&Pe.charAt(ve.length)==="/"),Ct={isActive:$e,isPending:xt,isTransitioning:be},Ft=$e?e:void 0,Yt;typeof l=="function"?Yt=l(Ct):Yt=[l,$e?"active":null,xt?"pending":null,be?"transitioning":null].filter(Boolean).join(" ");let hr=typeof m=="function"?m(Ct):m;return Xe.createElement(My,{...D,"aria-current":Ft,className:Yt,ref:L,style:hr,to:b,viewTransition:n},typeof C=="function"?C(Ct):C)});r4.displayName="NavLink";var i4=Xe.forwardRef(({discover:r="render",fetcherKey:e,navigate:o,reloadDocument:l,replace:h,state:m,method:b=hv,action:n,onSubmit:C,relative:D,preventScrollReset:L,viewTransition:U,...q},Z)=>{let ie=l4(),ne=c4(n,{relative:D}),be=b.toLowerCase()==="get"?"get":"post",ve=typeof n=="string"&&b3.test(n),we=Pe=>{if(C&&C(Pe),Pe.defaultPrevented)return;Pe.preventDefault();let Ze=Pe.nativeEvent.submitter,$e=Ze?.getAttribute("formmethod")||b;ie(Ze||Pe.currentTarget,{fetcherKey:e,method:$e,navigate:o,replace:h,state:m,relative:D,preventScrollReset:L,viewTransition:U})};return Xe.createElement("form",{ref:Z,method:be,action:ne,onSubmit:l?C:we,...q,"data-discover":!ve&&r==="render"?"true":void 0})});i4.displayName="Form";function n4(r){return`${r} must be used within a data router.  See https://reactrouter.com/en/main/routers/picking-a-router.`}function w3(r){let e=Xe.useContext(X_);return ko(e,n4(r)),e}function o4(r,{target:e,replace:o,state:l,preventScrollReset:h,relative:m,viewTransition:b}={}){let n=gP(),C=Ag(),D=Ry(r,{relative:m});return Xe.useCallback(L=>{if(FP(L,e)){L.preventDefault();let U=o!==void 0?o:py(C)===py(D);n(r,{replace:U,state:l,preventScrollReset:h,relative:m,viewTransition:b})}},[C,n,D,o,l,e,r,h,m,b])}var a4=0,s4=()=>`__${String(++a4)}__`;function l4(){let{router:r}=w3("useSubmit"),{basename:e}=Xe.useContext(Rf),o=CP();return Xe.useCallback(async(l,h={})=>{let{action:m,method:b,encType:n,formData:C,body:D}=VP(l,e);if(h.navigate===!1){let L=h.fetcherKey||s4();await r.fetch(L,o,h.action||m,{preventScrollReset:h.preventScrollReset,formData:C,body:D,formMethod:h.method||b,formEncType:h.encType||n,flushSync:h.flushSync})}else await r.navigate(h.action||m,{preventScrollReset:h.preventScrollReset,formData:C,body:D,formMethod:h.method||b,formEncType:h.encType||n,replace:h.replace,state:h.state,fromRouteId:o,flushSync:h.flushSync,viewTransition:h.viewTransition})},[r,e,o])}function c4(r,{relative:e}={}){let{basename:o}=Xe.useContext(Rf),l=Xe.useContext(Vd);ko(l,"useFormAction must be used inside a RouteContext");let[h]=l.matches.slice(-1),m={...Ry(r||".",{relative:e})},b=Ag();if(r==null){m.search=b.search;let n=new URLSearchParams(m.search),C=n.getAll("index");if(C.some(L=>L==="")){n.delete("index"),C.filter(U=>U).forEach(U=>n.append("index",U));let L=n.toString();m.search=L?`?${L}`:""}}return(!r||r===".")&&h.route.index&&(m.search=m.search?m.search.replace(/^\?/,"?index&"):"?index"),o!=="/"&&(m.pathname=m.pathname==="/"?o:zd([o,m.pathname])),py(m)}function u4(r,{relative:e}={}){let o=Xe.useContext(d3);ko(o!=null,"`useViewTransitionState` must be used within `react-router-dom`'s `RouterProvider`.  Did you accidentally import `RouterProvider` from `react-router`?");let{basename:l}=w3("useViewTransitionState"),h=Ry(r,{relative:e});if(!o.isTransitioning)return!1;let m=Fd(o.currentLocation.pathname,l)||o.currentLocation.pathname,b=Fd(o.nextLocation.pathname,l)||o.nextLocation.pathname;return Sv(h.pathname,b)!=null||Sv(h.pathname,m)!=null}a3();const S3=Xe.createContext(void 0),sb="gw_auth";function h4(){return`admin-${Math.random().toString(36).slice(2)}-${Date.now().toString(36)}`}function f4({children:r}){const[e,o]=Xe.useState(null),[l,h]=Xe.useState(!1);Xe.useEffect(()=>{try{const C=localStorage.getItem(sb);if(!C)return;const D=JSON.parse(C);D?.userId&&D?.role==="admin"&&(o(D.userId),h(!0))}catch{}},[]);const m=Xe.useCallback(C=>{const D=h4(),L={userId:D,role:"admin",name:C||"Admin",createdAt:Date.now()};localStorage.setItem(sb,JSON.stringify(L)),o(D),h(!0)},[]),b=Xe.useCallback(()=>{localStorage.removeItem(sb),o(null),h(!1)},[]),n=Xe.useMemo(()=>({isSignedIn:!!e,isAdmin:l,userId:e,registerAdmin:m,signOut:b}),[e,l,m,b]);return rt.jsx(S3.Provider,{value:n,children:r})}function d4(){const r=Xe.useContext(S3);if(!r)throw new Error("useAuth must be used within <AuthProvider>");return r}var Sf=[],Mu=[],p4=Uint8Array,lb="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/";for(var E_=0,m4=lb.length;E_<m4;++E_)Sf[E_]=lb[E_],Mu[lb.charCodeAt(E_)]=E_;Mu[45]=62;Mu[95]=63;function g4(r){var e=r.length;if(e%4>0)throw new Error("Invalid string. Length must be a multiple of 4");var o=r.indexOf("=");o===-1&&(o=e);var l=o===e?0:4-o%4;return[o,l]}function _4(r,e,o){return(e+o)*3/4-o}function my(r){var e,o=g4(r),l=o[0],h=o[1],m=new p4(_4(r,l,h)),b=0,n=h>0?l-4:l,C;for(C=0;C<n;C+=4)e=Mu[r.charCodeAt(C)]<<18|Mu[r.charCodeAt(C+1)]<<12|Mu[r.charCodeAt(C+2)]<<6|Mu[r.charCodeAt(C+3)],m[b++]=e>>16&255,m[b++]=e>>8&255,m[b++]=e&255;return h===2&&(e=Mu[r.charCodeAt(C)]<<2|Mu[r.charCodeAt(C+1)]>>4,m[b++]=e&255),h===1&&(e=Mu[r.charCodeAt(C)]<<10|Mu[r.charCodeAt(C+1)]<<4|Mu[r.charCodeAt(C+2)]>>2,m[b++]=e>>8&255,m[b++]=e&255),m}function y4(r){return Sf[r>>18&63]+Sf[r>>12&63]+Sf[r>>6&63]+Sf[r&63]}function v4(r,e,o){for(var l,h=[],m=e;m<o;m+=3)l=(r[m]<<16&16711680)+(r[m+1]<<8&65280)+(r[m+2]&255),h.push(y4(l));return h.join("")}function gy(r){for(var e,o=r.length,l=o%3,h=[],m=16383,b=0,n=o-l;b<n;b+=m)h.push(v4(r,b,b+m>n?n:b+m));return l===1?(e=r[o-1],h.push(Sf[e>>2]+Sf[e<<4&63]+"==")):l===2&&(e=(r[o-2]<<8)+r[o-1],h.push(Sf[e>>10]+Sf[e>>4&63]+Sf[e<<2&63]+"=")),h.join("")}function om(r){if(r===void 0)return{};if(!T3(r))throw new Error(`The arguments to a Convex function must be an object. Received: ${r}`);return r}function x4(r){if(typeof r>"u")throw new Error("Client created with undefined deployment address. If you used an environment variable, check that it's set.");if(typeof r!="string")throw new Error(`Invalid deployment address: found ${r}".`);if(!(r.startsWith("http:")||r.startsWith("https:")))throw new Error(`Invalid deployment address: Must start with "https://" or "http://". Found "${r}".`);try{new URL(r)}catch{throw new Error(`Invalid deployment address: "${r}" is not a valid URL. If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}if(r.endsWith(".convex.site"))throw new Error(`Invalid deployment address: "${r}" ends with .convex.site, which is used for HTTP Actions. Convex deployment URLs typically end with .convex.cloud? If you believe this URL is correct, use the \`skipConvexDeploymentUrlCheck\` option to bypass this.`)}function T3(r){const e=typeof r=="object",o=Object.getPrototypeOf(r),l=o===null||o===Object.prototype||o?.constructor?.name==="Object";return e&&l}const A3=!0,U_=BigInt("-9223372036854775808"),Uw=BigInt("9223372036854775807"),Ub=BigInt("0"),b4=BigInt("8"),w4=BigInt("256");function E3(r){return Number.isNaN(r)||!Number.isFinite(r)||Object.is(r,-0)}function S4(r){r<Ub&&(r-=U_+U_);let e=r.toString(16);e.length%2===1&&(e="0"+e);const o=new Uint8Array(new ArrayBuffer(8));let l=0;for(const h of e.match(/.{2}/g).reverse())o.set([parseInt(h,16)],l++),r>>=b4;return gy(o)}function T4(r){const e=my(r);if(e.byteLength!==8)throw new Error(`Received ${e.byteLength} bytes, expected 8 for $integer`);let o=Ub,l=Ub;for(const h of e)o+=BigInt(h)*w4**l,l++;return o>Uw&&(o+=U_+U_),o}function A4(r){if(r<U_||Uw<r)throw new Error(`BigInt ${r} does not fit into a 64-bit signed integer.`);const e=new ArrayBuffer(8);return new DataView(e).setBigInt64(0,r,!0),gy(new Uint8Array(e))}function E4(r){const e=my(r);if(e.byteLength!==8)throw new Error(`Received ${e.byteLength} bytes, expected 8 for $integer`);return new DataView(e.buffer).getBigInt64(0,!0)}const C4=DataView.prototype.setBigInt64?A4:S4,I4=DataView.prototype.getBigInt64?E4:T4,PA=1024;function C3(r){if(r.length>PA)throw new Error(`Field name ${r} exceeds maximum field name length ${PA}.`);if(r.startsWith("$"))throw new Error(`Field name ${r} starts with a '$', which is reserved.`);for(let e=0;e<r.length;e+=1){const o=r.charCodeAt(e);if(o<32||o>=127)throw new Error(`Field name ${r} has invalid character '${r[e]}': Field names can only contain non-control ASCII characters`)}}function j_(r){if(r===null||typeof r=="boolean"||typeof r=="number"||typeof r=="string")return r;if(Array.isArray(r))return r.map(l=>j_(l));if(typeof r!="object")throw new Error(`Unexpected type of ${r}`);const e=Object.entries(r);if(e.length===1){const l=e[0][0];if(l==="$bytes"){if(typeof r.$bytes!="string")throw new Error(`Malformed $bytes field on ${r}`);return my(r.$bytes).buffer}if(l==="$integer"){if(typeof r.$integer!="string")throw new Error(`Malformed $integer field on ${r}`);return I4(r.$integer)}if(l==="$float"){if(typeof r.$float!="string")throw new Error(`Malformed $float field on ${r}`);const h=my(r.$float);if(h.byteLength!==8)throw new Error(`Received ${h.byteLength} bytes, expected 8 for $float`);const b=new DataView(h.buffer).getFloat64(0,A3);if(!E3(b))throw new Error(`Float ${b} should be encoded as a number`);return b}if(l==="$set")throw new Error("Received a Set which is no longer supported as a Convex type.");if(l==="$map")throw new Error("Received a Map which is no longer supported as a Convex type.")}const o={};for(const[l,h]of Object.entries(r))C3(l),o[l]=j_(h);return o}function sy(r){return JSON.stringify(r,(e,o)=>o===void 0?"undefined":typeof o=="bigint"?`${o.toString()}n`:o)}function jb(r,e,o,l){if(r===void 0){const b=o&&` (present at path ${o} in original object ${sy(e)})`;throw new Error(`undefined is not a valid Convex value${b}. To learn about Convex's supported types, see https://docs.convex.dev/using/types.`)}if(r===null)return r;if(typeof r=="bigint"){if(r<U_||Uw<r)throw new Error(`BigInt ${r} does not fit into a 64-bit signed integer.`);return{$integer:C4(r)}}if(typeof r=="number")if(E3(r)){const b=new ArrayBuffer(8);return new DataView(b).setFloat64(0,r,A3),{$float:gy(new Uint8Array(b))}}else return r;if(typeof r=="boolean"||typeof r=="string")return r;if(r instanceof ArrayBuffer)return{$bytes:gy(new Uint8Array(r))};if(Array.isArray(r))return r.map((b,n)=>jb(b,e,o+`[${n}]`));if(r instanceof Set)throw new Error(cb(o,"Set",[...r],e));if(r instanceof Map)throw new Error(cb(o,"Map",[...r],e));if(!T3(r)){const b=r?.constructor?.name,n=b?`${b} `:"";throw new Error(cb(o,n,r,e))}const h={},m=Object.entries(r);m.sort(([b,n],[C,D])=>b===C?0:b<C?-1:1);for(const[b,n]of m)n!==void 0&&(C3(b),h[b]=jb(n,e,o+`.${b}`));return h}function cb(r,e,o,l){return r?`${e}${sy(o)} is not a supported Convex type (present at path ${r} in original object ${sy(l)}). To learn about Convex's supported types, see https://docs.convex.dev/using/types.`:`${e}${sy(o)} is not a supported Convex type.`}function _y(r){return jb(r,r,"")}var R4=Object.defineProperty,M4=(r,e,o)=>e in r?R4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,ub=(r,e,o)=>M4(r,typeof e!="symbol"?e+"":e,o),LA,BA;const D4=Symbol.for("ConvexError");class Gb extends(BA=Error,LA=D4,BA){constructor(e){super(typeof e=="string"?e:sy(e)),ub(this,"name","ConvexError"),ub(this,"data"),ub(this,LA,!0),this.data=e}}const I3=()=>Array.from({length:4},()=>0);I3();I3();const zA="1.27.3";var O4=Object.defineProperty,P4=(r,e,o)=>e in r?O4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,FA=(r,e,o)=>P4(r,typeof e!="symbol"?e+"":e,o);const L4="color:rgb(0, 145, 255)";function R3(r){switch(r){case"query":return"Q";case"mutation":return"M";case"action":return"A";case"any":return"?"}}class M3{constructor(e){FA(this,"_onLogLineFuncs"),FA(this,"_verbose"),this._onLogLineFuncs={},this._verbose=e.verbose}addLogLineListener(e){let o=Math.random().toString(36).substring(2,15);for(let l=0;l<10&&this._onLogLineFuncs[o]!==void 0;l++)o=Math.random().toString(36).substring(2,15);return this._onLogLineFuncs[o]=e,()=>{delete this._onLogLineFuncs[o]}}logVerbose(...e){if(this._verbose)for(const o of Object.values(this._onLogLineFuncs))o("debug",`${new Date().toISOString()}`,...e)}log(...e){for(const o of Object.values(this._onLogLineFuncs))o("info",...e)}warn(...e){for(const o of Object.values(this._onLogLineFuncs))o("warn",...e)}error(...e){for(const o of Object.values(this._onLogLineFuncs))o("error",...e)}}function D3(r){const e=new M3(r);return e.addLogLineListener((o,...l)=>{switch(o){case"debug":console.debug(...l);break;case"info":console.log(...l);break;case"warn":console.warn(...l);break;case"error":console.error(...l);break;default:console.log(...l)}}),e}function O3(r){return new M3(r)}function Tv(r,e,o,l,h){const m=R3(o);if(typeof h=="object"&&(h=`ConvexError ${JSON.stringify(h.errorData,null,2)}`),e==="info"){const b=h.match(/^\[.*?\] /);if(b===null){r.error(`[CONVEX ${m}(${l})] Could not parse console.log`);return}const n=h.slice(1,b[0].length-2),C=h.slice(b[0].length);r.log(`%c[CONVEX ${m}(${l})] [${n}]`,L4,C)}else r.error(`[CONVEX ${m}(${l})] ${h}`)}function B4(r,e){const o=`[CONVEX FATAL ERROR] ${e}`;return r.error(o),new Error(o)}function R_(r,e,o){return`[CONVEX ${R3(r)}(${e})] ${o.errorMessage}
  Called by client`}function Hb(r,e){return e.data=r.errorData,e}function Av(r){const e=r.split(":");let o,l;return e.length===1?(o=e[0],l="default"):(o=e.slice(0,e.length-1).join(":"),l=e[e.length-1]),o.endsWith(".js")&&(o=o.slice(0,-3)),`${o}:${l}`}function vg(r,e){return JSON.stringify({udfPath:Av(r),args:_y(e)})}var z4=Object.defineProperty,F4=(r,e,o)=>e in r?z4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,wf=(r,e,o)=>F4(r,typeof e!="symbol"?e+"":e,o);class k4{constructor(){wf(this,"nextQueryId"),wf(this,"querySetVersion"),wf(this,"querySet"),wf(this,"queryIdToToken"),wf(this,"identityVersion"),wf(this,"auth"),wf(this,"outstandingQueriesOlderThanRestart"),wf(this,"outstandingAuthOlderThanRestart"),wf(this,"paused"),wf(this,"pendingQuerySetModifications"),this.nextQueryId=0,this.querySetVersion=0,this.identityVersion=0,this.querySet=new Map,this.queryIdToToken=new Map,this.outstandingQueriesOlderThanRestart=new Set,this.outstandingAuthOlderThanRestart=!1,this.paused=!1,this.pendingQuerySetModifications=new Map}hasSyncedPastLastReconnect(){return this.outstandingQueriesOlderThanRestart.size===0&&!this.outstandingAuthOlderThanRestart}markAuthCompletion(){this.outstandingAuthOlderThanRestart=!1}subscribe(e,o,l,h){const m=Av(e),b=vg(m,o),n=this.querySet.get(b);if(n!==void 0)return n.numSubscribers+=1,{queryToken:b,modification:null,unsubscribe:()=>this.removeSubscriber(b)};{const C=this.nextQueryId++,D={id:C,canonicalizedUdfPath:m,args:o,numSubscribers:1,journal:l,componentPath:h};this.querySet.set(b,D),this.queryIdToToken.set(C,b);const L=this.querySetVersion,U=this.querySetVersion+1,q={type:"Add",queryId:C,udfPath:m,args:[_y(o)],journal:l,componentPath:h};return this.paused?this.pendingQuerySetModifications.set(C,q):this.querySetVersion=U,{queryToken:b,modification:{type:"ModifyQuerySet",baseVersion:L,newVersion:U,modifications:[q]},unsubscribe:()=>this.removeSubscriber(b)}}}transition(e){for(const o of e.modifications)switch(o.type){case"QueryUpdated":case"QueryFailed":{this.outstandingQueriesOlderThanRestart.delete(o.queryId);const l=o.journal;if(l!==void 0){const h=this.queryIdToToken.get(o.queryId);h!==void 0&&(this.querySet.get(h).journal=l)}break}case"QueryRemoved":{this.outstandingQueriesOlderThanRestart.delete(o.queryId);break}default:throw new Error(`Invalid modification ${o.type}`)}}queryId(e,o){const l=Av(e),h=vg(l,o),m=this.querySet.get(h);return m!==void 0?m.id:null}isCurrentOrNewerAuthVersion(e){return e>=this.identityVersion}setAuth(e){this.auth={tokenType:"User",value:e};const o=this.identityVersion;return this.paused||(this.identityVersion=o+1),{type:"Authenticate",baseVersion:o,...this.auth}}setAdminAuth(e,o){const l={tokenType:"Admin",value:e,impersonating:o};this.auth=l;const h=this.identityVersion;return this.paused||(this.identityVersion=h+1),{type:"Authenticate",baseVersion:h,...l}}clearAuth(){this.auth=void 0,this.markAuthCompletion();const e=this.identityVersion;return this.paused||(this.identityVersion=e+1),{type:"Authenticate",tokenType:"None",baseVersion:e}}hasAuth(){return!!this.auth}isNewAuth(e){return this.auth?.value!==e}queryPath(e){const o=this.queryIdToToken.get(e);return o?this.querySet.get(o).canonicalizedUdfPath:null}queryArgs(e){const o=this.queryIdToToken.get(e);return o?this.querySet.get(o).args:null}queryToken(e){return this.queryIdToToken.get(e)??null}queryJournal(e){return this.querySet.get(e)?.journal}restart(e){this.unpause(),this.outstandingQueriesOlderThanRestart.clear();const o=[];for(const m of this.querySet.values()){const b={type:"Add",queryId:m.id,udfPath:m.canonicalizedUdfPath,args:[_y(m.args)],journal:m.journal,componentPath:m.componentPath};o.push(b),e.has(m.id)||this.outstandingQueriesOlderThanRestart.add(m.id)}this.querySetVersion=1;const l={type:"ModifyQuerySet",baseVersion:0,newVersion:1,modifications:o};if(!this.auth)return this.identityVersion=0,[l,void 0];this.outstandingAuthOlderThanRestart=!0;const h={type:"Authenticate",baseVersion:0,...this.auth};return this.identityVersion=1,[l,h]}pause(){this.paused=!0}resume(){const e=this.pendingQuerySetModifications.size>0?{type:"ModifyQuerySet",baseVersion:this.querySetVersion,newVersion:++this.querySetVersion,modifications:Array.from(this.pendingQuerySetModifications.values())}:void 0,o=this.auth!==void 0?{type:"Authenticate",baseVersion:this.identityVersion++,...this.auth}:void 0;return this.unpause(),[e,o]}unpause(){this.paused=!1,this.pendingQuerySetModifications.clear()}removeSubscriber(e){const o=this.querySet.get(e);if(o.numSubscribers>1)return o.numSubscribers-=1,null;{this.querySet.delete(e),this.queryIdToToken.delete(o.id),this.outstandingQueriesOlderThanRestart.delete(o.id);const l=this.querySetVersion,h=this.querySetVersion+1,m={type:"Remove",queryId:o.id};return this.paused?this.pendingQuerySetModifications.has(o.id)?this.pendingQuerySetModifications.delete(o.id):this.pendingQuerySetModifications.set(o.id,m):this.querySetVersion=h,{type:"ModifyQuerySet",baseVersion:l,newVersion:h,modifications:[m]}}}}var N4=Object.defineProperty,V4=(r,e,o)=>e in r?N4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,Y1=(r,e,o)=>V4(r,typeof e!="symbol"?e+"":e,o);class U4{constructor(e,o){this.logger=e,this.markConnectionStateDirty=o,Y1(this,"inflightRequests"),Y1(this,"requestsOlderThanRestart"),Y1(this,"inflightMutationsCount",0),Y1(this,"inflightActionsCount",0),this.inflightRequests=new Map,this.requestsOlderThanRestart=new Set}request(e,o){const l=new Promise(h=>{const m=o?"Requested":"NotSent";this.inflightRequests.set(e.requestId,{message:e,status:{status:m,requestedAt:new Date,onResult:h}}),e.type==="Mutation"?this.inflightMutationsCount++:e.type==="Action"&&this.inflightActionsCount++});return this.markConnectionStateDirty(),l}onResponse(e){const o=this.inflightRequests.get(e.requestId);if(o===void 0||o.status.status==="Completed")return null;const l=o.message.type==="Mutation"?"mutation":"action",h=o.message.udfPath;for(const C of e.logLines)Tv(this.logger,"info",l,h,C);const m=o.status;let b,n;if(e.success)b={success:!0,logLines:e.logLines,value:j_(e.result)},n=()=>m.onResult(b);else{const C=e.result,{errorData:D}=e;Tv(this.logger,"error",l,h,C),b={success:!1,errorMessage:C,errorData:D!==void 0?j_(D):void 0,logLines:e.logLines},n=()=>m.onResult(b)}return e.type==="ActionResponse"||!e.success?(n(),this.inflightRequests.delete(e.requestId),this.requestsOlderThanRestart.delete(e.requestId),o.message.type==="Action"?this.inflightActionsCount--:o.message.type==="Mutation"&&this.inflightMutationsCount--,this.markConnectionStateDirty(),{requestId:e.requestId,result:b}):(o.status={status:"Completed",result:b,ts:e.ts,onResolve:n},null)}removeCompleted(e){const o=new Map;for(const[l,h]of this.inflightRequests.entries()){const m=h.status;m.status==="Completed"&&m.ts.lessThanOrEqual(e)&&(m.onResolve(),o.set(l,m.result),h.message.type==="Mutation"?this.inflightMutationsCount--:h.message.type==="Action"&&this.inflightActionsCount--,this.inflightRequests.delete(l),this.requestsOlderThanRestart.delete(l))}return o.size>0&&this.markConnectionStateDirty(),o}restart(){this.requestsOlderThanRestart=new Set(this.inflightRequests.keys());const e=[];for(const[o,l]of this.inflightRequests){if(l.status.status==="NotSent"){l.status.status="Requested",e.push(l.message);continue}if(l.message.type==="Mutation")e.push(l.message);else if(l.message.type==="Action"){if(this.inflightRequests.delete(o),this.requestsOlderThanRestart.delete(o),this.inflightActionsCount--,l.status.status==="Completed")throw new Error("Action should never be in 'Completed' state");l.status.onResult({success:!1,errorMessage:"Connection lost while action was in flight",logLines:[]})}}return this.markConnectionStateDirty(),e}resume(){const e=[];for(const[,o]of this.inflightRequests)if(o.status.status==="NotSent"){o.status.status="Requested",e.push(o.message);continue}return e}hasIncompleteRequests(){for(const e of this.inflightRequests.values())if(e.status.status==="Requested")return!0;return!1}hasInflightRequests(){return this.inflightRequests.size>0}hasSyncedPastLastReconnect(){return this.requestsOlderThanRestart.size===0}timeOfOldestInflightRequest(){if(this.inflightRequests.size===0)return null;let e=Date.now();for(const o of this.inflightRequests.values())o.status.status!=="Completed"&&o.status.requestedAt.getTime()<e&&(e=o.status.requestedAt.getTime());return new Date(e)}inflightMutations(){return this.inflightMutationsCount}inflightActions(){return this.inflightActionsCount}}const Ev=Symbol.for("functionName"),j4=Symbol.for("toReferencePath");function G4(r){return r[j4]??null}function H4(r){return r.startsWith("function://")}function q4(r){let e;if(typeof r=="string")H4(r)?e={functionHandle:r}:e={name:r};else if(r[Ev])e={name:r[Ev]};else{const o=G4(r);if(!o)throw new Error(`${r} is not a functionReference`);e={reference:o}}return e}function N_(r){const e=q4(r);if(e.name===void 0)throw e.functionHandle!==void 0?new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received function handle ${e.functionHandle}`):e.reference!==void 0?new Error(`Expected function reference in the current component like "api.file.func" or "internal.file.func", but received reference ${e.reference}`):new Error(`Expected function reference like "api.file.func" or "internal.file.func", but received ${JSON.stringify(e)}`);if(typeof r=="string")return r;const o=r[Ev];if(!o)throw new Error(`${r} is not a functionReference`);return o}function P3(r=[]){const e={get(o,l){if(typeof l=="string"){const h=[...r,l];return P3(h)}else if(l===Ev){if(r.length<2){const b=["api",...r].join(".");throw new Error(`API path is expected to be of the form \`api.moduleName.functionName\`. Found: \`${b}\``)}const h=r.slice(0,-1).join("/"),m=r[r.length-1];return m==="default"?h:h+":"+m}else return l===Symbol.toStringTag?"FunctionReference":void 0}};return new Proxy({},e)}const $4=P3();var X4=Object.defineProperty,Z4=(r,e,o)=>e in r?X4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,Cv=(r,e,o)=>Z4(r,typeof e!="symbol"?e+"":e,o);class yy{constructor(e){Cv(this,"queryResults"),Cv(this,"modifiedQueries"),this.queryResults=e,this.modifiedQueries=[]}getQuery(e,...o){const l=om(o[0]),h=N_(e),m=this.queryResults.get(vg(h,l));if(m!==void 0)return yy.queryValue(m.result)}getAllQueries(e){const o=[],l=N_(e);for(const h of this.queryResults.values())h.udfPath===Av(l)&&o.push({args:h.args,value:yy.queryValue(h.result)});return o}setQuery(e,o,l){const h=om(o),m=N_(e),b=vg(m,h);let n;l===void 0?n=void 0:n={success:!0,value:l,logLines:[]};const C={udfPath:m,args:h,result:n};this.queryResults.set(b,C),this.modifiedQueries.push(b)}static queryValue(e){if(e!==void 0)return e.success?e.value:void 0}}class W4{constructor(){Cv(this,"queryResults"),Cv(this,"optimisticUpdates"),this.queryResults=new Map,this.optimisticUpdates=[]}ingestQueryResultsFromServer(e,o){this.optimisticUpdates=this.optimisticUpdates.filter(b=>!o.has(b.mutationId));const l=this.queryResults;this.queryResults=new Map(e);const h=new yy(this.queryResults);for(const b of this.optimisticUpdates)b.update(h);const m=[];for(const[b,n]of this.queryResults){const C=l.get(b);(C===void 0||C.result!==n.result)&&m.push(b)}return m}applyOptimisticUpdate(e,o){this.optimisticUpdates.push({update:e,mutationId:o});const l=new yy(this.queryResults);return e(l),l.modifiedQueries}rawQueryResult(e){return this.queryResults.get(e)}queryResult(e){const o=this.queryResults.get(e);if(o===void 0)return;const l=o.result;if(l!==void 0){if(l.success)return l.value;throw l.errorData!==void 0?Hb(l,new Gb(R_("query",o.udfPath,l))):new Error(R_("query",o.udfPath,l))}}hasQueryResult(e){return this.queryResults.get(e)!==void 0}queryLogs(e){return this.queryResults.get(e)?.result?.logLines}}var Y4=Object.defineProperty,Q4=(r,e,o)=>e in r?Y4(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,hb=(r,e,o)=>Q4(r,typeof e!="symbol"?e+"":e,o);let Nv=class Ld{constructor(e,o){hb(this,"low"),hb(this,"high"),hb(this,"__isUnsignedLong__"),this.low=e|0,this.high=o|0,this.__isUnsignedLong__=!0}static isLong(e){return(e&&e.__isUnsignedLong__)===!0}static fromBytesLE(e){return new Ld(e[0]|e[1]<<8|e[2]<<16|e[3]<<24,e[4]|e[5]<<8|e[6]<<16|e[7]<<24)}toBytesLE(){const e=this.high,o=this.low;return[o&255,o>>>8&255,o>>>16&255,o>>>24,e&255,e>>>8&255,e>>>16&255,e>>>24]}static fromNumber(e){return isNaN(e)||e<0?kA:e>=K4?J4:new Ld(e%ly|0,e/ly|0)}toString(){return(BigInt(this.high)*BigInt(ly)+BigInt(this.low)).toString()}equals(e){return Ld.isLong(e)||(e=Ld.fromValue(e)),this.high>>>31===1&&e.high>>>31===1?!1:this.high===e.high&&this.low===e.low}notEquals(e){return!this.equals(e)}comp(e){return Ld.isLong(e)||(e=Ld.fromValue(e)),this.equals(e)?0:e.high>>>0>this.high>>>0||e.high===this.high&&e.low>>>0>this.low>>>0?-1:1}lessThanOrEqual(e){return this.comp(e)<=0}static fromValue(e){return typeof e=="number"?Ld.fromNumber(e):new Ld(e.low,e.high)}};const kA=new Nv(0,0),NA=65536,ly=NA*NA,K4=ly*ly,J4=new Nv(-1,-1);var eL=Object.defineProperty,tL=(r,e,o)=>e in r?eL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,Q1=(r,e,o)=>tL(r,typeof e!="symbol"?e+"":e,o);class VA{constructor(e,o){Q1(this,"version"),Q1(this,"remoteQuerySet"),Q1(this,"queryPath"),Q1(this,"logger"),this.version={querySet:0,ts:Nv.fromNumber(0),identity:0},this.remoteQuerySet=new Map,this.queryPath=e,this.logger=o}transition(e){const o=e.startVersion;if(this.version.querySet!==o.querySet||this.version.ts.notEquals(o.ts)||this.version.identity!==o.identity)throw new Error(`Invalid start version: ${o.ts.toString()}:${o.querySet}`);for(const l of e.modifications)switch(l.type){case"QueryUpdated":{const h=this.queryPath(l.queryId);if(h)for(const b of l.logLines)Tv(this.logger,"info","query",h,b);const m=j_(l.value??null);this.remoteQuerySet.set(l.queryId,{success:!0,value:m,logLines:l.logLines});break}case"QueryFailed":{const h=this.queryPath(l.queryId);if(h)for(const b of l.logLines)Tv(this.logger,"info","query",h,b);const{errorData:m}=l;this.remoteQuerySet.set(l.queryId,{success:!1,errorMessage:l.errorMessage,errorData:m!==void 0?j_(m):void 0,logLines:l.logLines});break}case"QueryRemoved":{this.remoteQuerySet.delete(l.queryId);break}default:throw new Error(`Invalid modification ${l.type}`)}this.version=e.endVersion}remoteQueryResults(){return this.remoteQuerySet}timestamp(){return this.version.ts}}function fb(r){const e=my(r);return Nv.fromBytesLE(Array.from(e))}function rL(r){const e=new Uint8Array(r.toBytesLE());return gy(e)}function iL(r){switch(r.type){case"FatalError":case"AuthError":case"ActionResponse":case"Ping":return{...r};case"MutationResponse":return r.success?{...r,ts:fb(r.ts)}:{...r};case"Transition":return{...r,startVersion:{...r.startVersion,ts:fb(r.startVersion.ts)},endVersion:{...r.endVersion,ts:fb(r.endVersion.ts)}}}}function nL(r){switch(r.type){case"Authenticate":case"ModifyQuerySet":case"Mutation":case"Action":case"Event":return{...r};case"Connect":return r.maxObservedTimestamp!==void 0?{...r,maxObservedTimestamp:rL(r.maxObservedTimestamp)}:{...r,maxObservedTimestamp:void 0}}}var oL=Object.defineProperty,aL=(r,e,o)=>e in r?oL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,Us=(r,e,o)=>aL(r,typeof e!="symbol"?e+"":e,o);const sL=1e3,lL=1001,cL=1005,uL=4040;let dv;function pv(){return dv===void 0&&(dv=Date.now()),typeof performance>"u"||!performance.now?Date.now():Math.round(dv+performance.now())}function UA(){return`t=${Math.round((pv()-dv)/100)/10}s`}const L3={InternalServerError:{timeout:1e3},SubscriptionsWorkerFullError:{timeout:3e3},TooManyConcurrentRequests:{timeout:3e3},CommitterFullError:{timeout:3e3},AwsTooManyRequestsException:{timeout:3e3},ExecuteFullError:{timeout:3e3},SystemTimeoutError:{timeout:3e3},ExpiredInQueue:{timeout:3e3},VectorIndexesUnavailable:{timeout:1e3},SearchIndexesUnavailable:{timeout:1e3},TableSummariesUnavailable:{timeout:1e3},VectorIndexTooLarge:{timeout:3e3},SearchIndexTooLarge:{timeout:3e3},TooManyWritesInTimePeriod:{timeout:3e3}};function hL(r){if(r===void 0)return"Unknown";for(const e of Object.keys(L3))if(r.startsWith(e))return e;return"Unknown"}class fL{constructor(e,o,l,h,m,b){this.markConnectionStateDirty=m,this.debug=b,Us(this,"socket"),Us(this,"connectionCount"),Us(this,"_hasEverConnected",!1),Us(this,"lastCloseReason"),Us(this,"defaultInitialBackoff"),Us(this,"maxBackoff"),Us(this,"retries"),Us(this,"serverInactivityThreshold"),Us(this,"reconnectDueToServerInactivityTimeout"),Us(this,"uri"),Us(this,"onOpen"),Us(this,"onResume"),Us(this,"onMessage"),Us(this,"webSocketConstructor"),Us(this,"logger"),Us(this,"onServerDisconnectError"),this.webSocketConstructor=l,this.socket={state:"disconnected"},this.connectionCount=0,this.lastCloseReason="InitialConnect",this.defaultInitialBackoff=1e3,this.maxBackoff=16e3,this.retries=0,this.serverInactivityThreshold=6e4,this.reconnectDueToServerInactivityTimeout=null,this.uri=e,this.onOpen=o.onOpen,this.onResume=o.onResume,this.onMessage=o.onMessage,this.onServerDisconnectError=o.onServerDisconnectError,this.logger=h,this.connect()}setSocketState(e){this.socket=e,this._logVerbose(`socket state changed: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}`),this.markConnectionStateDirty()}connect(){if(this.socket.state==="terminated")return;if(this.socket.state!=="disconnected"&&this.socket.state!=="stopped")throw new Error("Didn't start connection from disconnected state: "+this.socket.state);const e=new this.webSocketConstructor(this.uri);this._logVerbose("constructed WebSocket"),this.setSocketState({state:"connecting",ws:e,paused:"no"}),this.resetServerInactivityTimeout(),e.onopen=()=>{if(this.logger.logVerbose("begin ws.onopen"),this.socket.state!=="connecting")throw new Error("onopen called with socket not in connecting state");this.setSocketState({state:"ready",ws:e,paused:this.socket.paused==="yes"?"uninitialized":"no"}),this.resetServerInactivityTimeout(),this.socket.paused==="no"&&(this._hasEverConnected=!0,this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:pv()})),this.lastCloseReason!=="InitialConnect"&&(this.lastCloseReason?this.logger.log("WebSocket reconnected at",UA(),"after disconnect due to",this.lastCloseReason):this.logger.log("WebSocket reconnected at",UA())),this.connectionCount+=1,this.lastCloseReason=null},e.onerror=o=>{const l=o.message;l&&this.logger.log(`WebSocket error message: ${l}`)},e.onmessage=o=>{this.resetServerInactivityTimeout();const l=o.data.length,h=iL(JSON.parse(o.data));this._logVerbose(`received ws message with type ${h.type}`),h.type==="Transition"&&this.reportLargeTransition({messageLength:l,transition:h}),this.onMessage(h).hasSyncedPastLastReconnect&&(this.retries=0,this.markConnectionStateDirty())},e.onclose=o=>{if(this._logVerbose("begin ws.onclose"),this.lastCloseReason===null&&(this.lastCloseReason=o.reason||`closed with code ${o.code}`),o.code!==sL&&o.code!==lL&&o.code!==cL&&o.code!==uL){let h=`WebSocket closed with code ${o.code}`;o.reason&&(h+=`: ${o.reason}`),this.logger.log(h),this.onServerDisconnectError&&o.reason&&this.onServerDisconnectError(h)}const l=hL(o.reason);this.scheduleReconnect(l)}}socketState(){return this.socket.state}sendMessage(e){const o={type:e.type,...e.type==="Authenticate"&&e.tokenType==="User"?{value:`...${e.value.slice(-7)}`}:{}};if(this.socket.state==="ready"&&this.socket.paused==="no"){const l=nL(e),h=JSON.stringify(l);let m=!1;try{this.socket.ws.send(h),m=!0}catch(b){this.logger.log(`Failed to send message on WebSocket, reconnecting: ${b}`),this.closeAndReconnect("FailedToSendMessage")}return this._logVerbose(`${m?"sent":"failed to send"} message with type ${e.type}: ${JSON.stringify(o)}`),!0}return this._logVerbose(`message not sent (socket state: ${this.socket.state}, paused: ${"paused"in this.socket?this.socket.paused:void 0}): ${JSON.stringify(o)}`),!1}resetServerInactivityTimeout(){this.socket.state!=="terminated"&&(this.reconnectDueToServerInactivityTimeout!==null&&(clearTimeout(this.reconnectDueToServerInactivityTimeout),this.reconnectDueToServerInactivityTimeout=null),this.reconnectDueToServerInactivityTimeout=setTimeout(()=>{this.closeAndReconnect("InactiveServer")},this.serverInactivityThreshold))}scheduleReconnect(e){this.socket={state:"disconnected"};const o=this.nextBackoff(e);this.markConnectionStateDirty(),this.logger.log(`Attempting reconnect in ${Math.round(o)}ms`),setTimeout(()=>this.connect(),o)}closeAndReconnect(e){switch(this._logVerbose(`begin closeAndReconnect with reason ${e}`),this.socket.state){case"disconnected":case"terminated":case"stopped":return;case"connecting":case"ready":{this.lastCloseReason=e,this.close(),this.scheduleReconnect("client");return}default:this.socket}}close(){switch(this.socket.state){case"disconnected":case"terminated":case"stopped":return Promise.resolve();case"connecting":{const e=this.socket.ws;return new Promise(o=>{e.onclose=()=>{this._logVerbose("Closed after connecting"),o()},e.onopen=()=>{this._logVerbose("Opened after connecting"),e.close()}})}case"ready":{this._logVerbose("ws.close called");const e=this.socket.ws,o=new Promise(l=>{e.onclose=()=>{l()}});return e.close(),o}default:return this.socket,Promise.resolve()}}terminate(){switch(this.reconnectDueToServerInactivityTimeout&&clearTimeout(this.reconnectDueToServerInactivityTimeout),this.socket.state){case"terminated":case"stopped":case"disconnected":case"connecting":case"ready":{const e=this.close();return this.setSocketState({state:"terminated"}),e}default:throw this.socket,new Error(`Invalid websocket state: ${this.socket.state}`)}}stop(){switch(this.socket.state){case"terminated":return Promise.resolve();case"connecting":case"stopped":case"disconnected":case"ready":{const e=this.close();return this.socket={state:"stopped"},e}default:return this.socket,Promise.resolve()}}tryRestart(){switch(this.socket.state){case"stopped":break;case"terminated":case"connecting":case"ready":case"disconnected":this.logger.logVerbose("Restart called without stopping first");return;default:this.socket}this.connect()}pause(){switch(this.socket.state){case"disconnected":case"stopped":case"terminated":return;case"connecting":case"ready":{this.socket={...this.socket,paused:"yes"};return}default:{this.socket;return}}}resume(){switch(this.socket.state){case"connecting":this.socket={...this.socket,paused:"no"};return;case"ready":this.socket.paused==="uninitialized"?(this.socket={...this.socket,paused:"no"},this.onOpen({connectionCount:this.connectionCount,lastCloseReason:this.lastCloseReason,clientTs:pv()})):this.socket.paused==="yes"&&(this.socket={...this.socket,paused:"no"},this.onResume());return;case"terminated":case"stopped":case"disconnected":return;default:this.socket}this.connect()}connectionState(){return{isConnected:this.socket.state==="ready",hasEverConnected:this._hasEverConnected,connectionCount:this.connectionCount,connectionRetries:this.retries}}_logVerbose(e){this.logger.logVerbose(e)}nextBackoff(e){const l=(e==="client"?100:e==="Unknown"?this.defaultInitialBackoff:L3[e].timeout)*Math.pow(2,this.retries);this.retries+=1;const h=Math.min(l,this.maxBackoff),m=h*(Math.random()-.5);return h+m}reportLargeTransition({transition:e,messageLength:o}){if(e.clientClockSkew===void 0||e.serverTs===void 0)return;const l=pv()-e.clientClockSkew-e.serverTs/1e6,h=`${Math.round(l)}ms`,m=`${Math.round(o/1e4)/100}MB`,b=o/(l/1e3),n=`${Math.round(b/1e4)/100}MB per second`;this._logVerbose(`received ${m} transition in ${h} at ${n}`),o>2e7?this.logger.log(`received query results totaling more that 20MB (${m}) which will take a long time to download on slower connections`):l>2e4&&this.logger.log(`received query results totaling ${m} which took more than 20s to arrive (${h})`),this.debug&&l>2e3&&this.sendMessage({type:"Event",eventType:"ClientReceivedTransition",event:{transitionTransitTime:l,messageLength:o}})}}function dL(){return pL()}function pL(){return"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}class ty extends Error{}ty.prototype.name="InvalidTokenError";function mL(r){return decodeURIComponent(atob(r).replace(/(.)/g,(e,o)=>{let l=o.charCodeAt(0).toString(16).toUpperCase();return l.length<2&&(l="0"+l),"%"+l}))}function gL(r){let e=r.replace(/-/g,"+").replace(/_/g,"/");switch(e.length%4){case 0:break;case 2:e+="==";break;case 3:e+="=";break;default:throw new Error("base64 string is not of the correct length")}try{return mL(e)}catch{return atob(e)}}function _L(r,e){if(typeof r!="string")throw new ty("Invalid token specified: must be a string");e||(e={});const o=e.header===!0?0:1,l=r.split(".")[o];if(typeof l!="string")throw new ty(`Invalid token specified: missing part #${o+1}`);let h;try{h=gL(l)}catch(m){throw new ty(`Invalid token specified: invalid base64 for part #${o+1} (${m.message})`)}try{return JSON.parse(h)}catch(m){throw new ty(`Invalid token specified: invalid json for part #${o+1} (${m.message})`)}}var yL=Object.defineProperty,vL=(r,e,o)=>e in r?yL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,Eu=(r,e,o)=>vL(r,typeof e!="symbol"?e+"":e,o);const xL=480*60*60*1e3,jA=2;class bL{constructor(e,o,l){Eu(this,"authState",{state:"noAuth"}),Eu(this,"configVersion",0),Eu(this,"syncState"),Eu(this,"authenticate"),Eu(this,"stopSocket"),Eu(this,"tryRestartSocket"),Eu(this,"pauseSocket"),Eu(this,"resumeSocket"),Eu(this,"clearAuth"),Eu(this,"logger"),Eu(this,"refreshTokenLeewaySeconds"),Eu(this,"tokenConfirmationAttempts",0),this.syncState=e,this.authenticate=o.authenticate,this.stopSocket=o.stopSocket,this.tryRestartSocket=o.tryRestartSocket,this.pauseSocket=o.pauseSocket,this.resumeSocket=o.resumeSocket,this.clearAuth=o.clearAuth,this.logger=l.logger,this.refreshTokenLeewaySeconds=l.refreshTokenLeewaySeconds}async setConfig(e,o){this.resetAuthState(),this._logVerbose("pausing WS for auth token fetch"),this.pauseSocket();const l=await this.fetchTokenAndGuardAgainstRace(e,{forceRefreshToken:!1});l.isFromOutdatedConfig||(l.value?(this.setAuthState({state:"waitingForServerConfirmationOfCachedToken",config:{fetchToken:e,onAuthChange:o},hasRetried:!1}),this.authenticate(l.value)):(this.setAuthState({state:"initialRefetch",config:{fetchToken:e,onAuthChange:o}}),await this.refetchToken()),this._logVerbose("resuming WS after auth token fetch"),this.resumeSocket())}onTransition(e){if(this.syncState.isCurrentOrNewerAuthVersion(e.endVersion.identity)&&!(e.endVersion.identity<=e.startVersion.identity)){if(this.authState.state==="waitingForServerConfirmationOfCachedToken"){this._logVerbose("server confirmed auth token is valid"),this.refetchToken(),this.authState.config.onAuthChange(!0);return}this.authState.state==="waitingForServerConfirmationOfFreshToken"&&(this._logVerbose("server confirmed new auth token is valid"),this.scheduleTokenRefetch(this.authState.token),this.tokenConfirmationAttempts=0,this.authState.hadAuth||this.authState.config.onAuthChange(!0))}}onAuthError(e){if(e.authUpdateAttempted===!1&&(this.authState.state==="waitingForServerConfirmationOfFreshToken"||this.authState.state==="waitingForServerConfirmationOfCachedToken")){this._logVerbose("ignoring non-auth token expired error");return}const{baseVersion:o}=e;if(!this.syncState.isCurrentOrNewerAuthVersion(o+1)){this._logVerbose("ignoring auth error for previous auth attempt");return}this.tryToReauthenticate(e)}async tryToReauthenticate(e){if(this._logVerbose(`attempting to reauthenticate: ${e.error}`),this.authState.state==="noAuth"||this.authState.state==="waitingForServerConfirmationOfFreshToken"&&this.tokenConfirmationAttempts>=jA){this.logger.error(`Failed to authenticate: "${e.error}", check your server auth config`),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.authState.state!=="noAuth"&&this.setAndReportAuthFailed(this.authState.config.onAuthChange);return}this.authState.state==="waitingForServerConfirmationOfFreshToken"&&(this.tokenConfirmationAttempts++,this._logVerbose(`retrying reauthentication, ${jA-this.tokenConfirmationAttempts} attempts remaining`)),await this.stopSocket();const o=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});o.isFromOutdatedConfig||(o.value&&this.syncState.isNewAuth(o.value)?(this.authenticate(o.value),this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",config:this.authState.config,token:o.value,hadAuth:this.authState.state==="notRefetching"||this.authState.state==="waitingForScheduledRefetch"})):(this._logVerbose("reauthentication failed, could not fetch a new token"),this.syncState.hasAuth()&&this.syncState.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this.tryRestartSocket())}async refetchToken(){if(this.authState.state==="noAuth")return;this._logVerbose("refetching auth token");const e=await this.fetchTokenAndGuardAgainstRace(this.authState.config.fetchToken,{forceRefreshToken:!0});e.isFromOutdatedConfig||(e.value?this.syncState.isNewAuth(e.value)?(this.setAuthState({state:"waitingForServerConfirmationOfFreshToken",hadAuth:this.syncState.hasAuth(),token:e.value,config:this.authState.config}),this.authenticate(e.value)):this.setAuthState({state:"notRefetching",config:this.authState.config}):(this._logVerbose("refetching token failed"),this.syncState.hasAuth()&&this.clearAuth(),this.setAndReportAuthFailed(this.authState.config.onAuthChange)),this._logVerbose("restarting WS after auth token fetch (if currently stopped)"),this.tryRestartSocket())}scheduleTokenRefetch(e){if(this.authState.state==="noAuth")return;const o=this.decodeToken(e);if(!o){this.logger.error("Auth token is not a valid JWT, cannot refetch the token");return}const{iat:l,exp:h}=o;if(!l||!h){this.logger.error("Auth token does not have required fields, cannot refetch the token");return}const m=h-l;if(m<=2){this.logger.error("Auth token does not live long enough, cannot refetch the token");return}let b=Math.min(xL,(m-this.refreshTokenLeewaySeconds)*1e3);b<=0&&(this.logger.warn(`Refetching auth token immediately, configured leeway ${this.refreshTokenLeewaySeconds}s is larger than the token's lifetime ${m}s`),b=0);const n=setTimeout(()=>{this._logVerbose("running scheduled token refetch"),this.refetchToken()},b);this.setAuthState({state:"waitingForScheduledRefetch",refetchTokenTimeoutId:n,config:this.authState.config}),this._logVerbose(`scheduled preemptive auth token refetching in ${b}ms`)}async fetchTokenAndGuardAgainstRace(e,o){const l=++this.configVersion;this._logVerbose(`fetching token with config version ${l}`);const h=await e(o);return this.configVersion!==l?(this._logVerbose(`stale config version, expected ${l}, got ${this.configVersion}`),{isFromOutdatedConfig:!0}):{isFromOutdatedConfig:!1,value:h}}stop(){this.resetAuthState(),this.configVersion++,this._logVerbose(`config version bumped to ${this.configVersion}`)}setAndReportAuthFailed(e){e(!1),this.resetAuthState()}resetAuthState(){this.setAuthState({state:"noAuth"})}setAuthState(e){const o=e.state==="waitingForServerConfirmationOfFreshToken"?{hadAuth:e.hadAuth,state:e.state,token:`...${e.token.slice(-7)}`}:{state:e.state};switch(this._logVerbose(`setting auth state to ${JSON.stringify(o)}`),e.state){case"waitingForScheduledRefetch":case"notRefetching":case"noAuth":this.tokenConfirmationAttempts=0;break}this.authState.state==="waitingForScheduledRefetch"&&(clearTimeout(this.authState.refetchTokenTimeoutId),this.syncState.markAuthCompletion()),this.authState=e}decodeToken(e){try{return _L(e)}catch(o){return this._logVerbose(`Error decoding token: ${o instanceof Error?o.message:"Unknown error"}`),null}}_logVerbose(e){this.logger.logVerbose(`${e} [v${this.configVersion}]`)}}const wL=["convexClientConstructed","convexWebSocketOpen","convexFirstMessageReceived"];function SL(r,e){const o={sessionId:e};typeof performance>"u"||!performance.mark||performance.mark(r,{detail:o})}function TL(r){let e=r.name.slice(6);return e=e.charAt(0).toLowerCase()+e.slice(1),{name:e,startTime:r.startTime}}function AL(r){if(typeof performance>"u"||!performance.getEntriesByName)return[];const e=[];for(const o of wL){const l=performance.getEntriesByName(o).filter(h=>h.entryType==="mark").filter(h=>h.detail.sessionId===r);e.push(...l)}return e.map(TL)}var EL=Object.defineProperty,CL=(r,e,o)=>e in r?EL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,ga=(r,e,o)=>CL(r,typeof e!="symbol"?e+"":e,o);class IL{constructor(e,o,l){if(ga(this,"address"),ga(this,"state"),ga(this,"requestManager"),ga(this,"webSocketManager"),ga(this,"authenticationManager"),ga(this,"remoteQuerySet"),ga(this,"optimisticQueryResults"),ga(this,"_transitionHandlerCounter",0),ga(this,"_nextRequestId"),ga(this,"_onTransitionFns",new Map),ga(this,"_sessionId"),ga(this,"firstMessageReceived",!1),ga(this,"debug"),ga(this,"logger"),ga(this,"maxObservedTimestamp"),ga(this,"connectionStateSubscribers",new Map),ga(this,"nextConnectionStateSubscriberId",0),ga(this,"_lastPublishedConnectionState"),ga(this,"markConnectionStateDirty",()=>{Promise.resolve().then(()=>{const Z=this.connectionState();if(JSON.stringify(Z)!==JSON.stringify(this._lastPublishedConnectionState)){this._lastPublishedConnectionState=Z;for(const ie of this.connectionStateSubscribers.values())ie(Z)}})}),ga(this,"mark",Z=>{this.debug&&SL(Z,this.sessionId)}),typeof e=="object")throw new Error("Passing a ClientConfig object is no longer supported. Pass the URL of the Convex deployment as a string directly.");l?.skipConvexDeploymentUrlCheck!==!0&&x4(e),l={...l};const h=l.authRefreshTokenLeewaySeconds??2;let m=l.webSocketConstructor;if(!m&&typeof WebSocket>"u")throw new Error("No WebSocket global variable defined! To use Convex in an environment without WebSocket try the HTTP client: https://docs.convex.dev/api/classes/browser.ConvexHttpClient");m=m||WebSocket,this.debug=l.reportDebugInfoToConvex??!1,this.address=e,this.logger=l.logger===!1?O3({verbose:l.verbose??!1}):l.logger!==!0&&l.logger?l.logger:D3({verbose:l.verbose??!1});const b=e.search("://");if(b===-1)throw new Error("Provided address was not an absolute URL.");const n=e.substring(b+3),C=e.substring(0,b);let D;if(C==="http")D="ws";else if(C==="https")D="wss";else throw new Error(`Unknown parent protocol ${C}`);const L=`${D}://${n}/api/${zA}/sync`;this.state=new k4,this.remoteQuerySet=new VA(Z=>this.state.queryPath(Z),this.logger),this.requestManager=new U4(this.logger,this.markConnectionStateDirty);const U=()=>{this.webSocketManager.pause(),this.state.pause()};this.authenticationManager=new bL(this.state,{authenticate:Z=>{const ie=this.state.setAuth(Z);return this.webSocketManager.sendMessage(ie),ie.baseVersion},stopSocket:()=>this.webSocketManager.stop(),tryRestartSocket:()=>this.webSocketManager.tryRestart(),pauseSocket:U,resumeSocket:()=>this.webSocketManager.resume(),clearAuth:()=>{this.clearAuth()}},{logger:this.logger,refreshTokenLeewaySeconds:h}),this.optimisticQueryResults=new W4,this.addOnTransitionHandler(Z=>{o(Z.queries.map(ie=>ie.token))}),this._nextRequestId=0,this._sessionId=dL();const{unsavedChangesWarning:q}=l;if(typeof window>"u"||typeof window.addEventListener>"u"){if(q===!0)throw new Error("unsavedChangesWarning requested, but window.addEventListener not found! Remove {unsavedChangesWarning: true} from Convex client options.")}else q!==!1&&window.addEventListener("beforeunload",Z=>{if(this.requestManager.hasIncompleteRequests()){Z.preventDefault();const ie="Are you sure you want to leave? Your changes may not be saved.";return(Z||window.event).returnValue=ie,ie}});this.webSocketManager=new fL(L,{onOpen:Z=>{this.mark("convexWebSocketOpen"),this.webSocketManager.sendMessage({...Z,type:"Connect",sessionId:this._sessionId,maxObservedTimestamp:this.maxObservedTimestamp});const ie=new Set(this.remoteQuerySet.remoteQueryResults().keys());this.remoteQuerySet=new VA(ve=>this.state.queryPath(ve),this.logger);const[ne,be]=this.state.restart(ie);be&&this.webSocketManager.sendMessage(be),this.webSocketManager.sendMessage(ne);for(const ve of this.requestManager.restart())this.webSocketManager.sendMessage(ve)},onResume:()=>{const[Z,ie]=this.state.resume();ie&&this.webSocketManager.sendMessage(ie),Z&&this.webSocketManager.sendMessage(Z);for(const ne of this.requestManager.resume())this.webSocketManager.sendMessage(ne)},onMessage:Z=>{switch(this.firstMessageReceived||(this.firstMessageReceived=!0,this.mark("convexFirstMessageReceived"),this.reportMarks()),Z.type){case"Transition":{this.observedTimestamp(Z.endVersion.ts),this.authenticationManager.onTransition(Z),this.remoteQuerySet.transition(Z),this.state.transition(Z);const ie=this.requestManager.removeCompleted(this.remoteQuerySet.timestamp());this.notifyOnQueryResultChanges(ie);break}case"MutationResponse":{Z.success&&this.observedTimestamp(Z.ts);const ie=this.requestManager.onResponse(Z);ie!==null&&this.notifyOnQueryResultChanges(new Map([[ie.requestId,ie.result]]));break}case"ActionResponse":{this.requestManager.onResponse(Z);break}case"AuthError":{this.authenticationManager.onAuthError(Z);break}case"FatalError":{const ie=B4(this.logger,Z.error);throw this.webSocketManager.terminate(),ie}}return{hasSyncedPastLastReconnect:this.hasSyncedPastLastReconnect()}},onServerDisconnectError:l.onServerDisconnectError},m,this.logger,this.markConnectionStateDirty,this.debug),this.mark("convexClientConstructed"),l.expectAuth&&U()}hasSyncedPastLastReconnect(){return this.requestManager.hasSyncedPastLastReconnect()||this.state.hasSyncedPastLastReconnect()}observedTimestamp(e){(this.maxObservedTimestamp===void 0||this.maxObservedTimestamp.lessThanOrEqual(e))&&(this.maxObservedTimestamp=e)}getMaxObservedTimestamp(){return this.maxObservedTimestamp}notifyOnQueryResultChanges(e){const o=this.remoteQuerySet.remoteQueryResults(),l=new Map;for(const[m,b]of o){const n=this.state.queryToken(m);if(n!==null){const C={result:b,udfPath:this.state.queryPath(m),args:this.state.queryArgs(m)};l.set(n,C)}}const h=this.optimisticQueryResults.ingestQueryResultsFromServer(l,new Set(e.keys()));this.handleTransition({queries:h.map(m=>{const b=this.optimisticQueryResults.rawQueryResult(m);return{token:m,modification:{kind:"Updated",result:b.result}}}),reflectedMutations:Array.from(e).map(([m,b])=>({requestId:m,result:b})),timestamp:this.remoteQuerySet.timestamp()})}handleTransition(e){for(const o of this._onTransitionFns.values())o(e)}addOnTransitionHandler(e){const o=this._transitionHandlerCounter++;return this._onTransitionFns.set(o,e),()=>this._onTransitionFns.delete(o)}setAuth(e,o){this.authenticationManager.setConfig(e,o)}hasAuth(){return this.state.hasAuth()}setAdminAuth(e,o){const l=this.state.setAdminAuth(e,o);this.webSocketManager.sendMessage(l)}clearAuth(){const e=this.state.clearAuth();this.webSocketManager.sendMessage(e)}subscribe(e,o,l){const h=om(o),{modification:m,queryToken:b,unsubscribe:n}=this.state.subscribe(e,h,l?.journal,l?.componentPath);return m!==null&&this.webSocketManager.sendMessage(m),{queryToken:b,unsubscribe:()=>{const C=n();C&&this.webSocketManager.sendMessage(C)}}}localQueryResult(e,o){const l=om(o),h=vg(e,l);return this.optimisticQueryResults.queryResult(h)}localQueryResultByToken(e){return this.optimisticQueryResults.queryResult(e)}hasLocalQueryResultByToken(e){return this.optimisticQueryResults.hasQueryResult(e)}localQueryLogs(e,o){const l=om(o),h=vg(e,l);return this.optimisticQueryResults.queryLogs(h)}queryJournal(e,o){const l=om(o),h=vg(e,l);return this.state.queryJournal(h)}connectionState(){const e=this.webSocketManager.connectionState();return{hasInflightRequests:this.requestManager.hasInflightRequests(),isWebSocketConnected:e.isConnected,hasEverConnected:e.hasEverConnected,connectionCount:e.connectionCount,connectionRetries:e.connectionRetries,timeOfOldestInflightRequest:this.requestManager.timeOfOldestInflightRequest(),inflightMutations:this.requestManager.inflightMutations(),inflightActions:this.requestManager.inflightActions()}}subscribeToConnectionState(e){const o=this.nextConnectionStateSubscriberId++;return this.connectionStateSubscribers.set(o,e),()=>{this.connectionStateSubscribers.delete(o)}}async mutation(e,o,l){const h=await this.mutationInternal(e,o,l);if(!h.success)throw h.errorData!==void 0?Hb(h,new Gb(R_("mutation",e,h))):new Error(R_("mutation",e,h));return h.value}async mutationInternal(e,o,l,h){const{mutationPromise:m}=this.enqueueMutation(e,o,l,h);return m}enqueueMutation(e,o,l,h){const m=om(o);this.tryReportLongDisconnect();const b=this.nextRequestId;if(this._nextRequestId++,l!==void 0){const L=l.optimisticUpdate;if(L!==void 0){const U=ie=>{L(ie,m)instanceof Promise&&this.logger.warn("Optimistic update handler returned a Promise. Optimistic updates should be synchronous.")},Z=this.optimisticQueryResults.applyOptimisticUpdate(U,b).map(ie=>{const ne=this.localQueryResultByToken(ie);return{token:ie,modification:{kind:"Updated",result:ne===void 0?void 0:{success:!0,value:ne,logLines:[]}}}});this.handleTransition({queries:Z,reflectedMutations:[],timestamp:this.remoteQuerySet.timestamp()})}}const n={type:"Mutation",requestId:b,udfPath:e,componentPath:h,args:[_y(m)]},C=this.webSocketManager.sendMessage(n),D=this.requestManager.request(n,C);return{requestId:b,mutationPromise:D}}async action(e,o){const l=await this.actionInternal(e,o);if(!l.success)throw l.errorData!==void 0?Hb(l,new Gb(R_("action",e,l))):new Error(R_("action",e,l));return l.value}async actionInternal(e,o,l){const h=om(o),m=this.nextRequestId;this._nextRequestId++,this.tryReportLongDisconnect();const b={type:"Action",requestId:m,udfPath:e,componentPath:l,args:[_y(h)]},n=this.webSocketManager.sendMessage(b);return this.requestManager.request(b,n)}async close(){return this.authenticationManager.stop(),this.webSocketManager.terminate()}get url(){return this.address}get nextRequestId(){return this._nextRequestId}get sessionId(){return this._sessionId}reportMarks(){if(this.debug){const e=AL(this.sessionId);this.webSocketManager.sendMessage({type:"Event",eventType:"ClientConnect",event:e})}}tryReportLongDisconnect(){if(!this.debug)return;const e=this.connectionState().timeOfOldestInflightRequest;if(e===null||Date.now()-e.getTime()<=60*1e3)return;const o=`${this.address}/api/debug_event`;fetch(o,{method:"POST",headers:{"Content-Type":"application/json","Convex-Client":`npm-${zA}`},body:JSON.stringify({event:"LongWebsocketDisconnect"})}).then(l=>{l.ok||this.logger.warn("Analytics request failed with response:",l.body)}).catch(l=>{this.logger.warn("Analytics response failed with error:",l)})}}var RL=Object.defineProperty,ML=(r,e,o)=>e in r?RL(r,e,{enumerable:!0,configurable:!0,writable:!0,value:o}):r[e]=o,tm=(r,e,o)=>ML(r,typeof e!="symbol"?e+"":e,o);const DL=5e3;if(typeof sm>"u")throw new Error("Required dependency 'react' not found");class OL{constructor(e,o){if(tm(this,"address"),tm(this,"cachedSync"),tm(this,"listeners"),tm(this,"options"),tm(this,"closed",!1),tm(this,"_logger"),tm(this,"adminAuth"),tm(this,"fakeUserIdentity"),e===void 0)throw new Error("No address provided to ConvexReactClient.\nIf trying to deploy to production, make sure to follow all the instructions found at https://docs.convex.dev/production/hosting/\nIf running locally, make sure to run `convex dev` and ensure the .env.local file is populated.");if(typeof e!="string")throw new Error(`ConvexReactClient requires a URL like 'https://happy-otter-123.convex.cloud', received something of type ${typeof e} instead.`);if(!e.includes("://"))throw new Error("Provided address was not an absolute URL.");this.address=e,this.listeners=new Map,this._logger=o?.logger===!1?O3({verbose:o?.verbose??!1}):o?.logger!==!0&&o?.logger?o.logger:D3({verbose:o?.verbose??!1}),this.options={...o,logger:this._logger}}get url(){return this.address}get sync(){if(this.closed)throw new Error("ConvexReactClient has already been closed.");return this.cachedSync?this.cachedSync:(this.cachedSync=new IL(this.address,e=>this.transition(e),this.options),this.adminAuth&&this.cachedSync.setAdminAuth(this.adminAuth,this.fakeUserIdentity),this.cachedSync)}setAuth(e,o){if(typeof e=="string")throw new Error("Passing a string to ConvexReactClient.setAuth is no longer supported, please upgrade to passing in an async function to handle reauthentication.");this.sync.setAuth(e,o??(()=>{}))}clearAuth(){this.sync.clearAuth()}setAdminAuth(e,o){if(this.adminAuth=e,this.fakeUserIdentity=o,this.closed)throw new Error("ConvexReactClient has already been closed.");this.cachedSync&&this.sync.setAdminAuth(e,o)}watchQuery(e,...o){const[l,h]=o,m=N_(e);return{onUpdate:b=>{const{queryToken:n,unsubscribe:C}=this.sync.subscribe(m,l,h),D=this.listeners.get(n);return D!==void 0?D.add(b):this.listeners.set(n,new Set([b])),()=>{if(this.closed)return;const L=this.listeners.get(n);L.delete(b),L.size===0&&this.listeners.delete(n),C()}},localQueryResult:()=>{if(this.cachedSync)return this.cachedSync.localQueryResult(m,l)},localQueryLogs:()=>{if(this.cachedSync)return this.cachedSync.localQueryLogs(m,l)},journal:()=>{if(this.cachedSync)return this.cachedSync.queryJournal(m,l)}}}prewarmQuery(e){const o=e.extendSubscriptionFor??DL,h=this.watchQuery(e.query,e.args||{}).onUpdate(()=>{});setTimeout(h,o)}mutation(e,...o){const[l,h]=o,m=N_(e);return this.sync.mutation(m,l,h)}action(e,...o){const l=N_(e);return this.sync.action(l,...o)}query(e,...o){const l=this.watchQuery(e,...o),h=l.localQueryResult();return h!==void 0?Promise.resolve(h):new Promise((m,b)=>{const n=l.onUpdate(()=>{n();try{m(l.localQueryResult())}catch(C){b(C)}})})}connectionState(){return this.sync.connectionState()}subscribeToConnectionState(e){return this.sync.subscribeToConnectionState(e)}get logger(){return this._logger}async close(){if(this.closed=!0,this.listeners=new Map,this.cachedSync){const e=this.cachedSync;this.cachedSync=void 0,await e.close()}}transition(e){for(const o of e){const l=this.listeners.get(o);if(l)for(const h of l)h()}}}const PL=sm.createContext(void 0),LL=({client:r,children:e})=>sm.createElement(PL.Provider,{value:r},e);var Z_=class{constructor(){this.listeners=new Set,this.subscribe=this.subscribe.bind(this)}subscribe(r){return this.listeners.add(r),this.onSubscribe(),()=>{this.listeners.delete(r),this.onUnsubscribe()}}hasListeners(){return this.listeners.size>0}onSubscribe(){}onUnsubscribe(){}},BL={setTimeout:(r,e)=>setTimeout(r,e),clearTimeout:r=>clearTimeout(r),setInterval:(r,e)=>setInterval(r,e),clearInterval:r=>clearInterval(r)},zL=class{#e=BL;#t=!1;setTimeoutProvider(r){this.#e=r}setTimeout(r,e){return this.#e.setTimeout(r,e)}clearTimeout(r){this.#e.clearTimeout(r)}setInterval(r,e){return this.#e.setInterval(r,e)}clearInterval(r){this.#e.clearInterval(r)}},mg=new zL;function FL(r){setTimeout(r,0)}var Sg=typeof window>"u"||"Deno"in globalThis;function pl(){}function kL(r,e){return typeof r=="function"?r(e):r}function qb(r){return typeof r=="number"&&r>=0&&r!==1/0}function B3(r,e){return Math.max(r+(e||0)-Date.now(),0)}function lm(r,e){return typeof r=="function"?r(e):r}function Du(r,e){return typeof r=="function"?r(e):r}function GA(r,e){const{type:o="all",exact:l,fetchStatus:h,predicate:m,queryKey:b,stale:n}=r;if(b){if(l){if(e.queryHash!==jw(b,e.options))return!1}else if(!vy(e.queryKey,b))return!1}if(o!=="all"){const C=e.isActive();if(o==="active"&&!C||o==="inactive"&&C)return!1}return!(typeof n=="boolean"&&e.isStale()!==n||h&&h!==e.state.fetchStatus||m&&!m(e))}function HA(r,e){const{exact:o,status:l,predicate:h,mutationKey:m}=r;if(m){if(!e.options.mutationKey)return!1;if(o){if(Tg(e.options.mutationKey)!==Tg(m))return!1}else if(!vy(e.options.mutationKey,m))return!1}return!(l&&e.state.status!==l||h&&!h(e))}function jw(r,e){return(e?.queryKeyHashFn||Tg)(r)}function Tg(r){return JSON.stringify(r,(e,o)=>$b(o)?Object.keys(o).sort().reduce((l,h)=>(l[h]=o[h],l),{}):o)}function vy(r,e){return r===e?!0:typeof r!=typeof e?!1:r&&e&&typeof r=="object"&&typeof e=="object"?Object.keys(e).every(o=>vy(r[o],e[o])):!1}var NL=Object.prototype.hasOwnProperty;function z3(r,e){if(r===e)return r;const o=qA(r)&&qA(e);if(!o&&!($b(r)&&$b(e)))return e;const h=(o?r:Object.keys(r)).length,m=o?e:Object.keys(e),b=m.length,n=o?new Array(b):{};let C=0;for(let D=0;D<b;D++){const L=o?D:m[D],U=r[L],q=e[L];if(U===q){n[L]=U,(o?D<h:NL.call(r,L))&&C++;continue}if(U===null||q===null||typeof U!="object"||typeof q!="object"){n[L]=q;continue}const Z=z3(U,q);n[L]=Z,Z===U&&C++}return h===b&&C===h?r:n}function Iv(r,e){if(!e||Object.keys(r).length!==Object.keys(e).length)return!1;for(const o in r)if(r[o]!==e[o])return!1;return!0}function qA(r){return Array.isArray(r)&&r.length===Object.keys(r).length}function $b(r){if(!$A(r))return!1;const e=r.constructor;if(e===void 0)return!0;const o=e.prototype;return!(!$A(o)||!o.hasOwnProperty("isPrototypeOf")||Object.getPrototypeOf(r)!==Object.prototype)}function $A(r){return Object.prototype.toString.call(r)==="[object Object]"}function VL(r){return new Promise(e=>{mg.setTimeout(e,r)})}function Xb(r,e,o){return typeof o.structuralSharing=="function"?o.structuralSharing(r,e):o.structuralSharing!==!1?z3(r,e):e}function UL(r,e,o=0){const l=[...r,e];return o&&l.length>o?l.slice(1):l}function jL(r,e,o=0){const l=[e,...r];return o&&l.length>o?l.slice(0,-1):l}var Gw=Symbol();function F3(r,e){return!r.queryFn&&e?.initialPromise?()=>e.initialPromise:!r.queryFn||r.queryFn===Gw?()=>Promise.reject(new Error(`Missing queryFn: '${r.queryHash}'`)):r.queryFn}function k3(r,e){return typeof r=="function"?r(...e):!!r}var GL=class extends Z_{#e;#t;#r;constructor(){super(),this.#r=r=>{if(!Sg&&window.addEventListener){const e=()=>r();return window.addEventListener("visibilitychange",e,!1),()=>{window.removeEventListener("visibilitychange",e)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#r=r,this.#t?.(),this.#t=r(e=>{typeof e=="boolean"?this.setFocused(e):this.onFocus()})}setFocused(r){this.#e!==r&&(this.#e=r,this.onFocus())}onFocus(){const r=this.isFocused();this.listeners.forEach(e=>{e(r)})}isFocused(){return typeof this.#e=="boolean"?this.#e:globalThis.document?.visibilityState!=="hidden"}},Hw=new GL;function Zb(){let r,e;const o=new Promise((h,m)=>{r=h,e=m});o.status="pending",o.catch(()=>{});function l(h){Object.assign(o,h),delete o.resolve,delete o.reject}return o.resolve=h=>{l({status:"fulfilled",value:h}),r(h)},o.reject=h=>{l({status:"rejected",reason:h}),e(h)},o}var HL=FL;function qL(){let r=[],e=0,o=n=>{n()},l=n=>{n()},h=HL;const m=n=>{e?r.push(n):h(()=>{o(n)})},b=()=>{const n=r;r=[],n.length&&h(()=>{l(()=>{n.forEach(C=>{o(C)})})})};return{batch:n=>{let C;e++;try{C=n()}finally{e--,e||b()}return C},batchCalls:n=>(...C)=>{m(()=>{n(...C)})},schedule:m,setNotifyFunction:n=>{o=n},setBatchNotifyFunction:n=>{l=n},setScheduler:n=>{h=n}}}var za=qL(),$L=class extends Z_{#e=!0;#t;#r;constructor(){super(),this.#r=r=>{if(!Sg&&window.addEventListener){const e=()=>r(!0),o=()=>r(!1);return window.addEventListener("online",e,!1),window.addEventListener("offline",o,!1),()=>{window.removeEventListener("online",e),window.removeEventListener("offline",o)}}}}onSubscribe(){this.#t||this.setEventListener(this.#r)}onUnsubscribe(){this.hasListeners()||(this.#t?.(),this.#t=void 0)}setEventListener(r){this.#r=r,this.#t?.(),this.#t=r(this.setOnline.bind(this))}setOnline(r){this.#e!==r&&(this.#e=r,this.listeners.forEach(o=>{o(r)}))}isOnline(){return this.#e}},Rv=new $L;function XL(r){return Math.min(1e3*2**r,3e4)}function N3(r){return(r??"online")==="online"?Rv.isOnline():!0}var Wb=class extends Error{constructor(r){super("CancelledError"),this.revert=r?.revert,this.silent=r?.silent}};function V3(r){let e=!1,o=0,l;const h=Zb(),m=()=>h.status!=="pending",b=ne=>{if(!m()){const be=new Wb(ne);q(be),r.onCancel?.(be)}},n=()=>{e=!0},C=()=>{e=!1},D=()=>Hw.isFocused()&&(r.networkMode==="always"||Rv.isOnline())&&r.canRun(),L=()=>N3(r.networkMode)&&r.canRun(),U=ne=>{m()||(l?.(),h.resolve(ne))},q=ne=>{m()||(l?.(),h.reject(ne))},Z=()=>new Promise(ne=>{l=be=>{(m()||D())&&ne(be)},r.onPause?.()}).then(()=>{l=void 0,m()||r.onContinue?.()}),ie=()=>{if(m())return;let ne;const be=o===0?r.initialPromise:void 0;try{ne=be??r.fn()}catch(ve){ne=Promise.reject(ve)}Promise.resolve(ne).then(U).catch(ve=>{if(m())return;const we=r.retry??(Sg?0:3),Pe=r.retryDelay??XL,Ze=typeof Pe=="function"?Pe(o,ve):Pe,$e=we===!0||typeof we=="number"&&o<we||typeof we=="function"&&we(o,ve);if(e||!$e){q(ve);return}o++,r.onFail?.(o,ve),VL(Ze).then(()=>D()?void 0:Z()).then(()=>{e?q(ve):ie()})})};return{promise:h,status:()=>h.status,cancel:b,continue:()=>(l?.(),h),cancelRetry:n,continueRetry:C,canStart:L,start:()=>(L()?ie():Z().then(ie),h)}}var U3=class{#e;destroy(){this.clearGcTimeout()}scheduleGc(){this.clearGcTimeout(),qb(this.gcTime)&&(this.#e=mg.setTimeout(()=>{this.optionalRemove()},this.gcTime))}updateGcTime(r){this.gcTime=Math.max(this.gcTime||0,r??(Sg?1/0:300*1e3))}clearGcTimeout(){this.#e&&(mg.clearTimeout(this.#e),this.#e=void 0)}},ZL=class extends U3{#e;#t;#r;#n;#i;#a;#s;constructor(r){super(),this.#s=!1,this.#a=r.defaultOptions,this.setOptions(r.options),this.observers=[],this.#n=r.client,this.#r=this.#n.getQueryCache(),this.queryKey=r.queryKey,this.queryHash=r.queryHash,this.#e=XA(this.options),this.state=r.state??this.#e,this.scheduleGc()}get meta(){return this.options.meta}get promise(){return this.#i?.promise}setOptions(r){if(this.options={...this.#a,...r},this.updateGcTime(this.options.gcTime),this.state&&this.state.data===void 0){const e=XA(this.options);e.data!==void 0&&(this.setData(e.data,{updatedAt:e.dataUpdatedAt,manual:!0}),this.#e=e)}}optionalRemove(){!this.observers.length&&this.state.fetchStatus==="idle"&&this.#r.remove(this)}setData(r,e){const o=Xb(this.state.data,r,this.options);return this.#o({data:o,type:"success",dataUpdatedAt:e?.updatedAt,manual:e?.manual}),o}setState(r,e){this.#o({type:"setState",state:r,setStateOptions:e})}cancel(r){const e=this.#i?.promise;return this.#i?.cancel(r),e?e.then(pl).catch(pl):Promise.resolve()}destroy(){super.destroy(),this.cancel({silent:!0})}reset(){this.destroy(),this.setState(this.#e)}isActive(){return this.observers.some(r=>Du(r.options.enabled,this)!==!1)}isDisabled(){return this.getObserversCount()>0?!this.isActive():this.options.queryFn===Gw||this.state.dataUpdateCount+this.state.errorUpdateCount===0}isStatic(){return this.getObserversCount()>0?this.observers.some(r=>lm(r.options.staleTime,this)==="static"):!1}isStale(){return this.getObserversCount()>0?this.observers.some(r=>r.getCurrentResult().isStale):this.state.data===void 0||this.state.isInvalidated}isStaleByTime(r=0){return this.state.data===void 0?!0:r==="static"?!1:this.state.isInvalidated?!0:!B3(this.state.dataUpdatedAt,r)}onFocus(){this.observers.find(e=>e.shouldFetchOnWindowFocus())?.refetch({cancelRefetch:!1}),this.#i?.continue()}onOnline(){this.observers.find(e=>e.shouldFetchOnReconnect())?.refetch({cancelRefetch:!1}),this.#i?.continue()}addObserver(r){this.observers.includes(r)||(this.observers.push(r),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",query:this,observer:r}))}removeObserver(r){this.observers.includes(r)&&(this.observers=this.observers.filter(e=>e!==r),this.observers.length||(this.#i&&(this.#s?this.#i.cancel({revert:!0}):this.#i.cancelRetry()),this.scheduleGc()),this.#r.notify({type:"observerRemoved",query:this,observer:r}))}getObserversCount(){return this.observers.length}invalidate(){this.state.isInvalidated||this.#o({type:"invalidate"})}async fetch(r,e){if(this.state.fetchStatus!=="idle"&&this.#i?.status()!=="rejected"){if(this.state.data!==void 0&&e?.cancelRefetch)this.cancel({silent:!0});else if(this.#i)return this.#i.continueRetry(),this.#i.promise}if(r&&this.setOptions(r),!this.options.queryFn){const n=this.observers.find(C=>C.options.queryFn);n&&this.setOptions(n.options)}const o=new AbortController,l=n=>{Object.defineProperty(n,"signal",{enumerable:!0,get:()=>(this.#s=!0,o.signal)})},h=()=>{const n=F3(this.options,e),D=(()=>{const L={client:this.#n,queryKey:this.queryKey,meta:this.meta};return l(L),L})();return this.#s=!1,this.options.persister?this.options.persister(n,D,this):n(D)},b=(()=>{const n={fetchOptions:e,options:this.options,queryKey:this.queryKey,client:this.#n,state:this.state,fetchFn:h};return l(n),n})();this.options.behavior?.onFetch(b,this),this.#t=this.state,(this.state.fetchStatus==="idle"||this.state.fetchMeta!==b.fetchOptions?.meta)&&this.#o({type:"fetch",meta:b.fetchOptions?.meta}),this.#i=V3({initialPromise:e?.initialPromise,fn:b.fetchFn,onCancel:n=>{n instanceof Wb&&n.revert&&this.setState({...this.#t,fetchStatus:"idle"}),o.abort()},onFail:(n,C)=>{this.#o({type:"failed",failureCount:n,error:C})},onPause:()=>{this.#o({type:"pause"})},onContinue:()=>{this.#o({type:"continue"})},retry:b.options.retry,retryDelay:b.options.retryDelay,networkMode:b.options.networkMode,canRun:()=>!0});try{const n=await this.#i.start();if(n===void 0)throw new Error(`${this.queryHash} data is undefined`);return this.setData(n),this.#r.config.onSuccess?.(n,this),this.#r.config.onSettled?.(n,this.state.error,this),n}catch(n){if(n instanceof Wb){if(n.silent)return this.#i.promise;if(n.revert){if(this.state.data===void 0)throw n;return this.state.data}}throw this.#o({type:"error",error:n}),this.#r.config.onError?.(n,this),this.#r.config.onSettled?.(this.state.data,n,this),n}finally{this.scheduleGc()}}#o(r){const e=o=>{switch(r.type){case"failed":return{...o,fetchFailureCount:r.failureCount,fetchFailureReason:r.error};case"pause":return{...o,fetchStatus:"paused"};case"continue":return{...o,fetchStatus:"fetching"};case"fetch":return{...o,...j3(o.data,this.options),fetchMeta:r.meta??null};case"success":const l={...o,data:r.data,dataUpdateCount:o.dataUpdateCount+1,dataUpdatedAt:r.dataUpdatedAt??Date.now(),error:null,isInvalidated:!1,status:"success",...!r.manual&&{fetchStatus:"idle",fetchFailureCount:0,fetchFailureReason:null}};return this.#t=r.manual?l:void 0,l;case"error":const h=r.error;return{...o,error:h,errorUpdateCount:o.errorUpdateCount+1,errorUpdatedAt:Date.now(),fetchFailureCount:o.fetchFailureCount+1,fetchFailureReason:h,fetchStatus:"idle",status:"error"};case"invalidate":return{...o,isInvalidated:!0};case"setState":return{...o,...r.state}}};this.state=e(this.state),za.batch(()=>{this.observers.forEach(o=>{o.onQueryUpdate()}),this.#r.notify({query:this,type:"updated",action:r})})}};function j3(r,e){return{fetchFailureCount:0,fetchFailureReason:null,fetchStatus:N3(e.networkMode)?"fetching":"paused",...r===void 0&&{error:null,status:"pending"}}}function XA(r){const e=typeof r.initialData=="function"?r.initialData():r.initialData,o=e!==void 0,l=o?typeof r.initialDataUpdatedAt=="function"?r.initialDataUpdatedAt():r.initialDataUpdatedAt:0;return{data:e,dataUpdateCount:0,dataUpdatedAt:o?l??Date.now():0,error:null,errorUpdateCount:0,errorUpdatedAt:0,fetchFailureCount:0,fetchFailureReason:null,fetchMeta:null,isInvalidated:!1,status:o?"success":"pending",fetchStatus:"idle"}}var WL=class extends Z_{constructor(r,e){super(),this.options=e,this.#e=r,this.#o=null,this.#s=Zb(),this.bindMethods(),this.setOptions(e)}#e;#t=void 0;#r=void 0;#n=void 0;#i;#a;#s;#o;#m;#f;#d;#c;#u;#l;#p=new Set;bindMethods(){this.refetch=this.refetch.bind(this)}onSubscribe(){this.listeners.size===1&&(this.#t.addObserver(this),ZA(this.#t,this.options)?this.#h():this.updateResult(),this.#v())}onUnsubscribe(){this.hasListeners()||this.destroy()}shouldFetchOnReconnect(){return Yb(this.#t,this.options,this.options.refetchOnReconnect)}shouldFetchOnWindowFocus(){return Yb(this.#t,this.options,this.options.refetchOnWindowFocus)}destroy(){this.listeners=new Set,this.#x(),this.#b(),this.#t.removeObserver(this)}setOptions(r){const e=this.options,o=this.#t;if(this.options=this.#e.defaultQueryOptions(r),this.options.enabled!==void 0&&typeof this.options.enabled!="boolean"&&typeof this.options.enabled!="function"&&typeof Du(this.options.enabled,this.#t)!="boolean")throw new Error("Expected enabled to be a boolean or a callback that returns a boolean");this.#w(),this.#t.setOptions(this.options),e._defaulted&&!Iv(this.options,e)&&this.#e.getQueryCache().notify({type:"observerOptionsUpdated",query:this.#t,observer:this});const l=this.hasListeners();l&&WA(this.#t,o,this.options,e)&&this.#h(),this.updateResult(),l&&(this.#t!==o||Du(this.options.enabled,this.#t)!==Du(e.enabled,this.#t)||lm(this.options.staleTime,this.#t)!==lm(e.staleTime,this.#t))&&this.#g();const h=this.#_();l&&(this.#t!==o||Du(this.options.enabled,this.#t)!==Du(e.enabled,this.#t)||h!==this.#l)&&this.#y(h)}getOptimisticResult(r){const e=this.#e.getQueryCache().build(this.#e,r),o=this.createResult(e,r);return QL(this,o)&&(this.#n=o,this.#a=this.options,this.#i=this.#t.state),o}getCurrentResult(){return this.#n}trackResult(r,e){return new Proxy(r,{get:(o,l)=>(this.trackProp(l),e?.(l),l==="promise"&&!this.options.experimental_prefetchInRender&&this.#s.status==="pending"&&this.#s.reject(new Error("experimental_prefetchInRender feature flag is not enabled")),Reflect.get(o,l))})}trackProp(r){this.#p.add(r)}getCurrentQuery(){return this.#t}refetch({...r}={}){return this.fetch({...r})}fetchOptimistic(r){const e=this.#e.defaultQueryOptions(r),o=this.#e.getQueryCache().build(this.#e,e);return o.fetch().then(()=>this.createResult(o,e))}fetch(r){return this.#h({...r,cancelRefetch:r.cancelRefetch??!0}).then(()=>(this.updateResult(),this.#n))}#h(r){this.#w();let e=this.#t.fetch(this.options,r);return r?.throwOnError||(e=e.catch(pl)),e}#g(){this.#x();const r=lm(this.options.staleTime,this.#t);if(Sg||this.#n.isStale||!qb(r))return;const o=B3(this.#n.dataUpdatedAt,r)+1;this.#c=mg.setTimeout(()=>{this.#n.isStale||this.updateResult()},o)}#_(){return(typeof this.options.refetchInterval=="function"?this.options.refetchInterval(this.#t):this.options.refetchInterval)??!1}#y(r){this.#b(),this.#l=r,!(Sg||Du(this.options.enabled,this.#t)===!1||!qb(this.#l)||this.#l===0)&&(this.#u=mg.setInterval(()=>{(this.options.refetchIntervalInBackground||Hw.isFocused())&&this.#h()},this.#l))}#v(){this.#g(),this.#y(this.#_())}#x(){this.#c&&(mg.clearTimeout(this.#c),this.#c=void 0)}#b(){this.#u&&(mg.clearInterval(this.#u),this.#u=void 0)}createResult(r,e){const o=this.#t,l=this.options,h=this.#n,m=this.#i,b=this.#a,C=r!==o?r.state:this.#r,{state:D}=r;let L={...D},U=!1,q;if(e._optimisticResults){const Ft=this.hasListeners(),Yt=!Ft&&ZA(r,e),hr=Ft&&WA(r,o,e,l);(Yt||hr)&&(L={...L,...j3(D.data,r.options)}),e._optimisticResults==="isRestoring"&&(L.fetchStatus="idle")}let{error:Z,errorUpdatedAt:ie,status:ne}=L;q=L.data;let be=!1;if(e.placeholderData!==void 0&&q===void 0&&ne==="pending"){let Ft;h?.isPlaceholderData&&e.placeholderData===b?.placeholderData?(Ft=h.data,be=!0):Ft=typeof e.placeholderData=="function"?e.placeholderData(this.#d?.state.data,this.#d):e.placeholderData,Ft!==void 0&&(ne="success",q=Xb(h?.data,Ft,e),U=!0)}if(e.select&&q!==void 0&&!be)if(h&&q===m?.data&&e.select===this.#m)q=this.#f;else try{this.#m=e.select,q=e.select(q),q=Xb(h?.data,q,e),this.#f=q,this.#o=null}catch(Ft){this.#o=Ft}this.#o&&(Z=this.#o,q=this.#f,ie=Date.now(),ne="error");const ve=L.fetchStatus==="fetching",we=ne==="pending",Pe=ne==="error",Ze=we&&ve,$e=q!==void 0,Ct={status:ne,fetchStatus:L.fetchStatus,isPending:we,isSuccess:ne==="success",isError:Pe,isInitialLoading:Ze,isLoading:Ze,data:q,dataUpdatedAt:L.dataUpdatedAt,error:Z,errorUpdatedAt:ie,failureCount:L.fetchFailureCount,failureReason:L.fetchFailureReason,errorUpdateCount:L.errorUpdateCount,isFetched:L.dataUpdateCount>0||L.errorUpdateCount>0,isFetchedAfterMount:L.dataUpdateCount>C.dataUpdateCount||L.errorUpdateCount>C.errorUpdateCount,isFetching:ve,isRefetching:ve&&!we,isLoadingError:Pe&&!$e,isPaused:L.fetchStatus==="paused",isPlaceholderData:U,isRefetchError:Pe&&$e,isStale:qw(r,e),refetch:this.refetch,promise:this.#s,isEnabled:Du(e.enabled,r)!==!1};if(this.options.experimental_prefetchInRender){const Ft=pr=>{Ct.status==="error"?pr.reject(Ct.error):Ct.data!==void 0&&pr.resolve(Ct.data)},Yt=()=>{const pr=this.#s=Ct.promise=Zb();Ft(pr)},hr=this.#s;switch(hr.status){case"pending":r.queryHash===o.queryHash&&Ft(hr);break;case"fulfilled":(Ct.status==="error"||Ct.data!==hr.value)&&Yt();break;case"rejected":(Ct.status!=="error"||Ct.error!==hr.reason)&&Yt();break}}return Ct}updateResult(){const r=this.#n,e=this.createResult(this.#t,this.options);if(this.#i=this.#t.state,this.#a=this.options,this.#i.data!==void 0&&(this.#d=this.#t),Iv(e,r))return;this.#n=e;const o=()=>{if(!r)return!0;const{notifyOnChangeProps:l}=this.options,h=typeof l=="function"?l():l;if(h==="all"||!h&&!this.#p.size)return!0;const m=new Set(h??this.#p);return this.options.throwOnError&&m.add("error"),Object.keys(this.#n).some(b=>{const n=b;return this.#n[n]!==r[n]&&m.has(n)})};this.#S({listeners:o()})}#w(){const r=this.#e.getQueryCache().build(this.#e,this.options);if(r===this.#t)return;const e=this.#t;this.#t=r,this.#r=r.state,this.hasListeners()&&(e?.removeObserver(this),r.addObserver(this))}onQueryUpdate(){this.updateResult(),this.hasListeners()&&this.#v()}#S(r){za.batch(()=>{r.listeners&&this.listeners.forEach(e=>{e(this.#n)}),this.#e.getQueryCache().notify({query:this.#t,type:"observerResultsUpdated"})})}};function YL(r,e){return Du(e.enabled,r)!==!1&&r.state.data===void 0&&!(r.state.status==="error"&&e.retryOnMount===!1)}function ZA(r,e){return YL(r,e)||r.state.data!==void 0&&Yb(r,e,e.refetchOnMount)}function Yb(r,e,o){if(Du(e.enabled,r)!==!1&&lm(e.staleTime,r)!=="static"){const l=typeof o=="function"?o(r):o;return l==="always"||l!==!1&&qw(r,e)}return!1}function WA(r,e,o,l){return(r!==e||Du(l.enabled,r)===!1)&&(!o.suspense||r.state.status!=="error")&&qw(r,o)}function qw(r,e){return Du(e.enabled,r)!==!1&&r.isStaleByTime(lm(e.staleTime,r))}function QL(r,e){return!Iv(r.getCurrentResult(),e)}function YA(r){return{onFetch:(e,o)=>{const l=e.options,h=e.fetchOptions?.meta?.fetchMore?.direction,m=e.state.data?.pages||[],b=e.state.data?.pageParams||[];let n={pages:[],pageParams:[]},C=0;const D=async()=>{let L=!1;const U=ie=>{Object.defineProperty(ie,"signal",{enumerable:!0,get:()=>(e.signal.aborted?L=!0:e.signal.addEventListener("abort",()=>{L=!0}),e.signal)})},q=F3(e.options,e.fetchOptions),Z=async(ie,ne,be)=>{if(L)return Promise.reject();if(ne==null&&ie.pages.length)return Promise.resolve(ie);const we=(()=>{const xt={client:e.client,queryKey:e.queryKey,pageParam:ne,direction:be?"backward":"forward",meta:e.options.meta};return U(xt),xt})(),Pe=await q(we),{maxPages:Ze}=e.options,$e=be?jL:UL;return{pages:$e(ie.pages,Pe,Ze),pageParams:$e(ie.pageParams,ne,Ze)}};if(h&&m.length){const ie=h==="backward",ne=ie?KL:QA,be={pages:m,pageParams:b},ve=ne(l,be);n=await Z(be,ve,ie)}else{const ie=r??m.length;do{const ne=C===0?b[0]??l.initialPageParam:QA(l,n);if(C>0&&ne==null)break;n=await Z(n,ne),C++}while(C<ie)}return n};e.options.persister?e.fetchFn=()=>e.options.persister?.(D,{client:e.client,queryKey:e.queryKey,meta:e.options.meta,signal:e.signal},o):e.fetchFn=D}}}function QA(r,{pages:e,pageParams:o}){const l=e.length-1;return e.length>0?r.getNextPageParam(e[l],e,o[l],o):void 0}function KL(r,{pages:e,pageParams:o}){return e.length>0?r.getPreviousPageParam?.(e[0],e,o[0],o):void 0}var JL=class extends U3{#e;#t;#r;#n;constructor(r){super(),this.#e=r.client,this.mutationId=r.mutationId,this.#r=r.mutationCache,this.#t=[],this.state=r.state||G3(),this.setOptions(r.options),this.scheduleGc()}setOptions(r){this.options=r,this.updateGcTime(this.options.gcTime)}get meta(){return this.options.meta}addObserver(r){this.#t.includes(r)||(this.#t.push(r),this.clearGcTimeout(),this.#r.notify({type:"observerAdded",mutation:this,observer:r}))}removeObserver(r){this.#t=this.#t.filter(e=>e!==r),this.scheduleGc(),this.#r.notify({type:"observerRemoved",mutation:this,observer:r})}optionalRemove(){this.#t.length||(this.state.status==="pending"?this.scheduleGc():this.#r.remove(this))}continue(){return this.#n?.continue()??this.execute(this.state.variables)}async execute(r){const e=()=>{this.#i({type:"continue"})},o={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};this.#n=V3({fn:()=>this.options.mutationFn?this.options.mutationFn(r,o):Promise.reject(new Error("No mutationFn found")),onFail:(m,b)=>{this.#i({type:"failed",failureCount:m,error:b})},onPause:()=>{this.#i({type:"pause"})},onContinue:e,retry:this.options.retry??0,retryDelay:this.options.retryDelay,networkMode:this.options.networkMode,canRun:()=>this.#r.canRun(this)});const l=this.state.status==="pending",h=!this.#n.canStart();try{if(l)e();else{this.#i({type:"pending",variables:r,isPaused:h}),await this.#r.config.onMutate?.(r,this,o);const b=await this.options.onMutate?.(r,o);b!==this.state.context&&this.#i({type:"pending",context:b,variables:r,isPaused:h})}const m=await this.#n.start();return await this.#r.config.onSuccess?.(m,r,this.state.context,this,o),await this.options.onSuccess?.(m,r,this.state.context,o),await this.#r.config.onSettled?.(m,null,this.state.variables,this.state.context,this,o),await this.options.onSettled?.(m,null,r,this.state.context,o),this.#i({type:"success",data:m}),m}catch(m){try{throw await this.#r.config.onError?.(m,r,this.state.context,this,o),await this.options.onError?.(m,r,this.state.context,o),await this.#r.config.onSettled?.(void 0,m,this.state.variables,this.state.context,this,o),await this.options.onSettled?.(void 0,m,r,this.state.context,o),m}finally{this.#i({type:"error",error:m})}}finally{this.#r.runNext(this)}}#i(r){const e=o=>{switch(r.type){case"failed":return{...o,failureCount:r.failureCount,failureReason:r.error};case"pause":return{...o,isPaused:!0};case"continue":return{...o,isPaused:!1};case"pending":return{...o,context:r.context,data:void 0,failureCount:0,failureReason:null,error:null,isPaused:r.isPaused,status:"pending",variables:r.variables,submittedAt:Date.now()};case"success":return{...o,data:r.data,failureCount:0,failureReason:null,error:null,status:"success",isPaused:!1};case"error":return{...o,data:void 0,error:r.error,failureCount:o.failureCount+1,failureReason:r.error,isPaused:!1,status:"error"}}};this.state=e(this.state),za.batch(()=>{this.#t.forEach(o=>{o.onMutationUpdate(r)}),this.#r.notify({mutation:this,type:"updated",action:r})})}};function G3(){return{context:void 0,data:void 0,error:null,failureCount:0,failureReason:null,isPaused:!1,status:"idle",variables:void 0,submittedAt:0}}var e5=class extends Z_{constructor(r={}){super(),this.config=r,this.#e=new Set,this.#t=new Map,this.#r=0}#e;#t;#r;build(r,e,o){const l=new JL({client:r,mutationCache:this,mutationId:++this.#r,options:r.defaultMutationOptions(e),state:o});return this.add(l),l}add(r){this.#e.add(r);const e=K1(r);if(typeof e=="string"){const o=this.#t.get(e);o?o.push(r):this.#t.set(e,[r])}this.notify({type:"added",mutation:r})}remove(r){if(this.#e.delete(r)){const e=K1(r);if(typeof e=="string"){const o=this.#t.get(e);if(o)if(o.length>1){const l=o.indexOf(r);l!==-1&&o.splice(l,1)}else o[0]===r&&this.#t.delete(e)}}this.notify({type:"removed",mutation:r})}canRun(r){const e=K1(r);if(typeof e=="string"){const l=this.#t.get(e)?.find(h=>h.state.status==="pending");return!l||l===r}else return!0}runNext(r){const e=K1(r);return typeof e=="string"?this.#t.get(e)?.find(l=>l!==r&&l.state.isPaused)?.continue()??Promise.resolve():Promise.resolve()}clear(){za.batch(()=>{this.#e.forEach(r=>{this.notify({type:"removed",mutation:r})}),this.#e.clear(),this.#t.clear()})}getAll(){return Array.from(this.#e)}find(r){const e={exact:!0,...r};return this.getAll().find(o=>HA(e,o))}findAll(r={}){return this.getAll().filter(e=>HA(r,e))}notify(r){za.batch(()=>{this.listeners.forEach(e=>{e(r)})})}resumePausedMutations(){const r=this.getAll().filter(e=>e.state.isPaused);return za.batch(()=>Promise.all(r.map(e=>e.continue().catch(pl))))}};function K1(r){return r.options.scope?.id}var t5=class extends Z_{#e;#t=void 0;#r;#n;constructor(e,o){super(),this.#e=e,this.setOptions(o),this.bindMethods(),this.#i()}bindMethods(){this.mutate=this.mutate.bind(this),this.reset=this.reset.bind(this)}setOptions(e){const o=this.options;this.options=this.#e.defaultMutationOptions(e),Iv(this.options,o)||this.#e.getMutationCache().notify({type:"observerOptionsUpdated",mutation:this.#r,observer:this}),o?.mutationKey&&this.options.mutationKey&&Tg(o.mutationKey)!==Tg(this.options.mutationKey)?this.reset():this.#r?.state.status==="pending"&&this.#r.setOptions(this.options)}onUnsubscribe(){this.hasListeners()||this.#r?.removeObserver(this)}onMutationUpdate(e){this.#i(),this.#a(e)}getCurrentResult(){return this.#t}reset(){this.#r?.removeObserver(this),this.#r=void 0,this.#i(),this.#a()}mutate(e,o){return this.#n=o,this.#r?.removeObserver(this),this.#r=this.#e.getMutationCache().build(this.#e,this.options),this.#r.addObserver(this),this.#r.execute(e)}#i(){const e=this.#r?.state??G3();this.#t={...e,isPending:e.status==="pending",isSuccess:e.status==="success",isError:e.status==="error",isIdle:e.status==="idle",mutate:this.mutate,reset:this.reset}}#a(e){za.batch(()=>{if(this.#n&&this.hasListeners()){const o=this.#t.variables,l=this.#t.context,h={client:this.#e,meta:this.options.meta,mutationKey:this.options.mutationKey};e?.type==="success"?(this.#n.onSuccess?.(e.data,o,l,h),this.#n.onSettled?.(e.data,null,o,l,h)):e?.type==="error"&&(this.#n.onError?.(e.error,o,l,h),this.#n.onSettled?.(void 0,e.error,o,l,h))}this.listeners.forEach(o=>{o(this.#t)})})}},r5=class extends Z_{constructor(r={}){super(),this.config=r,this.#e=new Map}#e;build(r,e,o){const l=e.queryKey,h=e.queryHash??jw(l,e);let m=this.get(h);return m||(m=new ZL({client:r,queryKey:l,queryHash:h,options:r.defaultQueryOptions(e),state:o,defaultOptions:r.getQueryDefaults(l)}),this.add(m)),m}add(r){this.#e.has(r.queryHash)||(this.#e.set(r.queryHash,r),this.notify({type:"added",query:r}))}remove(r){const e=this.#e.get(r.queryHash);e&&(r.destroy(),e===r&&this.#e.delete(r.queryHash),this.notify({type:"removed",query:r}))}clear(){za.batch(()=>{this.getAll().forEach(r=>{this.remove(r)})})}get(r){return this.#e.get(r)}getAll(){return[...this.#e.values()]}find(r){const e={exact:!0,...r};return this.getAll().find(o=>GA(e,o))}findAll(r={}){const e=this.getAll();return Object.keys(r).length>0?e.filter(o=>GA(r,o)):e}notify(r){za.batch(()=>{this.listeners.forEach(e=>{e(r)})})}onFocus(){za.batch(()=>{this.getAll().forEach(r=>{r.onFocus()})})}onOnline(){za.batch(()=>{this.getAll().forEach(r=>{r.onOnline()})})}},i5=class{#e;#t;#r;#n;#i;#a;#s;#o;constructor(r={}){this.#e=r.queryCache||new r5,this.#t=r.mutationCache||new e5,this.#r=r.defaultOptions||{},this.#n=new Map,this.#i=new Map,this.#a=0}mount(){this.#a++,this.#a===1&&(this.#s=Hw.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onFocus())}),this.#o=Rv.subscribe(async r=>{r&&(await this.resumePausedMutations(),this.#e.onOnline())}))}unmount(){this.#a--,this.#a===0&&(this.#s?.(),this.#s=void 0,this.#o?.(),this.#o=void 0)}isFetching(r){return this.#e.findAll({...r,fetchStatus:"fetching"}).length}isMutating(r){return this.#t.findAll({...r,status:"pending"}).length}getQueryData(r){const e=this.defaultQueryOptions({queryKey:r});return this.#e.get(e.queryHash)?.state.data}ensureQueryData(r){const e=this.defaultQueryOptions(r),o=this.#e.build(this,e),l=o.state.data;return l===void 0?this.fetchQuery(r):(r.revalidateIfStale&&o.isStaleByTime(lm(e.staleTime,o))&&this.prefetchQuery(e),Promise.resolve(l))}getQueriesData(r){return this.#e.findAll(r).map(({queryKey:e,state:o})=>{const l=o.data;return[e,l]})}setQueryData(r,e,o){const l=this.defaultQueryOptions({queryKey:r}),m=this.#e.get(l.queryHash)?.state.data,b=kL(e,m);if(b!==void 0)return this.#e.build(this,l).setData(b,{...o,manual:!0})}setQueriesData(r,e,o){return za.batch(()=>this.#e.findAll(r).map(({queryKey:l})=>[l,this.setQueryData(l,e,o)]))}getQueryState(r){const e=this.defaultQueryOptions({queryKey:r});return this.#e.get(e.queryHash)?.state}removeQueries(r){const e=this.#e;za.batch(()=>{e.findAll(r).forEach(o=>{e.remove(o)})})}resetQueries(r,e){const o=this.#e;return za.batch(()=>(o.findAll(r).forEach(l=>{l.reset()}),this.refetchQueries({type:"active",...r},e)))}cancelQueries(r,e={}){const o={revert:!0,...e},l=za.batch(()=>this.#e.findAll(r).map(h=>h.cancel(o)));return Promise.all(l).then(pl).catch(pl)}invalidateQueries(r,e={}){return za.batch(()=>(this.#e.findAll(r).forEach(o=>{o.invalidate()}),r?.refetchType==="none"?Promise.resolve():this.refetchQueries({...r,type:r?.refetchType??r?.type??"active"},e)))}refetchQueries(r,e={}){const o={...e,cancelRefetch:e.cancelRefetch??!0},l=za.batch(()=>this.#e.findAll(r).filter(h=>!h.isDisabled()&&!h.isStatic()).map(h=>{let m=h.fetch(void 0,o);return o.throwOnError||(m=m.catch(pl)),h.state.fetchStatus==="paused"?Promise.resolve():m}));return Promise.all(l).then(pl)}fetchQuery(r){const e=this.defaultQueryOptions(r);e.retry===void 0&&(e.retry=!1);const o=this.#e.build(this,e);return o.isStaleByTime(lm(e.staleTime,o))?o.fetch(e):Promise.resolve(o.state.data)}prefetchQuery(r){return this.fetchQuery(r).then(pl).catch(pl)}fetchInfiniteQuery(r){return r.behavior=YA(r.pages),this.fetchQuery(r)}prefetchInfiniteQuery(r){return this.fetchInfiniteQuery(r).then(pl).catch(pl)}ensureInfiniteQueryData(r){return r.behavior=YA(r.pages),this.ensureQueryData(r)}resumePausedMutations(){return Rv.isOnline()?this.#t.resumePausedMutations():Promise.resolve()}getQueryCache(){return this.#e}getMutationCache(){return this.#t}getDefaultOptions(){return this.#r}setDefaultOptions(r){this.#r=r}setQueryDefaults(r,e){this.#n.set(Tg(r),{queryKey:r,defaultOptions:e})}getQueryDefaults(r){const e=[...this.#n.values()],o={};return e.forEach(l=>{vy(r,l.queryKey)&&Object.assign(o,l.defaultOptions)}),o}setMutationDefaults(r,e){this.#i.set(Tg(r),{mutationKey:r,defaultOptions:e})}getMutationDefaults(r){const e=[...this.#i.values()],o={};return e.forEach(l=>{vy(r,l.mutationKey)&&Object.assign(o,l.defaultOptions)}),o}defaultQueryOptions(r){if(r._defaulted)return r;const e={...this.#r.queries,...this.getQueryDefaults(r.queryKey),...r,_defaulted:!0};return e.queryHash||(e.queryHash=jw(e.queryKey,e)),e.refetchOnReconnect===void 0&&(e.refetchOnReconnect=e.networkMode!=="always"),e.throwOnError===void 0&&(e.throwOnError=!!e.suspense),!e.networkMode&&e.persister&&(e.networkMode="offlineFirst"),e.queryFn===Gw&&(e.enabled=!1),e}defaultMutationOptions(r){return r?._defaulted?r:{...this.#r.mutations,...r?.mutationKey&&this.getMutationDefaults(r.mutationKey),...r,_defaulted:!0}}clear(){this.#e.clear(),this.#t.clear()}},H3=Xe.createContext(void 0),$w=r=>{const e=Xe.useContext(H3);if(!e)throw new Error("No QueryClient set, use QueryClientProvider to set one");return e},n5=({client:r,children:e})=>(Xe.useEffect(()=>(r.mount(),()=>{r.unmount()}),[r]),rt.jsx(H3.Provider,{value:r,children:e})),q3=Xe.createContext(!1),o5=()=>Xe.useContext(q3);q3.Provider;function a5(){let r=!1;return{clearReset:()=>{r=!1},reset:()=>{r=!0},isReset:()=>r}}var s5=Xe.createContext(a5()),l5=()=>Xe.useContext(s5),c5=(r,e)=>{(r.suspense||r.throwOnError||r.experimental_prefetchInRender)&&(e.isReset()||(r.retryOnMount=!1))},u5=r=>{Xe.useEffect(()=>{r.clearReset()},[r])},h5=({result:r,errorResetBoundary:e,throwOnError:o,query:l,suspense:h})=>r.isError&&!e.isReset()&&!r.isFetching&&l&&(h&&r.data===void 0||k3(o,[r.error,l])),f5=r=>{if(r.suspense){const o=h=>h==="static"?h:Math.max(h??1e3,1e3),l=r.staleTime;r.staleTime=typeof l=="function"?(...h)=>o(l(...h)):o(l),typeof r.gcTime=="number"&&(r.gcTime=Math.max(r.gcTime,1e3))}},d5=(r,e)=>r.isLoading&&r.isFetching&&!e,p5=(r,e)=>r?.suspense&&e.isPending,KA=(r,e,o)=>e.fetchOptimistic(r).catch(()=>{o.clearReset()});function m5(r,e,o){const l=o5(),h=l5(),m=$w(),b=m.defaultQueryOptions(r);m.getDefaultOptions().queries?._experimental_beforeQuery?.(b),b._optimisticResults=l?"isRestoring":"optimistic",f5(b),c5(b,h),u5(h);const n=!m.getQueryCache().get(b.queryHash),[C]=Xe.useState(()=>new e(m,b)),D=C.getOptimisticResult(b),L=!l&&r.subscribed!==!1;if(Xe.useSyncExternalStore(Xe.useCallback(U=>{const q=L?C.subscribe(za.batchCalls(U)):pl;return C.updateResult(),q},[C,L]),()=>C.getCurrentResult(),()=>C.getCurrentResult()),Xe.useEffect(()=>{C.setOptions(b)},[b,C]),p5(b,D))throw KA(b,C,h);if(h5({result:D,errorResetBoundary:h,throwOnError:b.throwOnError,query:m.getQueryCache().get(b.queryHash),suspense:b.suspense}))throw D.error;return m.getDefaultOptions().queries?._experimental_afterQuery?.(b,D),b.experimental_prefetchInRender&&!Sg&&d5(D,l)&&(n?KA(b,C,h):m.getQueryCache().get(b.queryHash)?.promise)?.catch(pl).finally(()=>{C.updateResult()}),b.notifyOnChangeProps?D:C.trackResult(D)}function Vv(r,e){return m5(r,WL)}function g5(r,e){const o=$w(),[l]=Xe.useState(()=>new t5(o,r));Xe.useEffect(()=>{l.setOptions(r)},[l,r]);const h=Xe.useSyncExternalStore(Xe.useCallback(b=>l.subscribe(za.batchCalls(b)),[l]),()=>l.getCurrentResult(),()=>l.getCurrentResult()),m=Xe.useCallback((b,n)=>{l.mutate(b,n).catch(pl)},[l]);if(h.error&&k3(l.options.throwOnError,[h.error]))throw h.error;return{...h,mutate:m,mutateAsync:h.mutate}}function _5({children:r}){const[e]=Xe.useState(()=>new i5({defaultOptions:{queries:{staleTime:3e5,gcTime:6e5,retry:(o,l)=>o<3,refetchOnWindowFocus:"always",refetchOnReconnect:"always"},mutations:{retry:2}}}));return rt.jsxs(n5,{client:e,children:[r,!1]})}const Fn={info:(...r)=>{try{console.info("[INFO]",...r)}catch{}},warn:(...r)=>{try{console.warn("[WARN]",...r)}catch{}},error:(...r)=>{try{console.error("[ERROR]",...r)}catch{}},debug:(...r)=>{try{typeof console.debug=="function"?console.debug("[DEBUG]",...r):console.log("[DEBUG]",...r)}catch{}},env:(r,e,o=!1)=>{try{const l=e!=null&&e!=="";console.log("[ENV]",r,"=",l?e:"undefined"),o&&!l&&console.error(`[ENV] Missing required variable: ${r}`)}catch{}},object:(r,e)=>{try{console.group(`[OBJ] ${r}`),console.log(e),console.groupEnd()}catch{}},array:(r,e)=>{try{console.group(`[ARR] ${r} (${e.length})`),e.forEach((o,l)=>console.log(`[${l}]`,o)),console.groupEnd()}catch{}},api:(r,e,o)=>{try{console.group(`[API] ${r.toUpperCase()} ${e}`),o&&console.log("payload:",o),console.groupEnd()}catch{}},state:(r,e)=>{try{console.group(`[STATE] ${r}`),console.log(e),console.groupEnd()}catch{}},perf:(r,e)=>{try{console.log(`[PERF] ${r}: ${Date.now()-e}ms`)}catch{}}};function y5(){let e="https://capable-kiwi-78.convex.cloud".trim();return e||(e="http://127.0.0.1:3210",Fn.error("[Convex] Missing VITE_CONVEX_URL. Falling back to http://127.0.0.1:3210"),Fn.error("Set VITE_CONVEX_URL=https://<deployment>.convex.cloud for cloud or run npx convex dev locally")),Fn.info(`[Convex] Using base URL: ${e}`),e}const v5=y5(),W_=new OL(v5);function x5({children:r}){return rt.jsx(LL,{client:W_,children:rt.jsx(_5,{children:r})})}const Xw=Xe.createContext({});function Zw(r){const e=Xe.useRef(null);return e.current===null&&(e.current=r()),e.current}const Ww=typeof window<"u",$3=Ww?Xe.useLayoutEffect:Xe.useEffect,Uv=Xe.createContext(null);function Yw(r,e){r.indexOf(e)===-1&&r.push(e)}function Qw(r,e){const o=r.indexOf(e);o>-1&&r.splice(o,1)}const kd=(r,e,o)=>o>e?e:o<r?r:o;let Kw=()=>{};const Nd={},X3=r=>/^-?(?:\d+(?:\.\d+)?|\.\d+)$/u.test(r);function Z3(r){return typeof r=="object"&&r!==null}const W3=r=>/^0[^.\s]+$/u.test(r);function Jw(r){let e;return()=>(e===void 0&&(e=r()),e)}const Lu=r=>r,b5=(r,e)=>o=>e(r(o)),Dy=(...r)=>r.reduce(b5),xy=(r,e,o)=>{const l=e-r;return l===0?1:(o-r)/l};class e2{constructor(){this.subscriptions=[]}add(e){return Yw(this.subscriptions,e),()=>Qw(this.subscriptions,e)}notify(e,o,l){const h=this.subscriptions.length;if(h)if(h===1)this.subscriptions[0](e,o,l);else for(let m=0;m<h;m++){const b=this.subscriptions[m];b&&b(e,o,l)}}getSize(){return this.subscriptions.length}clear(){this.subscriptions.length=0}}const Af=r=>r*1e3,Ou=r=>r/1e3;function Y3(r,e){return e?r*(1e3/e):0}const Q3=(r,e,o)=>(((1-3*o+3*e)*r+(3*o-6*e))*r+3*e)*r,w5=1e-7,S5=12;function T5(r,e,o,l,h){let m,b,n=0;do b=e+(o-e)/2,m=Q3(b,l,h)-r,m>0?o=b:e=b;while(Math.abs(m)>w5&&++n<S5);return b}function Oy(r,e,o,l){if(r===e&&o===l)return Lu;const h=m=>T5(m,0,1,r,o);return m=>m===0||m===1?m:Q3(h(m),e,l)}const K3=r=>e=>e<=.5?r(2*e)/2:(2-r(2*(1-e)))/2,J3=r=>e=>1-r(1-e),eI=Oy(.33,1.53,.69,.99),t2=J3(eI),tI=K3(t2),rI=r=>(r*=2)<1?.5*t2(r):.5*(2-Math.pow(2,-10*(r-1))),r2=r=>1-Math.sin(Math.acos(r)),iI=J3(r2),nI=K3(r2),A5=Oy(.42,0,1,1),E5=Oy(0,0,.58,1),oI=Oy(.42,0,.58,1),C5=r=>Array.isArray(r)&&typeof r[0]!="number",aI=r=>Array.isArray(r)&&typeof r[0]=="number",I5={linear:Lu,easeIn:A5,easeInOut:oI,easeOut:E5,circIn:r2,circInOut:nI,circOut:iI,backIn:t2,backInOut:tI,backOut:eI,anticipate:rI},R5=r=>typeof r=="string",JA=r=>{if(aI(r)){Kw(r.length===4);const[e,o,l,h]=r;return Oy(e,o,l,h)}else if(R5(r))return I5[r];return r},J1=["setup","read","resolveKeyframes","preUpdate","update","preRender","render","postRender"];function M5(r,e){let o=new Set,l=new Set,h=!1,m=!1;const b=new WeakSet;let n={delta:0,timestamp:0,isProcessing:!1};function C(L){b.has(L)&&(D.schedule(L),r()),L(n)}const D={schedule:(L,U=!1,q=!1)=>{const ie=q&&h?o:l;return U&&b.add(L),ie.has(L)||ie.add(L),L},cancel:L=>{l.delete(L),b.delete(L)},process:L=>{if(n=L,h){m=!0;return}h=!0,[o,l]=[l,o],o.forEach(C),o.clear(),h=!1,m&&(m=!1,D.process(L))}};return D}const D5=40;function sI(r,e){let o=!1,l=!0;const h={delta:0,timestamp:0,isProcessing:!1},m=()=>o=!0,b=J1.reduce((Pe,Ze)=>(Pe[Ze]=M5(m),Pe),{}),{setup:n,read:C,resolveKeyframes:D,preUpdate:L,update:U,preRender:q,render:Z,postRender:ie}=b,ne=()=>{const Pe=Nd.useManualTiming?h.timestamp:performance.now();o=!1,Nd.useManualTiming||(h.delta=l?1e3/60:Math.max(Math.min(Pe-h.timestamp,D5),1)),h.timestamp=Pe,h.isProcessing=!0,n.process(h),C.process(h),D.process(h),L.process(h),U.process(h),q.process(h),Z.process(h),ie.process(h),h.isProcessing=!1,o&&e&&(l=!1,r(ne))},be=()=>{o=!0,l=!0,h.isProcessing||r(ne)};return{schedule:J1.reduce((Pe,Ze)=>{const $e=b[Ze];return Pe[Ze]=(xt,Ct=!1,Ft=!1)=>(o||be(),$e.schedule(xt,Ct,Ft)),Pe},{}),cancel:Pe=>{for(let Ze=0;Ze<J1.length;Ze++)b[J1[Ze]].cancel(Pe)},state:h,steps:b}}const{schedule:Co,cancel:hm,state:ps,steps:db}=sI(typeof requestAnimationFrame<"u"?requestAnimationFrame:Lu,!0);let mv;function O5(){mv=void 0}const $l={now:()=>(mv===void 0&&$l.set(ps.isProcessing||Nd.useManualTiming?ps.timestamp:performance.now()),mv),set:r=>{mv=r,queueMicrotask(O5)}},lI=r=>e=>typeof e=="string"&&e.startsWith(r),i2=lI("--"),P5=lI("var(--"),n2=r=>P5(r)?L5.test(r.split("/*")[0].trim()):!1,L5=/var\(--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)$/iu,Y_={test:r=>typeof r=="number",parse:parseFloat,transform:r=>r},by={...Y_,transform:r=>kd(0,1,r)},ev={...Y_,default:1},cy=r=>Math.round(r*1e5)/1e5,o2=/-?(?:\d+(?:\.\d+)?|\.\d+)/gu;function B5(r){return r==null}const z5=/^(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))$/iu,a2=(r,e)=>o=>!!(typeof o=="string"&&z5.test(o)&&o.startsWith(r)||e&&!B5(o)&&Object.prototype.hasOwnProperty.call(o,e)),cI=(r,e,o)=>l=>{if(typeof l!="string")return l;const[h,m,b,n]=l.match(o2);return{[r]:parseFloat(h),[e]:parseFloat(m),[o]:parseFloat(b),alpha:n!==void 0?parseFloat(n):1}},F5=r=>kd(0,255,r),pb={...Y_,transform:r=>Math.round(F5(r))},gg={test:a2("rgb","red"),parse:cI("red","green","blue"),transform:({red:r,green:e,blue:o,alpha:l=1})=>"rgba("+pb.transform(r)+", "+pb.transform(e)+", "+pb.transform(o)+", "+cy(by.transform(l))+")"};function k5(r){let e="",o="",l="",h="";return r.length>5?(e=r.substring(1,3),o=r.substring(3,5),l=r.substring(5,7),h=r.substring(7,9)):(e=r.substring(1,2),o=r.substring(2,3),l=r.substring(3,4),h=r.substring(4,5),e+=e,o+=o,l+=l,h+=h),{red:parseInt(e,16),green:parseInt(o,16),blue:parseInt(l,16),alpha:h?parseInt(h,16)/255:1}}const Qb={test:a2("#"),parse:k5,transform:gg.transform},Py=r=>({test:e=>typeof e=="string"&&e.endsWith(r)&&e.split(" ").length===1,parse:parseFloat,transform:e=>`${e}${r}`}),nm=Py("deg"),Ef=Py("%"),Oi=Py("px"),N5=Py("vh"),V5=Py("vw"),eE={...Ef,parse:r=>Ef.parse(r)/100,transform:r=>Ef.transform(r*100)},M_={test:a2("hsl","hue"),parse:cI("hue","saturation","lightness"),transform:({hue:r,saturation:e,lightness:o,alpha:l=1})=>"hsla("+Math.round(r)+", "+Ef.transform(cy(e))+", "+Ef.transform(cy(o))+", "+cy(by.transform(l))+")"},_a={test:r=>gg.test(r)||Qb.test(r)||M_.test(r),parse:r=>gg.test(r)?gg.parse(r):M_.test(r)?M_.parse(r):Qb.parse(r),transform:r=>typeof r=="string"?r:r.hasOwnProperty("red")?gg.transform(r):M_.transform(r),getAnimatableNone:r=>{const e=_a.parse(r);return e.alpha=0,_a.transform(e)}},U5=/(?:#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\))/giu;function j5(r){return isNaN(r)&&typeof r=="string"&&(r.match(o2)?.length||0)+(r.match(U5)?.length||0)>0}const uI="number",hI="color",G5="var",H5="var(",tE="${}",q5=/var\s*\(\s*--(?:[\w-]+\s*|[\w-]+\s*,(?:\s*[^)(\s]|\s*\((?:[^)(]|\([^)(]*\))*\))+\s*)\)|#[\da-f]{3,8}|(?:rgb|hsl)a?\((?:-?[\d.]+%?[,\s]+){2}-?[\d.]+%?\s*(?:[,/]\s*)?(?:\b\d+(?:\.\d+)?|\.\d+)?%?\)|-?(?:\d+(?:\.\d+)?|\.\d+)/giu;function wy(r){const e=r.toString(),o=[],l={color:[],number:[],var:[]},h=[];let m=0;const n=e.replace(q5,C=>(_a.test(C)?(l.color.push(m),h.push(hI),o.push(_a.parse(C))):C.startsWith(H5)?(l.var.push(m),h.push(G5),o.push(C)):(l.number.push(m),h.push(uI),o.push(parseFloat(C))),++m,tE)).split(tE);return{values:o,split:n,indexes:l,types:h}}function fI(r){return wy(r).values}function dI(r){const{split:e,types:o}=wy(r),l=e.length;return h=>{let m="";for(let b=0;b<l;b++)if(m+=e[b],h[b]!==void 0){const n=o[b];n===uI?m+=cy(h[b]):n===hI?m+=_a.transform(h[b]):m+=h[b]}return m}}const $5=r=>typeof r=="number"?0:_a.test(r)?_a.getAnimatableNone(r):r;function X5(r){const e=fI(r);return dI(r)(e.map($5))}const fm={test:j5,parse:fI,createTransformer:dI,getAnimatableNone:X5};function mb(r,e,o){return o<0&&(o+=1),o>1&&(o-=1),o<1/6?r+(e-r)*6*o:o<1/2?e:o<2/3?r+(e-r)*(2/3-o)*6:r}function Z5({hue:r,saturation:e,lightness:o,alpha:l}){r/=360,e/=100,o/=100;let h=0,m=0,b=0;if(!e)h=m=b=o;else{const n=o<.5?o*(1+e):o+e-o*e,C=2*o-n;h=mb(C,n,r+1/3),m=mb(C,n,r),b=mb(C,n,r-1/3)}return{red:Math.round(h*255),green:Math.round(m*255),blue:Math.round(b*255),alpha:l}}function Mv(r,e){return o=>o>0?e:r}const Fo=(r,e,o)=>r+(e-r)*o,gb=(r,e,o)=>{const l=r*r,h=o*(e*e-l)+l;return h<0?0:Math.sqrt(h)},W5=[Qb,gg,M_],Y5=r=>W5.find(e=>e.test(r));function rE(r){const e=Y5(r);if(!e)return!1;let o=e.parse(r);return e===M_&&(o=Z5(o)),o}const iE=(r,e)=>{const o=rE(r),l=rE(e);if(!o||!l)return Mv(r,e);const h={...o};return m=>(h.red=gb(o.red,l.red,m),h.green=gb(o.green,l.green,m),h.blue=gb(o.blue,l.blue,m),h.alpha=Fo(o.alpha,l.alpha,m),gg.transform(h))},Kb=new Set(["none","hidden"]);function Q5(r,e){return Kb.has(r)?o=>o<=0?r:e:o=>o>=1?e:r}function K5(r,e){return o=>Fo(r,e,o)}function s2(r){return typeof r=="number"?K5:typeof r=="string"?n2(r)?Mv:_a.test(r)?iE:t6:Array.isArray(r)?pI:typeof r=="object"?_a.test(r)?iE:J5:Mv}function pI(r,e){const o=[...r],l=o.length,h=r.map((m,b)=>s2(m)(m,e[b]));return m=>{for(let b=0;b<l;b++)o[b]=h[b](m);return o}}function J5(r,e){const o={...r,...e},l={};for(const h in o)r[h]!==void 0&&e[h]!==void 0&&(l[h]=s2(r[h])(r[h],e[h]));return h=>{for(const m in l)o[m]=l[m](h);return o}}function e6(r,e){const o=[],l={color:0,var:0,number:0};for(let h=0;h<e.values.length;h++){const m=e.types[h],b=r.indexes[m][l[m]],n=r.values[b]??0;o[h]=n,l[m]++}return o}const t6=(r,e)=>{const o=fm.createTransformer(e),l=wy(r),h=wy(e);return l.indexes.var.length===h.indexes.var.length&&l.indexes.color.length===h.indexes.color.length&&l.indexes.number.length>=h.indexes.number.length?Kb.has(r)&&!h.values.length||Kb.has(e)&&!l.values.length?Q5(r,e):Dy(pI(e6(l,h),h.values),o):Mv(r,e)};function mI(r,e,o){return typeof r=="number"&&typeof e=="number"&&typeof o=="number"?Fo(r,e,o):s2(r)(r,e)}const r6=r=>{const e=({timestamp:o})=>r(o);return{start:(o=!0)=>Co.update(e,o),stop:()=>hm(e),now:()=>ps.isProcessing?ps.timestamp:$l.now()}},gI=(r,e,o=10)=>{let l="";const h=Math.max(Math.round(e/o),2);for(let m=0;m<h;m++)l+=Math.round(r(m/(h-1))*1e4)/1e4+", ";return`linear(${l.substring(0,l.length-2)})`},Dv=2e4;function l2(r){let e=0;const o=50;let l=r.next(e);for(;!l.done&&e<Dv;)e+=o,l=r.next(e);return e>=Dv?1/0:e}function i6(r,e=100,o){const l=o({...r,keyframes:[0,e]}),h=Math.min(l2(l),Dv);return{type:"keyframes",ease:m=>l.next(h*m).value/e,duration:Ou(h)}}const n6=5;function _I(r,e,o){const l=Math.max(e-n6,0);return Y3(o-r(l),e-l)}const Xo={stiffness:100,damping:10,mass:1,velocity:0,duration:800,bounce:.3,visualDuration:.3,restSpeed:{granular:.01,default:2},restDelta:{granular:.005,default:.5},minDuration:.01,maxDuration:10,minDamping:.05,maxDamping:1},_b=.001;function o6({duration:r=Xo.duration,bounce:e=Xo.bounce,velocity:o=Xo.velocity,mass:l=Xo.mass}){let h,m,b=1-e;b=kd(Xo.minDamping,Xo.maxDamping,b),r=kd(Xo.minDuration,Xo.maxDuration,Ou(r)),b<1?(h=D=>{const L=D*b,U=L*r,q=L-o,Z=Jb(D,b),ie=Math.exp(-U);return _b-q/Z*ie},m=D=>{const U=D*b*r,q=U*o+o,Z=Math.pow(b,2)*Math.pow(D,2)*r,ie=Math.exp(-U),ne=Jb(Math.pow(D,2),b);return(-h(D)+_b>0?-1:1)*((q-Z)*ie)/ne}):(h=D=>{const L=Math.exp(-D*r),U=(D-o)*r+1;return-_b+L*U},m=D=>{const L=Math.exp(-D*r),U=(o-D)*(r*r);return L*U});const n=5/r,C=s6(h,m,n);if(r=Af(r),isNaN(C))return{stiffness:Xo.stiffness,damping:Xo.damping,duration:r};{const D=Math.pow(C,2)*l;return{stiffness:D,damping:b*2*Math.sqrt(l*D),duration:r}}}const a6=12;function s6(r,e,o){let l=o;for(let h=1;h<a6;h++)l=l-r(l)/e(l);return l}function Jb(r,e){return r*Math.sqrt(1-e*e)}const l6=["duration","bounce"],c6=["stiffness","damping","mass"];function nE(r,e){return e.some(o=>r[o]!==void 0)}function u6(r){let e={velocity:Xo.velocity,stiffness:Xo.stiffness,damping:Xo.damping,mass:Xo.mass,isResolvedFromDuration:!1,...r};if(!nE(r,c6)&&nE(r,l6))if(r.visualDuration){const o=r.visualDuration,l=2*Math.PI/(o*1.2),h=l*l,m=2*kd(.05,1,1-(r.bounce||0))*Math.sqrt(h);e={...e,mass:Xo.mass,stiffness:h,damping:m}}else{const o=o6(r);e={...e,...o,mass:Xo.mass},e.isResolvedFromDuration=!0}return e}function Ov(r=Xo.visualDuration,e=Xo.bounce){const o=typeof r!="object"?{visualDuration:r,keyframes:[0,1],bounce:e}:r;let{restSpeed:l,restDelta:h}=o;const m=o.keyframes[0],b=o.keyframes[o.keyframes.length-1],n={done:!1,value:m},{stiffness:C,damping:D,mass:L,duration:U,velocity:q,isResolvedFromDuration:Z}=u6({...o,velocity:-Ou(o.velocity||0)}),ie=q||0,ne=D/(2*Math.sqrt(C*L)),be=b-m,ve=Ou(Math.sqrt(C/L)),we=Math.abs(be)<5;l||(l=we?Xo.restSpeed.granular:Xo.restSpeed.default),h||(h=we?Xo.restDelta.granular:Xo.restDelta.default);let Pe;if(ne<1){const $e=Jb(ve,ne);Pe=xt=>{const Ct=Math.exp(-ne*ve*xt);return b-Ct*((ie+ne*ve*be)/$e*Math.sin($e*xt)+be*Math.cos($e*xt))}}else if(ne===1)Pe=$e=>b-Math.exp(-ve*$e)*(be+(ie+ve*be)*$e);else{const $e=ve*Math.sqrt(ne*ne-1);Pe=xt=>{const Ct=Math.exp(-ne*ve*xt),Ft=Math.min($e*xt,300);return b-Ct*((ie+ne*ve*be)*Math.sinh(Ft)+$e*be*Math.cosh(Ft))/$e}}const Ze={calculatedDuration:Z&&U||null,next:$e=>{const xt=Pe($e);if(Z)n.done=$e>=U;else{let Ct=$e===0?ie:0;ne<1&&(Ct=$e===0?Af(ie):_I(Pe,$e,xt));const Ft=Math.abs(Ct)<=l,Yt=Math.abs(b-xt)<=h;n.done=Ft&&Yt}return n.value=n.done?b:xt,n},toString:()=>{const $e=Math.min(l2(Ze),Dv),xt=gI(Ct=>Ze.next($e*Ct).value,$e,30);return $e+"ms "+xt},toTransition:()=>{}};return Ze}Ov.applyToOptions=r=>{const e=i6(r,100,Ov);return r.ease=e.ease,r.duration=Af(e.duration),r.type="keyframes",r};function ew({keyframes:r,velocity:e=0,power:o=.8,timeConstant:l=325,bounceDamping:h=10,bounceStiffness:m=500,modifyTarget:b,min:n,max:C,restDelta:D=.5,restSpeed:L}){const U=r[0],q={done:!1,value:U},Z=Ft=>n!==void 0&&Ft<n||C!==void 0&&Ft>C,ie=Ft=>n===void 0?C:C===void 0||Math.abs(n-Ft)<Math.abs(C-Ft)?n:C;let ne=o*e;const be=U+ne,ve=b===void 0?be:b(be);ve!==be&&(ne=ve-U);const we=Ft=>-ne*Math.exp(-Ft/l),Pe=Ft=>ve+we(Ft),Ze=Ft=>{const Yt=we(Ft),hr=Pe(Ft);q.done=Math.abs(Yt)<=D,q.value=q.done?ve:hr};let $e,xt;const Ct=Ft=>{Z(q.value)&&($e=Ft,xt=Ov({keyframes:[q.value,ie(q.value)],velocity:_I(Pe,Ft,q.value),damping:h,stiffness:m,restDelta:D,restSpeed:L}))};return Ct(0),{calculatedDuration:null,next:Ft=>{let Yt=!1;return!xt&&$e===void 0&&(Yt=!0,Ze(Ft),Ct(Ft)),$e!==void 0&&Ft>=$e?xt.next(Ft-$e):(!Yt&&Ze(Ft),q)}}}function h6(r,e,o){const l=[],h=o||Nd.mix||mI,m=r.length-1;for(let b=0;b<m;b++){let n=h(r[b],r[b+1]);if(e){const C=Array.isArray(e)?e[b]||Lu:e;n=Dy(C,n)}l.push(n)}return l}function f6(r,e,{clamp:o=!0,ease:l,mixer:h}={}){const m=r.length;if(Kw(m===e.length),m===1)return()=>e[0];if(m===2&&e[0]===e[1])return()=>e[1];const b=r[0]===r[1];r[0]>r[m-1]&&(r=[...r].reverse(),e=[...e].reverse());const n=h6(e,l,h),C=n.length,D=L=>{if(b&&L<r[0])return e[0];let U=0;if(C>1)for(;U<r.length-2&&!(L<r[U+1]);U++);const q=xy(r[U],r[U+1],L);return n[U](q)};return o?L=>D(kd(r[0],r[m-1],L)):D}function d6(r,e){const o=r[r.length-1];for(let l=1;l<=e;l++){const h=xy(0,e,l);r.push(Fo(o,1,h))}}function p6(r){const e=[0];return d6(e,r.length-1),e}function m6(r,e){return r.map(o=>o*e)}function g6(r,e){return r.map(()=>e||oI).splice(0,r.length-1)}function uy({duration:r=300,keyframes:e,times:o,ease:l="easeInOut"}){const h=C5(l)?l.map(JA):JA(l),m={done:!1,value:e[0]},b=m6(o&&o.length===e.length?o:p6(e),r),n=f6(b,e,{ease:Array.isArray(h)?h:g6(e,h)});return{calculatedDuration:r,next:C=>(m.value=n(C),m.done=C>=r,m)}}const _6=r=>r!==null;function c2(r,{repeat:e,repeatType:o="loop"},l,h=1){const m=r.filter(_6),n=h<0||e&&o!=="loop"&&e%2===1?0:m.length-1;return!n||l===void 0?m[n]:l}const y6={decay:ew,inertia:ew,tween:uy,keyframes:uy,spring:Ov};function yI(r){typeof r.type=="string"&&(r.type=y6[r.type])}class u2{constructor(){this.updateFinished()}get finished(){return this._finished}updateFinished(){this._finished=new Promise(e=>{this.resolve=e})}notifyFinished(){this.resolve()}then(e,o){return this.finished.then(e,o)}}const v6=r=>r/100;class h2 extends u2{constructor(e){super(),this.state="idle",this.startTime=null,this.isStopped=!1,this.currentTime=0,this.holdTime=null,this.playbackSpeed=1,this.stop=()=>{const{motionValue:o}=this.options;o&&o.updatedAt!==$l.now()&&this.tick($l.now()),this.isStopped=!0,this.state!=="idle"&&(this.teardown(),this.options.onStop?.())},this.options=e,this.initAnimation(),this.play(),e.autoplay===!1&&this.pause()}initAnimation(){const{options:e}=this;yI(e);const{type:o=uy,repeat:l=0,repeatDelay:h=0,repeatType:m,velocity:b=0}=e;let{keyframes:n}=e;const C=o||uy;C!==uy&&typeof n[0]!="number"&&(this.mixKeyframes=Dy(v6,mI(n[0],n[1])),n=[0,100]);const D=C({...e,keyframes:n});m==="mirror"&&(this.mirroredGenerator=C({...e,keyframes:[...n].reverse(),velocity:-b})),D.calculatedDuration===null&&(D.calculatedDuration=l2(D));const{calculatedDuration:L}=D;this.calculatedDuration=L,this.resolvedDuration=L+h,this.totalDuration=this.resolvedDuration*(l+1)-h,this.generator=D}updateTime(e){const o=Math.round(e-this.startTime)*this.playbackSpeed;this.holdTime!==null?this.currentTime=this.holdTime:this.currentTime=o}tick(e,o=!1){const{generator:l,totalDuration:h,mixKeyframes:m,mirroredGenerator:b,resolvedDuration:n,calculatedDuration:C}=this;if(this.startTime===null)return l.next(0);const{delay:D=0,keyframes:L,repeat:U,repeatType:q,repeatDelay:Z,type:ie,onUpdate:ne,finalKeyframe:be}=this.options;this.speed>0?this.startTime=Math.min(this.startTime,e):this.speed<0&&(this.startTime=Math.min(e-h/this.speed,this.startTime)),o?this.currentTime=e:this.updateTime(e);const ve=this.currentTime-D*(this.playbackSpeed>=0?1:-1),we=this.playbackSpeed>=0?ve<0:ve>h;this.currentTime=Math.max(ve,0),this.state==="finished"&&this.holdTime===null&&(this.currentTime=h);let Pe=this.currentTime,Ze=l;if(U){const Ft=Math.min(this.currentTime,h)/n;let Yt=Math.floor(Ft),hr=Ft%1;!hr&&Ft>=1&&(hr=1),hr===1&&Yt--,Yt=Math.min(Yt,U+1),!!(Yt%2)&&(q==="reverse"?(hr=1-hr,Z&&(hr-=Z/n)):q==="mirror"&&(Ze=b)),Pe=kd(0,1,hr)*n}const $e=we?{done:!1,value:L[0]}:Ze.next(Pe);m&&($e.value=m($e.value));let{done:xt}=$e;!we&&C!==null&&(xt=this.playbackSpeed>=0?this.currentTime>=h:this.currentTime<=0);const Ct=this.holdTime===null&&(this.state==="finished"||this.state==="running"&&xt);return Ct&&ie!==ew&&($e.value=c2(L,this.options,be,this.speed)),ne&&ne($e.value),Ct&&this.finish(),$e}then(e,o){return this.finished.then(e,o)}get duration(){return Ou(this.calculatedDuration)}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ou(e)}get time(){return Ou(this.currentTime)}set time(e){e=Af(e),this.currentTime=e,this.startTime===null||this.holdTime!==null||this.playbackSpeed===0?this.holdTime=e:this.driver&&(this.startTime=this.driver.now()-e/this.playbackSpeed),this.driver?.start(!1)}get speed(){return this.playbackSpeed}set speed(e){this.updateTime($l.now());const o=this.playbackSpeed!==e;this.playbackSpeed=e,o&&(this.time=Ou(this.currentTime))}play(){if(this.isStopped)return;const{driver:e=r6,startTime:o}=this.options;this.driver||(this.driver=e(h=>this.tick(h))),this.options.onPlay?.();const l=this.driver.now();this.state==="finished"?(this.updateFinished(),this.startTime=l):this.holdTime!==null?this.startTime=l-this.holdTime:this.startTime||(this.startTime=o??l),this.state==="finished"&&this.speed<0&&(this.startTime+=this.calculatedDuration),this.holdTime=null,this.state="running",this.driver.start()}pause(){this.state="paused",this.updateTime($l.now()),this.holdTime=this.currentTime}complete(){this.state!=="running"&&this.play(),this.state="finished",this.holdTime=null}finish(){this.notifyFinished(),this.teardown(),this.state="finished",this.options.onComplete?.()}cancel(){this.holdTime=null,this.startTime=0,this.tick(0),this.teardown(),this.options.onCancel?.()}teardown(){this.state="idle",this.stopDriver(),this.startTime=this.holdTime=null}stopDriver(){this.driver&&(this.driver.stop(),this.driver=void 0)}sample(e){return this.startTime=0,this.tick(e,!0)}attachTimeline(e){return this.options.allowFlatten&&(this.options.type="keyframes",this.options.ease="linear",this.initAnimation()),this.driver?.stop(),e.observe(this)}}function x6(r){for(let e=1;e<r.length;e++)r[e]??(r[e]=r[e-1])}const _g=r=>r*180/Math.PI,tw=r=>{const e=_g(Math.atan2(r[1],r[0]));return rw(e)},b6={x:4,y:5,translateX:4,translateY:5,scaleX:0,scaleY:3,scale:r=>(Math.abs(r[0])+Math.abs(r[3]))/2,rotate:tw,rotateZ:tw,skewX:r=>_g(Math.atan(r[1])),skewY:r=>_g(Math.atan(r[2])),skew:r=>(Math.abs(r[1])+Math.abs(r[2]))/2},rw=r=>(r=r%360,r<0&&(r+=360),r),oE=tw,aE=r=>Math.sqrt(r[0]*r[0]+r[1]*r[1]),sE=r=>Math.sqrt(r[4]*r[4]+r[5]*r[5]),w6={x:12,y:13,z:14,translateX:12,translateY:13,translateZ:14,scaleX:aE,scaleY:sE,scale:r=>(aE(r)+sE(r))/2,rotateX:r=>rw(_g(Math.atan2(r[6],r[5]))),rotateY:r=>rw(_g(Math.atan2(-r[2],r[0]))),rotateZ:oE,rotate:oE,skewX:r=>_g(Math.atan(r[4])),skewY:r=>_g(Math.atan(r[1])),skew:r=>(Math.abs(r[1])+Math.abs(r[4]))/2};function iw(r){return r.includes("scale")?1:0}function nw(r,e){if(!r||r==="none")return iw(e);const o=r.match(/^matrix3d\(([-\d.e\s,]+)\)$/u);let l,h;if(o)l=w6,h=o;else{const n=r.match(/^matrix\(([-\d.e\s,]+)\)$/u);l=b6,h=n}if(!h)return iw(e);const m=l[e],b=h[1].split(",").map(T6);return typeof m=="function"?m(b):b[m]}const S6=(r,e)=>{const{transform:o="none"}=getComputedStyle(r);return nw(o,e)};function T6(r){return parseFloat(r.trim())}const Q_=["transformPerspective","x","y","z","translateX","translateY","translateZ","scale","scaleX","scaleY","rotate","rotateX","rotateY","rotateZ","skew","skewX","skewY"],K_=new Set(Q_),lE=r=>r===Y_||r===Oi,A6=new Set(["x","y","z"]),E6=Q_.filter(r=>!A6.has(r));function C6(r){const e=[];return E6.forEach(o=>{const l=r.getValue(o);l!==void 0&&(e.push([o,l.get()]),l.set(o.startsWith("scale")?1:0))}),e}const xg={width:({x:r},{paddingLeft:e="0",paddingRight:o="0"})=>r.max-r.min-parseFloat(e)-parseFloat(o),height:({y:r},{paddingTop:e="0",paddingBottom:o="0"})=>r.max-r.min-parseFloat(e)-parseFloat(o),top:(r,{top:e})=>parseFloat(e),left:(r,{left:e})=>parseFloat(e),bottom:({y:r},{top:e})=>parseFloat(e)+(r.max-r.min),right:({x:r},{left:e})=>parseFloat(e)+(r.max-r.min),x:(r,{transform:e})=>nw(e,"x"),y:(r,{transform:e})=>nw(e,"y")};xg.translateX=xg.x;xg.translateY=xg.y;const bg=new Set;let ow=!1,aw=!1,sw=!1;function vI(){if(aw){const r=Array.from(bg).filter(l=>l.needsMeasurement),e=new Set(r.map(l=>l.element)),o=new Map;e.forEach(l=>{const h=C6(l);h.length&&(o.set(l,h),l.render())}),r.forEach(l=>l.measureInitialState()),e.forEach(l=>{l.render();const h=o.get(l);h&&h.forEach(([m,b])=>{l.getValue(m)?.set(b)})}),r.forEach(l=>l.measureEndState()),r.forEach(l=>{l.suspendedScrollY!==void 0&&window.scrollTo(0,l.suspendedScrollY)})}aw=!1,ow=!1,bg.forEach(r=>r.complete(sw)),bg.clear()}function xI(){bg.forEach(r=>{r.readKeyframes(),r.needsMeasurement&&(aw=!0)})}function I6(){sw=!0,xI(),vI(),sw=!1}class f2{constructor(e,o,l,h,m,b=!1){this.state="pending",this.isAsync=!1,this.needsMeasurement=!1,this.unresolvedKeyframes=[...e],this.onComplete=o,this.name=l,this.motionValue=h,this.element=m,this.isAsync=b}scheduleResolve(){this.state="scheduled",this.isAsync?(bg.add(this),ow||(ow=!0,Co.read(xI),Co.resolveKeyframes(vI))):(this.readKeyframes(),this.complete())}readKeyframes(){const{unresolvedKeyframes:e,name:o,element:l,motionValue:h}=this;if(e[0]===null){const m=h?.get(),b=e[e.length-1];if(m!==void 0)e[0]=m;else if(l&&o){const n=l.readValue(o,b);n!=null&&(e[0]=n)}e[0]===void 0&&(e[0]=b),h&&m===void 0&&h.set(e[0])}x6(e)}setFinalKeyframe(){}measureInitialState(){}renderEndStyles(){}measureEndState(){}complete(e=!1){this.state="complete",this.onComplete(this.unresolvedKeyframes,this.finalKeyframe,e),bg.delete(this)}cancel(){this.state==="scheduled"&&(bg.delete(this),this.state="pending")}resume(){this.state==="pending"&&this.scheduleResolve()}}const R6=r=>r.startsWith("--");function M6(r,e,o){R6(e)?r.style.setProperty(e,o):r.style[e]=o}const D6=Jw(()=>window.ScrollTimeline!==void 0),O6={};function P6(r,e){const o=Jw(r);return()=>O6[e]??o()}const bI=P6(()=>{try{document.createElement("div").animate({opacity:0},{easing:"linear(0, 1)"})}catch{return!1}return!0},"linearEasing"),ry=([r,e,o,l])=>`cubic-bezier(${r}, ${e}, ${o}, ${l})`,cE={linear:"linear",ease:"ease",easeIn:"ease-in",easeOut:"ease-out",easeInOut:"ease-in-out",circIn:ry([0,.65,.55,1]),circOut:ry([.55,0,1,.45]),backIn:ry([.31,.01,.66,-.59]),backOut:ry([.33,1.53,.69,.99])};function wI(r,e){if(r)return typeof r=="function"?bI()?gI(r,e):"ease-out":aI(r)?ry(r):Array.isArray(r)?r.map(o=>wI(o,e)||cE.easeOut):cE[r]}function L6(r,e,o,{delay:l=0,duration:h=300,repeat:m=0,repeatType:b="loop",ease:n="easeOut",times:C}={},D=void 0){const L={[e]:o};C&&(L.offset=C);const U=wI(n,h);Array.isArray(U)&&(L.easing=U);const q={delay:l,duration:h,easing:Array.isArray(U)?"linear":U,fill:"both",iterations:m+1,direction:b==="reverse"?"alternate":"normal"};return D&&(q.pseudoElement=D),r.animate(L,q)}function SI(r){return typeof r=="function"&&"applyToOptions"in r}function B6({type:r,...e}){return SI(r)&&bI()?r.applyToOptions(e):(e.duration??(e.duration=300),e.ease??(e.ease="easeOut"),e)}class z6 extends u2{constructor(e){if(super(),this.finishedTime=null,this.isStopped=!1,!e)return;const{element:o,name:l,keyframes:h,pseudoElement:m,allowFlatten:b=!1,finalKeyframe:n,onComplete:C}=e;this.isPseudoElement=!!m,this.allowFlatten=b,this.options=e,Kw(typeof e.type!="string");const D=B6(e);this.animation=L6(o,l,h,D,m),D.autoplay===!1&&this.animation.pause(),this.animation.onfinish=()=>{if(this.finishedTime=this.time,!m){const L=c2(h,this.options,n,this.speed);this.updateMotionValue?this.updateMotionValue(L):M6(o,l,L),this.animation.cancel()}C?.(),this.notifyFinished()}}play(){this.isStopped||(this.animation.play(),this.state==="finished"&&this.updateFinished())}pause(){this.animation.pause()}complete(){this.animation.finish?.()}cancel(){try{this.animation.cancel()}catch{}}stop(){if(this.isStopped)return;this.isStopped=!0;const{state:e}=this;e==="idle"||e==="finished"||(this.updateMotionValue?this.updateMotionValue():this.commitStyles(),this.isPseudoElement||this.cancel())}commitStyles(){this.isPseudoElement||this.animation.commitStyles?.()}get duration(){const e=this.animation.effect?.getComputedTiming?.().duration||0;return Ou(Number(e))}get iterationDuration(){const{delay:e=0}=this.options||{};return this.duration+Ou(e)}get time(){return Ou(Number(this.animation.currentTime)||0)}set time(e){this.finishedTime=null,this.animation.currentTime=Af(e)}get speed(){return this.animation.playbackRate}set speed(e){e<0&&(this.finishedTime=null),this.animation.playbackRate=e}get state(){return this.finishedTime!==null?"finished":this.animation.playState}get startTime(){return Number(this.animation.startTime)}set startTime(e){this.animation.startTime=e}attachTimeline({timeline:e,observe:o}){return this.allowFlatten&&this.animation.effect?.updateTiming({easing:"linear"}),this.animation.onfinish=null,e&&D6()?(this.animation.timeline=e,Lu):o(this)}}const TI={anticipate:rI,backInOut:tI,circInOut:nI};function F6(r){return r in TI}function k6(r){typeof r.ease=="string"&&F6(r.ease)&&(r.ease=TI[r.ease])}const uE=10;class N6 extends z6{constructor(e){k6(e),yI(e),super(e),e.startTime&&(this.startTime=e.startTime),this.options=e}updateMotionValue(e){const{motionValue:o,onUpdate:l,onComplete:h,element:m,...b}=this.options;if(!o)return;if(e!==void 0){o.set(e);return}const n=new h2({...b,autoplay:!1}),C=Af(this.finishedTime??this.time);o.setWithVelocity(n.sample(C-uE).value,n.sample(C).value,uE),n.stop()}}const hE=(r,e)=>e==="zIndex"?!1:!!(typeof r=="number"||Array.isArray(r)||typeof r=="string"&&(fm.test(r)||r==="0")&&!r.startsWith("url("));function V6(r){const e=r[0];if(r.length===1)return!0;for(let o=0;o<r.length;o++)if(r[o]!==e)return!0}function U6(r,e,o,l){const h=r[0];if(h===null)return!1;if(e==="display"||e==="visibility")return!0;const m=r[r.length-1],b=hE(h,e),n=hE(m,e);return!b||!n?!1:V6(r)||(o==="spring"||SI(o))&&l}function lw(r){r.duration=0,r.type="keyframes"}const j6=new Set(["opacity","clipPath","filter","transform"]),G6=Jw(()=>Object.hasOwnProperty.call(Element.prototype,"animate"));function H6(r){const{motionValue:e,name:o,repeatDelay:l,repeatType:h,damping:m,type:b}=r;if(!(e?.owner?.current instanceof HTMLElement))return!1;const{onUpdate:C,transformTemplate:D}=e.owner.getProps();return G6()&&o&&j6.has(o)&&(o!=="transform"||!D)&&!C&&!l&&h!=="mirror"&&m!==0&&b!=="inertia"}const q6=40;class $6 extends u2{constructor({autoplay:e=!0,delay:o=0,type:l="keyframes",repeat:h=0,repeatDelay:m=0,repeatType:b="loop",keyframes:n,name:C,motionValue:D,element:L,...U}){super(),this.stop=()=>{this._animation&&(this._animation.stop(),this.stopTimeline?.()),this.keyframeResolver?.cancel()},this.createdAt=$l.now();const q={autoplay:e,delay:o,type:l,repeat:h,repeatDelay:m,repeatType:b,name:C,motionValue:D,element:L,...U},Z=L?.KeyframeResolver||f2;this.keyframeResolver=new Z(n,(ie,ne,be)=>this.onKeyframesResolved(ie,ne,q,!be),C,D,L),this.keyframeResolver?.scheduleResolve()}onKeyframesResolved(e,o,l,h){this.keyframeResolver=void 0;const{name:m,type:b,velocity:n,delay:C,isHandoff:D,onUpdate:L}=l;this.resolvedAt=$l.now(),U6(e,m,b,n)||((Nd.instantAnimations||!C)&&L?.(c2(e,l,o)),e[0]=e[e.length-1],lw(l),l.repeat=0);const q={startTime:h?this.resolvedAt?this.resolvedAt-this.createdAt>q6?this.resolvedAt:this.createdAt:this.createdAt:void 0,finalKeyframe:o,...l,keyframes:e},Z=!D&&H6(q)?new N6({...q,element:q.motionValue.owner.current}):new h2(q);Z.finished.then(()=>this.notifyFinished()).catch(Lu),this.pendingTimeline&&(this.stopTimeline=Z.attachTimeline(this.pendingTimeline),this.pendingTimeline=void 0),this._animation=Z}get finished(){return this._animation?this.animation.finished:this._finished}then(e,o){return this.finished.finally(e).then(()=>{})}get animation(){return this._animation||(this.keyframeResolver?.resume(),I6()),this._animation}get duration(){return this.animation.duration}get iterationDuration(){return this.animation.iterationDuration}get time(){return this.animation.time}set time(e){this.animation.time=e}get speed(){return this.animation.speed}get state(){return this.animation.state}set speed(e){this.animation.speed=e}get startTime(){return this.animation.startTime}attachTimeline(e){return this._animation?this.stopTimeline=this.animation.attachTimeline(e):this.pendingTimeline=e,()=>this.stop()}play(){this.animation.play()}pause(){this.animation.pause()}complete(){this.animation.complete()}cancel(){this._animation&&this.animation.cancel(),this.keyframeResolver?.cancel()}}const X6=/^var\(--(?:([\w-]+)|([\w-]+), ?([a-zA-Z\d ()%#.,-]+))\)/u;function Z6(r){const e=X6.exec(r);if(!e)return[,];const[,o,l,h]=e;return[`--${o??l}`,h]}function AI(r,e,o=1){const[l,h]=Z6(r);if(!l)return;const m=window.getComputedStyle(e).getPropertyValue(l);if(m){const b=m.trim();return X3(b)?parseFloat(b):b}return n2(h)?AI(h,e,o+1):h}function d2(r,e){return r?.[e]??r?.default??r}const EI=new Set(["width","height","top","left","right","bottom",...Q_]),W6={test:r=>r==="auto",parse:r=>r},CI=r=>e=>e.test(r),II=[Y_,Oi,Ef,nm,V5,N5,W6],fE=r=>II.find(CI(r));function Y6(r){return typeof r=="number"?r===0:r!==null?r==="none"||r==="0"||W3(r):!0}const Q6=new Set(["brightness","contrast","saturate","opacity"]);function K6(r){const[e,o]=r.slice(0,-1).split("(");if(e==="drop-shadow")return r;const[l]=o.match(o2)||[];if(!l)return r;const h=o.replace(l,"");let m=Q6.has(e)?1:0;return l!==o&&(m*=100),e+"("+m+h+")"}const J6=/\b([a-z-]*)\(.*?\)/gu,cw={...fm,getAnimatableNone:r=>{const e=r.match(J6);return e?e.map(K6).join(" "):r}},dE={...Y_,transform:Math.round},eB={rotate:nm,rotateX:nm,rotateY:nm,rotateZ:nm,scale:ev,scaleX:ev,scaleY:ev,scaleZ:ev,skew:nm,skewX:nm,skewY:nm,distance:Oi,translateX:Oi,translateY:Oi,translateZ:Oi,x:Oi,y:Oi,z:Oi,perspective:Oi,transformPerspective:Oi,opacity:by,originX:eE,originY:eE,originZ:Oi},p2={borderWidth:Oi,borderTopWidth:Oi,borderRightWidth:Oi,borderBottomWidth:Oi,borderLeftWidth:Oi,borderRadius:Oi,radius:Oi,borderTopLeftRadius:Oi,borderTopRightRadius:Oi,borderBottomRightRadius:Oi,borderBottomLeftRadius:Oi,width:Oi,maxWidth:Oi,height:Oi,maxHeight:Oi,top:Oi,right:Oi,bottom:Oi,left:Oi,padding:Oi,paddingTop:Oi,paddingRight:Oi,paddingBottom:Oi,paddingLeft:Oi,margin:Oi,marginTop:Oi,marginRight:Oi,marginBottom:Oi,marginLeft:Oi,backgroundPositionX:Oi,backgroundPositionY:Oi,...eB,zIndex:dE,fillOpacity:by,strokeOpacity:by,numOctaves:dE},tB={...p2,color:_a,backgroundColor:_a,outlineColor:_a,fill:_a,stroke:_a,borderColor:_a,borderTopColor:_a,borderRightColor:_a,borderBottomColor:_a,borderLeftColor:_a,filter:cw,WebkitFilter:cw},RI=r=>tB[r];function MI(r,e){let o=RI(r);return o!==cw&&(o=fm),o.getAnimatableNone?o.getAnimatableNone(e):void 0}const rB=new Set(["auto","none","0"]);function iB(r,e,o){let l=0,h;for(;l<r.length&&!h;){const m=r[l];typeof m=="string"&&!rB.has(m)&&wy(m).values.length&&(h=r[l]),l++}if(h&&o)for(const m of e)r[m]=MI(o,h)}class nB extends f2{constructor(e,o,l,h,m){super(e,o,l,h,m,!0)}readKeyframes(){const{unresolvedKeyframes:e,element:o,name:l}=this;if(!o||!o.current)return;super.readKeyframes();for(let C=0;C<e.length;C++){let D=e[C];if(typeof D=="string"&&(D=D.trim(),n2(D))){const L=AI(D,o.current);L!==void 0&&(e[C]=L),C===e.length-1&&(this.finalKeyframe=D)}}if(this.resolveNoneKeyframes(),!EI.has(l)||e.length!==2)return;const[h,m]=e,b=fE(h),n=fE(m);if(b!==n)if(lE(b)&&lE(n))for(let C=0;C<e.length;C++){const D=e[C];typeof D=="string"&&(e[C]=parseFloat(D))}else xg[l]&&(this.needsMeasurement=!0)}resolveNoneKeyframes(){const{unresolvedKeyframes:e,name:o}=this,l=[];for(let h=0;h<e.length;h++)(e[h]===null||Y6(e[h]))&&l.push(h);l.length&&iB(e,l,o)}measureInitialState(){const{element:e,unresolvedKeyframes:o,name:l}=this;if(!e||!e.current)return;l==="height"&&(this.suspendedScrollY=window.pageYOffset),this.measuredOrigin=xg[l](e.measureViewportBox(),window.getComputedStyle(e.current)),o[0]=this.measuredOrigin;const h=o[o.length-1];h!==void 0&&e.getValue(l,h).jump(h,!1)}measureEndState(){const{element:e,name:o,unresolvedKeyframes:l}=this;if(!e||!e.current)return;const h=e.getValue(o);h&&h.jump(this.measuredOrigin,!1);const m=l.length-1,b=l[m];l[m]=xg[o](e.measureViewportBox(),window.getComputedStyle(e.current)),b!==null&&this.finalKeyframe===void 0&&(this.finalKeyframe=b),this.removedTransforms?.length&&this.removedTransforms.forEach(([n,C])=>{e.getValue(n).set(C)}),this.resolveNoneKeyframes()}}function oB(r,e,o){if(r instanceof EventTarget)return[r];if(typeof r=="string"){let l=document;const h=o?.[r]??l.querySelectorAll(r);return h?Array.from(h):[]}return Array.from(r)}const DI=(r,e)=>e&&typeof r=="number"?e.transform(r):r;function OI(r){return Z3(r)&&"offsetHeight"in r}const pE=30,aB=r=>!isNaN(parseFloat(r));class sB{constructor(e,o={}){this.canTrackVelocity=null,this.events={},this.updateAndNotify=l=>{const h=$l.now();if(this.updatedAt!==h&&this.setPrevFrameValue(),this.prev=this.current,this.setCurrent(l),this.current!==this.prev&&(this.events.change?.notify(this.current),this.dependents))for(const m of this.dependents)m.dirty()},this.hasAnimated=!1,this.setCurrent(e),this.owner=o.owner}setCurrent(e){this.current=e,this.updatedAt=$l.now(),this.canTrackVelocity===null&&e!==void 0&&(this.canTrackVelocity=aB(this.current))}setPrevFrameValue(e=this.current){this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt}onChange(e){return this.on("change",e)}on(e,o){this.events[e]||(this.events[e]=new e2);const l=this.events[e].add(o);return e==="change"?()=>{l(),Co.read(()=>{this.events.change.getSize()||this.stop()})}:l}clearListeners(){for(const e in this.events)this.events[e].clear()}attach(e,o){this.passiveEffect=e,this.stopPassiveEffect=o}set(e){this.passiveEffect?this.passiveEffect(e,this.updateAndNotify):this.updateAndNotify(e)}setWithVelocity(e,o,l){this.set(o),this.prev=void 0,this.prevFrameValue=e,this.prevUpdatedAt=this.updatedAt-l}jump(e,o=!0){this.updateAndNotify(e),this.prev=e,this.prevUpdatedAt=this.prevFrameValue=void 0,o&&this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}dirty(){this.events.change?.notify(this.current)}addDependent(e){this.dependents||(this.dependents=new Set),this.dependents.add(e)}removeDependent(e){this.dependents&&this.dependents.delete(e)}get(){return this.current}getPrevious(){return this.prev}getVelocity(){const e=$l.now();if(!this.canTrackVelocity||this.prevFrameValue===void 0||e-this.updatedAt>pE)return 0;const o=Math.min(this.updatedAt-this.prevUpdatedAt,pE);return Y3(parseFloat(this.current)-parseFloat(this.prevFrameValue),o)}start(e){return this.stop(),new Promise(o=>{this.hasAnimated=!0,this.animation=e(o),this.events.animationStart&&this.events.animationStart.notify()}).then(()=>{this.events.animationComplete&&this.events.animationComplete.notify(),this.clearAnimation()})}stop(){this.animation&&(this.animation.stop(),this.events.animationCancel&&this.events.animationCancel.notify()),this.clearAnimation()}isAnimating(){return!!this.animation}clearAnimation(){delete this.animation}destroy(){this.dependents?.clear(),this.events.destroy?.notify(),this.clearListeners(),this.stop(),this.stopPassiveEffect&&this.stopPassiveEffect()}}function G_(r,e){return new sB(r,e)}const{schedule:m2}=sI(queueMicrotask,!1),wh={x:!1,y:!1};function PI(){return wh.x||wh.y}function lB(r){return r==="x"||r==="y"?wh[r]?null:(wh[r]=!0,()=>{wh[r]=!1}):wh.x||wh.y?null:(wh.x=wh.y=!0,()=>{wh.x=wh.y=!1})}function LI(r,e){const o=oB(r),l=new AbortController,h={passive:!0,...e,signal:l.signal};return[o,h,()=>l.abort()]}function mE(r){return!(r.pointerType==="touch"||PI())}function cB(r,e,o={}){const[l,h,m]=LI(r,o),b=n=>{if(!mE(n))return;const{target:C}=n,D=e(C,n);if(typeof D!="function"||!C)return;const L=U=>{mE(U)&&(D(U),C.removeEventListener("pointerleave",L))};C.addEventListener("pointerleave",L,h)};return l.forEach(n=>{n.addEventListener("pointerenter",b,h)}),m}const BI=(r,e)=>e?r===e?!0:BI(r,e.parentElement):!1,g2=r=>r.pointerType==="mouse"?typeof r.button!="number"||r.button<=0:r.isPrimary!==!1,uB=new Set(["BUTTON","INPUT","SELECT","TEXTAREA","A"]);function hB(r){return uB.has(r.tagName)||r.tabIndex!==-1}const gv=new WeakSet;function gE(r){return e=>{e.key==="Enter"&&r(e)}}function yb(r,e){r.dispatchEvent(new PointerEvent("pointer"+e,{isPrimary:!0,bubbles:!0}))}const fB=(r,e)=>{const o=r.currentTarget;if(!o)return;const l=gE(()=>{if(gv.has(o))return;yb(o,"down");const h=gE(()=>{yb(o,"up")}),m=()=>yb(o,"cancel");o.addEventListener("keyup",h,e),o.addEventListener("blur",m,e)});o.addEventListener("keydown",l,e),o.addEventListener("blur",()=>o.removeEventListener("keydown",l),e)};function _E(r){return g2(r)&&!PI()}function dB(r,e,o={}){const[l,h,m]=LI(r,o),b=n=>{const C=n.currentTarget;if(!_E(n))return;gv.add(C);const D=e(C,n),L=(Z,ie)=>{window.removeEventListener("pointerup",U),window.removeEventListener("pointercancel",q),gv.has(C)&&gv.delete(C),_E(Z)&&typeof D=="function"&&D(Z,{success:ie})},U=Z=>{L(Z,C===window||C===document||o.useGlobalTarget||BI(C,Z.target))},q=Z=>{L(Z,!1)};window.addEventListener("pointerup",U,h),window.addEventListener("pointercancel",q,h)};return l.forEach(n=>{(o.useGlobalTarget?window:n).addEventListener("pointerdown",b,h),OI(n)&&(n.addEventListener("focus",D=>fB(D,h)),!hB(n)&&!n.hasAttribute("tabindex")&&(n.tabIndex=0))}),m}function zI(r){return Z3(r)&&"ownerSVGElement"in r}function pB(r){return zI(r)&&r.tagName==="svg"}const Gs=r=>!!(r&&r.getVelocity),mB=[...II,_a,fm],gB=r=>mB.find(CI(r)),_2=Xe.createContext({transformPagePoint:r=>r,isStatic:!1,reducedMotion:"never"});function yE(r,e){if(typeof r=="function")return r(e);r!=null&&(r.current=e)}function _B(...r){return e=>{let o=!1;const l=r.map(h=>{const m=yE(h,e);return!o&&typeof m=="function"&&(o=!0),m});if(o)return()=>{for(let h=0;h<l.length;h++){const m=l[h];typeof m=="function"?m():yE(r[h],null)}}}}function yB(...r){return Xe.useCallback(_B(...r),r)}class vB extends Xe.Component{getSnapshotBeforeUpdate(e){const o=this.props.childRef.current;if(o&&e.isPresent&&!this.props.isPresent){const l=o.offsetParent,h=OI(l)&&l.offsetWidth||0,m=this.props.sizeRef.current;m.height=o.offsetHeight||0,m.width=o.offsetWidth||0,m.top=o.offsetTop,m.left=o.offsetLeft,m.right=h-m.width-m.left}return null}componentDidUpdate(){}render(){return this.props.children}}function xB({children:r,isPresent:e,anchorX:o,root:l}){const h=Xe.useId(),m=Xe.useRef(null),b=Xe.useRef({width:0,height:0,top:0,left:0,right:0}),{nonce:n}=Xe.useContext(_2),C=yB(m,r?.ref);return Xe.useInsertionEffect(()=>{const{width:D,height:L,top:U,left:q,right:Z}=b.current;if(e||!m.current||!D||!L)return;const ie=o==="left"?`left: ${q}`:`right: ${Z}`;m.current.dataset.motionPopId=h;const ne=document.createElement("style");n&&(ne.nonce=n);const be=l??document.head;return be.appendChild(ne),ne.sheet&&ne.sheet.insertRule(`
          [data-motion-pop-id="${h}"] {
            position: absolute !important;
            width: ${D}px !important;
            height: ${L}px !important;
            ${ie}px !important;
            top: ${U}px !important;
          }
        `),()=>{be.contains(ne)&&be.removeChild(ne)}},[e]),rt.jsx(vB,{isPresent:e,childRef:m,sizeRef:b,children:Xe.cloneElement(r,{ref:C})})}const bB=({children:r,initial:e,isPresent:o,onExitComplete:l,custom:h,presenceAffectsLayout:m,mode:b,anchorX:n,root:C})=>{const D=Zw(wB),L=Xe.useId();let U=!0,q=Xe.useMemo(()=>(U=!1,{id:L,initial:e,isPresent:o,custom:h,onExitComplete:Z=>{D.set(Z,!0);for(const ie of D.values())if(!ie)return;l&&l()},register:Z=>(D.set(Z,!1),()=>D.delete(Z))}),[o,D,l]);return m&&U&&(q={...q}),Xe.useMemo(()=>{D.forEach((Z,ie)=>D.set(ie,!1))},[o]),Xe.useEffect(()=>{!o&&!D.size&&l&&l()},[o]),b==="popLayout"&&(r=rt.jsx(xB,{isPresent:o,anchorX:n,root:C,children:r})),rt.jsx(Uv.Provider,{value:q,children:r})};function wB(){return new Map}function FI(r=!0){const e=Xe.useContext(Uv);if(e===null)return[!0,null];const{isPresent:o,onExitComplete:l,register:h}=e,m=Xe.useId();Xe.useEffect(()=>{if(r)return h(m)},[r]);const b=Xe.useCallback(()=>r&&l&&l(m),[m,l,r]);return!o&&l?[!1,b]:[!0]}const tv=r=>r.key||"";function vE(r){const e=[];return Xe.Children.forEach(r,o=>{Xe.isValidElement(o)&&e.push(o)}),e}const SB=({children:r,custom:e,initial:o=!0,onExitComplete:l,presenceAffectsLayout:h=!0,mode:m="sync",propagate:b=!1,anchorX:n="left",root:C})=>{const[D,L]=FI(b),U=Xe.useMemo(()=>vE(r),[r]),q=b&&!D?[]:U.map(tv),Z=Xe.useRef(!0),ie=Xe.useRef(U),ne=Zw(()=>new Map),[be,ve]=Xe.useState(U),[we,Pe]=Xe.useState(U);$3(()=>{Z.current=!1,ie.current=U;for(let xt=0;xt<we.length;xt++){const Ct=tv(we[xt]);q.includes(Ct)?ne.delete(Ct):ne.get(Ct)!==!0&&ne.set(Ct,!1)}},[we,q.length,q.join("-")]);const Ze=[];if(U!==be){let xt=[...U];for(let Ct=0;Ct<we.length;Ct++){const Ft=we[Ct],Yt=tv(Ft);q.includes(Yt)||(xt.splice(Ct,0,Ft),Ze.push(Ft))}return m==="wait"&&Ze.length&&(xt=Ze),Pe(vE(xt)),ve(U),null}const{forceRender:$e}=Xe.useContext(Xw);return rt.jsx(rt.Fragment,{children:we.map(xt=>{const Ct=tv(xt),Ft=b&&!D?!1:U===we||q.includes(Ct),Yt=()=>{if(ne.has(Ct))ne.set(Ct,!0);else return;let hr=!0;ne.forEach(pr=>{pr||(hr=!1)}),hr&&($e?.(),Pe(ie.current),b&&L?.(),l&&l())};return rt.jsx(bB,{isPresent:Ft,initial:!Z.current||o?void 0:!1,custom:e,presenceAffectsLayout:h,mode:m,root:C,onExitComplete:Ft?void 0:Yt,anchorX:n,children:xt},Ct)})})},kI=Xe.createContext({strict:!1}),xE={animation:["animate","variants","whileHover","whileTap","exit","whileInView","whileFocus","whileDrag"],exit:["exit"],drag:["drag","dragControls"],focus:["whileFocus"],hover:["whileHover","onHoverStart","onHoverEnd"],tap:["whileTap","onTap","onTapStart","onTapCancel"],pan:["onPan","onPanStart","onPanSessionStart","onPanEnd"],inView:["whileInView","onViewportEnter","onViewportLeave"],layout:["layout","layoutId"]},H_={};for(const r in xE)H_[r]={isEnabled:e=>xE[r].some(o=>!!e[o])};function TB(r){for(const e in r)H_[e]={...H_[e],...r[e]}}const AB=new Set(["animate","exit","variants","initial","style","values","variants","transition","transformTemplate","custom","inherit","onBeforeLayoutMeasure","onAnimationStart","onAnimationComplete","onUpdate","onDragStart","onDrag","onDragEnd","onMeasureDragConstraints","onDirectionLock","onDragTransitionEnd","_dragX","_dragY","onHoverStart","onHoverEnd","onViewportEnter","onViewportLeave","globalTapTarget","ignoreStrict","viewport"]);function Pv(r){return r.startsWith("while")||r.startsWith("drag")&&r!=="draggable"||r.startsWith("layout")||r.startsWith("onTap")||r.startsWith("onPan")||r.startsWith("onLayout")||AB.has(r)}let NI=r=>!Pv(r);function EB(r){typeof r=="function"&&(NI=e=>e.startsWith("on")?!Pv(e):r(e))}try{EB(require("@emotion/is-prop-valid").default)}catch{}function CB(r,e,o){const l={};for(const h in r)h==="values"&&typeof r.values=="object"||(NI(h)||o===!0&&Pv(h)||!e&&!Pv(h)||r.draggable&&h.startsWith("onDrag"))&&(l[h]=r[h]);return l}const jv=Xe.createContext({});function Gv(r){return r!==null&&typeof r=="object"&&typeof r.start=="function"}function Sy(r){return typeof r=="string"||Array.isArray(r)}const y2=["animate","whileInView","whileFocus","whileHover","whileTap","whileDrag","exit"],v2=["initial",...y2];function Hv(r){return Gv(r.animate)||v2.some(e=>Sy(r[e]))}function VI(r){return!!(Hv(r)||r.variants)}function IB(r,e){if(Hv(r)){const{initial:o,animate:l}=r;return{initial:o===!1||Sy(o)?o:void 0,animate:Sy(l)?l:void 0}}return r.inherit!==!1?e:{}}function RB(r){const{initial:e,animate:o}=IB(r,Xe.useContext(jv));return Xe.useMemo(()=>({initial:e,animate:o}),[bE(e),bE(o)])}function bE(r){return Array.isArray(r)?r.join(" "):r}const Ty={};function MB(r){for(const e in r)Ty[e]=r[e],i2(e)&&(Ty[e].isCSSVariable=!0)}function UI(r,{layout:e,layoutId:o}){return K_.has(r)||r.startsWith("origin")||(e||o!==void 0)&&(!!Ty[r]||r==="opacity")}const DB={x:"translateX",y:"translateY",z:"translateZ",transformPerspective:"perspective"},OB=Q_.length;function PB(r,e,o){let l="",h=!0;for(let m=0;m<OB;m++){const b=Q_[m],n=r[b];if(n===void 0)continue;let C=!0;if(typeof n=="number"?C=n===(b.startsWith("scale")?1:0):C=parseFloat(n)===0,!C||o){const D=DI(n,p2[b]);if(!C){h=!1;const L=DB[b]||b;l+=`${L}(${D}) `}o&&(e[b]=D)}}return l=l.trim(),o?l=o(e,h?"":l):h&&(l="none"),l}function x2(r,e,o){const{style:l,vars:h,transformOrigin:m}=r;let b=!1,n=!1;for(const C in e){const D=e[C];if(K_.has(C)){b=!0;continue}else if(i2(C)){h[C]=D;continue}else{const L=DI(D,p2[C]);C.startsWith("origin")?(n=!0,m[C]=L):l[C]=L}}if(e.transform||(b||o?l.transform=PB(e,r.transform,o):l.transform&&(l.transform="none")),n){const{originX:C="50%",originY:D="50%",originZ:L=0}=m;l.transformOrigin=`${C} ${D} ${L}`}}const b2=()=>({style:{},transform:{},transformOrigin:{},vars:{}});function jI(r,e,o){for(const l in e)!Gs(e[l])&&!UI(l,o)&&(r[l]=e[l])}function LB({transformTemplate:r},e){return Xe.useMemo(()=>{const o=b2();return x2(o,e,r),Object.assign({},o.vars,o.style)},[e])}function BB(r,e){const o=r.style||{},l={};return jI(l,o,r),Object.assign(l,LB(r,e)),l}function zB(r,e){const o={},l=BB(r,e);return r.drag&&r.dragListener!==!1&&(o.draggable=!1,l.userSelect=l.WebkitUserSelect=l.WebkitTouchCallout="none",l.touchAction=r.drag===!0?"none":`pan-${r.drag==="x"?"y":"x"}`),r.tabIndex===void 0&&(r.onTap||r.onTapStart||r.whileTap)&&(o.tabIndex=0),o.style=l,o}const FB={offset:"stroke-dashoffset",array:"stroke-dasharray"},kB={offset:"strokeDashoffset",array:"strokeDasharray"};function NB(r,e,o=1,l=0,h=!0){r.pathLength=1;const m=h?FB:kB;r[m.offset]=Oi.transform(-l);const b=Oi.transform(e),n=Oi.transform(o);r[m.array]=`${b} ${n}`}function GI(r,{attrX:e,attrY:o,attrScale:l,pathLength:h,pathSpacing:m=1,pathOffset:b=0,...n},C,D,L){if(x2(r,n,D),C){r.style.viewBox&&(r.attrs.viewBox=r.style.viewBox);return}r.attrs=r.style,r.style={};const{attrs:U,style:q}=r;U.transform&&(q.transform=U.transform,delete U.transform),(q.transform||U.transformOrigin)&&(q.transformOrigin=U.transformOrigin??"50% 50%",delete U.transformOrigin),q.transform&&(q.transformBox=L?.transformBox??"fill-box",delete U.transformBox),e!==void 0&&(U.x=e),o!==void 0&&(U.y=o),l!==void 0&&(U.scale=l),h!==void 0&&NB(U,h,m,b,!1)}const HI=()=>({...b2(),attrs:{}}),qI=r=>typeof r=="string"&&r.toLowerCase()==="svg";function VB(r,e,o,l){const h=Xe.useMemo(()=>{const m=HI();return GI(m,e,qI(l),r.transformTemplate,r.style),{...m.attrs,style:{...m.style}}},[e]);if(r.style){const m={};jI(m,r.style,r),h.style={...m,...h.style}}return h}const UB=["animate","circle","defs","desc","ellipse","g","image","line","filter","marker","mask","metadata","path","pattern","polygon","polyline","rect","stop","switch","symbol","svg","text","tspan","use","view"];function w2(r){return typeof r!="string"||r.includes("-")?!1:!!(UB.indexOf(r)>-1||/[A-Z]/u.test(r))}function jB(r,e,o,{latestValues:l},h,m=!1){const n=(w2(r)?VB:zB)(e,l,h,r),C=CB(e,typeof r=="string",m),D=r!==Xe.Fragment?{...C,...n,ref:o}:{},{children:L}=e,U=Xe.useMemo(()=>Gs(L)?L.get():L,[L]);return Xe.createElement(r,{...D,children:U})}function wE(r){const e=[{},{}];return r?.values.forEach((o,l)=>{e[0][l]=o.get(),e[1][l]=o.getVelocity()}),e}function S2(r,e,o,l){if(typeof e=="function"){const[h,m]=wE(l);e=e(o!==void 0?o:r.custom,h,m)}if(typeof e=="string"&&(e=r.variants&&r.variants[e]),typeof e=="function"){const[h,m]=wE(l);e=e(o!==void 0?o:r.custom,h,m)}return e}function _v(r){return Gs(r)?r.get():r}function GB({scrapeMotionValuesFromProps:r,createRenderState:e},o,l,h){return{latestValues:HB(o,l,h,r),renderState:e()}}function HB(r,e,o,l){const h={},m=l(r,{});for(const q in m)h[q]=_v(m[q]);let{initial:b,animate:n}=r;const C=Hv(r),D=VI(r);e&&D&&!C&&r.inherit!==!1&&(b===void 0&&(b=e.initial),n===void 0&&(n=e.animate));let L=o?o.initial===!1:!1;L=L||b===!1;const U=L?n:b;if(U&&typeof U!="boolean"&&!Gv(U)){const q=Array.isArray(U)?U:[U];for(let Z=0;Z<q.length;Z++){const ie=S2(r,q[Z]);if(ie){const{transitionEnd:ne,transition:be,...ve}=ie;for(const we in ve){let Pe=ve[we];if(Array.isArray(Pe)){const Ze=L?Pe.length-1:0;Pe=Pe[Ze]}Pe!==null&&(h[we]=Pe)}for(const we in ne)h[we]=ne[we]}}}return h}const $I=r=>(e,o)=>{const l=Xe.useContext(jv),h=Xe.useContext(Uv),m=()=>GB(r,e,l,h);return o?m():Zw(m)};function T2(r,e,o){const{style:l}=r,h={};for(const m in l)(Gs(l[m])||e.style&&Gs(e.style[m])||UI(m,r)||o?.getValue(m)?.liveStyle!==void 0)&&(h[m]=l[m]);return h}const qB=$I({scrapeMotionValuesFromProps:T2,createRenderState:b2});function XI(r,e,o){const l=T2(r,e,o);for(const h in r)if(Gs(r[h])||Gs(e[h])){const m=Q_.indexOf(h)!==-1?"attr"+h.charAt(0).toUpperCase()+h.substring(1):h;l[m]=r[h]}return l}const $B=$I({scrapeMotionValuesFromProps:XI,createRenderState:HI}),XB=Symbol.for("motionComponentSymbol");function D_(r){return r&&typeof r=="object"&&Object.prototype.hasOwnProperty.call(r,"current")}function ZB(r,e,o){return Xe.useCallback(l=>{l&&r.onMount&&r.onMount(l),e&&(l?e.mount(l):e.unmount()),o&&(typeof o=="function"?o(l):D_(o)&&(o.current=l))},[e])}const A2=r=>r.replace(/([a-z])([A-Z])/gu,"$1-$2").toLowerCase(),WB="framerAppearId",ZI="data-"+A2(WB),WI=Xe.createContext({});function YB(r,e,o,l,h){const{visualElement:m}=Xe.useContext(jv),b=Xe.useContext(kI),n=Xe.useContext(Uv),C=Xe.useContext(_2).reducedMotion,D=Xe.useRef(null);l=l||b.renderer,!D.current&&l&&(D.current=l(r,{visualState:e,parent:m,props:o,presenceContext:n,blockInitialAnimation:n?n.initial===!1:!1,reducedMotionConfig:C}));const L=D.current,U=Xe.useContext(WI);L&&!L.projection&&h&&(L.type==="html"||L.type==="svg")&&QB(D.current,o,h,U);const q=Xe.useRef(!1);Xe.useInsertionEffect(()=>{L&&q.current&&L.update(o,n)});const Z=o[ZI],ie=Xe.useRef(!!Z&&!window.MotionHandoffIsComplete?.(Z)&&window.MotionHasOptimisedAnimation?.(Z));return $3(()=>{L&&(q.current=!0,window.MotionIsMounted=!0,L.updateFeatures(),L.scheduleRenderMicrotask(),ie.current&&L.animationState&&L.animationState.animateChanges())}),Xe.useEffect(()=>{L&&(!ie.current&&L.animationState&&L.animationState.animateChanges(),ie.current&&(queueMicrotask(()=>{window.MotionHandoffMarkAsComplete?.(Z)}),ie.current=!1),L.enteringChildren=void 0)}),L}function QB(r,e,o,l){const{layoutId:h,layout:m,drag:b,dragConstraints:n,layoutScroll:C,layoutRoot:D,layoutCrossfade:L}=e;r.projection=new o(r.latestValues,e["data-framer-portal-id"]?void 0:YI(r.parent)),r.projection.setOptions({layoutId:h,layout:m,alwaysMeasureLayout:!!b||n&&D_(n),visualElement:r,animationType:typeof m=="string"?m:"both",initialPromotionConfig:l,crossfade:L,layoutScroll:C,layoutRoot:D})}function YI(r){if(r)return r.options.allowProjection!==!1?r.projection:YI(r.parent)}function vb(r,{forwardMotionProps:e=!1}={},o,l){o&&TB(o);const h=w2(r)?$B:qB;function m(n,C){let D;const L={...Xe.useContext(_2),...n,layoutId:KB(n)},{isStatic:U}=L,q=RB(n),Z=h(n,U);if(!U&&Ww){JB();const ie=ez(L);D=ie.MeasureLayout,q.visualElement=YB(r,Z,L,l,ie.ProjectionNode)}return rt.jsxs(jv.Provider,{value:q,children:[D&&q.visualElement?rt.jsx(D,{visualElement:q.visualElement,...L}):null,jB(r,n,ZB(Z,q.visualElement,C),Z,U,e)]})}m.displayName=`motion.${typeof r=="string"?r:`create(${r.displayName??r.name??""})`}`;const b=Xe.forwardRef(m);return b[XB]=r,b}function KB({layoutId:r}){const e=Xe.useContext(Xw).id;return e&&r!==void 0?e+"-"+r:r}function JB(r,e){Xe.useContext(kI).strict}function ez(r){const{drag:e,layout:o}=H_;if(!e&&!o)return{};const l={...e,...o};return{MeasureLayout:e?.isEnabled(r)||o?.isEnabled(r)?l.MeasureLayout:void 0,ProjectionNode:l.ProjectionNode}}function tz(r,e){if(typeof Proxy>"u")return vb;const o=new Map,l=(m,b)=>vb(m,b,r,e),h=(m,b)=>l(m,b);return new Proxy(h,{get:(m,b)=>b==="create"?l:(o.has(b)||o.set(b,vb(b,void 0,r,e)),o.get(b))})}function QI({top:r,left:e,right:o,bottom:l}){return{x:{min:e,max:o},y:{min:r,max:l}}}function rz({x:r,y:e}){return{top:e.min,right:r.max,bottom:e.max,left:r.min}}function iz(r,e){if(!e)return r;const o=e({x:r.left,y:r.top}),l=e({x:r.right,y:r.bottom});return{top:o.y,left:o.x,bottom:l.y,right:l.x}}function xb(r){return r===void 0||r===1}function uw({scale:r,scaleX:e,scaleY:o}){return!xb(r)||!xb(e)||!xb(o)}function dg(r){return uw(r)||KI(r)||r.z||r.rotate||r.rotateX||r.rotateY||r.skewX||r.skewY}function KI(r){return SE(r.x)||SE(r.y)}function SE(r){return r&&r!=="0%"}function Lv(r,e,o){const l=r-o,h=e*l;return o+h}function TE(r,e,o,l,h){return h!==void 0&&(r=Lv(r,h,l)),Lv(r,o,l)+e}function hw(r,e=0,o=1,l,h){r.min=TE(r.min,e,o,l,h),r.max=TE(r.max,e,o,l,h)}function JI(r,{x:e,y:o}){hw(r.x,e.translate,e.scale,e.originPoint),hw(r.y,o.translate,o.scale,o.originPoint)}const AE=.999999999999,EE=1.0000000000001;function nz(r,e,o,l=!1){const h=o.length;if(!h)return;e.x=e.y=1;let m,b;for(let n=0;n<h;n++){m=o[n],b=m.projectionDelta;const{visualElement:C}=m.options;C&&C.props.style&&C.props.style.display==="contents"||(l&&m.options.layoutScroll&&m.scroll&&m!==m.root&&P_(r,{x:-m.scroll.offset.x,y:-m.scroll.offset.y}),b&&(e.x*=b.x.scale,e.y*=b.y.scale,JI(r,b)),l&&dg(m.latestValues)&&P_(r,m.latestValues))}e.x<EE&&e.x>AE&&(e.x=1),e.y<EE&&e.y>AE&&(e.y=1)}function O_(r,e){r.min=r.min+e,r.max=r.max+e}function CE(r,e,o,l,h=.5){const m=Fo(r.min,r.max,h);hw(r,e,o,m,l)}function P_(r,e){CE(r.x,e.x,e.scaleX,e.scale,e.originX),CE(r.y,e.y,e.scaleY,e.scale,e.originY)}function eR(r,e){return QI(iz(r.getBoundingClientRect(),e))}function oz(r,e,o){const l=eR(r,o),{scroll:h}=e;return h&&(O_(l.x,h.offset.x),O_(l.y,h.offset.y)),l}const IE=()=>({translate:0,scale:1,origin:0,originPoint:0}),L_=()=>({x:IE(),y:IE()}),RE=()=>({min:0,max:0}),ia=()=>({x:RE(),y:RE()}),fw={current:null},tR={current:!1};function az(){if(tR.current=!0,!!Ww)if(window.matchMedia){const r=window.matchMedia("(prefers-reduced-motion)"),e=()=>fw.current=r.matches;r.addEventListener("change",e),e()}else fw.current=!1}const sz=new WeakMap;function lz(r,e,o){for(const l in e){const h=e[l],m=o[l];if(Gs(h))r.addValue(l,h);else if(Gs(m))r.addValue(l,G_(h,{owner:r}));else if(m!==h)if(r.hasValue(l)){const b=r.getValue(l);b.liveStyle===!0?b.jump(h):b.hasAnimated||b.set(h)}else{const b=r.getStaticValue(l);r.addValue(l,G_(b!==void 0?b:h,{owner:r}))}}for(const l in o)e[l]===void 0&&r.removeValue(l);return e}const ME=["AnimationStart","AnimationComplete","Update","BeforeLayoutMeasure","LayoutMeasure","LayoutAnimationStart","LayoutAnimationComplete"];class cz{scrapeMotionValuesFromProps(e,o,l){return{}}constructor({parent:e,props:o,presenceContext:l,reducedMotionConfig:h,blockInitialAnimation:m,visualState:b},n={}){this.current=null,this.children=new Set,this.isVariantNode=!1,this.isControllingVariants=!1,this.shouldReduceMotion=null,this.values=new Map,this.KeyframeResolver=f2,this.features={},this.valueSubscriptions=new Map,this.prevMotionValues={},this.events={},this.propEventSubscriptions={},this.notifyUpdate=()=>this.notify("Update",this.latestValues),this.render=()=>{this.current&&(this.triggerBuild(),this.renderInstance(this.current,this.renderState,this.props.style,this.projection))},this.renderScheduledAt=0,this.scheduleRender=()=>{const q=$l.now();this.renderScheduledAt<q&&(this.renderScheduledAt=q,Co.render(this.render,!1,!0))};const{latestValues:C,renderState:D}=b;this.latestValues=C,this.baseTarget={...C},this.initialValues=o.initial?{...C}:{},this.renderState=D,this.parent=e,this.props=o,this.presenceContext=l,this.depth=e?e.depth+1:0,this.reducedMotionConfig=h,this.options=n,this.blockInitialAnimation=!!m,this.isControllingVariants=Hv(o),this.isVariantNode=VI(o),this.isVariantNode&&(this.variantChildren=new Set),this.manuallyAnimateOnMount=!!(e&&e.current);const{willChange:L,...U}=this.scrapeMotionValuesFromProps(o,{},this);for(const q in U){const Z=U[q];C[q]!==void 0&&Gs(Z)&&Z.set(C[q])}}mount(e){this.current=e,sz.set(e,this),this.projection&&!this.projection.instance&&this.projection.mount(e),this.parent&&this.isVariantNode&&!this.isControllingVariants&&(this.removeFromVariantTree=this.parent.addVariantChild(this)),this.values.forEach((o,l)=>this.bindToMotionValue(l,o)),tR.current||az(),this.shouldReduceMotion=this.reducedMotionConfig==="never"?!1:this.reducedMotionConfig==="always"?!0:fw.current,this.parent?.addChild(this),this.update(this.props,this.presenceContext)}unmount(){this.projection&&this.projection.unmount(),hm(this.notifyUpdate),hm(this.render),this.valueSubscriptions.forEach(e=>e()),this.valueSubscriptions.clear(),this.removeFromVariantTree&&this.removeFromVariantTree(),this.parent?.removeChild(this);for(const e in this.events)this.events[e].clear();for(const e in this.features){const o=this.features[e];o&&(o.unmount(),o.isMounted=!1)}this.current=null}addChild(e){this.children.add(e),this.enteringChildren??(this.enteringChildren=new Set),this.enteringChildren.add(e)}removeChild(e){this.children.delete(e),this.enteringChildren&&this.enteringChildren.delete(e)}bindToMotionValue(e,o){this.valueSubscriptions.has(e)&&this.valueSubscriptions.get(e)();const l=K_.has(e);l&&this.onBindTransform&&this.onBindTransform();const h=o.on("change",b=>{this.latestValues[e]=b,this.props.onUpdate&&Co.preRender(this.notifyUpdate),l&&this.projection&&(this.projection.isTransformDirty=!0),this.scheduleRender()});let m;window.MotionCheckAppearSync&&(m=window.MotionCheckAppearSync(this,e,o)),this.valueSubscriptions.set(e,()=>{h(),m&&m(),o.owner&&o.stop()})}sortNodePosition(e){return!this.current||!this.sortInstanceNodePosition||this.type!==e.type?0:this.sortInstanceNodePosition(this.current,e.current)}updateFeatures(){let e="animation";for(e in H_){const o=H_[e];if(!o)continue;const{isEnabled:l,Feature:h}=o;if(!this.features[e]&&h&&l(this.props)&&(this.features[e]=new h(this)),this.features[e]){const m=this.features[e];m.isMounted?m.update():(m.mount(),m.isMounted=!0)}}}triggerBuild(){this.build(this.renderState,this.latestValues,this.props)}measureViewportBox(){return this.current?this.measureInstanceViewportBox(this.current,this.props):ia()}getStaticValue(e){return this.latestValues[e]}setStaticValue(e,o){this.latestValues[e]=o}update(e,o){(e.transformTemplate||this.props.transformTemplate)&&this.scheduleRender(),this.prevProps=this.props,this.props=e,this.prevPresenceContext=this.presenceContext,this.presenceContext=o;for(let l=0;l<ME.length;l++){const h=ME[l];this.propEventSubscriptions[h]&&(this.propEventSubscriptions[h](),delete this.propEventSubscriptions[h]);const m="on"+h,b=e[m];b&&(this.propEventSubscriptions[h]=this.on(h,b))}this.prevMotionValues=lz(this,this.scrapeMotionValuesFromProps(e,this.prevProps,this),this.prevMotionValues),this.handleChildMotionValue&&this.handleChildMotionValue()}getProps(){return this.props}getVariant(e){return this.props.variants?this.props.variants[e]:void 0}getDefaultTransition(){return this.props.transition}getTransformPagePoint(){return this.props.transformPagePoint}getClosestVariantNode(){return this.isVariantNode?this:this.parent?this.parent.getClosestVariantNode():void 0}addVariantChild(e){const o=this.getClosestVariantNode();if(o)return o.variantChildren&&o.variantChildren.add(e),()=>o.variantChildren.delete(e)}addValue(e,o){const l=this.values.get(e);o!==l&&(l&&this.removeValue(e),this.bindToMotionValue(e,o),this.values.set(e,o),this.latestValues[e]=o.get())}removeValue(e){this.values.delete(e);const o=this.valueSubscriptions.get(e);o&&(o(),this.valueSubscriptions.delete(e)),delete this.latestValues[e],this.removeValueFromRenderState(e,this.renderState)}hasValue(e){return this.values.has(e)}getValue(e,o){if(this.props.values&&this.props.values[e])return this.props.values[e];let l=this.values.get(e);return l===void 0&&o!==void 0&&(l=G_(o===null?void 0:o,{owner:this}),this.addValue(e,l)),l}readValue(e,o){let l=this.latestValues[e]!==void 0||!this.current?this.latestValues[e]:this.getBaseTargetFromProps(this.props,e)??this.readValueFromInstance(this.current,e,this.options);return l!=null&&(typeof l=="string"&&(X3(l)||W3(l))?l=parseFloat(l):!gB(l)&&fm.test(o)&&(l=MI(e,o)),this.setBaseTarget(e,Gs(l)?l.get():l)),Gs(l)?l.get():l}setBaseTarget(e,o){this.baseTarget[e]=o}getBaseTarget(e){const{initial:o}=this.props;let l;if(typeof o=="string"||typeof o=="object"){const m=S2(this.props,o,this.presenceContext?.custom);m&&(l=m[e])}if(o&&l!==void 0)return l;const h=this.getBaseTargetFromProps(this.props,e);return h!==void 0&&!Gs(h)?h:this.initialValues[e]!==void 0&&l===void 0?void 0:this.baseTarget[e]}on(e,o){return this.events[e]||(this.events[e]=new e2),this.events[e].add(o)}notify(e,...o){this.events[e]&&this.events[e].notify(...o)}scheduleRenderMicrotask(){m2.render(this.render)}}class rR extends cz{constructor(){super(...arguments),this.KeyframeResolver=nB}sortInstanceNodePosition(e,o){return e.compareDocumentPosition(o)&2?1:-1}getBaseTargetFromProps(e,o){return e.style?e.style[o]:void 0}removeValueFromRenderState(e,{vars:o,style:l}){delete o[e],delete l[e]}handleChildMotionValue(){this.childSubscription&&(this.childSubscription(),delete this.childSubscription);const{children:e}=this.props;Gs(e)&&(this.childSubscription=e.on("change",o=>{this.current&&(this.current.textContent=`${o}`)}))}}function iR(r,{style:e,vars:o},l,h){const m=r.style;let b;for(b in e)m[b]=e[b];h?.applyProjectionStyles(m,l);for(b in o)m.setProperty(b,o[b])}function uz(r){return window.getComputedStyle(r)}class hz extends rR{constructor(){super(...arguments),this.type="html",this.renderInstance=iR}readValueFromInstance(e,o){if(K_.has(o))return this.projection?.isProjecting?iw(o):S6(e,o);{const l=uz(e),h=(i2(o)?l.getPropertyValue(o):l[o])||0;return typeof h=="string"?h.trim():h}}measureInstanceViewportBox(e,{transformPagePoint:o}){return eR(e,o)}build(e,o,l){x2(e,o,l.transformTemplate)}scrapeMotionValuesFromProps(e,o,l){return T2(e,o,l)}}const nR=new Set(["baseFrequency","diffuseConstant","kernelMatrix","kernelUnitLength","keySplines","keyTimes","limitingConeAngle","markerHeight","markerWidth","numOctaves","targetX","targetY","surfaceScale","specularConstant","specularExponent","stdDeviation","tableValues","viewBox","gradientTransform","pathLength","startOffset","textLength","lengthAdjust"]);function fz(r,e,o,l){iR(r,e,void 0,l);for(const h in e.attrs)r.setAttribute(nR.has(h)?h:A2(h),e.attrs[h])}class dz extends rR{constructor(){super(...arguments),this.type="svg",this.isSVGTag=!1,this.measureInstanceViewportBox=ia}getBaseTargetFromProps(e,o){return e[o]}readValueFromInstance(e,o){if(K_.has(o)){const l=RI(o);return l&&l.default||0}return o=nR.has(o)?o:A2(o),e.getAttribute(o)}scrapeMotionValuesFromProps(e,o,l){return XI(e,o,l)}build(e,o,l){GI(e,o,this.isSVGTag,l.transformTemplate,l.style)}renderInstance(e,o,l,h){fz(e,o,l,h)}mount(e){this.isSVGTag=qI(e.tagName),super.mount(e)}}const pz=(r,e)=>w2(r)?new dz(e):new hz(e,{allowProjection:r!==Xe.Fragment});function V_(r,e,o){const l=r.getProps();return S2(l,e,o!==void 0?o:l.custom,r)}const dw=r=>Array.isArray(r);function mz(r,e,o){r.hasValue(e)?r.getValue(e).set(o):r.addValue(e,G_(o))}function gz(r){return dw(r)?r[r.length-1]||0:r}function _z(r,e){const o=V_(r,e);let{transitionEnd:l={},transition:h={},...m}=o||{};m={...m,...l};for(const b in m){const n=gz(m[b]);mz(r,b,n)}}function yz(r){return!!(Gs(r)&&r.add)}function pw(r,e){const o=r.getValue("willChange");if(yz(o))return o.add(e);if(!o&&Nd.WillChange){const l=new Nd.WillChange("auto");r.addValue("willChange",l),l.add(e)}}function oR(r){return r.props[ZI]}const vz=r=>r!==null;function xz(r,{repeat:e,repeatType:o="loop"},l){const h=r.filter(vz),m=e&&o!=="loop"&&e%2===1?0:h.length-1;return h[m]}const bz={type:"spring",stiffness:500,damping:25,restSpeed:10},wz=r=>({type:"spring",stiffness:550,damping:r===0?2*Math.sqrt(550):30,restSpeed:10}),Sz={type:"keyframes",duration:.8},Tz={type:"keyframes",ease:[.25,.1,.35,1],duration:.3},Az=(r,{keyframes:e})=>e.length>2?Sz:K_.has(r)?r.startsWith("scale")?wz(e[1]):bz:Tz;function Ez({when:r,delay:e,delayChildren:o,staggerChildren:l,staggerDirection:h,repeat:m,repeatType:b,repeatDelay:n,from:C,elapsed:D,...L}){return!!Object.keys(L).length}const E2=(r,e,o,l={},h,m)=>b=>{const n=d2(l,r)||{},C=n.delay||l.delay||0;let{elapsed:D=0}=l;D=D-Af(C);const L={keyframes:Array.isArray(o)?o:[null,o],ease:"easeOut",velocity:e.getVelocity(),...n,delay:-D,onUpdate:q=>{e.set(q),n.onUpdate&&n.onUpdate(q)},onComplete:()=>{b(),n.onComplete&&n.onComplete()},name:r,motionValue:e,element:m?void 0:h};Ez(n)||Object.assign(L,Az(r,L)),L.duration&&(L.duration=Af(L.duration)),L.repeatDelay&&(L.repeatDelay=Af(L.repeatDelay)),L.from!==void 0&&(L.keyframes[0]=L.from);let U=!1;if((L.type===!1||L.duration===0&&!L.repeatDelay)&&(lw(L),L.delay===0&&(U=!0)),(Nd.instantAnimations||Nd.skipAnimations)&&(U=!0,lw(L),L.delay=0),L.allowFlatten=!n.type&&!n.ease,U&&!m&&e.get()!==void 0){const q=xz(L.keyframes,n);if(q!==void 0){Co.update(()=>{L.onUpdate(q),L.onComplete()});return}}return n.isSync?new h2(L):new $6(L)};function Cz({protectedKeys:r,needsAnimating:e},o){const l=r.hasOwnProperty(o)&&e[o]!==!0;return e[o]=!1,l}function aR(r,e,{delay:o=0,transitionOverride:l,type:h}={}){let{transition:m=r.getDefaultTransition(),transitionEnd:b,...n}=e;l&&(m=l);const C=[],D=h&&r.animationState&&r.animationState.getState()[h];for(const L in n){const U=r.getValue(L,r.latestValues[L]??null),q=n[L];if(q===void 0||D&&Cz(D,L))continue;const Z={delay:o,...d2(m||{},L)},ie=U.get();if(ie!==void 0&&!U.isAnimating&&!Array.isArray(q)&&q===ie&&!Z.velocity)continue;let ne=!1;if(window.MotionHandoffAnimation){const ve=oR(r);if(ve){const we=window.MotionHandoffAnimation(ve,L,Co);we!==null&&(Z.startTime=we,ne=!0)}}pw(r,L),U.start(E2(L,U,q,r.shouldReduceMotion&&EI.has(L)?{type:!1}:Z,r,ne));const be=U.animation;be&&C.push(be)}return b&&Promise.all(C).then(()=>{Co.update(()=>{b&&_z(r,b)})}),C}function sR(r,e,o,l=0,h=1){const m=Array.from(r).sort((D,L)=>D.sortNodePosition(L)).indexOf(e),b=r.size,n=(b-1)*l;return typeof o=="function"?o(m,b):h===1?m*l:n-m*l}function mw(r,e,o={}){const l=V_(r,e,o.type==="exit"?r.presenceContext?.custom:void 0);let{transition:h=r.getDefaultTransition()||{}}=l||{};o.transitionOverride&&(h=o.transitionOverride);const m=l?()=>Promise.all(aR(r,l,o)):()=>Promise.resolve(),b=r.variantChildren&&r.variantChildren.size?(C=0)=>{const{delayChildren:D=0,staggerChildren:L,staggerDirection:U}=h;return Iz(r,e,C,D,L,U,o)}:()=>Promise.resolve(),{when:n}=h;if(n){const[C,D]=n==="beforeChildren"?[m,b]:[b,m];return C().then(()=>D())}else return Promise.all([m(),b(o.delay)])}function Iz(r,e,o=0,l=0,h=0,m=1,b){const n=[];for(const C of r.variantChildren)C.notify("AnimationStart",e),n.push(mw(C,e,{...b,delay:o+(typeof l=="function"?0:l)+sR(r.variantChildren,C,l,h,m)}).then(()=>C.notify("AnimationComplete",e)));return Promise.all(n)}function Rz(r,e,o={}){r.notify("AnimationStart",e);let l;if(Array.isArray(e)){const h=e.map(m=>mw(r,m,o));l=Promise.all(h)}else if(typeof e=="string")l=mw(r,e,o);else{const h=typeof e=="function"?V_(r,e,o.custom):e;l=Promise.all(aR(r,h,o))}return l.then(()=>{r.notify("AnimationComplete",e)})}function lR(r,e){if(!Array.isArray(e))return!1;const o=e.length;if(o!==r.length)return!1;for(let l=0;l<o;l++)if(e[l]!==r[l])return!1;return!0}const Mz=v2.length;function cR(r){if(!r)return;if(!r.isControllingVariants){const o=r.parent?cR(r.parent)||{}:{};return r.props.initial!==void 0&&(o.initial=r.props.initial),o}const e={};for(let o=0;o<Mz;o++){const l=v2[o],h=r.props[l];(Sy(h)||h===!1)&&(e[l]=h)}return e}const Dz=[...y2].reverse(),Oz=y2.length;function Pz(r){return e=>Promise.all(e.map(({animation:o,options:l})=>Rz(r,o,l)))}function Lz(r){let e=Pz(r),o=DE(),l=!0;const h=C=>(D,L)=>{const U=V_(r,L,C==="exit"?r.presenceContext?.custom:void 0);if(U){const{transition:q,transitionEnd:Z,...ie}=U;D={...D,...ie,...Z}}return D};function m(C){e=C(r)}function b(C){const{props:D}=r,L=cR(r.parent)||{},U=[],q=new Set;let Z={},ie=1/0;for(let be=0;be<Oz;be++){const ve=Dz[be],we=o[ve],Pe=D[ve]!==void 0?D[ve]:L[ve],Ze=Sy(Pe),$e=ve===C?we.isActive:null;$e===!1&&(ie=be);let xt=Pe===L[ve]&&Pe!==D[ve]&&Ze;if(xt&&l&&r.manuallyAnimateOnMount&&(xt=!1),we.protectedKeys={...Z},!we.isActive&&$e===null||!Pe&&!we.prevProp||Gv(Pe)||typeof Pe=="boolean")continue;const Ct=Bz(we.prevProp,Pe);let Ft=Ct||ve===C&&we.isActive&&!xt&&Ze||be>ie&&Ze,Yt=!1;const hr=Array.isArray(Pe)?Pe:[Pe];let pr=hr.reduce(h(ve),{});$e===!1&&(pr={});const{prevResolvedValues:Kr={}}=we,ui={...Kr,...pr},zi=sr=>{Ft=!0,q.has(sr)&&(Yt=!0,q.delete(sr)),we.needsAnimating[sr]=!0;const Fr=r.getValue(sr);Fr&&(Fr.liveStyle=!1)};for(const sr in ui){const Fr=pr[sr],Pi=Kr[sr];if(Z.hasOwnProperty(sr))continue;let it=!1;dw(Fr)&&dw(Pi)?it=!lR(Fr,Pi):it=Fr!==Pi,it?Fr!=null?zi(sr):q.add(sr):Fr!==void 0&&q.has(sr)?zi(sr):we.protectedKeys[sr]=!0}we.prevProp=Pe,we.prevResolvedValues=pr,we.isActive&&(Z={...Z,...pr}),l&&r.blockInitialAnimation&&(Ft=!1);const Qr=xt&&Ct;Ft&&(!Qr||Yt)&&U.push(...hr.map(sr=>{const Fr={type:ve};if(typeof sr=="string"&&l&&!Qr&&r.manuallyAnimateOnMount&&r.parent){const{parent:Pi}=r,it=V_(Pi,sr);if(Pi.enteringChildren&&it){const{delayChildren:Vt}=it.transition||{};Fr.delay=sR(Pi.enteringChildren,r,Vt)}}return{animation:sr,options:Fr}}))}if(q.size){const be={};if(typeof D.initial!="boolean"){const ve=V_(r,Array.isArray(D.initial)?D.initial[0]:D.initial);ve&&ve.transition&&(be.transition=ve.transition)}q.forEach(ve=>{const we=r.getBaseTarget(ve),Pe=r.getValue(ve);Pe&&(Pe.liveStyle=!0),be[ve]=we??null}),U.push({animation:be})}let ne=!!U.length;return l&&(D.initial===!1||D.initial===D.animate)&&!r.manuallyAnimateOnMount&&(ne=!1),l=!1,ne?e(U):Promise.resolve()}function n(C,D){if(o[C].isActive===D)return Promise.resolve();r.variantChildren?.forEach(U=>U.animationState?.setActive(C,D)),o[C].isActive=D;const L=b(C);for(const U in o)o[U].protectedKeys={};return L}return{animateChanges:b,setActive:n,setAnimateFunction:m,getState:()=>o,reset:()=>{o=DE(),l=!0}}}function Bz(r,e){return typeof e=="string"?e!==r:Array.isArray(e)?!lR(e,r):!1}function ug(r=!1){return{isActive:r,protectedKeys:{},needsAnimating:{},prevResolvedValues:{}}}function DE(){return{animate:ug(!0),whileInView:ug(),whileHover:ug(),whileTap:ug(),whileDrag:ug(),whileFocus:ug(),exit:ug()}}class dm{constructor(e){this.isMounted=!1,this.node=e}update(){}}class zz extends dm{constructor(e){super(e),e.animationState||(e.animationState=Lz(e))}updateAnimationControlsSubscription(){const{animate:e}=this.node.getProps();Gv(e)&&(this.unmountControls=e.subscribe(this.node))}mount(){this.updateAnimationControlsSubscription()}update(){const{animate:e}=this.node.getProps(),{animate:o}=this.node.prevProps||{};e!==o&&this.updateAnimationControlsSubscription()}unmount(){this.node.animationState.reset(),this.unmountControls?.()}}let Fz=0;class kz extends dm{constructor(){super(...arguments),this.id=Fz++}update(){if(!this.node.presenceContext)return;const{isPresent:e,onExitComplete:o}=this.node.presenceContext,{isPresent:l}=this.node.prevPresenceContext||{};if(!this.node.animationState||e===l)return;const h=this.node.animationState.setActive("exit",!e);o&&!e&&h.then(()=>{o(this.id)})}mount(){const{register:e,onExitComplete:o}=this.node.presenceContext||{};o&&o(this.id),e&&(this.unmount=e(this.id))}unmount(){}}const Nz={animation:{Feature:zz},exit:{Feature:kz}};function Ay(r,e,o,l={passive:!0}){return r.addEventListener(e,o,l),()=>r.removeEventListener(e,o)}function Ly(r){return{point:{x:r.pageX,y:r.pageY}}}const Vz=r=>e=>g2(e)&&r(e,Ly(e));function hy(r,e,o,l){return Ay(r,e,Vz(o),l)}const uR=1e-4,Uz=1-uR,jz=1+uR,hR=.01,Gz=0-hR,Hz=0+hR;function ml(r){return r.max-r.min}function qz(r,e,o){return Math.abs(r-e)<=o}function OE(r,e,o,l=.5){r.origin=l,r.originPoint=Fo(e.min,e.max,r.origin),r.scale=ml(o)/ml(e),r.translate=Fo(o.min,o.max,r.origin)-r.originPoint,(r.scale>=Uz&&r.scale<=jz||isNaN(r.scale))&&(r.scale=1),(r.translate>=Gz&&r.translate<=Hz||isNaN(r.translate))&&(r.translate=0)}function fy(r,e,o,l){OE(r.x,e.x,o.x,l?l.originX:void 0),OE(r.y,e.y,o.y,l?l.originY:void 0)}function PE(r,e,o){r.min=o.min+e.min,r.max=r.min+ml(e)}function $z(r,e,o){PE(r.x,e.x,o.x),PE(r.y,e.y,o.y)}function LE(r,e,o){r.min=e.min-o.min,r.max=r.min+ml(e)}function dy(r,e,o){LE(r.x,e.x,o.x),LE(r.y,e.y,o.y)}function Iu(r){return[r("x"),r("y")]}const fR=({current:r})=>r?r.ownerDocument.defaultView:null,BE=(r,e)=>Math.abs(r-e);function Xz(r,e){const o=BE(r.x,e.x),l=BE(r.y,e.y);return Math.sqrt(o**2+l**2)}class dR{constructor(e,o,{transformPagePoint:l,contextWindow:h=window,dragSnapToOrigin:m=!1,distanceThreshold:b=3}={}){if(this.startEvent=null,this.lastMoveEvent=null,this.lastMoveEventInfo=null,this.handlers={},this.contextWindow=window,this.updatePoint=()=>{if(!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const q=wb(this.lastMoveEventInfo,this.history),Z=this.startEvent!==null,ie=Xz(q.offset,{x:0,y:0})>=this.distanceThreshold;if(!Z&&!ie)return;const{point:ne}=q,{timestamp:be}=ps;this.history.push({...ne,timestamp:be});const{onStart:ve,onMove:we}=this.handlers;Z||(ve&&ve(this.lastMoveEvent,q),this.startEvent=this.lastMoveEvent),we&&we(this.lastMoveEvent,q)},this.handlePointerMove=(q,Z)=>{this.lastMoveEvent=q,this.lastMoveEventInfo=bb(Z,this.transformPagePoint),Co.update(this.updatePoint,!0)},this.handlePointerUp=(q,Z)=>{this.end();const{onEnd:ie,onSessionEnd:ne,resumeAnimation:be}=this.handlers;if(this.dragSnapToOrigin&&be&&be(),!(this.lastMoveEvent&&this.lastMoveEventInfo))return;const ve=wb(q.type==="pointercancel"?this.lastMoveEventInfo:bb(Z,this.transformPagePoint),this.history);this.startEvent&&ie&&ie(q,ve),ne&&ne(q,ve)},!g2(e))return;this.dragSnapToOrigin=m,this.handlers=o,this.transformPagePoint=l,this.distanceThreshold=b,this.contextWindow=h||window;const n=Ly(e),C=bb(n,this.transformPagePoint),{point:D}=C,{timestamp:L}=ps;this.history=[{...D,timestamp:L}];const{onSessionStart:U}=o;U&&U(e,wb(C,this.history)),this.removeListeners=Dy(hy(this.contextWindow,"pointermove",this.handlePointerMove),hy(this.contextWindow,"pointerup",this.handlePointerUp),hy(this.contextWindow,"pointercancel",this.handlePointerUp))}updateHandlers(e){this.handlers=e}end(){this.removeListeners&&this.removeListeners(),hm(this.updatePoint)}}function bb(r,e){return e?{point:e(r.point)}:r}function zE(r,e){return{x:r.x-e.x,y:r.y-e.y}}function wb({point:r},e){return{point:r,delta:zE(r,pR(e)),offset:zE(r,Zz(e)),velocity:Wz(e,.1)}}function Zz(r){return r[0]}function pR(r){return r[r.length-1]}function Wz(r,e){if(r.length<2)return{x:0,y:0};let o=r.length-1,l=null;const h=pR(r);for(;o>=0&&(l=r[o],!(h.timestamp-l.timestamp>Af(e)));)o--;if(!l)return{x:0,y:0};const m=Ou(h.timestamp-l.timestamp);if(m===0)return{x:0,y:0};const b={x:(h.x-l.x)/m,y:(h.y-l.y)/m};return b.x===1/0&&(b.x=0),b.y===1/0&&(b.y=0),b}function Yz(r,{min:e,max:o},l){return e!==void 0&&r<e?r=l?Fo(e,r,l.min):Math.max(r,e):o!==void 0&&r>o&&(r=l?Fo(o,r,l.max):Math.min(r,o)),r}function FE(r,e,o){return{min:e!==void 0?r.min+e:void 0,max:o!==void 0?r.max+o-(r.max-r.min):void 0}}function Qz(r,{top:e,left:o,bottom:l,right:h}){return{x:FE(r.x,o,h),y:FE(r.y,e,l)}}function kE(r,e){let o=e.min-r.min,l=e.max-r.max;return e.max-e.min<r.max-r.min&&([o,l]=[l,o]),{min:o,max:l}}function Kz(r,e){return{x:kE(r.x,e.x),y:kE(r.y,e.y)}}function Jz(r,e){let o=.5;const l=ml(r),h=ml(e);return h>l?o=xy(e.min,e.max-l,r.min):l>h&&(o=xy(r.min,r.max-h,e.min)),kd(0,1,o)}function e8(r,e){const o={};return e.min!==void 0&&(o.min=e.min-r.min),e.max!==void 0&&(o.max=e.max-r.min),o}const gw=.35;function t8(r=gw){return r===!1?r=0:r===!0&&(r=gw),{x:NE(r,"left","right"),y:NE(r,"top","bottom")}}function NE(r,e,o){return{min:VE(r,e),max:VE(r,o)}}function VE(r,e){return typeof r=="number"?r:r[e]||0}const r8=new WeakMap;class i8{constructor(e){this.openDragLock=null,this.isDragging=!1,this.currentDirection=null,this.originPoint={x:0,y:0},this.constraints=!1,this.hasMutatedConstraints=!1,this.elastic=ia(),this.latestPointerEvent=null,this.latestPanInfo=null,this.visualElement=e}start(e,{snapToCursor:o=!1,distanceThreshold:l}={}){const{presenceContext:h}=this.visualElement;if(h&&h.isPresent===!1)return;const m=U=>{const{dragSnapToOrigin:q}=this.getProps();q?this.pauseAnimation():this.stopAnimation(),o&&this.snapToCursor(Ly(U).point)},b=(U,q)=>{const{drag:Z,dragPropagation:ie,onDragStart:ne}=this.getProps();if(Z&&!ie&&(this.openDragLock&&this.openDragLock(),this.openDragLock=lB(Z),!this.openDragLock))return;this.latestPointerEvent=U,this.latestPanInfo=q,this.isDragging=!0,this.currentDirection=null,this.resolveConstraints(),this.visualElement.projection&&(this.visualElement.projection.isAnimationBlocked=!0,this.visualElement.projection.target=void 0),Iu(ve=>{let we=this.getAxisMotionValue(ve).get()||0;if(Ef.test(we)){const{projection:Pe}=this.visualElement;if(Pe&&Pe.layout){const Ze=Pe.layout.layoutBox[ve];Ze&&(we=ml(Ze)*(parseFloat(we)/100))}}this.originPoint[ve]=we}),ne&&Co.postRender(()=>ne(U,q)),pw(this.visualElement,"transform");const{animationState:be}=this.visualElement;be&&be.setActive("whileDrag",!0)},n=(U,q)=>{this.latestPointerEvent=U,this.latestPanInfo=q;const{dragPropagation:Z,dragDirectionLock:ie,onDirectionLock:ne,onDrag:be}=this.getProps();if(!Z&&!this.openDragLock)return;const{offset:ve}=q;if(ie&&this.currentDirection===null){this.currentDirection=n8(ve),this.currentDirection!==null&&ne&&ne(this.currentDirection);return}this.updateAxis("x",q.point,ve),this.updateAxis("y",q.point,ve),this.visualElement.render(),be&&be(U,q)},C=(U,q)=>{this.latestPointerEvent=U,this.latestPanInfo=q,this.stop(U,q),this.latestPointerEvent=null,this.latestPanInfo=null},D=()=>Iu(U=>this.getAnimationState(U)==="paused"&&this.getAxisMotionValue(U).animation?.play()),{dragSnapToOrigin:L}=this.getProps();this.panSession=new dR(e,{onSessionStart:m,onStart:b,onMove:n,onSessionEnd:C,resumeAnimation:D},{transformPagePoint:this.visualElement.getTransformPagePoint(),dragSnapToOrigin:L,distanceThreshold:l,contextWindow:fR(this.visualElement)})}stop(e,o){const l=e||this.latestPointerEvent,h=o||this.latestPanInfo,m=this.isDragging;if(this.cancel(),!m||!h||!l)return;const{velocity:b}=h;this.startAnimation(b);const{onDragEnd:n}=this.getProps();n&&Co.postRender(()=>n(l,h))}cancel(){this.isDragging=!1;const{projection:e,animationState:o}=this.visualElement;e&&(e.isAnimationBlocked=!1),this.panSession&&this.panSession.end(),this.panSession=void 0;const{dragPropagation:l}=this.getProps();!l&&this.openDragLock&&(this.openDragLock(),this.openDragLock=null),o&&o.setActive("whileDrag",!1)}updateAxis(e,o,l){const{drag:h}=this.getProps();if(!l||!rv(e,h,this.currentDirection))return;const m=this.getAxisMotionValue(e);let b=this.originPoint[e]+l[e];this.constraints&&this.constraints[e]&&(b=Yz(b,this.constraints[e],this.elastic[e])),m.set(b)}resolveConstraints(){const{dragConstraints:e,dragElastic:o}=this.getProps(),l=this.visualElement.projection&&!this.visualElement.projection.layout?this.visualElement.projection.measure(!1):this.visualElement.projection?.layout,h=this.constraints;e&&D_(e)?this.constraints||(this.constraints=this.resolveRefConstraints()):e&&l?this.constraints=Qz(l.layoutBox,e):this.constraints=!1,this.elastic=t8(o),h!==this.constraints&&l&&this.constraints&&!this.hasMutatedConstraints&&Iu(m=>{this.constraints!==!1&&this.getAxisMotionValue(m)&&(this.constraints[m]=e8(l.layoutBox[m],this.constraints[m]))})}resolveRefConstraints(){const{dragConstraints:e,onMeasureDragConstraints:o}=this.getProps();if(!e||!D_(e))return!1;const l=e.current,{projection:h}=this.visualElement;if(!h||!h.layout)return!1;const m=oz(l,h.root,this.visualElement.getTransformPagePoint());let b=Kz(h.layout.layoutBox,m);if(o){const n=o(rz(b));this.hasMutatedConstraints=!!n,n&&(b=QI(n))}return b}startAnimation(e){const{drag:o,dragMomentum:l,dragElastic:h,dragTransition:m,dragSnapToOrigin:b,onDragTransitionEnd:n}=this.getProps(),C=this.constraints||{},D=Iu(L=>{if(!rv(L,o,this.currentDirection))return;let U=C&&C[L]||{};b&&(U={min:0,max:0});const q=h?200:1e6,Z=h?40:1e7,ie={type:"inertia",velocity:l?e[L]:0,bounceStiffness:q,bounceDamping:Z,timeConstant:750,restDelta:1,restSpeed:10,...m,...U};return this.startAxisValueAnimation(L,ie)});return Promise.all(D).then(n)}startAxisValueAnimation(e,o){const l=this.getAxisMotionValue(e);return pw(this.visualElement,e),l.start(E2(e,l,0,o,this.visualElement,!1))}stopAnimation(){Iu(e=>this.getAxisMotionValue(e).stop())}pauseAnimation(){Iu(e=>this.getAxisMotionValue(e).animation?.pause())}getAnimationState(e){return this.getAxisMotionValue(e).animation?.state}getAxisMotionValue(e){const o=`_drag${e.toUpperCase()}`,l=this.visualElement.getProps(),h=l[o];return h||this.visualElement.getValue(e,(l.initial?l.initial[e]:void 0)||0)}snapToCursor(e){Iu(o=>{const{drag:l}=this.getProps();if(!rv(o,l,this.currentDirection))return;const{projection:h}=this.visualElement,m=this.getAxisMotionValue(o);if(h&&h.layout){const{min:b,max:n}=h.layout.layoutBox[o];m.set(e[o]-Fo(b,n,.5))}})}scalePositionWithinConstraints(){if(!this.visualElement.current)return;const{drag:e,dragConstraints:o}=this.getProps(),{projection:l}=this.visualElement;if(!D_(o)||!l||!this.constraints)return;this.stopAnimation();const h={x:0,y:0};Iu(b=>{const n=this.getAxisMotionValue(b);if(n&&this.constraints!==!1){const C=n.get();h[b]=Jz({min:C,max:C},this.constraints[b])}});const{transformTemplate:m}=this.visualElement.getProps();this.visualElement.current.style.transform=m?m({},""):"none",l.root&&l.root.updateScroll(),l.updateLayout(),this.resolveConstraints(),Iu(b=>{if(!rv(b,e,null))return;const n=this.getAxisMotionValue(b),{min:C,max:D}=this.constraints[b];n.set(Fo(C,D,h[b]))})}addListeners(){if(!this.visualElement.current)return;r8.set(this.visualElement,this);const e=this.visualElement.current,o=hy(e,"pointerdown",C=>{const{drag:D,dragListener:L=!0}=this.getProps();D&&L&&this.start(C)}),l=()=>{const{dragConstraints:C}=this.getProps();D_(C)&&C.current&&(this.constraints=this.resolveRefConstraints())},{projection:h}=this.visualElement,m=h.addEventListener("measure",l);h&&!h.layout&&(h.root&&h.root.updateScroll(),h.updateLayout()),Co.read(l);const b=Ay(window,"resize",()=>this.scalePositionWithinConstraints()),n=h.addEventListener("didUpdate",(({delta:C,hasLayoutChanged:D})=>{this.isDragging&&D&&(Iu(L=>{const U=this.getAxisMotionValue(L);U&&(this.originPoint[L]+=C[L].translate,U.set(U.get()+C[L].translate))}),this.visualElement.render())}));return()=>{b(),o(),m(),n&&n()}}getProps(){const e=this.visualElement.getProps(),{drag:o=!1,dragDirectionLock:l=!1,dragPropagation:h=!1,dragConstraints:m=!1,dragElastic:b=gw,dragMomentum:n=!0}=e;return{...e,drag:o,dragDirectionLock:l,dragPropagation:h,dragConstraints:m,dragElastic:b,dragMomentum:n}}}function rv(r,e,o){return(e===!0||e===r)&&(o===null||o===r)}function n8(r,e=10){let o=null;return Math.abs(r.y)>e?o="y":Math.abs(r.x)>e&&(o="x"),o}class o8 extends dm{constructor(e){super(e),this.removeGroupControls=Lu,this.removeListeners=Lu,this.controls=new i8(e)}mount(){const{dragControls:e}=this.node.getProps();e&&(this.removeGroupControls=e.subscribe(this.controls)),this.removeListeners=this.controls.addListeners()||Lu}unmount(){this.removeGroupControls(),this.removeListeners()}}const UE=r=>(e,o)=>{r&&Co.postRender(()=>r(e,o))};class a8 extends dm{constructor(){super(...arguments),this.removePointerDownListener=Lu}onPointerDown(e){this.session=new dR(e,this.createPanHandlers(),{transformPagePoint:this.node.getTransformPagePoint(),contextWindow:fR(this.node)})}createPanHandlers(){const{onPanSessionStart:e,onPanStart:o,onPan:l,onPanEnd:h}=this.node.getProps();return{onSessionStart:UE(e),onStart:UE(o),onMove:l,onEnd:(m,b)=>{delete this.session,h&&Co.postRender(()=>h(m,b))}}}mount(){this.removePointerDownListener=hy(this.node.current,"pointerdown",e=>this.onPointerDown(e))}update(){this.session&&this.session.updateHandlers(this.createPanHandlers())}unmount(){this.removePointerDownListener(),this.session&&this.session.end()}}const yv={hasAnimatedSinceResize:!0,hasEverUpdated:!1};function jE(r,e){return e.max===e.min?0:r/(e.max-e.min)*100}const Q0={correct:(r,e)=>{if(!e.target)return r;if(typeof r=="string")if(Oi.test(r))r=parseFloat(r);else return r;const o=jE(r,e.target.x),l=jE(r,e.target.y);return`${o}% ${l}%`}},s8={correct:(r,{treeScale:e,projectionDelta:o})=>{const l=r,h=fm.parse(r);if(h.length>5)return l;const m=fm.createTransformer(r),b=typeof h[0]!="number"?1:0,n=o.x.scale*e.x,C=o.y.scale*e.y;h[0+b]/=n,h[1+b]/=C;const D=Fo(n,C,.5);return typeof h[2+b]=="number"&&(h[2+b]/=D),typeof h[3+b]=="number"&&(h[3+b]/=D),m(h)}};let Sb=!1;class l8 extends Xe.Component{componentDidMount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:l,layoutId:h}=this.props,{projection:m}=e;MB(c8),m&&(o.group&&o.group.add(m),l&&l.register&&h&&l.register(m),Sb&&m.root.didUpdate(),m.addEventListener("animationComplete",()=>{this.safeToRemove()}),m.setOptions({...m.options,onExitComplete:()=>this.safeToRemove()})),yv.hasEverUpdated=!0}getSnapshotBeforeUpdate(e){const{layoutDependency:o,visualElement:l,drag:h,isPresent:m}=this.props,{projection:b}=l;return b&&(b.isPresent=m,Sb=!0,h||e.layoutDependency!==o||o===void 0||e.isPresent!==m?b.willUpdate():this.safeToRemove(),e.isPresent!==m&&(m?b.promote():b.relegate()||Co.postRender(()=>{const n=b.getStack();(!n||!n.members.length)&&this.safeToRemove()}))),null}componentDidUpdate(){const{projection:e}=this.props.visualElement;e&&(e.root.didUpdate(),m2.postRender(()=>{!e.currentAnimation&&e.isLead()&&this.safeToRemove()}))}componentWillUnmount(){const{visualElement:e,layoutGroup:o,switchLayoutGroup:l}=this.props,{projection:h}=e;Sb=!0,h&&(h.scheduleCheckAfterUnmount(),o&&o.group&&o.group.remove(h),l&&l.deregister&&l.deregister(h))}safeToRemove(){const{safeToRemove:e}=this.props;e&&e()}render(){return null}}function mR(r){const[e,o]=FI(),l=Xe.useContext(Xw);return rt.jsx(l8,{...r,layoutGroup:l,switchLayoutGroup:Xe.useContext(WI),isPresent:e,safeToRemove:o})}const c8={borderRadius:{...Q0,applyTo:["borderTopLeftRadius","borderTopRightRadius","borderBottomLeftRadius","borderBottomRightRadius"]},borderTopLeftRadius:Q0,borderTopRightRadius:Q0,borderBottomLeftRadius:Q0,borderBottomRightRadius:Q0,boxShadow:s8};function u8(r,e,o){const l=Gs(r)?r:G_(r);return l.start(E2("",l,e,o)),l.animation}const h8=(r,e)=>r.depth-e.depth;class f8{constructor(){this.children=[],this.isDirty=!1}add(e){Yw(this.children,e),this.isDirty=!0}remove(e){Qw(this.children,e),this.isDirty=!0}forEach(e){this.isDirty&&this.children.sort(h8),this.isDirty=!1,this.children.forEach(e)}}function d8(r,e){const o=$l.now(),l=({timestamp:h})=>{const m=h-o;m>=e&&(hm(l),r(m-e))};return Co.setup(l,!0),()=>hm(l)}const gR=["TopLeft","TopRight","BottomLeft","BottomRight"],p8=gR.length,GE=r=>typeof r=="string"?parseFloat(r):r,HE=r=>typeof r=="number"||Oi.test(r);function m8(r,e,o,l,h,m){h?(r.opacity=Fo(0,o.opacity??1,g8(l)),r.opacityExit=Fo(e.opacity??1,0,_8(l))):m&&(r.opacity=Fo(e.opacity??1,o.opacity??1,l));for(let b=0;b<p8;b++){const n=`border${gR[b]}Radius`;let C=qE(e,n),D=qE(o,n);if(C===void 0&&D===void 0)continue;C||(C=0),D||(D=0),C===0||D===0||HE(C)===HE(D)?(r[n]=Math.max(Fo(GE(C),GE(D),l),0),(Ef.test(D)||Ef.test(C))&&(r[n]+="%")):r[n]=D}(e.rotate||o.rotate)&&(r.rotate=Fo(e.rotate||0,o.rotate||0,l))}function qE(r,e){return r[e]!==void 0?r[e]:r.borderRadius}const g8=_R(0,.5,iI),_8=_R(.5,.95,Lu);function _R(r,e,o){return l=>l<r?0:l>e?1:o(xy(r,e,l))}function $E(r,e){r.min=e.min,r.max=e.max}function Cu(r,e){$E(r.x,e.x),$E(r.y,e.y)}function XE(r,e){r.translate=e.translate,r.scale=e.scale,r.originPoint=e.originPoint,r.origin=e.origin}function ZE(r,e,o,l,h){return r-=e,r=Lv(r,1/o,l),h!==void 0&&(r=Lv(r,1/h,l)),r}function y8(r,e=0,o=1,l=.5,h,m=r,b=r){if(Ef.test(e)&&(e=parseFloat(e),e=Fo(b.min,b.max,e/100)-b.min),typeof e!="number")return;let n=Fo(m.min,m.max,l);r===m&&(n-=e),r.min=ZE(r.min,e,o,n,h),r.max=ZE(r.max,e,o,n,h)}function WE(r,e,[o,l,h],m,b){y8(r,e[o],e[l],e[h],e.scale,m,b)}const v8=["x","scaleX","originX"],x8=["y","scaleY","originY"];function YE(r,e,o,l){WE(r.x,e,v8,o?o.x:void 0,l?l.x:void 0),WE(r.y,e,x8,o?o.y:void 0,l?l.y:void 0)}function QE(r){return r.translate===0&&r.scale===1}function yR(r){return QE(r.x)&&QE(r.y)}function KE(r,e){return r.min===e.min&&r.max===e.max}function b8(r,e){return KE(r.x,e.x)&&KE(r.y,e.y)}function JE(r,e){return Math.round(r.min)===Math.round(e.min)&&Math.round(r.max)===Math.round(e.max)}function vR(r,e){return JE(r.x,e.x)&&JE(r.y,e.y)}function eC(r){return ml(r.x)/ml(r.y)}function tC(r,e){return r.translate===e.translate&&r.scale===e.scale&&r.originPoint===e.originPoint}class w8{constructor(){this.members=[]}add(e){Yw(this.members,e),e.scheduleRender()}remove(e){if(Qw(this.members,e),e===this.prevLead&&(this.prevLead=void 0),e===this.lead){const o=this.members[this.members.length-1];o&&this.promote(o)}}relegate(e){const o=this.members.findIndex(h=>e===h);if(o===0)return!1;let l;for(let h=o;h>=0;h--){const m=this.members[h];if(m.isPresent!==!1){l=m;break}}return l?(this.promote(l),!0):!1}promote(e,o){const l=this.lead;if(e!==l&&(this.prevLead=l,this.lead=e,e.show(),l)){l.instance&&l.scheduleRender(),e.scheduleRender(),e.resumeFrom=l,o&&(e.resumeFrom.preserveOpacity=!0),l.snapshot&&(e.snapshot=l.snapshot,e.snapshot.latestValues=l.animationValues||l.latestValues),e.root&&e.root.isUpdating&&(e.isLayoutDirty=!0);const{crossfade:h}=e.options;h===!1&&l.hide()}}exitAnimationComplete(){this.members.forEach(e=>{const{options:o,resumingFrom:l}=e;o.onExitComplete&&o.onExitComplete(),l&&l.options.onExitComplete&&l.options.onExitComplete()})}scheduleRender(){this.members.forEach(e=>{e.instance&&e.scheduleRender(!1)})}removeLeadSnapshot(){this.lead&&this.lead.snapshot&&(this.lead.snapshot=void 0)}}function S8(r,e,o){let l="";const h=r.x.translate/e.x,m=r.y.translate/e.y,b=o?.z||0;if((h||m||b)&&(l=`translate3d(${h}px, ${m}px, ${b}px) `),(e.x!==1||e.y!==1)&&(l+=`scale(${1/e.x}, ${1/e.y}) `),o){const{transformPerspective:D,rotate:L,rotateX:U,rotateY:q,skewX:Z,skewY:ie}=o;D&&(l=`perspective(${D}px) ${l}`),L&&(l+=`rotate(${L}deg) `),U&&(l+=`rotateX(${U}deg) `),q&&(l+=`rotateY(${q}deg) `),Z&&(l+=`skewX(${Z}deg) `),ie&&(l+=`skewY(${ie}deg) `)}const n=r.x.scale*e.x,C=r.y.scale*e.y;return(n!==1||C!==1)&&(l+=`scale(${n}, ${C})`),l||"none"}const Tb=["","X","Y","Z"],T8=1e3;let A8=0;function Ab(r,e,o,l){const{latestValues:h}=e;h[r]&&(o[r]=h[r],e.setStaticValue(r,0),l&&(l[r]=0))}function xR(r){if(r.hasCheckedOptimisedAppear=!0,r.root===r)return;const{visualElement:e}=r.options;if(!e)return;const o=oR(e);if(window.MotionHasOptimisedAnimation(o,"transform")){const{layout:h,layoutId:m}=r.options;window.MotionCancelOptimisedAnimation(o,"transform",Co,!(h||m))}const{parent:l}=r;l&&!l.hasCheckedOptimisedAppear&&xR(l)}function bR({attachResizeListener:r,defaultParent:e,measureScroll:o,checkIsScrollRoot:l,resetTransform:h}){return class{constructor(b={},n=e?.()){this.id=A8++,this.animationId=0,this.animationCommitId=0,this.children=new Set,this.options={},this.isTreeAnimating=!1,this.isAnimationBlocked=!1,this.isLayoutDirty=!1,this.isProjectionDirty=!1,this.isSharedProjectionDirty=!1,this.isTransformDirty=!1,this.updateManuallyBlocked=!1,this.updateBlockedByResize=!1,this.isUpdating=!1,this.isSVG=!1,this.needsReset=!1,this.shouldResetTransform=!1,this.hasCheckedOptimisedAppear=!1,this.treeScale={x:1,y:1},this.eventHandlers=new Map,this.hasTreeAnimated=!1,this.updateScheduled=!1,this.scheduleUpdate=()=>this.update(),this.projectionUpdateScheduled=!1,this.checkUpdateFailed=()=>{this.isUpdating&&(this.isUpdating=!1,this.clearAllSnapshots())},this.updateProjection=()=>{this.projectionUpdateScheduled=!1,this.nodes.forEach(I8),this.nodes.forEach(O8),this.nodes.forEach(P8),this.nodes.forEach(R8)},this.resolvedRelativeTargetAt=0,this.hasProjected=!1,this.isVisible=!0,this.animationProgress=0,this.sharedNodes=new Map,this.latestValues=b,this.root=n?n.root||n:this,this.path=n?[...n.path,n]:[],this.parent=n,this.depth=n?n.depth+1:0;for(let C=0;C<this.path.length;C++)this.path[C].shouldResetTransform=!0;this.root===this&&(this.nodes=new f8)}addEventListener(b,n){return this.eventHandlers.has(b)||this.eventHandlers.set(b,new e2),this.eventHandlers.get(b).add(n)}notifyListeners(b,...n){const C=this.eventHandlers.get(b);C&&C.notify(...n)}hasListeners(b){return this.eventHandlers.has(b)}mount(b){if(this.instance)return;this.isSVG=zI(b)&&!pB(b),this.instance=b;const{layoutId:n,layout:C,visualElement:D}=this.options;if(D&&!D.current&&D.mount(b),this.root.nodes.add(this),this.parent&&this.parent.children.add(this),this.root.hasTreeAnimated&&(C||n)&&(this.isLayoutDirty=!0),r){let L,U=0;const q=()=>this.root.updateBlockedByResize=!1;Co.read(()=>{U=window.innerWidth}),r(b,()=>{const Z=window.innerWidth;Z!==U&&(U=Z,this.root.updateBlockedByResize=!0,L&&L(),L=d8(q,250),yv.hasAnimatedSinceResize&&(yv.hasAnimatedSinceResize=!1,this.nodes.forEach(nC)))})}n&&this.root.registerSharedNode(n,this),this.options.animate!==!1&&D&&(n||C)&&this.addEventListener("didUpdate",({delta:L,hasLayoutChanged:U,hasRelativeLayoutChanged:q,layout:Z})=>{if(this.isTreeAnimationBlocked()){this.target=void 0,this.relativeTarget=void 0;return}const ie=this.options.transition||D.getDefaultTransition()||k8,{onLayoutAnimationStart:ne,onLayoutAnimationComplete:be}=D.getProps(),ve=!this.targetLayout||!vR(this.targetLayout,Z),we=!U&&q;if(this.options.layoutRoot||this.resumeFrom||we||U&&(ve||!this.currentAnimation)){this.resumeFrom&&(this.resumingFrom=this.resumeFrom,this.resumingFrom.resumingFrom=void 0);const Pe={...d2(ie,"layout"),onPlay:ne,onComplete:be};(D.shouldReduceMotion||this.options.layoutRoot)&&(Pe.delay=0,Pe.type=!1),this.startAnimation(Pe),this.setAnimationOrigin(L,we)}else U||nC(this),this.isLead()&&this.options.onExitComplete&&this.options.onExitComplete();this.targetLayout=Z})}unmount(){this.options.layoutId&&this.willUpdate(),this.root.nodes.remove(this);const b=this.getStack();b&&b.remove(this),this.parent&&this.parent.children.delete(this),this.instance=void 0,this.eventHandlers.clear(),hm(this.updateProjection)}blockUpdate(){this.updateManuallyBlocked=!0}unblockUpdate(){this.updateManuallyBlocked=!1}isUpdateBlocked(){return this.updateManuallyBlocked||this.updateBlockedByResize}isTreeAnimationBlocked(){return this.isAnimationBlocked||this.parent&&this.parent.isTreeAnimationBlocked()||!1}startUpdate(){this.isUpdateBlocked()||(this.isUpdating=!0,this.nodes&&this.nodes.forEach(L8),this.animationId++)}getTransformTemplate(){const{visualElement:b}=this.options;return b&&b.getProps().transformTemplate}willUpdate(b=!0){if(this.root.hasTreeAnimated=!0,this.root.isUpdateBlocked()){this.options.onExitComplete&&this.options.onExitComplete();return}if(window.MotionCancelOptimisedAnimation&&!this.hasCheckedOptimisedAppear&&xR(this),!this.root.isUpdating&&this.root.startUpdate(),this.isLayoutDirty)return;this.isLayoutDirty=!0;for(let L=0;L<this.path.length;L++){const U=this.path[L];U.shouldResetTransform=!0,U.updateScroll("snapshot"),U.options.layoutRoot&&U.willUpdate(!1)}const{layoutId:n,layout:C}=this.options;if(n===void 0&&!C)return;const D=this.getTransformTemplate();this.prevTransformTemplateValue=D?D(this.latestValues,""):void 0,this.updateSnapshot(),b&&this.notifyListeners("willUpdate")}update(){if(this.updateScheduled=!1,this.isUpdateBlocked()){this.unblockUpdate(),this.clearAllSnapshots(),this.nodes.forEach(rC);return}if(this.animationId<=this.animationCommitId){this.nodes.forEach(iC);return}this.animationCommitId=this.animationId,this.isUpdating?(this.isUpdating=!1,this.nodes.forEach(D8),this.nodes.forEach(E8),this.nodes.forEach(C8)):this.nodes.forEach(iC),this.clearAllSnapshots();const n=$l.now();ps.delta=kd(0,1e3/60,n-ps.timestamp),ps.timestamp=n,ps.isProcessing=!0,db.update.process(ps),db.preRender.process(ps),db.render.process(ps),ps.isProcessing=!1}didUpdate(){this.updateScheduled||(this.updateScheduled=!0,m2.read(this.scheduleUpdate))}clearAllSnapshots(){this.nodes.forEach(M8),this.sharedNodes.forEach(B8)}scheduleUpdateProjection(){this.projectionUpdateScheduled||(this.projectionUpdateScheduled=!0,Co.preRender(this.updateProjection,!1,!0))}scheduleCheckAfterUnmount(){Co.postRender(()=>{this.isLayoutDirty?this.root.didUpdate():this.root.checkUpdateFailed()})}updateSnapshot(){this.snapshot||!this.instance||(this.snapshot=this.measure(),this.snapshot&&!ml(this.snapshot.measuredBox.x)&&!ml(this.snapshot.measuredBox.y)&&(this.snapshot=void 0))}updateLayout(){if(!this.instance||(this.updateScroll(),!(this.options.alwaysMeasureLayout&&this.isLead())&&!this.isLayoutDirty))return;if(this.resumeFrom&&!this.resumeFrom.instance)for(let C=0;C<this.path.length;C++)this.path[C].updateScroll();const b=this.layout;this.layout=this.measure(!1),this.layoutCorrected=ia(),this.isLayoutDirty=!1,this.projectionDelta=void 0,this.notifyListeners("measure",this.layout.layoutBox);const{visualElement:n}=this.options;n&&n.notify("LayoutMeasure",this.layout.layoutBox,b?b.layoutBox:void 0)}updateScroll(b="measure"){let n=!!(this.options.layoutScroll&&this.instance);if(this.scroll&&this.scroll.animationId===this.root.animationId&&this.scroll.phase===b&&(n=!1),n&&this.instance){const C=l(this.instance);this.scroll={animationId:this.root.animationId,phase:b,isRoot:C,offset:o(this.instance),wasRoot:this.scroll?this.scroll.isRoot:C}}}resetTransform(){if(!h)return;const b=this.isLayoutDirty||this.shouldResetTransform||this.options.alwaysMeasureLayout,n=this.projectionDelta&&!yR(this.projectionDelta),C=this.getTransformTemplate(),D=C?C(this.latestValues,""):void 0,L=D!==this.prevTransformTemplateValue;b&&this.instance&&(n||dg(this.latestValues)||L)&&(h(this.instance,D),this.shouldResetTransform=!1,this.scheduleRender())}measure(b=!0){const n=this.measurePageBox();let C=this.removeElementScroll(n);return b&&(C=this.removeTransform(C)),N8(C),{animationId:this.root.animationId,measuredBox:n,layoutBox:C,latestValues:{},source:this.id}}measurePageBox(){const{visualElement:b}=this.options;if(!b)return ia();const n=b.measureViewportBox();if(!(this.scroll?.wasRoot||this.path.some(V8))){const{scroll:D}=this.root;D&&(O_(n.x,D.offset.x),O_(n.y,D.offset.y))}return n}removeElementScroll(b){const n=ia();if(Cu(n,b),this.scroll?.wasRoot)return n;for(let C=0;C<this.path.length;C++){const D=this.path[C],{scroll:L,options:U}=D;D!==this.root&&L&&U.layoutScroll&&(L.wasRoot&&Cu(n,b),O_(n.x,L.offset.x),O_(n.y,L.offset.y))}return n}applyTransform(b,n=!1){const C=ia();Cu(C,b);for(let D=0;D<this.path.length;D++){const L=this.path[D];!n&&L.options.layoutScroll&&L.scroll&&L!==L.root&&P_(C,{x:-L.scroll.offset.x,y:-L.scroll.offset.y}),dg(L.latestValues)&&P_(C,L.latestValues)}return dg(this.latestValues)&&P_(C,this.latestValues),C}removeTransform(b){const n=ia();Cu(n,b);for(let C=0;C<this.path.length;C++){const D=this.path[C];if(!D.instance||!dg(D.latestValues))continue;uw(D.latestValues)&&D.updateSnapshot();const L=ia(),U=D.measurePageBox();Cu(L,U),YE(n,D.latestValues,D.snapshot?D.snapshot.layoutBox:void 0,L)}return dg(this.latestValues)&&YE(n,this.latestValues),n}setTargetDelta(b){this.targetDelta=b,this.root.scheduleUpdateProjection(),this.isProjectionDirty=!0}setOptions(b){this.options={...this.options,...b,crossfade:b.crossfade!==void 0?b.crossfade:!0}}clearMeasurements(){this.scroll=void 0,this.layout=void 0,this.snapshot=void 0,this.prevTransformTemplateValue=void 0,this.targetDelta=void 0,this.target=void 0,this.isLayoutDirty=!1}forceRelativeParentToResolveTarget(){this.relativeParent&&this.relativeParent.resolvedRelativeTargetAt!==ps.timestamp&&this.relativeParent.resolveTargetDelta(!0)}resolveTargetDelta(b=!1){const n=this.getLead();this.isProjectionDirty||(this.isProjectionDirty=n.isProjectionDirty),this.isTransformDirty||(this.isTransformDirty=n.isTransformDirty),this.isSharedProjectionDirty||(this.isSharedProjectionDirty=n.isSharedProjectionDirty);const C=!!this.resumingFrom||this!==n;if(!(b||C&&this.isSharedProjectionDirty||this.isProjectionDirty||this.parent?.isProjectionDirty||this.attemptToResolveRelativeTarget||this.root.updateBlockedByResize))return;const{layout:L,layoutId:U}=this.options;if(!(!this.layout||!(L||U))){if(this.resolvedRelativeTargetAt=ps.timestamp,!this.targetDelta&&!this.relativeTarget){const q=this.getClosestProjectingParent();q&&q.layout&&this.animationProgress!==1?(this.relativeParent=q,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ia(),this.relativeTargetOrigin=ia(),dy(this.relativeTargetOrigin,this.layout.layoutBox,q.layout.layoutBox),Cu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}if(!(!this.relativeTarget&&!this.targetDelta)&&(this.target||(this.target=ia(),this.targetWithTransforms=ia()),this.relativeTarget&&this.relativeTargetOrigin&&this.relativeParent&&this.relativeParent.target?(this.forceRelativeParentToResolveTarget(),$z(this.target,this.relativeTarget,this.relativeParent.target)):this.targetDelta?(this.resumingFrom?this.target=this.applyTransform(this.layout.layoutBox):Cu(this.target,this.layout.layoutBox),JI(this.target,this.targetDelta)):Cu(this.target,this.layout.layoutBox),this.attemptToResolveRelativeTarget)){this.attemptToResolveRelativeTarget=!1;const q=this.getClosestProjectingParent();q&&!!q.resumingFrom==!!this.resumingFrom&&!q.options.layoutScroll&&q.target&&this.animationProgress!==1?(this.relativeParent=q,this.forceRelativeParentToResolveTarget(),this.relativeTarget=ia(),this.relativeTargetOrigin=ia(),dy(this.relativeTargetOrigin,this.target,q.target),Cu(this.relativeTarget,this.relativeTargetOrigin)):this.relativeParent=this.relativeTarget=void 0}}}getClosestProjectingParent(){if(!(!this.parent||uw(this.parent.latestValues)||KI(this.parent.latestValues)))return this.parent.isProjecting()?this.parent:this.parent.getClosestProjectingParent()}isProjecting(){return!!((this.relativeTarget||this.targetDelta||this.options.layoutRoot)&&this.layout)}calcProjection(){const b=this.getLead(),n=!!this.resumingFrom||this!==b;let C=!0;if((this.isProjectionDirty||this.parent?.isProjectionDirty)&&(C=!1),n&&(this.isSharedProjectionDirty||this.isTransformDirty)&&(C=!1),this.resolvedRelativeTargetAt===ps.timestamp&&(C=!1),C)return;const{layout:D,layoutId:L}=this.options;if(this.isTreeAnimating=!!(this.parent&&this.parent.isTreeAnimating||this.currentAnimation||this.pendingAnimation),this.isTreeAnimating||(this.targetDelta=this.relativeTarget=void 0),!this.layout||!(D||L))return;Cu(this.layoutCorrected,this.layout.layoutBox);const U=this.treeScale.x,q=this.treeScale.y;nz(this.layoutCorrected,this.treeScale,this.path,n),b.layout&&!b.target&&(this.treeScale.x!==1||this.treeScale.y!==1)&&(b.target=b.layout.layoutBox,b.targetWithTransforms=ia());const{target:Z}=b;if(!Z){this.prevProjectionDelta&&(this.createProjectionDeltas(),this.scheduleRender());return}!this.projectionDelta||!this.prevProjectionDelta?this.createProjectionDeltas():(XE(this.prevProjectionDelta.x,this.projectionDelta.x),XE(this.prevProjectionDelta.y,this.projectionDelta.y)),fy(this.projectionDelta,this.layoutCorrected,Z,this.latestValues),(this.treeScale.x!==U||this.treeScale.y!==q||!tC(this.projectionDelta.x,this.prevProjectionDelta.x)||!tC(this.projectionDelta.y,this.prevProjectionDelta.y))&&(this.hasProjected=!0,this.scheduleRender(),this.notifyListeners("projectionUpdate",Z))}hide(){this.isVisible=!1}show(){this.isVisible=!0}scheduleRender(b=!0){if(this.options.visualElement?.scheduleRender(),b){const n=this.getStack();n&&n.scheduleRender()}this.resumingFrom&&!this.resumingFrom.instance&&(this.resumingFrom=void 0)}createProjectionDeltas(){this.prevProjectionDelta=L_(),this.projectionDelta=L_(),this.projectionDeltaWithTransform=L_()}setAnimationOrigin(b,n=!1){const C=this.snapshot,D=C?C.latestValues:{},L={...this.latestValues},U=L_();(!this.relativeParent||!this.relativeParent.options.layoutRoot)&&(this.relativeTarget=this.relativeTargetOrigin=void 0),this.attemptToResolveRelativeTarget=!n;const q=ia(),Z=C?C.source:void 0,ie=this.layout?this.layout.source:void 0,ne=Z!==ie,be=this.getStack(),ve=!be||be.members.length<=1,we=!!(ne&&!ve&&this.options.crossfade===!0&&!this.path.some(F8));this.animationProgress=0;let Pe;this.mixTargetDelta=Ze=>{const $e=Ze/1e3;oC(U.x,b.x,$e),oC(U.y,b.y,$e),this.setTargetDelta(U),this.relativeTarget&&this.relativeTargetOrigin&&this.layout&&this.relativeParent&&this.relativeParent.layout&&(dy(q,this.layout.layoutBox,this.relativeParent.layout.layoutBox),z8(this.relativeTarget,this.relativeTargetOrigin,q,$e),Pe&&b8(this.relativeTarget,Pe)&&(this.isProjectionDirty=!1),Pe||(Pe=ia()),Cu(Pe,this.relativeTarget)),ne&&(this.animationValues=L,m8(L,D,this.latestValues,$e,we,ve)),this.root.scheduleUpdateProjection(),this.scheduleRender(),this.animationProgress=$e},this.mixTargetDelta(this.options.layoutRoot?1e3:0)}startAnimation(b){this.notifyListeners("animationStart"),this.currentAnimation?.stop(),this.resumingFrom?.currentAnimation?.stop(),this.pendingAnimation&&(hm(this.pendingAnimation),this.pendingAnimation=void 0),this.pendingAnimation=Co.update(()=>{yv.hasAnimatedSinceResize=!0,this.motionValue||(this.motionValue=G_(0)),this.currentAnimation=u8(this.motionValue,[0,1e3],{...b,velocity:0,isSync:!0,onUpdate:n=>{this.mixTargetDelta(n),b.onUpdate&&b.onUpdate(n)},onStop:()=>{},onComplete:()=>{b.onComplete&&b.onComplete(),this.completeAnimation()}}),this.resumingFrom&&(this.resumingFrom.currentAnimation=this.currentAnimation),this.pendingAnimation=void 0})}completeAnimation(){this.resumingFrom&&(this.resumingFrom.currentAnimation=void 0,this.resumingFrom.preserveOpacity=void 0);const b=this.getStack();b&&b.exitAnimationComplete(),this.resumingFrom=this.currentAnimation=this.animationValues=void 0,this.notifyListeners("animationComplete")}finishAnimation(){this.currentAnimation&&(this.mixTargetDelta&&this.mixTargetDelta(T8),this.currentAnimation.stop()),this.completeAnimation()}applyTransformsToTarget(){const b=this.getLead();let{targetWithTransforms:n,target:C,layout:D,latestValues:L}=b;if(!(!n||!C||!D)){if(this!==b&&this.layout&&D&&wR(this.options.animationType,this.layout.layoutBox,D.layoutBox)){C=this.target||ia();const U=ml(this.layout.layoutBox.x);C.x.min=b.target.x.min,C.x.max=C.x.min+U;const q=ml(this.layout.layoutBox.y);C.y.min=b.target.y.min,C.y.max=C.y.min+q}Cu(n,C),P_(n,L),fy(this.projectionDeltaWithTransform,this.layoutCorrected,n,L)}}registerSharedNode(b,n){this.sharedNodes.has(b)||this.sharedNodes.set(b,new w8),this.sharedNodes.get(b).add(n);const D=n.options.initialPromotionConfig;n.promote({transition:D?D.transition:void 0,preserveFollowOpacity:D&&D.shouldPreserveFollowOpacity?D.shouldPreserveFollowOpacity(n):void 0})}isLead(){const b=this.getStack();return b?b.lead===this:!0}getLead(){const{layoutId:b}=this.options;return b?this.getStack()?.lead||this:this}getPrevLead(){const{layoutId:b}=this.options;return b?this.getStack()?.prevLead:void 0}getStack(){const{layoutId:b}=this.options;if(b)return this.root.sharedNodes.get(b)}promote({needsReset:b,transition:n,preserveFollowOpacity:C}={}){const D=this.getStack();D&&D.promote(this,C),b&&(this.projectionDelta=void 0,this.needsReset=!0),n&&this.setOptions({transition:n})}relegate(){const b=this.getStack();return b?b.relegate(this):!1}resetSkewAndRotation(){const{visualElement:b}=this.options;if(!b)return;let n=!1;const{latestValues:C}=b;if((C.z||C.rotate||C.rotateX||C.rotateY||C.rotateZ||C.skewX||C.skewY)&&(n=!0),!n)return;const D={};C.z&&Ab("z",b,D,this.animationValues);for(let L=0;L<Tb.length;L++)Ab(`rotate${Tb[L]}`,b,D,this.animationValues),Ab(`skew${Tb[L]}`,b,D,this.animationValues);b.render();for(const L in D)b.setStaticValue(L,D[L]),this.animationValues&&(this.animationValues[L]=D[L]);b.scheduleRender()}applyProjectionStyles(b,n){if(!this.instance||this.isSVG)return;if(!this.isVisible){b.visibility="hidden";return}const C=this.getTransformTemplate();if(this.needsReset){this.needsReset=!1,b.visibility="",b.opacity="",b.pointerEvents=_v(n?.pointerEvents)||"",b.transform=C?C(this.latestValues,""):"none";return}const D=this.getLead();if(!this.projectionDelta||!this.layout||!D.target){this.options.layoutId&&(b.opacity=this.latestValues.opacity!==void 0?this.latestValues.opacity:1,b.pointerEvents=_v(n?.pointerEvents)||""),this.hasProjected&&!dg(this.latestValues)&&(b.transform=C?C({},""):"none",this.hasProjected=!1);return}b.visibility="";const L=D.animationValues||D.latestValues;this.applyTransformsToTarget();let U=S8(this.projectionDeltaWithTransform,this.treeScale,L);C&&(U=C(L,U)),b.transform=U;const{x:q,y:Z}=this.projectionDelta;b.transformOrigin=`${q.origin*100}% ${Z.origin*100}% 0`,D.animationValues?b.opacity=D===this?L.opacity??this.latestValues.opacity??1:this.preserveOpacity?this.latestValues.opacity:L.opacityExit:b.opacity=D===this?L.opacity!==void 0?L.opacity:"":L.opacityExit!==void 0?L.opacityExit:0;for(const ie in Ty){if(L[ie]===void 0)continue;const{correct:ne,applyTo:be,isCSSVariable:ve}=Ty[ie],we=U==="none"?L[ie]:ne(L[ie],D);if(be){const Pe=be.length;for(let Ze=0;Ze<Pe;Ze++)b[be[Ze]]=we}else ve?this.options.visualElement.renderState.vars[ie]=we:b[ie]=we}this.options.layoutId&&(b.pointerEvents=D===this?_v(n?.pointerEvents)||"":"none")}clearSnapshot(){this.resumeFrom=this.snapshot=void 0}resetTree(){this.root.nodes.forEach(b=>b.currentAnimation?.stop()),this.root.nodes.forEach(rC),this.root.sharedNodes.clear()}}}function E8(r){r.updateLayout()}function C8(r){const e=r.resumeFrom?.snapshot||r.snapshot;if(r.isLead()&&r.layout&&e&&r.hasListeners("didUpdate")){const{layoutBox:o,measuredBox:l}=r.layout,{animationType:h}=r.options,m=e.source!==r.layout.source;h==="size"?Iu(L=>{const U=m?e.measuredBox[L]:e.layoutBox[L],q=ml(U);U.min=o[L].min,U.max=U.min+q}):wR(h,e.layoutBox,o)&&Iu(L=>{const U=m?e.measuredBox[L]:e.layoutBox[L],q=ml(o[L]);U.max=U.min+q,r.relativeTarget&&!r.currentAnimation&&(r.isProjectionDirty=!0,r.relativeTarget[L].max=r.relativeTarget[L].min+q)});const b=L_();fy(b,o,e.layoutBox);const n=L_();m?fy(n,r.applyTransform(l,!0),e.measuredBox):fy(n,o,e.layoutBox);const C=!yR(b);let D=!1;if(!r.resumeFrom){const L=r.getClosestProjectingParent();if(L&&!L.resumeFrom){const{snapshot:U,layout:q}=L;if(U&&q){const Z=ia();dy(Z,e.layoutBox,U.layoutBox);const ie=ia();dy(ie,o,q.layoutBox),vR(Z,ie)||(D=!0),L.options.layoutRoot&&(r.relativeTarget=ie,r.relativeTargetOrigin=Z,r.relativeParent=L)}}}r.notifyListeners("didUpdate",{layout:o,snapshot:e,delta:n,layoutDelta:b,hasLayoutChanged:C,hasRelativeLayoutChanged:D})}else if(r.isLead()){const{onExitComplete:o}=r.options;o&&o()}r.options.transition=void 0}function I8(r){r.parent&&(r.isProjecting()||(r.isProjectionDirty=r.parent.isProjectionDirty),r.isSharedProjectionDirty||(r.isSharedProjectionDirty=!!(r.isProjectionDirty||r.parent.isProjectionDirty||r.parent.isSharedProjectionDirty)),r.isTransformDirty||(r.isTransformDirty=r.parent.isTransformDirty))}function R8(r){r.isProjectionDirty=r.isSharedProjectionDirty=r.isTransformDirty=!1}function M8(r){r.clearSnapshot()}function rC(r){r.clearMeasurements()}function iC(r){r.isLayoutDirty=!1}function D8(r){const{visualElement:e}=r.options;e&&e.getProps().onBeforeLayoutMeasure&&e.notify("BeforeLayoutMeasure"),r.resetTransform()}function nC(r){r.finishAnimation(),r.targetDelta=r.relativeTarget=r.target=void 0,r.isProjectionDirty=!0}function O8(r){r.resolveTargetDelta()}function P8(r){r.calcProjection()}function L8(r){r.resetSkewAndRotation()}function B8(r){r.removeLeadSnapshot()}function oC(r,e,o){r.translate=Fo(e.translate,0,o),r.scale=Fo(e.scale,1,o),r.origin=e.origin,r.originPoint=e.originPoint}function aC(r,e,o,l){r.min=Fo(e.min,o.min,l),r.max=Fo(e.max,o.max,l)}function z8(r,e,o,l){aC(r.x,e.x,o.x,l),aC(r.y,e.y,o.y,l)}function F8(r){return r.animationValues&&r.animationValues.opacityExit!==void 0}const k8={duration:.45,ease:[.4,0,.1,1]},sC=r=>typeof navigator<"u"&&navigator.userAgent&&navigator.userAgent.toLowerCase().includes(r),lC=sC("applewebkit/")&&!sC("chrome/")?Math.round:Lu;function cC(r){r.min=lC(r.min),r.max=lC(r.max)}function N8(r){cC(r.x),cC(r.y)}function wR(r,e,o){return r==="position"||r==="preserve-aspect"&&!qz(eC(e),eC(o),.2)}function V8(r){return r!==r.root&&r.scroll?.wasRoot}const U8=bR({attachResizeListener:(r,e)=>Ay(r,"resize",e),measureScroll:()=>({x:document.documentElement.scrollLeft||document.body.scrollLeft,y:document.documentElement.scrollTop||document.body.scrollTop}),checkIsScrollRoot:()=>!0}),Eb={current:void 0},SR=bR({measureScroll:r=>({x:r.scrollLeft,y:r.scrollTop}),defaultParent:()=>{if(!Eb.current){const r=new U8({});r.mount(window),r.setOptions({layoutScroll:!0}),Eb.current=r}return Eb.current},resetTransform:(r,e)=>{r.style.transform=e!==void 0?e:"none"},checkIsScrollRoot:r=>window.getComputedStyle(r).position==="fixed"}),j8={pan:{Feature:a8},drag:{Feature:o8,ProjectionNode:SR,MeasureLayout:mR}};function uC(r,e,o){const{props:l}=r;r.animationState&&l.whileHover&&r.animationState.setActive("whileHover",o==="Start");const h="onHover"+o,m=l[h];m&&Co.postRender(()=>m(e,Ly(e)))}class G8 extends dm{mount(){const{current:e}=this.node;e&&(this.unmount=cB(e,(o,l)=>(uC(this.node,l,"Start"),h=>uC(this.node,h,"End"))))}unmount(){}}class H8 extends dm{constructor(){super(...arguments),this.isActive=!1}onFocus(){let e=!1;try{e=this.node.current.matches(":focus-visible")}catch{e=!0}!e||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!0),this.isActive=!0)}onBlur(){!this.isActive||!this.node.animationState||(this.node.animationState.setActive("whileFocus",!1),this.isActive=!1)}mount(){this.unmount=Dy(Ay(this.node.current,"focus",()=>this.onFocus()),Ay(this.node.current,"blur",()=>this.onBlur()))}unmount(){}}function hC(r,e,o){const{props:l}=r;if(r.current instanceof HTMLButtonElement&&r.current.disabled)return;r.animationState&&l.whileTap&&r.animationState.setActive("whileTap",o==="Start");const h="onTap"+(o==="End"?"":o),m=l[h];m&&Co.postRender(()=>m(e,Ly(e)))}class q8 extends dm{mount(){const{current:e}=this.node;e&&(this.unmount=dB(e,(o,l)=>(hC(this.node,l,"Start"),(h,{success:m})=>hC(this.node,h,m?"End":"Cancel")),{useGlobalTarget:this.node.props.globalTapTarget}))}unmount(){}}const _w=new WeakMap,Cb=new WeakMap,$8=r=>{const e=_w.get(r.target);e&&e(r)},X8=r=>{r.forEach($8)};function Z8({root:r,...e}){const o=r||document;Cb.has(o)||Cb.set(o,{});const l=Cb.get(o),h=JSON.stringify(e);return l[h]||(l[h]=new IntersectionObserver(X8,{root:r,...e})),l[h]}function W8(r,e,o){const l=Z8(e);return _w.set(r,o),l.observe(r),()=>{_w.delete(r),l.unobserve(r)}}const Y8={some:0,all:1};class Q8 extends dm{constructor(){super(...arguments),this.hasEnteredView=!1,this.isInView=!1}startObserver(){this.unmount();const{viewport:e={}}=this.node.getProps(),{root:o,margin:l,amount:h="some",once:m}=e,b={root:o?o.current:void 0,rootMargin:l,threshold:typeof h=="number"?h:Y8[h]},n=C=>{const{isIntersecting:D}=C;if(this.isInView===D||(this.isInView=D,m&&!D&&this.hasEnteredView))return;D&&(this.hasEnteredView=!0),this.node.animationState&&this.node.animationState.setActive("whileInView",D);const{onViewportEnter:L,onViewportLeave:U}=this.node.getProps(),q=D?L:U;q&&q(C)};return W8(this.node.current,b,n)}mount(){this.startObserver()}update(){if(typeof IntersectionObserver>"u")return;const{props:e,prevProps:o}=this.node;["amount","margin","root"].some(K8(e,o))&&this.startObserver()}unmount(){}}function K8({viewport:r={}},{viewport:e={}}={}){return o=>r[o]!==e[o]}const J8={inView:{Feature:Q8},tap:{Feature:q8},focus:{Feature:H8},hover:{Feature:G8}},eF={layout:{ProjectionNode:SR,MeasureLayout:mR}},tF={...Nz,...J8,...j8,...eF},ms=tz(tF,pz);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const rF=r=>r.replace(/([a-z0-9])([A-Z])/g,"$1-$2").toLowerCase(),iF=r=>r.replace(/^([A-Z])|[\s-_]+(\w)/g,(e,o,l)=>l?l.toUpperCase():o.toLowerCase()),fC=r=>{const e=iF(r);return e.charAt(0).toUpperCase()+e.slice(1)},TR=(...r)=>r.filter((e,o,l)=>!!e&&e.trim()!==""&&l.indexOf(e)===o).join(" ").trim(),nF=r=>{for(const e in r)if(e.startsWith("aria-")||e==="role"||e==="title")return!0};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */var oF={xmlns:"http://www.w3.org/2000/svg",width:24,height:24,viewBox:"0 0 24 24",fill:"none",stroke:"currentColor",strokeWidth:2,strokeLinecap:"round",strokeLinejoin:"round"};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const aF=Xe.forwardRef(({color:r="currentColor",size:e=24,strokeWidth:o=2,absoluteStrokeWidth:l,className:h="",children:m,iconNode:b,...n},C)=>Xe.createElement("svg",{ref:C,...oF,width:e,height:e,stroke:r,strokeWidth:l?Number(o)*24/Number(e):o,className:TR("lucide",h),...!m&&!nF(n)&&{"aria-hidden":"true"},...n},[...b.map(([D,L])=>Xe.createElement(D,L)),...Array.isArray(m)?m:[m]]));/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const _s=(r,e)=>{const o=Xe.forwardRef(({className:l,...h},m)=>Xe.createElement(aF,{ref:m,iconNode:e,className:TR(`lucide-${rF(fC(r))}`,`lucide-${r}`,l),...h}));return o.displayName=fC(r),o};/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const sF=[["path",{d:"m15.477 12.89 1.515 8.526a.5.5 0 0 1-.81.47l-3.58-2.687a1 1 0 0 0-1.197 0l-3.586 2.686a.5.5 0 0 1-.81-.469l1.514-8.526",key:"1yiouv"}],["circle",{cx:"12",cy:"8",r:"6",key:"1vp47v"}]],lF=_s("award",sF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const cF=[["path",{d:"M12 7v14",key:"1akyts"}],["path",{d:"M3 18a1 1 0 0 1-1-1V4a1 1 0 0 1 1-1h5a4 4 0 0 1 4 4 4 4 0 0 1 4-4h5a1 1 0 0 1 1 1v13a1 1 0 0 1-1 1h-6a3 3 0 0 0-3 3 3 3 0 0 0-3-3z",key:"ruj8y"}]],AR=_s("book-open",cF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const uF=[["path",{d:"M8 2v4",key:"1cmpym"}],["path",{d:"M16 2v4",key:"4m81vk"}],["rect",{width:"18",height:"18",x:"3",y:"4",rx:"2",key:"1hopcy"}],["path",{d:"M3 10h18",key:"8toen8"}]],hF=_s("calendar",uF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const fF=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["line",{x1:"22",x2:"18",y1:"12",y2:"12",key:"l9bcsi"}],["line",{x1:"6",x2:"2",y1:"12",y2:"12",key:"13hhkx"}],["line",{x1:"12",x2:"12",y1:"6",y2:"2",key:"10w3f3"}],["line",{x1:"12",x2:"12",y1:"22",y2:"18",key:"15g9kq"}]],dF=_s("crosshair",fF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const pF=[["path",{d:"M2 9.5a5.5 5.5 0 0 1 9.591-3.676.56.56 0 0 0 .818 0A5.49 5.49 0 0 1 22 9.5c0 2.29-1.5 4-3 5.5l-5.492 5.313a2 2 0 0 1-3 .019L5 15c-1.5-1.5-3-3.2-3-5.5",key:"mvr1a0"}]],mF=_s("heart",pF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const gF=[["path",{d:"M3 5h.01",key:"18ugdj"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M3 19h.01",key:"noohij"}],["path",{d:"M8 5h13",key:"1pao27"}],["path",{d:"M8 12h13",key:"1za7za"}],["path",{d:"M8 19h13",key:"m83p4d"}]],_F=_s("list",gF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const yF=[["path",{d:"M21 12a9 9 0 1 1-6.219-8.56",key:"13zald"}]],ER=_s("loader-circle",yF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const vF=[["line",{x1:"2",x2:"5",y1:"12",y2:"12",key:"bvdh0s"}],["line",{x1:"19",x2:"22",y1:"12",y2:"12",key:"1tbv5k"}],["line",{x1:"12",x2:"12",y1:"2",y2:"5",key:"11lu5j"}],["line",{x1:"12",x2:"12",y1:"19",y2:"22",key:"x3vr5v"}],["circle",{cx:"12",cy:"12",r:"7",key:"fim9np"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],xF=_s("locate-fixed",vF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const bF=[["path",{d:"M14.106 5.553a2 2 0 0 0 1.788 0l3.659-1.83A1 1 0 0 1 21 4.619v12.764a1 1 0 0 1-.553.894l-4.553 2.277a2 2 0 0 1-1.788 0l-4.212-2.106a2 2 0 0 0-1.788 0l-3.659 1.83A1 1 0 0 1 3 19.381V6.618a1 1 0 0 1 .553-.894l4.553-2.277a2 2 0 0 1 1.788 0z",key:"169xi5"}],["path",{d:"M15 5.764v15",key:"1pn4in"}],["path",{d:"M9 3.236v15",key:"1uimfh"}]],wF=_s("map",bF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const SF=[["path",{d:"M11 21.73a2 2 0 0 0 2 0l7-4A2 2 0 0 0 21 16V8a2 2 0 0 0-1-1.73l-7-4a2 2 0 0 0-2 0l-7 4A2 2 0 0 0 3 8v8a2 2 0 0 0 1 1.73z",key:"1a0edw"}],["path",{d:"M12 22V12",key:"d0xqtd"}],["polyline",{points:"3.29 7 12 12 20.71 7",key:"ousv84"}],["path",{d:"m7.5 4.27 9 5.15",key:"1c824w"}]],TF=_s("package",SF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const AF=[["rect",{width:"5",height:"5",x:"3",y:"3",rx:"1",key:"1tu5fj"}],["rect",{width:"5",height:"5",x:"16",y:"3",rx:"1",key:"1v8r4q"}],["rect",{width:"5",height:"5",x:"3",y:"16",rx:"1",key:"1x03jg"}],["path",{d:"M21 16h-3a2 2 0 0 0-2 2v3",key:"177gqh"}],["path",{d:"M21 21v.01",key:"ents32"}],["path",{d:"M12 7v3a2 2 0 0 1-2 2H7",key:"8crl2c"}],["path",{d:"M3 12h.01",key:"nlz23k"}],["path",{d:"M12 3h.01",key:"n36tog"}],["path",{d:"M12 16v.01",key:"133mhm"}],["path",{d:"M16 12h1",key:"1slzba"}],["path",{d:"M21 12v.01",key:"1lwtk9"}],["path",{d:"M12 21v-1",key:"1880an"}]],EF=_s("qr-code",AF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const CF=[["path",{d:"M9.671 4.136a2.34 2.34 0 0 1 4.659 0 2.34 2.34 0 0 0 3.319 1.915 2.34 2.34 0 0 1 2.33 4.033 2.34 2.34 0 0 0 0 3.831 2.34 2.34 0 0 1-2.33 4.033 2.34 2.34 0 0 0-3.319 1.915 2.34 2.34 0 0 1-4.659 0 2.34 2.34 0 0 0-3.32-1.915 2.34 2.34 0 0 1-2.33-4.033 2.34 2.34 0 0 0 0-3.831A2.34 2.34 0 0 1 6.35 6.051a2.34 2.34 0 0 0 3.319-1.915",key:"1i5ecw"}],["circle",{cx:"12",cy:"12",r:"3",key:"1v7zrd"}]],IF=_s("settings",CF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const RF=[["polyline",{points:"14.5 17.5 3 6 3 3 6 3 17.5 14.5",key:"1hfsw2"}],["line",{x1:"13",x2:"19",y1:"19",y2:"13",key:"1vrmhu"}],["line",{x1:"16",x2:"20",y1:"16",y2:"20",key:"1bron3"}],["line",{x1:"19",x2:"21",y1:"21",y2:"19",key:"13pww6"}]],MF=_s("sword",RF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const DF=[["circle",{cx:"12",cy:"12",r:"10",key:"1mglay"}],["circle",{cx:"12",cy:"12",r:"6",key:"1vlfrh"}],["circle",{cx:"12",cy:"12",r:"2",key:"1c9p78"}]],OF=_s("target",DF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const PF=[["path",{d:"M16 7h6v6",key:"box55l"}],["path",{d:"m22 7-8.5 8.5-5-5L2 17",key:"1t1m79"}]],LF=_s("trending-up",PF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const BF=[["path",{d:"M18 6 6 18",key:"1bl5f8"}],["path",{d:"m6 6 12 12",key:"d8bk6v"}]],zF=_s("x",BF);/**
 * @license lucide-react v0.544.0 - ISC
 *
 * This source code is licensed under the ISC license.
 * See the LICENSE file in the root directory of this source tree.
 */const FF=[["path",{d:"M4 14a1 1 0 0 1-.78-1.63l9.9-10.2a.5.5 0 0 1 .86.46l-1.92 6.02A1 1 0 0 0 13 10h7a1 1 0 0 1 .78 1.63l-9.9 10.2a.5.5 0 0 1-.86-.46l1.92-6.02A1 1 0 0 0 11 14z",key:"1xq2db"}]],CR=_s("zap",FF),By=$4,Ey={all:["player"],profile:()=>[...Ey.all,"profile"],stats:()=>[...Ey.all,"stats"]};function kF(){return Vv({queryKey:Ey.profile(),queryFn:async()=>await W_.query(By.player.getProfile,{})??null,enabled:!0})}function NF(){return Vv({queryKey:Ey.stats(),queryFn:async()=>{const r=await W_.query(By.player.getStats,{});return r||{completedQuests:0,totalQuests:0,currentPhase:1,experienceGained:0,daysSinceStart:1}}})}function VF(){const r=$w();return g5({mutationFn:async()=>await W_.mutation(By.player.bootstrap,{}),onSuccess:()=>{r.invalidateQueries({queryKey:Ey.all})},onError:e=>{console.error("[Player] Bootstrap failed:",e)}})}const dC=r=>{let e;const o=new Set,l=(D,L)=>{const U=typeof D=="function"?D(e):D;if(!Object.is(U,e)){const q=e;e=L??(typeof U!="object"||U===null)?U:Object.assign({},e,U),o.forEach(Z=>Z(e,q))}},h=()=>e,n={setState:l,getState:h,getInitialState:()=>C,subscribe:D=>(o.add(D),()=>o.delete(D))},C=e=r(l,h,n);return n},UF=(r=>r?dC(r):dC),jF=r=>r;function GF(r,e=jF){const o=sm.useSyncExternalStore(r.subscribe,sm.useCallback(()=>e(r.getState()),[r,e]),sm.useCallback(()=>e(r.getInitialState()),[r,e]));return sm.useDebugValue(o),o}const HF=r=>{const e=UF(r),o=l=>GF(e,l);return Object.assign(o,e),o},qv=(r=>HF);function $v(r,e){let o;try{o=r()}catch{return}return{getItem:h=>{var m;const b=C=>C===null?null:JSON.parse(C,void 0),n=(m=o.getItem(h))!=null?m:null;return n instanceof Promise?n.then(b):b(n)},setItem:(h,m)=>o.setItem(h,JSON.stringify(m,void 0)),removeItem:h=>o.removeItem(h)}}const yw=r=>e=>{try{const o=r(e);return o instanceof Promise?o:{then(l){return yw(l)(o)},catch(l){return this}}}catch(o){return{then(l){return this},catch(l){return yw(l)(o)}}}},qF=(r,e)=>(o,l,h)=>{let m={storage:$v(()=>localStorage),partialize:ne=>ne,version:0,merge:(ne,be)=>({...be,...ne}),...e},b=!1;const n=new Set,C=new Set;let D=m.storage;if(!D)return r((...ne)=>{console.warn(`[zustand persist middleware] Unable to update item '${m.name}', the given storage is currently unavailable.`),o(...ne)},l,h);const L=()=>{const ne=m.partialize({...l()});return D.setItem(m.name,{state:ne,version:m.version})},U=h.setState;h.setState=(ne,be)=>(U(ne,be),L());const q=r((...ne)=>(o(...ne),L()),l,h);h.getInitialState=()=>q;let Z;const ie=()=>{var ne,be;if(!D)return;b=!1,n.forEach(we=>{var Pe;return we((Pe=l())!=null?Pe:q)});const ve=((be=m.onRehydrateStorage)==null?void 0:be.call(m,(ne=l())!=null?ne:q))||void 0;return yw(D.getItem.bind(D))(m.name).then(we=>{if(we)if(typeof we.version=="number"&&we.version!==m.version){if(m.migrate){const Pe=m.migrate(we.state,we.version);return Pe instanceof Promise?Pe.then(Ze=>[!0,Ze]):[!0,Pe]}console.error("State loaded from storage couldn't be migrated since no migrate function was provided")}else return[!1,we.state];return[!1,void 0]}).then(we=>{var Pe;const[Ze,$e]=we;if(Z=m.merge($e,(Pe=l())!=null?Pe:q),o(Z,!0),Ze)return L()}).then(()=>{ve?.(Z,void 0),Z=l(),b=!0,C.forEach(we=>we(Z))}).catch(we=>{ve?.(void 0,we)})};return h.persist={setOptions:ne=>{m={...m,...ne},ne.storage&&(D=ne.storage)},clearStorage:()=>{D?.removeItem(m.name)},getOptions:()=>m,rehydrate:()=>ie(),hasHydrated:()=>b,onHydrate:ne=>(n.add(ne),()=>{n.delete(ne)}),onFinishHydration:ne=>(C.add(ne),()=>{C.delete(ne)})},m.skipHydration||ie(),Z||q},C2=qF,pC={ui:{sidebarCollapsed:!1,activeSection:"dashboard",theme:"dark",animations:!0,notifications:!0},geolocation:{isEnabled:!1,isLoading:!1,position:null,error:null,lastUpdate:null},cache:{isAvailable:!1,lastUpdate:null,size:0,version:"1.0.0",pendingUpdates:0},performance:{loadTime:0,renderTime:0,memoryUsage:0,networkStatus:"online",lastSync:null},preferences:{autoRefresh:!0,refreshInterval:30,soundEnabled:!0,vibrationEnabled:!0,compactMode:!1,showTutorials:!0,language:"ru"},session:{startTime:new Date,pageViews:0,interactionCount:0,lastActivity:new Date},temp:{pendingNotifications:[],draggedItem:null,modalStack:[],loadingStates:{}}},I2=qv()(C2((r,e)=>({...pC,toggleSidebar:()=>r(o=>({ui:{...o.ui,sidebarCollapsed:!o.ui.sidebarCollapsed}})),setActiveSection:o=>r(l=>({ui:{...l.ui,activeSection:o}})),setTheme:o=>r(l=>({ui:{...l.ui,theme:o}})),updateGeolocation:o=>r(l=>({geolocation:{...l.geolocation,position:o,lastUpdate:new Date,error:null,isLoading:!1}})),setGeolocationError:o=>r(l=>({geolocation:{...l.geolocation,error:o,isLoading:!1}})),setGeolocationLoading:o=>r(l=>({geolocation:{...l.geolocation,isLoading:o}})),updateCacheStatus:o=>r(l=>({cache:{...l.cache,...o}})),recordPerformanceMetric:o=>r(l=>({performance:{...l.performance,...o}})),updatePreferences:o=>r(l=>({preferences:{...l.preferences,...o}})),recordInteraction:()=>r(o=>({session:{...o.session,interactionCount:o.session.interactionCount+1,lastActivity:new Date}})),recordPageView:()=>r(o=>({session:{...o.session,pageViews:o.session.pageViews+1,lastActivity:new Date}})),addNotification:o=>r(l=>({temp:{...l.temp,pendingNotifications:[...l.temp.pendingNotifications,o]}})),removeNotification:o=>r(l=>({temp:{...l.temp,pendingNotifications:l.temp.pendingNotifications.filter(h=>h!==o)}})),setDraggedItem:o=>r(l=>({temp:{...l.temp,draggedItem:o}})),pushModal:o=>r(l=>({temp:{...l.temp,modalStack:[...l.temp.modalStack,o]}})),popModal:()=>r(o=>({temp:{...o.temp,modalStack:o.temp.modalStack.slice(0,-1)}})),setLoading:(o,l)=>r(h=>({temp:{...h.temp,loadingStates:{...h.temp.loadingStates,[o]:l}}})),reset:()=>r(()=>({...pC,session:{startTime:new Date,pageViews:0,interactionCount:0,lastActivity:new Date},temp:{pendingNotifications:[],draggedItem:null,modalStack:[],loadingStates:{}}})),clearSession:()=>r(()=>({session:{startTime:new Date,pageViews:0,interactionCount:0,lastActivity:new Date},temp:{pendingNotifications:[],draggedItem:null,modalStack:[],loadingStates:{}}}))}),{name:"dashboard-storage",storage:$v(()=>typeof window<"u"&&window.localStorage?window.localStorage:{getItem:()=>null,setItem:()=>{},removeItem:()=>{}}),partialize:r=>({ui:{...r.ui,sidebarCollapsed:r.ui.sidebarCollapsed,activeSection:r.ui.activeSection,theme:r.ui.theme,animations:r.ui.animations,notifications:r.ui.notifications},preferences:r.preferences})})),iv={default:()=>({initial:{opacity:0,y:18},animate:{opacity:1,y:0},hover:{y:-4},tap:{scale:.98}}),"hover-lift":()=>({initial:{opacity:0,y:20,scale:.98},animate:{opacity:1,y:0,scale:1},hover:{y:-10,scale:1.04},tap:{scale:.97}}),"press-scale":()=>({initial:{opacity:0,scale:.94},animate:{opacity:1,scale:1},hover:{scale:1.03},tap:{scale:.92}}),glow:(r="var(--shadow-card-hover)")=>({initial:{opacity:0,boxShadow:"0 0 0 rgba(99,102,241,0)"},animate:{opacity:1,boxShadow:r},hover:{boxShadow:"0 0 42px rgba(99,102,241,0.5)"},tap:{scale:.98}})},nv=(r=.12)=>({hidden:{opacity:0},visible:{opacity:1,transition:{staggerChildren:r,delayChildren:.1}}}),$F={enter:{duration:.28,ease:[.25,.8,.25,1]},hover:{duration:.2,ease:"easeOut"},tap:{duration:.12,ease:"easeOut"}},XF={enter:{duration:.18,ease:[.34,1.56,.64,1]},hover:{duration:.16,ease:[.34,1.56,.64,1]},tap:{duration:.1,ease:[.42,0,.58,1]}},ZF={enter:{duration:.24,ease:[.22,1,.36,1]},hover:{duration:.18,ease:[.22,1,.36,1]},tap:{duration:.14,ease:[.4,0,.2,1]}},WF={enter:{duration:.32,ease:[.16,1,.3,1]},hover:{duration:.26,ease:[.16,1,.3,1]},tap:{duration:.18,ease:[.16,1,.3,1]}},mC={ui:{variants:iv,container:r=>nv(r),transitions:$F},button:{variants:{...iv,default:()=>({initial:{opacity:0,scale:.94},animate:{opacity:1,scale:1},hover:{scale:1.04},tap:{scale:.9}})},container:r=>nv(r),transitions:XF},gameplay:{variants:iv,container:r=>nv(r),transitions:ZF},system:{variants:iv,container:r=>nv(r),transitions:WF}},YF={getPreset:r=>mC[r]??mC.ui};function QF(r,e){const o=YF.getPreset(r);return{card:o.variants[e]??o.variants.default,container:o.container,transition:o.transitions.enter}}function IR(r="ui",e="default"){const o=QF(r,e);return{variants:{card:o.card,container:o.container},transition:o.transition}}const KF={low:"var(--shadow-card)",medium:"var(--shadow-card-hover)",high:"0 0 64px rgba(99, 102, 241, 0.6)"};function Bd({children:r,variant:e="default",className:o="",motionContext:l="ui",intensity:h="medium",...m}){const{variants:b,transition:n}=IR(l,e),C=KF[h];return rt.jsxs(ms.div,{className:`group glass-panel relative overflow-hidden rounded-2xl border border-white/5 ${o}`,variants:b.card(C),initial:"initial",animate:"animate",whileHover:"hover",whileTap:"tap",transition:n,...m,children:[rt.jsx("span",{className:"pointer-events-none absolute inset-[1px] rounded-[1.05rem] border border-white/30"}),rt.jsxs("div",{className:"pointer-events-none absolute inset-0 opacity-60 transition-opacity duration-500 mix-blend-screen group-hover:opacity-90",children:[rt.jsx("div",{className:"absolute -inset-20 bg-[radial-gradient(circle_at_center,rgba(99,102,241,0.22),transparent_60%)]"}),rt.jsx("div",{className:"absolute inset-0 bg-[linear-gradient(135deg,rgba(79,70,229,0.12),rgba(14,165,233,0.08)_40%,rgba(244,114,182,0.05))]"})]}),rt.jsx("div",{className:"relative z-10",children:r})]})}function R2({children:r,stagger:e=.1,direction:o="up",className:l="",context:h="ui",...m}){const{variants:b,transition:n}=IR(h),C=30,L={hidden:{opacity:0,...{up:{y:C},down:{y:-C},left:{x:C},right:{x:-C}}[o]},visible:{opacity:1,x:0,y:0,transition:n}};return rt.jsx(ms.div,{className:l,variants:b.container(e),initial:"hidden",animate:"visible",...m,children:Array.isArray(r)?r.map((U,q)=>rt.jsx(ms.div,{variants:L,children:U},q)):rt.jsx(ms.div,{variants:L,children:r})})}function vw({error:r,onRetry:e}){return rt.jsxs("div",{className:"glass-panel relative overflow-hidden rounded-2xl border border-[color:var(--color-danger)]/40 px-8 py-10 text-center",children:[rt.jsx("div",{className:"badge-glow mx-auto mb-5 bg-[linear-gradient(135deg,rgba(249,115,22,0.85),rgba(239,68,68,0.85))] text-[color:var(--color-bg)]",children:"Сбой синхронизации"}),rt.jsx("p",{className:"mb-6 font-mono text-xs uppercase tracking-[0.28em] text-[color:var(--color-text-secondary)]",children:r.message}),e&&rt.jsx("button",{onClick:e,className:"inline-flex items-center justify-center rounded-full border border-[color:var(--color-border-strong)]/60 bg-[color:var(--color-surface-elevated)] px-6 py-2 text-xs uppercase tracking-[0.32em] text-[color:var(--color-text-primary)] transition hover:border-[color:var(--color-cyan)]/70 hover:text-[color:var(--color-cyan)]",children:"Повторить"})]})}function RR({message:r="Загрузка данных",className:e=""}){return rt.jsxs("div",{className:`flex items-center justify-center py-8 text-[color:var(--color-text-muted)] ${e}`,children:[rt.jsx(ms.span,{className:"mr-3",animate:{rotate:360},transition:{repeat:1/0,duration:1.2,ease:"linear"},children:rt.jsx(ER,{className:"h-5 w-5 text-[color:var(--color-cyan)]"})}),rt.jsx("span",{className:"font-mono text-xs uppercase tracking-[0.32em]",children:r})]})}function JF({className:r=""}){const{data:e,isLoading:o,error:l,refetch:h}=kF(),{data:m,isLoading:b,error:n,refetch:C}=NF();if(o||b)return rt.jsx(Bd,{variant:"glow",motionContext:"ui",className:`panel-hero px-8 py-6 ${r}`,children:rt.jsx(RR,{})});if(l)return rt.jsx(Bd,{variant:"glow",motionContext:"ui",className:`panel-hero px-8 py-6 ${r}`,children:rt.jsx(vw,{error:l,onRetry:()=>h()})});if(n)return rt.jsx(Bd,{variant:"glow",motionContext:"ui",className:`panel-hero px-8 py-6 ${r}`,children:rt.jsx(vw,{error:n,onRetry:()=>C()})});const D=e?.phase??1,L=e?.fame??0,U=m?.completedQuests??0,q=m?.totalQuests??0,Z=m?.daysSinceStart??1,ie=ne=>{switch(ne){case 1:return"Беженец";case 2:return"Житель";case 3:return"Активист";default:return`Фаза ${ne}`}};return rt.jsx(Bd,{variant:"glow",motionContext:"ui",className:`panel-hero px-8 py-6 h-full ${r}`,children:rt.jsxs("div",{className:"relative z-10 flex flex-col gap-6",children:[rt.jsxs("div",{className:"flex flex-col justify-between gap-6 md:flex-row md:items-start",children:[rt.jsxs("div",{children:[rt.jsx("div",{className:"badge-glow mb-4 bg-[linear-gradient(135deg,rgba(79,70,229,0.85),rgba(14,165,233,0.85))] text-[color:var(--color-bg)]",children:"Активный профиль"}),rt.jsx("h2",{className:"text-2xl font-semibold text-[color:var(--color-text-primary)]",children:"Статус игрока"}),rt.jsx("p",{className:"mt-1 font-mono text-xs uppercase tracking-[0.38em] text-[color:var(--color-text-muted)]",children:ie(D)})]}),rt.jsxs(ms.div,{className:"glass-panel relative flex min-w-[180px] flex-col items-end rounded-xl border border-[color:var(--color-border-strong)]/70 px-6 py-4 text-right",variants:{initial:{opacity:0,y:16,scale:.96},animate:{opacity:1,y:0,scale:1},hover:{scale:1.05}},initial:"initial",animate:"animate",whileHover:"hover",transition:{duration:.24,ease:"easeOut"},children:[rt.jsx("span",{className:"font-mono text-[10px] uppercase tracking-[0.3em] text-[color:var(--color-text-muted)]",children:"Репутация"}),rt.jsxs("div",{className:"mt-2 flex items-baseline gap-2 font-heading",children:[rt.jsx("span",{className:"text-3xl font-semibold text-[color:var(--color-cyan)]",children:L}),rt.jsx(CR,{className:"h-4 w-4 text-[color:var(--color-cyan)]"})]})]})]}),rt.jsxs(R2,{className:"grid grid-cols-1 gap-4 sm:grid-cols-2 lg:grid-cols-4",context:"ui",stagger:.08,children:[rt.jsxs(ms.div,{className:"glass-panel rounded-xl border border-white/10 px-5 py-4 text-left",children:[rt.jsxs("div",{className:"flex items-center gap-2 text-[color:var(--color-text-muted)]",children:[rt.jsx(OF,{className:"h-4 w-4 text-[color:var(--color-magenta)]"}),rt.jsx("span",{className:"text-[11px] uppercase tracking-[0.28em]",children:"Квестов завершено"})]}),rt.jsxs("div",{className:"mt-3 flex items-baseline gap-2",children:[rt.jsxs("span",{className:"text-2xl font-semibold text-[color:var(--color-text-primary)]",children:[U,"/",q]}),rt.jsx("span",{className:"text-[11px] text-[color:var(--color-text-muted)]",children:"за всё время"})]})]}),rt.jsxs(ms.div,{className:"glass-panel rounded-xl border border-white/10 px-5 py-4 text-left",children:[rt.jsxs("div",{className:"flex items-center gap-2 text-[color:var(--color-text-muted)]",children:[rt.jsx(LF,{className:"h-4 w-4 text-[color:var(--color-cyan)]"}),rt.jsx("span",{className:"text-[11px] uppercase tracking-[0.28em]",children:"Опыта получено"})]}),rt.jsxs("div",{className:"mt-3 flex items-baseline gap-2",children:[rt.jsx("span",{className:"text-2xl font-semibold text-[color:var(--color-text-primary)]",children:L}),rt.jsx("span",{className:"text-[11px] text-[color:var(--color-text-muted)]",children:"единиц"})]})]}),rt.jsxs(ms.div,{className:"glass-panel rounded-xl border border-white/10 px-5 py-4 text-left",children:[rt.jsxs("div",{className:"flex items-center gap-2 text-[color:var(--color-text-muted)]",children:[rt.jsx(hF,{className:"h-4 w-4 text-[color:var(--color-amber)]"}),rt.jsx("span",{className:"text-[11px] uppercase tracking-[0.28em]",children:"Дней в игре"})]}),rt.jsxs("div",{className:"mt-3 flex items-baseline gap-2",children:[rt.jsx("span",{className:"text-2xl font-semibold text-[color:var(--color-text-primary)]",children:Z}),rt.jsx("span",{className:"text-[11px] text-[color:var(--color-text-muted)]",children:"со старта"})]})]}),rt.jsxs(ms.div,{className:"glass-panel rounded-xl border border-white/10 px-5 py-4 text-left",children:[rt.jsxs("div",{className:"flex items-center gap-2 text-[color:var(--color-text-muted)]",children:[rt.jsx(lF,{className:"h-4 w-4 text-[color:var(--color-magenta)]"}),rt.jsx("span",{className:"text-[11px] uppercase tracking-[0.28em]",children:"Фаза развития"})]}),rt.jsxs("div",{className:"mt-3 flex items-baseline gap-2",children:[rt.jsx("span",{className:"text-2xl font-semibold text-[color:var(--color-text-primary)]",children:D}),rt.jsx("span",{className:"text-[11px] text-[color:var(--color-text-muted)]",children:"уровень"})]})]})]})]})})}const ek=[{id:"qr",icon:EF,label:"QR Сканер",description:"Сканировать код локации",path:"/qr",color:"text-[color:var(--color-cyan)]",bgColor:"bg-[linear-gradient(135deg,rgba(14,165,233,0.2),rgba(79,70,229,0.08))]",borderColor:"border-white/10",isEnabled:!0},{id:"map",icon:wF,label:"Карта",description:"Открыть игровую карту",path:"/enhanced-map",color:"text-[color:var(--color-amber)]",bgColor:"bg-[linear-gradient(135deg,rgba(250,204,21,0.16),rgba(59,130,246,0.06))]",borderColor:"border-white/10",isEnabled:!0},{id:"quests",icon:AR,label:"Квесты",description:"Управление заданиями",path:"/quests",color:"text-[color:var(--color-magenta)]",bgColor:"bg-[linear-gradient(135deg,rgba(236,72,153,0.2),rgba(79,70,229,0.08))]",borderColor:"border-white/10",isEnabled:!0},{id:"combat",icon:MF,label:"Бой",description:"Карточная боевая система",path:"/enhanced-combat",color:"text-[color:var(--color-danger)]",bgColor:"bg-[linear-gradient(135deg,rgba(249,115,22,0.22),rgba(239,68,68,0.1))]",borderColor:"border-white/10",isEnabled:!0},{id:"inventory",icon:TF,label:"Инвентарь",description:"Управление предметами",path:"/inventory",color:"text-[color:var(--color-success)]",bgColor:"bg-[linear-gradient(135deg,rgba(34,197,94,0.18),rgba(14,165,233,0.08))]",borderColor:"border-white/10",isEnabled:!0},{id:"settings",icon:IF,label:"Настройки",description:"Параметры игры",path:"/settings",color:"text-[color:var(--color-text-muted)]",bgColor:"bg-[linear-gradient(135deg,rgba(148,163,184,0.18),rgba(30,41,59,0.12))]",borderColor:"border-white/10",isEnabled:!0}];function tk({className:r=""}){const{recordInteraction:e}=I2();return rt.jsxs(Bd,{motionContext:"ui",className:`panel-secondary px-6 py-6 h-full ${r}`,children:[rt.jsxs("div",{className:"mb-5 flex items-center justify-between",children:[rt.jsx("span",{className:"panel-section-title",children:"Быстрые действия"}),rt.jsx("span",{className:"hidden text-xs uppercase tracking-[0.28em] text-[color:var(--color-text-muted)] sm:block",children:new Date().toLocaleTimeString([],{hour:"2-digit",minute:"2-digit"})})]}),rt.jsx(R2,{stagger:.08,className:"grid grid-cols-2 gap-3 lg:grid-cols-3 xl:grid-cols-2",context:"ui",children:ek.map(o=>rt.jsx(rk,{action:o,onAction:e},o.id))})]})}function rk({action:r,onAction:e}){const o=rt.jsx(ms.div,{className:`quick-action ${r.bgColor}`,variants:{hidden:{opacity:0,y:12},visible:{opacity:1,y:0},hover:{y:-6,scale:1.02},tap:{scale:.97},disabled:{opacity:.5}},initial:"hidden",animate:"visible",whileHover:r.isEnabled?"hover":"disabled",whileTap:r.isEnabled?"tap":void 0,transition:{duration:.3,ease:"easeOut"},children:rt.jsxs("div",{className:"relative z-10 text-center",children:[rt.jsx("span",{className:"pointer-events-none absolute inset-x-6 top-2 mx-auto h-[1px] bg-[linear-gradient(90deg,transparent,rgba(99,102,241,0.6),transparent)]"}),rt.jsx(r.icon,{size:30,className:`mx-auto mb-3 ${r.color}`}),rt.jsx("div",{className:"font-heading text-sm uppercase tracking-[0.18em] text-[color:var(--color-text-primary)]",children:r.label}),rt.jsx("div",{className:"mt-1 text-xs text-[color:var(--color-text-muted)]",children:r.description})]})});return r.isEnabled?rt.jsx(My,{to:r.path,onClick:e,className:"block",children:o}):rt.jsx("div",{className:"cursor-not-allowed opacity-50",children:o})}class ik{listeners=new Set;subscribe(e){return this.listeners.add(e),()=>this.listeners.delete(e)}publish(e){const o="timestamp"in e?e:{...e,timestamp:Date.now()};this.listeners.forEach(l=>{try{l(o)}catch(h){console.error("[QuestEvents] Handler error:",h)}})}}const nk=new ik;function C_(r){nk.publish(r)}function ok(r){const e=[r.type,r.questId,r.step??"",r.from??"",r.to??"",JSON.stringify(r.context??{})];let o=0;for(const l of e)for(let h=0;h<l.length;h+=1)o=o*31+l.charCodeAt(h)>>>0;return o}function ak(r){if(typeof r.timestamp=="number")return r.timestamp;const e=r.context&&typeof r.context.createdAt=="number"?r.context.createdAt:null;return e!==null?e:ok(r)}function sk(r,e){const o=[];for(const l of r){const{id:h,currentStep:m,completedAt:b}=l;if(b)o.push({type:"quest.completed",questId:h,step:m,context:{source:e,completedAt:b},timestamp:b});else if(m!=="not_started"){const n={type:"quest.started",questId:h,step:m,context:{source:e}};o.push({...n,timestamp:ak(n)})}}return o}const lk=qv()(C2((r,e)=>({events:[],addEvent:o=>r(l=>({events:[...l.events,o].slice(-1e3)})),reset:o=>r(()=>({events:o})),getEventsByQuest:o=>e().events.filter(l=>l.questId===o),getEventsByType:o=>e().events.filter(l=>l.type===o),clear:()=>r(()=>({events:[]}))}),{name:"quest-event-log",version:1,storage:$v(()=>typeof window<"u"&&window.localStorage?window.localStorage:{getItem:()=>null,setItem:()=>{},removeItem:()=>{}}),partialize:r=>({events:r.events})}));function Ib(r,e){return{id:r,currentStep:e,startedAt:Date.now()}}const MR=qv()(C2((r,e)=>({activeQuests:{},completedQuests:[],trackedQuestId:void 0,quests:{},startQuest:(o,l)=>r(h=>{Fn.info("STORE","startQuest",o,l),C_({type:"quest.started",questId:o,step:l,context:{origin:"questStore.startQuest"}});const m=(h.completedQuests??[]).filter(C=>C!==o),b=h.trackedQuestId??o,n={...h.activeQuests,[o]:Ib(o,l)};return{activeQuests:n,completedQuests:m,trackedQuestId:b,quests:n}}),advanceQuest:(o,l)=>r(h=>{Fn.info("STORE","advanceQuest",o,"->",l);const m=h.activeQuests[o]?.currentStep;if(m===l)return{};C_({type:"quest.advanced",questId:o,from:m??"not_started",to:l,context:{origin:"questStore.advanceQuest"}});const b={...h.activeQuests,[o]:{...h.activeQuests[o]??Ib(o,l),currentStep:l}};return{activeQuests:b,quests:b}}),completeQuest:o=>r(l=>{Fn.info("STORE","completeQuest",o);const{[o]:h,...m}=l.activeQuests,b=h?.currentStep??"completed";C_({type:"quest.completed",questId:o,step:b,context:{origin:"questStore.completeQuest"}});let n=l.trackedQuestId;return n===o&&(n=Object.values(m)[0]?.id),{activeQuests:m,completedQuests:Array.from(new Set([...l.completedQuests??[],o])),trackedQuestId:n,quests:m}}),applyBatch:o=>r(l=>{const h={...l.activeQuests},m=new Set(l.completedQuests??[]);let b=l.trackedQuestId;for(const n of o)if(n.completedAt){const C=h[n.id];C&&C_({type:"quest.completed",questId:n.id,step:C.currentStep,context:{origin:"questStore.applyBatch"}}),delete h[n.id],m.add(n.id),b===n.id&&(b=Object.values(h)[0]?.id)}else if(n.step){const C=h[n.id]?.currentStep;C?C!==n.step&&C_({type:"quest.advanced",questId:n.id,from:C,to:n.step,context:{origin:"questStore.applyBatch"}}):C_({type:"quest.started",questId:n.id,step:n.step,context:{origin:"questStore.applyBatch"}}),h[n.id]={...h[n.id]??Ib(n.id,n.step),currentStep:n.step},m.delete(n.id),b||(b=n.id)}return Fn.info("STORE","applyBatch",{quests:o}),{activeQuests:h,completedQuests:Array.from(m),trackedQuestId:b,quests:h}}),hydrate:o=>{const l=sk(o.map(h=>({id:h.id,currentStep:h.currentStep,completedAt:h.completedAt??void 0})),"server");lk.getState().reset(l),r(h=>{const m={},b=[],n=Date.now();for(const L of o)L.completedAt?b.push(L.id):m[L.id]={id:L.id,currentStep:L.currentStep,startedAt:n};Fn.info("STORE","hydrate",{activeKeys:Object.keys(m),completed:b});const C=Object.values(m)[0],D=h.trackedQuestId??C?.id;return{activeQuests:m,completedQuests:b,trackedQuestId:D,quests:m}})},setTrackedQuest:o=>r(()=>({trackedQuestId:o}))}),{name:"quest-progress",version:2,storage:$v(()=>typeof window<"u"&&window.localStorage?window.localStorage:{getItem:()=>null,setItem:()=>{},removeItem:()=>{}}),partialize:r=>({activeQuests:r.activeQuests,completedQuests:r.completedQuests,trackedQuestId:r.trackedQuestId,quests:r.quests}),migrate:(r,e)=>{if(!r||typeof r!="object")return r;const o=r;return o.quests?o:{...o,quests:o.activeQuests??{}}}})),gC="grenzwanderer_device_id";function Rb(){return"xxxx-xxxx-4xxx-yxxx-xxxx".replace(/[xy]/g,r=>{const e=Math.random()*16|0;return(r==="x"?e:e&3|8).toString(16)})}function _C(){try{if(typeof window<"u"&&window.localStorage){let r=window.localStorage.getItem(gC);return r?Fn.debug(`[DeviceId] Используется существующий ID: ${r}`):(r=Rb(),window.localStorage.setItem(gC,r),Fn.info(`[DeviceId] Сгенерирован новый ID: ${r}`)),r}return Fn.warn("[DeviceId] localStorage недоступен, генерирую временный ID"),Rb()}catch(r){return Fn.error("[DeviceId] Ошибка при получении deviceId:",r),Rb()}}function yC(r){return/^[a-f0-9]{8}-[a-f0-9]{4}-4[a-f0-9]{3}-[89ab][a-f0-9]{3}-[a-f0-9]{12}$/i.test(r)}function DR(){const[r,e]=Xe.useState(()=>_C()),[o,l]=Xe.useState(!0);return Xe.useEffect(()=>{try{const h=_C();yC(h)||Fn.warn("[useDeviceId] Получен невалидный deviceId, генерирую новый"),e(h),l(!1),Fn.debug(`[useDeviceId] DeviceId получен: ${h}`)}catch(h){Fn.error("[useDeviceId] Ошибка при получении deviceId:",h),l(!1)}},[]),{deviceId:r,isLoading:o,isValid:yC(r)}}const B_={all:["quests"],active:()=>[...B_.all,"active"],completed:()=>[...B_.all,"completed"],available:()=>[...B_.all,"available"],stats:()=>[...B_.all,"stats"]};function ck(){const{deviceId:r}=DR();return Vv({queryKey:[...B_.active(),r],queryFn:async()=>{if(!r)return Fn.warn("[useActiveQuests] DeviceId не доступен"),[];try{const e=await W_.query(By.quests.getActiveQuests,{deviceId:r});return Array.isArray(e)?e:[]}catch(e){return Fn.error("[useActiveQuests] Ошибка при получении активных квестов:",e),[]}},select:e=>{const l=MR.getState().quests??{},h=Array.isArray(e)?e.reduce((n,C)=>{if(!C)return n;const D=C.questId??C.id;return D&&(n[D]=C),n},{}):{},m=new Set([...Object.keys(h),...Object.keys(l??{})]);return Array.from(m).map(n=>{const C=h[n],D=l[n];return{questId:n,...C??{},...D??{}}}).filter(n=>n.currentStep!=="completed"&&n.currentStep!=="unavailable")}})}function uk(){const{deviceId:r}=DR();return Vv({queryKey:[...B_.all,"stats",r],queryFn:async()=>{if(!r)return Fn.warn("[useQuestStats] DeviceId не доступен"),{completedQuests:0,totalQuests:0,completionRate:0,activeQuests:0};try{return await W_.query(By.quests.getQuestStats,{deviceId:r})||{completedQuests:0,totalQuests:0,completionRate:0,activeQuests:0}}catch(e){Fn.error("[useQuestStats] Ошибка при получении статистики квестов:",e);const o=MR.getState().quests??{},l=Object.values(o).filter(m=>m&&m.currentStep==="completed").length,h=Object.keys(o).length;return{completedQuests:l,totalQuests:h,completionRate:h>0?l/h*100:0,activeQuests:h-l}}},refetchInterval:3e4})}function hk({className:r=""}){const{data:e,isLoading:o,error:l,refetch:h}=ck(),{data:m}=uk();return o?rt.jsx(Bd,{motionContext:"ui",className:`panel-secondary px-7 py-6 h-full ${r}`,children:rt.jsx(RR,{})}):l?rt.jsx(Bd,{motionContext:"ui",className:`panel-secondary px-7 py-6 h-full ${r}`,children:rt.jsx(vw,{error:l,onRetry:()=>h()})}):rt.jsx(Bd,{motionContext:"ui",className:`panel-secondary px-7 py-6 h-full ${r}`,children:rt.jsxs("div",{className:"flex flex-col gap-5",children:[rt.jsxs("div",{className:"flex items-center justify-between",children:[rt.jsxs("h3",{className:"text-lg font-semibold text-[color:var(--color-text-primary)]",children:["Активные квесты",m&&rt.jsxs("span",{className:"ml-3 rounded-full border border-[color:var(--color-border-strong)]/60 px-3 py-1 text-xs uppercase tracking-[0.26em] text-[color:var(--color-text-muted)]",children:[m.completedQuests,"/",m.totalQuests]})]}),rt.jsx("span",{className:"badge-glow hidden bg-[linear-gradient(135deg,rgba(34,211,238,0.85),rgba(249,115,22,0.85))] text-[color:var(--color-bg)] lg:inline-flex",children:"Журнал"})]}),rt.jsxs(R2,{className:"space-y-3",context:"ui",stagger:.12,children:[rt.jsx(SB,{children:e?.slice(0,3).map((b,n)=>rt.jsxs(ms.div,{className:"glass-panel flex items-center gap-4 rounded-xl border border-[color:var(--color-border-strong)]/40 px-5 py-3",initial:{opacity:0,x:-20},animate:{opacity:1,x:0},exit:{opacity:0,x:20},transition:{delay:n*.08,duration:.32,ease:"easeOut"},children:[rt.jsx("span",{className:"h-2 w-2 rounded-full bg-[color:var(--color-cyan)] shadow-[0_0_12px_rgba(34,211,238,0.65)]"}),rt.jsxs("div",{className:"flex-1",children:[rt.jsx("div",{className:"font-heading text-sm tracking-wide text-[color:var(--color-text-primary)]",children:b.questId.replace(/_/g," ")}),rt.jsxs("div",{className:"flex items-center gap-3 pt-1 text-xs text-[color:var(--color-text-muted)]",children:[rt.jsx("span",{className:"uppercase tracking-[0.28em]",children:b.currentStep||"unknown"}),rt.jsx("span",{className:"h-1 w-12 rounded-full bg-[linear-gradient(90deg,rgba(79,70,229,0.6),rgba(14,165,233,0.3))]"})]})]})]},b.questId))}),(!e||e.length===0)&&rt.jsxs(ms.div,{className:"flex flex-col items-center gap-2 py-8 text-[color:var(--color-text-muted)]",initial:{opacity:0},animate:{opacity:1},transition:{duration:.3,ease:"easeOut"},children:[rt.jsx(AR,{size:32,className:"opacity-60"}),rt.jsx("div",{className:"font-mono text-xs uppercase tracking-[0.28em]",children:"Нет активных квестов"})]})]}),rt.jsx(My,{to:"/quests",className:"mt-2 block text-center text-xs uppercase tracking-[0.32em] text-[color:var(--color-text-muted)] transition hover:text-[color:var(--color-cyan)]",children:"Посмотреть все квесты →"})]})})}function fk({className:r=""}){return rt.jsx(Bd,{motionContext:"ui",className:`panel-secondary px-7 py-6 h-full ${r}`,children:rt.jsxs("div",{className:"flex flex-col gap-5",children:[rt.jsx("span",{className:"panel-section-title",children:"Новости & Статус"}),rt.jsxs("div",{className:"space-y-4",children:[rt.jsxs(ms.div,{className:"glass-panel rounded-xl border border-[color:var(--color-border-strong)]/40 px-4 py-3",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{duration:.32,ease:"easeOut"},children:[rt.jsxs("div",{className:"flex items-center gap-3",children:[rt.jsx(CR,{className:"h-4 w-4 text-[color:var(--color-cyan)]"}),rt.jsx("span",{className:"text-sm font-medium text-[color:var(--color-text-primary)]",children:"Система активна"})]}),rt.jsx("div",{className:"mt-2 text-xs text-[color:var(--color-text-muted)]",children:"TanStack Query + Convex синхронно поддерживают данные игрока."})]}),rt.jsxs(ms.div,{className:"glass-panel rounded-xl border border-[color:var(--color-border-strong)]/40 px-4 py-3",initial:{opacity:0,y:12},animate:{opacity:1,y:0},transition:{delay:.1,duration:.32,ease:"easeOut"},children:[rt.jsxs("div",{className:"flex items-center gap-3",children:[rt.jsx(mF,{className:"h-4 w-4 text-[color:var(--color-magenta)]"}),rt.jsx("span",{className:"text-sm font-medium text-[color:var(--color-text-primary)]",children:"Модернизация UI"})]}),rt.jsx("div",{className:"mt-2 text-xs text-[color:var(--color-text-muted)]",children:"Интерфейс построен на стеклянных панелях и неоновых акцентах."})]}),rt.jsx("div",{className:"neon-divider"}),rt.jsxs("div",{className:"grid gap-2 text-xs text-[color:var(--color-text-muted)]",children:[rt.jsx("div",{children:"• Server State: TanStack Query"}),rt.jsx("div",{children:"• Local State: Zustand stores"}),rt.jsx("div",{children:"• Типизация: Convex Doc types"}),rt.jsx("div",{children:"• Кэширование: Optimistic updates"})]})]})]})})}const vC={high:{enableHighAccuracy:!0,timeout:15e3,maximumAge:1e4},balanced:{enableHighAccuracy:!1,timeout:1e4,maximumAge:3e4},low:{enableHighAccuracy:!1,timeout:5e3,maximumAge:6e4}};function dk({accuracy:r="balanced",watch:e=!1,onSuccess:o,onError:l}={}){const{geolocation:h,updateGeolocation:m,setGeolocationError:b,setGeolocationLoading:n}=I2(),C=Xe.useRef(null),D=Xe.useRef(vC[r]),L=typeof navigator<"u",U=L&&!!navigator.geolocation;Xe.useEffect(()=>{D.current=vC[r]},[r]);const q=ve=>{const{latitude:we,longitude:Pe,accuracy:Ze}=ve.coords;m({lat:we,lng:Pe,accuracy:Ze}),n(!1),o?.(ve)},Z=ve=>{let we="Неизвестная ошибка геолокации";switch(ve.code){case ve.PERMISSION_DENIED:we="Доступ к геолокации запрещен";break;case ve.POSITION_UNAVAILABLE:we="Информация о местоположении недоступна";break;case ve.TIMEOUT:we="Превышено время ожидания геолокации";break}b(we),n(!1),l?.(ve)},ie=()=>{if(!U){b("Геолокация не поддерживается браузером");return}n(!0),b(null),navigator.geolocation.getCurrentPosition(q,Z,D.current)},ne=()=>{if(!U){b("Геолокация не поддерживается браузером");return}C.current===null&&(n(!0),b(null),C.current=navigator.geolocation.watchPosition(q,Z,D.current))},be=()=>{C.current!==null&&(U&&navigator.geolocation.clearWatch(C.current),C.current=null,n(!1))};return Xe.useEffect(()=>{if(L)return e?ne():be(),()=>{be()}},[e]),Xe.useEffect(()=>{if(L)return()=>{be()}},[]),{position:h.position,isLoading:h.isLoading,error:h.error,isEnabled:h.isEnabled,lastUpdate:h.lastUpdate,getCurrentPosition:ie,startWatching:ne,stopWatching:be,isSupported:U,hasPosition:!!h.position,isAccurate:h.position?h.position.accuracy<100:!1}}function pk(r,e){var o=Object.setPrototypeOf;o?o(r,e):r.__proto__=e}function mk(r,e){e===void 0&&(e=r.constructor);var o=Error.captureStackTrace;o&&o(r,e)}var gk=(function(){var r=function(o,l){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(h,m){h.__proto__=m}||function(h,m){for(var b in m)Object.prototype.hasOwnProperty.call(m,b)&&(h[b]=m[b])},r(o,l)};return function(e,o){if(typeof o!="function"&&o!==null)throw new TypeError("Class extends value "+String(o)+" is not a constructor or null");r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),_k=(function(r){gk(e,r);function e(o,l){var h=this.constructor,m=r.call(this,o,l)||this;return Object.defineProperty(m,"name",{value:h.name,enumerable:!1,configurable:!0}),pk(m,h.prototype),mk(m),m}return e})(Error),yk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Xl=(function(r){yk(e,r);function e(o){o===void 0&&(o=void 0);var l=r.call(this,o)||this;return l.message=o,l}return e.prototype.getKind=function(){var o=this.constructor;return o.kind},e.kind="Exception",e})(_k),vk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),bh=(function(r){vk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="ArgumentException",e})(Xl),xk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),bi=(function(r){xk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="IllegalArgumentException",e})(Xl),bk=(function(){function r(e){if(this.binarizer=e,e===null)throw new bi("Binarizer must be non-null.")}return r.prototype.getWidth=function(){return this.binarizer.getWidth()},r.prototype.getHeight=function(){return this.binarizer.getHeight()},r.prototype.getBlackRow=function(e,o){return this.binarizer.getBlackRow(e,o)},r.prototype.getBlackMatrix=function(){return(this.matrix===null||this.matrix===void 0)&&(this.matrix=this.binarizer.getBlackMatrix()),this.matrix},r.prototype.isCropSupported=function(){return this.binarizer.getLuminanceSource().isCropSupported()},r.prototype.crop=function(e,o,l,h){var m=this.binarizer.getLuminanceSource().crop(e,o,l,h);return new r(this.binarizer.createBinarizer(m))},r.prototype.isRotateSupported=function(){return this.binarizer.getLuminanceSource().isRotateSupported()},r.prototype.rotateCounterClockwise=function(){var e=this.binarizer.getLuminanceSource().rotateCounterClockwise();return new r(this.binarizer.createBinarizer(e))},r.prototype.rotateCounterClockwise45=function(){var e=this.binarizer.getLuminanceSource().rotateCounterClockwise45();return new r(this.binarizer.createBinarizer(e))},r.prototype.toString=function(){try{return this.getBlackMatrix().toString()}catch{return""}},r})(),wk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Ka=(function(r){wk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.getChecksumInstance=function(){return new e},e.kind="ChecksumException",e})(Xl),Sk=(function(){function r(e){this.source=e}return r.prototype.getLuminanceSource=function(){return this.source},r.prototype.getWidth=function(){return this.source.getWidth()},r.prototype.getHeight=function(){return this.source.getHeight()},r})(),yo=(function(){function r(){}return r.arraycopy=function(e,o,l,h,m){for(;m--;)l[h++]=e[o++]},r.currentTimeMillis=function(){return Date.now()},r})(),Tk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),M2=(function(r){Tk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="IndexOutOfBoundsException",e})(Xl),Ak=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),xC=(function(r){Ak(e,r);function e(o,l){o===void 0&&(o=void 0),l===void 0&&(l=void 0);var h=r.call(this,l)||this;return h.index=o,h.message=l,h}return e.kind="ArrayIndexOutOfBoundsException",e})(M2),Ek=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ka=(function(){function r(){}return r.fill=function(e,o){for(var l=0,h=e.length;l<h;l++)e[l]=o},r.fillWithin=function(e,o,l,h){r.rangeCheck(e.length,o,l);for(var m=o;m<l;m++)e[m]=h},r.rangeCheck=function(e,o,l){if(o>l)throw new bi("fromIndex("+o+") > toIndex("+l+")");if(o<0)throw new xC(o);if(l>e)throw new xC(l)},r.asList=function(){for(var e=[],o=0;o<arguments.length;o++)e[o]=arguments[o];return e},r.create=function(e,o,l){var h=Array.from({length:e});return h.map(function(m){return Array.from({length:o}).fill(l)})},r.createInt32Array=function(e,o,l){var h=Array.from({length:e});return h.map(function(m){return Int32Array.from({length:o}).fill(l)})},r.equals=function(e,o){if(!e||!o||!e.length||!o.length||e.length!==o.length)return!1;for(var l=0,h=e.length;l<h;l++)if(e[l]!==o[l])return!1;return!0},r.hashCode=function(e){var o,l;if(e===null)return 0;var h=1;try{for(var m=Ek(e),b=m.next();!b.done;b=m.next()){var n=b.value;h=31*h+n}}catch(C){o={error:C}}finally{try{b&&!b.done&&(l=m.return)&&l.call(m)}finally{if(o)throw o.error}}return h},r.fillUint8Array=function(e,o){for(var l=0;l!==e.length;l++)e[l]=o},r.copyOf=function(e,o){return e.slice(0,o)},r.copyOfUint8Array=function(e,o){if(e.length<=o){var l=new Uint8Array(o);return l.set(e),l}return e.slice(0,o)},r.copyOfRange=function(e,o,l){var h=l-o,m=new Int32Array(h);return yo.arraycopy(e,o,m,0,h),m},r.binarySearch=function(e,o,l){l===void 0&&(l=r.numberComparator);for(var h=0,m=e.length-1;h<=m;){var b=m+h>>1,n=l(o,e[b]);if(n>0)h=b+1;else if(n<0)m=b-1;else return b}return-h-1},r.numberComparator=function(e,o){return e-o},r})(),pn=(function(){function r(){}return r.numberOfTrailingZeros=function(e){var o;if(e===0)return 32;var l=31;return o=e<<16,o!==0&&(l-=16,e=o),o=e<<8,o!==0&&(l-=8,e=o),o=e<<4,o!==0&&(l-=4,e=o),o=e<<2,o!==0&&(l-=2,e=o),l-(e<<1>>>31)},r.numberOfLeadingZeros=function(e){if(e===0)return 32;var o=1;return e>>>16||(o+=16,e<<=16),e>>>24||(o+=8,e<<=8),e>>>28||(o+=4,e<<=4),e>>>30||(o+=2,e<<=2),o-=e>>>31,o},r.toHexString=function(e){return e.toString(16)},r.toBinaryString=function(e){return String(parseInt(String(e),2))},r.bitCount=function(e){return e=e-(e>>>1&1431655765),e=(e&858993459)+(e>>>2&858993459),e=e+(e>>>4)&252645135,e=e+(e>>>8),e=e+(e>>>16),e&63},r.truncDivision=function(e,o){return Math.trunc(e/o)},r.parseInt=function(e,o){return o===void 0&&(o=void 0),parseInt(e,o)},r.MIN_VALUE_32_BITS=-2147483648,r.MAX_VALUE=Number.MAX_SAFE_INTEGER,r})(),Ja=(function(){function r(e,o){e===void 0?(this.size=0,this.bits=new Int32Array(1)):(this.size=e,o==null?this.bits=r.makeArray(e):this.bits=o)}return r.prototype.getSize=function(){return this.size},r.prototype.getSizeInBytes=function(){return Math.floor((this.size+7)/8)},r.prototype.ensureCapacity=function(e){if(e>this.bits.length*32){var o=r.makeArray(e);yo.arraycopy(this.bits,0,o,0,this.bits.length),this.bits=o}},r.prototype.get=function(e){return(this.bits[Math.floor(e/32)]&1<<(e&31))!==0},r.prototype.set=function(e){this.bits[Math.floor(e/32)]|=1<<(e&31)},r.prototype.flip=function(e){this.bits[Math.floor(e/32)]^=1<<(e&31)},r.prototype.getNextSet=function(e){var o=this.size;if(e>=o)return o;var l=this.bits,h=Math.floor(e/32),m=l[h];m&=~((1<<(e&31))-1);for(var b=l.length;m===0;){if(++h===b)return o;m=l[h]}var n=h*32+pn.numberOfTrailingZeros(m);return n>o?o:n},r.prototype.getNextUnset=function(e){var o=this.size;if(e>=o)return o;var l=this.bits,h=Math.floor(e/32),m=~l[h];m&=~((1<<(e&31))-1);for(var b=l.length;m===0;){if(++h===b)return o;m=~l[h]}var n=h*32+pn.numberOfTrailingZeros(m);return n>o?o:n},r.prototype.setBulk=function(e,o){this.bits[Math.floor(e/32)]=o},r.prototype.setRange=function(e,o){if(o<e||e<0||o>this.size)throw new bi;if(o!==e){o--;for(var l=Math.floor(e/32),h=Math.floor(o/32),m=this.bits,b=l;b<=h;b++){var n=b>l?0:e&31,C=b<h?31:o&31,D=(2<<C)-(1<<n);m[b]|=D}}},r.prototype.clear=function(){for(var e=this.bits.length,o=this.bits,l=0;l<e;l++)o[l]=0},r.prototype.isRange=function(e,o,l){if(o<e||e<0||o>this.size)throw new bi;if(o===e)return!0;o--;for(var h=Math.floor(e/32),m=Math.floor(o/32),b=this.bits,n=h;n<=m;n++){var C=n>h?0:e&31,D=n<m?31:o&31,L=(2<<D)-(1<<C)&4294967295;if((b[n]&L)!==(l?L:0))return!1}return!0},r.prototype.appendBit=function(e){this.ensureCapacity(this.size+1),e&&(this.bits[Math.floor(this.size/32)]|=1<<(this.size&31)),this.size++},r.prototype.appendBits=function(e,o){if(o<0||o>32)throw new bi("Num bits must be between 0 and 32");this.ensureCapacity(this.size+o);for(var l=o;l>0;l--)this.appendBit((e>>l-1&1)===1)},r.prototype.appendBitArray=function(e){var o=e.size;this.ensureCapacity(this.size+o);for(var l=0;l<o;l++)this.appendBit(e.get(l))},r.prototype.xor=function(e){if(this.size!==e.size)throw new bi("Sizes don't match");for(var o=this.bits,l=0,h=o.length;l<h;l++)o[l]^=e.bits[l]},r.prototype.toBytes=function(e,o,l,h){for(var m=0;m<h;m++){for(var b=0,n=0;n<8;n++)this.get(e)&&(b|=1<<7-n),e++;o[l+m]=b}},r.prototype.getBitArray=function(){return this.bits},r.prototype.reverse=function(){for(var e=new Int32Array(this.bits.length),o=Math.floor((this.size-1)/32),l=o+1,h=this.bits,m=0;m<l;m++){var b=h[m];b=b>>1&1431655765|(b&1431655765)<<1,b=b>>2&858993459|(b&858993459)<<2,b=b>>4&252645135|(b&252645135)<<4,b=b>>8&16711935|(b&16711935)<<8,b=b>>16&65535|(b&65535)<<16,e[o-m]=b}if(this.size!==l*32){for(var n=l*32-this.size,C=e[0]>>>n,m=1;m<l;m++){var D=e[m];C|=D<<32-n,e[m-1]=C,C=D>>>n}e[l-1]=C}this.bits=e},r.makeArray=function(e){return new Int32Array(Math.floor((e+31)/32))},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.size===o.size&&ka.equals(this.bits,o.bits)},r.prototype.hashCode=function(){return 31*this.size+ka.hashCode(this.bits)},r.prototype.toString=function(){for(var e="",o=0,l=this.size;o<l;o++)(o&7)===0&&(e+=" "),e+=this.get(o)?"X":".";return e},r.prototype.clone=function(){return new r(this.size,this.bits.slice())},r.prototype.toArray=function(){for(var e=[],o=0,l=this.size;o<l;o++)e.push(this.get(o));return e},r})(),xw;(function(r){r[r.OTHER=0]="OTHER",r[r.PURE_BARCODE=1]="PURE_BARCODE",r[r.POSSIBLE_FORMATS=2]="POSSIBLE_FORMATS",r[r.TRY_HARDER=3]="TRY_HARDER",r[r.CHARACTER_SET=4]="CHARACTER_SET",r[r.ALLOWED_LENGTHS=5]="ALLOWED_LENGTHS",r[r.ASSUME_CODE_39_CHECK_DIGIT=6]="ASSUME_CODE_39_CHECK_DIGIT",r[r.ENABLE_CODE_39_EXTENDED_MODE=7]="ENABLE_CODE_39_EXTENDED_MODE",r[r.ASSUME_GS1=8]="ASSUME_GS1",r[r.RETURN_CODABAR_START_END=9]="RETURN_CODABAR_START_END",r[r.NEED_RESULT_POINT_CALLBACK=10]="NEED_RESULT_POINT_CALLBACK",r[r.ALLOWED_EAN_EXTENSIONS=11]="ALLOWED_EAN_EXTENSIONS"})(xw||(xw={}));const Io=xw;var Ck=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Ir=(function(r){Ck(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.getFormatInstance=function(){return new e},e.kind="FormatException",e})(Xl),Ik=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Kn;(function(r){r[r.Cp437=0]="Cp437",r[r.ISO8859_1=1]="ISO8859_1",r[r.ISO8859_2=2]="ISO8859_2",r[r.ISO8859_3=3]="ISO8859_3",r[r.ISO8859_4=4]="ISO8859_4",r[r.ISO8859_5=5]="ISO8859_5",r[r.ISO8859_6=6]="ISO8859_6",r[r.ISO8859_7=7]="ISO8859_7",r[r.ISO8859_8=8]="ISO8859_8",r[r.ISO8859_9=9]="ISO8859_9",r[r.ISO8859_10=10]="ISO8859_10",r[r.ISO8859_11=11]="ISO8859_11",r[r.ISO8859_13=12]="ISO8859_13",r[r.ISO8859_14=13]="ISO8859_14",r[r.ISO8859_15=14]="ISO8859_15",r[r.ISO8859_16=15]="ISO8859_16",r[r.SJIS=16]="SJIS",r[r.Cp1250=17]="Cp1250",r[r.Cp1251=18]="Cp1251",r[r.Cp1252=19]="Cp1252",r[r.Cp1256=20]="Cp1256",r[r.UnicodeBigUnmarked=21]="UnicodeBigUnmarked",r[r.UTF8=22]="UTF8",r[r.ASCII=23]="ASCII",r[r.Big5=24]="Big5",r[r.GB18030=25]="GB18030",r[r.EUC_KR=26]="EUC_KR"})(Kn||(Kn={}));var Fa=(function(){function r(e,o,l){for(var h,m,b=[],n=3;n<arguments.length;n++)b[n-3]=arguments[n];this.valueIdentifier=e,this.name=l,typeof o=="number"?this.values=Int32Array.from([o]):this.values=o,this.otherEncodingNames=b,r.VALUE_IDENTIFIER_TO_ECI.set(e,this),r.NAME_TO_ECI.set(l,this);for(var C=this.values,D=0,L=C.length;D!==L;D++){var U=C[D];r.VALUES_TO_ECI.set(U,this)}try{for(var q=Ik(b),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value;r.NAME_TO_ECI.set(ie,this)}}catch(ne){h={error:ne}}finally{try{Z&&!Z.done&&(m=q.return)&&m.call(q)}finally{if(h)throw h.error}}}return r.prototype.getValueIdentifier=function(){return this.valueIdentifier},r.prototype.getName=function(){return this.name},r.prototype.getValue=function(){return this.values[0]},r.getCharacterSetECIByValue=function(e){if(e<0||e>=900)throw new Ir("incorect value");var o=r.VALUES_TO_ECI.get(e);if(o===void 0)throw new Ir("incorect value");return o},r.getCharacterSetECIByName=function(e){var o=r.NAME_TO_ECI.get(e);if(o===void 0)throw new Ir("incorect value");return o},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.getName()===o.getName()},r.VALUE_IDENTIFIER_TO_ECI=new Map,r.VALUES_TO_ECI=new Map,r.NAME_TO_ECI=new Map,r.Cp437=new r(Kn.Cp437,Int32Array.from([0,2]),"Cp437"),r.ISO8859_1=new r(Kn.ISO8859_1,Int32Array.from([1,3]),"ISO-8859-1","ISO88591","ISO8859_1"),r.ISO8859_2=new r(Kn.ISO8859_2,4,"ISO-8859-2","ISO88592","ISO8859_2"),r.ISO8859_3=new r(Kn.ISO8859_3,5,"ISO-8859-3","ISO88593","ISO8859_3"),r.ISO8859_4=new r(Kn.ISO8859_4,6,"ISO-8859-4","ISO88594","ISO8859_4"),r.ISO8859_5=new r(Kn.ISO8859_5,7,"ISO-8859-5","ISO88595","ISO8859_5"),r.ISO8859_6=new r(Kn.ISO8859_6,8,"ISO-8859-6","ISO88596","ISO8859_6"),r.ISO8859_7=new r(Kn.ISO8859_7,9,"ISO-8859-7","ISO88597","ISO8859_7"),r.ISO8859_8=new r(Kn.ISO8859_8,10,"ISO-8859-8","ISO88598","ISO8859_8"),r.ISO8859_9=new r(Kn.ISO8859_9,11,"ISO-8859-9","ISO88599","ISO8859_9"),r.ISO8859_10=new r(Kn.ISO8859_10,12,"ISO-8859-10","ISO885910","ISO8859_10"),r.ISO8859_11=new r(Kn.ISO8859_11,13,"ISO-8859-11","ISO885911","ISO8859_11"),r.ISO8859_13=new r(Kn.ISO8859_13,15,"ISO-8859-13","ISO885913","ISO8859_13"),r.ISO8859_14=new r(Kn.ISO8859_14,16,"ISO-8859-14","ISO885914","ISO8859_14"),r.ISO8859_15=new r(Kn.ISO8859_15,17,"ISO-8859-15","ISO885915","ISO8859_15"),r.ISO8859_16=new r(Kn.ISO8859_16,18,"ISO-8859-16","ISO885916","ISO8859_16"),r.SJIS=new r(Kn.SJIS,20,"SJIS","Shift_JIS"),r.Cp1250=new r(Kn.Cp1250,21,"Cp1250","windows-1250"),r.Cp1251=new r(Kn.Cp1251,22,"Cp1251","windows-1251"),r.Cp1252=new r(Kn.Cp1252,23,"Cp1252","windows-1252"),r.Cp1256=new r(Kn.Cp1256,24,"Cp1256","windows-1256"),r.UnicodeBigUnmarked=new r(Kn.UnicodeBigUnmarked,25,"UnicodeBigUnmarked","UTF-16BE","UnicodeBig"),r.UTF8=new r(Kn.UTF8,26,"UTF8","UTF-8"),r.ASCII=new r(Kn.ASCII,Int32Array.from([27,170]),"ASCII","US-ASCII"),r.Big5=new r(Kn.Big5,28,"Big5"),r.GB18030=new r(Kn.GB18030,29,"GB18030","GB2312","EUC_CN","GBK"),r.EUC_KR=new r(Kn.EUC_KR,30,"EUC_KR","EUC-KR"),r})(),Rk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),vv=(function(r){Rk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="UnsupportedOperationException",e})(Xl),Bu=(function(){function r(){}return r.decode=function(e,o){var l=this.encodingName(o);return this.customDecoder?this.customDecoder(e,l):typeof TextDecoder>"u"||this.shouldDecodeOnFallback(l)?this.decodeFallback(e,l):new TextDecoder(l).decode(e)},r.shouldDecodeOnFallback=function(e){return!r.isBrowser()&&e==="ISO-8859-1"},r.encode=function(e,o){var l=this.encodingName(o);return this.customEncoder?this.customEncoder(e,l):typeof TextEncoder>"u"?this.encodeFallback(e):new TextEncoder().encode(e)},r.isBrowser=function(){return typeof window<"u"&&{}.toString.call(window)==="[object Window]"},r.encodingName=function(e){return typeof e=="string"?e:e.getName()},r.encodingCharacterSet=function(e){return e instanceof Fa?e:Fa.getCharacterSetECIByName(e)},r.decodeFallback=function(e,o){var l=this.encodingCharacterSet(o);if(r.isDecodeFallbackSupported(l)){for(var h="",m=0,b=e.length;m<b;m++){var n=e[m].toString(16);n.length<2&&(n="0"+n),h+="%"+n}return decodeURIComponent(h)}if(l.equals(Fa.UnicodeBigUnmarked))return String.fromCharCode.apply(null,new Uint16Array(e.buffer));throw new vv("Encoding "+this.encodingName(o)+" not supported by fallback.")},r.isDecodeFallbackSupported=function(e){return e.equals(Fa.UTF8)||e.equals(Fa.ISO8859_1)||e.equals(Fa.ASCII)},r.encodeFallback=function(e){for(var o=btoa(unescape(encodeURIComponent(e))),l=o.split(""),h=[],m=0;m<l.length;m++)h.push(l[m].charCodeAt(0));return new Uint8Array(h)},r})(),En=(function(){function r(){}return r.castAsNonUtf8Char=function(e,o){o===void 0&&(o=null);var l=o?o.getName():this.ISO88591;return Bu.decode(new Uint8Array([e]),l)},r.guessEncoding=function(e,o){if(o!=null&&o.get(Io.CHARACTER_SET)!==void 0)return o.get(Io.CHARACTER_SET).toString();for(var l=e.length,h=!0,m=!0,b=!0,n=0,C=0,D=0,L=0,U=0,q=0,Z=0,ie=0,ne=0,be=0,ve=0,we=e.length>3&&e[0]===239&&e[1]===187&&e[2]===191,Pe=0;Pe<l&&(h||m||b);Pe++){var Ze=e[Pe]&255;b&&(n>0?(Ze&128)===0?b=!1:n--:(Ze&128)!==0&&((Ze&64)===0?b=!1:(n++,(Ze&32)===0?C++:(n++,(Ze&16)===0?D++:(n++,(Ze&8)===0?L++:b=!1))))),h&&(Ze>127&&Ze<160?h=!1:Ze>159&&(Ze<192||Ze===215||Ze===247)&&ve++),m&&(U>0?Ze<64||Ze===127||Ze>252?m=!1:U--:Ze===128||Ze===160||Ze>239?m=!1:Ze>160&&Ze<224?(q++,ie=0,Z++,Z>ne&&(ne=Z)):Ze>127?(U++,Z=0,ie++,ie>be&&(be=ie)):(Z=0,ie=0))}return b&&n>0&&(b=!1),m&&U>0&&(m=!1),b&&(we||C+D+L>0)?r.UTF8:m&&(r.ASSUME_SHIFT_JIS||ne>=3||be>=3)?r.SHIFT_JIS:h&&m?ne===2&&q===2||ve*10>=l?r.SHIFT_JIS:r.ISO88591:h?r.ISO88591:m?r.SHIFT_JIS:b?r.UTF8:r.PLATFORM_DEFAULT_ENCODING},r.format=function(e){for(var o=[],l=1;l<arguments.length;l++)o[l-1]=arguments[l];var h=-1;function m(n,C,D,L,U,q){if(n==="%%")return"%";if(o[++h]!==void 0){n=L?parseInt(L.substr(1)):void 0;var Z=U?parseInt(U.substr(1)):void 0,ie;switch(q){case"s":ie=o[h];break;case"c":ie=o[h][0];break;case"f":ie=parseFloat(o[h]).toFixed(n);break;case"p":ie=parseFloat(o[h]).toPrecision(n);break;case"e":ie=parseFloat(o[h]).toExponential(n);break;case"x":ie=parseInt(o[h]).toString(Z||16);break;case"d":ie=parseFloat(parseInt(o[h],Z||10).toPrecision(n)).toFixed(0);break}ie=typeof ie=="object"?JSON.stringify(ie):(+ie).toString(Z);for(var ne=parseInt(D),be=D&&D[0]+""=="0"?"0":" ";ie.length<ne;)ie=C!==void 0?ie+be:be+ie;return ie}}var b=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(b,m)},r.getBytes=function(e,o){return Bu.encode(e,o)},r.getCharCode=function(e,o){return o===void 0&&(o=0),e.charCodeAt(o)},r.getCharAt=function(e){return String.fromCharCode(e)},r.SHIFT_JIS=Fa.SJIS.getName(),r.GB2312="GB2312",r.ISO88591=Fa.ISO8859_1.getName(),r.EUC_JP="EUC_JP",r.UTF8=Fa.UTF8.getName(),r.PLATFORM_DEFAULT_ENCODING=r.UTF8,r.ASSUME_SHIFT_JIS=!1,r})(),cn=(function(){function r(e){e===void 0&&(e=""),this.value=e}return r.prototype.enableDecoding=function(e){return this.encoding=e,this},r.prototype.append=function(e){return typeof e=="string"?this.value+=e.toString():this.encoding?this.value+=En.castAsNonUtf8Char(e,this.encoding):this.value+=String.fromCharCode(e),this},r.prototype.appendChars=function(e,o,l){for(var h=o;o<o+l;h++)this.append(e[h]);return this},r.prototype.length=function(){return this.value.length},r.prototype.charAt=function(e){return this.value.charAt(e)},r.prototype.deleteCharAt=function(e){this.value=this.value.substr(0,e)+this.value.substring(e+1)},r.prototype.setCharAt=function(e,o){this.value=this.value.substr(0,e)+o+this.value.substr(e+1)},r.prototype.substring=function(e,o){return this.value.substring(e,o)},r.prototype.setLengthToZero=function(){this.value=""},r.prototype.toString=function(){return this.value},r.prototype.insert=function(e,o){this.value=this.value.substring(0,e)+o+this.value.substring(e)},r})(),If=(function(){function r(e,o,l,h){if(this.width=e,this.height=o,this.rowSize=l,this.bits=h,o==null&&(o=e),this.height=o,e<1||o<1)throw new bi("Both dimensions must be greater than 0");l==null&&(l=Math.floor((e+31)/32)),this.rowSize=l,h==null&&(this.bits=new Int32Array(this.rowSize*this.height))}return r.parseFromBooleanArray=function(e){for(var o=e.length,l=e[0].length,h=new r(l,o),m=0;m<o;m++)for(var b=e[m],n=0;n<l;n++)b[n]&&h.set(n,m);return h},r.parseFromString=function(e,o,l){if(e===null)throw new bi("stringRepresentation cannot be null");for(var h=new Array(e.length),m=0,b=0,n=-1,C=0,D=0;D<e.length;)if(e.charAt(D)===`
`||e.charAt(D)==="\r"){if(m>b){if(n===-1)n=m-b;else if(m-b!==n)throw new bi("row lengths do not match");b=m,C++}D++}else if(e.substring(D,D+o.length)===o)D+=o.length,h[m]=!0,m++;else if(e.substring(D,D+l.length)===l)D+=l.length,h[m]=!1,m++;else throw new bi("illegal character encountered: "+e.substring(D));if(m>b){if(n===-1)n=m-b;else if(m-b!==n)throw new bi("row lengths do not match");C++}for(var L=new r(n,C),U=0;U<m;U++)h[U]&&L.set(Math.floor(U%n),Math.floor(U/n));return L},r.prototype.get=function(e,o){var l=o*this.rowSize+Math.floor(e/32);return(this.bits[l]>>>(e&31)&1)!==0},r.prototype.set=function(e,o){var l=o*this.rowSize+Math.floor(e/32);this.bits[l]|=1<<(e&31)&4294967295},r.prototype.unset=function(e,o){var l=o*this.rowSize+Math.floor(e/32);this.bits[l]&=~(1<<(e&31)&4294967295)},r.prototype.flip=function(e,o){var l=o*this.rowSize+Math.floor(e/32);this.bits[l]^=1<<(e&31)&4294967295},r.prototype.xor=function(e){if(this.width!==e.getWidth()||this.height!==e.getHeight()||this.rowSize!==e.getRowSize())throw new bi("input matrix dimensions do not match");for(var o=new Ja(Math.floor(this.width/32)+1),l=this.rowSize,h=this.bits,m=0,b=this.height;m<b;m++)for(var n=m*l,C=e.getRow(m,o).getBitArray(),D=0;D<l;D++)h[n+D]^=C[D]},r.prototype.clear=function(){for(var e=this.bits,o=e.length,l=0;l<o;l++)e[l]=0},r.prototype.setRegion=function(e,o,l,h){if(o<0||e<0)throw new bi("Left and top must be nonnegative");if(h<1||l<1)throw new bi("Height and width must be at least 1");var m=e+l,b=o+h;if(b>this.height||m>this.width)throw new bi("The region must fit inside the matrix");for(var n=this.rowSize,C=this.bits,D=o;D<b;D++)for(var L=D*n,U=e;U<m;U++)C[L+Math.floor(U/32)]|=1<<(U&31)&4294967295},r.prototype.getRow=function(e,o){o==null||o.getSize()<this.width?o=new Ja(this.width):o.clear();for(var l=this.rowSize,h=this.bits,m=e*l,b=0;b<l;b++)o.setBulk(b*32,h[m+b]);return o},r.prototype.setRow=function(e,o){yo.arraycopy(o.getBitArray(),0,this.bits,e*this.rowSize,this.rowSize)},r.prototype.rotate180=function(){for(var e=this.getWidth(),o=this.getHeight(),l=new Ja(e),h=new Ja(e),m=0,b=Math.floor((o+1)/2);m<b;m++)l=this.getRow(m,l),h=this.getRow(o-1-m,h),l.reverse(),h.reverse(),this.setRow(m,h),this.setRow(o-1-m,l)},r.prototype.getEnclosingRectangle=function(){for(var e=this.width,o=this.height,l=this.rowSize,h=this.bits,m=e,b=o,n=-1,C=-1,D=0;D<o;D++)for(var L=0;L<l;L++){var U=h[D*l+L];if(U!==0){if(D<b&&(b=D),D>C&&(C=D),L*32<m){for(var q=0;(U<<31-q&4294967295)===0;)q++;L*32+q<m&&(m=L*32+q)}if(L*32+31>n){for(var q=31;!(U>>>q);)q--;L*32+q>n&&(n=L*32+q)}}}return n<m||C<b?null:Int32Array.from([m,b,n-m+1,C-b+1])},r.prototype.getTopLeftOnBit=function(){for(var e=this.rowSize,o=this.bits,l=0;l<o.length&&o[l]===0;)l++;if(l===o.length)return null;for(var h=l/e,m=l%e*32,b=o[l],n=0;(b<<31-n&4294967295)===0;)n++;return m+=n,Int32Array.from([m,h])},r.prototype.getBottomRightOnBit=function(){for(var e=this.rowSize,o=this.bits,l=o.length-1;l>=0&&o[l]===0;)l--;if(l<0)return null;for(var h=Math.floor(l/e),m=Math.floor(l%e)*32,b=o[l],n=31;!(b>>>n);)n--;return m+=n,Int32Array.from([m,h])},r.prototype.getWidth=function(){return this.width},r.prototype.getHeight=function(){return this.height},r.prototype.getRowSize=function(){return this.rowSize},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.width===o.width&&this.height===o.height&&this.rowSize===o.rowSize&&ka.equals(this.bits,o.bits)},r.prototype.hashCode=function(){var e=this.width;return e=31*e+this.width,e=31*e+this.height,e=31*e+this.rowSize,e=31*e+ka.hashCode(this.bits),e},r.prototype.toString=function(e,o,l){return e===void 0&&(e="X "),o===void 0&&(o="  "),l===void 0&&(l=`
`),this.buildToString(e,o,l)},r.prototype.buildToString=function(e,o,l){for(var h=new cn,m=0,b=this.height;m<b;m++){for(var n=0,C=this.width;n<C;n++)h.append(this.get(n,m)?e:o);h.append(l)}return h.toString()},r.prototype.clone=function(){return new r(this.width,this.height,this.rowSize,this.bits.slice())},r})(),Mk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Xt=(function(r){Mk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.getNotFoundInstance=function(){return new e},e.kind="NotFoundException",e})(Xl),Dk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Ok=(function(r){Dk(e,r);function e(o){var l=r.call(this,o)||this;return l.luminances=e.EMPTY,l.buckets=new Int32Array(e.LUMINANCE_BUCKETS),l}return e.prototype.getBlackRow=function(o,l){var h=this.getLuminanceSource(),m=h.getWidth();l==null||l.getSize()<m?l=new Ja(m):l.clear(),this.initArrays(m);for(var b=h.getRow(o,this.luminances),n=this.buckets,C=0;C<m;C++)n[(b[C]&255)>>e.LUMINANCE_SHIFT]++;var D=e.estimateBlackPoint(n);if(m<3)for(var C=0;C<m;C++)(b[C]&255)<D&&l.set(C);else for(var L=b[0]&255,U=b[1]&255,C=1;C<m-1;C++){var q=b[C+1]&255;(U*4-L-q)/2<D&&l.set(C),L=U,U=q}return l},e.prototype.getBlackMatrix=function(){var o=this.getLuminanceSource(),l=o.getWidth(),h=o.getHeight(),m=new If(l,h);this.initArrays(l);for(var b=this.buckets,n=1;n<5;n++)for(var C=Math.floor(h*n/5),D=o.getRow(C,this.luminances),L=Math.floor(l*4/5),U=Math.floor(l/5);U<L;U++){var q=D[U]&255;b[q>>e.LUMINANCE_SHIFT]++}for(var Z=e.estimateBlackPoint(b),ie=o.getMatrix(),n=0;n<h;n++)for(var ne=n*l,U=0;U<l;U++){var q=ie[ne+U]&255;q<Z&&m.set(U,n)}return m},e.prototype.createBinarizer=function(o){return new e(o)},e.prototype.initArrays=function(o){this.luminances.length<o&&(this.luminances=new Uint8ClampedArray(o));for(var l=this.buckets,h=0;h<e.LUMINANCE_BUCKETS;h++)l[h]=0},e.estimateBlackPoint=function(o){for(var l=o.length,h=0,m=0,b=0,n=0;n<l;n++)o[n]>b&&(m=n,b=o[n]),o[n]>h&&(h=o[n]);for(var C=0,D=0,n=0;n<l;n++){var L=n-m,U=o[n]*L*L;U>D&&(C=n,D=U)}if(m>C){var q=m;m=C,C=q}if(C-m<=l/16)throw new Xt;for(var Z=C-1,ie=-1,n=C-1;n>m;n--){var ne=n-m,U=ne*ne*(C-n)*(h-o[n]);U>ie&&(Z=n,ie=U)}return Z<<e.LUMINANCE_SHIFT},e.LUMINANCE_BITS=5,e.LUMINANCE_SHIFT=8-e.LUMINANCE_BITS,e.LUMINANCE_BUCKETS=1<<e.LUMINANCE_BITS,e.EMPTY=Uint8ClampedArray.from([0]),e})(Sk),Pk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Lk=(function(r){Pk(e,r);function e(o){var l=r.call(this,o)||this;return l.matrix=null,l}return e.prototype.getBlackMatrix=function(){if(this.matrix!==null)return this.matrix;var o=this.getLuminanceSource(),l=o.getWidth(),h=o.getHeight();if(l>=e.MINIMUM_DIMENSION&&h>=e.MINIMUM_DIMENSION){var m=o.getMatrix(),b=l>>e.BLOCK_SIZE_POWER;(l&e.BLOCK_SIZE_MASK)!==0&&b++;var n=h>>e.BLOCK_SIZE_POWER;(h&e.BLOCK_SIZE_MASK)!==0&&n++;var C=e.calculateBlackPoints(m,b,n,l,h),D=new If(l,h);e.calculateThresholdForBlock(m,b,n,l,h,C,D),this.matrix=D}else this.matrix=r.prototype.getBlackMatrix.call(this);return this.matrix},e.prototype.createBinarizer=function(o){return new e(o)},e.calculateThresholdForBlock=function(o,l,h,m,b,n,C){for(var D=b-e.BLOCK_SIZE,L=m-e.BLOCK_SIZE,U=0;U<h;U++){var q=U<<e.BLOCK_SIZE_POWER;q>D&&(q=D);for(var Z=e.cap(U,2,h-3),ie=0;ie<l;ie++){var ne=ie<<e.BLOCK_SIZE_POWER;ne>L&&(ne=L);for(var be=e.cap(ie,2,l-3),ve=0,we=-2;we<=2;we++){var Pe=n[Z+we];ve+=Pe[be-2]+Pe[be-1]+Pe[be]+Pe[be+1]+Pe[be+2]}var Ze=ve/25;e.thresholdBlock(o,ne,q,Ze,m,C)}}},e.cap=function(o,l,h){return o<l?l:o>h?h:o},e.thresholdBlock=function(o,l,h,m,b,n){for(var C=0,D=h*b+l;C<e.BLOCK_SIZE;C++,D+=b)for(var L=0;L<e.BLOCK_SIZE;L++)(o[D+L]&255)<=m&&n.set(l+L,h+C)},e.calculateBlackPoints=function(o,l,h,m,b){for(var n=b-e.BLOCK_SIZE,C=m-e.BLOCK_SIZE,D=new Array(h),L=0;L<h;L++){D[L]=new Int32Array(l);var U=L<<e.BLOCK_SIZE_POWER;U>n&&(U=n);for(var q=0;q<l;q++){var Z=q<<e.BLOCK_SIZE_POWER;Z>C&&(Z=C);for(var ie=0,ne=255,be=0,ve=0,we=U*m+Z;ve<e.BLOCK_SIZE;ve++,we+=m){for(var Pe=0;Pe<e.BLOCK_SIZE;Pe++){var Ze=o[we+Pe]&255;ie+=Ze,Ze<ne&&(ne=Ze),Ze>be&&(be=Ze)}if(be-ne>e.MIN_DYNAMIC_RANGE)for(ve++,we+=m;ve<e.BLOCK_SIZE;ve++,we+=m)for(var Pe=0;Pe<e.BLOCK_SIZE;Pe++)ie+=o[we+Pe]&255}var $e=ie>>e.BLOCK_SIZE_POWER*2;if(be-ne<=e.MIN_DYNAMIC_RANGE&&($e=ne/2,L>0&&q>0)){var xt=(D[L-1][q]+2*D[L][q-1]+D[L-1][q-1])/4;ne<xt&&($e=xt)}D[L][q]=$e}}return D},e.BLOCK_SIZE_POWER=3,e.BLOCK_SIZE=1<<e.BLOCK_SIZE_POWER,e.BLOCK_SIZE_MASK=e.BLOCK_SIZE-1,e.MINIMUM_DIMENSION=e.BLOCK_SIZE*5,e.MIN_DYNAMIC_RANGE=24,e})(Ok),Xv=(function(){function r(e,o){this.width=e,this.height=o}return r.prototype.getWidth=function(){return this.width},r.prototype.getHeight=function(){return this.height},r.prototype.isCropSupported=function(){return!1},r.prototype.crop=function(e,o,l,h){throw new vv("This luminance source does not support cropping.")},r.prototype.isRotateSupported=function(){return!1},r.prototype.rotateCounterClockwise=function(){throw new vv("This luminance source does not support rotation by 90 degrees.")},r.prototype.rotateCounterClockwise45=function(){throw new vv("This luminance source does not support rotation by 45 degrees.")},r.prototype.toString=function(){for(var e=new Uint8ClampedArray(this.width),o=new cn,l=0;l<this.height;l++){for(var h=this.getRow(l,e),m=0;m<this.width;m++){var b=h[m]&255,n=void 0;b<64?n="#":b<128?n="+":b<192?n=".":n=" ",o.append(n)}o.append(`
`)}return o.toString()},r})(),Bk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),D2=(function(r){Bk(e,r);function e(o){var l=r.call(this,o.getWidth(),o.getHeight())||this;return l.delegate=o,l}return e.prototype.getRow=function(o,l){for(var h=this.delegate.getRow(o,l),m=this.getWidth(),b=0;b<m;b++)h[b]=255-(h[b]&255);return h},e.prototype.getMatrix=function(){for(var o=this.delegate.getMatrix(),l=this.getWidth()*this.getHeight(),h=new Uint8ClampedArray(l),m=0;m<l;m++)h[m]=255-(o[m]&255);return h},e.prototype.isCropSupported=function(){return this.delegate.isCropSupported()},e.prototype.crop=function(o,l,h,m){return new e(this.delegate.crop(o,l,h,m))},e.prototype.isRotateSupported=function(){return this.delegate.isRotateSupported()},e.prototype.invert=function(){return this.delegate},e.prototype.rotateCounterClockwise=function(){return new e(this.delegate.rotateCounterClockwise())},e.prototype.rotateCounterClockwise45=function(){return new e(this.delegate.rotateCounterClockwise45())},e})(Xv),zk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Fk=(function(r){zk(e,r);function e(o,l){l===void 0&&(l=!1);var h=r.call(this,o.width,o.height)||this;return h.canvas=o,h.tempCanvasElement=null,h.buffer=e.makeBufferFromCanvasImageData(o,l),h}return e.makeBufferFromCanvasImageData=function(o,l){l===void 0&&(l=!1);var h=o.getContext("2d").getImageData(0,0,o.width,o.height);return e.toGrayscaleBuffer(h.data,o.width,o.height,l)},e.toGrayscaleBuffer=function(o,l,h,m){m===void 0&&(m=!1);var b=new Uint8ClampedArray(l*h);if(e.FRAME_INDEX=!e.FRAME_INDEX,e.FRAME_INDEX||!m)for(var n=0,C=0,D=o.length;n<D;n+=4,C++){var L=void 0,U=o[n+3];if(U===0)L=255;else{var q=o[n],Z=o[n+1],ie=o[n+2];L=306*q+601*Z+117*ie+512>>10}b[C]=L}else for(var n=0,C=0,ne=o.length;n<ne;n+=4,C++){var L=void 0,U=o[n+3];if(U===0)L=255;else{var q=o[n],Z=o[n+1],ie=o[n+2];L=306*q+601*Z+117*ie+512>>10}b[C]=255-L}return b},e.prototype.getRow=function(o,l){if(o<0||o>=this.getHeight())throw new bi("Requested row is outside the image: "+o);var h=this.getWidth(),m=o*h;return l===null?l=this.buffer.slice(m,m+h):(l.length<h&&(l=new Uint8ClampedArray(h)),l.set(this.buffer.slice(m,m+h))),l},e.prototype.getMatrix=function(){return this.buffer},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(o,l,h,m){return r.prototype.crop.call(this,o,l,h,m),this},e.prototype.isRotateSupported=function(){return!0},e.prototype.rotateCounterClockwise=function(){return this.rotate(-90),this},e.prototype.rotateCounterClockwise45=function(){return this.rotate(-45),this},e.prototype.getTempCanvasElement=function(){if(this.tempCanvasElement===null){var o=this.canvas.ownerDocument.createElement("canvas");o.width=this.canvas.width,o.height=this.canvas.height,this.tempCanvasElement=o}return this.tempCanvasElement},e.prototype.rotate=function(o){var l=this.getTempCanvasElement(),h=l.getContext("2d"),m=o*e.DEGREE_TO_RADIANS,b=this.canvas.width,n=this.canvas.height,C=Math.ceil(Math.abs(Math.cos(m))*b+Math.abs(Math.sin(m))*n),D=Math.ceil(Math.abs(Math.sin(m))*b+Math.abs(Math.cos(m))*n);return l.width=C,l.height=D,h.translate(C/2,D/2),h.rotate(m),h.drawImage(this.canvas,b/-2,n/-2),this.buffer=e.makeBufferFromCanvasImageData(l),this},e.prototype.invert=function(){return new D2(this)},e.DEGREE_TO_RADIANS=Math.PI/180,e.FRAME_INDEX=!0,e})(Xv),kk=(function(){function r(e,o,l){this.deviceId=e,this.label=o,this.kind="videoinput",this.groupId=l||void 0}return r.prototype.toJSON=function(){return{kind:this.kind,groupId:this.groupId,deviceId:this.deviceId,label:this.label}},r})(),hl=function(r,e,o,l){function h(m){return m instanceof o?m:new o(function(b){b(m)})}return new(o||(o=Promise))(function(m,b){function n(L){try{D(l.next(L))}catch(U){b(U)}}function C(L){try{D(l.throw(L))}catch(U){b(U)}}function D(L){L.done?m(L.value):h(L.value).then(n,C)}D((l=l.apply(r,e||[])).next())})},fl=function(r,e){var o={label:0,sent:function(){if(m[0]&1)throw m[1];return m[1]},trys:[],ops:[]},l,h,m,b;return b={next:n(0),throw:n(1),return:n(2)},typeof Symbol=="function"&&(b[Symbol.iterator]=function(){return this}),b;function n(D){return function(L){return C([D,L])}}function C(D){if(l)throw new TypeError("Generator is already executing.");for(;o;)try{if(l=1,h&&(m=D[0]&2?h.return:D[0]?h.throw||((m=h.return)&&m.call(h),0):h.next)&&!(m=m.call(h,D[1])).done)return m;switch(h=0,m&&(D=[D[0]&2,m.value]),D[0]){case 0:case 1:m=D;break;case 4:return o.label++,{value:D[1],done:!1};case 5:o.label++,h=D[1],D=[0];continue;case 7:D=o.ops.pop(),o.trys.pop();continue;default:if(m=o.trys,!(m=m.length>0&&m[m.length-1])&&(D[0]===6||D[0]===2)){o=0;continue}if(D[0]===3&&(!m||D[1]>m[0]&&D[1]<m[3])){o.label=D[1];break}if(D[0]===6&&o.label<m[1]){o.label=m[1],m=D;break}if(m&&o.label<m[2]){o.label=m[2],o.ops.push(D);break}m[2]&&o.ops.pop(),o.trys.pop();continue}D=e.call(r,o)}catch(L){D=[6,L],h=0}finally{l=m=0}if(D[0]&5)throw D[1];return{value:D[0]?D[1]:void 0,done:!0}}},Nk=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},J_=(function(){function r(e,o,l){o===void 0&&(o=500),this.reader=e,this.timeBetweenScansMillis=o,this._hints=l,this._stopContinuousDecode=!1,this._stopAsyncDecode=!1,this._timeBetweenDecodingAttempts=0}return Object.defineProperty(r.prototype,"hasNavigator",{get:function(){return typeof navigator<"u"},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"isMediaDevicesSuported",{get:function(){return this.hasNavigator&&!!navigator.mediaDevices},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"canEnumerateDevices",{get:function(){return!!(this.isMediaDevicesSuported&&navigator.mediaDevices.enumerateDevices)},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"timeBetweenDecodingAttempts",{get:function(){return this._timeBetweenDecodingAttempts},set:function(e){this._timeBetweenDecodingAttempts=e<0?0:e},enumerable:!1,configurable:!0}),Object.defineProperty(r.prototype,"hints",{get:function(){return this._hints},set:function(e){this._hints=e||null},enumerable:!1,configurable:!0}),r.prototype.listVideoInputDevices=function(){return hl(this,void 0,void 0,function(){var e,o,l,h,m,b,n,C,D,L,U,q;return fl(this,function(Z){switch(Z.label){case 0:if(!this.hasNavigator)throw new Error("Can't enumerate devices, navigator is not present.");if(!this.canEnumerateDevices)throw new Error("Can't enumerate devices, method not supported.");return[4,navigator.mediaDevices.enumerateDevices()];case 1:e=Z.sent(),o=[];try{for(l=Nk(e),h=l.next();!h.done;h=l.next())m=h.value,b=m.kind==="video"?"videoinput":m.kind,b==="videoinput"&&(n=m.deviceId||m.id,C=m.label||"Video device "+(o.length+1),D=m.groupId,L={deviceId:n,label:C,kind:b,groupId:D},o.push(L))}catch(ie){U={error:ie}}finally{try{h&&!h.done&&(q=l.return)&&q.call(l)}finally{if(U)throw U.error}}return[2,o]}})})},r.prototype.getVideoInputDevices=function(){return hl(this,void 0,void 0,function(){var e;return fl(this,function(o){switch(o.label){case 0:return[4,this.listVideoInputDevices()];case 1:return e=o.sent(),[2,e.map(function(l){return new kk(l.deviceId,l.label)})]}})})},r.prototype.findDeviceById=function(e){return hl(this,void 0,void 0,function(){var o;return fl(this,function(l){switch(l.label){case 0:return[4,this.listVideoInputDevices()];case 1:return o=l.sent(),o?[2,o.find(function(h){return h.deviceId===e})]:[2,null]}})})},r.prototype.decodeFromInputVideoDevice=function(e,o){return hl(this,void 0,void 0,function(){return fl(this,function(l){switch(l.label){case 0:return[4,this.decodeOnceFromVideoDevice(e,o)];case 1:return[2,l.sent()]}})})},r.prototype.decodeOnceFromVideoDevice=function(e,o){return hl(this,void 0,void 0,function(){var l,h;return fl(this,function(m){switch(m.label){case 0:return this.reset(),e?l={deviceId:{exact:e}}:l={facingMode:"environment"},h={video:l},[4,this.decodeOnceFromConstraints(h,o)];case 1:return[2,m.sent()]}})})},r.prototype.decodeOnceFromConstraints=function(e,o){return hl(this,void 0,void 0,function(){var l;return fl(this,function(h){switch(h.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return l=h.sent(),[4,this.decodeOnceFromStream(l,o)];case 2:return[2,h.sent()]}})})},r.prototype.decodeOnceFromStream=function(e,o){return hl(this,void 0,void 0,function(){var l,h;return fl(this,function(m){switch(m.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,o)];case 1:return l=m.sent(),[4,this.decodeOnce(l)];case 2:return h=m.sent(),[2,h]}})})},r.prototype.decodeFromInputVideoDeviceContinuously=function(e,o,l){return hl(this,void 0,void 0,function(){return fl(this,function(h){switch(h.label){case 0:return[4,this.decodeFromVideoDevice(e,o,l)];case 1:return[2,h.sent()]}})})},r.prototype.decodeFromVideoDevice=function(e,o,l){return hl(this,void 0,void 0,function(){var h,m;return fl(this,function(b){switch(b.label){case 0:return e?h={deviceId:{exact:e}}:h={facingMode:"environment"},m={video:h},[4,this.decodeFromConstraints(m,o,l)];case 1:return[2,b.sent()]}})})},r.prototype.decodeFromConstraints=function(e,o,l){return hl(this,void 0,void 0,function(){var h;return fl(this,function(m){switch(m.label){case 0:return[4,navigator.mediaDevices.getUserMedia(e)];case 1:return h=m.sent(),[4,this.decodeFromStream(h,o,l)];case 2:return[2,m.sent()]}})})},r.prototype.decodeFromStream=function(e,o,l){return hl(this,void 0,void 0,function(){var h;return fl(this,function(m){switch(m.label){case 0:return this.reset(),[4,this.attachStreamToVideo(e,o)];case 1:return h=m.sent(),[4,this.decodeContinuously(h,l)];case 2:return[2,m.sent()]}})})},r.prototype.stopAsyncDecode=function(){this._stopAsyncDecode=!0},r.prototype.stopContinuousDecode=function(){this._stopContinuousDecode=!0},r.prototype.attachStreamToVideo=function(e,o){return hl(this,void 0,void 0,function(){var l;return fl(this,function(h){switch(h.label){case 0:return l=this.prepareVideoElement(o),this.addVideoSource(l,e),this.videoElement=l,this.stream=e,[4,this.playVideoOnLoadAsync(l)];case 1:return h.sent(),[2,l]}})})},r.prototype.playVideoOnLoadAsync=function(e){var o=this;return new Promise(function(l,h){return o.playVideoOnLoad(e,function(){return l()})})},r.prototype.playVideoOnLoad=function(e,o){var l=this;this.videoEndedListener=function(){return l.stopStreams()},this.videoCanPlayListener=function(){return l.tryPlayVideo(e)},e.addEventListener("ended",this.videoEndedListener),e.addEventListener("canplay",this.videoCanPlayListener),e.addEventListener("playing",o),this.tryPlayVideo(e)},r.prototype.isVideoPlaying=function(e){return e.currentTime>0&&!e.paused&&!e.ended&&e.readyState>2},r.prototype.tryPlayVideo=function(e){return hl(this,void 0,void 0,function(){return fl(this,function(o){switch(o.label){case 0:if(this.isVideoPlaying(e))return console.warn("Trying to play video that is already playing."),[2];o.label=1;case 1:return o.trys.push([1,3,,4]),[4,e.play()];case 2:return o.sent(),[3,4];case 3:return o.sent(),console.warn("It was not possible to play the video."),[3,4];case 4:return[2]}})})},r.prototype.getMediaElement=function(e,o){var l=document.getElementById(e);if(!l)throw new bh("element with id '"+e+"' not found");if(l.nodeName.toLowerCase()!==o.toLowerCase())throw new bh("element with id '"+e+"' must be an "+o+" element");return l},r.prototype.decodeFromImage=function(e,o){if(!e&&!o)throw new bh("either imageElement with a src set or an url must be provided");return o&&!e?this.decodeFromImageUrl(o):this.decodeFromImageElement(e)},r.prototype.decodeFromVideo=function(e,o){if(!e&&!o)throw new bh("Either an element with a src set or an URL must be provided");return o&&!e?this.decodeFromVideoUrl(o):this.decodeFromVideoElement(e)},r.prototype.decodeFromVideoContinuously=function(e,o,l){if(e===void 0&&o===void 0)throw new bh("Either an element with a src set or an URL must be provided");return o&&!e?this.decodeFromVideoUrlContinuously(o,l):this.decodeFromVideoElementContinuously(e,l)},r.prototype.decodeFromImageElement=function(e){if(!e)throw new bh("An image element must be provided.");this.reset();var o=this.prepareImageElement(e);this.imageElement=o;var l;return this.isImageLoaded(o)?l=this.decodeOnce(o,!1,!0):l=this._decodeOnLoadImage(o),l},r.prototype.decodeFromVideoElement=function(e){var o=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideo(o)},r.prototype.decodeFromVideoElementContinuously=function(e,o){var l=this._decodeFromVideoElementSetup(e);return this._decodeOnLoadVideoContinuously(l,o)},r.prototype._decodeFromVideoElementSetup=function(e){if(!e)throw new bh("A video element must be provided.");this.reset();var o=this.prepareVideoElement(e);return this.videoElement=o,o},r.prototype.decodeFromImageUrl=function(e){if(!e)throw new bh("An URL must be provided.");this.reset();var o=this.prepareImageElement();this.imageElement=o;var l=this._decodeOnLoadImage(o);return o.src=e,l},r.prototype.decodeFromVideoUrl=function(e){if(!e)throw new bh("An URL must be provided.");this.reset();var o=this.prepareVideoElement(),l=this.decodeFromVideoElement(o);return o.src=e,l},r.prototype.decodeFromVideoUrlContinuously=function(e,o){if(!e)throw new bh("An URL must be provided.");this.reset();var l=this.prepareVideoElement(),h=this.decodeFromVideoElementContinuously(l,o);return l.src=e,h},r.prototype._decodeOnLoadImage=function(e){var o=this;return new Promise(function(l,h){o.imageLoadedListener=function(){return o.decodeOnce(e,!1,!0).then(l,h)},e.addEventListener("load",o.imageLoadedListener)})},r.prototype._decodeOnLoadVideo=function(e){return hl(this,void 0,void 0,function(){return fl(this,function(o){switch(o.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return o.sent(),[4,this.decodeOnce(e)];case 2:return[2,o.sent()]}})})},r.prototype._decodeOnLoadVideoContinuously=function(e,o){return hl(this,void 0,void 0,function(){return fl(this,function(l){switch(l.label){case 0:return[4,this.playVideoOnLoadAsync(e)];case 1:return l.sent(),this.decodeContinuously(e,o),[2]}})})},r.prototype.isImageLoaded=function(e){return!(!e.complete||e.naturalWidth===0)},r.prototype.prepareImageElement=function(e){var o;return typeof e>"u"&&(o=document.createElement("img"),o.width=200,o.height=200),typeof e=="string"&&(o=this.getMediaElement(e,"img")),e instanceof HTMLImageElement&&(o=e),o},r.prototype.prepareVideoElement=function(e){var o;return!e&&typeof document<"u"&&(o=document.createElement("video"),o.width=200,o.height=200),typeof e=="string"&&(o=this.getMediaElement(e,"video")),e instanceof HTMLVideoElement&&(o=e),o.setAttribute("autoplay","true"),o.setAttribute("muted","true"),o.setAttribute("playsinline","true"),o},r.prototype.decodeOnce=function(e,o,l){var h=this;o===void 0&&(o=!0),l===void 0&&(l=!0),this._stopAsyncDecode=!1;var m=function(b,n){if(h._stopAsyncDecode){n(new Xt("Video stream has ended before any code could be detected.")),h._stopAsyncDecode=void 0;return}try{var C=h.decode(e);b(C)}catch(q){var D=o&&q instanceof Xt,L=q instanceof Ka||q instanceof Ir,U=L&&l;if(D||U)return setTimeout(m,h._timeBetweenDecodingAttempts,b,n);n(q)}};return new Promise(function(b,n){return m(b,n)})},r.prototype.decodeContinuously=function(e,o){var l=this;this._stopContinuousDecode=!1;var h=function(){if(l._stopContinuousDecode){l._stopContinuousDecode=void 0;return}try{var m=l.decode(e);o(m,null),setTimeout(h,l.timeBetweenScansMillis)}catch(C){o(null,C);var b=C instanceof Ka||C instanceof Ir,n=C instanceof Xt;(b||n)&&setTimeout(h,l._timeBetweenDecodingAttempts)}};h()},r.prototype.decode=function(e){var o=this.createBinaryBitmap(e);return this.decodeBitmap(o)},r.prototype.createBinaryBitmap=function(e){this.getCaptureCanvasContext(e);var o=!1;e instanceof HTMLVideoElement?(this.drawFrameOnCanvas(e),o=!0):this.drawImageOnCanvas(e);var l=this.getCaptureCanvas(e),h=new Fk(l,o),m=new Lk(h);return new bk(m)},r.prototype.getCaptureCanvasContext=function(e){if(!this.captureCanvasContext){var o=this.getCaptureCanvas(e),l=void 0;try{l=o.getContext("2d",{willReadFrequently:!0})}catch{l=o.getContext("2d")}this.captureCanvasContext=l}return this.captureCanvasContext},r.prototype.getCaptureCanvas=function(e){if(!this.captureCanvas){var o=this.createCaptureCanvas(e);this.captureCanvas=o}return this.captureCanvas},r.prototype.drawFrameOnCanvas=function(e,o,l){o===void 0&&(o={sx:0,sy:0,sWidth:e.videoWidth,sHeight:e.videoHeight,dx:0,dy:0,dWidth:e.videoWidth,dHeight:e.videoHeight}),l===void 0&&(l=this.captureCanvasContext),l.drawImage(e,o.sx,o.sy,o.sWidth,o.sHeight,o.dx,o.dy,o.dWidth,o.dHeight)},r.prototype.drawImageOnCanvas=function(e,o,l){o===void 0&&(o={sx:0,sy:0,sWidth:e.naturalWidth,sHeight:e.naturalHeight,dx:0,dy:0,dWidth:e.naturalWidth,dHeight:e.naturalHeight}),l===void 0&&(l=this.captureCanvasContext),l.drawImage(e,o.sx,o.sy,o.sWidth,o.sHeight,o.dx,o.dy,o.dWidth,o.dHeight)},r.prototype.decodeBitmap=function(e){return this.reader.decode(e,this._hints)},r.prototype.createCaptureCanvas=function(e){if(typeof document>"u")return this._destroyCaptureCanvas(),null;var o=document.createElement("canvas"),l,h;return typeof e<"u"&&(e instanceof HTMLVideoElement?(l=e.videoWidth,h=e.videoHeight):e instanceof HTMLImageElement&&(l=e.naturalWidth||e.width,h=e.naturalHeight||e.height)),o.style.width=l+"px",o.style.height=h+"px",o.width=l,o.height=h,o},r.prototype.stopStreams=function(){this.stream&&(this.stream.getVideoTracks().forEach(function(e){return e.stop()}),this.stream=void 0),this._stopAsyncDecode===!1&&this.stopAsyncDecode(),this._stopContinuousDecode===!1&&this.stopContinuousDecode()},r.prototype.reset=function(){this.stopStreams(),this._destroyVideoElement(),this._destroyImageElement(),this._destroyCaptureCanvas()},r.prototype._destroyVideoElement=function(){this.videoElement&&(typeof this.videoEndedListener<"u"&&this.videoElement.removeEventListener("ended",this.videoEndedListener),typeof this.videoPlayingEventListener<"u"&&this.videoElement.removeEventListener("playing",this.videoPlayingEventListener),typeof this.videoCanPlayListener<"u"&&this.videoElement.removeEventListener("loadedmetadata",this.videoCanPlayListener),this.cleanVideoSource(this.videoElement),this.videoElement=void 0)},r.prototype._destroyImageElement=function(){this.imageElement&&(this.imageLoadedListener!==void 0&&this.imageElement.removeEventListener("load",this.imageLoadedListener),this.imageElement.src=void 0,this.imageElement.removeAttribute("src"),this.imageElement=void 0)},r.prototype._destroyCaptureCanvas=function(){this.captureCanvasContext=void 0,this.captureCanvas=void 0},r.prototype.addVideoSource=function(e,o){try{e.srcObject=o}catch{e.src=URL.createObjectURL(o)}},r.prototype.cleanVideoSource=function(e){try{e.srcObject=null}catch{e.src=""}this.videoElement.removeAttribute("src")},r})(),Hs=(function(){function r(e,o,l,h,m,b){l===void 0&&(l=o==null?0:8*o.length),b===void 0&&(b=yo.currentTimeMillis()),this.text=e,this.rawBytes=o,this.numBits=l,this.resultPoints=h,this.format=m,this.timestamp=b,this.text=e,this.rawBytes=o,l==null?this.numBits=o==null?0:8*o.length:this.numBits=l,this.resultPoints=h,this.format=m,this.resultMetadata=null,b==null?this.timestamp=yo.currentTimeMillis():this.timestamp=b}return r.prototype.getText=function(){return this.text},r.prototype.getRawBytes=function(){return this.rawBytes},r.prototype.getNumBits=function(){return this.numBits},r.prototype.getResultPoints=function(){return this.resultPoints},r.prototype.getBarcodeFormat=function(){return this.format},r.prototype.getResultMetadata=function(){return this.resultMetadata},r.prototype.putMetadata=function(e,o){this.resultMetadata===null&&(this.resultMetadata=new Map),this.resultMetadata.set(e,o)},r.prototype.putAllMetadata=function(e){e!==null&&(this.resultMetadata===null?this.resultMetadata=e:this.resultMetadata=new Map(e))},r.prototype.addResultPoints=function(e){var o=this.resultPoints;if(o===null)this.resultPoints=e;else if(e!==null&&e.length>0){var l=new Array(o.length+e.length);yo.arraycopy(o,0,l,0,o.length),yo.arraycopy(e,0,l,o.length,e.length),this.resultPoints=l}},r.prototype.getTimestamp=function(){return this.timestamp},r.prototype.toString=function(){return this.text},r})(),bw;(function(r){r[r.AZTEC=0]="AZTEC",r[r.CODABAR=1]="CODABAR",r[r.CODE_39=2]="CODE_39",r[r.CODE_93=3]="CODE_93",r[r.CODE_128=4]="CODE_128",r[r.DATA_MATRIX=5]="DATA_MATRIX",r[r.EAN_8=6]="EAN_8",r[r.EAN_13=7]="EAN_13",r[r.ITF=8]="ITF",r[r.MAXICODE=9]="MAXICODE",r[r.PDF_417=10]="PDF_417",r[r.QR_CODE=11]="QR_CODE",r[r.RSS_14=12]="RSS_14",r[r.RSS_EXPANDED=13]="RSS_EXPANDED",r[r.UPC_A=14]="UPC_A",r[r.UPC_E=15]="UPC_E",r[r.UPC_EAN_EXTENSION=16]="UPC_EAN_EXTENSION"})(bw||(bw={}));const yi=bw;var ww;(function(r){r[r.OTHER=0]="OTHER",r[r.ORIENTATION=1]="ORIENTATION",r[r.BYTE_SEGMENTS=2]="BYTE_SEGMENTS",r[r.ERROR_CORRECTION_LEVEL=3]="ERROR_CORRECTION_LEVEL",r[r.ISSUE_NUMBER=4]="ISSUE_NUMBER",r[r.SUGGESTED_PRICE=5]="SUGGESTED_PRICE",r[r.POSSIBLE_COUNTRY=6]="POSSIBLE_COUNTRY",r[r.UPC_EAN_EXTENSION=7]="UPC_EAN_EXTENSION",r[r.PDF417_EXTRA_METADATA=8]="PDF417_EXTRA_METADATA",r[r.STRUCTURED_APPEND_SEQUENCE=9]="STRUCTURED_APPEND_SEQUENCE",r[r.STRUCTURED_APPEND_PARITY=10]="STRUCTURED_APPEND_PARITY"})(ww||(ww={}));const gs=ww;var Zv=(function(){function r(e,o,l,h,m,b){m===void 0&&(m=-1),b===void 0&&(b=-1),this.rawBytes=e,this.text=o,this.byteSegments=l,this.ecLevel=h,this.structuredAppendSequenceNumber=m,this.structuredAppendParity=b,this.numBits=e==null?0:8*e.length}return r.prototype.getRawBytes=function(){return this.rawBytes},r.prototype.getNumBits=function(){return this.numBits},r.prototype.setNumBits=function(e){this.numBits=e},r.prototype.getText=function(){return this.text},r.prototype.getByteSegments=function(){return this.byteSegments},r.prototype.getECLevel=function(){return this.ecLevel},r.prototype.getErrorsCorrected=function(){return this.errorsCorrected},r.prototype.setErrorsCorrected=function(e){this.errorsCorrected=e},r.prototype.getErasures=function(){return this.erasures},r.prototype.setErasures=function(e){this.erasures=e},r.prototype.getOther=function(){return this.other},r.prototype.setOther=function(e){this.other=e},r.prototype.hasStructuredAppend=function(){return this.structuredAppendParity>=0&&this.structuredAppendSequenceNumber>=0},r.prototype.getStructuredAppendParity=function(){return this.structuredAppendParity},r.prototype.getStructuredAppendSequenceNumber=function(){return this.structuredAppendSequenceNumber},r})(),iy=(function(){function r(){}return r.prototype.exp=function(e){return this.expTable[e]},r.prototype.log=function(e){if(e===0)throw new bi;return this.logTable[e]},r.addOrSubtract=function(e,o){return e^o},r})(),cm=(function(){function r(e,o){if(o.length===0)throw new bi;this.field=e;var l=o.length;if(l>1&&o[0]===0){for(var h=1;h<l&&o[h]===0;)h++;h===l?this.coefficients=Int32Array.from([0]):(this.coefficients=new Int32Array(l-h),yo.arraycopy(o,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=o}return r.prototype.getCoefficients=function(){return this.coefficients},r.prototype.getDegree=function(){return this.coefficients.length-1},r.prototype.isZero=function(){return this.coefficients[0]===0},r.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},r.prototype.evaluateAt=function(e){if(e===0)return this.getCoefficient(0);var o=this.coefficients,l;if(e===1){l=0;for(var h=0,m=o.length;h!==m;h++){var b=o[h];l=iy.addOrSubtract(l,b)}return l}l=o[0];for(var n=o.length,C=this.field,h=1;h<n;h++)l=iy.addOrSubtract(C.multiply(e,l),o[h]);return l},r.prototype.addOrSubtract=function(e){if(!this.field.equals(e.field))throw new bi("GenericGFPolys do not have same GenericGF field");if(this.isZero())return e;if(e.isZero())return this;var o=this.coefficients,l=e.coefficients;if(o.length>l.length){var h=o;o=l,l=h}var m=new Int32Array(l.length),b=l.length-o.length;yo.arraycopy(l,0,m,0,b);for(var n=b;n<l.length;n++)m[n]=iy.addOrSubtract(o[n-b],l[n]);return new r(this.field,m)},r.prototype.multiply=function(e){if(!this.field.equals(e.field))throw new bi("GenericGFPolys do not have same GenericGF field");if(this.isZero()||e.isZero())return this.field.getZero();for(var o=this.coefficients,l=o.length,h=e.coefficients,m=h.length,b=new Int32Array(l+m-1),n=this.field,C=0;C<l;C++)for(var D=o[C],L=0;L<m;L++)b[C+L]=iy.addOrSubtract(b[C+L],n.multiply(D,h[L]));return new r(n,b)},r.prototype.multiplyScalar=function(e){if(e===0)return this.field.getZero();if(e===1)return this;for(var o=this.coefficients.length,l=this.field,h=new Int32Array(o),m=this.coefficients,b=0;b<o;b++)h[b]=l.multiply(m[b],e);return new r(l,h)},r.prototype.multiplyByMonomial=function(e,o){if(e<0)throw new bi;if(o===0)return this.field.getZero();for(var l=this.coefficients,h=l.length,m=new Int32Array(h+e),b=this.field,n=0;n<h;n++)m[n]=b.multiply(l[n],o);return new r(b,m)},r.prototype.divide=function(e){if(!this.field.equals(e.field))throw new bi("GenericGFPolys do not have same GenericGF field");if(e.isZero())throw new bi("Divide by 0");for(var o=this.field,l=o.getZero(),h=this,m=e.getCoefficient(e.getDegree()),b=o.inverse(m);h.getDegree()>=e.getDegree()&&!h.isZero();){var n=h.getDegree()-e.getDegree(),C=o.multiply(h.getCoefficient(h.getDegree()),b),D=e.multiplyByMonomial(n,C),L=o.buildMonomial(n,C);l=l.addOrSubtract(L),h=h.addOrSubtract(D)}return[l,h]},r.prototype.toString=function(){for(var e="",o=this.getDegree();o>=0;o--){var l=this.getCoefficient(o);if(l!==0){if(l<0?(e+=" - ",l=-l):e.length>0&&(e+=" + "),o===0||l!==1){var h=this.field.log(l);h===0?e+="1":h===1?e+="a":(e+="a^",e+=h)}o!==0&&(o===1?e+="x":(e+="x^",e+=o))}}return e},r})(),Vk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),OR=(function(r){Vk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="ArithmeticException",e})(Xl),Uk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),ql=(function(r){Uk(e,r);function e(o,l,h){var m=r.call(this)||this;m.primitive=o,m.size=l,m.generatorBase=h;for(var b=new Int32Array(l),n=1,C=0;C<l;C++)b[C]=n,n*=2,n>=l&&(n^=o,n&=l-1);m.expTable=b;for(var D=new Int32Array(l),C=0;C<l-1;C++)D[b[C]]=C;return m.logTable=D,m.zero=new cm(m,Int32Array.from([0])),m.one=new cm(m,Int32Array.from([1])),m}return e.prototype.getZero=function(){return this.zero},e.prototype.getOne=function(){return this.one},e.prototype.buildMonomial=function(o,l){if(o<0)throw new bi;if(l===0)return this.zero;var h=new Int32Array(o+1);return h[0]=l,new cm(this,h)},e.prototype.inverse=function(o){if(o===0)throw new OR;return this.expTable[this.size-this.logTable[o]-1]},e.prototype.multiply=function(o,l){return o===0||l===0?0:this.expTable[(this.logTable[o]+this.logTable[l])%(this.size-1)]},e.prototype.getSize=function(){return this.size},e.prototype.getGeneratorBase=function(){return this.generatorBase},e.prototype.toString=function(){return"GF(0x"+pn.toHexString(this.primitive)+","+this.size+")"},e.prototype.equals=function(o){return o===this},e.AZTEC_DATA_12=new e(4201,4096,1),e.AZTEC_DATA_10=new e(1033,1024,1),e.AZTEC_DATA_6=new e(67,64,1),e.AZTEC_PARAM=new e(19,16,1),e.QR_CODE_FIELD_256=new e(285,256,0),e.DATA_MATRIX_FIELD_256=new e(301,256,1),e.AZTEC_DATA_8=e.DATA_MATRIX_FIELD_256,e.MAXICODE_FIELD_64=e.AZTEC_DATA_6,e})(iy),jk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),ov=(function(r){jk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="ReedSolomonException",e})(Xl),Gk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),zy=(function(r){Gk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="IllegalStateException",e})(Xl),Wv=(function(){function r(e){this.field=e}return r.prototype.decode=function(e,o){for(var l=this.field,h=new cm(l,e),m=new Int32Array(o),b=!0,n=0;n<o;n++){var C=h.evaluateAt(l.exp(n+l.getGeneratorBase()));m[m.length-1-n]=C,C!==0&&(b=!1)}if(!b)for(var D=new cm(l,m),L=this.runEuclideanAlgorithm(l.buildMonomial(o,1),D,o),U=L[0],q=L[1],Z=this.findErrorLocations(U),ie=this.findErrorMagnitudes(q,Z),n=0;n<Z.length;n++){var ne=e.length-1-l.log(Z[n]);if(ne<0)throw new ov("Bad error location");e[ne]=ql.addOrSubtract(e[ne],ie[n])}},r.prototype.runEuclideanAlgorithm=function(e,o,l){if(e.getDegree()<o.getDegree()){var h=e;e=o,o=h}for(var m=this.field,b=e,n=o,C=m.getZero(),D=m.getOne();n.getDegree()>=(l/2|0);){var L=b,U=C;if(b=n,C=D,b.isZero())throw new ov("r_{i-1} was zero");n=L;for(var q=m.getZero(),Z=b.getCoefficient(b.getDegree()),ie=m.inverse(Z);n.getDegree()>=b.getDegree()&&!n.isZero();){var ne=n.getDegree()-b.getDegree(),be=m.multiply(n.getCoefficient(n.getDegree()),ie);q=q.addOrSubtract(m.buildMonomial(ne,be)),n=n.addOrSubtract(b.multiplyByMonomial(ne,be))}if(D=q.multiply(C).addOrSubtract(U),n.getDegree()>=b.getDegree())throw new zy("Division algorithm failed to reduce polynomial?")}var ve=D.getCoefficient(0);if(ve===0)throw new ov("sigmaTilde(0) was zero");var we=m.inverse(ve),Pe=D.multiplyScalar(we),Ze=n.multiplyScalar(we);return[Pe,Ze]},r.prototype.findErrorLocations=function(e){var o=e.getDegree();if(o===1)return Int32Array.from([e.getCoefficient(1)]);for(var l=new Int32Array(o),h=0,m=this.field,b=1;b<m.getSize()&&h<o;b++)e.evaluateAt(b)===0&&(l[h]=m.inverse(b),h++);if(h!==o)throw new ov("Error locator degree does not match number of roots");return l},r.prototype.findErrorMagnitudes=function(e,o){for(var l=o.length,h=new Int32Array(l),m=this.field,b=0;b<l;b++){for(var n=m.inverse(o[b]),C=1,D=0;D<l;D++)if(b!==D){var L=m.multiply(o[D],n),U=(L&1)===0?L|1:L&-2;C=m.multiply(C,U)}h[b]=m.multiply(e.evaluateAt(n),m.inverse(C)),m.getGeneratorBase()!==0&&(h[b]=m.multiply(h[b],n))}return h},r})(),fs;(function(r){r[r.UPPER=0]="UPPER",r[r.LOWER=1]="LOWER",r[r.MIXED=2]="MIXED",r[r.DIGIT=3]="DIGIT",r[r.PUNCT=4]="PUNCT",r[r.BINARY=5]="BINARY"})(fs||(fs={}));var bC=(function(){function r(){}return r.prototype.decode=function(e){this.ddata=e;var o=e.getBits(),l=this.extractBits(o),h=this.correctBits(l),m=r.convertBoolArrayToByteArray(h),b=r.getEncodedData(h),n=new Zv(m,b,null,null);return n.setNumBits(h.length),n},r.highLevelDecode=function(e){return this.getEncodedData(e)},r.getEncodedData=function(e){for(var o=e.length,l=fs.UPPER,h=fs.UPPER,m="",b=0;b<o;)if(h===fs.BINARY){if(o-b<5)break;var n=r.readCode(e,b,5);if(b+=5,n===0){if(o-b<11)break;n=r.readCode(e,b,11)+31,b+=11}for(var C=0;C<n;C++){if(o-b<8){b=o;break}var D=r.readCode(e,b,8);m+=En.castAsNonUtf8Char(D),b+=8}h=l}else{var L=h===fs.DIGIT?4:5;if(o-b<L)break;var D=r.readCode(e,b,L);b+=L;var U=r.getCharacter(h,D);U.startsWith("CTRL_")?(l=h,h=r.getTable(U.charAt(5)),U.charAt(6)==="L"&&(l=h)):(m+=U,h=l)}return m},r.getTable=function(e){switch(e){case"L":return fs.LOWER;case"P":return fs.PUNCT;case"M":return fs.MIXED;case"D":return fs.DIGIT;case"B":return fs.BINARY;case"U":default:return fs.UPPER}},r.getCharacter=function(e,o){switch(e){case fs.UPPER:return r.UPPER_TABLE[o];case fs.LOWER:return r.LOWER_TABLE[o];case fs.MIXED:return r.MIXED_TABLE[o];case fs.PUNCT:return r.PUNCT_TABLE[o];case fs.DIGIT:return r.DIGIT_TABLE[o];default:throw new zy("Bad table")}},r.prototype.correctBits=function(e){var o,l;this.ddata.getNbLayers()<=2?(l=6,o=ql.AZTEC_DATA_6):this.ddata.getNbLayers()<=8?(l=8,o=ql.AZTEC_DATA_8):this.ddata.getNbLayers()<=22?(l=10,o=ql.AZTEC_DATA_10):(l=12,o=ql.AZTEC_DATA_12);var h=this.ddata.getNbDatablocks(),m=e.length/l;if(m<h)throw new Ir;for(var b=e.length%l,n=new Int32Array(m),C=0;C<m;C++,b+=l)n[C]=r.readCode(e,b,l);try{var D=new Wv(o);D.decode(n,m-h)}catch(be){throw new Ir(be)}for(var L=(1<<l)-1,U=0,C=0;C<h;C++){var q=n[C];if(q===0||q===L)throw new Ir;(q===1||q===L-1)&&U++}for(var Z=new Array(h*l-U),ie=0,C=0;C<h;C++){var q=n[C];if(q===1||q===L-1)Z.fill(q>1,ie,ie+l-1),ie+=l-1;else for(var ne=l-1;ne>=0;--ne)Z[ie++]=(q&1<<ne)!==0}return Z},r.prototype.extractBits=function(e){var o=this.ddata.isCompact(),l=this.ddata.getNbLayers(),h=(o?11:14)+l*4,m=new Int32Array(h),b=new Array(this.totalBitsInLayer(l,o));if(o)for(var n=0;n<m.length;n++)m[n]=n;else for(var C=h+1+2*pn.truncDivision(pn.truncDivision(h,2)-1,15),D=h/2,L=pn.truncDivision(C,2),n=0;n<D;n++){var U=n+pn.truncDivision(n,15);m[D-n-1]=L-U-1,m[D+n]=L+U+1}for(var n=0,q=0;n<l;n++){for(var Z=(l-n)*4+(o?9:12),ie=n*2,ne=h-1-ie,be=0;be<Z;be++)for(var ve=be*2,we=0;we<2;we++)b[q+ve+we]=e.get(m[ie+we],m[ie+be]),b[q+2*Z+ve+we]=e.get(m[ie+be],m[ne-we]),b[q+4*Z+ve+we]=e.get(m[ne-we],m[ne-be]),b[q+6*Z+ve+we]=e.get(m[ne-be],m[ie+we]);q+=Z*8}return b},r.readCode=function(e,o,l){for(var h=0,m=o;m<o+l;m++)h<<=1,e[m]&&(h|=1);return h},r.readByte=function(e,o){var l=e.length-o;return l>=8?r.readCode(e,o,8):r.readCode(e,o,l)<<8-l},r.convertBoolArrayToByteArray=function(e){for(var o=new Uint8Array((e.length+7)/8),l=0;l<o.length;l++)o[l]=r.readByte(e,8*l);return o},r.prototype.totalBitsInLayer=function(e,o){return((o?88:112)+16*e)*e},r.UPPER_TABLE=["CTRL_PS"," ","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","CTRL_LL","CTRL_ML","CTRL_DL","CTRL_BS"],r.LOWER_TABLE=["CTRL_PS"," ","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z","CTRL_US","CTRL_ML","CTRL_DL","CTRL_BS"],r.MIXED_TABLE=["CTRL_PS"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~","","CTRL_LL","CTRL_UL","CTRL_PL","CTRL_BS"],r.PUNCT_TABLE=["","\r",`\r
`,". ",", ",": ","!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}","CTRL_UL"],r.DIGIT_TABLE=["CTRL_PS"," ","0","1","2","3","4","5","6","7","8","9",",",".","CTRL_UL","CTRL_US"],r})(),zn=(function(){function r(){}return r.round=function(e){return isNaN(e)?0:e<=Number.MIN_SAFE_INTEGER?Number.MIN_SAFE_INTEGER:e>=Number.MAX_SAFE_INTEGER?Number.MAX_SAFE_INTEGER:e+(e<0?-.5:.5)|0},r.distance=function(e,o,l,h){var m=e-l,b=o-h;return Math.sqrt(m*m+b*b)},r.sum=function(e){for(var o=0,l=0,h=e.length;l!==h;l++){var m=e[l];o+=m}return o},r})(),Sw=(function(){function r(){}return r.floatToIntBits=function(e){return e},r.MAX_VALUE=Number.MAX_SAFE_INTEGER,r})(),ti=(function(){function r(e,o){this.x=e,this.y=o}return r.prototype.getX=function(){return this.x},r.prototype.getY=function(){return this.y},r.prototype.equals=function(e){if(e instanceof r){var o=e;return this.x===o.x&&this.y===o.y}return!1},r.prototype.hashCode=function(){return 31*Sw.floatToIntBits(this.x)+Sw.floatToIntBits(this.y)},r.prototype.toString=function(){return"("+this.x+","+this.y+")"},r.orderBestPatterns=function(e){var o=this.distance(e[0],e[1]),l=this.distance(e[1],e[2]),h=this.distance(e[0],e[2]),m,b,n;if(l>=o&&l>=h?(b=e[0],m=e[1],n=e[2]):h>=l&&h>=o?(b=e[1],m=e[0],n=e[2]):(b=e[2],m=e[0],n=e[1]),this.crossProductZ(m,b,n)<0){var C=m;m=n,n=C}e[0]=m,e[1]=b,e[2]=n},r.distance=function(e,o){return zn.distance(e.x,e.y,o.x,o.y)},r.crossProductZ=function(e,o,l){var h=o.x,m=o.y;return(l.x-h)*(e.y-m)-(l.y-m)*(e.x-h)},r})(),O2=(function(){function r(e,o){this.bits=e,this.points=o}return r.prototype.getBits=function(){return this.bits},r.prototype.getPoints=function(){return this.points},r})(),Hk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),qk=(function(r){Hk(e,r);function e(o,l,h,m,b){var n=r.call(this,o,l)||this;return n.compact=h,n.nbDatablocks=m,n.nbLayers=b,n}return e.prototype.getNbLayers=function(){return this.nbLayers},e.prototype.getNbDatablocks=function(){return this.nbDatablocks},e.prototype.isCompact=function(){return this.compact},e})(O2),Tw=(function(){function r(e,o,l,h){this.image=e,this.height=e.getHeight(),this.width=e.getWidth(),o==null&&(o=r.INIT_SIZE),l==null&&(l=e.getWidth()/2|0),h==null&&(h=e.getHeight()/2|0);var m=o/2|0;if(this.leftInit=l-m,this.rightInit=l+m,this.upInit=h-m,this.downInit=h+m,this.upInit<0||this.leftInit<0||this.downInit>=this.height||this.rightInit>=this.width)throw new Xt}return r.prototype.detect=function(){for(var e=this.leftInit,o=this.rightInit,l=this.upInit,h=this.downInit,m=!1,b=!0,n=!1,C=!1,D=!1,L=!1,U=!1,q=this.width,Z=this.height;b;){b=!1;for(var ie=!0;(ie||!C)&&o<q;)ie=this.containsBlackPoint(l,h,o,!1),ie?(o++,b=!0,C=!0):C||o++;if(o>=q){m=!0;break}for(var ne=!0;(ne||!D)&&h<Z;)ne=this.containsBlackPoint(e,o,h,!0),ne?(h++,b=!0,D=!0):D||h++;if(h>=Z){m=!0;break}for(var be=!0;(be||!L)&&e>=0;)be=this.containsBlackPoint(l,h,e,!1),be?(e--,b=!0,L=!0):L||e--;if(e<0){m=!0;break}for(var ve=!0;(ve||!U)&&l>=0;)ve=this.containsBlackPoint(e,o,l,!0),ve?(l--,b=!0,U=!0):U||l--;if(l<0){m=!0;break}b&&(n=!0)}if(!m&&n){for(var we=o-e,Pe=null,Ze=1;Pe===null&&Ze<we;Ze++)Pe=this.getBlackPointOnSegment(e,h-Ze,e+Ze,h);if(Pe==null)throw new Xt;for(var $e=null,Ze=1;$e===null&&Ze<we;Ze++)$e=this.getBlackPointOnSegment(e,l+Ze,e+Ze,l);if($e==null)throw new Xt;for(var xt=null,Ze=1;xt===null&&Ze<we;Ze++)xt=this.getBlackPointOnSegment(o,l+Ze,o-Ze,l);if(xt==null)throw new Xt;for(var Ct=null,Ze=1;Ct===null&&Ze<we;Ze++)Ct=this.getBlackPointOnSegment(o,h-Ze,o-Ze,h);if(Ct==null)throw new Xt;return this.centerEdges(Ct,Pe,xt,$e)}else throw new Xt},r.prototype.getBlackPointOnSegment=function(e,o,l,h){for(var m=zn.round(zn.distance(e,o,l,h)),b=(l-e)/m,n=(h-o)/m,C=this.image,D=0;D<m;D++){var L=zn.round(e+D*b),U=zn.round(o+D*n);if(C.get(L,U))return new ti(L,U)}return null},r.prototype.centerEdges=function(e,o,l,h){var m=e.getX(),b=e.getY(),n=o.getX(),C=o.getY(),D=l.getX(),L=l.getY(),U=h.getX(),q=h.getY(),Z=r.CORR;return m<this.width/2?[new ti(U-Z,q+Z),new ti(n+Z,C+Z),new ti(D-Z,L-Z),new ti(m+Z,b-Z)]:[new ti(U+Z,q+Z),new ti(n+Z,C-Z),new ti(D-Z,L+Z),new ti(m-Z,b-Z)]},r.prototype.containsBlackPoint=function(e,o,l,h){var m=this.image;if(h){for(var b=e;b<=o;b++)if(m.get(b,l))return!0}else for(var n=e;n<=o;n++)if(m.get(l,n))return!0;return!1},r.INIT_SIZE=10,r.CORR=1,r})(),wC=(function(){function r(){}return r.checkAndNudgePoints=function(e,o){for(var l=e.getWidth(),h=e.getHeight(),m=!0,b=0;b<o.length&&m;b+=2){var n=Math.floor(o[b]),C=Math.floor(o[b+1]);if(n<-1||n>l||C<-1||C>h)throw new Xt;m=!1,n===-1?(o[b]=0,m=!0):n===l&&(o[b]=l-1,m=!0),C===-1?(o[b+1]=0,m=!0):C===h&&(o[b+1]=h-1,m=!0)}m=!0;for(var b=o.length-2;b>=0&&m;b-=2){var n=Math.floor(o[b]),C=Math.floor(o[b+1]);if(n<-1||n>l||C<-1||C>h)throw new Xt;m=!1,n===-1?(o[b]=0,m=!0):n===l&&(o[b]=l-1,m=!0),C===-1?(o[b+1]=0,m=!0):C===h&&(o[b+1]=h-1,m=!0)}},r})(),PR=(function(){function r(e,o,l,h,m,b,n,C,D){this.a11=e,this.a21=o,this.a31=l,this.a12=h,this.a22=m,this.a32=b,this.a13=n,this.a23=C,this.a33=D}return r.quadrilateralToQuadrilateral=function(e,o,l,h,m,b,n,C,D,L,U,q,Z,ie,ne,be){var ve=r.quadrilateralToSquare(e,o,l,h,m,b,n,C),we=r.squareToQuadrilateral(D,L,U,q,Z,ie,ne,be);return we.times(ve)},r.prototype.transformPoints=function(e){for(var o=e.length,l=this.a11,h=this.a12,m=this.a13,b=this.a21,n=this.a22,C=this.a23,D=this.a31,L=this.a32,U=this.a33,q=0;q<o;q+=2){var Z=e[q],ie=e[q+1],ne=m*Z+C*ie+U;e[q]=(l*Z+b*ie+D)/ne,e[q+1]=(h*Z+n*ie+L)/ne}},r.prototype.transformPointsWithValues=function(e,o){for(var l=this.a11,h=this.a12,m=this.a13,b=this.a21,n=this.a22,C=this.a23,D=this.a31,L=this.a32,U=this.a33,q=e.length,Z=0;Z<q;Z++){var ie=e[Z],ne=o[Z],be=m*ie+C*ne+U;e[Z]=(l*ie+b*ne+D)/be,o[Z]=(h*ie+n*ne+L)/be}},r.squareToQuadrilateral=function(e,o,l,h,m,b,n,C){var D=e-l+m-n,L=o-h+b-C;if(D===0&&L===0)return new r(l-e,m-l,e,h-o,b-h,o,0,0,1);var U=l-m,q=n-m,Z=h-b,ie=C-b,ne=U*ie-q*Z,be=(D*ie-q*L)/ne,ve=(U*L-D*Z)/ne;return new r(l-e+be*l,n-e+ve*n,e,h-o+be*h,C-o+ve*C,o,be,ve,1)},r.quadrilateralToSquare=function(e,o,l,h,m,b,n,C){return r.squareToQuadrilateral(e,o,l,h,m,b,n,C).buildAdjoint()},r.prototype.buildAdjoint=function(){return new r(this.a22*this.a33-this.a23*this.a32,this.a23*this.a31-this.a21*this.a33,this.a21*this.a32-this.a22*this.a31,this.a13*this.a32-this.a12*this.a33,this.a11*this.a33-this.a13*this.a31,this.a12*this.a31-this.a11*this.a32,this.a12*this.a23-this.a13*this.a22,this.a13*this.a21-this.a11*this.a23,this.a11*this.a22-this.a12*this.a21)},r.prototype.times=function(e){return new r(this.a11*e.a11+this.a21*e.a12+this.a31*e.a13,this.a11*e.a21+this.a21*e.a22+this.a31*e.a23,this.a11*e.a31+this.a21*e.a32+this.a31*e.a33,this.a12*e.a11+this.a22*e.a12+this.a32*e.a13,this.a12*e.a21+this.a22*e.a22+this.a32*e.a23,this.a12*e.a31+this.a22*e.a32+this.a32*e.a33,this.a13*e.a11+this.a23*e.a12+this.a33*e.a13,this.a13*e.a21+this.a23*e.a22+this.a33*e.a23,this.a13*e.a31+this.a23*e.a32+this.a33*e.a33)},r})(),$k=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Xk=(function(r){$k(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.sampleGrid=function(o,l,h,m,b,n,C,D,L,U,q,Z,ie,ne,be,ve,we,Pe,Ze){var $e=PR.quadrilateralToQuadrilateral(m,b,n,C,D,L,U,q,Z,ie,ne,be,ve,we,Pe,Ze);return this.sampleGridWithTransform(o,l,h,$e)},e.prototype.sampleGridWithTransform=function(o,l,h,m){if(l<=0||h<=0)throw new Xt;for(var b=new If(l,h),n=new Float32Array(2*l),C=0;C<h;C++){for(var D=n.length,L=C+.5,U=0;U<D;U+=2)n[U]=U/2+.5,n[U+1]=L;m.transformPoints(n),wC.checkAndNudgePoints(o,n);try{for(var U=0;U<D;U+=2)o.get(Math.floor(n[U]),Math.floor(n[U+1]))&&b.set(U/2,C)}catch{throw new Xt}}return b},e})(wC),P2=(function(){function r(){}return r.setGridSampler=function(e){r.gridSampler=e},r.getInstance=function(){return r.gridSampler},r.gridSampler=new Xk,r})(),Hl=(function(){function r(e,o){this.x=e,this.y=o}return r.prototype.toResultPoint=function(){return new ti(this.getX(),this.getY())},r.prototype.getX=function(){return this.x},r.prototype.getY=function(){return this.y},r})(),Zk=(function(){function r(e){this.EXPECTED_CORNER_BITS=new Int32Array([3808,476,2107,1799]),this.image=e}return r.prototype.detect=function(){return this.detectMirror(!1)},r.prototype.detectMirror=function(e){var o=this.getMatrixCenter(),l=this.getBullsEyeCorners(o);if(e){var h=l[0];l[0]=l[2],l[2]=h}this.extractParameters(l);var m=this.sampleGrid(this.image,l[this.shift%4],l[(this.shift+1)%4],l[(this.shift+2)%4],l[(this.shift+3)%4]),b=this.getMatrixCornerPoints(l);return new qk(m,b,this.compact,this.nbDataBlocks,this.nbLayers)},r.prototype.extractParameters=function(e){if(!this.isValidPoint(e[0])||!this.isValidPoint(e[1])||!this.isValidPoint(e[2])||!this.isValidPoint(e[3]))throw new Xt;var o=2*this.nbCenterLayers,l=new Int32Array([this.sampleLine(e[0],e[1],o),this.sampleLine(e[1],e[2],o),this.sampleLine(e[2],e[3],o),this.sampleLine(e[3],e[0],o)]);this.shift=this.getRotation(l,o);for(var h=0,m=0;m<4;m++){var b=l[(this.shift+m)%4];this.compact?(h<<=7,h+=b>>1&127):(h<<=10,h+=(b>>2&992)+(b>>1&31))}var n=this.getCorrectedParameterData(h,this.compact);this.compact?(this.nbLayers=(n>>6)+1,this.nbDataBlocks=(n&63)+1):(this.nbLayers=(n>>11)+1,this.nbDataBlocks=(n&2047)+1)},r.prototype.getRotation=function(e,o){var l=0;e.forEach(function(m,b,n){var C=(m>>o-2<<1)+(m&1);l=(l<<3)+C}),l=((l&1)<<11)+(l>>1);for(var h=0;h<4;h++)if(pn.bitCount(l^this.EXPECTED_CORNER_BITS[h])<=2)return h;throw new Xt},r.prototype.getCorrectedParameterData=function(e,o){var l,h;o?(l=7,h=2):(l=10,h=4);for(var m=l-h,b=new Int32Array(l),n=l-1;n>=0;--n)b[n]=e&15,e>>=4;try{var C=new Wv(ql.AZTEC_PARAM);C.decode(b,m)}catch{throw new Xt}for(var D=0,n=0;n<h;n++)D=(D<<4)+b[n];return D},r.prototype.getBullsEyeCorners=function(e){var o=e,l=e,h=e,m=e,b=!0;for(this.nbCenterLayers=1;this.nbCenterLayers<9;this.nbCenterLayers++){var n=this.getFirstDifferent(o,b,1,-1),C=this.getFirstDifferent(l,b,1,1),D=this.getFirstDifferent(h,b,-1,1),L=this.getFirstDifferent(m,b,-1,-1);if(this.nbCenterLayers>2){var U=this.distancePoint(L,n)*this.nbCenterLayers/(this.distancePoint(m,o)*(this.nbCenterLayers+2));if(U<.75||U>1.25||!this.isWhiteOrBlackRectangle(n,C,D,L))break}o=n,l=C,h=D,m=L,b=!b}if(this.nbCenterLayers!==5&&this.nbCenterLayers!==7)throw new Xt;this.compact=this.nbCenterLayers===5;var q=new ti(o.getX()+.5,o.getY()-.5),Z=new ti(l.getX()+.5,l.getY()+.5),ie=new ti(h.getX()-.5,h.getY()+.5),ne=new ti(m.getX()-.5,m.getY()-.5);return this.expandSquare([q,Z,ie,ne],2*this.nbCenterLayers-3,2*this.nbCenterLayers)},r.prototype.getMatrixCenter=function(){var e,o,l,h;try{var m=new Tw(this.image).detect();e=m[0],o=m[1],l=m[2],h=m[3]}catch{var b=this.image.getWidth()/2,n=this.image.getHeight()/2;e=this.getFirstDifferent(new Hl(b+7,n-7),!1,1,-1).toResultPoint(),o=this.getFirstDifferent(new Hl(b+7,n+7),!1,1,1).toResultPoint(),l=this.getFirstDifferent(new Hl(b-7,n+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new Hl(b-7,n-7),!1,-1,-1).toResultPoint()}var C=zn.round((e.getX()+h.getX()+o.getX()+l.getX())/4),D=zn.round((e.getY()+h.getY()+o.getY()+l.getY())/4);try{var m=new Tw(this.image,15,C,D).detect();e=m[0],o=m[1],l=m[2],h=m[3]}catch{e=this.getFirstDifferent(new Hl(C+7,D-7),!1,1,-1).toResultPoint(),o=this.getFirstDifferent(new Hl(C+7,D+7),!1,1,1).toResultPoint(),l=this.getFirstDifferent(new Hl(C-7,D+7),!1,-1,1).toResultPoint(),h=this.getFirstDifferent(new Hl(C-7,D-7),!1,-1,-1).toResultPoint()}return C=zn.round((e.getX()+h.getX()+o.getX()+l.getX())/4),D=zn.round((e.getY()+h.getY()+o.getY()+l.getY())/4),new Hl(C,D)},r.prototype.getMatrixCornerPoints=function(e){return this.expandSquare(e,2*this.nbCenterLayers,this.getDimension())},r.prototype.sampleGrid=function(e,o,l,h,m){var b=P2.getInstance(),n=this.getDimension(),C=n/2-this.nbCenterLayers,D=n/2+this.nbCenterLayers;return b.sampleGrid(e,n,n,C,C,D,C,D,D,C,D,o.getX(),o.getY(),l.getX(),l.getY(),h.getX(),h.getY(),m.getX(),m.getY())},r.prototype.sampleLine=function(e,o,l){for(var h=0,m=this.distanceResultPoint(e,o),b=m/l,n=e.getX(),C=e.getY(),D=b*(o.getX()-e.getX())/m,L=b*(o.getY()-e.getY())/m,U=0;U<l;U++)this.image.get(zn.round(n+U*D),zn.round(C+U*L))&&(h|=1<<l-U-1);return h},r.prototype.isWhiteOrBlackRectangle=function(e,o,l,h){var m=3;e=new Hl(e.getX()-m,e.getY()+m),o=new Hl(o.getX()-m,o.getY()-m),l=new Hl(l.getX()+m,l.getY()-m),h=new Hl(h.getX()+m,h.getY()+m);var b=this.getColor(h,e);if(b===0)return!1;var n=this.getColor(e,o);return n!==b||(n=this.getColor(o,l),n!==b)?!1:(n=this.getColor(l,h),n===b)},r.prototype.getColor=function(e,o){for(var l=this.distancePoint(e,o),h=(o.getX()-e.getX())/l,m=(o.getY()-e.getY())/l,b=0,n=e.getX(),C=e.getY(),D=this.image.get(e.getX(),e.getY()),L=Math.ceil(l),U=0;U<L;U++)n+=h,C+=m,this.image.get(zn.round(n),zn.round(C))!==D&&b++;var q=b/l;return q>.1&&q<.9?0:q<=.1===D?1:-1},r.prototype.getFirstDifferent=function(e,o,l,h){for(var m=e.getX()+l,b=e.getY()+h;this.isValid(m,b)&&this.image.get(m,b)===o;)m+=l,b+=h;for(m-=l,b-=h;this.isValid(m,b)&&this.image.get(m,b)===o;)m+=l;for(m-=l;this.isValid(m,b)&&this.image.get(m,b)===o;)b+=h;return b-=h,new Hl(m,b)},r.prototype.expandSquare=function(e,o,l){var h=l/(2*o),m=e[0].getX()-e[2].getX(),b=e[0].getY()-e[2].getY(),n=(e[0].getX()+e[2].getX())/2,C=(e[0].getY()+e[2].getY())/2,D=new ti(n+h*m,C+h*b),L=new ti(n-h*m,C-h*b);m=e[1].getX()-e[3].getX(),b=e[1].getY()-e[3].getY(),n=(e[1].getX()+e[3].getX())/2,C=(e[1].getY()+e[3].getY())/2;var U=new ti(n+h*m,C+h*b),q=new ti(n-h*m,C-h*b),Z=[D,U,L,q];return Z},r.prototype.isValid=function(e,o){return e>=0&&e<this.image.getWidth()&&o>0&&o<this.image.getHeight()},r.prototype.isValidPoint=function(e){var o=zn.round(e.getX()),l=zn.round(e.getY());return this.isValid(o,l)},r.prototype.distancePoint=function(e,o){return zn.distance(e.getX(),e.getY(),o.getX(),o.getY())},r.prototype.distanceResultPoint=function(e,o){return zn.distance(e.getX(),e.getY(),o.getX(),o.getY())},r.prototype.getDimension=function(){return this.compact?4*this.nbLayers+11:this.nbLayers<=4?4*this.nbLayers+15:4*this.nbLayers+2*(pn.truncDivision(this.nbLayers-4,8)+1)+15},r})(),Aw=(function(){function r(){}return r.prototype.decode=function(e,o){o===void 0&&(o=null);var l=null,h=new Zk(e.getBlackMatrix()),m=null,b=null;try{var n=h.detectMirror(!1);m=n.getPoints(),this.reportFoundResultPoints(o,m),b=new bC().decode(n)}catch(U){l=U}if(b==null)try{var n=h.detectMirror(!0);m=n.getPoints(),this.reportFoundResultPoints(o,m),b=new bC().decode(n)}catch(U){throw l??U}var C=new Hs(b.getText(),b.getRawBytes(),b.getNumBits(),m,yi.AZTEC,yo.currentTimeMillis()),D=b.getByteSegments();D!=null&&C.putMetadata(gs.BYTE_SEGMENTS,D);var L=b.getECLevel();return L!=null&&C.putMetadata(gs.ERROR_CORRECTION_LEVEL,L),C},r.prototype.reportFoundResultPoints=function(e,o){if(e!=null){var l=e.get(Io.NEED_RESULT_POINT_CALLBACK);l!=null&&o.forEach(function(h,m,b){l.foundPossibleResultPoint(h)})}},r.prototype.reset=function(){},r})(),Wk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){Wk(e,r);function e(o){return o===void 0&&(o=500),r.call(this,new Aw,o)||this}return e})(J_);var Na=(function(){function r(){}return r.prototype.decode=function(e,o){try{return this.doDecode(e,o)}catch{var l=o&&o.get(Io.TRY_HARDER)===!0;if(l&&e.isRotateSupported()){var h=e.rotateCounterClockwise(),m=this.doDecode(h,o),b=m.getResultMetadata(),n=270;b!==null&&b.get(gs.ORIENTATION)===!0&&(n=n+b.get(gs.ORIENTATION)%360),m.putMetadata(gs.ORIENTATION,n);var C=m.getResultPoints();if(C!==null)for(var D=h.getHeight(),L=0;L<C.length;L++)C[L]=new ti(D-C[L].getY()-1,C[L].getX());return m}else throw new Xt}},r.prototype.reset=function(){},r.prototype.doDecode=function(e,o){var l=e.getWidth(),h=e.getHeight(),m=new Ja(l),b=o&&o.get(Io.TRY_HARDER)===!0,n=Math.max(1,h>>(b?8:5)),C;b?C=h:C=15;for(var D=Math.trunc(h/2),L=0;L<C;L++){var U=Math.trunc((L+1)/2),q=(L&1)===0,Z=D+n*(q?U:-U);if(Z<0||Z>=h)break;try{m=e.getBlackRow(Z,m)}catch{continue}for(var ie=function(we){if(we===1&&(m.reverse(),o&&o.get(Io.NEED_RESULT_POINT_CALLBACK)===!0)){var Pe=new Map;o.forEach(function(xt,Ct){return Pe.set(Ct,xt)}),Pe.delete(Io.NEED_RESULT_POINT_CALLBACK),o=Pe}try{var Ze=ne.decodeRow(Z,m,o);if(we===1){Ze.putMetadata(gs.ORIENTATION,180);var $e=Ze.getResultPoints();$e!==null&&($e[0]=new ti(l-$e[0].getX()-1,$e[0].getY()),$e[1]=new ti(l-$e[1].getX()-1,$e[1].getY()))}return{value:Ze}}catch{}},ne=this,be=0;be<2;be++){var ve=ie(be);if(typeof ve=="object")return ve.value}}throw new Xt},r.recordPattern=function(e,o,l){for(var h=l.length,m=0;m<h;m++)l[m]=0;var b=e.getSize();if(o>=b)throw new Xt;for(var n=!e.get(o),C=0,D=o;D<b;){if(e.get(D)!==n)l[C]++;else{if(++C===h)break;l[C]=1,n=!n}D++}if(!(C===h||C===h-1&&D===b))throw new Xt},r.recordPatternInReverse=function(e,o,l){for(var h=l.length,m=e.get(o);o>0&&h>=0;)e.get(--o)!==m&&(h--,m=!m);if(h>=0)throw new Xt;r.recordPattern(e,o+1,l)},r.patternMatchVariance=function(e,o,l){for(var h=e.length,m=0,b=0,n=0;n<h;n++)m+=e[n],b+=o[n];if(m<b)return Number.POSITIVE_INFINITY;var C=m/b;l*=C;for(var D=0,L=0;L<h;L++){var U=e[L],q=o[L]*C,Z=U>q?U-q:q-U;if(Z>l)return Number.POSITIVE_INFINITY;D+=Z}return D/m},r})(),Yk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),SC=(function(r){Yk(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.findStartPattern=function(o){for(var l=o.getSize(),h=o.getNextSet(0),m=0,b=Int32Array.from([0,0,0,0,0,0]),n=h,C=!1,D=6,L=h;L<l;L++)if(o.get(L)!==C)b[m]++;else{if(m===D-1){for(var U=e.MAX_AVG_VARIANCE,q=-1,Z=e.CODE_START_A;Z<=e.CODE_START_C;Z++){var ie=Na.patternMatchVariance(b,e.CODE_PATTERNS[Z],e.MAX_INDIVIDUAL_VARIANCE);ie<U&&(U=ie,q=Z)}if(q>=0&&o.isRange(Math.max(0,n-(L-n)/2),n,!1))return Int32Array.from([n,L,q]);n+=b[0]+b[1],b=b.slice(2,b.length),b[m-1]=0,b[m]=0,m--}else m++;b[m]=1,C=!C}throw new Xt},e.decodeCode=function(o,l,h){Na.recordPattern(o,h,l);for(var m=e.MAX_AVG_VARIANCE,b=-1,n=0;n<e.CODE_PATTERNS.length;n++){var C=e.CODE_PATTERNS[n],D=this.patternMatchVariance(l,C,e.MAX_INDIVIDUAL_VARIANCE);D<m&&(m=D,b=n)}if(b>=0)return b;throw new Xt},e.prototype.decodeRow=function(o,l,h){var m=h&&h.get(Io.ASSUME_GS1)===!0,b=e.findStartPattern(l),n=b[2],C=0,D=new Uint8Array(20);D[C++]=n;var L;switch(n){case e.CODE_START_A:L=e.CODE_CODE_A;break;case e.CODE_START_B:L=e.CODE_CODE_B;break;case e.CODE_START_C:L=e.CODE_CODE_C;break;default:throw new Ir}for(var U=!1,q=!1,Z="",ie=b[0],ne=b[1],be=Int32Array.from([0,0,0,0,0,0]),ve=0,we=0,Pe=n,Ze=0,$e=!0,xt=!1,Ct=!1;!U;){var Ft=q;switch(q=!1,ve=we,we=e.decodeCode(l,be,ne),D[C++]=we,we!==e.CODE_STOP&&($e=!0),we!==e.CODE_STOP&&(Ze++,Pe+=Ze*we),ie=ne,ne+=be.reduce(function(sr,Fr){return sr+Fr},0),we){case e.CODE_START_A:case e.CODE_START_B:case e.CODE_START_C:throw new Ir}switch(L){case e.CODE_CODE_A:if(we<64)Ct===xt?Z+=String.fromCharCode(32+we):Z+=String.fromCharCode(32+we+128),Ct=!1;else if(we<96)Ct===xt?Z+=String.fromCharCode(we-64):Z+=String.fromCharCode(we+64),Ct=!1;else switch(we!==e.CODE_STOP&&($e=!1),we){case e.CODE_FNC_1:m&&(Z.length===0?Z+="]C1":Z+="");break;case e.CODE_FNC_2:case e.CODE_FNC_3:break;case e.CODE_FNC_4_A:!xt&&Ct?(xt=!0,Ct=!1):xt&&Ct?(xt=!1,Ct=!1):Ct=!0;break;case e.CODE_SHIFT:q=!0,L=e.CODE_CODE_B;break;case e.CODE_CODE_B:L=e.CODE_CODE_B;break;case e.CODE_CODE_C:L=e.CODE_CODE_C;break;case e.CODE_STOP:U=!0;break}break;case e.CODE_CODE_B:if(we<96)Ct===xt?Z+=String.fromCharCode(32+we):Z+=String.fromCharCode(32+we+128),Ct=!1;else switch(we!==e.CODE_STOP&&($e=!1),we){case e.CODE_FNC_1:m&&(Z.length===0?Z+="]C1":Z+="");break;case e.CODE_FNC_2:case e.CODE_FNC_3:break;case e.CODE_FNC_4_B:!xt&&Ct?(xt=!0,Ct=!1):xt&&Ct?(xt=!1,Ct=!1):Ct=!0;break;case e.CODE_SHIFT:q=!0,L=e.CODE_CODE_A;break;case e.CODE_CODE_A:L=e.CODE_CODE_A;break;case e.CODE_CODE_C:L=e.CODE_CODE_C;break;case e.CODE_STOP:U=!0;break}break;case e.CODE_CODE_C:if(we<100)we<10&&(Z+="0"),Z+=we;else switch(we!==e.CODE_STOP&&($e=!1),we){case e.CODE_FNC_1:m&&(Z.length===0?Z+="]C1":Z+="");break;case e.CODE_CODE_A:L=e.CODE_CODE_A;break;case e.CODE_CODE_B:L=e.CODE_CODE_B;break;case e.CODE_STOP:U=!0;break}break}Ft&&(L=L===e.CODE_CODE_A?e.CODE_CODE_B:e.CODE_CODE_A)}var Yt=ne-ie;if(ne=l.getNextUnset(ne),!l.isRange(ne,Math.min(l.getSize(),ne+(ne-ie)/2),!1))throw new Xt;if(Pe-=Ze*ve,Pe%103!==ve)throw new Ka;var hr=Z.length;if(hr===0)throw new Xt;hr>0&&$e&&(L===e.CODE_CODE_C?Z=Z.substring(0,hr-2):Z=Z.substring(0,hr-1));for(var pr=(b[1]+b[0])/2,Kr=ie+Yt/2,ui=D.length,zi=new Uint8Array(ui),Qr=0;Qr<ui;Qr++)zi[Qr]=D[Qr];var Ot=[new ti(pr,o),new ti(Kr,o)];return new Hs(Z,zi,0,Ot,yi.CODE_128,new Date().getTime())},e.CODE_PATTERNS=[Int32Array.from([2,1,2,2,2,2]),Int32Array.from([2,2,2,1,2,2]),Int32Array.from([2,2,2,2,2,1]),Int32Array.from([1,2,1,2,2,3]),Int32Array.from([1,2,1,3,2,2]),Int32Array.from([1,3,1,2,2,2]),Int32Array.from([1,2,2,2,1,3]),Int32Array.from([1,2,2,3,1,2]),Int32Array.from([1,3,2,2,1,2]),Int32Array.from([2,2,1,2,1,3]),Int32Array.from([2,2,1,3,1,2]),Int32Array.from([2,3,1,2,1,2]),Int32Array.from([1,1,2,2,3,2]),Int32Array.from([1,2,2,1,3,2]),Int32Array.from([1,2,2,2,3,1]),Int32Array.from([1,1,3,2,2,2]),Int32Array.from([1,2,3,1,2,2]),Int32Array.from([1,2,3,2,2,1]),Int32Array.from([2,2,3,2,1,1]),Int32Array.from([2,2,1,1,3,2]),Int32Array.from([2,2,1,2,3,1]),Int32Array.from([2,1,3,2,1,2]),Int32Array.from([2,2,3,1,1,2]),Int32Array.from([3,1,2,1,3,1]),Int32Array.from([3,1,1,2,2,2]),Int32Array.from([3,2,1,1,2,2]),Int32Array.from([3,2,1,2,2,1]),Int32Array.from([3,1,2,2,1,2]),Int32Array.from([3,2,2,1,1,2]),Int32Array.from([3,2,2,2,1,1]),Int32Array.from([2,1,2,1,2,3]),Int32Array.from([2,1,2,3,2,1]),Int32Array.from([2,3,2,1,2,1]),Int32Array.from([1,1,1,3,2,3]),Int32Array.from([1,3,1,1,2,3]),Int32Array.from([1,3,1,3,2,1]),Int32Array.from([1,1,2,3,1,3]),Int32Array.from([1,3,2,1,1,3]),Int32Array.from([1,3,2,3,1,1]),Int32Array.from([2,1,1,3,1,3]),Int32Array.from([2,3,1,1,1,3]),Int32Array.from([2,3,1,3,1,1]),Int32Array.from([1,1,2,1,3,3]),Int32Array.from([1,1,2,3,3,1]),Int32Array.from([1,3,2,1,3,1]),Int32Array.from([1,1,3,1,2,3]),Int32Array.from([1,1,3,3,2,1]),Int32Array.from([1,3,3,1,2,1]),Int32Array.from([3,1,3,1,2,1]),Int32Array.from([2,1,1,3,3,1]),Int32Array.from([2,3,1,1,3,1]),Int32Array.from([2,1,3,1,1,3]),Int32Array.from([2,1,3,3,1,1]),Int32Array.from([2,1,3,1,3,1]),Int32Array.from([3,1,1,1,2,3]),Int32Array.from([3,1,1,3,2,1]),Int32Array.from([3,3,1,1,2,1]),Int32Array.from([3,1,2,1,1,3]),Int32Array.from([3,1,2,3,1,1]),Int32Array.from([3,3,2,1,1,1]),Int32Array.from([3,1,4,1,1,1]),Int32Array.from([2,2,1,4,1,1]),Int32Array.from([4,3,1,1,1,1]),Int32Array.from([1,1,1,2,2,4]),Int32Array.from([1,1,1,4,2,2]),Int32Array.from([1,2,1,1,2,4]),Int32Array.from([1,2,1,4,2,1]),Int32Array.from([1,4,1,1,2,2]),Int32Array.from([1,4,1,2,2,1]),Int32Array.from([1,1,2,2,1,4]),Int32Array.from([1,1,2,4,1,2]),Int32Array.from([1,2,2,1,1,4]),Int32Array.from([1,2,2,4,1,1]),Int32Array.from([1,4,2,1,1,2]),Int32Array.from([1,4,2,2,1,1]),Int32Array.from([2,4,1,2,1,1]),Int32Array.from([2,2,1,1,1,4]),Int32Array.from([4,1,3,1,1,1]),Int32Array.from([2,4,1,1,1,2]),Int32Array.from([1,3,4,1,1,1]),Int32Array.from([1,1,1,2,4,2]),Int32Array.from([1,2,1,1,4,2]),Int32Array.from([1,2,1,2,4,1]),Int32Array.from([1,1,4,2,1,2]),Int32Array.from([1,2,4,1,1,2]),Int32Array.from([1,2,4,2,1,1]),Int32Array.from([4,1,1,2,1,2]),Int32Array.from([4,2,1,1,1,2]),Int32Array.from([4,2,1,2,1,1]),Int32Array.from([2,1,2,1,4,1]),Int32Array.from([2,1,4,1,2,1]),Int32Array.from([4,1,2,1,2,1]),Int32Array.from([1,1,1,1,4,3]),Int32Array.from([1,1,1,3,4,1]),Int32Array.from([1,3,1,1,4,1]),Int32Array.from([1,1,4,1,1,3]),Int32Array.from([1,1,4,3,1,1]),Int32Array.from([4,1,1,1,1,3]),Int32Array.from([4,1,1,3,1,1]),Int32Array.from([1,1,3,1,4,1]),Int32Array.from([1,1,4,1,3,1]),Int32Array.from([3,1,1,1,4,1]),Int32Array.from([4,1,1,1,3,1]),Int32Array.from([2,1,1,4,1,2]),Int32Array.from([2,1,1,2,1,4]),Int32Array.from([2,1,1,2,3,2]),Int32Array.from([2,3,3,1,1,1,2])],e.MAX_AVG_VARIANCE=.25,e.MAX_INDIVIDUAL_VARIANCE=.7,e.CODE_SHIFT=98,e.CODE_CODE_C=99,e.CODE_CODE_B=100,e.CODE_CODE_A=101,e.CODE_FNC_1=102,e.CODE_FNC_2=97,e.CODE_FNC_3=96,e.CODE_FNC_4_A=101,e.CODE_FNC_4_B=100,e.CODE_START_A=103,e.CODE_START_B=104,e.CODE_START_C=105,e.CODE_STOP=106,e})(Na),Qk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Mb=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},TC=(function(r){Qk(e,r);function e(o,l){o===void 0&&(o=!1),l===void 0&&(l=!1);var h=r.call(this)||this;return h.usingCheckDigit=o,h.extendedMode=l,h.decodeRowResult="",h.counters=new Int32Array(9),h}return e.prototype.decodeRow=function(o,l,h){var m,b,n,C,D=this.counters;D.fill(0),this.decodeRowResult="";var L=e.findAsteriskPattern(l,D),U=l.getNextSet(L[1]),q=l.getSize(),Z,ie;do{e.recordPattern(l,U,D);var ne=e.toNarrowWidePattern(D);if(ne<0)throw new Xt;Z=e.patternToChar(ne),this.decodeRowResult+=Z,ie=U;try{for(var be=(m=void 0,Mb(D)),ve=be.next();!ve.done;ve=be.next()){var we=ve.value;U+=we}}catch(ui){m={error:ui}}finally{try{ve&&!ve.done&&(b=be.return)&&b.call(be)}finally{if(m)throw m.error}}U=l.getNextSet(U)}while(Z!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var Pe=0;try{for(var Ze=Mb(D),$e=Ze.next();!$e.done;$e=Ze.next()){var we=$e.value;Pe+=we}}catch(ui){n={error:ui}}finally{try{$e&&!$e.done&&(C=Ze.return)&&C.call(Ze)}finally{if(n)throw n.error}}var xt=U-ie-Pe;if(U!==q&&xt*2<Pe)throw new Xt;if(this.usingCheckDigit){for(var Ct=this.decodeRowResult.length-1,Ft=0,Yt=0;Yt<Ct;Yt++)Ft+=e.ALPHABET_STRING.indexOf(this.decodeRowResult.charAt(Yt));if(this.decodeRowResult.charAt(Ct)!==e.ALPHABET_STRING.charAt(Ft%43))throw new Ka;this.decodeRowResult=this.decodeRowResult.substring(0,Ct)}if(this.decodeRowResult.length===0)throw new Xt;var hr;this.extendedMode?hr=e.decodeExtended(this.decodeRowResult):hr=this.decodeRowResult;var pr=(L[1]+L[0])/2,Kr=ie+Pe/2;return new Hs(hr,null,0,[new ti(pr,o),new ti(Kr,o)],yi.CODE_39,new Date().getTime())},e.findAsteriskPattern=function(o,l){for(var h=o.getSize(),m=o.getNextSet(0),b=0,n=m,C=!1,D=l.length,L=m;L<h;L++)if(o.get(L)!==C)l[b]++;else{if(b===D-1){if(this.toNarrowWidePattern(l)===e.ASTERISK_ENCODING&&o.isRange(Math.max(0,n-Math.floor((L-n)/2)),n,!1))return[n,L];n+=l[0]+l[1],l.copyWithin(0,2,2+b-1),l[b-1]=0,l[b]=0,b--}else b++;l[b]=1,C=!C}throw new Xt},e.toNarrowWidePattern=function(o){var l,h,m=o.length,b=0,n;do{var C=2147483647;try{for(var D=(l=void 0,Mb(o)),L=D.next();!L.done;L=D.next()){var U=L.value;U<C&&U>b&&(C=U)}}catch(ne){l={error:ne}}finally{try{L&&!L.done&&(h=D.return)&&h.call(D)}finally{if(l)throw l.error}}b=C,n=0;for(var q=0,Z=0,ie=0;ie<m;ie++){var U=o[ie];U>b&&(Z|=1<<m-1-ie,n++,q+=U)}if(n===3){for(var ie=0;ie<m&&n>0;ie++){var U=o[ie];if(U>b&&(n--,U*2>=q))return-1}return Z}}while(n>3);return-1},e.patternToChar=function(o){for(var l=0;l<e.CHARACTER_ENCODINGS.length;l++)if(e.CHARACTER_ENCODINGS[l]===o)return e.ALPHABET_STRING.charAt(l);if(o===e.ASTERISK_ENCODING)return"*";throw new Xt},e.decodeExtended=function(o){for(var l=o.length,h="",m=0;m<l;m++){var b=o.charAt(m);if(b==="+"||b==="$"||b==="%"||b==="/"){var n=o.charAt(m+1),C="\0";switch(b){case"+":if(n>="A"&&n<="Z")C=String.fromCharCode(n.charCodeAt(0)+32);else throw new Ir;break;case"$":if(n>="A"&&n<="Z")C=String.fromCharCode(n.charCodeAt(0)-64);else throw new Ir;break;case"%":if(n>="A"&&n<="E")C=String.fromCharCode(n.charCodeAt(0)-38);else if(n>="F"&&n<="J")C=String.fromCharCode(n.charCodeAt(0)-11);else if(n>="K"&&n<="O")C=String.fromCharCode(n.charCodeAt(0)+16);else if(n>="P"&&n<="T")C=String.fromCharCode(n.charCodeAt(0)+43);else if(n==="U")C="\0";else if(n==="V")C="@";else if(n==="W")C="`";else if(n==="X"||n==="Y"||n==="Z")C="";else throw new Ir;break;case"/":if(n>="A"&&n<="O")C=String.fromCharCode(n.charCodeAt(0)-32);else if(n==="Z")C=":";else throw new Ir;break}h+=C,m++}else h+=b}return h},e.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%",e.CHARACTER_ENCODINGS=[52,289,97,352,49,304,112,37,292,100,265,73,328,25,280,88,13,268,76,28,259,67,322,19,274,82,7,262,70,22,385,193,448,145,400,208,133,388,196,168,162,138,42],e.ASTERISK_ENCODING=148,e})(Na),Kk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Db=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},AC=(function(r){Kk(e,r);function e(){var o=r.call(this)||this;return o.decodeRowResult="",o.counters=new Int32Array(6),o}return e.prototype.decodeRow=function(o,l,h){var m,b,n,C,D=this.findAsteriskPattern(l),L=l.getNextSet(D[1]),U=l.getSize(),q=this.counters;q.fill(0),this.decodeRowResult="";var Z,ie;do{e.recordPattern(l,L,q);var ne=this.toPattern(q);if(ne<0)throw new Xt;Z=this.patternToChar(ne),this.decodeRowResult+=Z,ie=L;try{for(var be=(m=void 0,Db(q)),ve=be.next();!ve.done;ve=be.next()){var we=ve.value;L+=we}}catch(Yt){m={error:Yt}}finally{try{ve&&!ve.done&&(b=be.return)&&b.call(be)}finally{if(m)throw m.error}}L=l.getNextSet(L)}while(Z!=="*");this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-1);var Pe=0;try{for(var Ze=Db(q),$e=Ze.next();!$e.done;$e=Ze.next()){var we=$e.value;Pe+=we}}catch(Yt){n={error:Yt}}finally{try{$e&&!$e.done&&(C=Ze.return)&&C.call(Ze)}finally{if(n)throw n.error}}if(L===U||!l.get(L))throw new Xt;if(this.decodeRowResult.length<2)throw new Xt;this.checkChecksums(this.decodeRowResult),this.decodeRowResult=this.decodeRowResult.substring(0,this.decodeRowResult.length-2);var xt=this.decodeExtended(this.decodeRowResult),Ct=(D[1]+D[0])/2,Ft=ie+Pe/2;return new Hs(xt,null,0,[new ti(Ct,o),new ti(Ft,o)],yi.CODE_93,new Date().getTime())},e.prototype.findAsteriskPattern=function(o){var l=o.getSize(),h=o.getNextSet(0);this.counters.fill(0);for(var m=this.counters,b=h,n=!1,C=m.length,D=0,L=h;L<l;L++)if(o.get(L)!==n)m[D]++;else{if(D===C-1){if(this.toPattern(m)===e.ASTERISK_ENCODING)return new Int32Array([b,L]);b+=m[0]+m[1],m.copyWithin(0,2,2+D-1),m[D-1]=0,m[D]=0,D--}else D++;m[D]=1,n=!n}throw new Xt},e.prototype.toPattern=function(o){var l,h,m=0;try{for(var b=Db(o),n=b.next();!n.done;n=b.next()){var C=n.value;m+=C}}catch(ie){l={error:ie}}finally{try{n&&!n.done&&(h=b.return)&&h.call(b)}finally{if(l)throw l.error}}for(var D=0,L=o.length,U=0;U<L;U++){var q=Math.round(o[U]*9/m);if(q<1||q>4)return-1;if((U&1)===0)for(var Z=0;Z<q;Z++)D=D<<1|1;else D<<=q}return D},e.prototype.patternToChar=function(o){for(var l=0;l<e.CHARACTER_ENCODINGS.length;l++)if(e.CHARACTER_ENCODINGS[l]===o)return e.ALPHABET_STRING.charAt(l);throw new Xt},e.prototype.decodeExtended=function(o){for(var l=o.length,h="",m=0;m<l;m++){var b=o.charAt(m);if(b>="a"&&b<="d"){if(m>=l-1)throw new Ir;var n=o.charAt(m+1),C="\0";switch(b){case"d":if(n>="A"&&n<="Z")C=String.fromCharCode(n.charCodeAt(0)+32);else throw new Ir;break;case"a":if(n>="A"&&n<="Z")C=String.fromCharCode(n.charCodeAt(0)-64);else throw new Ir;break;case"b":if(n>="A"&&n<="E")C=String.fromCharCode(n.charCodeAt(0)-38);else if(n>="F"&&n<="J")C=String.fromCharCode(n.charCodeAt(0)-11);else if(n>="K"&&n<="O")C=String.fromCharCode(n.charCodeAt(0)+16);else if(n>="P"&&n<="T")C=String.fromCharCode(n.charCodeAt(0)+43);else if(n==="U")C="\0";else if(n==="V")C="@";else if(n==="W")C="`";else if(n>="X"&&n<="Z")C="";else throw new Ir;break;case"c":if(n>="A"&&n<="O")C=String.fromCharCode(n.charCodeAt(0)-32);else if(n==="Z")C=":";else throw new Ir;break}h+=C,m++}else h+=b}return h},e.prototype.checkChecksums=function(o){var l=o.length;this.checkOneChecksum(o,l-2,20),this.checkOneChecksum(o,l-1,15)},e.prototype.checkOneChecksum=function(o,l,h){for(var m=1,b=0,n=l-1;n>=0;n--)b+=m*e.ALPHABET_STRING.indexOf(o.charAt(n)),++m>h&&(m=1);if(o.charAt(l)!==e.ALPHABET_STRING[b%47])throw new Ka},e.ALPHABET_STRING="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ-. $/+%abcd*",e.CHARACTER_ENCODINGS=[276,328,324,322,296,292,290,336,274,266,424,420,418,404,402,394,360,356,354,308,282,344,332,326,300,278,436,434,428,422,406,410,364,358,310,314,302,468,466,458,366,374,430,294,474,470,306,350],e.ASTERISK_ENCODING=e.CHARACTER_ENCODINGS[47],e})(Na),Jk=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),eN=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},EC=(function(r){Jk(e,r);function e(){var o=r!==null&&r.apply(this,arguments)||this;return o.narrowLineWidth=-1,o}return e.prototype.decodeRow=function(o,l,h){var m,b,n=this.decodeStart(l),C=this.decodeEnd(l),D=new cn;e.decodeMiddle(l,n[1],C[0],D);var L=D.toString(),U=null;h!=null&&(U=h.get(Io.ALLOWED_LENGTHS)),U==null&&(U=e.DEFAULT_ALLOWED_LENGTHS);var q=L.length,Z=!1,ie=0;try{for(var ne=eN(U),be=ne.next();!be.done;be=ne.next()){var ve=be.value;if(q===ve){Z=!0;break}ve>ie&&(ie=ve)}}catch(Ze){m={error:Ze}}finally{try{be&&!be.done&&(b=ne.return)&&b.call(ne)}finally{if(m)throw m.error}}if(!Z&&q>ie&&(Z=!0),!Z)throw new Ir;var we=[new ti(n[1],o),new ti(C[0],o)],Pe=new Hs(L,null,0,we,yi.ITF,new Date().getTime());return Pe},e.decodeMiddle=function(o,l,h,m){var b=new Int32Array(10),n=new Int32Array(5),C=new Int32Array(5);for(b.fill(0),n.fill(0),C.fill(0);l<h;){Na.recordPattern(o,l,b);for(var D=0;D<5;D++){var L=2*D;n[D]=b[L],C[D]=b[L+1]}var U=e.decodeDigit(n);m.append(U.toString()),U=this.decodeDigit(C),m.append(U.toString()),b.forEach(function(q){l+=q})}},e.prototype.decodeStart=function(o){var l=e.skipWhiteSpace(o),h=e.findGuardPattern(o,l,e.START_PATTERN);return this.narrowLineWidth=(h[1]-h[0])/4,this.validateQuietZone(o,h[0]),h},e.prototype.validateQuietZone=function(o,l){var h=this.narrowLineWidth*10;h=h<l?h:l;for(var m=l-1;h>0&&m>=0&&!o.get(m);m--)h--;if(h!==0)throw new Xt},e.skipWhiteSpace=function(o){var l=o.getSize(),h=o.getNextSet(0);if(h===l)throw new Xt;return h},e.prototype.decodeEnd=function(o){o.reverse();try{var l=e.skipWhiteSpace(o),h=void 0;try{h=e.findGuardPattern(o,l,e.END_PATTERN_REVERSED[0])}catch(b){b instanceof Xt&&(h=e.findGuardPattern(o,l,e.END_PATTERN_REVERSED[1]))}this.validateQuietZone(o,h[0]);var m=h[0];return h[0]=o.getSize()-h[1],h[1]=o.getSize()-m,h}finally{o.reverse()}},e.findGuardPattern=function(o,l,h){var m=h.length,b=new Int32Array(m),n=o.getSize(),C=!1,D=0,L=l;b.fill(0);for(var U=l;U<n;U++)if(o.get(U)!==C)b[D]++;else{if(D===m-1){if(Na.patternMatchVariance(b,h,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return[L,U];L+=b[0]+b[1],yo.arraycopy(b,2,b,0,D-1),b[D-1]=0,b[D]=0,D--}else D++;b[D]=1,C=!C}throw new Xt},e.decodeDigit=function(o){for(var l=e.MAX_AVG_VARIANCE,h=-1,m=e.PATTERNS.length,b=0;b<m;b++){var n=e.PATTERNS[b],C=Na.patternMatchVariance(o,n,e.MAX_INDIVIDUAL_VARIANCE);C<l?(l=C,h=b):C===l&&(h=-1)}if(h>=0)return h%10;throw new Xt},e.PATTERNS=[Int32Array.from([1,1,2,2,1]),Int32Array.from([2,1,1,1,2]),Int32Array.from([1,2,1,1,2]),Int32Array.from([2,2,1,1,1]),Int32Array.from([1,1,2,1,2]),Int32Array.from([2,1,2,1,1]),Int32Array.from([1,2,2,1,1]),Int32Array.from([1,1,1,2,2]),Int32Array.from([2,1,1,2,1]),Int32Array.from([1,2,1,2,1]),Int32Array.from([1,1,3,3,1]),Int32Array.from([3,1,1,1,3]),Int32Array.from([1,3,1,1,3]),Int32Array.from([3,3,1,1,1]),Int32Array.from([1,1,3,1,3]),Int32Array.from([3,1,3,1,1]),Int32Array.from([1,3,3,1,1]),Int32Array.from([1,1,1,3,3]),Int32Array.from([3,1,1,3,1]),Int32Array.from([1,3,1,3,1])],e.MAX_AVG_VARIANCE=.38,e.MAX_INDIVIDUAL_VARIANCE=.5,e.DEFAULT_ALLOWED_LENGTHS=[6,8,10,12,14],e.START_PATTERN=Int32Array.from([1,1,1,1]),e.END_PATTERN_REVERSED=[Int32Array.from([1,1,2]),Int32Array.from([1,1,3])],e})(Na),tN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),q_=(function(r){tN(e,r);function e(){var o=r!==null&&r.apply(this,arguments)||this;return o.decodeRowStringBuffer="",o}return e.findStartGuardPattern=function(o){for(var l=!1,h,m=0,b=Int32Array.from([0,0,0]);!l;){b=Int32Array.from([0,0,0]),h=e.findGuardPattern(o,m,!1,this.START_END_PATTERN,b);var n=h[0];m=h[1];var C=n-(m-n);C>=0&&(l=o.isRange(C,n,!1))}return h},e.checkChecksum=function(o){return e.checkStandardUPCEANChecksum(o)},e.checkStandardUPCEANChecksum=function(o){var l=o.length;if(l===0)return!1;var h=parseInt(o.charAt(l-1),10);return e.getStandardUPCEANChecksum(o.substring(0,l-1))===h},e.getStandardUPCEANChecksum=function(o){for(var l=o.length,h=0,m=l-1;m>=0;m-=2){var b=o.charAt(m).charCodeAt(0)-48;if(b<0||b>9)throw new Ir;h+=b}h*=3;for(var m=l-2;m>=0;m-=2){var b=o.charAt(m).charCodeAt(0)-48;if(b<0||b>9)throw new Ir;h+=b}return(1e3-h)%10},e.decodeEnd=function(o,l){return e.findGuardPattern(o,l,!1,e.START_END_PATTERN,new Int32Array(e.START_END_PATTERN.length).fill(0))},e.findGuardPatternWithoutCounters=function(o,l,h,m){return this.findGuardPattern(o,l,h,m,new Int32Array(m.length))},e.findGuardPattern=function(o,l,h,m,b){var n=o.getSize();l=h?o.getNextUnset(l):o.getNextSet(l);for(var C=0,D=l,L=m.length,U=h,q=l;q<n;q++)if(o.get(q)!==U)b[C]++;else{if(C===L-1){if(Na.patternMatchVariance(b,m,e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return Int32Array.from([D,q]);D+=b[0]+b[1];for(var Z=b.slice(2,b.length),ie=0;ie<C-1;ie++)b[ie]=Z[ie];b[C-1]=0,b[C]=0,C--}else C++;b[C]=1,U=!U}throw new Xt},e.decodeDigit=function(o,l,h,m){this.recordPattern(o,h,l);for(var b=this.MAX_AVG_VARIANCE,n=-1,C=m.length,D=0;D<C;D++){var L=m[D],U=Na.patternMatchVariance(l,L,e.MAX_INDIVIDUAL_VARIANCE);U<b&&(b=U,n=D)}if(n>=0)return n;throw new Xt},e.MAX_AVG_VARIANCE=.48,e.MAX_INDIVIDUAL_VARIANCE=.7,e.START_END_PATTERN=Int32Array.from([1,1,1]),e.MIDDLE_PATTERN=Int32Array.from([1,1,1,1,1]),e.END_PATTERN=Int32Array.from([1,1,1,1,1,1]),e.L_PATTERNS=[Int32Array.from([3,2,1,1]),Int32Array.from([2,2,2,1]),Int32Array.from([2,1,2,2]),Int32Array.from([1,4,1,1]),Int32Array.from([1,1,3,2]),Int32Array.from([1,2,3,1]),Int32Array.from([1,1,1,4]),Int32Array.from([1,3,1,2]),Int32Array.from([1,2,1,3]),Int32Array.from([3,1,1,2])],e})(Na),rN=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},iN=(function(){function r(){this.CHECK_DIGIT_ENCODINGS=[24,20,18,17,12,6,3,10,9,5],this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return r.prototype.decodeRow=function(e,o,l){var h=this.decodeRowStringBuffer,m=this.decodeMiddle(o,l,h),b=h.toString(),n=r.parseExtensionString(b),C=[new ti((l[0]+l[1])/2,e),new ti(m,e)],D=new Hs(b,null,0,C,yi.UPC_EAN_EXTENSION,new Date().getTime());return n!=null&&D.putAllMetadata(n),D},r.prototype.decodeMiddle=function(e,o,l){var h,m,b=this.decodeMiddleCounters;b[0]=0,b[1]=0,b[2]=0,b[3]=0;for(var n=e.getSize(),C=o[1],D=0,L=0;L<5&&C<n;L++){var U=q_.decodeDigit(e,b,C,q_.L_AND_G_PATTERNS);l+=String.fromCharCode(48+U%10);try{for(var q=(h=void 0,rN(b)),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value;C+=ie}}catch(be){h={error:be}}finally{try{Z&&!Z.done&&(m=q.return)&&m.call(q)}finally{if(h)throw h.error}}U>=10&&(D|=1<<4-L),L!==4&&(C=e.getNextSet(C),C=e.getNextUnset(C))}if(l.length!==5)throw new Xt;var ne=this.determineCheckDigit(D);if(r.extensionChecksum(l.toString())!==ne)throw new Xt;return C},r.extensionChecksum=function(e){for(var o=e.length,l=0,h=o-2;h>=0;h-=2)l+=e.charAt(h).charCodeAt(0)-48;l*=3;for(var h=o-1;h>=0;h-=2)l+=e.charAt(h).charCodeAt(0)-48;return l*=3,l%10},r.prototype.determineCheckDigit=function(e){for(var o=0;o<10;o++)if(e===this.CHECK_DIGIT_ENCODINGS[o])return o;throw new Xt},r.parseExtensionString=function(e){if(e.length!==5)return null;var o=r.parseExtension5String(e);return o==null?null:new Map([[gs.SUGGESTED_PRICE,o]])},r.parseExtension5String=function(e){var o;switch(e.charAt(0)){case"0":o="£";break;case"5":o="$";break;case"9":switch(e){case"90000":return null;case"99991":return"0.00";case"99990":return"Used"}o="";break;default:o="";break}var l=parseInt(e.substring(1)),h=(l/100).toString(),m=l%100,b=m<10?"0"+m:m.toString();return o+h+"."+b},r})(),nN=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},oN=(function(){function r(){this.decodeMiddleCounters=Int32Array.from([0,0,0,0]),this.decodeRowStringBuffer=""}return r.prototype.decodeRow=function(e,o,l){var h=this.decodeRowStringBuffer,m=this.decodeMiddle(o,l,h),b=h.toString(),n=r.parseExtensionString(b),C=[new ti((l[0]+l[1])/2,e),new ti(m,e)],D=new Hs(b,null,0,C,yi.UPC_EAN_EXTENSION,new Date().getTime());return n!=null&&D.putAllMetadata(n),D},r.prototype.decodeMiddle=function(e,o,l){var h,m,b=this.decodeMiddleCounters;b[0]=0,b[1]=0,b[2]=0,b[3]=0;for(var n=e.getSize(),C=o[1],D=0,L=0;L<2&&C<n;L++){var U=q_.decodeDigit(e,b,C,q_.L_AND_G_PATTERNS);l+=String.fromCharCode(48+U%10);try{for(var q=(h=void 0,nN(b)),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value;C+=ie}}catch(ne){h={error:ne}}finally{try{Z&&!Z.done&&(m=q.return)&&m.call(q)}finally{if(h)throw h.error}}U>=10&&(D|=1<<1-L),L!==1&&(C=e.getNextSet(C),C=e.getNextUnset(C))}if(l.length!==2)throw new Xt;if(parseInt(l.toString())%4!==D)throw new Xt;return C},r.parseExtensionString=function(e){return e.length!==2?null:new Map([[gs.ISSUE_NUMBER,parseInt(e)]])},r})(),aN=(function(){function r(){}return r.decodeRow=function(e,o,l){var h=q_.findGuardPattern(o,l,!1,this.EXTENSION_START_PATTERN,new Int32Array(this.EXTENSION_START_PATTERN.length).fill(0));try{var m=new iN;return m.decodeRow(e,o,h)}catch{var b=new oN;return b.decodeRow(e,o,h)}},r.EXTENSION_START_PATTERN=Int32Array.from([1,1,2]),r})(),sN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Ba=(function(r){sN(e,r);function e(){var o=r.call(this)||this;o.decodeRowStringBuffer="",e.L_AND_G_PATTERNS=e.L_PATTERNS.map(function(n){return Int32Array.from(n)});for(var l=10;l<20;l++){for(var h=e.L_PATTERNS[l-10],m=new Int32Array(h.length),b=0;b<h.length;b++)m[b]=h[h.length-b-1];e.L_AND_G_PATTERNS[l]=m}return o}return e.prototype.decodeRow=function(o,l,h){var m=e.findStartGuardPattern(l),b=h==null?null:h.get(Io.NEED_RESULT_POINT_CALLBACK);if(b!=null){var n=new ti((m[0]+m[1])/2,o);b.foundPossibleResultPoint(n)}var C=this.decodeMiddle(l,m,this.decodeRowStringBuffer),D=C.rowOffset,L=C.resultString;if(b!=null){var U=new ti(D,o);b.foundPossibleResultPoint(U)}var q=e.decodeEnd(l,D);if(b!=null){var Z=new ti((q[0]+q[1])/2,o);b.foundPossibleResultPoint(Z)}var ie=q[1],ne=ie+(ie-q[0]);if(ne>=l.getSize()||!l.isRange(ie,ne,!1))throw new Xt;var be=L.toString();if(be.length<8)throw new Ir;if(!e.checkChecksum(be))throw new Ka;var ve=(m[1]+m[0])/2,we=(q[1]+q[0])/2,Pe=this.getBarcodeFormat(),Ze=[new ti(ve,o),new ti(we,o)],$e=new Hs(be,null,0,Ze,Pe,new Date().getTime()),xt=0;try{var Ct=aN.decodeRow(o,l,q[1]);$e.putMetadata(gs.UPC_EAN_EXTENSION,Ct.getText()),$e.putAllMetadata(Ct.getResultMetadata()),$e.addResultPoints(Ct.getResultPoints()),xt=Ct.getText().length}catch{}var Ft=h==null?null:h.get(Io.ALLOWED_EAN_EXTENSIONS);if(Ft!=null){var Yt=!1;for(var hr in Ft)if(xt.toString()===hr){Yt=!0;break}if(!Yt)throw new Xt}return Pe===yi.EAN_13||yi.UPC_A,$e},e.checkChecksum=function(o){return e.checkStandardUPCEANChecksum(o)},e.checkStandardUPCEANChecksum=function(o){var l=o.length;if(l===0)return!1;var h=parseInt(o.charAt(l-1),10);return e.getStandardUPCEANChecksum(o.substring(0,l-1))===h},e.getStandardUPCEANChecksum=function(o){for(var l=o.length,h=0,m=l-1;m>=0;m-=2){var b=o.charAt(m).charCodeAt(0)-48;if(b<0||b>9)throw new Ir;h+=b}h*=3;for(var m=l-2;m>=0;m-=2){var b=o.charAt(m).charCodeAt(0)-48;if(b<0||b>9)throw new Ir;h+=b}return(1e3-h)%10},e.decodeEnd=function(o,l){return e.findGuardPattern(o,l,!1,e.START_END_PATTERN,new Int32Array(e.START_END_PATTERN.length).fill(0))},e})(q_),lN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),CC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ew=(function(r){lN(e,r);function e(){var o=r.call(this)||this;return o.decodeMiddleCounters=Int32Array.from([0,0,0,0]),o}return e.prototype.decodeMiddle=function(o,l,h){var m,b,n,C,D=this.decodeMiddleCounters;D[0]=0,D[1]=0,D[2]=0,D[3]=0;for(var L=o.getSize(),U=l[1],q=0,Z=0;Z<6&&U<L;Z++){var ie=Ba.decodeDigit(o,D,U,Ba.L_AND_G_PATTERNS);h+=String.fromCharCode(48+ie%10);try{for(var ne=(m=void 0,CC(D)),be=ne.next();!be.done;be=ne.next()){var ve=be.value;U+=ve}}catch($e){m={error:$e}}finally{try{be&&!be.done&&(b=ne.return)&&b.call(ne)}finally{if(m)throw m.error}}ie>=10&&(q|=1<<5-Z)}h=e.determineFirstDigit(h,q);var we=Ba.findGuardPattern(o,U,!0,Ba.MIDDLE_PATTERN,new Int32Array(Ba.MIDDLE_PATTERN.length).fill(0));U=we[1];for(var Z=0;Z<6&&U<L;Z++){var ie=Ba.decodeDigit(o,D,U,Ba.L_PATTERNS);h+=String.fromCharCode(48+ie);try{for(var Pe=(n=void 0,CC(D)),Ze=Pe.next();!Ze.done;Ze=Pe.next()){var ve=Ze.value;U+=ve}}catch(Ct){n={error:Ct}}finally{try{Ze&&!Ze.done&&(C=Pe.return)&&C.call(Pe)}finally{if(n)throw n.error}}}return{rowOffset:U,resultString:h}},e.prototype.getBarcodeFormat=function(){return yi.EAN_13},e.determineFirstDigit=function(o,l){for(var h=0;h<10;h++)if(l===this.FIRST_DIGIT_ENCODINGS[h])return o=String.fromCharCode(48+h)+o,o;throw new Xt},e.FIRST_DIGIT_ENCODINGS=[0,11,13,14,19,25,28,21,22,26],e})(Ba),cN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),IC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},RC=(function(r){cN(e,r);function e(){var o=r.call(this)||this;return o.decodeMiddleCounters=Int32Array.from([0,0,0,0]),o}return e.prototype.decodeMiddle=function(o,l,h){var m,b,n,C,D=this.decodeMiddleCounters;D[0]=0,D[1]=0,D[2]=0,D[3]=0;for(var L=o.getSize(),U=l[1],q=0;q<4&&U<L;q++){var Z=Ba.decodeDigit(o,D,U,Ba.L_PATTERNS);h+=String.fromCharCode(48+Z);try{for(var ie=(m=void 0,IC(D)),ne=ie.next();!ne.done;ne=ie.next()){var be=ne.value;U+=be}}catch(Ze){m={error:Ze}}finally{try{ne&&!ne.done&&(b=ie.return)&&b.call(ie)}finally{if(m)throw m.error}}}var ve=Ba.findGuardPattern(o,U,!0,Ba.MIDDLE_PATTERN,new Int32Array(Ba.MIDDLE_PATTERN.length).fill(0));U=ve[1];for(var q=0;q<4&&U<L;q++){var Z=Ba.decodeDigit(o,D,U,Ba.L_PATTERNS);h+=String.fromCharCode(48+Z);try{for(var we=(n=void 0,IC(D)),Pe=we.next();!Pe.done;Pe=we.next()){var be=Pe.value;U+=be}}catch(xt){n={error:xt}}finally{try{Pe&&!Pe.done&&(C=we.return)&&C.call(we)}finally{if(n)throw n.error}}}return{rowOffset:U,resultString:h}},e.prototype.getBarcodeFormat=function(){return yi.EAN_8},e})(Ba),uN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),MC=(function(r){uN(e,r);function e(){var o=r!==null&&r.apply(this,arguments)||this;return o.ean13Reader=new Ew,o}return e.prototype.getBarcodeFormat=function(){return yi.UPC_A},e.prototype.decode=function(o,l){return this.maybeReturnResult(this.ean13Reader.decode(o))},e.prototype.decodeRow=function(o,l,h){return this.maybeReturnResult(this.ean13Reader.decodeRow(o,l,h))},e.prototype.decodeMiddle=function(o,l,h){return this.ean13Reader.decodeMiddle(o,l,h)},e.prototype.maybeReturnResult=function(o){var l=o.getText();if(l.charAt(0)==="0"){var h=new Hs(l.substring(1),null,null,o.getResultPoints(),yi.UPC_A);return o.getResultMetadata()!=null&&h.putAllMetadata(o.getResultMetadata()),h}else throw new Xt},e.prototype.reset=function(){this.ean13Reader.reset()},e})(Ba),hN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),fN=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},DC=(function(r){hN(e,r);function e(){var o=r.call(this)||this;return o.decodeMiddleCounters=new Int32Array(4),o}return e.prototype.decodeMiddle=function(o,l,h){var m,b,n=this.decodeMiddleCounters.map(function(be){return be});n[0]=0,n[1]=0,n[2]=0,n[3]=0;for(var C=o.getSize(),D=l[1],L=0,U=0;U<6&&D<C;U++){var q=e.decodeDigit(o,n,D,e.L_AND_G_PATTERNS);h+=String.fromCharCode(48+q%10);try{for(var Z=(m=void 0,fN(n)),ie=Z.next();!ie.done;ie=Z.next()){var ne=ie.value;D+=ne}}catch(be){m={error:be}}finally{try{ie&&!ie.done&&(b=Z.return)&&b.call(Z)}finally{if(m)throw m.error}}q>=10&&(L|=1<<5-U)}return e.determineNumSysAndCheckDigit(new cn(h),L),D},e.prototype.decodeEnd=function(o,l){return e.findGuardPatternWithoutCounters(o,l,!0,e.MIDDLE_END_PATTERN)},e.prototype.checkChecksum=function(o){return Ba.checkChecksum(e.convertUPCEtoUPCA(o))},e.determineNumSysAndCheckDigit=function(o,l){for(var h=0;h<=1;h++)for(var m=0;m<10;m++)if(l===this.NUMSYS_AND_CHECK_DIGIT_PATTERNS[h][m]){o.insert(0,"0"+h),o.append("0"+m);return}throw Xt.getNotFoundInstance()},e.prototype.getBarcodeFormat=function(){return yi.UPC_E},e.convertUPCEtoUPCA=function(o){var l=o.slice(1,7).split("").map(function(b){return b.charCodeAt(0)}),h=new cn;h.append(o.charAt(0));var m=l[5];switch(m){case 0:case 1:case 2:h.appendChars(l,0,2),h.append(m),h.append("0000"),h.appendChars(l,2,3);break;case 3:h.appendChars(l,0,3),h.append("00000"),h.appendChars(l,3,2);break;case 4:h.appendChars(l,0,4),h.append("00000"),h.append(l[4]);break;default:h.appendChars(l,0,5),h.append("0000"),h.append(m);break}return o.length>=8&&h.append(o.charAt(7)),h.toString()},e.MIDDLE_END_PATTERN=Int32Array.from([1,1,1,1,1,1]),e.NUMSYS_AND_CHECK_DIGIT_PATTERNS=[Int32Array.from([56,52,50,49,44,38,35,42,41,37]),Int32Array.from([7,11,13,14,19,25,28,21,22,1])],e})(Ba),dN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),OC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Ob=(function(r){dN(e,r);function e(o){var l=r.call(this)||this,h=o==null?null:o.get(Io.POSSIBLE_FORMATS),m=[];return h!=null&&(h.indexOf(yi.EAN_13)>-1&&m.push(new Ew),h.indexOf(yi.UPC_A)>-1&&m.push(new MC),h.indexOf(yi.EAN_8)>-1&&m.push(new RC),h.indexOf(yi.UPC_E)>-1&&m.push(new DC)),m.length===0&&(m.push(new Ew),m.push(new MC),m.push(new RC),m.push(new DC)),l.readers=m,l}return e.prototype.decodeRow=function(o,l,h){var m,b;try{for(var n=OC(this.readers),C=n.next();!C.done;C=n.next()){var D=C.value;try{var L=D.decodeRow(o,l,h),U=L.getBarcodeFormat()===yi.EAN_13&&L.getText().charAt(0)==="0",q=h==null?null:h.get(Io.POSSIBLE_FORMATS),Z=q==null||q.includes(yi.UPC_A);if(U&&Z){var ie=L.getRawBytes(),ne=new Hs(L.getText().substring(1),ie,ie?ie.length:null,L.getResultPoints(),yi.UPC_A);return ne.putAllMetadata(L.getResultMetadata()),ne}return L}catch{}}}catch(be){m={error:be}}finally{try{C&&!C.done&&(b=n.return)&&b.call(n)}finally{if(m)throw m.error}}throw new Xt},e.prototype.reset=function(){var o,l;try{for(var h=OC(this.readers),m=h.next();!m.done;m=h.next()){var b=m.value;b.reset()}}catch(n){o={error:n}}finally{try{m&&!m.done&&(l=h.return)&&l.call(h)}finally{if(o)throw o.error}}},e})(Na),pN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),mN=(function(r){pN(e,r);function e(){var o=r!==null&&r.apply(this,arguments)||this;return o.CODA_BAR_CHAR_SET={nnnnnww:"0",nnnnwwn:"1",nnnwnnw:"2",wwnnnnn:"3",nnwnnwn:"4",wnnnnwn:"5",nwnnnnw:"6",nwnnwnn:"7",nwwnnnn:"8",wnnwnnn:"9",nnnwwnn:"-",nnwwnnn:"$",wnnnwnw:":",wnwnnnw:"/",wnwnwnn:".",nnwwwww:"+",nnwwnwn:"A",nwnwnnw:"B",nnnwnww:"C",nnnwwwn:"D"},o}return e.prototype.decodeRow=function(o,l,h){var m=this.getValidRowData(l);if(!m)throw new Xt;var b=this.codaBarDecodeRow(m.row);if(!b)throw new Xt;return new Hs(b,null,0,[new ti(m.left,o),new ti(m.right,o)],yi.CODABAR,new Date().getTime())},e.prototype.getValidRowData=function(o){var l=o.toArray(),h=l.indexOf(!0);if(h===-1)return null;var m=l.lastIndexOf(!0);if(m<=h)return null;l=l.slice(h,m+1);for(var b=[],n=l[0],C=1,D=1;D<l.length;D++)l[D]===n?C++:(n=l[D],b.push(C),C=1);return b.push(C),b.length<23&&(b.length+1)%8!==0?null:{row:b,left:h,right:m}},e.prototype.codaBarDecodeRow=function(o){for(var l=[],h=Math.ceil(o.reduce(function(C,D){return(C+D)/2},0));o.length>0;){var m=o.splice(0,8).splice(0,7),b=m.map(function(C){return C<h?"n":"w"}).join("");if(this.CODA_BAR_CHAR_SET[b]===void 0)return null;l.push(this.CODA_BAR_CHAR_SET[b])}var n=l.join("");return this.validCodaBarString(n)?n:null},e.prototype.validCodaBarString=function(o){var l=/^[A-D].{1,}[A-D]$/;return l.test(o)},e})(Na),gN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),_N=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},pg=(function(r){gN(e,r);function e(){var o=r.call(this)||this;return o.decodeFinderCounters=new Int32Array(4),o.dataCharacterCounters=new Int32Array(8),o.oddRoundingErrors=new Array(4),o.evenRoundingErrors=new Array(4),o.oddCounts=new Array(o.dataCharacterCounters.length/2),o.evenCounts=new Array(o.dataCharacterCounters.length/2),o}return e.prototype.getDecodeFinderCounters=function(){return this.decodeFinderCounters},e.prototype.getDataCharacterCounters=function(){return this.dataCharacterCounters},e.prototype.getOddRoundingErrors=function(){return this.oddRoundingErrors},e.prototype.getEvenRoundingErrors=function(){return this.evenRoundingErrors},e.prototype.getOddCounts=function(){return this.oddCounts},e.prototype.getEvenCounts=function(){return this.evenCounts},e.prototype.parseFinderValue=function(o,l){for(var h=0;h<l.length;h++)if(Na.patternMatchVariance(o,l[h],e.MAX_INDIVIDUAL_VARIANCE)<e.MAX_AVG_VARIANCE)return h;throw new Xt},e.count=function(o){return zn.sum(new Int32Array(o))},e.increment=function(o,l){for(var h=0,m=l[0],b=1;b<o.length;b++)l[b]>m&&(m=l[b],h=b);o[h]++},e.decrement=function(o,l){for(var h=0,m=l[0],b=1;b<o.length;b++)l[b]<m&&(m=l[b],h=b);o[h]--},e.isFinderPattern=function(o){var l,h,m=o[0]+o[1],b=m+o[2]+o[3],n=m/b;if(n>=e.MIN_FINDER_PATTERN_RATIO&&n<=e.MAX_FINDER_PATTERN_RATIO){var C=Number.MAX_SAFE_INTEGER,D=Number.MIN_SAFE_INTEGER;try{for(var L=_N(o),U=L.next();!U.done;U=L.next()){var q=U.value;q>D&&(D=q),q<C&&(C=q)}}catch(Z){l={error:Z}}finally{try{U&&!U.done&&(h=L.return)&&h.call(L)}finally{if(l)throw l.error}}return D<10*C}return!1},e.MAX_AVG_VARIANCE=.2,e.MAX_INDIVIDUAL_VARIANCE=.45,e.MIN_FINDER_PATTERN_RATIO=9.5/12,e.MAX_FINDER_PATTERN_RATIO=12.5/14,e})(Na),Bv=(function(){function r(e,o){this.value=e,this.checksumPortion=o}return r.prototype.getValue=function(){return this.value},r.prototype.getChecksumPortion=function(){return this.checksumPortion},r.prototype.toString=function(){return this.value+"("+this.checksumPortion+")"},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.value===o.value&&this.checksumPortion===o.checksumPortion},r.prototype.hashCode=function(){return this.value^this.checksumPortion},r})(),LR=(function(){function r(e,o,l,h,m){this.value=e,this.startEnd=o,this.value=e,this.startEnd=o,this.resultPoints=new Array,this.resultPoints.push(new ti(l,m)),this.resultPoints.push(new ti(h,m))}return r.prototype.getValue=function(){return this.value},r.prototype.getStartEnd=function(){return this.startEnd},r.prototype.getResultPoints=function(){return this.resultPoints},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.value===o.value},r.prototype.hashCode=function(){return this.value},r})(),yN=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},z_=(function(){function r(){}return r.getRSSvalue=function(e,o,l){var h,m,b=0;try{for(var n=yN(e),C=n.next();!C.done;C=n.next()){var D=C.value;b+=D}}catch(we){h={error:we}}finally{try{C&&!C.done&&(m=n.return)&&m.call(n)}finally{if(h)throw h.error}}for(var L=0,U=0,q=e.length,Z=0;Z<q-1;Z++){var ie=void 0;for(ie=1,U|=1<<Z;ie<e[Z];ie++,U&=~(1<<Z)){var ne=r.combins(b-ie-1,q-Z-2);if(l&&U===0&&b-ie-(q-Z-1)>=q-Z-1&&(ne-=r.combins(b-ie-(q-Z),q-Z-2)),q-Z-1>1){for(var be=0,ve=b-ie-(q-Z-2);ve>o;ve--)be+=r.combins(b-ie-ve-1,q-Z-3);ne-=be*(q-1-Z)}else b-ie>o&&ne--;L+=ne}b-=ie}return L},r.combins=function(e,o){var l,h;e-o>o?(h=o,l=e-o):(h=e-o,l=o);for(var m=1,b=1,n=e;n>l;n--)m*=n,b<=h&&(m/=b,b++);for(;b<=h;)m/=b,b++;return m},r})(),vN=(function(){function r(){}return r.buildBitArray=function(e){var o=e.length*2-1;e[e.length-1].getRightChar()==null&&(o-=1);for(var l=12*o,h=new Ja(l),m=0,b=e[0],n=b.getRightChar().getValue(),C=11;C>=0;--C)(n&1<<C)!==0&&h.set(m),m++;for(var C=1;C<e.length;++C){for(var D=e[C],L=D.getLeftChar().getValue(),U=11;U>=0;--U)(L&1<<U)!==0&&h.set(m),m++;if(D.getRightChar()!==null)for(var q=D.getRightChar().getValue(),U=11;U>=0;--U)(q&1<<U)!==0&&h.set(m),m++}return h},r})(),hg=(function(){function r(e,o){o?this.decodedInformation=null:(this.finished=e,this.decodedInformation=o)}return r.prototype.getDecodedInformation=function(){return this.decodedInformation},r.prototype.isFinished=function(){return this.finished},r})(),L2=(function(){function r(e){this.newPosition=e}return r.prototype.getNewPosition=function(){return this.newPosition},r})(),xN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),xh=(function(r){xN(e,r);function e(o,l){var h=r.call(this,o)||this;return h.value=l,h}return e.prototype.getValue=function(){return this.value},e.prototype.isFNC1=function(){return this.value===e.FNC1},e.FNC1="$",e})(L2),bN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),fg=(function(r){bN(e,r);function e(o,l,h){var m=r.call(this,o)||this;return h?(m.remaining=!0,m.remainingValue=m.remainingValue):(m.remaining=!1,m.remainingValue=0),m.newString=l,m}return e.prototype.getNewString=function(){return this.newString},e.prototype.isRemaining=function(){return this.remaining},e.prototype.getRemainingValue=function(){return this.remainingValue},e})(L2),wN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),I_=(function(r){wN(e,r);function e(o,l,h){var m=r.call(this,o)||this;if(l<0||l>10||h<0||h>10)throw new Ir;return m.firstDigit=l,m.secondDigit=h,m}return e.prototype.getFirstDigit=function(){return this.firstDigit},e.prototype.getSecondDigit=function(){return this.secondDigit},e.prototype.getValue=function(){return this.firstDigit*10+this.secondDigit},e.prototype.isFirstDigitFNC1=function(){return this.firstDigit===e.FNC1},e.prototype.isSecondDigitFNC1=function(){return this.secondDigit===e.FNC1},e.prototype.isAnyFNC1=function(){return this.firstDigit===e.FNC1||this.secondDigit===e.FNC1},e.FNC1=10,e})(L2),av=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},SN=(function(){function r(){}return r.parseFieldsInGeneralPurpose=function(e){var o,l,h,m,b,n,C,D;if(!e)return null;if(e.length<2)throw new Xt;var L=e.substring(0,2);try{for(var U=av(r.TWO_DIGIT_DATA_LENGTH),q=U.next();!q.done;q=U.next()){var Z=q.value;if(Z[0]===L)return Z[1]===r.VARIABLE_LENGTH?r.processVariableAI(2,Z[2],e):r.processFixedAI(2,Z[1],e)}}catch(xt){o={error:xt}}finally{try{q&&!q.done&&(l=U.return)&&l.call(U)}finally{if(o)throw o.error}}if(e.length<3)throw new Xt;var ie=e.substring(0,3);try{for(var ne=av(r.THREE_DIGIT_DATA_LENGTH),be=ne.next();!be.done;be=ne.next()){var Z=be.value;if(Z[0]===ie)return Z[1]===r.VARIABLE_LENGTH?r.processVariableAI(3,Z[2],e):r.processFixedAI(3,Z[1],e)}}catch(xt){h={error:xt}}finally{try{be&&!be.done&&(m=ne.return)&&m.call(ne)}finally{if(h)throw h.error}}try{for(var ve=av(r.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH),we=ve.next();!we.done;we=ve.next()){var Z=we.value;if(Z[0]===ie)return Z[1]===r.VARIABLE_LENGTH?r.processVariableAI(4,Z[2],e):r.processFixedAI(4,Z[1],e)}}catch(xt){b={error:xt}}finally{try{we&&!we.done&&(n=ve.return)&&n.call(ve)}finally{if(b)throw b.error}}if(e.length<4)throw new Xt;var Pe=e.substring(0,4);try{for(var Ze=av(r.FOUR_DIGIT_DATA_LENGTH),$e=Ze.next();!$e.done;$e=Ze.next()){var Z=$e.value;if(Z[0]===Pe)return Z[1]===r.VARIABLE_LENGTH?r.processVariableAI(4,Z[2],e):r.processFixedAI(4,Z[1],e)}}catch(xt){C={error:xt}}finally{try{$e&&!$e.done&&(D=Ze.return)&&D.call(Ze)}finally{if(C)throw C.error}}throw new Xt},r.processFixedAI=function(e,o,l){if(l.length<e)throw new Xt;var h=l.substring(0,e);if(l.length<e+o)throw new Xt;var m=l.substring(e,e+o),b=l.substring(e+o),n="("+h+")"+m,C=r.parseFieldsInGeneralPurpose(b);return C==null?n:n+C},r.processVariableAI=function(e,o,l){var h=l.substring(0,e),m;l.length<e+o?m=l.length:m=e+o;var b=l.substring(e,m),n=l.substring(m),C="("+h+")"+b,D=r.parseFieldsInGeneralPurpose(n);return D==null?C:C+D},r.VARIABLE_LENGTH=[],r.TWO_DIGIT_DATA_LENGTH=[["00",18],["01",14],["02",14],["10",r.VARIABLE_LENGTH,20],["11",6],["12",6],["13",6],["15",6],["17",6],["20",2],["21",r.VARIABLE_LENGTH,20],["22",r.VARIABLE_LENGTH,29],["30",r.VARIABLE_LENGTH,8],["37",r.VARIABLE_LENGTH,8],["90",r.VARIABLE_LENGTH,30],["91",r.VARIABLE_LENGTH,30],["92",r.VARIABLE_LENGTH,30],["93",r.VARIABLE_LENGTH,30],["94",r.VARIABLE_LENGTH,30],["95",r.VARIABLE_LENGTH,30],["96",r.VARIABLE_LENGTH,30],["97",r.VARIABLE_LENGTH,3],["98",r.VARIABLE_LENGTH,30],["99",r.VARIABLE_LENGTH,30]],r.THREE_DIGIT_DATA_LENGTH=[["240",r.VARIABLE_LENGTH,30],["241",r.VARIABLE_LENGTH,30],["242",r.VARIABLE_LENGTH,6],["250",r.VARIABLE_LENGTH,30],["251",r.VARIABLE_LENGTH,30],["253",r.VARIABLE_LENGTH,17],["254",r.VARIABLE_LENGTH,20],["400",r.VARIABLE_LENGTH,30],["401",r.VARIABLE_LENGTH,30],["402",17],["403",r.VARIABLE_LENGTH,30],["410",13],["411",13],["412",13],["413",13],["414",13],["420",r.VARIABLE_LENGTH,20],["421",r.VARIABLE_LENGTH,15],["422",3],["423",r.VARIABLE_LENGTH,15],["424",3],["425",3],["426",3]],r.THREE_DIGIT_PLUS_DIGIT_DATA_LENGTH=[["310",6],["311",6],["312",6],["313",6],["314",6],["315",6],["316",6],["320",6],["321",6],["322",6],["323",6],["324",6],["325",6],["326",6],["327",6],["328",6],["329",6],["330",6],["331",6],["332",6],["333",6],["334",6],["335",6],["336",6],["340",6],["341",6],["342",6],["343",6],["344",6],["345",6],["346",6],["347",6],["348",6],["349",6],["350",6],["351",6],["352",6],["353",6],["354",6],["355",6],["356",6],["357",6],["360",6],["361",6],["362",6],["363",6],["364",6],["365",6],["366",6],["367",6],["368",6],["369",6],["390",r.VARIABLE_LENGTH,15],["391",r.VARIABLE_LENGTH,18],["392",r.VARIABLE_LENGTH,15],["393",r.VARIABLE_LENGTH,18],["703",r.VARIABLE_LENGTH,30]],r.FOUR_DIGIT_DATA_LENGTH=[["7001",13],["7002",r.VARIABLE_LENGTH,30],["7003",10],["8001",14],["8002",r.VARIABLE_LENGTH,20],["8003",r.VARIABLE_LENGTH,30],["8004",r.VARIABLE_LENGTH,30],["8005",6],["8006",18],["8007",r.VARIABLE_LENGTH,30],["8008",r.VARIABLE_LENGTH,12],["8018",18],["8020",r.VARIABLE_LENGTH,25],["8100",6],["8101",10],["8102",2],["8110",r.VARIABLE_LENGTH,70],["8200",r.VARIABLE_LENGTH,70]],r})(),xv=(function(){function r(e){this.buffer=new cn,this.information=e}return r.prototype.decodeAllCodes=function(e,o){var l=o,h=null;do{var m=this.decodeGeneralPurposeField(l,h),b=SN.parseFieldsInGeneralPurpose(m.getNewString());if(b!=null&&e.append(b),m.isRemaining()?h=""+m.getRemainingValue():h=null,l===m.getNewPosition())break;l=m.getNewPosition()}while(!0);return e.toString()},r.prototype.isStillNumeric=function(e){if(e+7>this.information.getSize())return e+4<=this.information.getSize();for(var o=e;o<e+3;++o)if(this.information.get(o))return!0;return this.information.get(e+3)},r.prototype.decodeNumeric=function(e){if(e+7>this.information.getSize()){var o=this.extractNumericValueFromBitArray(e,4);return o===0?new I_(this.information.getSize(),I_.FNC1,I_.FNC1):new I_(this.information.getSize(),o-1,I_.FNC1)}var l=this.extractNumericValueFromBitArray(e,7),h=(l-8)/11,m=(l-8)%11;return new I_(e+7,h,m)},r.prototype.extractNumericValueFromBitArray=function(e,o){return r.extractNumericValueFromBitArray(this.information,e,o)},r.extractNumericValueFromBitArray=function(e,o,l){for(var h=0,m=0;m<l;++m)e.get(o+m)&&(h|=1<<l-m-1);return h},r.prototype.decodeGeneralPurposeField=function(e,o){this.buffer.setLengthToZero(),o!=null&&this.buffer.append(o),this.current.setPosition(e);var l=this.parseBlocks();return l!=null&&l.isRemaining()?new fg(this.current.getPosition(),this.buffer.toString(),l.getRemainingValue()):new fg(this.current.getPosition(),this.buffer.toString())},r.prototype.parseBlocks=function(){var e,o;do{var l=this.current.getPosition();this.current.isAlpha()?(o=this.parseAlphaBlock(),e=o.isFinished()):this.current.isIsoIec646()?(o=this.parseIsoIec646Block(),e=o.isFinished()):(o=this.parseNumericBlock(),e=o.isFinished());var h=l!==this.current.getPosition();if(!h&&!e)break}while(!e);return o.getDecodedInformation()},r.prototype.parseNumericBlock=function(){for(;this.isStillNumeric(this.current.getPosition());){var e=this.decodeNumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFirstDigitFNC1()){var o=void 0;return e.isSecondDigitFNC1()?o=new fg(this.current.getPosition(),this.buffer.toString()):o=new fg(this.current.getPosition(),this.buffer.toString(),e.getSecondDigit()),new hg(!0,o)}if(this.buffer.append(e.getFirstDigit()),e.isSecondDigitFNC1()){var o=new fg(this.current.getPosition(),this.buffer.toString());return new hg(!0,o)}this.buffer.append(e.getSecondDigit())}return this.isNumericToAlphaNumericLatch(this.current.getPosition())&&(this.current.setAlpha(),this.current.incrementPosition(4)),new hg(!1)},r.prototype.parseIsoIec646Block=function(){for(;this.isStillIsoIec646(this.current.getPosition());){var e=this.decodeIsoIec646(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var o=new fg(this.current.getPosition(),this.buffer.toString());return new hg(!0,o)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setAlpha()),new hg(!1)},r.prototype.parseAlphaBlock=function(){for(;this.isStillAlpha(this.current.getPosition());){var e=this.decodeAlphanumeric(this.current.getPosition());if(this.current.setPosition(e.getNewPosition()),e.isFNC1()){var o=new fg(this.current.getPosition(),this.buffer.toString());return new hg(!0,o)}this.buffer.append(e.getValue())}return this.isAlphaOr646ToNumericLatch(this.current.getPosition())?(this.current.incrementPosition(3),this.current.setNumeric()):this.isAlphaTo646ToAlphaLatch(this.current.getPosition())&&(this.current.getPosition()+5<this.information.getSize()?this.current.incrementPosition(5):this.current.setPosition(this.information.getSize()),this.current.setIsoIec646()),new hg(!1)},r.prototype.isStillIsoIec646=function(e){if(e+5>this.information.getSize())return!1;var o=this.extractNumericValueFromBitArray(e,5);if(o>=5&&o<16)return!0;if(e+7>this.information.getSize())return!1;var l=this.extractNumericValueFromBitArray(e,7);if(l>=64&&l<116)return!0;if(e+8>this.information.getSize())return!1;var h=this.extractNumericValueFromBitArray(e,8);return h>=232&&h<253},r.prototype.decodeIsoIec646=function(e){var o=this.extractNumericValueFromBitArray(e,5);if(o===15)return new xh(e+5,xh.FNC1);if(o>=5&&o<15)return new xh(e+5,"0"+(o-5));var l=this.extractNumericValueFromBitArray(e,7);if(l>=64&&l<90)return new xh(e+7,""+(l+1));if(l>=90&&l<116)return new xh(e+7,""+(l+7));var h=this.extractNumericValueFromBitArray(e,8),m;switch(h){case 232:m="!";break;case 233:m='"';break;case 234:m="%";break;case 235:m="&";break;case 236:m="'";break;case 237:m="(";break;case 238:m=")";break;case 239:m="*";break;case 240:m="+";break;case 241:m=",";break;case 242:m="-";break;case 243:m=".";break;case 244:m="/";break;case 245:m=":";break;case 246:m=";";break;case 247:m="<";break;case 248:m="=";break;case 249:m=">";break;case 250:m="?";break;case 251:m="_";break;case 252:m=" ";break;default:throw new Ir}return new xh(e+8,m)},r.prototype.isStillAlpha=function(e){if(e+5>this.information.getSize())return!1;var o=this.extractNumericValueFromBitArray(e,5);if(o>=5&&o<16)return!0;if(e+6>this.information.getSize())return!1;var l=this.extractNumericValueFromBitArray(e,6);return l>=16&&l<63},r.prototype.decodeAlphanumeric=function(e){var o=this.extractNumericValueFromBitArray(e,5);if(o===15)return new xh(e+5,xh.FNC1);if(o>=5&&o<15)return new xh(e+5,"0"+(o-5));var l=this.extractNumericValueFromBitArray(e,6);if(l>=32&&l<58)return new xh(e+6,""+(l+33));var h;switch(l){case 58:h="*";break;case 59:h=",";break;case 60:h="-";break;case 61:h=".";break;case 62:h="/";break;default:throw new zy("Decoding invalid alphanumeric value: "+l)}return new xh(e+6,h)},r.prototype.isAlphaTo646ToAlphaLatch=function(e){if(e+1>this.information.getSize())return!1;for(var o=0;o<5&&o+e<this.information.getSize();++o)if(o===2){if(!this.information.get(e+2))return!1}else if(this.information.get(e+o))return!1;return!0},r.prototype.isAlphaOr646ToNumericLatch=function(e){if(e+3>this.information.getSize())return!1;for(var o=e;o<e+3;++o)if(this.information.get(o))return!1;return!0},r.prototype.isNumericToAlphaNumericLatch=function(e){if(e+1>this.information.getSize())return!1;for(var o=0;o<4&&o+e<this.information.getSize();++o)if(this.information.get(e+o))return!1;return!0},r})(),BR=(function(){function r(e){this.information=e,this.generalDecoder=new xv(e)}return r.prototype.getInformation=function(){return this.information},r.prototype.getGeneralDecoder=function(){return this.generalDecoder},r})(),TN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Sh=(function(r){TN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.encodeCompressedGtin=function(o,l){o.append("(01)");var h=o.length();o.append("9"),this.encodeCompressedGtinWithoutAI(o,l,h)},e.prototype.encodeCompressedGtinWithoutAI=function(o,l,h){for(var m=0;m<4;++m){var b=this.getGeneralDecoder().extractNumericValueFromBitArray(l+10*m,10);b/100===0&&o.append("0"),b/10===0&&o.append("0"),o.append(b)}e.appendCheckDigit(o,h)},e.appendCheckDigit=function(o,l){for(var h=0,m=0;m<13;m++){var b=o.charAt(m+l).charCodeAt(0)-48;h+=(m&1)===0?3*b:b}h=10-h%10,h===10&&(h=0),o.append(h)},e.GTIN_SIZE=40,e})(BR),AN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),EN=(function(r){AN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.parseInformation=function(){var o=new cn;o.append("(01)");var l=o.length(),h=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE,4);return o.append(h),this.encodeCompressedGtinWithoutAI(o,e.HEADER_SIZE+4,l),this.getGeneralDecoder().decodeAllCodes(o,e.HEADER_SIZE+44)},e.HEADER_SIZE=4,e})(Sh),CN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),IN=(function(r){CN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.parseInformation=function(){var o=new cn;return this.getGeneralDecoder().decodeAllCodes(o,e.HEADER_SIZE)},e.HEADER_SIZE=5,e})(BR),RN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),bv=(function(r){RN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.encodeCompressedWeight=function(o,l,h){var m=this.getGeneralDecoder().extractNumericValueFromBitArray(l,h);this.addWeightCode(o,m);for(var b=this.checkWeight(m),n=1e5,C=0;C<5;++C)b/n===0&&o.append("0"),n/=10;o.append(b)},e})(Sh),MN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),zR=(function(r){MN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.parseInformation=function(){if(this.getInformation().getSize()!==e.HEADER_SIZE+bv.GTIN_SIZE+e.WEIGHT_SIZE)throw new Xt;var o=new cn;return this.encodeCompressedGtin(o,e.HEADER_SIZE),this.encodeCompressedWeight(o,e.HEADER_SIZE+bv.GTIN_SIZE,e.WEIGHT_SIZE),o.toString()},e.HEADER_SIZE=5,e.WEIGHT_SIZE=15,e})(bv),DN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),ON=(function(r){DN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.addWeightCode=function(o,l){o.append("(3103)")},e.prototype.checkWeight=function(o){return o},e})(zR),PN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),LN=(function(r){PN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.addWeightCode=function(o,l){l<1e4?o.append("(3202)"):o.append("(3203)")},e.prototype.checkWeight=function(o){return o<1e4?o:o-1e4},e})(zR),BN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),zN=(function(r){BN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.parseInformation=function(){if(this.getInformation().getSize()<e.HEADER_SIZE+Sh.GTIN_SIZE)throw new Xt;var o=new cn;this.encodeCompressedGtin(o,e.HEADER_SIZE);var l=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+Sh.GTIN_SIZE,e.LAST_DIGIT_SIZE);o.append("(392"),o.append(l),o.append(")");var h=this.getGeneralDecoder().decodeGeneralPurposeField(e.HEADER_SIZE+Sh.GTIN_SIZE+e.LAST_DIGIT_SIZE,null);return o.append(h.getNewString()),o.toString()},e.HEADER_SIZE=8,e.LAST_DIGIT_SIZE=2,e})(Sh),FN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),kN=(function(r){FN(e,r);function e(o){return r.call(this,o)||this}return e.prototype.parseInformation=function(){if(this.getInformation().getSize()<e.HEADER_SIZE+Sh.GTIN_SIZE)throw new Xt;var o=new cn;this.encodeCompressedGtin(o,e.HEADER_SIZE);var l=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+Sh.GTIN_SIZE,e.LAST_DIGIT_SIZE);o.append("(393"),o.append(l),o.append(")");var h=this.getGeneralDecoder().extractNumericValueFromBitArray(e.HEADER_SIZE+Sh.GTIN_SIZE+e.LAST_DIGIT_SIZE,e.FIRST_THREE_DIGITS_SIZE);h/100===0&&o.append("0"),h/10===0&&o.append("0"),o.append(h);var m=this.getGeneralDecoder().decodeGeneralPurposeField(e.HEADER_SIZE+Sh.GTIN_SIZE+e.LAST_DIGIT_SIZE+e.FIRST_THREE_DIGITS_SIZE,null);return o.append(m.getNewString()),o.toString()},e.HEADER_SIZE=8,e.LAST_DIGIT_SIZE=2,e.FIRST_THREE_DIGITS_SIZE=10,e})(Sh),NN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),rm=(function(r){NN(e,r);function e(o,l,h){var m=r.call(this,o)||this;return m.dateCode=h,m.firstAIdigits=l,m}return e.prototype.parseInformation=function(){if(this.getInformation().getSize()!==e.HEADER_SIZE+e.GTIN_SIZE+e.WEIGHT_SIZE+e.DATE_SIZE)throw new Xt;var o=new cn;return this.encodeCompressedGtin(o,e.HEADER_SIZE),this.encodeCompressedWeight(o,e.HEADER_SIZE+e.GTIN_SIZE,e.WEIGHT_SIZE),this.encodeCompressedDate(o,e.HEADER_SIZE+e.GTIN_SIZE+e.WEIGHT_SIZE),o.toString()},e.prototype.encodeCompressedDate=function(o,l){var h=this.getGeneralDecoder().extractNumericValueFromBitArray(l,e.DATE_SIZE);if(h!==38400){o.append("("),o.append(this.dateCode),o.append(")");var m=h%32;h/=32;var b=h%12+1;h/=12;var n=h;n/10===0&&o.append("0"),o.append(n),b/10===0&&o.append("0"),o.append(b),m/10===0&&o.append("0"),o.append(m)}},e.prototype.addWeightCode=function(o,l){o.append("("),o.append(this.firstAIdigits),o.append(l/1e5),o.append(")")},e.prototype.checkWeight=function(o){return o%1e5},e.HEADER_SIZE=8,e.WEIGHT_SIZE=20,e.DATE_SIZE=16,e})(bv);function VN(r){try{if(r.get(1))return new EN(r);if(!r.get(2))return new IN(r);var e=xv.extractNumericValueFromBitArray(r,1,4);switch(e){case 4:return new ON(r);case 5:return new LN(r)}var o=xv.extractNumericValueFromBitArray(r,1,5);switch(o){case 12:return new zN(r);case 13:return new kN(r)}var l=xv.extractNumericValueFromBitArray(r,1,7);switch(l){case 56:return new rm(r,"310","11");case 57:return new rm(r,"320","11");case 58:return new rm(r,"310","13");case 59:return new rm(r,"320","13");case 60:return new rm(r,"310","15");case 61:return new rm(r,"320","15");case 62:return new rm(r,"310","17");case 63:return new rm(r,"320","17")}}catch(h){throw console.log(h),new zy("unknown decoder: "+r)}}var PC=(function(){function r(e,o,l,h){this.leftchar=e,this.rightchar=o,this.finderpattern=l,this.maybeLast=h}return r.prototype.mayBeLast=function(){return this.maybeLast},r.prototype.getLeftChar=function(){return this.leftchar},r.prototype.getRightChar=function(){return this.rightchar},r.prototype.getFinderPattern=function(){return this.finderpattern},r.prototype.mustBeLast=function(){return this.rightchar==null},r.prototype.toString=function(){return"[ "+this.leftchar+", "+this.rightchar+" : "+(this.finderpattern==null?"null":this.finderpattern.getValue())+" ]"},r.equals=function(e,o){return e instanceof r?r.equalsOrNull(e.leftchar,o.leftchar)&&r.equalsOrNull(e.rightchar,o.rightchar)&&r.equalsOrNull(e.finderpattern,o.finderpattern):!1},r.equalsOrNull=function(e,o){return e===null?o===null:r.equals(e,o)},r.prototype.hashCode=function(){var e=this.leftchar.getValue()^this.rightchar.getValue()^this.finderpattern.getValue();return e},r})(),UN=(function(){function r(e,o,l){this.pairs=e,this.rowNumber=o,this.wasReversed=l}return r.prototype.getPairs=function(){return this.pairs},r.prototype.getRowNumber=function(){return this.rowNumber},r.prototype.isReversed=function(){return this.wasReversed},r.prototype.isEquivalent=function(e){return this.checkEqualitity(this,e)},r.prototype.toString=function(){return"{ "+this.pairs+" }"},r.prototype.equals=function(e,o){return e instanceof r?this.checkEqualitity(e,o)&&e.wasReversed===o.wasReversed:!1},r.prototype.checkEqualitity=function(e,o){if(!(!e||!o)){var l;return e.forEach(function(h,m){o.forEach(function(b){h.getLeftChar().getValue()===b.getLeftChar().getValue()&&h.getRightChar().getValue()===b.getRightChar().getValue()&&h.getFinderPatter().getValue()===b.getFinderPatter().getValue()&&(l=!0)})}),l}},r})(),jN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),im=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},GN=(function(r){jN(e,r);function e(){var o=r!==null&&r.apply(this,arguments)||this;return o.pairs=new Array(e.MAX_PAIRS),o.rows=new Array,o.startEnd=[2],o}return e.prototype.decodeRow=function(o,l,h){this.pairs.length=0,this.startFromEven=!1;try{return e.constructResult(this.decodeRow2pairs(o,l))}catch{}return this.pairs.length=0,this.startFromEven=!0,e.constructResult(this.decodeRow2pairs(o,l))},e.prototype.reset=function(){this.pairs.length=0,this.rows.length=0},e.prototype.decodeRow2pairs=function(o,l){for(var h=!1;!h;)try{this.pairs.push(this.retrieveNextPair(l,this.pairs,o))}catch(n){if(n instanceof Xt){if(!this.pairs.length)throw new Xt;h=!0}}if(this.checkChecksum())return this.pairs;var m;if(this.rows.length?m=!0:m=!1,this.storeRow(o,!1),m){var b=this.checkRowsBoolean(!1);if(b!=null||(b=this.checkRowsBoolean(!0),b!=null))return b}throw new Xt},e.prototype.checkRowsBoolean=function(o){if(this.rows.length>25)return this.rows.length=0,null;this.pairs.length=0,o&&(this.rows=this.rows.reverse());var l=null;try{l=this.checkRows(new Array,0)}catch(h){console.log(h)}return o&&(this.rows=this.rows.reverse()),l},e.prototype.checkRows=function(o,l){for(var h,m,b=l;b<this.rows.length;b++){var n=this.rows[b];this.pairs.length=0;try{for(var C=(h=void 0,im(o)),D=C.next();!D.done;D=C.next()){var L=D.value;this.pairs.push(L.getPairs())}}catch(q){h={error:q}}finally{try{D&&!D.done&&(m=C.return)&&m.call(C)}finally{if(h)throw h.error}}if(this.pairs.push(n.getPairs()),!!e.isValidSequence(this.pairs)){if(this.checkChecksum())return this.pairs;var U=new Array(o);U.push(n);try{return this.checkRows(U,b+1)}catch(q){console.log(q)}}}throw new Xt},e.isValidSequence=function(o){var l,h;try{for(var m=im(e.FINDER_PATTERN_SEQUENCES),b=m.next();!b.done;b=m.next()){var n=b.value;if(!(o.length>n.length)){for(var C=!0,D=0;D<o.length;D++)if(o[D].getFinderPattern().getValue()!==n[D]){C=!1;break}if(C)return!0}}}catch(L){l={error:L}}finally{try{b&&!b.done&&(h=m.return)&&h.call(m)}finally{if(l)throw l.error}}return!1},e.prototype.storeRow=function(o,l){for(var h=0,m=!1,b=!1;h<this.rows.length;){var n=this.rows[h];if(n.getRowNumber()>o){b=n.isEquivalent(this.pairs);break}m=n.isEquivalent(this.pairs),h++}b||m||e.isPartialRow(this.pairs,this.rows)||(this.rows.push(h,new UN(this.pairs,o,l)),this.removePartialRows(this.pairs,this.rows))},e.prototype.removePartialRows=function(o,l){var h,m,b,n,C,D;try{for(var L=im(l),U=L.next();!U.done;U=L.next()){var q=U.value;if(q.getPairs().length!==o.length){var Z=!0;try{for(var ie=(b=void 0,im(q.getPairs())),ne=ie.next();!ne.done;ne=ie.next()){var be=ne.value,ve=!1;try{for(var we=(C=void 0,im(o)),Pe=we.next();!Pe.done;Pe=we.next()){var Ze=Pe.value;if(PC.equals(be,Ze)){ve=!0;break}}}catch($e){C={error:$e}}finally{try{Pe&&!Pe.done&&(D=we.return)&&D.call(we)}finally{if(C)throw C.error}}ve||(Z=!1)}}catch($e){b={error:$e}}finally{try{ne&&!ne.done&&(n=ie.return)&&n.call(ie)}finally{if(b)throw b.error}}}}}catch($e){h={error:$e}}finally{try{U&&!U.done&&(m=L.return)&&m.call(L)}finally{if(h)throw h.error}}},e.isPartialRow=function(o,l){var h,m,b,n,C,D;try{for(var L=im(l),U=L.next();!U.done;U=L.next()){var q=U.value,Z=!0;try{for(var ie=(b=void 0,im(o)),ne=ie.next();!ne.done;ne=ie.next()){var be=ne.value,ve=!1;try{for(var we=(C=void 0,im(q.getPairs())),Pe=we.next();!Pe.done;Pe=we.next()){var Ze=Pe.value;if(be.equals(Ze)){ve=!0;break}}}catch($e){C={error:$e}}finally{try{Pe&&!Pe.done&&(D=we.return)&&D.call(we)}finally{if(C)throw C.error}}if(!ve){Z=!1;break}}}catch($e){b={error:$e}}finally{try{ne&&!ne.done&&(n=ie.return)&&n.call(ie)}finally{if(b)throw b.error}}if(Z)return!0}}catch($e){h={error:$e}}finally{try{U&&!U.done&&(m=L.return)&&m.call(L)}finally{if(h)throw h.error}}return!1},e.prototype.getRows=function(){return this.rows},e.constructResult=function(o){var l=vN.buildBitArray(o),h=VN(l),m=h.parseInformation(),b=o[0].getFinderPattern().getResultPoints(),n=o[o.length-1].getFinderPattern().getResultPoints(),C=[b[0],b[1],n[0],n[1]];return new Hs(m,null,null,C,yi.RSS_EXPANDED,null)},e.prototype.checkChecksum=function(){var o=this.pairs.get(0),l=o.getLeftChar(),h=o.getRightChar();if(h===null)return!1;for(var m=h.getChecksumPortion(),b=2,n=1;n<this.pairs.size();++n){var C=this.pairs.get(n);m+=C.getLeftChar().getChecksumPortion(),b++;var D=C.getRightChar();D!=null&&(m+=D.getChecksumPortion(),b++)}m%=211;var L=211*(b-4)+m;return L===l.getValue()},e.getNextSecondBar=function(o,l){var h;return o.get(l)?(h=o.getNextUnset(l),h=o.getNextSet(h)):(h=o.getNextSet(l),h=o.getNextUnset(h)),h},e.prototype.retrieveNextPair=function(o,l,h){var m=l.length%2===0;this.startFromEven&&(m=!m);var b,n=!0,C=-1;do this.findNextPair(o,l,C),b=this.parseFoundFinderPattern(o,h,m),b===null?C=e.getNextSecondBar(o,this.startEnd[0]):n=!1;while(n);var D=this.decodeDataCharacter(o,b,m,!0);if(!this.isEmptyPair(l)&&l[l.length-1].mustBeLast())throw new Xt;var L;try{L=this.decodeDataCharacter(o,b,m,!1)}catch(U){L=null,console.log(U)}return new PC(D,L,b,!0)},e.prototype.isEmptyPair=function(o){return o.length===0},e.prototype.findNextPair=function(o,l,h){var m=this.getDecodeFinderCounters();m[0]=0,m[1]=0,m[2]=0,m[3]=0;var b=o.getSize(),n;if(h>=0)n=h;else if(this.isEmptyPair(l))n=0;else{var C=l[l.length-1];n=C.getFinderPattern().getStartEnd()[1]}var D=l.length%2!==0;this.startFromEven&&(D=!D);for(var L=!1;n<b&&(L=!o.get(n),!!L);)n++;for(var U=0,q=n,Z=n;Z<b;Z++)if(o.get(Z)!==L)m[U]++;else{if(U===3){if(D&&e.reverseCounters(m),e.isFinderPattern(m)){this.startEnd[0]=q,this.startEnd[1]=Z;return}D&&e.reverseCounters(m),q+=m[0]+m[1],m[0]=m[2],m[1]=m[3],m[2]=0,m[3]=0,U--}else U++;m[U]=1,L=!L}throw new Xt},e.reverseCounters=function(o){for(var l=o.length,h=0;h<l/2;++h){var m=o[h];o[h]=o[l-h-1],o[l-h-1]=m}},e.prototype.parseFoundFinderPattern=function(o,l,h){var m,b,n;if(h){for(var C=this.startEnd[0]-1;C>=0&&!o.get(C);)C--;C++,m=this.startEnd[0]-C,b=C,n=this.startEnd[1]}else b=this.startEnd[0],n=o.getNextUnset(this.startEnd[1]+1),m=n-this.startEnd[1];var D=this.getDecodeFinderCounters();yo.arraycopy(D,0,D,1,D.length-1),D[0]=m;var L;try{L=this.parseFinderValue(D,e.FINDER_PATTERNS)}catch{return null}return new LR(L,[b,n],b,n,l)},e.prototype.decodeDataCharacter=function(o,l,h,m){for(var b=this.getDataCharacterCounters(),n=0;n<b.length;n++)b[n]=0;if(m)e.recordPatternInReverse(o,l.getStartEnd()[0],b);else{e.recordPattern(o,l.getStartEnd()[1],b);for(var C=0,D=b.length-1;C<D;C++,D--){var L=b[C];b[C]=b[D],b[D]=L}}var U=17,q=zn.sum(new Int32Array(b))/U,Z=(l.getStartEnd()[1]-l.getStartEnd()[0])/15;if(Math.abs(q-Z)/Z>.3)throw new Xt;for(var ie=this.getOddCounts(),ne=this.getEvenCounts(),be=this.getOddRoundingErrors(),ve=this.getEvenRoundingErrors(),C=0;C<b.length;C++){var we=1*b[C]/q,Pe=we+.5;if(Pe<1){if(we<.3)throw new Xt;Pe=1}else if(Pe>8){if(we>8.7)throw new Xt;Pe=8}var Ze=C/2;(C&1)===0?(ie[Ze]=Pe,be[Ze]=we-Pe):(ne[Ze]=Pe,ve[Ze]=we-Pe)}this.adjustOddEvenCounts(U);for(var $e=4*l.getValue()+(h?0:2)+(m?0:1)-1,xt=0,Ct=0,C=ie.length-1;C>=0;C--){if(e.isNotA1left(l,h,m)){var Ft=e.WEIGHTS[$e][2*C];Ct+=ie[C]*Ft}xt+=ie[C]}for(var Yt=0,C=ne.length-1;C>=0;C--)if(e.isNotA1left(l,h,m)){var Ft=e.WEIGHTS[$e][2*C+1];Yt+=ne[C]*Ft}var hr=Ct+Yt;if((xt&1)!==0||xt>13||xt<4)throw new Xt;var pr=(13-xt)/2,Kr=e.SYMBOL_WIDEST[pr],ui=9-Kr,zi=z_.getRSSvalue(ie,Kr,!0),Qr=z_.getRSSvalue(ne,ui,!1),Ot=e.EVEN_TOTAL_SUBSET[pr],sr=e.GSUM[pr],Fr=zi*Ot+Qr+sr;return new Bv(Fr,hr)},e.isNotA1left=function(o,l,h){return!(o.getValue()===0&&l&&h)},e.prototype.adjustOddEvenCounts=function(o){var l=zn.sum(new Int32Array(this.getOddCounts())),h=zn.sum(new Int32Array(this.getEvenCounts())),m=!1,b=!1;l>13?b=!0:l<4&&(m=!0);var n=!1,C=!1;h>13?C=!0:h<4&&(n=!0);var D=l+h-o,L=(l&1)===1,U=(h&1)===0;if(D===1)if(L){if(U)throw new Xt;b=!0}else{if(!U)throw new Xt;C=!0}else if(D===-1)if(L){if(U)throw new Xt;m=!0}else{if(!U)throw new Xt;n=!0}else if(D===0){if(L){if(!U)throw new Xt;l<h?(m=!0,C=!0):(b=!0,n=!0)}else if(U)throw new Xt}else throw new Xt;if(m){if(b)throw new Xt;e.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(b&&e.decrement(this.getOddCounts(),this.getOddRoundingErrors()),n){if(C)throw new Xt;e.increment(this.getEvenCounts(),this.getOddRoundingErrors())}C&&e.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.SYMBOL_WIDEST=[7,5,4,3,1],e.EVEN_TOTAL_SUBSET=[4,20,52,104,204],e.GSUM=[0,348,1388,2948,3988],e.FINDER_PATTERNS=[Int32Array.from([1,8,4,1]),Int32Array.from([3,6,4,1]),Int32Array.from([3,4,6,1]),Int32Array.from([3,2,8,1]),Int32Array.from([2,6,5,1]),Int32Array.from([2,2,9,1])],e.WEIGHTS=[[1,3,9,27,81,32,96,77],[20,60,180,118,143,7,21,63],[189,145,13,39,117,140,209,205],[193,157,49,147,19,57,171,91],[62,186,136,197,169,85,44,132],[185,133,188,142,4,12,36,108],[113,128,173,97,80,29,87,50],[150,28,84,41,123,158,52,156],[46,138,203,187,139,206,196,166],[76,17,51,153,37,111,122,155],[43,129,176,106,107,110,119,146],[16,48,144,10,30,90,59,177],[109,116,137,200,178,112,125,164],[70,210,208,202,184,130,179,115],[134,191,151,31,93,68,204,190],[148,22,66,198,172,94,71,2],[6,18,54,162,64,192,154,40],[120,149,25,75,14,42,126,167],[79,26,78,23,69,207,199,175],[103,98,83,38,114,131,182,124],[161,61,183,127,170,88,53,159],[55,165,73,8,24,72,5,15],[45,135,194,160,58,174,100,89]],e.FINDER_PAT_A=0,e.FINDER_PAT_B=1,e.FINDER_PAT_C=2,e.FINDER_PAT_D=3,e.FINDER_PAT_E=4,e.FINDER_PAT_F=5,e.FINDER_PATTERN_SEQUENCES=[[e.FINDER_PAT_A,e.FINDER_PAT_A],[e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B],[e.FINDER_PAT_A,e.FINDER_PAT_C,e.FINDER_PAT_B,e.FINDER_PAT_D],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_C],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_E,e.FINDER_PAT_B,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F],[e.FINDER_PAT_A,e.FINDER_PAT_A,e.FINDER_PAT_B,e.FINDER_PAT_B,e.FINDER_PAT_C,e.FINDER_PAT_D,e.FINDER_PAT_D,e.FINDER_PAT_E,e.FINDER_PAT_E,e.FINDER_PAT_F,e.FINDER_PAT_F]],e.MAX_PAIRS=11,e})(pg),HN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),qN=(function(r){HN(e,r);function e(o,l,h){var m=r.call(this,o,l)||this;return m.count=0,m.finderPattern=h,m}return e.prototype.getFinderPattern=function(){return this.finderPattern},e.prototype.getCount=function(){return this.count},e.prototype.incrementCount=function(){this.count++},e})(Bv),$N=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Pb=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},LC=(function(r){$N(e,r);function e(){var o=r!==null&&r.apply(this,arguments)||this;return o.possibleLeftPairs=[],o.possibleRightPairs=[],o}return e.prototype.decodeRow=function(o,l,h){var m,b,n,C,D=this.decodePair(l,!1,o,h);e.addOrTally(this.possibleLeftPairs,D),l.reverse();var L=this.decodePair(l,!0,o,h);e.addOrTally(this.possibleRightPairs,L),l.reverse();try{for(var U=Pb(this.possibleLeftPairs),q=U.next();!q.done;q=U.next()){var Z=q.value;if(Z.getCount()>1)try{for(var ie=(n=void 0,Pb(this.possibleRightPairs)),ne=ie.next();!ne.done;ne=ie.next()){var be=ne.value;if(be.getCount()>1&&e.checkChecksum(Z,be))return e.constructResult(Z,be)}}catch(ve){n={error:ve}}finally{try{ne&&!ne.done&&(C=ie.return)&&C.call(ie)}finally{if(n)throw n.error}}}}catch(ve){m={error:ve}}finally{try{q&&!q.done&&(b=U.return)&&b.call(U)}finally{if(m)throw m.error}}throw new Xt},e.addOrTally=function(o,l){var h,m;if(l!=null){var b=!1;try{for(var n=Pb(o),C=n.next();!C.done;C=n.next()){var D=C.value;if(D.getValue()===l.getValue()){D.incrementCount(),b=!0;break}}}catch(L){h={error:L}}finally{try{C&&!C.done&&(m=n.return)&&m.call(n)}finally{if(h)throw h.error}}b||o.push(l)}},e.prototype.reset=function(){this.possibleLeftPairs.length=0,this.possibleRightPairs.length=0},e.constructResult=function(o,l){for(var h=4537077*o.getValue()+l.getValue(),m=new String(h).toString(),b=new cn,n=13-m.length;n>0;n--)b.append("0");b.append(m);for(var C=0,n=0;n<13;n++){var D=b.charAt(n).charCodeAt(0)-48;C+=(n&1)===0?3*D:D}C=10-C%10,C===10&&(C=0),b.append(C.toString());var L=o.getFinderPattern().getResultPoints(),U=l.getFinderPattern().getResultPoints();return new Hs(b.toString(),null,0,[L[0],L[1],U[0],U[1]],yi.RSS_14,new Date().getTime())},e.checkChecksum=function(o,l){var h=(o.getChecksumPortion()+16*l.getChecksumPortion())%79,m=9*o.getFinderPattern().getValue()+l.getFinderPattern().getValue();return m>72&&m--,m>8&&m--,h===m},e.prototype.decodePair=function(o,l,h,m){try{var b=this.findFinderPattern(o,l),n=this.parseFoundFinderPattern(o,h,l,b),C=m==null?null:m.get(Io.NEED_RESULT_POINT_CALLBACK);if(C!=null){var D=(b[0]+b[1])/2;l&&(D=o.getSize()-1-D),C.foundPossibleResultPoint(new ti(D,h))}var L=this.decodeDataCharacter(o,n,!0),U=this.decodeDataCharacter(o,n,!1);return new qN(1597*L.getValue()+U.getValue(),L.getChecksumPortion()+4*U.getChecksumPortion(),n)}catch{return null}},e.prototype.decodeDataCharacter=function(o,l,h){for(var m=this.getDataCharacterCounters(),b=0;b<m.length;b++)m[b]=0;if(h)Na.recordPatternInReverse(o,l.getStartEnd()[0],m);else{Na.recordPattern(o,l.getStartEnd()[1]+1,m);for(var n=0,C=m.length-1;n<C;n++,C--){var D=m[n];m[n]=m[C],m[C]=D}}for(var L=h?16:15,U=zn.sum(new Int32Array(m))/L,q=this.getOddCounts(),Z=this.getEvenCounts(),ie=this.getOddRoundingErrors(),ne=this.getEvenRoundingErrors(),n=0;n<m.length;n++){var be=m[n]/U,ve=Math.floor(be+.5);ve<1?ve=1:ve>8&&(ve=8);var we=Math.floor(n/2);(n&1)===0?(q[we]=ve,ie[we]=be-ve):(Z[we]=ve,ne[we]=be-ve)}this.adjustOddEvenCounts(h,L);for(var Pe=0,Ze=0,n=q.length-1;n>=0;n--)Ze*=9,Ze+=q[n],Pe+=q[n];for(var $e=0,xt=0,n=Z.length-1;n>=0;n--)$e*=9,$e+=Z[n],xt+=Z[n];var Ct=Ze+3*$e;if(h){if((Pe&1)!==0||Pe>12||Pe<4)throw new Xt;var Ft=(12-Pe)/2,Yt=e.OUTSIDE_ODD_WIDEST[Ft],hr=9-Yt,pr=z_.getRSSvalue(q,Yt,!1),Kr=z_.getRSSvalue(Z,hr,!0),ui=e.OUTSIDE_EVEN_TOTAL_SUBSET[Ft],zi=e.OUTSIDE_GSUM[Ft];return new Bv(pr*ui+Kr+zi,Ct)}else{if((xt&1)!==0||xt>10||xt<4)throw new Xt;var Ft=(10-xt)/2,Yt=e.INSIDE_ODD_WIDEST[Ft],hr=9-Yt,pr=z_.getRSSvalue(q,Yt,!0),Kr=z_.getRSSvalue(Z,hr,!1),Qr=e.INSIDE_ODD_TOTAL_SUBSET[Ft],zi=e.INSIDE_GSUM[Ft];return new Bv(Kr*Qr+pr+zi,Ct)}},e.prototype.findFinderPattern=function(o,l){var h=this.getDecodeFinderCounters();h[0]=0,h[1]=0,h[2]=0,h[3]=0;for(var m=o.getSize(),b=!1,n=0;n<m&&(b=!o.get(n),l!==b);)n++;for(var C=0,D=n,L=n;L<m;L++)if(o.get(L)!==b)h[C]++;else{if(C===3){if(pg.isFinderPattern(h))return[D,L];D+=h[0]+h[1],h[0]=h[2],h[1]=h[3],h[2]=0,h[3]=0,C--}else C++;h[C]=1,b=!b}throw new Xt},e.prototype.parseFoundFinderPattern=function(o,l,h,m){for(var b=o.get(m[0]),n=m[0]-1;n>=0&&b!==o.get(n);)n--;n++;var C=m[0]-n,D=this.getDecodeFinderCounters(),L=new Int32Array(D.length);yo.arraycopy(D,0,L,1,D.length-1),L[0]=C;var U=this.parseFinderValue(L,e.FINDER_PATTERNS),q=n,Z=m[1];return h&&(q=o.getSize()-1-q,Z=o.getSize()-1-Z),new LR(U,[n,m[1]],q,Z,l)},e.prototype.adjustOddEvenCounts=function(o,l){var h=zn.sum(new Int32Array(this.getOddCounts())),m=zn.sum(new Int32Array(this.getEvenCounts())),b=!1,n=!1,C=!1,D=!1;o?(h>12?n=!0:h<4&&(b=!0),m>12?D=!0:m<4&&(C=!0)):(h>11?n=!0:h<5&&(b=!0),m>10?D=!0:m<4&&(C=!0));var L=h+m-l,U=(h&1)===(o?1:0),q=(m&1)===1;if(L===1)if(U){if(q)throw new Xt;n=!0}else{if(!q)throw new Xt;D=!0}else if(L===-1)if(U){if(q)throw new Xt;b=!0}else{if(!q)throw new Xt;C=!0}else if(L===0){if(U){if(!q)throw new Xt;h<m?(b=!0,D=!0):(n=!0,C=!0)}else if(q)throw new Xt}else throw new Xt;if(b){if(n)throw new Xt;pg.increment(this.getOddCounts(),this.getOddRoundingErrors())}if(n&&pg.decrement(this.getOddCounts(),this.getOddRoundingErrors()),C){if(D)throw new Xt;pg.increment(this.getEvenCounts(),this.getOddRoundingErrors())}D&&pg.decrement(this.getEvenCounts(),this.getEvenRoundingErrors())},e.OUTSIDE_EVEN_TOTAL_SUBSET=[1,10,34,70,126],e.INSIDE_ODD_TOTAL_SUBSET=[4,20,48,81],e.OUTSIDE_GSUM=[0,161,961,2015,2715],e.INSIDE_GSUM=[0,336,1036,1516],e.OUTSIDE_ODD_WIDEST=[8,6,4,3,1],e.INSIDE_ODD_WIDEST=[2,4,6,8],e.FINDER_PATTERNS=[Int32Array.from([3,8,2,1]),Int32Array.from([3,5,5,1]),Int32Array.from([3,3,7,1]),Int32Array.from([3,1,9,1]),Int32Array.from([2,7,4,1]),Int32Array.from([2,5,6,1]),Int32Array.from([2,3,8,1]),Int32Array.from([1,5,7,1]),Int32Array.from([1,3,9,1])],e})(pg),XN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),ny=(function(r){XN(e,r);function e(o){var l=r.call(this)||this;l.readers=[];var h=o?o.get(Io.POSSIBLE_FORMATS):null,m=o&&o.get(Io.ASSUME_CODE_39_CHECK_DIGIT)!==void 0,b=o&&o.get(Io.ENABLE_CODE_39_EXTENDED_MODE)!==void 0;return h&&((h.includes(yi.EAN_13)||h.includes(yi.UPC_A)||h.includes(yi.EAN_8)||h.includes(yi.UPC_E))&&l.readers.push(new Ob(o)),h.includes(yi.CODE_39)&&l.readers.push(new TC(m,b)),h.includes(yi.CODE_93)&&l.readers.push(new AC),h.includes(yi.CODE_128)&&l.readers.push(new SC),h.includes(yi.ITF)&&l.readers.push(new EC),h.includes(yi.CODABAR)&&l.readers.push(new mN),h.includes(yi.RSS_14)&&l.readers.push(new LC),h.includes(yi.RSS_EXPANDED)&&(console.warn("RSS Expanded reader IS NOT ready for production yet! use at your own risk."),l.readers.push(new GN))),l.readers.length===0&&(l.readers.push(new Ob(o)),l.readers.push(new TC),l.readers.push(new AC),l.readers.push(new Ob(o)),l.readers.push(new SC),l.readers.push(new EC),l.readers.push(new LC)),l}return e.prototype.decodeRow=function(o,l,h){for(var m=0;m<this.readers.length;m++)try{return this.readers[m].decodeRow(o,l,h)}catch{}throw new Xt},e.prototype.reset=function(){this.readers.forEach(function(o){return o.reset()})},e})(Na),ZN=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){ZN(e,r);function e(o,l){return o===void 0&&(o=500),r.call(this,new ny(l),o,l)||this}return e})(J_);var BC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},qn=(function(){function r(e,o,l){this.ecCodewords=e,this.ecBlocks=[o],l&&this.ecBlocks.push(l)}return r.prototype.getECCodewords=function(){return this.ecCodewords},r.prototype.getECBlocks=function(){return this.ecBlocks},r})(),jn=(function(){function r(e,o){this.count=e,this.dataCodewords=o}return r.prototype.getCount=function(){return this.count},r.prototype.getDataCodewords=function(){return this.dataCodewords},r})(),WN=(function(){function r(e,o,l,h,m,b){var n,C;this.versionNumber=e,this.symbolSizeRows=o,this.symbolSizeColumns=l,this.dataRegionSizeRows=h,this.dataRegionSizeColumns=m,this.ecBlocks=b;var D=0,L=b.getECCodewords(),U=b.getECBlocks();try{for(var q=BC(U),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value;D+=ie.getCount()*(ie.getDataCodewords()+L)}}catch(ne){n={error:ne}}finally{try{Z&&!Z.done&&(C=q.return)&&C.call(q)}finally{if(n)throw n.error}}this.totalCodewords=D}return r.prototype.getVersionNumber=function(){return this.versionNumber},r.prototype.getSymbolSizeRows=function(){return this.symbolSizeRows},r.prototype.getSymbolSizeColumns=function(){return this.symbolSizeColumns},r.prototype.getDataRegionSizeRows=function(){return this.dataRegionSizeRows},r.prototype.getDataRegionSizeColumns=function(){return this.dataRegionSizeColumns},r.prototype.getTotalCodewords=function(){return this.totalCodewords},r.prototype.getECBlocks=function(){return this.ecBlocks},r.getVersionForDimensions=function(e,o){var l,h;if((e&1)!==0||(o&1)!==0)throw new Ir;try{for(var m=BC(r.VERSIONS),b=m.next();!b.done;b=m.next()){var n=b.value;if(n.symbolSizeRows===e&&n.symbolSizeColumns===o)return n}}catch(C){l={error:C}}finally{try{b&&!b.done&&(h=m.return)&&h.call(m)}finally{if(l)throw l.error}}throw new Ir},r.prototype.toString=function(){return""+this.versionNumber},r.buildVersions=function(){return[new r(1,10,10,8,8,new qn(5,new jn(1,3))),new r(2,12,12,10,10,new qn(7,new jn(1,5))),new r(3,14,14,12,12,new qn(10,new jn(1,8))),new r(4,16,16,14,14,new qn(12,new jn(1,12))),new r(5,18,18,16,16,new qn(14,new jn(1,18))),new r(6,20,20,18,18,new qn(18,new jn(1,22))),new r(7,22,22,20,20,new qn(20,new jn(1,30))),new r(8,24,24,22,22,new qn(24,new jn(1,36))),new r(9,26,26,24,24,new qn(28,new jn(1,44))),new r(10,32,32,14,14,new qn(36,new jn(1,62))),new r(11,36,36,16,16,new qn(42,new jn(1,86))),new r(12,40,40,18,18,new qn(48,new jn(1,114))),new r(13,44,44,20,20,new qn(56,new jn(1,144))),new r(14,48,48,22,22,new qn(68,new jn(1,174))),new r(15,52,52,24,24,new qn(42,new jn(2,102))),new r(16,64,64,14,14,new qn(56,new jn(2,140))),new r(17,72,72,16,16,new qn(36,new jn(4,92))),new r(18,80,80,18,18,new qn(48,new jn(4,114))),new r(19,88,88,20,20,new qn(56,new jn(4,144))),new r(20,96,96,22,22,new qn(68,new jn(4,174))),new r(21,104,104,24,24,new qn(56,new jn(6,136))),new r(22,120,120,18,18,new qn(68,new jn(6,175))),new r(23,132,132,20,20,new qn(62,new jn(8,163))),new r(24,144,144,22,22,new qn(62,new jn(8,156),new jn(2,155))),new r(25,8,18,6,16,new qn(7,new jn(1,5))),new r(26,8,32,6,14,new qn(11,new jn(1,10))),new r(27,12,26,10,24,new qn(14,new jn(1,16))),new r(28,12,36,10,16,new qn(18,new jn(1,22))),new r(29,16,36,14,16,new qn(24,new jn(1,32))),new r(30,16,48,14,22,new qn(28,new jn(1,49)))]},r.VERSIONS=r.buildVersions(),r})(),YN=(function(){function r(e){var o=e.getHeight();if(o<8||o>144||(o&1)!==0)throw new Ir;this.version=r.readVersion(e),this.mappingBitMatrix=this.extractDataRegion(e),this.readMappingMatrix=new If(this.mappingBitMatrix.getWidth(),this.mappingBitMatrix.getHeight())}return r.prototype.getVersion=function(){return this.version},r.readVersion=function(e){var o=e.getHeight(),l=e.getWidth();return WN.getVersionForDimensions(o,l)},r.prototype.readCodewords=function(){var e=new Int8Array(this.version.getTotalCodewords()),o=0,l=4,h=0,m=this.mappingBitMatrix.getHeight(),b=this.mappingBitMatrix.getWidth(),n=!1,C=!1,D=!1,L=!1;do if(l===m&&h===0&&!n)e[o++]=this.readCorner1(m,b)&255,l-=2,h+=2,n=!0;else if(l===m-2&&h===0&&(b&3)!==0&&!C)e[o++]=this.readCorner2(m,b)&255,l-=2,h+=2,C=!0;else if(l===m+4&&h===2&&(b&7)===0&&!D)e[o++]=this.readCorner3(m,b)&255,l-=2,h+=2,D=!0;else if(l===m-2&&h===0&&(b&7)===4&&!L)e[o++]=this.readCorner4(m,b)&255,l-=2,h+=2,L=!0;else{do l<m&&h>=0&&!this.readMappingMatrix.get(h,l)&&(e[o++]=this.readUtah(l,h,m,b)&255),l-=2,h+=2;while(l>=0&&h<b);l+=1,h+=3;do l>=0&&h<b&&!this.readMappingMatrix.get(h,l)&&(e[o++]=this.readUtah(l,h,m,b)&255),l+=2,h-=2;while(l<m&&h>=0);l+=3,h+=1}while(l<m||h<b);if(o!==this.version.getTotalCodewords())throw new Ir;return e},r.prototype.readModule=function(e,o,l,h){return e<0&&(e+=l,o+=4-(l+4&7)),o<0&&(o+=h,e+=4-(h+4&7)),this.readMappingMatrix.set(o,e),this.mappingBitMatrix.get(o,e)},r.prototype.readUtah=function(e,o,l,h){var m=0;return this.readModule(e-2,o-2,l,h)&&(m|=1),m<<=1,this.readModule(e-2,o-1,l,h)&&(m|=1),m<<=1,this.readModule(e-1,o-2,l,h)&&(m|=1),m<<=1,this.readModule(e-1,o-1,l,h)&&(m|=1),m<<=1,this.readModule(e-1,o,l,h)&&(m|=1),m<<=1,this.readModule(e,o-2,l,h)&&(m|=1),m<<=1,this.readModule(e,o-1,l,h)&&(m|=1),m<<=1,this.readModule(e,o,l,h)&&(m|=1),m},r.prototype.readCorner1=function(e,o){var l=0;return this.readModule(e-1,0,e,o)&&(l|=1),l<<=1,this.readModule(e-1,1,e,o)&&(l|=1),l<<=1,this.readModule(e-1,2,e,o)&&(l|=1),l<<=1,this.readModule(0,o-2,e,o)&&(l|=1),l<<=1,this.readModule(0,o-1,e,o)&&(l|=1),l<<=1,this.readModule(1,o-1,e,o)&&(l|=1),l<<=1,this.readModule(2,o-1,e,o)&&(l|=1),l<<=1,this.readModule(3,o-1,e,o)&&(l|=1),l},r.prototype.readCorner2=function(e,o){var l=0;return this.readModule(e-3,0,e,o)&&(l|=1),l<<=1,this.readModule(e-2,0,e,o)&&(l|=1),l<<=1,this.readModule(e-1,0,e,o)&&(l|=1),l<<=1,this.readModule(0,o-4,e,o)&&(l|=1),l<<=1,this.readModule(0,o-3,e,o)&&(l|=1),l<<=1,this.readModule(0,o-2,e,o)&&(l|=1),l<<=1,this.readModule(0,o-1,e,o)&&(l|=1),l<<=1,this.readModule(1,o-1,e,o)&&(l|=1),l},r.prototype.readCorner3=function(e,o){var l=0;return this.readModule(e-1,0,e,o)&&(l|=1),l<<=1,this.readModule(e-1,o-1,e,o)&&(l|=1),l<<=1,this.readModule(0,o-3,e,o)&&(l|=1),l<<=1,this.readModule(0,o-2,e,o)&&(l|=1),l<<=1,this.readModule(0,o-1,e,o)&&(l|=1),l<<=1,this.readModule(1,o-3,e,o)&&(l|=1),l<<=1,this.readModule(1,o-2,e,o)&&(l|=1),l<<=1,this.readModule(1,o-1,e,o)&&(l|=1),l},r.prototype.readCorner4=function(e,o){var l=0;return this.readModule(e-3,0,e,o)&&(l|=1),l<<=1,this.readModule(e-2,0,e,o)&&(l|=1),l<<=1,this.readModule(e-1,0,e,o)&&(l|=1),l<<=1,this.readModule(0,o-2,e,o)&&(l|=1),l<<=1,this.readModule(0,o-1,e,o)&&(l|=1),l<<=1,this.readModule(1,o-1,e,o)&&(l|=1),l<<=1,this.readModule(2,o-1,e,o)&&(l|=1),l<<=1,this.readModule(3,o-1,e,o)&&(l|=1),l},r.prototype.extractDataRegion=function(e){var o=this.version.getSymbolSizeRows(),l=this.version.getSymbolSizeColumns();if(e.getHeight()!==o)throw new bi("Dimension of bitMatrix must match the version size");for(var h=this.version.getDataRegionSizeRows(),m=this.version.getDataRegionSizeColumns(),b=o/h|0,n=l/m|0,C=b*h,D=n*m,L=new If(D,C),U=0;U<b;++U)for(var q=U*h,Z=0;Z<n;++Z)for(var ie=Z*m,ne=0;ne<h;++ne)for(var be=U*(h+2)+1+ne,ve=q+ne,we=0;we<m;++we){var Pe=Z*(m+2)+1+we;if(e.get(Pe,be)){var Ze=ie+we;L.set(Ze,ve)}}return L},r})(),zC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},QN=(function(){function r(e,o){this.numDataCodewords=e,this.codewords=o}return r.getDataBlocks=function(e,o){var l,h,m,b,n=o.getECBlocks(),C=0,D=n.getECBlocks();try{for(var L=zC(D),U=L.next();!U.done;U=L.next()){var q=U.value;C+=q.getCount()}}catch(zi){l={error:zi}}finally{try{U&&!U.done&&(h=L.return)&&h.call(L)}finally{if(l)throw l.error}}var Z=new Array(C),ie=0;try{for(var ne=zC(D),be=ne.next();!be.done;be=ne.next())for(var q=be.value,ve=0;ve<q.getCount();ve++){var we=q.getDataCodewords(),Pe=n.getECCodewords()+we;Z[ie++]=new r(we,new Uint8Array(Pe))}}catch(zi){m={error:zi}}finally{try{be&&!be.done&&(b=ne.return)&&b.call(ne)}finally{if(m)throw m.error}}for(var Ze=Z[0].codewords.length,$e=Ze-n.getECCodewords(),xt=$e-1,Ct=0,ve=0;ve<xt;ve++)for(var Ft=0;Ft<ie;Ft++)Z[Ft].codewords[ve]=e[Ct++];for(var Yt=o.getVersionNumber()===24,hr=Yt?8:ie,Ft=0;Ft<hr;Ft++)Z[Ft].codewords[$e-1]=e[Ct++];for(var pr=Z[0].codewords.length,ve=$e;ve<pr;ve++)for(var Ft=0;Ft<ie;Ft++){var Kr=Yt?(Ft+8)%ie:Ft,ui=Yt&&Kr>7?ve-1:ve;Z[Kr].codewords[ui]=e[Ct++]}if(Ct!==e.length)throw new bi;return Z},r.prototype.getNumDataCodewords=function(){return this.numDataCodewords},r.prototype.getCodewords=function(){return this.codewords},r})(),FR=(function(){function r(e){this.bytes=e,this.byteOffset=0,this.bitOffset=0}return r.prototype.getBitOffset=function(){return this.bitOffset},r.prototype.getByteOffset=function(){return this.byteOffset},r.prototype.readBits=function(e){if(e<1||e>32||e>this.available())throw new bi(""+e);var o=0,l=this.bitOffset,h=this.byteOffset,m=this.bytes;if(l>0){var b=8-l,n=e<b?e:b,C=b-n,D=255>>8-n<<C;o=(m[h]&D)>>C,e-=n,l+=n,l===8&&(l=0,h++)}if(e>0){for(;e>=8;)o=o<<8|m[h]&255,h++,e-=8;if(e>0){var C=8-e,D=255>>C<<C;o=o<<e|(m[h]&D)>>C,l+=e}}return this.bitOffset=l,this.byteOffset=h,o},r.prototype.available=function(){return 8*(this.bytes.length-this.byteOffset)-this.bitOffset},r})(),Pa;(function(r){r[r.PAD_ENCODE=0]="PAD_ENCODE",r[r.ASCII_ENCODE=1]="ASCII_ENCODE",r[r.C40_ENCODE=2]="C40_ENCODE",r[r.TEXT_ENCODE=3]="TEXT_ENCODE",r[r.ANSIX12_ENCODE=4]="ANSIX12_ENCODE",r[r.EDIFACT_ENCODE=5]="EDIFACT_ENCODE",r[r.BASE256_ENCODE=6]="BASE256_ENCODE"})(Pa||(Pa={}));var KN=(function(){function r(){}return r.decode=function(e){var o=new FR(e),l=new cn,h=new cn,m=new Array,b=Pa.ASCII_ENCODE;do if(b===Pa.ASCII_ENCODE)b=this.decodeAsciiSegment(o,l,h);else{switch(b){case Pa.C40_ENCODE:this.decodeC40Segment(o,l);break;case Pa.TEXT_ENCODE:this.decodeTextSegment(o,l);break;case Pa.ANSIX12_ENCODE:this.decodeAnsiX12Segment(o,l);break;case Pa.EDIFACT_ENCODE:this.decodeEdifactSegment(o,l);break;case Pa.BASE256_ENCODE:this.decodeBase256Segment(o,l,m);break;default:throw new Ir}b=Pa.ASCII_ENCODE}while(b!==Pa.PAD_ENCODE&&o.available()>0);return h.length()>0&&l.append(h.toString()),new Zv(e,l.toString(),m.length===0?null:m,null)},r.decodeAsciiSegment=function(e,o,l){var h=!1;do{var m=e.readBits(8);if(m===0)throw new Ir;if(m<=128)return h&&(m+=128),o.append(String.fromCharCode(m-1)),Pa.ASCII_ENCODE;if(m===129)return Pa.PAD_ENCODE;if(m<=229){var b=m-130;b<10&&o.append("0"),o.append(""+b)}else switch(m){case 230:return Pa.C40_ENCODE;case 231:return Pa.BASE256_ENCODE;case 232:o.append("");break;case 233:case 234:break;case 235:h=!0;break;case 236:o.append("[)>05"),l.insert(0,"");break;case 237:o.append("[)>06"),l.insert(0,"");break;case 238:return Pa.ANSIX12_ENCODE;case 239:return Pa.TEXT_ENCODE;case 240:return Pa.EDIFACT_ENCODE;case 241:break;default:if(m!==254||e.available()!==0)throw new Ir;break}}while(e.available()>0);return Pa.ASCII_ENCODE},r.decodeC40Segment=function(e,o){var l=!1,h=[],m=0;do{if(e.available()===8)return;var b=e.readBits(8);if(b===254)return;this.parseTwoBytes(b,e.readBits(8),h);for(var n=0;n<3;n++){var C=h[n];switch(m){case 0:if(C<3)m=C+1;else if(C<this.C40_BASIC_SET_CHARS.length){var D=this.C40_BASIC_SET_CHARS[C];l?(o.append(String.fromCharCode(D.charCodeAt(0)+128)),l=!1):o.append(D)}else throw new Ir;break;case 1:l?(o.append(String.fromCharCode(C+128)),l=!1):o.append(String.fromCharCode(C)),m=0;break;case 2:if(C<this.C40_SHIFT2_SET_CHARS.length){var D=this.C40_SHIFT2_SET_CHARS[C];l?(o.append(String.fromCharCode(D.charCodeAt(0)+128)),l=!1):o.append(D)}else switch(C){case 27:o.append("");break;case 30:l=!0;break;default:throw new Ir}m=0;break;case 3:l?(o.append(String.fromCharCode(C+224)),l=!1):o.append(String.fromCharCode(C+96)),m=0;break;default:throw new Ir}}}while(e.available()>0)},r.decodeTextSegment=function(e,o){var l=!1,h=[],m=0;do{if(e.available()===8)return;var b=e.readBits(8);if(b===254)return;this.parseTwoBytes(b,e.readBits(8),h);for(var n=0;n<3;n++){var C=h[n];switch(m){case 0:if(C<3)m=C+1;else if(C<this.TEXT_BASIC_SET_CHARS.length){var D=this.TEXT_BASIC_SET_CHARS[C];l?(o.append(String.fromCharCode(D.charCodeAt(0)+128)),l=!1):o.append(D)}else throw new Ir;break;case 1:l?(o.append(String.fromCharCode(C+128)),l=!1):o.append(String.fromCharCode(C)),m=0;break;case 2:if(C<this.TEXT_SHIFT2_SET_CHARS.length){var D=this.TEXT_SHIFT2_SET_CHARS[C];l?(o.append(String.fromCharCode(D.charCodeAt(0)+128)),l=!1):o.append(D)}else switch(C){case 27:o.append("");break;case 30:l=!0;break;default:throw new Ir}m=0;break;case 3:if(C<this.TEXT_SHIFT3_SET_CHARS.length){var D=this.TEXT_SHIFT3_SET_CHARS[C];l?(o.append(String.fromCharCode(D.charCodeAt(0)+128)),l=!1):o.append(D),m=0}else throw new Ir;break;default:throw new Ir}}}while(e.available()>0)},r.decodeAnsiX12Segment=function(e,o){var l=[];do{if(e.available()===8)return;var h=e.readBits(8);if(h===254)return;this.parseTwoBytes(h,e.readBits(8),l);for(var m=0;m<3;m++){var b=l[m];switch(b){case 0:o.append("\r");break;case 1:o.append("*");break;case 2:o.append(">");break;case 3:o.append(" ");break;default:if(b<14)o.append(String.fromCharCode(b+44));else if(b<40)o.append(String.fromCharCode(b+51));else throw new Ir;break}}}while(e.available()>0)},r.parseTwoBytes=function(e,o,l){var h=(e<<8)+o-1,m=Math.floor(h/1600);l[0]=m,h-=m*1600,m=Math.floor(h/40),l[1]=m,l[2]=h-m*40},r.decodeEdifactSegment=function(e,o){do{if(e.available()<=16)return;for(var l=0;l<4;l++){var h=e.readBits(6);if(h===31){var m=8-e.getBitOffset();m!==8&&e.readBits(m);return}(h&32)===0&&(h|=64),o.append(String.fromCharCode(h))}}while(e.available()>0)},r.decodeBase256Segment=function(e,o,l){var h=1+e.getByteOffset(),m=this.unrandomize255State(e.readBits(8),h++),b;if(m===0?b=e.available()/8|0:m<250?b=m:b=250*(m-249)+this.unrandomize255State(e.readBits(8),h++),b<0)throw new Ir;for(var n=new Uint8Array(b),C=0;C<b;C++){if(e.available()<8)throw new Ir;n[C]=this.unrandomize255State(e.readBits(8),h++)}l.push(n);try{o.append(Bu.decode(n,En.ISO88591))}catch(D){throw new zy("Platform does not support required encoding: "+D.message)}},r.unrandomize255State=function(e,o){var l=149*o%255+1,h=e-l;return h>=0?h:h+256},r.C40_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z"],r.C40_SHIFT2_SET_CHARS=["!",'"',"#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","@","[","\\","]","^","_"],r.TEXT_BASIC_SET_CHARS=["*","*","*"," ","0","1","2","3","4","5","6","7","8","9","a","b","c","d","e","f","g","h","i","j","k","l","m","n","o","p","q","r","s","t","u","v","w","x","y","z"],r.TEXT_SHIFT2_SET_CHARS=r.C40_SHIFT2_SET_CHARS,r.TEXT_SHIFT3_SET_CHARS=["`","A","B","C","D","E","F","G","H","I","J","K","L","M","N","O","P","Q","R","S","T","U","V","W","X","Y","Z","{","|","}","~",""],r})(),JN=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},e7=(function(){function r(){this.rsDecoder=new Wv(ql.DATA_MATRIX_FIELD_256)}return r.prototype.decode=function(e){var o,l,h=new YN(e),m=h.getVersion(),b=h.readCodewords(),n=QN.getDataBlocks(b,m),C=0;try{for(var D=JN(n),L=D.next();!L.done;L=D.next()){var U=L.value;C+=U.getNumDataCodewords()}}catch(Pe){o={error:Pe}}finally{try{L&&!L.done&&(l=D.return)&&l.call(D)}finally{if(o)throw o.error}}for(var q=new Uint8Array(C),Z=n.length,ie=0;ie<Z;ie++){var ne=n[ie],be=ne.getCodewords(),ve=ne.getNumDataCodewords();this.correctErrors(be,ve);for(var we=0;we<ve;we++)q[we*Z+ie]=be[we]}return KN.decode(q)},r.prototype.correctErrors=function(e,o){var l=new Int32Array(e);try{this.rsDecoder.decode(l,e.length-o)}catch{throw new Ka}for(var h=0;h<o;h++)e[h]=l[h]},r})(),t7=(function(){function r(e){this.image=e,this.rectangleDetector=new Tw(this.image)}return r.prototype.detect=function(){var e=this.rectangleDetector.detect(),o=this.detectSolid1(e);if(o=this.detectSolid2(o),o[3]=this.correctTopRight(o),!o[3])throw new Xt;o=this.shiftToModuleCenter(o);var l=o[0],h=o[1],m=o[2],b=o[3],n=this.transitionsBetween(l,b)+1,C=this.transitionsBetween(m,b)+1;(n&1)===1&&(n+=1),(C&1)===1&&(C+=1),4*n<7*C&&4*C<7*n&&(n=C=Math.max(n,C));var D=r.sampleGrid(this.image,l,h,m,b,n,C);return new O2(D,[l,h,m,b])},r.shiftPoint=function(e,o,l){var h=(o.getX()-e.getX())/(l+1),m=(o.getY()-e.getY())/(l+1);return new ti(e.getX()+h,e.getY()+m)},r.moveAway=function(e,o,l){var h=e.getX(),m=e.getY();return h<o?h-=1:h+=1,m<l?m-=1:m+=1,new ti(h,m)},r.prototype.detectSolid1=function(e){var o=e[0],l=e[1],h=e[3],m=e[2],b=this.transitionsBetween(o,l),n=this.transitionsBetween(l,h),C=this.transitionsBetween(h,m),D=this.transitionsBetween(m,o),L=b,U=[m,o,l,h];return L>n&&(L=n,U[0]=o,U[1]=l,U[2]=h,U[3]=m),L>C&&(L=C,U[0]=l,U[1]=h,U[2]=m,U[3]=o),L>D&&(U[0]=h,U[1]=m,U[2]=o,U[3]=l),U},r.prototype.detectSolid2=function(e){var o=e[0],l=e[1],h=e[2],m=e[3],b=this.transitionsBetween(o,m),n=r.shiftPoint(l,h,(b+1)*4),C=r.shiftPoint(h,l,(b+1)*4),D=this.transitionsBetween(n,o),L=this.transitionsBetween(C,m);return D<L?(e[0]=o,e[1]=l,e[2]=h,e[3]=m):(e[0]=l,e[1]=h,e[2]=m,e[3]=o),e},r.prototype.correctTopRight=function(e){var o=e[0],l=e[1],h=e[2],m=e[3],b=this.transitionsBetween(o,m),n=this.transitionsBetween(l,m),C=r.shiftPoint(o,l,(n+1)*4),D=r.shiftPoint(h,l,(b+1)*4);b=this.transitionsBetween(C,m),n=this.transitionsBetween(D,m);var L=new ti(m.getX()+(h.getX()-l.getX())/(b+1),m.getY()+(h.getY()-l.getY())/(b+1)),U=new ti(m.getX()+(o.getX()-l.getX())/(n+1),m.getY()+(o.getY()-l.getY())/(n+1));if(!this.isValid(L))return this.isValid(U)?U:null;if(!this.isValid(U))return L;var q=this.transitionsBetween(C,L)+this.transitionsBetween(D,L),Z=this.transitionsBetween(C,U)+this.transitionsBetween(D,U);return q>Z?L:U},r.prototype.shiftToModuleCenter=function(e){var o=e[0],l=e[1],h=e[2],m=e[3],b=this.transitionsBetween(o,m)+1,n=this.transitionsBetween(h,m)+1,C=r.shiftPoint(o,l,n*4),D=r.shiftPoint(h,l,b*4);b=this.transitionsBetween(C,m)+1,n=this.transitionsBetween(D,m)+1,(b&1)===1&&(b+=1),(n&1)===1&&(n+=1);var L=(o.getX()+l.getX()+h.getX()+m.getX())/4,U=(o.getY()+l.getY()+h.getY()+m.getY())/4;o=r.moveAway(o,L,U),l=r.moveAway(l,L,U),h=r.moveAway(h,L,U),m=r.moveAway(m,L,U);var q,Z;return C=r.shiftPoint(o,l,n*4),C=r.shiftPoint(C,m,b*4),q=r.shiftPoint(l,o,n*4),q=r.shiftPoint(q,h,b*4),D=r.shiftPoint(h,m,n*4),D=r.shiftPoint(D,l,b*4),Z=r.shiftPoint(m,h,n*4),Z=r.shiftPoint(Z,o,b*4),[C,q,D,Z]},r.prototype.isValid=function(e){return e.getX()>=0&&e.getX()<this.image.getWidth()&&e.getY()>0&&e.getY()<this.image.getHeight()},r.sampleGrid=function(e,o,l,h,m,b,n){var C=P2.getInstance();return C.sampleGrid(e,b,n,.5,.5,b-.5,.5,b-.5,n-.5,.5,n-.5,o.getX(),o.getY(),m.getX(),m.getY(),h.getX(),h.getY(),l.getX(),l.getY())},r.prototype.transitionsBetween=function(e,o){var l=Math.trunc(e.getX()),h=Math.trunc(e.getY()),m=Math.trunc(o.getX()),b=Math.trunc(o.getY()),n=Math.abs(b-h)>Math.abs(m-l);if(n){var C=l;l=h,h=C,C=m,m=b,b=C}for(var D=Math.abs(m-l),L=Math.abs(b-h),U=-D/2,q=h<b?1:-1,Z=l<m?1:-1,ie=0,ne=this.image.get(n?h:l,n?l:h),be=l,ve=h;be!==m;be+=Z){var we=this.image.get(n?ve:be,n?be:ve);if(we!==ne&&(ie++,ne=we),U+=L,U>0){if(ve===b)break;ve+=q,U-=D}}return ie},r})(),Cw=(function(){function r(){this.decoder=new e7}return r.prototype.decode=function(e,o){o===void 0&&(o=null);var l,h;if(o!=null&&o.has(Io.PURE_BARCODE)){var m=r.extractPureBits(e.getBlackMatrix());l=this.decoder.decode(m),h=r.NO_POINTS}else{var b=new t7(e.getBlackMatrix()).detect();l=this.decoder.decode(b.getBits()),h=b.getPoints()}var n=l.getRawBytes(),C=new Hs(l.getText(),n,8*n.length,h,yi.DATA_MATRIX,yo.currentTimeMillis()),D=l.getByteSegments();D!=null&&C.putMetadata(gs.BYTE_SEGMENTS,D);var L=l.getECLevel();return L!=null&&C.putMetadata(gs.ERROR_CORRECTION_LEVEL,L),C},r.prototype.reset=function(){},r.extractPureBits=function(e){var o=e.getTopLeftOnBit(),l=e.getBottomRightOnBit();if(o==null||l==null)throw new Xt;var h=this.moduleSize(o,e),m=o[1],b=l[1],n=o[0],C=l[0],D=(C-n+1)/h,L=(b-m+1)/h;if(D<=0||L<=0)throw new Xt;var U=h/2;m+=U,n+=U;for(var q=new If(D,L),Z=0;Z<L;Z++)for(var ie=m+Z*h,ne=0;ne<D;ne++)e.get(n+ne*h,ie)&&q.set(ne,Z);return q},r.moduleSize=function(e,o){for(var l=o.getWidth(),h=e[0],m=e[1];h<l&&o.get(h,m);)h++;if(h===l)throw new Xt;var b=h-e[0];if(b===0)throw new Xt;return b},r.NO_POINTS=[],r})(),r7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){r7(e,r);function e(o){return o===void 0&&(o=500),r.call(this,new Cw,o)||this}return e})(J_);var F_;(function(r){r[r.L=0]="L",r[r.M=1]="M",r[r.Q=2]="Q",r[r.H=3]="H"})(F_||(F_={}));var i7=(function(){function r(e,o,l){this.value=e,this.stringValue=o,this.bits=l,r.FOR_BITS.set(l,this),r.FOR_VALUE.set(e,this)}return r.prototype.getValue=function(){return this.value},r.prototype.getBits=function(){return this.bits},r.fromString=function(e){switch(e){case"L":return r.L;case"M":return r.M;case"Q":return r.Q;case"H":return r.H;default:throw new bh(e+"not available")}},r.prototype.toString=function(){return this.stringValue},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.value===o.value},r.forBits=function(e){if(e<0||e>=r.FOR_BITS.size)throw new bi;return r.FOR_BITS.get(e)},r.FOR_BITS=new Map,r.FOR_VALUE=new Map,r.L=new r(F_.L,"L",1),r.M=new r(F_.M,"M",0),r.Q=new r(F_.Q,"Q",3),r.H=new r(F_.H,"H",2),r})(),n7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},kR=(function(){function r(e){this.errorCorrectionLevel=i7.forBits(e>>3&3),this.dataMask=e&7}return r.numBitsDiffering=function(e,o){return pn.bitCount(e^o)},r.decodeFormatInformation=function(e,o){var l=r.doDecodeFormatInformation(e,o);return l!==null?l:r.doDecodeFormatInformation(e^r.FORMAT_INFO_MASK_QR,o^r.FORMAT_INFO_MASK_QR)},r.doDecodeFormatInformation=function(e,o){var l,h,m=Number.MAX_SAFE_INTEGER,b=0;try{for(var n=n7(r.FORMAT_INFO_DECODE_LOOKUP),C=n.next();!C.done;C=n.next()){var D=C.value,L=D[0];if(L===e||L===o)return new r(D[1]);var U=r.numBitsDiffering(e,L);U<m&&(b=D[1],m=U),e!==o&&(U=r.numBitsDiffering(o,L),U<m&&(b=D[1],m=U))}}catch(q){l={error:q}}finally{try{C&&!C.done&&(h=n.return)&&h.call(n)}finally{if(l)throw l.error}}return m<=3?new r(b):null},r.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},r.prototype.getDataMask=function(){return this.dataMask},r.prototype.hashCode=function(){return this.errorCorrectionLevel.getBits()<<3|this.dataMask},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.errorCorrectionLevel===o.errorCorrectionLevel&&this.dataMask===o.dataMask},r.FORMAT_INFO_MASK_QR=21522,r.FORMAT_INFO_DECODE_LOOKUP=[Int32Array.from([21522,0]),Int32Array.from([20773,1]),Int32Array.from([24188,2]),Int32Array.from([23371,3]),Int32Array.from([17913,4]),Int32Array.from([16590,5]),Int32Array.from([20375,6]),Int32Array.from([19104,7]),Int32Array.from([30660,8]),Int32Array.from([29427,9]),Int32Array.from([32170,10]),Int32Array.from([30877,11]),Int32Array.from([26159,12]),Int32Array.from([25368,13]),Int32Array.from([27713,14]),Int32Array.from([26998,15]),Int32Array.from([5769,16]),Int32Array.from([5054,17]),Int32Array.from([7399,18]),Int32Array.from([6608,19]),Int32Array.from([1890,20]),Int32Array.from([597,21]),Int32Array.from([3340,22]),Int32Array.from([2107,23]),Int32Array.from([13663,24]),Int32Array.from([12392,25]),Int32Array.from([16177,26]),Int32Array.from([14854,27]),Int32Array.from([9396,28]),Int32Array.from([8579,29]),Int32Array.from([11994,30]),Int32Array.from([11245,31])],r})(),o7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Lt=(function(){function r(e){for(var o=[],l=1;l<arguments.length;l++)o[l-1]=arguments[l];this.ecCodewordsPerBlock=e,this.ecBlocks=o}return r.prototype.getECCodewordsPerBlock=function(){return this.ecCodewordsPerBlock},r.prototype.getNumBlocks=function(){var e,o,l=0,h=this.ecBlocks;try{for(var m=o7(h),b=m.next();!b.done;b=m.next()){var n=b.value;l+=n.getCount()}}catch(C){e={error:C}}finally{try{b&&!b.done&&(o=m.return)&&o.call(m)}finally{if(e)throw e.error}}return l},r.prototype.getTotalECCodewords=function(){return this.ecCodewordsPerBlock*this.getNumBlocks()},r.prototype.getECBlocks=function(){return this.ecBlocks},r})(),ke=(function(){function r(e,o){this.count=e,this.dataCodewords=o}return r.prototype.getCount=function(){return this.count},r.prototype.getDataCodewords=function(){return this.dataCodewords},r})(),a7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},wg=(function(){function r(e,o){for(var l,h,m=[],b=2;b<arguments.length;b++)m[b-2]=arguments[b];this.versionNumber=e,this.alignmentPatternCenters=o,this.ecBlocks=m;var n=0,C=m[0].getECCodewordsPerBlock(),D=m[0].getECBlocks();try{for(var L=a7(D),U=L.next();!U.done;U=L.next()){var q=U.value;n+=q.getCount()*(q.getDataCodewords()+C)}}catch(Z){l={error:Z}}finally{try{U&&!U.done&&(h=L.return)&&h.call(L)}finally{if(l)throw l.error}}this.totalCodewords=n}return r.prototype.getVersionNumber=function(){return this.versionNumber},r.prototype.getAlignmentPatternCenters=function(){return this.alignmentPatternCenters},r.prototype.getTotalCodewords=function(){return this.totalCodewords},r.prototype.getDimensionForVersion=function(){return 17+4*this.versionNumber},r.prototype.getECBlocksForLevel=function(e){return this.ecBlocks[e.getValue()]},r.getProvisionalVersionForDimension=function(e){if(e%4!==1)throw new Ir;try{return this.getVersionForNumber((e-17)/4)}catch{throw new Ir}},r.getVersionForNumber=function(e){if(e<1||e>40)throw new bi;return r.VERSIONS[e-1]},r.decodeVersionInformation=function(e){for(var o=Number.MAX_SAFE_INTEGER,l=0,h=0;h<r.VERSION_DECODE_INFO.length;h++){var m=r.VERSION_DECODE_INFO[h];if(m===e)return r.getVersionForNumber(h+7);var b=kR.numBitsDiffering(e,m);b<o&&(l=h+7,o=b)}return o<=3?r.getVersionForNumber(l):null},r.prototype.buildFunctionPattern=function(){var e=this.getDimensionForVersion(),o=new If(e);o.setRegion(0,0,9,9),o.setRegion(e-8,0,8,9),o.setRegion(0,e-8,9,8);for(var l=this.alignmentPatternCenters.length,h=0;h<l;h++)for(var m=this.alignmentPatternCenters[h]-2,b=0;b<l;b++)h===0&&(b===0||b===l-1)||h===l-1&&b===0||o.setRegion(this.alignmentPatternCenters[b]-2,m,5,5);return o.setRegion(6,9,1,e-17),o.setRegion(9,6,e-17,1),this.versionNumber>6&&(o.setRegion(e-11,0,3,6),o.setRegion(0,e-11,6,3)),o},r.prototype.toString=function(){return""+this.versionNumber},r.VERSION_DECODE_INFO=Int32Array.from([31892,34236,39577,42195,48118,51042,55367,58893,63784,68472,70749,76311,79154,84390,87683,92361,96236,102084,102881,110507,110734,117786,119615,126325,127568,133589,136944,141498,145311,150283,152622,158308,161089,167017]),r.VERSIONS=[new r(1,new Int32Array(0),new Lt(7,new ke(1,19)),new Lt(10,new ke(1,16)),new Lt(13,new ke(1,13)),new Lt(17,new ke(1,9))),new r(2,Int32Array.from([6,18]),new Lt(10,new ke(1,34)),new Lt(16,new ke(1,28)),new Lt(22,new ke(1,22)),new Lt(28,new ke(1,16))),new r(3,Int32Array.from([6,22]),new Lt(15,new ke(1,55)),new Lt(26,new ke(1,44)),new Lt(18,new ke(2,17)),new Lt(22,new ke(2,13))),new r(4,Int32Array.from([6,26]),new Lt(20,new ke(1,80)),new Lt(18,new ke(2,32)),new Lt(26,new ke(2,24)),new Lt(16,new ke(4,9))),new r(5,Int32Array.from([6,30]),new Lt(26,new ke(1,108)),new Lt(24,new ke(2,43)),new Lt(18,new ke(2,15),new ke(2,16)),new Lt(22,new ke(2,11),new ke(2,12))),new r(6,Int32Array.from([6,34]),new Lt(18,new ke(2,68)),new Lt(16,new ke(4,27)),new Lt(24,new ke(4,19)),new Lt(28,new ke(4,15))),new r(7,Int32Array.from([6,22,38]),new Lt(20,new ke(2,78)),new Lt(18,new ke(4,31)),new Lt(18,new ke(2,14),new ke(4,15)),new Lt(26,new ke(4,13),new ke(1,14))),new r(8,Int32Array.from([6,24,42]),new Lt(24,new ke(2,97)),new Lt(22,new ke(2,38),new ke(2,39)),new Lt(22,new ke(4,18),new ke(2,19)),new Lt(26,new ke(4,14),new ke(2,15))),new r(9,Int32Array.from([6,26,46]),new Lt(30,new ke(2,116)),new Lt(22,new ke(3,36),new ke(2,37)),new Lt(20,new ke(4,16),new ke(4,17)),new Lt(24,new ke(4,12),new ke(4,13))),new r(10,Int32Array.from([6,28,50]),new Lt(18,new ke(2,68),new ke(2,69)),new Lt(26,new ke(4,43),new ke(1,44)),new Lt(24,new ke(6,19),new ke(2,20)),new Lt(28,new ke(6,15),new ke(2,16))),new r(11,Int32Array.from([6,30,54]),new Lt(20,new ke(4,81)),new Lt(30,new ke(1,50),new ke(4,51)),new Lt(28,new ke(4,22),new ke(4,23)),new Lt(24,new ke(3,12),new ke(8,13))),new r(12,Int32Array.from([6,32,58]),new Lt(24,new ke(2,92),new ke(2,93)),new Lt(22,new ke(6,36),new ke(2,37)),new Lt(26,new ke(4,20),new ke(6,21)),new Lt(28,new ke(7,14),new ke(4,15))),new r(13,Int32Array.from([6,34,62]),new Lt(26,new ke(4,107)),new Lt(22,new ke(8,37),new ke(1,38)),new Lt(24,new ke(8,20),new ke(4,21)),new Lt(22,new ke(12,11),new ke(4,12))),new r(14,Int32Array.from([6,26,46,66]),new Lt(30,new ke(3,115),new ke(1,116)),new Lt(24,new ke(4,40),new ke(5,41)),new Lt(20,new ke(11,16),new ke(5,17)),new Lt(24,new ke(11,12),new ke(5,13))),new r(15,Int32Array.from([6,26,48,70]),new Lt(22,new ke(5,87),new ke(1,88)),new Lt(24,new ke(5,41),new ke(5,42)),new Lt(30,new ke(5,24),new ke(7,25)),new Lt(24,new ke(11,12),new ke(7,13))),new r(16,Int32Array.from([6,26,50,74]),new Lt(24,new ke(5,98),new ke(1,99)),new Lt(28,new ke(7,45),new ke(3,46)),new Lt(24,new ke(15,19),new ke(2,20)),new Lt(30,new ke(3,15),new ke(13,16))),new r(17,Int32Array.from([6,30,54,78]),new Lt(28,new ke(1,107),new ke(5,108)),new Lt(28,new ke(10,46),new ke(1,47)),new Lt(28,new ke(1,22),new ke(15,23)),new Lt(28,new ke(2,14),new ke(17,15))),new r(18,Int32Array.from([6,30,56,82]),new Lt(30,new ke(5,120),new ke(1,121)),new Lt(26,new ke(9,43),new ke(4,44)),new Lt(28,new ke(17,22),new ke(1,23)),new Lt(28,new ke(2,14),new ke(19,15))),new r(19,Int32Array.from([6,30,58,86]),new Lt(28,new ke(3,113),new ke(4,114)),new Lt(26,new ke(3,44),new ke(11,45)),new Lt(26,new ke(17,21),new ke(4,22)),new Lt(26,new ke(9,13),new ke(16,14))),new r(20,Int32Array.from([6,34,62,90]),new Lt(28,new ke(3,107),new ke(5,108)),new Lt(26,new ke(3,41),new ke(13,42)),new Lt(30,new ke(15,24),new ke(5,25)),new Lt(28,new ke(15,15),new ke(10,16))),new r(21,Int32Array.from([6,28,50,72,94]),new Lt(28,new ke(4,116),new ke(4,117)),new Lt(26,new ke(17,42)),new Lt(28,new ke(17,22),new ke(6,23)),new Lt(30,new ke(19,16),new ke(6,17))),new r(22,Int32Array.from([6,26,50,74,98]),new Lt(28,new ke(2,111),new ke(7,112)),new Lt(28,new ke(17,46)),new Lt(30,new ke(7,24),new ke(16,25)),new Lt(24,new ke(34,13))),new r(23,Int32Array.from([6,30,54,78,102]),new Lt(30,new ke(4,121),new ke(5,122)),new Lt(28,new ke(4,47),new ke(14,48)),new Lt(30,new ke(11,24),new ke(14,25)),new Lt(30,new ke(16,15),new ke(14,16))),new r(24,Int32Array.from([6,28,54,80,106]),new Lt(30,new ke(6,117),new ke(4,118)),new Lt(28,new ke(6,45),new ke(14,46)),new Lt(30,new ke(11,24),new ke(16,25)),new Lt(30,new ke(30,16),new ke(2,17))),new r(25,Int32Array.from([6,32,58,84,110]),new Lt(26,new ke(8,106),new ke(4,107)),new Lt(28,new ke(8,47),new ke(13,48)),new Lt(30,new ke(7,24),new ke(22,25)),new Lt(30,new ke(22,15),new ke(13,16))),new r(26,Int32Array.from([6,30,58,86,114]),new Lt(28,new ke(10,114),new ke(2,115)),new Lt(28,new ke(19,46),new ke(4,47)),new Lt(28,new ke(28,22),new ke(6,23)),new Lt(30,new ke(33,16),new ke(4,17))),new r(27,Int32Array.from([6,34,62,90,118]),new Lt(30,new ke(8,122),new ke(4,123)),new Lt(28,new ke(22,45),new ke(3,46)),new Lt(30,new ke(8,23),new ke(26,24)),new Lt(30,new ke(12,15),new ke(28,16))),new r(28,Int32Array.from([6,26,50,74,98,122]),new Lt(30,new ke(3,117),new ke(10,118)),new Lt(28,new ke(3,45),new ke(23,46)),new Lt(30,new ke(4,24),new ke(31,25)),new Lt(30,new ke(11,15),new ke(31,16))),new r(29,Int32Array.from([6,30,54,78,102,126]),new Lt(30,new ke(7,116),new ke(7,117)),new Lt(28,new ke(21,45),new ke(7,46)),new Lt(30,new ke(1,23),new ke(37,24)),new Lt(30,new ke(19,15),new ke(26,16))),new r(30,Int32Array.from([6,26,52,78,104,130]),new Lt(30,new ke(5,115),new ke(10,116)),new Lt(28,new ke(19,47),new ke(10,48)),new Lt(30,new ke(15,24),new ke(25,25)),new Lt(30,new ke(23,15),new ke(25,16))),new r(31,Int32Array.from([6,30,56,82,108,134]),new Lt(30,new ke(13,115),new ke(3,116)),new Lt(28,new ke(2,46),new ke(29,47)),new Lt(30,new ke(42,24),new ke(1,25)),new Lt(30,new ke(23,15),new ke(28,16))),new r(32,Int32Array.from([6,34,60,86,112,138]),new Lt(30,new ke(17,115)),new Lt(28,new ke(10,46),new ke(23,47)),new Lt(30,new ke(10,24),new ke(35,25)),new Lt(30,new ke(19,15),new ke(35,16))),new r(33,Int32Array.from([6,30,58,86,114,142]),new Lt(30,new ke(17,115),new ke(1,116)),new Lt(28,new ke(14,46),new ke(21,47)),new Lt(30,new ke(29,24),new ke(19,25)),new Lt(30,new ke(11,15),new ke(46,16))),new r(34,Int32Array.from([6,34,62,90,118,146]),new Lt(30,new ke(13,115),new ke(6,116)),new Lt(28,new ke(14,46),new ke(23,47)),new Lt(30,new ke(44,24),new ke(7,25)),new Lt(30,new ke(59,16),new ke(1,17))),new r(35,Int32Array.from([6,30,54,78,102,126,150]),new Lt(30,new ke(12,121),new ke(7,122)),new Lt(28,new ke(12,47),new ke(26,48)),new Lt(30,new ke(39,24),new ke(14,25)),new Lt(30,new ke(22,15),new ke(41,16))),new r(36,Int32Array.from([6,24,50,76,102,128,154]),new Lt(30,new ke(6,121),new ke(14,122)),new Lt(28,new ke(6,47),new ke(34,48)),new Lt(30,new ke(46,24),new ke(10,25)),new Lt(30,new ke(2,15),new ke(64,16))),new r(37,Int32Array.from([6,28,54,80,106,132,158]),new Lt(30,new ke(17,122),new ke(4,123)),new Lt(28,new ke(29,46),new ke(14,47)),new Lt(30,new ke(49,24),new ke(10,25)),new Lt(30,new ke(24,15),new ke(46,16))),new r(38,Int32Array.from([6,32,58,84,110,136,162]),new Lt(30,new ke(4,122),new ke(18,123)),new Lt(28,new ke(13,46),new ke(32,47)),new Lt(30,new ke(48,24),new ke(14,25)),new Lt(30,new ke(42,15),new ke(32,16))),new r(39,Int32Array.from([6,26,54,82,110,138,166]),new Lt(30,new ke(20,117),new ke(4,118)),new Lt(28,new ke(40,47),new ke(7,48)),new Lt(30,new ke(43,24),new ke(22,25)),new Lt(30,new ke(10,15),new ke(67,16))),new r(40,Int32Array.from([6,30,58,86,114,142,170]),new Lt(30,new ke(19,118),new ke(6,119)),new Lt(28,new ke(18,47),new ke(31,48)),new Lt(30,new ke(34,24),new ke(34,25)),new Lt(30,new ke(20,15),new ke(61,16)))],r})(),Ya;(function(r){r[r.DATA_MASK_000=0]="DATA_MASK_000",r[r.DATA_MASK_001=1]="DATA_MASK_001",r[r.DATA_MASK_010=2]="DATA_MASK_010",r[r.DATA_MASK_011=3]="DATA_MASK_011",r[r.DATA_MASK_100=4]="DATA_MASK_100",r[r.DATA_MASK_101=5]="DATA_MASK_101",r[r.DATA_MASK_110=6]="DATA_MASK_110",r[r.DATA_MASK_111=7]="DATA_MASK_111"})(Ya||(Ya={}));var FC=(function(){function r(e,o){this.value=e,this.isMasked=o}return r.prototype.unmaskBitMatrix=function(e,o){for(var l=0;l<o;l++)for(var h=0;h<o;h++)this.isMasked(l,h)&&e.flip(h,l)},r.values=new Map([[Ya.DATA_MASK_000,new r(Ya.DATA_MASK_000,function(e,o){return(e+o&1)===0})],[Ya.DATA_MASK_001,new r(Ya.DATA_MASK_001,function(e,o){return(e&1)===0})],[Ya.DATA_MASK_010,new r(Ya.DATA_MASK_010,function(e,o){return o%3===0})],[Ya.DATA_MASK_011,new r(Ya.DATA_MASK_011,function(e,o){return(e+o)%3===0})],[Ya.DATA_MASK_100,new r(Ya.DATA_MASK_100,function(e,o){return(Math.floor(e/2)+Math.floor(o/3)&1)===0})],[Ya.DATA_MASK_101,new r(Ya.DATA_MASK_101,function(e,o){return e*o%6===0})],[Ya.DATA_MASK_110,new r(Ya.DATA_MASK_110,function(e,o){return e*o%6<3})],[Ya.DATA_MASK_111,new r(Ya.DATA_MASK_111,function(e,o){return(e+o+e*o%3&1)===0})]]),r})(),s7=(function(){function r(e){var o=e.getHeight();if(o<21||(o&3)!==1)throw new Ir;this.bitMatrix=e}return r.prototype.readFormatInformation=function(){if(this.parsedFormatInfo!==null&&this.parsedFormatInfo!==void 0)return this.parsedFormatInfo;for(var e=0,o=0;o<6;o++)e=this.copyBit(o,8,e);e=this.copyBit(7,8,e),e=this.copyBit(8,8,e),e=this.copyBit(8,7,e);for(var l=5;l>=0;l--)e=this.copyBit(8,l,e);for(var h=this.bitMatrix.getHeight(),m=0,b=h-7,l=h-1;l>=b;l--)m=this.copyBit(8,l,m);for(var o=h-8;o<h;o++)m=this.copyBit(o,8,m);if(this.parsedFormatInfo=kR.decodeFormatInformation(e,m),this.parsedFormatInfo!==null)return this.parsedFormatInfo;throw new Ir},r.prototype.readVersion=function(){if(this.parsedVersion!==null&&this.parsedVersion!==void 0)return this.parsedVersion;var e=this.bitMatrix.getHeight(),o=Math.floor((e-17)/4);if(o<=6)return wg.getVersionForNumber(o);for(var l=0,h=e-11,m=5;m>=0;m--)for(var b=e-9;b>=h;b--)l=this.copyBit(b,m,l);var n=wg.decodeVersionInformation(l);if(n!==null&&n.getDimensionForVersion()===e)return this.parsedVersion=n,n;l=0;for(var b=5;b>=0;b--)for(var m=e-9;m>=h;m--)l=this.copyBit(b,m,l);if(n=wg.decodeVersionInformation(l),n!==null&&n.getDimensionForVersion()===e)return this.parsedVersion=n,n;throw new Ir},r.prototype.copyBit=function(e,o,l){var h=this.isMirror?this.bitMatrix.get(o,e):this.bitMatrix.get(e,o);return h?l<<1|1:l<<1},r.prototype.readCodewords=function(){var e=this.readFormatInformation(),o=this.readVersion(),l=FC.values.get(e.getDataMask()),h=this.bitMatrix.getHeight();l.unmaskBitMatrix(this.bitMatrix,h);for(var m=o.buildFunctionPattern(),b=!0,n=new Uint8Array(o.getTotalCodewords()),C=0,D=0,L=0,U=h-1;U>0;U-=2){U===6&&U--;for(var q=0;q<h;q++)for(var Z=b?h-1-q:q,ie=0;ie<2;ie++)m.get(U-ie,Z)||(L++,D<<=1,this.bitMatrix.get(U-ie,Z)&&(D|=1),L===8&&(n[C++]=D,L=0,D=0));b=!b}if(C!==o.getTotalCodewords())throw new Ir;return n},r.prototype.remask=function(){if(this.parsedFormatInfo!==null){var e=FC.values.get(this.parsedFormatInfo.getDataMask()),o=this.bitMatrix.getHeight();e.unmaskBitMatrix(this.bitMatrix,o)}},r.prototype.setMirror=function(e){this.parsedVersion=null,this.parsedFormatInfo=null,this.isMirror=e},r.prototype.mirror=function(){for(var e=this.bitMatrix,o=0,l=e.getWidth();o<l;o++)for(var h=o+1,m=e.getHeight();h<m;h++)e.get(o,h)!==e.get(h,o)&&(e.flip(h,o),e.flip(o,h))},r})(),kC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},l7=(function(){function r(e,o){this.numDataCodewords=e,this.codewords=o}return r.getDataBlocks=function(e,o,l){var h,m,b,n;if(e.length!==o.getTotalCodewords())throw new bi;var C=o.getECBlocksForLevel(l),D=0,L=C.getECBlocks();try{for(var U=kC(L),q=U.next();!q.done;q=U.next()){var Z=q.value;D+=Z.getCount()}}catch(ui){h={error:ui}}finally{try{q&&!q.done&&(m=U.return)&&m.call(U)}finally{if(h)throw h.error}}var ie=new Array(D),ne=0;try{for(var be=kC(L),ve=be.next();!ve.done;ve=be.next())for(var Z=ve.value,we=0;we<Z.getCount();we++){var Pe=Z.getDataCodewords(),Ze=C.getECCodewordsPerBlock()+Pe;ie[ne++]=new r(Pe,new Uint8Array(Ze))}}catch(ui){b={error:ui}}finally{try{ve&&!ve.done&&(n=be.return)&&n.call(be)}finally{if(b)throw b.error}}for(var $e=ie[0].codewords.length,xt=ie.length-1;xt>=0;){var Ct=ie[xt].codewords.length;if(Ct===$e)break;xt--}xt++;for(var Ft=$e-C.getECCodewordsPerBlock(),Yt=0,we=0;we<Ft;we++)for(var hr=0;hr<ne;hr++)ie[hr].codewords[we]=e[Yt++];for(var hr=xt;hr<ne;hr++)ie[hr].codewords[Ft]=e[Yt++];for(var pr=ie[0].codewords.length,we=Ft;we<pr;we++)for(var hr=0;hr<ne;hr++){var Kr=hr<xt?we:we+1;ie[hr].codewords[Kr]=e[Yt++]}return ie},r.prototype.getNumDataCodewords=function(){return this.numDataCodewords},r.prototype.getCodewords=function(){return this.codewords},r})(),Ru;(function(r){r[r.TERMINATOR=0]="TERMINATOR",r[r.NUMERIC=1]="NUMERIC",r[r.ALPHANUMERIC=2]="ALPHANUMERIC",r[r.STRUCTURED_APPEND=3]="STRUCTURED_APPEND",r[r.BYTE=4]="BYTE",r[r.ECI=5]="ECI",r[r.KANJI=6]="KANJI",r[r.FNC1_FIRST_POSITION=7]="FNC1_FIRST_POSITION",r[r.FNC1_SECOND_POSITION=8]="FNC1_SECOND_POSITION",r[r.HANZI=9]="HANZI"})(Ru||(Ru={}));var To=(function(){function r(e,o,l,h){this.value=e,this.stringValue=o,this.characterCountBitsForVersions=l,this.bits=h,r.FOR_BITS.set(h,this),r.FOR_VALUE.set(e,this)}return r.forBits=function(e){var o=r.FOR_BITS.get(e);if(o===void 0)throw new bi;return o},r.prototype.getCharacterCountBits=function(e){var o=e.getVersionNumber(),l;return o<=9?l=0:o<=26?l=1:l=2,this.characterCountBitsForVersions[l]},r.prototype.getValue=function(){return this.value},r.prototype.getBits=function(){return this.bits},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;return this.value===o.value},r.prototype.toString=function(){return this.stringValue},r.FOR_BITS=new Map,r.FOR_VALUE=new Map,r.TERMINATOR=new r(Ru.TERMINATOR,"TERMINATOR",Int32Array.from([0,0,0]),0),r.NUMERIC=new r(Ru.NUMERIC,"NUMERIC",Int32Array.from([10,12,14]),1),r.ALPHANUMERIC=new r(Ru.ALPHANUMERIC,"ALPHANUMERIC",Int32Array.from([9,11,13]),2),r.STRUCTURED_APPEND=new r(Ru.STRUCTURED_APPEND,"STRUCTURED_APPEND",Int32Array.from([0,0,0]),3),r.BYTE=new r(Ru.BYTE,"BYTE",Int32Array.from([8,16,16]),4),r.ECI=new r(Ru.ECI,"ECI",Int32Array.from([0,0,0]),7),r.KANJI=new r(Ru.KANJI,"KANJI",Int32Array.from([8,10,12]),8),r.FNC1_FIRST_POSITION=new r(Ru.FNC1_FIRST_POSITION,"FNC1_FIRST_POSITION",Int32Array.from([0,0,0]),5),r.FNC1_SECOND_POSITION=new r(Ru.FNC1_SECOND_POSITION,"FNC1_SECOND_POSITION",Int32Array.from([0,0,0]),9),r.HANZI=new r(Ru.HANZI,"HANZI",Int32Array.from([8,10,12]),13),r})(),c7=(function(){function r(){}return r.decode=function(e,o,l,h){var m=new FR(e),b=new cn,n=new Array,C=-1,D=-1;try{var L=null,U=!1,q=void 0;do{if(m.available()<4)q=To.TERMINATOR;else{var Z=m.readBits(4);q=To.forBits(Z)}switch(q){case To.TERMINATOR:break;case To.FNC1_FIRST_POSITION:case To.FNC1_SECOND_POSITION:U=!0;break;case To.STRUCTURED_APPEND:if(m.available()<16)throw new Ir;C=m.readBits(8),D=m.readBits(8);break;case To.ECI:var ie=r.parseECIValue(m);if(L=Fa.getCharacterSetECIByValue(ie),L===null)throw new Ir;break;case To.HANZI:var ne=m.readBits(4),be=m.readBits(q.getCharacterCountBits(o));ne===r.GB2312_SUBSET&&r.decodeHanziSegment(m,b,be);break;default:var ve=m.readBits(q.getCharacterCountBits(o));switch(q){case To.NUMERIC:r.decodeNumericSegment(m,b,ve);break;case To.ALPHANUMERIC:r.decodeAlphanumericSegment(m,b,ve,U);break;case To.BYTE:r.decodeByteSegment(m,b,ve,L,n,h);break;case To.KANJI:r.decodeKanjiSegment(m,b,ve);break;default:throw new Ir}break}}while(q!==To.TERMINATOR)}catch{throw new Ir}return new Zv(e,b.toString(),n.length===0?null:n,l===null?null:l.toString(),C,D)},r.decodeHanziSegment=function(e,o,l){if(l*13>e.available())throw new Ir;for(var h=new Uint8Array(2*l),m=0;l>0;){var b=e.readBits(13),n=b/96<<8&4294967295|b%96;n<959?n+=41377:n+=42657,h[m]=n>>8&255,h[m+1]=n&255,m+=2,l--}try{o.append(Bu.decode(h,En.GB2312))}catch(C){throw new Ir(C)}},r.decodeKanjiSegment=function(e,o,l){if(l*13>e.available())throw new Ir;for(var h=new Uint8Array(2*l),m=0;l>0;){var b=e.readBits(13),n=b/192<<8&4294967295|b%192;n<7936?n+=33088:n+=49472,h[m]=n>>8,h[m+1]=n,m+=2,l--}try{o.append(Bu.decode(h,En.SHIFT_JIS))}catch(C){throw new Ir(C)}},r.decodeByteSegment=function(e,o,l,h,m,b){if(8*l>e.available())throw new Ir;for(var n=new Uint8Array(l),C=0;C<l;C++)n[C]=e.readBits(8);var D;h===null?D=En.guessEncoding(n,b):D=h.getName();try{o.append(Bu.decode(n,D))}catch(L){throw new Ir(L)}m.push(n)},r.toAlphaNumericChar=function(e){if(e>=r.ALPHANUMERIC_CHARS.length)throw new Ir;return r.ALPHANUMERIC_CHARS[e]},r.decodeAlphanumericSegment=function(e,o,l,h){for(var m=o.length();l>1;){if(e.available()<11)throw new Ir;var b=e.readBits(11);o.append(r.toAlphaNumericChar(Math.floor(b/45))),o.append(r.toAlphaNumericChar(b%45)),l-=2}if(l===1){if(e.available()<6)throw new Ir;o.append(r.toAlphaNumericChar(e.readBits(6)))}if(h)for(var n=m;n<o.length();n++)o.charAt(n)==="%"&&(n<o.length()-1&&o.charAt(n+1)==="%"?o.deleteCharAt(n+1):o.setCharAt(n,""))},r.decodeNumericSegment=function(e,o,l){for(;l>=3;){if(e.available()<10)throw new Ir;var h=e.readBits(10);if(h>=1e3)throw new Ir;o.append(r.toAlphaNumericChar(Math.floor(h/100))),o.append(r.toAlphaNumericChar(Math.floor(h/10)%10)),o.append(r.toAlphaNumericChar(h%10)),l-=3}if(l===2){if(e.available()<7)throw new Ir;var m=e.readBits(7);if(m>=100)throw new Ir;o.append(r.toAlphaNumericChar(Math.floor(m/10))),o.append(r.toAlphaNumericChar(m%10))}else if(l===1){if(e.available()<4)throw new Ir;var b=e.readBits(4);if(b>=10)throw new Ir;o.append(r.toAlphaNumericChar(b))}},r.parseECIValue=function(e){var o=e.readBits(8);if((o&128)===0)return o&127;if((o&192)===128){var l=e.readBits(8);return(o&63)<<8&4294967295|l}if((o&224)===192){var h=e.readBits(16);return(o&31)<<16&4294967295|h}throw new Ir},r.ALPHANUMERIC_CHARS="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZ $%*+-./:",r.GB2312_SUBSET=1,r})(),NR=(function(){function r(e){this.mirrored=e}return r.prototype.isMirrored=function(){return this.mirrored},r.prototype.applyMirroredCorrection=function(e){if(!(!this.mirrored||e===null||e.length<3)){var o=e[0];e[0]=e[2],e[2]=o}},r})(),NC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},u7=(function(){function r(){this.rsDecoder=new Wv(ql.QR_CODE_FIELD_256)}return r.prototype.decodeBooleanArray=function(e,o){return this.decodeBitMatrix(If.parseFromBooleanArray(e),o)},r.prototype.decodeBitMatrix=function(e,o){var l=new s7(e),h=null;try{return this.decodeBitMatrixParser(l,o)}catch(b){h=b}try{l.remask(),l.setMirror(!0),l.readVersion(),l.readFormatInformation(),l.mirror();var m=this.decodeBitMatrixParser(l,o);return m.setOther(new NR(!0)),m}catch(b){throw h!==null?h:b}},r.prototype.decodeBitMatrixParser=function(e,o){var l,h,m,b,n=e.readVersion(),C=e.readFormatInformation().getErrorCorrectionLevel(),D=e.readCodewords(),L=l7.getDataBlocks(D,n,C),U=0;try{for(var q=NC(L),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value;U+=ie.getNumDataCodewords()}}catch(xt){l={error:xt}}finally{try{Z&&!Z.done&&(h=q.return)&&h.call(q)}finally{if(l)throw l.error}}var ne=new Uint8Array(U),be=0;try{for(var ve=NC(L),we=ve.next();!we.done;we=ve.next()){var ie=we.value,Pe=ie.getCodewords(),Ze=ie.getNumDataCodewords();this.correctErrors(Pe,Ze);for(var $e=0;$e<Ze;$e++)ne[be++]=Pe[$e]}}catch(xt){m={error:xt}}finally{try{we&&!we.done&&(b=ve.return)&&b.call(ve)}finally{if(m)throw m.error}}return c7.decode(ne,n,C,o)},r.prototype.correctErrors=function(e,o){var l=new Int32Array(e);try{this.rsDecoder.decode(l,e.length-o)}catch{throw new Ka}for(var h=0;h<o;h++)e[h]=l[h]},r})(),h7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),f7=(function(r){h7(e,r);function e(o,l,h){var m=r.call(this,o,l)||this;return m.estimatedModuleSize=h,m}return e.prototype.aboutEquals=function(o,l,h){if(Math.abs(l-this.getY())<=o&&Math.abs(h-this.getX())<=o){var m=Math.abs(o-this.estimatedModuleSize);return m<=1||m<=this.estimatedModuleSize}return!1},e.prototype.combineEstimate=function(o,l,h){var m=(this.getX()+l)/2,b=(this.getY()+o)/2,n=(this.estimatedModuleSize+h)/2;return new e(m,b,n)},e})(ti),d7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},p7=(function(){function r(e,o,l,h,m,b,n){this.image=e,this.startX=o,this.startY=l,this.width=h,this.height=m,this.moduleSize=b,this.resultPointCallback=n,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(3)}return r.prototype.find=function(){for(var e=this.startX,o=this.height,l=this.width,h=e+l,m=this.startY+o/2,b=new Int32Array(3),n=this.image,C=0;C<o;C++){var D=m+((C&1)===0?Math.floor((C+1)/2):-Math.floor((C+1)/2));b[0]=0,b[1]=0,b[2]=0;for(var L=e;L<h&&!n.get(L,D);)L++;for(var U=0;L<h;){if(n.get(L,D))if(U===1)b[1]++;else if(U===2){if(this.foundPatternCross(b)){var q=this.handlePossibleCenter(b,D,L);if(q!==null)return q}b[0]=b[2],b[1]=1,b[2]=0,U=1}else b[++U]++;else U===1&&U++,b[U]++;L++}if(this.foundPatternCross(b)){var q=this.handlePossibleCenter(b,D,h);if(q!==null)return q}}if(this.possibleCenters.length!==0)return this.possibleCenters[0];throw new Xt},r.centerFromEnd=function(e,o){return o-e[2]-e[1]/2},r.prototype.foundPatternCross=function(e){for(var o=this.moduleSize,l=o/2,h=0;h<3;h++)if(Math.abs(o-e[h])>=l)return!1;return!0},r.prototype.crossCheckVertical=function(e,o,l,h){var m=this.image,b=m.getHeight(),n=this.crossCheckStateCount;n[0]=0,n[1]=0,n[2]=0;for(var C=e;C>=0&&m.get(o,C)&&n[1]<=l;)n[1]++,C--;if(C<0||n[1]>l)return NaN;for(;C>=0&&!m.get(o,C)&&n[0]<=l;)n[0]++,C--;if(n[0]>l)return NaN;for(C=e+1;C<b&&m.get(o,C)&&n[1]<=l;)n[1]++,C++;if(C===b||n[1]>l)return NaN;for(;C<b&&!m.get(o,C)&&n[2]<=l;)n[2]++,C++;if(n[2]>l)return NaN;var D=n[0]+n[1]+n[2];return 5*Math.abs(D-h)>=2*h?NaN:this.foundPatternCross(n)?r.centerFromEnd(n,C):NaN},r.prototype.handlePossibleCenter=function(e,o,l){var h,m,b=e[0]+e[1]+e[2],n=r.centerFromEnd(e,l),C=this.crossCheckVertical(o,n,2*e[1],b);if(!isNaN(C)){var D=(e[0]+e[1]+e[2])/3;try{for(var L=d7(this.possibleCenters),U=L.next();!U.done;U=L.next()){var q=U.value;if(q.aboutEquals(D,C,n))return q.combineEstimate(C,n,D)}}catch(ie){h={error:ie}}finally{try{U&&!U.done&&(m=L.return)&&m.call(L)}finally{if(h)throw h.error}}var Z=new f7(n,C,D);this.possibleCenters.push(Z),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(Z)}return null},r})(),m7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),g7=(function(r){m7(e,r);function e(o,l,h,m){var b=r.call(this,o,l)||this;return b.estimatedModuleSize=h,b.count=m,m===void 0&&(b.count=1),b}return e.prototype.getEstimatedModuleSize=function(){return this.estimatedModuleSize},e.prototype.getCount=function(){return this.count},e.prototype.aboutEquals=function(o,l,h){if(Math.abs(l-this.getY())<=o&&Math.abs(h-this.getX())<=o){var m=Math.abs(o-this.estimatedModuleSize);return m<=1||m<=this.estimatedModuleSize}return!1},e.prototype.combineEstimate=function(o,l,h){var m=this.count+1,b=(this.count*this.getX()+l)/m,n=(this.count*this.getY()+o)/m,C=(this.count*this.estimatedModuleSize+h)/m;return new e(b,n,C,m)},e})(ti),_7=(function(){function r(e){this.bottomLeft=e[0],this.topLeft=e[1],this.topRight=e[2]}return r.prototype.getBottomLeft=function(){return this.bottomLeft},r.prototype.getTopLeft=function(){return this.topLeft},r.prototype.getTopRight=function(){return this.topRight},r})(),K0=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},y7=(function(){function r(e,o){this.image=e,this.resultPointCallback=o,this.possibleCenters=[],this.crossCheckStateCount=new Int32Array(5),this.resultPointCallback=o}return r.prototype.getImage=function(){return this.image},r.prototype.getPossibleCenters=function(){return this.possibleCenters},r.prototype.find=function(e){var o=e!=null&&e.get(Io.TRY_HARDER)!==void 0,l=e!=null&&e.get(Io.PURE_BARCODE)!==void 0,h=this.image,m=h.getHeight(),b=h.getWidth(),n=Math.floor(3*m/(4*r.MAX_MODULES));(n<r.MIN_SKIP||o)&&(n=r.MIN_SKIP);for(var C=!1,D=new Int32Array(5),L=n-1;L<m&&!C;L+=n){D[0]=0,D[1]=0,D[2]=0,D[3]=0,D[4]=0;for(var U=0,q=0;q<b;q++)if(h.get(q,L))(U&1)===1&&U++,D[U]++;else if((U&1)===0)if(U===4)if(r.foundPatternCross(D)){var Z=this.handlePossibleCenter(D,L,q,l);if(Z===!0)if(n=2,this.hasSkipped===!0)C=this.haveMultiplyConfirmedCenters();else{var ie=this.findRowSkip();ie>D[2]&&(L+=ie-D[2]-n,q=b-1)}else{D[0]=D[2],D[1]=D[3],D[2]=D[4],D[3]=1,D[4]=0,U=3;continue}U=0,D[0]=0,D[1]=0,D[2]=0,D[3]=0,D[4]=0}else D[0]=D[2],D[1]=D[3],D[2]=D[4],D[3]=1,D[4]=0,U=3;else D[++U]++;else D[U]++;if(r.foundPatternCross(D)){var Z=this.handlePossibleCenter(D,L,b,l);Z===!0&&(n=D[0],this.hasSkipped&&(C=this.haveMultiplyConfirmedCenters()))}}var ne=this.selectBestPatterns();return ti.orderBestPatterns(ne),new _7(ne)},r.centerFromEnd=function(e,o){return o-e[4]-e[3]-e[2]/2},r.foundPatternCross=function(e){for(var o=0,l=0;l<5;l++){var h=e[l];if(h===0)return!1;o+=h}if(o<7)return!1;var m=o/7,b=m/2;return Math.abs(m-e[0])<b&&Math.abs(m-e[1])<b&&Math.abs(3*m-e[2])<3*b&&Math.abs(m-e[3])<b&&Math.abs(m-e[4])<b},r.prototype.getCrossCheckStateCount=function(){var e=this.crossCheckStateCount;return e[0]=0,e[1]=0,e[2]=0,e[3]=0,e[4]=0,e},r.prototype.crossCheckDiagonal=function(e,o,l,h){for(var m=this.getCrossCheckStateCount(),b=0,n=this.image;e>=b&&o>=b&&n.get(o-b,e-b);)m[2]++,b++;if(e<b||o<b)return!1;for(;e>=b&&o>=b&&!n.get(o-b,e-b)&&m[1]<=l;)m[1]++,b++;if(e<b||o<b||m[1]>l)return!1;for(;e>=b&&o>=b&&n.get(o-b,e-b)&&m[0]<=l;)m[0]++,b++;if(m[0]>l)return!1;var C=n.getHeight(),D=n.getWidth();for(b=1;e+b<C&&o+b<D&&n.get(o+b,e+b);)m[2]++,b++;if(e+b>=C||o+b>=D)return!1;for(;e+b<C&&o+b<D&&!n.get(o+b,e+b)&&m[3]<l;)m[3]++,b++;if(e+b>=C||o+b>=D||m[3]>=l)return!1;for(;e+b<C&&o+b<D&&n.get(o+b,e+b)&&m[4]<l;)m[4]++,b++;if(m[4]>=l)return!1;var L=m[0]+m[1]+m[2]+m[3]+m[4];return Math.abs(L-h)<2*h&&r.foundPatternCross(m)},r.prototype.crossCheckVertical=function(e,o,l,h){for(var m=this.image,b=m.getHeight(),n=this.getCrossCheckStateCount(),C=e;C>=0&&m.get(o,C);)n[2]++,C--;if(C<0)return NaN;for(;C>=0&&!m.get(o,C)&&n[1]<=l;)n[1]++,C--;if(C<0||n[1]>l)return NaN;for(;C>=0&&m.get(o,C)&&n[0]<=l;)n[0]++,C--;if(n[0]>l)return NaN;for(C=e+1;C<b&&m.get(o,C);)n[2]++,C++;if(C===b)return NaN;for(;C<b&&!m.get(o,C)&&n[3]<l;)n[3]++,C++;if(C===b||n[3]>=l)return NaN;for(;C<b&&m.get(o,C)&&n[4]<l;)n[4]++,C++;if(n[4]>=l)return NaN;var D=n[0]+n[1]+n[2]+n[3]+n[4];return 5*Math.abs(D-h)>=2*h?NaN:r.foundPatternCross(n)?r.centerFromEnd(n,C):NaN},r.prototype.crossCheckHorizontal=function(e,o,l,h){for(var m=this.image,b=m.getWidth(),n=this.getCrossCheckStateCount(),C=e;C>=0&&m.get(C,o);)n[2]++,C--;if(C<0)return NaN;for(;C>=0&&!m.get(C,o)&&n[1]<=l;)n[1]++,C--;if(C<0||n[1]>l)return NaN;for(;C>=0&&m.get(C,o)&&n[0]<=l;)n[0]++,C--;if(n[0]>l)return NaN;for(C=e+1;C<b&&m.get(C,o);)n[2]++,C++;if(C===b)return NaN;for(;C<b&&!m.get(C,o)&&n[3]<l;)n[3]++,C++;if(C===b||n[3]>=l)return NaN;for(;C<b&&m.get(C,o)&&n[4]<l;)n[4]++,C++;if(n[4]>=l)return NaN;var D=n[0]+n[1]+n[2]+n[3]+n[4];return 5*Math.abs(D-h)>=h?NaN:r.foundPatternCross(n)?r.centerFromEnd(n,C):NaN},r.prototype.handlePossibleCenter=function(e,o,l,h){var m=e[0]+e[1]+e[2]+e[3]+e[4],b=r.centerFromEnd(e,l),n=this.crossCheckVertical(o,Math.floor(b),e[2],m);if(!isNaN(n)&&(b=this.crossCheckHorizontal(Math.floor(b),Math.floor(n),e[2],m),!isNaN(b)&&(!h||this.crossCheckDiagonal(Math.floor(n),Math.floor(b),e[2],m)))){for(var C=m/7,D=!1,L=this.possibleCenters,U=0,q=L.length;U<q;U++){var Z=L[U];if(Z.aboutEquals(C,n,b)){L[U]=Z.combineEstimate(n,b,C),D=!0;break}}if(!D){var ie=new g7(b,n,C);L.push(ie),this.resultPointCallback!==null&&this.resultPointCallback!==void 0&&this.resultPointCallback.foundPossibleResultPoint(ie)}return!0}return!1},r.prototype.findRowSkip=function(){var e,o,l=this.possibleCenters.length;if(l<=1)return 0;var h=null;try{for(var m=K0(this.possibleCenters),b=m.next();!b.done;b=m.next()){var n=b.value;if(n.getCount()>=r.CENTER_QUORUM)if(h==null)h=n;else return this.hasSkipped=!0,Math.floor((Math.abs(h.getX()-n.getX())-Math.abs(h.getY()-n.getY()))/2)}}catch(C){e={error:C}}finally{try{b&&!b.done&&(o=m.return)&&o.call(m)}finally{if(e)throw e.error}}return 0},r.prototype.haveMultiplyConfirmedCenters=function(){var e,o,l,h,m=0,b=0,n=this.possibleCenters.length;try{for(var C=K0(this.possibleCenters),D=C.next();!D.done;D=C.next()){var L=D.value;L.getCount()>=r.CENTER_QUORUM&&(m++,b+=L.getEstimatedModuleSize())}}catch(ne){e={error:ne}}finally{try{D&&!D.done&&(o=C.return)&&o.call(C)}finally{if(e)throw e.error}}if(m<3)return!1;var U=b/n,q=0;try{for(var Z=K0(this.possibleCenters),ie=Z.next();!ie.done;ie=Z.next()){var L=ie.value;q+=Math.abs(L.getEstimatedModuleSize()-U)}}catch(ne){l={error:ne}}finally{try{ie&&!ie.done&&(h=Z.return)&&h.call(Z)}finally{if(l)throw l.error}}return q<=.05*b},r.prototype.selectBestPatterns=function(){var e,o,l,h,m=this.possibleCenters.length;if(m<3)throw new Xt;var b=this.possibleCenters,n;if(m>3){var C=0,D=0;try{for(var L=K0(this.possibleCenters),U=L.next();!U.done;U=L.next()){var q=U.value,Z=q.getEstimatedModuleSize();C+=Z,D+=Z*Z}}catch($e){e={error:$e}}finally{try{U&&!U.done&&(o=L.return)&&o.call(L)}finally{if(e)throw e.error}}n=C/m;var ie=Math.sqrt(D/m-n*n);b.sort(function($e,xt){var Ct=Math.abs(xt.getEstimatedModuleSize()-n),Ft=Math.abs($e.getEstimatedModuleSize()-n);return Ct<Ft?-1:Ct>Ft?1:0});for(var ne=Math.max(.2*n,ie),be=0;be<b.length&&b.length>3;be++){var ve=b[be];Math.abs(ve.getEstimatedModuleSize()-n)>ne&&(b.splice(be,1),be--)}}if(b.length>3){var C=0;try{for(var we=K0(b),Pe=we.next();!Pe.done;Pe=we.next()){var Ze=Pe.value;C+=Ze.getEstimatedModuleSize()}}catch(xt){l={error:xt}}finally{try{Pe&&!Pe.done&&(h=we.return)&&h.call(we)}finally{if(l)throw l.error}}n=C/b.length,b.sort(function(xt,Ct){if(Ct.getCount()===xt.getCount()){var Ft=Math.abs(Ct.getEstimatedModuleSize()-n),Yt=Math.abs(xt.getEstimatedModuleSize()-n);return Ft<Yt?1:Ft>Yt?-1:0}else return Ct.getCount()-xt.getCount()}),b.splice(3)}return[b[0],b[1],b[2]]},r.CENTER_QUORUM=2,r.MIN_SKIP=3,r.MAX_MODULES=57,r})(),v7=(function(){function r(e){this.image=e}return r.prototype.getImage=function(){return this.image},r.prototype.getResultPointCallback=function(){return this.resultPointCallback},r.prototype.detect=function(e){this.resultPointCallback=e==null?null:e.get(Io.NEED_RESULT_POINT_CALLBACK);var o=new y7(this.image,this.resultPointCallback),l=o.find(e);return this.processFinderPatternInfo(l)},r.prototype.processFinderPatternInfo=function(e){var o=e.getTopLeft(),l=e.getTopRight(),h=e.getBottomLeft(),m=this.calculateModuleSize(o,l,h);if(m<1)throw new Xt("No pattern found in proccess finder.");var b=r.computeDimension(o,l,h,m),n=wg.getProvisionalVersionForDimension(b),C=n.getDimensionForVersion()-7,D=null;if(n.getAlignmentPatternCenters().length>0)for(var L=l.getX()-o.getX()+h.getX(),U=l.getY()-o.getY()+h.getY(),q=1-3/C,Z=Math.floor(o.getX()+q*(L-o.getX())),ie=Math.floor(o.getY()+q*(U-o.getY())),ne=4;ne<=16;ne<<=1)try{D=this.findAlignmentInRegion(m,Z,ie,ne);break}catch(Pe){if(!(Pe instanceof Xt))throw Pe}var be=r.createTransform(o,l,h,D,b),ve=r.sampleGrid(this.image,be,b),we;return D===null?we=[h,o,l]:we=[h,o,l,D],new O2(ve,we)},r.createTransform=function(e,o,l,h,m){var b=m-3.5,n,C,D,L;return h!==null?(n=h.getX(),C=h.getY(),D=b-3,L=D):(n=o.getX()-e.getX()+l.getX(),C=o.getY()-e.getY()+l.getY(),D=b,L=b),PR.quadrilateralToQuadrilateral(3.5,3.5,b,3.5,D,L,3.5,b,e.getX(),e.getY(),o.getX(),o.getY(),n,C,l.getX(),l.getY())},r.sampleGrid=function(e,o,l){var h=P2.getInstance();return h.sampleGridWithTransform(e,l,l,o)},r.computeDimension=function(e,o,l,h){var m=zn.round(ti.distance(e,o)/h),b=zn.round(ti.distance(e,l)/h),n=Math.floor((m+b)/2)+7;switch(n&3){case 0:n++;break;case 2:n--;break;case 3:throw new Xt("Dimensions could be not found.")}return n},r.prototype.calculateModuleSize=function(e,o,l){return(this.calculateModuleSizeOneWay(e,o)+this.calculateModuleSizeOneWay(e,l))/2},r.prototype.calculateModuleSizeOneWay=function(e,o){var l=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(e.getX()),Math.floor(e.getY()),Math.floor(o.getX()),Math.floor(o.getY())),h=this.sizeOfBlackWhiteBlackRunBothWays(Math.floor(o.getX()),Math.floor(o.getY()),Math.floor(e.getX()),Math.floor(e.getY()));return isNaN(l)?h/7:isNaN(h)?l/7:(l+h)/14},r.prototype.sizeOfBlackWhiteBlackRunBothWays=function(e,o,l,h){var m=this.sizeOfBlackWhiteBlackRun(e,o,l,h),b=1,n=e-(l-e);n<0?(b=e/(e-n),n=0):n>=this.image.getWidth()&&(b=(this.image.getWidth()-1-e)/(n-e),n=this.image.getWidth()-1);var C=Math.floor(o-(h-o)*b);return b=1,C<0?(b=o/(o-C),C=0):C>=this.image.getHeight()&&(b=(this.image.getHeight()-1-o)/(C-o),C=this.image.getHeight()-1),n=Math.floor(e+(n-e)*b),m+=this.sizeOfBlackWhiteBlackRun(e,o,n,C),m-1},r.prototype.sizeOfBlackWhiteBlackRun=function(e,o,l,h){var m=Math.abs(h-o)>Math.abs(l-e);if(m){var b=e;e=o,o=b,b=l,l=h,h=b}for(var n=Math.abs(l-e),C=Math.abs(h-o),D=-n/2,L=e<l?1:-1,U=o<h?1:-1,q=0,Z=l+L,ie=e,ne=o;ie!==Z;ie+=L){var be=m?ne:ie,ve=m?ie:ne;if(q===1===this.image.get(be,ve)){if(q===2)return zn.distance(ie,ne,e,o);q++}if(D+=C,D>0){if(ne===h)break;ne+=U,D-=n}}return q===2?zn.distance(l+L,h,e,o):NaN},r.prototype.findAlignmentInRegion=function(e,o,l,h){var m=Math.floor(h*e),b=Math.max(0,o-m),n=Math.min(this.image.getWidth()-1,o+m);if(n-b<e*3)throw new Xt("Alignment top exceeds estimated module size.");var C=Math.max(0,l-m),D=Math.min(this.image.getHeight()-1,l+m);if(D-C<e*3)throw new Xt("Alignment bottom exceeds estimated module size.");var L=new p7(this.image,b,C,n-b,D-C,e,this.resultPointCallback);return L.find()},r})(),Iw=(function(){function r(){this.decoder=new u7}return r.prototype.getDecoder=function(){return this.decoder},r.prototype.decode=function(e,o){var l,h;if(o!=null&&o.get(Io.PURE_BARCODE)!==void 0){var m=r.extractPureBits(e.getBlackMatrix());l=this.decoder.decodeBitMatrix(m,o),h=r.NO_POINTS}else{var b=new v7(e.getBlackMatrix()).detect(o);l=this.decoder.decodeBitMatrix(b.getBits(),o),h=b.getPoints()}l.getOther()instanceof NR&&l.getOther().applyMirroredCorrection(h);var n=new Hs(l.getText(),l.getRawBytes(),void 0,h,yi.QR_CODE,void 0),C=l.getByteSegments();C!==null&&n.putMetadata(gs.BYTE_SEGMENTS,C);var D=l.getECLevel();return D!==null&&n.putMetadata(gs.ERROR_CORRECTION_LEVEL,D),l.hasStructuredAppend()&&(n.putMetadata(gs.STRUCTURED_APPEND_SEQUENCE,l.getStructuredAppendSequenceNumber()),n.putMetadata(gs.STRUCTURED_APPEND_PARITY,l.getStructuredAppendParity())),n},r.prototype.reset=function(){},r.extractPureBits=function(e){var o=e.getTopLeftOnBit(),l=e.getBottomRightOnBit();if(o===null||l===null)throw new Xt;var h=this.moduleSize(o,e),m=o[1],b=l[1],n=o[0],C=l[0];if(n>=C||m>=b)throw new Xt;if(b-m!==C-n&&(C=n+(b-m),C>=e.getWidth()))throw new Xt;var D=Math.round((C-n+1)/h),L=Math.round((b-m+1)/h);if(D<=0||L<=0)throw new Xt;if(L!==D)throw new Xt;var U=Math.floor(h/2);m+=U,n+=U;var q=n+Math.floor((D-1)*h)-C;if(q>0){if(q>U)throw new Xt;n-=q}var Z=m+Math.floor((L-1)*h)-b;if(Z>0){if(Z>U)throw new Xt;m-=Z}for(var ie=new If(D,L),ne=0;ne<L;ne++)for(var be=m+Math.floor(ne*h),ve=0;ve<D;ve++)e.get(n+Math.floor(ve*h),be)&&ie.set(ve,ne);return ie},r.moduleSize=function(e,o){for(var l=o.getHeight(),h=o.getWidth(),m=e[0],b=e[1],n=!0,C=0;m<h&&b<l;){if(n!==o.get(m,b)){if(++C===5)break;n=!n}m++,b++}if(m===h||b===l)throw new Xt;return(m-e[0])/7},r.NO_POINTS=new Array,r})(),x7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Dn=(function(){function r(){}return r.prototype.PDF417Common=function(){},r.getBitCountSum=function(e){return zn.sum(e)},r.toIntArray=function(e){var o,l;if(e==null||!e.length)return r.EMPTY_INT_ARRAY;var h=new Int32Array(e.length),m=0;try{for(var b=x7(e),n=b.next();!n.done;n=b.next()){var C=n.value;h[m++]=C}}catch(D){o={error:D}}finally{try{n&&!n.done&&(l=b.return)&&l.call(b)}finally{if(o)throw o.error}}return h},r.getCodeword=function(e){var o=ka.binarySearch(r.SYMBOL_TABLE,e&262143);return o<0?-1:(r.CODEWORD_TABLE[o]-1)%r.NUMBER_OF_CODEWORDS},r.NUMBER_OF_CODEWORDS=929,r.MAX_CODEWORDS_IN_BARCODE=r.NUMBER_OF_CODEWORDS-1,r.MIN_ROWS_IN_BARCODE=3,r.MAX_ROWS_IN_BARCODE=90,r.MODULES_IN_CODEWORD=17,r.MODULES_IN_STOP_PATTERN=18,r.BARS_IN_MODULE=8,r.EMPTY_INT_ARRAY=new Int32Array([]),r.SYMBOL_TABLE=Int32Array.from([66142,66170,66206,66236,66290,66292,66350,66382,66396,66454,66470,66476,66594,66600,66614,66626,66628,66632,66640,66654,66662,66668,66682,66690,66718,66720,66748,66758,66776,66798,66802,66804,66820,66824,66832,66846,66848,66876,66880,66936,66950,66956,66968,66992,67006,67022,67036,67042,67044,67048,67062,67118,67150,67164,67214,67228,67256,67294,67322,67350,67366,67372,67398,67404,67416,67438,67474,67476,67490,67492,67496,67510,67618,67624,67650,67656,67664,67678,67686,67692,67706,67714,67716,67728,67742,67744,67772,67782,67788,67800,67822,67826,67828,67842,67848,67870,67872,67900,67904,67960,67974,67992,68016,68030,68046,68060,68066,68068,68072,68086,68104,68112,68126,68128,68156,68160,68216,68336,68358,68364,68376,68400,68414,68448,68476,68494,68508,68536,68546,68548,68552,68560,68574,68582,68588,68654,68686,68700,68706,68708,68712,68726,68750,68764,68792,68802,68804,68808,68816,68830,68838,68844,68858,68878,68892,68920,68976,68990,68994,68996,69e3,69008,69022,69024,69052,69062,69068,69080,69102,69106,69108,69142,69158,69164,69190,69208,69230,69254,69260,69272,69296,69310,69326,69340,69386,69394,69396,69410,69416,69430,69442,69444,69448,69456,69470,69478,69484,69554,69556,69666,69672,69698,69704,69712,69726,69754,69762,69764,69776,69790,69792,69820,69830,69836,69848,69870,69874,69876,69890,69918,69920,69948,69952,70008,70022,70040,70064,70078,70094,70108,70114,70116,70120,70134,70152,70174,70176,70264,70384,70412,70448,70462,70496,70524,70542,70556,70584,70594,70600,70608,70622,70630,70636,70664,70672,70686,70688,70716,70720,70776,70896,71136,71180,71192,71216,71230,71264,71292,71360,71416,71452,71480,71536,71550,71554,71556,71560,71568,71582,71584,71612,71622,71628,71640,71662,71726,71732,71758,71772,71778,71780,71784,71798,71822,71836,71864,71874,71880,71888,71902,71910,71916,71930,71950,71964,71992,72048,72062,72066,72068,72080,72094,72096,72124,72134,72140,72152,72174,72178,72180,72206,72220,72248,72304,72318,72416,72444,72456,72464,72478,72480,72508,72512,72568,72588,72600,72624,72638,72654,72668,72674,72676,72680,72694,72726,72742,72748,72774,72780,72792,72814,72838,72856,72880,72894,72910,72924,72930,72932,72936,72950,72966,72972,72984,73008,73022,73056,73084,73102,73116,73144,73156,73160,73168,73182,73190,73196,73210,73226,73234,73236,73250,73252,73256,73270,73282,73284,73296,73310,73318,73324,73346,73348,73352,73360,73374,73376,73404,73414,73420,73432,73454,73498,73518,73522,73524,73550,73564,73570,73572,73576,73590,73800,73822,73858,73860,73872,73886,73888,73916,73944,73970,73972,73992,74014,74016,74044,74048,74104,74118,74136,74160,74174,74210,74212,74216,74230,74244,74256,74270,74272,74360,74480,74502,74508,74544,74558,74592,74620,74638,74652,74680,74690,74696,74704,74726,74732,74782,74784,74812,74992,75232,75288,75326,75360,75388,75456,75512,75576,75632,75646,75650,75652,75664,75678,75680,75708,75718,75724,75736,75758,75808,75836,75840,75896,76016,76256,76736,76824,76848,76862,76896,76924,76992,77048,77296,77340,77368,77424,77438,77536,77564,77572,77576,77584,77600,77628,77632,77688,77702,77708,77720,77744,77758,77774,77788,77870,77902,77916,77922,77928,77966,77980,78008,78018,78024,78032,78046,78060,78074,78094,78136,78192,78206,78210,78212,78224,78238,78240,78268,78278,78284,78296,78322,78324,78350,78364,78448,78462,78560,78588,78600,78622,78624,78652,78656,78712,78726,78744,78768,78782,78798,78812,78818,78820,78824,78838,78862,78876,78904,78960,78974,79072,79100,79296,79352,79368,79376,79390,79392,79420,79424,79480,79600,79628,79640,79664,79678,79712,79740,79772,79800,79810,79812,79816,79824,79838,79846,79852,79894,79910,79916,79942,79948,79960,79982,79988,80006,80024,80048,80062,80078,80092,80098,80100,80104,80134,80140,80176,80190,80224,80252,80270,80284,80312,80328,80336,80350,80358,80364,80378,80390,80396,80408,80432,80446,80480,80508,80576,80632,80654,80668,80696,80752,80766,80776,80784,80798,80800,80828,80844,80856,80878,80882,80884,80914,80916,80930,80932,80936,80950,80962,80968,80976,80990,80998,81004,81026,81028,81040,81054,81056,81084,81094,81100,81112,81134,81154,81156,81160,81168,81182,81184,81212,81216,81272,81286,81292,81304,81328,81342,81358,81372,81380,81384,81398,81434,81454,81458,81460,81486,81500,81506,81508,81512,81526,81550,81564,81592,81602,81604,81608,81616,81630,81638,81644,81702,81708,81722,81734,81740,81752,81774,81778,81780,82050,82078,82080,82108,82180,82184,82192,82206,82208,82236,82240,82296,82316,82328,82352,82366,82402,82404,82408,82440,82448,82462,82464,82492,82496,82552,82672,82694,82700,82712,82736,82750,82784,82812,82830,82882,82884,82888,82896,82918,82924,82952,82960,82974,82976,83004,83008,83064,83184,83424,83468,83480,83504,83518,83552,83580,83648,83704,83740,83768,83824,83838,83842,83844,83848,83856,83872,83900,83910,83916,83928,83950,83984,84e3,84028,84032,84088,84208,84448,84928,85040,85054,85088,85116,85184,85240,85488,85560,85616,85630,85728,85756,85764,85768,85776,85790,85792,85820,85824,85880,85894,85900,85912,85936,85966,85980,86048,86080,86136,86256,86496,86976,88160,88188,88256,88312,88560,89056,89200,89214,89312,89340,89536,89592,89608,89616,89632,89664,89720,89840,89868,89880,89904,89952,89980,89998,90012,90040,90190,90204,90254,90268,90296,90306,90308,90312,90334,90382,90396,90424,90480,90494,90500,90504,90512,90526,90528,90556,90566,90572,90584,90610,90612,90638,90652,90680,90736,90750,90848,90876,90884,90888,90896,90910,90912,90940,90944,91e3,91014,91020,91032,91056,91070,91086,91100,91106,91108,91112,91126,91150,91164,91192,91248,91262,91360,91388,91584,91640,91664,91678,91680,91708,91712,91768,91888,91928,91952,91966,92e3,92028,92046,92060,92088,92098,92100,92104,92112,92126,92134,92140,92188,92216,92272,92384,92412,92608,92664,93168,93200,93214,93216,93244,93248,93304,93424,93664,93720,93744,93758,93792,93820,93888,93944,93980,94008,94064,94078,94084,94088,94096,94110,94112,94140,94150,94156,94168,94246,94252,94278,94284,94296,94318,94342,94348,94360,94384,94398,94414,94428,94440,94470,94476,94488,94512,94526,94560,94588,94606,94620,94648,94658,94660,94664,94672,94686,94694,94700,94714,94726,94732,94744,94768,94782,94816,94844,94912,94968,94990,95004,95032,95088,95102,95112,95120,95134,95136,95164,95180,95192,95214,95218,95220,95244,95256,95280,95294,95328,95356,95424,95480,95728,95758,95772,95800,95856,95870,95968,95996,96008,96016,96030,96032,96060,96064,96120,96152,96176,96190,96220,96226,96228,96232,96290,96292,96296,96310,96322,96324,96328,96336,96350,96358,96364,96386,96388,96392,96400,96414,96416,96444,96454,96460,96472,96494,96498,96500,96514,96516,96520,96528,96542,96544,96572,96576,96632,96646,96652,96664,96688,96702,96718,96732,96738,96740,96744,96758,96772,96776,96784,96798,96800,96828,96832,96888,97008,97030,97036,97048,97072,97086,97120,97148,97166,97180,97208,97220,97224,97232,97246,97254,97260,97326,97330,97332,97358,97372,97378,97380,97384,97398,97422,97436,97464,97474,97476,97480,97488,97502,97510,97516,97550,97564,97592,97648,97666,97668,97672,97680,97694,97696,97724,97734,97740,97752,97774,97830,97836,97850,97862,97868,97880,97902,97906,97908,97926,97932,97944,97968,97998,98012,98018,98020,98024,98038,98618,98674,98676,98838,98854,98874,98892,98904,98926,98930,98932,98968,99006,99042,99044,99048,99062,99166,99194,99246,99286,99350,99366,99372,99386,99398,99416,99438,99442,99444,99462,99504,99518,99534,99548,99554,99556,99560,99574,99590,99596,99608,99632,99646,99680,99708,99726,99740,99768,99778,99780,99784,99792,99806,99814,99820,99834,99858,99860,99874,99880,99894,99906,99920,99934,99962,99970,99972,99976,99984,99998,1e5,100028,100038,100044,100056,100078,100082,100084,100142,100174,100188,100246,100262,100268,100306,100308,100390,100396,100410,100422,100428,100440,100462,100466,100468,100486,100504,100528,100542,100558,100572,100578,100580,100584,100598,100620,100656,100670,100704,100732,100750,100792,100802,100808,100816,100830,100838,100844,100858,100888,100912,100926,100960,100988,101056,101112,101148,101176,101232,101246,101250,101252,101256,101264,101278,101280,101308,101318,101324,101336,101358,101362,101364,101410,101412,101416,101430,101442,101448,101456,101470,101478,101498,101506,101508,101520,101534,101536,101564,101580,101618,101620,101636,101640,101648,101662,101664,101692,101696,101752,101766,101784,101838,101858,101860,101864,101934,101938,101940,101966,101980,101986,101988,101992,102030,102044,102072,102082,102084,102088,102096,102138,102166,102182,102188,102214,102220,102232,102254,102282,102290,102292,102306,102308,102312,102326,102444,102458,102470,102476,102488,102514,102516,102534,102552,102576,102590,102606,102620,102626,102632,102646,102662,102668,102704,102718,102752,102780,102798,102812,102840,102850,102856,102864,102878,102886,102892,102906,102936,102974,103008,103036,103104,103160,103224,103280,103294,103298,103300,103312,103326,103328,103356,103366,103372,103384,103406,103410,103412,103472,103486,103520,103548,103616,103672,103920,103992,104048,104062,104160,104188,104194,104196,104200,104208,104224,104252,104256,104312,104326,104332,104344,104368,104382,104398,104412,104418,104420,104424,104482,104484,104514,104520,104528,104542,104550,104570,104578,104580,104592,104606,104608,104636,104652,104690,104692,104706,104712,104734,104736,104764,104768,104824,104838,104856,104910,104930,104932,104936,104968,104976,104990,104992,105020,105024,105080,105200,105240,105278,105312,105372,105410,105412,105416,105424,105446,105518,105524,105550,105564,105570,105572,105576,105614,105628,105656,105666,105672,105680,105702,105722,105742,105756,105784,105840,105854,105858,105860,105864,105872,105888,105932,105970,105972,106006,106022,106028,106054,106060,106072,106100,106118,106124,106136,106160,106174,106190,106210,106212,106216,106250,106258,106260,106274,106276,106280,106306,106308,106312,106320,106334,106348,106394,106414,106418,106420,106566,106572,106610,106612,106630,106636,106648,106672,106686,106722,106724,106728,106742,106758,106764,106776,106800,106814,106848,106876,106894,106908,106936,106946,106948,106952,106960,106974,106982,106988,107032,107056,107070,107104,107132,107200,107256,107292,107320,107376,107390,107394,107396,107400,107408,107422,107424,107452,107462,107468,107480,107502,107506,107508,107544,107568,107582,107616,107644,107712,107768,108016,108060,108088,108144,108158,108256,108284,108290,108292,108296,108304,108318,108320,108348,108352,108408,108422,108428,108440,108464,108478,108494,108508,108514,108516,108520,108592,108640,108668,108736,108792,109040,109536,109680,109694,109792,109820,110016,110072,110084,110088,110096,110112,110140,110144,110200,110320,110342,110348,110360,110384,110398,110432,110460,110478,110492,110520,110532,110536,110544,110558,110658,110686,110714,110722,110724,110728,110736,110750,110752,110780,110796,110834,110836,110850,110852,110856,110864,110878,110880,110908,110912,110968,110982,111e3,111054,111074,111076,111080,111108,111112,111120,111134,111136,111164,111168,111224,111344,111372,111422,111456,111516,111554,111556,111560,111568,111590,111632,111646,111648,111676,111680,111736,111856,112096,112152,112224,112252,112320,112440,112514,112516,112520,112528,112542,112544,112588,112686,112718,112732,112782,112796,112824,112834,112836,112840,112848,112870,112890,112910,112924,112952,113008,113022,113026,113028,113032,113040,113054,113056,113100,113138,113140,113166,113180,113208,113264,113278,113376,113404,113416,113424,113440,113468,113472,113560,113614,113634,113636,113640,113686,113702,113708,113734,113740,113752,113778,113780,113798,113804,113816,113840,113854,113870,113890,113892,113896,113926,113932,113944,113968,113982,114016,114044,114076,114114,114116,114120,114128,114150,114170,114194,114196,114210,114212,114216,114242,114244,114248,114256,114270,114278,114306,114308,114312,114320,114334,114336,114364,114380,114420,114458,114478,114482,114484,114510,114524,114530,114532,114536,114842,114866,114868,114970,114994,114996,115042,115044,115048,115062,115130,115226,115250,115252,115278,115292,115298,115300,115304,115318,115342,115394,115396,115400,115408,115422,115430,115436,115450,115478,115494,115514,115526,115532,115570,115572,115738,115758,115762,115764,115790,115804,115810,115812,115816,115830,115854,115868,115896,115906,115912,115920,115934,115942,115948,115962,115996,116024,116080,116094,116098,116100,116104,116112,116126,116128,116156,116166,116172,116184,116206,116210,116212,116246,116262,116268,116282,116294,116300,116312,116334,116338,116340,116358,116364,116376,116400,116414,116430,116444,116450,116452,116456,116498,116500,116514,116520,116534,116546,116548,116552,116560,116574,116582,116588,116602,116654,116694,116714,116762,116782,116786,116788,116814,116828,116834,116836,116840,116854,116878,116892,116920,116930,116936,116944,116958,116966,116972,116986,117006,117048,117104,117118,117122,117124,117136,117150,117152,117180,117190,117196,117208,117230,117234,117236,117304,117360,117374,117472,117500,117506,117508,117512,117520,117536,117564,117568,117624,117638,117644,117656,117680,117694,117710,117724,117730,117732,117736,117750,117782,117798,117804,117818,117830,117848,117874,117876,117894,117936,117950,117966,117986,117988,117992,118022,118028,118040,118064,118078,118112,118140,118172,118210,118212,118216,118224,118238,118246,118266,118306,118312,118338,118352,118366,118374,118394,118402,118404,118408,118416,118430,118432,118460,118476,118514,118516,118574,118578,118580,118606,118620,118626,118628,118632,118678,118694,118700,118730,118738,118740,118830,118834,118836,118862,118876,118882,118884,118888,118902,118926,118940,118968,118978,118980,118984,118992,119006,119014,119020,119034,119068,119096,119152,119166,119170,119172,119176,119184,119198,119200,119228,119238,119244,119256,119278,119282,119284,119324,119352,119408,119422,119520,119548,119554,119556,119560,119568,119582,119584,119612,119616,119672,119686,119692,119704,119728,119742,119758,119772,119778,119780,119784,119798,119920,119934,120032,120060,120256,120312,120324,120328,120336,120352,120384,120440,120560,120582,120588,120600,120624,120638,120672,120700,120718,120732,120760,120770,120772,120776,120784,120798,120806,120812,120870,120876,120890,120902,120908,120920,120946,120948,120966,120972,120984,121008,121022,121038,121058,121060,121064,121078,121100,121112,121136,121150,121184,121212,121244,121282,121284,121288,121296,121318,121338,121356,121368,121392,121406,121440,121468,121536,121592,121656,121730,121732,121736,121744,121758,121760,121804,121842,121844,121890,121922,121924,121928,121936,121950,121958,121978,121986,121988,121992,122e3,122014,122016,122044,122060,122098,122100,122116,122120,122128,122142,122144,122172,122176,122232,122246,122264,122318,122338,122340,122344,122414,122418,122420,122446,122460,122466,122468,122472,122510,122524,122552,122562,122564,122568,122576,122598,122618,122646,122662,122668,122694,122700,122712,122738,122740,122762,122770,122772,122786,122788,122792,123018,123026,123028,123042,123044,123048,123062,123098,123146,123154,123156,123170,123172,123176,123190,123202,123204,123208,123216,123238,123244,123258,123290,123314,123316,123402,123410,123412,123426,123428,123432,123446,123458,123464,123472,123486,123494,123500,123514,123522,123524,123528,123536,123552,123580,123590,123596,123608,123630,123634,123636,123674,123698,123700,123740,123746,123748,123752,123834,123914,123922,123924,123938,123944,123958,123970,123976,123984,123998,124006,124012,124026,124034,124036,124048,124062,124064,124092,124102,124108,124120,124142,124146,124148,124162,124164,124168,124176,124190,124192,124220,124224,124280,124294,124300,124312,124336,124350,124366,124380,124386,124388,124392,124406,124442,124462,124466,124468,124494,124508,124514,124520,124558,124572,124600,124610,124612,124616,124624,124646,124666,124694,124710,124716,124730,124742,124748,124760,124786,124788,124818,124820,124834,124836,124840,124854,124946,124948,124962,124964,124968,124982,124994,124996,125e3,125008,125022,125030,125036,125050,125058,125060,125064,125072,125086,125088,125116,125126,125132,125144,125166,125170,125172,125186,125188,125192,125200,125216,125244,125248,125304,125318,125324,125336,125360,125374,125390,125404,125410,125412,125416,125430,125444,125448,125456,125472,125504,125560,125680,125702,125708,125720,125744,125758,125792,125820,125838,125852,125880,125890,125892,125896,125904,125918,125926,125932,125978,125998,126002,126004,126030,126044,126050,126052,126056,126094,126108,126136,126146,126148,126152,126160,126182,126202,126222,126236,126264,126320,126334,126338,126340,126344,126352,126366,126368,126412,126450,126452,126486,126502,126508,126522,126534,126540,126552,126574,126578,126580,126598,126604,126616,126640,126654,126670,126684,126690,126692,126696,126738,126754,126756,126760,126774,126786,126788,126792,126800,126814,126822,126828,126842,126894,126898,126900,126934,127126,127142,127148,127162,127178,127186,127188,127254,127270,127276,127290,127302,127308,127320,127342,127346,127348,127370,127378,127380,127394,127396,127400,127450,127510,127526,127532,127546,127558,127576,127598,127602,127604,127622,127628,127640,127664,127678,127694,127708,127714,127716,127720,127734,127754,127762,127764,127778,127784,127810,127812,127816,127824,127838,127846,127866,127898,127918,127922,127924,128022,128038,128044,128058,128070,128076,128088,128110,128114,128116,128134,128140,128152,128176,128190,128206,128220,128226,128228,128232,128246,128262,128268,128280,128304,128318,128352,128380,128398,128412,128440,128450,128452,128456,128464,128478,128486,128492,128506,128522,128530,128532,128546,128548,128552,128566,128578,128580,128584,128592,128606,128614,128634,128642,128644,128648,128656,128670,128672,128700,128716,128754,128756,128794,128814,128818,128820,128846,128860,128866,128868,128872,128886,128918,128934,128940,128954,128978,128980,129178,129198,129202,129204,129238,129258,129306,129326,129330,129332,129358,129372,129378,129380,129384,129398,129430,129446,129452,129466,129482,129490,129492,129562,129582,129586,129588,129614,129628,129634,129636,129640,129654,129678,129692,129720,129730,129732,129736,129744,129758,129766,129772,129814,129830,129836,129850,129862,129868,129880,129902,129906,129908,129930,129938,129940,129954,129956,129960,129974,130010]),r.CODEWORD_TABLE=Int32Array.from([2627,1819,2622,2621,1813,1812,2729,2724,2723,2779,2774,2773,902,896,908,868,865,861,859,2511,873,871,1780,835,2493,825,2491,842,837,844,1764,1762,811,810,809,2483,807,2482,806,2480,815,814,813,812,2484,817,816,1745,1744,1742,1746,2655,2637,2635,2626,2625,2623,2628,1820,2752,2739,2737,2728,2727,2725,2730,2785,2783,2778,2777,2775,2780,787,781,747,739,736,2413,754,752,1719,692,689,681,2371,678,2369,700,697,694,703,1688,1686,642,638,2343,631,2341,627,2338,651,646,643,2345,654,652,1652,1650,1647,1654,601,599,2322,596,2321,594,2319,2317,611,610,608,606,2324,603,2323,615,614,612,1617,1616,1614,1612,616,1619,1618,2575,2538,2536,905,901,898,909,2509,2507,2504,870,867,864,860,2512,875,872,1781,2490,2489,2487,2485,1748,836,834,832,830,2494,827,2492,843,841,839,845,1765,1763,2701,2676,2674,2653,2648,2656,2634,2633,2631,2629,1821,2638,2636,2770,2763,2761,2750,2745,2753,2736,2735,2733,2731,1848,2740,2738,2786,2784,591,588,576,569,566,2296,1590,537,534,526,2276,522,2274,545,542,539,548,1572,1570,481,2245,466,2242,462,2239,492,485,482,2249,496,494,1534,1531,1528,1538,413,2196,406,2191,2188,425,419,2202,415,2199,432,430,427,1472,1467,1464,433,1476,1474,368,367,2160,365,2159,362,2157,2155,2152,378,377,375,2166,372,2165,369,2162,383,381,379,2168,1419,1418,1416,1414,385,1411,384,1423,1422,1420,1424,2461,802,2441,2439,790,786,783,794,2409,2406,2403,750,742,738,2414,756,753,1720,2367,2365,2362,2359,1663,693,691,684,2373,680,2370,702,699,696,704,1690,1687,2337,2336,2334,2332,1624,2329,1622,640,637,2344,634,2342,630,2340,650,648,645,2346,655,653,1653,1651,1649,1655,2612,2597,2595,2571,2568,2565,2576,2534,2529,2526,1787,2540,2537,907,904,900,910,2503,2502,2500,2498,1768,2495,1767,2510,2508,2506,869,866,863,2513,876,874,1782,2720,2713,2711,2697,2694,2691,2702,2672,2670,2664,1828,2678,2675,2647,2646,2644,2642,1823,2639,1822,2654,2652,2650,2657,2771,1855,2765,2762,1850,1849,2751,2749,2747,2754,353,2148,344,342,336,2142,332,2140,345,1375,1373,306,2130,299,2128,295,2125,319,314,311,2132,1354,1352,1349,1356,262,257,2101,253,2096,2093,274,273,267,2107,263,2104,280,278,275,1316,1311,1308,1320,1318,2052,202,2050,2044,2040,219,2063,212,2060,208,2055,224,221,2066,1260,1258,1252,231,1248,229,1266,1264,1261,1268,155,1998,153,1996,1994,1991,1988,165,164,2007,162,2006,159,2003,2e3,172,171,169,2012,166,2010,1186,1184,1182,1179,175,1176,173,1192,1191,1189,1187,176,1194,1193,2313,2307,2305,592,589,2294,2292,2289,578,572,568,2297,580,1591,2272,2267,2264,1547,538,536,529,2278,525,2275,547,544,541,1574,1571,2237,2235,2229,1493,2225,1489,478,2247,470,2244,465,2241,493,488,484,2250,498,495,1536,1533,1530,1539,2187,2186,2184,2182,1432,2179,1430,2176,1427,414,412,2197,409,2195,405,2193,2190,426,424,421,2203,418,2201,431,429,1473,1471,1469,1466,434,1477,1475,2478,2472,2470,2459,2457,2454,2462,803,2437,2432,2429,1726,2443,2440,792,789,785,2401,2399,2393,1702,2389,1699,2411,2408,2405,745,741,2415,758,755,1721,2358,2357,2355,2353,1661,2350,1660,2347,1657,2368,2366,2364,2361,1666,690,687,2374,683,2372,701,698,705,1691,1689,2619,2617,2610,2608,2605,2613,2593,2588,2585,1803,2599,2596,2563,2561,2555,1797,2551,1795,2573,2570,2567,2577,2525,2524,2522,2520,1786,2517,1785,2514,1783,2535,2533,2531,2528,1788,2541,2539,906,903,911,2721,1844,2715,2712,1838,1836,2699,2696,2693,2703,1827,1826,1824,2673,2671,2669,2666,1829,2679,2677,1858,1857,2772,1854,1853,1851,1856,2766,2764,143,1987,139,1986,135,133,131,1984,128,1983,125,1981,138,137,136,1985,1133,1132,1130,112,110,1974,107,1973,104,1971,1969,122,121,119,117,1977,114,1976,124,1115,1114,1112,1110,1117,1116,84,83,1953,81,1952,78,1950,1948,1945,94,93,91,1959,88,1958,85,1955,99,97,95,1961,1086,1085,1083,1081,1078,100,1090,1089,1087,1091,49,47,1917,44,1915,1913,1910,1907,59,1926,56,1925,53,1922,1919,66,64,1931,61,1929,1042,1040,1038,71,1035,70,1032,68,1048,1047,1045,1043,1050,1049,12,10,1869,1867,1864,1861,21,1880,19,1877,1874,1871,28,1888,25,1886,22,1883,982,980,977,974,32,30,991,989,987,984,34,995,994,992,2151,2150,2147,2146,2144,356,355,354,2149,2139,2138,2136,2134,1359,343,341,338,2143,335,2141,348,347,346,1376,1374,2124,2123,2121,2119,1326,2116,1324,310,308,305,2131,302,2129,298,2127,320,318,316,313,2133,322,321,1355,1353,1351,1357,2092,2091,2089,2087,1276,2084,1274,2081,1271,259,2102,256,2100,252,2098,2095,272,269,2108,266,2106,281,279,277,1317,1315,1313,1310,282,1321,1319,2039,2037,2035,2032,1203,2029,1200,1197,207,2053,205,2051,201,2049,2046,2043,220,218,2064,215,2062,211,2059,228,226,223,2069,1259,1257,1254,232,1251,230,1267,1265,1263,2316,2315,2312,2311,2309,2314,2304,2303,2301,2299,1593,2308,2306,590,2288,2287,2285,2283,1578,2280,1577,2295,2293,2291,579,577,574,571,2298,582,581,1592,2263,2262,2260,2258,1545,2255,1544,2252,1541,2273,2271,2269,2266,1550,535,532,2279,528,2277,546,543,549,1575,1573,2224,2222,2220,1486,2217,1485,2214,1482,1479,2238,2236,2234,2231,1496,2228,1492,480,477,2248,473,2246,469,2243,490,487,2251,497,1537,1535,1532,2477,2476,2474,2479,2469,2468,2466,2464,1730,2473,2471,2453,2452,2450,2448,1729,2445,1728,2460,2458,2456,2463,805,804,2428,2427,2425,2423,1725,2420,1724,2417,1722,2438,2436,2434,2431,1727,2444,2442,793,791,788,795,2388,2386,2384,1697,2381,1696,2378,1694,1692,2402,2400,2398,2395,1703,2392,1701,2412,2410,2407,751,748,744,2416,759,757,1807,2620,2618,1806,1805,2611,2609,2607,2614,1802,1801,1799,2594,2592,2590,2587,1804,2600,2598,1794,1793,1791,1789,2564,2562,2560,2557,1798,2554,1796,2574,2572,2569,2578,1847,1846,2722,1843,1842,1840,1845,2716,2714,1835,1834,1832,1830,1839,1837,2700,2698,2695,2704,1817,1811,1810,897,862,1777,829,826,838,1760,1758,808,2481,1741,1740,1738,1743,2624,1818,2726,2776,782,740,737,1715,686,679,695,1682,1680,639,628,2339,647,644,1645,1643,1640,1648,602,600,597,595,2320,593,2318,609,607,604,1611,1610,1608,1606,613,1615,1613,2328,926,924,892,886,899,857,850,2505,1778,824,823,821,819,2488,818,2486,833,831,828,840,1761,1759,2649,2632,2630,2746,2734,2732,2782,2781,570,567,1587,531,527,523,540,1566,1564,476,467,463,2240,486,483,1524,1521,1518,1529,411,403,2192,399,2189,423,416,1462,1457,1454,428,1468,1465,2210,366,363,2158,360,2156,357,2153,376,373,370,2163,1410,1409,1407,1405,382,1402,380,1417,1415,1412,1421,2175,2174,777,774,771,784,732,725,722,2404,743,1716,676,674,668,2363,665,2360,685,1684,1681,626,624,622,2335,620,2333,617,2330,641,635,649,1646,1644,1642,2566,928,925,2530,2527,894,891,888,2501,2499,2496,858,856,854,851,1779,2692,2668,2665,2645,2643,2640,2651,2768,2759,2757,2744,2743,2741,2748,352,1382,340,337,333,1371,1369,307,300,296,2126,315,312,1347,1342,1350,261,258,250,2097,246,2094,271,268,264,1306,1301,1298,276,1312,1309,2115,203,2048,195,2045,191,2041,213,209,2056,1246,1244,1238,225,1234,222,1256,1253,1249,1262,2080,2079,154,1997,150,1995,147,1992,1989,163,160,2004,156,2001,1175,1174,1172,1170,1167,170,1164,167,1185,1183,1180,1177,174,1190,1188,2025,2024,2022,587,586,564,559,556,2290,573,1588,520,518,512,2268,508,2265,530,1568,1565,461,457,2233,450,2230,446,2226,479,471,489,1526,1523,1520,397,395,2185,392,2183,389,2180,2177,410,2194,402,422,1463,1461,1459,1456,1470,2455,799,2433,2430,779,776,773,2397,2394,2390,734,728,724,746,1717,2356,2354,2351,2348,1658,677,675,673,670,667,688,1685,1683,2606,2589,2586,2559,2556,2552,927,2523,2521,2518,2515,1784,2532,895,893,890,2718,2709,2707,2689,2687,2684,2663,2662,2660,2658,1825,2667,2769,1852,2760,2758,142,141,1139,1138,134,132,129,126,1982,1129,1128,1126,1131,113,111,108,105,1972,101,1970,120,118,115,1109,1108,1106,1104,123,1113,1111,82,79,1951,75,1949,72,1946,92,89,86,1956,1077,1076,1074,1072,98,1069,96,1084,1082,1079,1088,1968,1967,48,45,1916,42,1914,39,1911,1908,60,57,54,1923,50,1920,1031,1030,1028,1026,67,1023,65,1020,62,1041,1039,1036,1033,69,1046,1044,1944,1943,1941,11,9,1868,7,1865,1862,1859,20,1878,16,1875,13,1872,970,968,966,963,29,960,26,23,983,981,978,975,33,971,31,990,988,985,1906,1904,1902,993,351,2145,1383,331,330,328,326,2137,323,2135,339,1372,1370,294,293,291,289,2122,286,2120,283,2117,309,303,317,1348,1346,1344,245,244,242,2090,239,2088,236,2085,2082,260,2099,249,270,1307,1305,1303,1300,1314,189,2038,186,2036,183,2033,2030,2026,206,198,2047,194,216,1247,1245,1243,1240,227,1237,1255,2310,2302,2300,2286,2284,2281,565,563,561,558,575,1589,2261,2259,2256,2253,1542,521,519,517,514,2270,511,533,1569,1567,2223,2221,2218,2215,1483,2211,1480,459,456,453,2232,449,474,491,1527,1525,1522,2475,2467,2465,2451,2449,2446,801,800,2426,2424,2421,2418,1723,2435,780,778,775,2387,2385,2382,2379,1695,2375,1693,2396,735,733,730,727,749,1718,2616,2615,2604,2603,2601,2584,2583,2581,2579,1800,2591,2550,2549,2547,2545,1792,2542,1790,2558,929,2719,1841,2710,2708,1833,1831,2690,2688,2686,1815,1809,1808,1774,1756,1754,1737,1736,1734,1739,1816,1711,1676,1674,633,629,1638,1636,1633,1641,598,1605,1604,1602,1600,605,1609,1607,2327,887,853,1775,822,820,1757,1755,1584,524,1560,1558,468,464,1514,1511,1508,1519,408,404,400,1452,1447,1444,417,1458,1455,2208,364,361,358,2154,1401,1400,1398,1396,374,1393,371,1408,1406,1403,1413,2173,2172,772,726,723,1712,672,669,666,682,1678,1675,625,623,621,618,2331,636,632,1639,1637,1635,920,918,884,880,889,849,848,847,846,2497,855,852,1776,2641,2742,2787,1380,334,1367,1365,301,297,1340,1338,1335,1343,255,251,247,1296,1291,1288,265,1302,1299,2113,204,196,192,2042,1232,1230,1224,214,1220,210,1242,1239,1235,1250,2077,2075,151,148,1993,144,1990,1163,1162,1160,1158,1155,161,1152,157,1173,1171,1168,1165,168,1181,1178,2021,2020,2018,2023,585,560,557,1585,516,509,1562,1559,458,447,2227,472,1516,1513,1510,398,396,393,390,2181,386,2178,407,1453,1451,1449,1446,420,1460,2209,769,764,720,712,2391,729,1713,664,663,661,659,2352,656,2349,671,1679,1677,2553,922,919,2519,2516,885,883,881,2685,2661,2659,2767,2756,2755,140,1137,1136,130,127,1125,1124,1122,1127,109,106,102,1103,1102,1100,1098,116,1107,1105,1980,80,76,73,1947,1068,1067,1065,1063,90,1060,87,1075,1073,1070,1080,1966,1965,46,43,40,1912,36,1909,1019,1018,1016,1014,58,1011,55,1008,51,1029,1027,1024,1021,63,1037,1034,1940,1939,1937,1942,8,1866,4,1863,1,1860,956,954,952,949,946,17,14,969,967,964,961,27,957,24,979,976,972,1901,1900,1898,1896,986,1905,1903,350,349,1381,329,327,324,1368,1366,292,290,287,284,2118,304,1341,1339,1337,1345,243,240,237,2086,233,2083,254,1297,1295,1293,1290,1304,2114,190,187,184,2034,180,2031,177,2027,199,1233,1231,1229,1226,217,1223,1241,2078,2076,584,555,554,552,550,2282,562,1586,507,506,504,502,2257,499,2254,515,1563,1561,445,443,441,2219,438,2216,435,2212,460,454,475,1517,1515,1512,2447,798,797,2422,2419,770,768,766,2383,2380,2376,721,719,717,714,731,1714,2602,2582,2580,2548,2546,2543,923,921,2717,2706,2705,2683,2682,2680,1771,1752,1750,1733,1732,1731,1735,1814,1707,1670,1668,1631,1629,1626,1634,1599,1598,1596,1594,1603,1601,2326,1772,1753,1751,1581,1554,1552,1504,1501,1498,1509,1442,1437,1434,401,1448,1445,2206,1392,1391,1389,1387,1384,359,1399,1397,1394,1404,2171,2170,1708,1672,1669,619,1632,1630,1628,1773,1378,1363,1361,1333,1328,1336,1286,1281,1278,248,1292,1289,2111,1218,1216,1210,197,1206,193,1228,1225,1221,1236,2073,2071,1151,1150,1148,1146,152,1143,149,1140,145,1161,1159,1156,1153,158,1169,1166,2017,2016,2014,2019,1582,510,1556,1553,452,448,1506,1500,394,391,387,1443,1441,1439,1436,1450,2207,765,716,713,1709,662,660,657,1673,1671,916,914,879,878,877,882,1135,1134,1121,1120,1118,1123,1097,1096,1094,1092,103,1101,1099,1979,1059,1058,1056,1054,77,1051,74,1066,1064,1061,1071,1964,1963,1007,1006,1004,1002,999,41,996,37,1017,1015,1012,1009,52,1025,1022,1936,1935,1933,1938,942,940,938,935,932,5,2,955,953,950,947,18,943,15,965,962,958,1895,1894,1892,1890,973,1899,1897,1379,325,1364,1362,288,285,1334,1332,1330,241,238,234,1287,1285,1283,1280,1294,2112,188,185,181,178,2028,1219,1217,1215,1212,200,1209,1227,2074,2072,583,553,551,1583,505,503,500,513,1557,1555,444,442,439,436,2213,455,451,1507,1505,1502,796,763,762,760,767,711,710,708,706,2377,718,715,1710,2544,917,915,2681,1627,1597,1595,2325,1769,1749,1747,1499,1438,1435,2204,1390,1388,1385,1395,2169,2167,1704,1665,1662,1625,1623,1620,1770,1329,1282,1279,2109,1214,1207,1222,2068,2065,1149,1147,1144,1141,146,1157,1154,2013,2011,2008,2015,1579,1549,1546,1495,1487,1433,1431,1428,1425,388,1440,2205,1705,658,1667,1664,1119,1095,1093,1978,1057,1055,1052,1062,1962,1960,1005,1003,1e3,997,38,1013,1010,1932,1930,1927,1934,941,939,936,933,6,930,3,951,948,944,1889,1887,1884,1881,959,1893,1891,35,1377,1360,1358,1327,1325,1322,1331,1277,1275,1272,1269,235,1284,2110,1205,1204,1201,1198,182,1195,179,1213,2070,2067,1580,501,1551,1548,440,437,1497,1494,1490,1503,761,709,707,1706,913,912,2198,1386,2164,2161,1621,1766,2103,1208,2058,2054,1145,1142,2005,2002,1999,2009,1488,1429,1426,2200,1698,1659,1656,1975,1053,1957,1954,1001,998,1924,1921,1918,1928,937,934,931,1879,1876,1873,1870,945,1885,1882,1323,1273,1270,2105,1202,1199,1196,1211,2061,2057,1576,1543,1540,1484,1481,1478,1491,1700]),r})(),b7=(function(){function r(e,o){this.bits=e,this.points=o}return r.prototype.getBits=function(){return this.bits},r.prototype.getPoints=function(){return this.points},r})(),w7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},S7=(function(){function r(){}return r.detectMultiple=function(e,o,l){var h=e.getBlackMatrix(),m=r.detect(l,h);return m.length||(h=h.clone(),h.rotate180(),m=r.detect(l,h)),new b7(h,m)},r.detect=function(e,o){for(var l,h,m=new Array,b=0,n=0,C=!1;b<o.getHeight();){var D=r.findVertices(o,b,n);if(D[0]==null&&D[3]==null){if(!C)break;C=!1,n=0;try{for(var L=(l=void 0,w7(m)),U=L.next();!U.done;U=L.next()){var q=U.value;q[1]!=null&&(b=Math.trunc(Math.max(b,q[1].getY()))),q[3]!=null&&(b=Math.max(b,Math.trunc(q[3].getY())))}}catch(Z){l={error:Z}}finally{try{U&&!U.done&&(h=L.return)&&h.call(L)}finally{if(l)throw l.error}}b+=r.ROW_STEP;continue}if(C=!0,m.push(D),!e)break;D[2]!=null?(n=Math.trunc(D[2].getX()),b=Math.trunc(D[2].getY())):(n=Math.trunc(D[4].getX()),b=Math.trunc(D[4].getY()))}return m},r.findVertices=function(e,o,l){var h=e.getHeight(),m=e.getWidth(),b=new Array(8);return r.copyToResult(b,r.findRowsWithPattern(e,h,m,o,l,r.START_PATTERN),r.INDEXES_START_PATTERN),b[4]!=null&&(l=Math.trunc(b[4].getX()),o=Math.trunc(b[4].getY())),r.copyToResult(b,r.findRowsWithPattern(e,h,m,o,l,r.STOP_PATTERN),r.INDEXES_STOP_PATTERN),b},r.copyToResult=function(e,o,l){for(var h=0;h<l.length;h++)e[l[h]]=o[h]},r.findRowsWithPattern=function(e,o,l,h,m,b){for(var n=new Array(4),C=!1,D=new Int32Array(b.length);h<o;h+=r.ROW_STEP){var L=r.findGuardPattern(e,m,h,l,!1,b,D);if(L!=null){for(;h>0;){var U=r.findGuardPattern(e,m,--h,l,!1,b,D);if(U!=null)L=U;else{h++;break}}n[0]=new ti(L[0],h),n[1]=new ti(L[1],h),C=!0;break}}var q=h+1;if(C){for(var Z=0,U=Int32Array.from([Math.trunc(n[0].getX()),Math.trunc(n[1].getX())]);q<o;q++){var L=r.findGuardPattern(e,U[0],q,l,!1,b,D);if(L!=null&&Math.abs(U[0]-L[0])<r.MAX_PATTERN_DRIFT&&Math.abs(U[1]-L[1])<r.MAX_PATTERN_DRIFT)U=L,Z=0;else{if(Z>r.SKIPPED_ROW_COUNT_MAX)break;Z++}}q-=Z+1,n[2]=new ti(U[0],q),n[3]=new ti(U[1],q)}return q-h<r.BARCODE_MIN_HEIGHT&&ka.fill(n,null),n},r.findGuardPattern=function(e,o,l,h,m,b,n){ka.fillWithin(n,0,n.length,0);for(var C=o,D=0;e.get(C,l)&&C>0&&D++<r.MAX_PIXEL_DRIFT;)C--;for(var L=C,U=0,q=b.length,Z=m;L<h;L++){var ie=e.get(L,l);if(ie!==Z)n[U]++;else{if(U===q-1){if(r.patternMatchVariance(n,b,r.MAX_INDIVIDUAL_VARIANCE)<r.MAX_AVG_VARIANCE)return new Int32Array([C,L]);C+=n[0]+n[1],yo.arraycopy(n,2,n,0,U-1),n[U-1]=0,n[U]=0,U--}else U++;n[U]=1,Z=!Z}}return U===q-1&&r.patternMatchVariance(n,b,r.MAX_INDIVIDUAL_VARIANCE)<r.MAX_AVG_VARIANCE?new Int32Array([C,L-1]):null},r.patternMatchVariance=function(e,o,l){for(var h=e.length,m=0,b=0,n=0;n<h;n++)m+=e[n],b+=o[n];if(m<b)return 1/0;var C=m/b;l*=C;for(var D=0,L=0;L<h;L++){var U=e[L],q=o[L]*C,Z=U>q?U-q:q-U;if(Z>l)return 1/0;D+=Z}return D/m},r.INDEXES_START_PATTERN=Int32Array.from([0,4,1,5]),r.INDEXES_STOP_PATTERN=Int32Array.from([6,2,7,3]),r.MAX_AVG_VARIANCE=.42,r.MAX_INDIVIDUAL_VARIANCE=.8,r.START_PATTERN=Int32Array.from([8,1,1,1,1,1,1,3]),r.STOP_PATTERN=Int32Array.from([7,1,1,3,1,1,1,2,1]),r.MAX_PIXEL_DRIFT=3,r.MAX_PATTERN_DRIFT=5,r.SKIPPED_ROW_COUNT_MAX=25,r.ROW_STEP=5,r.BARCODE_MIN_HEIGHT=10,r})(),T7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},yg=(function(){function r(e,o){if(o.length===0)throw new bi;this.field=e;var l=o.length;if(l>1&&o[0]===0){for(var h=1;h<l&&o[h]===0;)h++;h===l?this.coefficients=new Int32Array([0]):(this.coefficients=new Int32Array(l-h),yo.arraycopy(o,h,this.coefficients,0,this.coefficients.length))}else this.coefficients=o}return r.prototype.getCoefficients=function(){return this.coefficients},r.prototype.getDegree=function(){return this.coefficients.length-1},r.prototype.isZero=function(){return this.coefficients[0]===0},r.prototype.getCoefficient=function(e){return this.coefficients[this.coefficients.length-1-e]},r.prototype.evaluateAt=function(e){var o,l;if(e===0)return this.getCoefficient(0);if(e===1){var h=0;try{for(var m=T7(this.coefficients),b=m.next();!b.done;b=m.next()){var n=b.value;h=this.field.add(h,n)}}catch(U){o={error:U}}finally{try{b&&!b.done&&(l=m.return)&&l.call(m)}finally{if(o)throw o.error}}return h}for(var C=this.coefficients[0],D=this.coefficients.length,L=1;L<D;L++)C=this.field.add(this.field.multiply(e,C),this.coefficients[L]);return C},r.prototype.add=function(e){if(!this.field.equals(e.field))throw new bi("ModulusPolys do not have same ModulusGF field");if(this.isZero())return e;if(e.isZero())return this;var o=this.coefficients,l=e.coefficients;if(o.length>l.length){var h=o;o=l,l=h}var m=new Int32Array(l.length),b=l.length-o.length;yo.arraycopy(l,0,m,0,b);for(var n=b;n<l.length;n++)m[n]=this.field.add(o[n-b],l[n]);return new r(this.field,m)},r.prototype.subtract=function(e){if(!this.field.equals(e.field))throw new bi("ModulusPolys do not have same ModulusGF field");return e.isZero()?this:this.add(e.negative())},r.prototype.multiply=function(e){return e instanceof r?this.multiplyOther(e):this.multiplyScalar(e)},r.prototype.multiplyOther=function(e){if(!this.field.equals(e.field))throw new bi("ModulusPolys do not have same ModulusGF field");if(this.isZero()||e.isZero())return new r(this.field,new Int32Array([0]));for(var o=this.coefficients,l=o.length,h=e.coefficients,m=h.length,b=new Int32Array(l+m-1),n=0;n<l;n++)for(var C=o[n],D=0;D<m;D++)b[n+D]=this.field.add(b[n+D],this.field.multiply(C,h[D]));return new r(this.field,b)},r.prototype.negative=function(){for(var e=this.coefficients.length,o=new Int32Array(e),l=0;l<e;l++)o[l]=this.field.subtract(0,this.coefficients[l]);return new r(this.field,o)},r.prototype.multiplyScalar=function(e){if(e===0)return new r(this.field,new Int32Array([0]));if(e===1)return this;for(var o=this.coefficients.length,l=new Int32Array(o),h=0;h<o;h++)l[h]=this.field.multiply(this.coefficients[h],e);return new r(this.field,l)},r.prototype.multiplyByMonomial=function(e,o){if(e<0)throw new bi;if(o===0)return new r(this.field,new Int32Array([0]));for(var l=this.coefficients.length,h=new Int32Array(l+e),m=0;m<l;m++)h[m]=this.field.multiply(this.coefficients[m],o);return new r(this.field,h)},r.prototype.toString=function(){for(var e=new cn,o=this.getDegree();o>=0;o--){var l=this.getCoefficient(o);l!==0&&(l<0?(e.append(" - "),l=-l):e.length()>0&&e.append(" + "),(o===0||l!==1)&&e.append(l),o!==0&&(o===1?e.append("x"):(e.append("x^"),e.append(o))))}return e.toString()},r})(),A7=(function(){function r(){}return r.prototype.add=function(e,o){return(e+o)%this.modulus},r.prototype.subtract=function(e,o){return(this.modulus+e-o)%this.modulus},r.prototype.exp=function(e){return this.expTable[e]},r.prototype.log=function(e){if(e===0)throw new bi;return this.logTable[e]},r.prototype.inverse=function(e){if(e===0)throw new OR;return this.expTable[this.modulus-this.logTable[e]-1]},r.prototype.multiply=function(e,o){return e===0||o===0?0:this.expTable[(this.logTable[e]+this.logTable[o])%(this.modulus-1)]},r.prototype.getSize=function(){return this.modulus},r.prototype.equals=function(e){return e===this},r})(),E7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),C7=(function(r){E7(e,r);function e(o,l){var h=r.call(this)||this;h.modulus=o,h.expTable=new Int32Array(o),h.logTable=new Int32Array(o);for(var m=1,b=0;b<o;b++)h.expTable[b]=m,m=m*l%o;for(var b=0;b<o-1;b++)h.logTable[h.expTable[b]]=b;return h.zero=new yg(h,new Int32Array([0])),h.one=new yg(h,new Int32Array([1])),h}return e.prototype.getZero=function(){return this.zero},e.prototype.getOne=function(){return this.one},e.prototype.buildMonomial=function(o,l){if(o<0)throw new bi;if(l===0)return this.zero;var h=new Int32Array(o+1);return h[0]=l,new yg(this,h)},e.PDF417_GF=new e(Dn.NUMBER_OF_CODEWORDS,3),e})(A7),I7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},R7=(function(){function r(){this.field=C7.PDF417_GF}return r.prototype.decode=function(e,o,l){for(var h,m,b=new yg(this.field,e),n=new Int32Array(o),C=!1,D=o;D>0;D--){var L=b.evaluateAt(this.field.exp(D));n[o-D]=L,L!==0&&(C=!0)}if(!C)return 0;var U=this.field.getOne();if(l!=null)try{for(var q=I7(l),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value,ne=this.field.exp(e.length-1-ie),be=new yg(this.field,new Int32Array([this.field.subtract(0,ne),1]));U=U.multiply(be)}}catch(Ft){h={error:Ft}}finally{try{Z&&!Z.done&&(m=q.return)&&m.call(q)}finally{if(h)throw h.error}}for(var ve=new yg(this.field,n),we=this.runEuclideanAlgorithm(this.field.buildMonomial(o,1),ve,o),Pe=we[0],Ze=we[1],$e=this.findErrorLocations(Pe),xt=this.findErrorMagnitudes(Ze,Pe,$e),D=0;D<$e.length;D++){var Ct=e.length-1-this.field.log($e[D]);if(Ct<0)throw Ka.getChecksumInstance();e[Ct]=this.field.subtract(e[Ct],xt[D])}return $e.length},r.prototype.runEuclideanAlgorithm=function(e,o,l){if(e.getDegree()<o.getDegree()){var h=e;e=o,o=h}for(var m=e,b=o,n=this.field.getZero(),C=this.field.getOne();b.getDegree()>=Math.round(l/2);){var D=m,L=n;if(m=b,n=C,m.isZero())throw Ka.getChecksumInstance();b=D;for(var U=this.field.getZero(),q=m.getCoefficient(m.getDegree()),Z=this.field.inverse(q);b.getDegree()>=m.getDegree()&&!b.isZero();){var ie=b.getDegree()-m.getDegree(),ne=this.field.multiply(b.getCoefficient(b.getDegree()),Z);U=U.add(this.field.buildMonomial(ie,ne)),b=b.subtract(m.multiplyByMonomial(ie,ne))}C=U.multiply(n).subtract(L).negative()}var be=C.getCoefficient(0);if(be===0)throw Ka.getChecksumInstance();var ve=this.field.inverse(be),we=C.multiply(ve),Pe=b.multiply(ve);return[we,Pe]},r.prototype.findErrorLocations=function(e){for(var o=e.getDegree(),l=new Int32Array(o),h=0,m=1;m<this.field.getSize()&&h<o;m++)e.evaluateAt(m)===0&&(l[h]=this.field.inverse(m),h++);if(h!==o)throw Ka.getChecksumInstance();return l},r.prototype.findErrorMagnitudes=function(e,o,l){for(var h=o.getDegree(),m=new Int32Array(h),b=1;b<=h;b++)m[h-b]=this.field.multiply(b,o.getCoefficient(b));for(var n=new yg(this.field,m),C=l.length,D=new Int32Array(C),b=0;b<C;b++){var L=this.field.inverse(l[b]),U=this.field.subtract(0,e.evaluateAt(L)),q=this.field.inverse(n.evaluateAt(L));D[b]=this.field.multiply(U,q)}return D},r})(),Rw=(function(){function r(e,o,l,h,m){e instanceof r?this.constructor_2(e):this.constructor_1(e,o,l,h,m)}return r.prototype.constructor_1=function(e,o,l,h,m){var b=o==null||l==null,n=h==null||m==null;if(b&&n)throw new Xt;b?(o=new ti(0,h.getY()),l=new ti(0,m.getY())):n&&(h=new ti(e.getWidth()-1,o.getY()),m=new ti(e.getWidth()-1,l.getY())),this.image=e,this.topLeft=o,this.bottomLeft=l,this.topRight=h,this.bottomRight=m,this.minX=Math.trunc(Math.min(o.getX(),l.getX())),this.maxX=Math.trunc(Math.max(h.getX(),m.getX())),this.minY=Math.trunc(Math.min(o.getY(),h.getY())),this.maxY=Math.trunc(Math.max(l.getY(),m.getY()))},r.prototype.constructor_2=function(e){this.image=e.image,this.topLeft=e.getTopLeft(),this.bottomLeft=e.getBottomLeft(),this.topRight=e.getTopRight(),this.bottomRight=e.getBottomRight(),this.minX=e.getMinX(),this.maxX=e.getMaxX(),this.minY=e.getMinY(),this.maxY=e.getMaxY()},r.merge=function(e,o){return e==null?o:o==null?e:new r(e.image,e.topLeft,e.bottomLeft,o.topRight,o.bottomRight)},r.prototype.addMissingRows=function(e,o,l){var h=this.topLeft,m=this.bottomLeft,b=this.topRight,n=this.bottomRight;if(e>0){var C=l?this.topLeft:this.topRight,D=Math.trunc(C.getY()-e);D<0&&(D=0);var L=new ti(C.getX(),D);l?h=L:b=L}if(o>0){var U=l?this.bottomLeft:this.bottomRight,q=Math.trunc(U.getY()+o);q>=this.image.getHeight()&&(q=this.image.getHeight()-1);var Z=new ti(U.getX(),q);l?m=Z:n=Z}return new r(this.image,h,m,b,n)},r.prototype.getMinX=function(){return this.minX},r.prototype.getMaxX=function(){return this.maxX},r.prototype.getMinY=function(){return this.minY},r.prototype.getMaxY=function(){return this.maxY},r.prototype.getTopLeft=function(){return this.topLeft},r.prototype.getTopRight=function(){return this.topRight},r.prototype.getBottomLeft=function(){return this.bottomLeft},r.prototype.getBottomRight=function(){return this.bottomRight},r})(),M7=(function(){function r(e,o,l,h){this.columnCount=e,this.errorCorrectionLevel=h,this.rowCountUpperPart=o,this.rowCountLowerPart=l,this.rowCount=o+l}return r.prototype.getColumnCount=function(){return this.columnCount},r.prototype.getErrorCorrectionLevel=function(){return this.errorCorrectionLevel},r.prototype.getRowCount=function(){return this.rowCount},r.prototype.getRowCountUpperPart=function(){return this.rowCountUpperPart},r.prototype.getRowCountLowerPart=function(){return this.rowCountLowerPart},r})(),B2=(function(){function r(){this.buffer=""}return r.form=function(e,o){var l=-1;function h(b,n,C,D,L,U){if(b==="%%")return"%";if(o[++l]!==void 0){b=D?parseInt(D.substr(1)):void 0;var q=L?parseInt(L.substr(1)):void 0,Z;switch(U){case"s":Z=o[l];break;case"c":Z=o[l][0];break;case"f":Z=parseFloat(o[l]).toFixed(b);break;case"p":Z=parseFloat(o[l]).toPrecision(b);break;case"e":Z=parseFloat(o[l]).toExponential(b);break;case"x":Z=parseInt(o[l]).toString(q||16);break;case"d":Z=parseFloat(parseInt(o[l],q||10).toPrecision(b)).toFixed(0);break}Z=typeof Z=="object"?JSON.stringify(Z):(+Z).toString(q);for(var ie=parseInt(C),ne=C&&C[0]+""=="0"?"0":" ";Z.length<ie;)Z=n!==void 0?Z+ne:ne+Z;return Z}}var m=/%(-)?(0?[0-9]+)?([.][0-9]+)?([#][0-9]+)?([scfpexd%])/g;return e.replace(m,h)},r.prototype.format=function(e){for(var o=[],l=1;l<arguments.length;l++)o[l-1]=arguments[l];this.buffer+=r.form(e,o)},r.prototype.toString=function(){return this.buffer},r})(),D7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},VR=(function(){function r(e){this.boundingBox=new Rw(e),this.codewords=new Array(e.getMaxY()-e.getMinY()+1)}return r.prototype.getCodewordNearby=function(e){var o=this.getCodeword(e);if(o!=null)return o;for(var l=1;l<r.MAX_NEARBY_DISTANCE;l++){var h=this.imageRowToCodewordIndex(e)-l;if(h>=0&&(o=this.codewords[h],o!=null)||(h=this.imageRowToCodewordIndex(e)+l,h<this.codewords.length&&(o=this.codewords[h],o!=null)))return o}return null},r.prototype.imageRowToCodewordIndex=function(e){return e-this.boundingBox.getMinY()},r.prototype.setCodeword=function(e,o){this.codewords[this.imageRowToCodewordIndex(e)]=o},r.prototype.getCodeword=function(e){return this.codewords[this.imageRowToCodewordIndex(e)]},r.prototype.getBoundingBox=function(){return this.boundingBox},r.prototype.getCodewords=function(){return this.codewords},r.prototype.toString=function(){var e,o,l=new B2,h=0;try{for(var m=D7(this.codewords),b=m.next();!b.done;b=m.next()){var n=b.value;if(n==null){l.format("%3d:    |   %n",h++);continue}l.format("%3d: %3d|%3d%n",h++,n.getRowNumber(),n.getValue())}}catch(C){e={error:C}}finally{try{b&&!b.done&&(o=m.return)&&o.call(m)}finally{if(e)throw e.error}}return l.toString()},r.MAX_NEARBY_DISTANCE=5,r})(),O7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},P7=function(r,e){var o=typeof Symbol=="function"&&r[Symbol.iterator];if(!o)return r;var l=o.call(r),h,m=[],b;try{for(;(e===void 0||e-- >0)&&!(h=l.next()).done;)m.push(h.value)}catch(n){b={error:n}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(b)throw b.error}}return m},oy=(function(){function r(){this.values=new Map}return r.prototype.setValue=function(e){e=Math.trunc(e);var o=this.values.get(e);o==null&&(o=0),o++,this.values.set(e,o)},r.prototype.getValue=function(){var e,o,l=-1,h=new Array,m=function(U,q){var Z={getKey:function(){return U},getValue:function(){return q}};Z.getValue()>l?(l=Z.getValue(),h=[],h.push(Z.getKey())):Z.getValue()===l&&h.push(Z.getKey())};try{for(var b=O7(this.values.entries()),n=b.next();!n.done;n=b.next()){var C=P7(n.value,2),D=C[0],L=C[1];m(D,L)}}catch(U){e={error:U}}finally{try{n&&!n.done&&(o=b.return)&&o.call(b)}finally{if(e)throw e.error}}return Dn.toIntArray(h)},r.prototype.getConfidence=function(e){return this.values.get(e)},r})(),L7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),Lb=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},VC=(function(r){L7(e,r);function e(o,l){var h=r.call(this,o)||this;return h._isLeft=l,h}return e.prototype.setRowNumbers=function(){var o,l;try{for(var h=Lb(this.getCodewords()),m=h.next();!m.done;m=h.next()){var b=m.value;b?.setRowNumberAsRowIndicatorColumn()}}catch(n){o={error:n}}finally{try{m&&!m.done&&(l=h.return)&&l.call(h)}finally{if(o)throw o.error}}},e.prototype.adjustCompleteIndicatorColumnRowNumbers=function(o){var l=this.getCodewords();this.setRowNumbers(),this.removeIncorrectCodewords(l,o);for(var h=this.getBoundingBox(),m=this._isLeft?h.getTopLeft():h.getTopRight(),b=this._isLeft?h.getBottomLeft():h.getBottomRight(),n=this.imageRowToCodewordIndex(Math.trunc(m.getY())),C=this.imageRowToCodewordIndex(Math.trunc(b.getY())),D=-1,L=1,U=0,q=n;q<C;q++)if(l[q]!=null){var Z=l[q],ie=Z.getRowNumber()-D;if(ie===0)U++;else if(ie===1)L=Math.max(L,U),U=1,D=Z.getRowNumber();else if(ie<0||Z.getRowNumber()>=o.getRowCount()||ie>q)l[q]=null;else{var ne=void 0;L>2?ne=(L-2)*ie:ne=ie;for(var be=ne>=q,ve=1;ve<=ne&&!be;ve++)be=l[q-ve]!=null;be?l[q]=null:(D=Z.getRowNumber(),U=1)}}},e.prototype.getRowHeights=function(){var o,l,h=this.getBarcodeMetadata();if(h==null)return null;this.adjustIncompleteIndicatorColumnRowNumbers(h);var m=new Int32Array(h.getRowCount());try{for(var b=Lb(this.getCodewords()),n=b.next();!n.done;n=b.next()){var C=n.value;if(C!=null){var D=C.getRowNumber();if(D>=m.length)continue;m[D]++}}}catch(L){o={error:L}}finally{try{n&&!n.done&&(l=b.return)&&l.call(b)}finally{if(o)throw o.error}}return m},e.prototype.adjustIncompleteIndicatorColumnRowNumbers=function(o){for(var l=this.getBoundingBox(),h=this._isLeft?l.getTopLeft():l.getTopRight(),m=this._isLeft?l.getBottomLeft():l.getBottomRight(),b=this.imageRowToCodewordIndex(Math.trunc(h.getY())),n=this.imageRowToCodewordIndex(Math.trunc(m.getY())),C=this.getCodewords(),D=-1,L=b;L<n;L++)if(C[L]!=null){var U=C[L];U.setRowNumberAsRowIndicatorColumn();var q=U.getRowNumber()-D;q===0||(q===1?D=U.getRowNumber():U.getRowNumber()>=o.getRowCount()?C[L]=null:D=U.getRowNumber())}},e.prototype.getBarcodeMetadata=function(){var o,l,h=this.getCodewords(),m=new oy,b=new oy,n=new oy,C=new oy;try{for(var D=Lb(h),L=D.next();!L.done;L=D.next()){var U=L.value;if(U!=null){U.setRowNumberAsRowIndicatorColumn();var q=U.getValue()%30,Z=U.getRowNumber();switch(this._isLeft||(Z+=2),Z%3){case 0:b.setValue(q*3+1);break;case 1:C.setValue(q/3),n.setValue(q%3);break;case 2:m.setValue(q+1);break}}}}catch(ne){o={error:ne}}finally{try{L&&!L.done&&(l=D.return)&&l.call(D)}finally{if(o)throw o.error}}if(m.getValue().length===0||b.getValue().length===0||n.getValue().length===0||C.getValue().length===0||m.getValue()[0]<1||b.getValue()[0]+n.getValue()[0]<Dn.MIN_ROWS_IN_BARCODE||b.getValue()[0]+n.getValue()[0]>Dn.MAX_ROWS_IN_BARCODE)return null;var ie=new M7(m.getValue()[0],b.getValue()[0],n.getValue()[0],C.getValue()[0]);return this.removeIncorrectCodewords(h,ie),ie},e.prototype.removeIncorrectCodewords=function(o,l){for(var h=0;h<o.length;h++){var m=o[h];if(o[h]!=null){var b=m.getValue()%30,n=m.getRowNumber();if(n>l.getRowCount()){o[h]=null;continue}switch(this._isLeft||(n+=2),n%3){case 0:b*3+1!==l.getRowCountUpperPart()&&(o[h]=null);break;case 1:(Math.trunc(b/3)!==l.getErrorCorrectionLevel()||b%3!==l.getRowCountLowerPart())&&(o[h]=null);break;case 2:b+1!==l.getColumnCount()&&(o[h]=null);break}}}},e.prototype.isLeft=function(){return this._isLeft},e.prototype.toString=function(){return"IsLeft: "+this._isLeft+`
`+r.prototype.toString.call(this)},e})(VR),B7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},z7=(function(){function r(e,o){this.ADJUST_ROW_NUMBER_SKIP=2,this.barcodeMetadata=e,this.barcodeColumnCount=e.getColumnCount(),this.boundingBox=o,this.detectionResultColumns=new Array(this.barcodeColumnCount+2)}return r.prototype.getDetectionResultColumns=function(){this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[0]),this.adjustIndicatorColumnRowNumbers(this.detectionResultColumns[this.barcodeColumnCount+1]);var e=Dn.MAX_CODEWORDS_IN_BARCODE,o;do o=e,e=this.adjustRowNumbersAndGetCount();while(e>0&&e<o);return this.detectionResultColumns},r.prototype.adjustIndicatorColumnRowNumbers=function(e){e?.adjustCompleteIndicatorColumnRowNumbers(this.barcodeMetadata)},r.prototype.adjustRowNumbersAndGetCount=function(){var e=this.adjustRowNumbersByRow();if(e===0)return 0;for(var o=1;o<this.barcodeColumnCount+1;o++)for(var l=this.detectionResultColumns[o].getCodewords(),h=0;h<l.length;h++)l[h]!=null&&(l[h].hasValidRowNumber()||this.adjustRowNumbers(o,h,l));return e},r.prototype.adjustRowNumbersByRow=function(){this.adjustRowNumbersFromBothRI();var e=this.adjustRowNumbersFromLRI();return e+this.adjustRowNumbersFromRRI()},r.prototype.adjustRowNumbersFromBothRI=function(){if(!(this.detectionResultColumns[0]==null||this.detectionResultColumns[this.barcodeColumnCount+1]==null)){for(var e=this.detectionResultColumns[0].getCodewords(),o=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),l=0;l<e.length;l++)if(e[l]!=null&&o[l]!=null&&e[l].getRowNumber()===o[l].getRowNumber())for(var h=1;h<=this.barcodeColumnCount;h++){var m=this.detectionResultColumns[h].getCodewords()[l];m!=null&&(m.setRowNumber(e[l].getRowNumber()),m.hasValidRowNumber()||(this.detectionResultColumns[h].getCodewords()[l]=null))}}},r.prototype.adjustRowNumbersFromRRI=function(){if(this.detectionResultColumns[this.barcodeColumnCount+1]==null)return 0;for(var e=0,o=this.detectionResultColumns[this.barcodeColumnCount+1].getCodewords(),l=0;l<o.length;l++)if(o[l]!=null)for(var h=o[l].getRowNumber(),m=0,b=this.barcodeColumnCount+1;b>0&&m<this.ADJUST_ROW_NUMBER_SKIP;b--){var n=this.detectionResultColumns[b].getCodewords()[l];n!=null&&(m=r.adjustRowNumberIfValid(h,m,n),n.hasValidRowNumber()||e++)}return e},r.prototype.adjustRowNumbersFromLRI=function(){if(this.detectionResultColumns[0]==null)return 0;for(var e=0,o=this.detectionResultColumns[0].getCodewords(),l=0;l<o.length;l++)if(o[l]!=null)for(var h=o[l].getRowNumber(),m=0,b=1;b<this.barcodeColumnCount+1&&m<this.ADJUST_ROW_NUMBER_SKIP;b++){var n=this.detectionResultColumns[b].getCodewords()[l];n!=null&&(m=r.adjustRowNumberIfValid(h,m,n),n.hasValidRowNumber()||e++)}return e},r.adjustRowNumberIfValid=function(e,o,l){return l==null||l.hasValidRowNumber()||(l.isValidRowNumber(e)?(l.setRowNumber(e),o=0):++o),o},r.prototype.adjustRowNumbers=function(e,o,l){var h,m;if(this.detectionResultColumns[e-1]!=null){var b=l[o],n=this.detectionResultColumns[e-1].getCodewords(),C=n;this.detectionResultColumns[e+1]!=null&&(C=this.detectionResultColumns[e+1].getCodewords());var D=new Array(14);D[2]=n[o],D[3]=C[o],o>0&&(D[0]=l[o-1],D[4]=n[o-1],D[5]=C[o-1]),o>1&&(D[8]=l[o-2],D[10]=n[o-2],D[11]=C[o-2]),o<l.length-1&&(D[1]=l[o+1],D[6]=n[o+1],D[7]=C[o+1]),o<l.length-2&&(D[9]=l[o+2],D[12]=n[o+2],D[13]=C[o+2]);try{for(var L=B7(D),U=L.next();!U.done;U=L.next()){var q=U.value;if(r.adjustRowNumber(b,q))return}}catch(Z){h={error:Z}}finally{try{U&&!U.done&&(m=L.return)&&m.call(L)}finally{if(h)throw h.error}}}},r.adjustRowNumber=function(e,o){return o==null?!1:o.hasValidRowNumber()&&o.getBucket()===e.getBucket()?(e.setRowNumber(o.getRowNumber()),!0):!1},r.prototype.getBarcodeColumnCount=function(){return this.barcodeColumnCount},r.prototype.getBarcodeRowCount=function(){return this.barcodeMetadata.getRowCount()},r.prototype.getBarcodeECLevel=function(){return this.barcodeMetadata.getErrorCorrectionLevel()},r.prototype.setBoundingBox=function(e){this.boundingBox=e},r.prototype.getBoundingBox=function(){return this.boundingBox},r.prototype.setDetectionResultColumn=function(e,o){this.detectionResultColumns[e]=o},r.prototype.getDetectionResultColumn=function(e){return this.detectionResultColumns[e]},r.prototype.toString=function(){var e=this.detectionResultColumns[0];e==null&&(e=this.detectionResultColumns[this.barcodeColumnCount+1]);for(var o=new B2,l=0;l<e.getCodewords().length;l++){o.format("CW %3d:",l);for(var h=0;h<this.barcodeColumnCount+2;h++){if(this.detectionResultColumns[h]==null){o.format("    |   ");continue}var m=this.detectionResultColumns[h].getCodewords()[l];if(m==null){o.format("    |   ");continue}o.format(" %3d|%3d",m.getRowNumber(),m.getValue())}o.format("%n")}return o.toString()},r})(),F7=(function(){function r(e,o,l,h){this.rowNumber=r.BARCODE_ROW_UNKNOWN,this.startX=Math.trunc(e),this.endX=Math.trunc(o),this.bucket=Math.trunc(l),this.value=Math.trunc(h)}return r.prototype.hasValidRowNumber=function(){return this.isValidRowNumber(this.rowNumber)},r.prototype.isValidRowNumber=function(e){return e!==r.BARCODE_ROW_UNKNOWN&&this.bucket===e%3*3},r.prototype.setRowNumberAsRowIndicatorColumn=function(){this.rowNumber=Math.trunc(Math.trunc(this.value/30)*3+Math.trunc(this.bucket/3))},r.prototype.getWidth=function(){return this.endX-this.startX},r.prototype.getStartX=function(){return this.startX},r.prototype.getEndX=function(){return this.endX},r.prototype.getBucket=function(){return this.bucket},r.prototype.getValue=function(){return this.value},r.prototype.getRowNumber=function(){return this.rowNumber},r.prototype.setRowNumber=function(e){this.rowNumber=e},r.prototype.toString=function(){return this.rowNumber+"|"+this.value},r.BARCODE_ROW_UNKNOWN=-1,r})(),k7=(function(){function r(){}return r.initialize=function(){for(var e=0;e<Dn.SYMBOL_TABLE.length;e++)for(var o=Dn.SYMBOL_TABLE[e],l=o&1,h=0;h<Dn.BARS_IN_MODULE;h++){for(var m=0;(o&1)===l;)m+=1,o>>=1;l=o&1,r.RATIOS_TABLE[e]||(r.RATIOS_TABLE[e]=new Array(Dn.BARS_IN_MODULE)),r.RATIOS_TABLE[e][Dn.BARS_IN_MODULE-h-1]=Math.fround(m/Dn.MODULES_IN_CODEWORD)}this.bSymbolTableReady=!0},r.getDecodedValue=function(e){var o=r.getDecodedCodewordValue(r.sampleBitCounts(e));return o!==-1?o:r.getClosestDecodedValue(e)},r.sampleBitCounts=function(e){for(var o=zn.sum(e),l=new Int32Array(Dn.BARS_IN_MODULE),h=0,m=0,b=0;b<Dn.MODULES_IN_CODEWORD;b++){var n=o/(2*Dn.MODULES_IN_CODEWORD)+b*o/Dn.MODULES_IN_CODEWORD;m+e[h]<=n&&(m+=e[h],h++),l[h]++}return l},r.getDecodedCodewordValue=function(e){var o=r.getBitValue(e);return Dn.getCodeword(o)===-1?-1:o},r.getBitValue=function(e){for(var o=0,l=0;l<e.length;l++)for(var h=0;h<e[l];h++)o=o<<1|(l%2===0?1:0);return Math.trunc(o)},r.getClosestDecodedValue=function(e){var o=zn.sum(e),l=new Array(Dn.BARS_IN_MODULE);if(o>1)for(var h=0;h<l.length;h++)l[h]=Math.fround(e[h]/o);var m=Sw.MAX_VALUE,b=-1;this.bSymbolTableReady||r.initialize();for(var n=0;n<r.RATIOS_TABLE.length;n++){for(var C=0,D=r.RATIOS_TABLE[n],L=0;L<Dn.BARS_IN_MODULE;L++){var U=Math.fround(D[L]-l[L]);if(C+=Math.fround(U*U),C>=m)break}C<m&&(m=C,b=Dn.SYMBOL_TABLE[n])}return b},r.bSymbolTableReady=!1,r.RATIOS_TABLE=new Array(Dn.SYMBOL_TABLE.length).map(function(e){return new Array(Dn.BARS_IN_MODULE)}),r})(),N7=(function(){function r(){this.segmentCount=-1,this.fileSize=-1,this.timestamp=-1,this.checksum=-1}return r.prototype.getSegmentIndex=function(){return this.segmentIndex},r.prototype.setSegmentIndex=function(e){this.segmentIndex=e},r.prototype.getFileId=function(){return this.fileId},r.prototype.setFileId=function(e){this.fileId=e},r.prototype.getOptionalData=function(){return this.optionalData},r.prototype.setOptionalData=function(e){this.optionalData=e},r.prototype.isLastSegment=function(){return this.lastSegment},r.prototype.setLastSegment=function(e){this.lastSegment=e},r.prototype.getSegmentCount=function(){return this.segmentCount},r.prototype.setSegmentCount=function(e){this.segmentCount=e},r.prototype.getSender=function(){return this.sender||null},r.prototype.setSender=function(e){this.sender=e},r.prototype.getAddressee=function(){return this.addressee||null},r.prototype.setAddressee=function(e){this.addressee=e},r.prototype.getFileName=function(){return this.fileName},r.prototype.setFileName=function(e){this.fileName=e},r.prototype.getFileSize=function(){return this.fileSize},r.prototype.setFileSize=function(e){this.fileSize=e},r.prototype.getChecksum=function(){return this.checksum},r.prototype.setChecksum=function(e){this.checksum=e},r.prototype.getTimestamp=function(){return this.timestamp},r.prototype.setTimestamp=function(e){this.timestamp=e},r})(),UC=(function(){function r(){}return r.parseLong=function(e,o){return o===void 0&&(o=void 0),parseInt(e,o)},r})(),V7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),U7=(function(r){V7(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="NullPointerException",e})(Xl),j7=(function(){function r(){}return r.prototype.writeBytes=function(e){this.writeBytesOffset(e,0,e.length)},r.prototype.writeBytesOffset=function(e,o,l){if(e==null)throw new U7;if(o<0||o>e.length||l<0||o+l>e.length||o+l<0)throw new M2;if(l===0)return;for(var h=0;h<l;h++)this.write(e[o+h])},r.prototype.flush=function(){},r.prototype.close=function(){},r})(),G7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),H7=(function(r){G7(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e})(Xl),q7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),$7=(function(r){q7(e,r);function e(o){o===void 0&&(o=32);var l=r.call(this)||this;if(l.count=0,o<0)throw new bi("Negative initial size: "+o);return l.buf=new Uint8Array(o),l}return e.prototype.ensureCapacity=function(o){o-this.buf.length>0&&this.grow(o)},e.prototype.grow=function(o){var l=this.buf.length,h=l<<1;if(h-o<0&&(h=o),h<0){if(o<0)throw new H7;h=pn.MAX_VALUE}this.buf=ka.copyOfUint8Array(this.buf,h)},e.prototype.write=function(o){this.ensureCapacity(this.count+1),this.buf[this.count]=o,this.count+=1},e.prototype.writeBytesOffset=function(o,l,h){if(l<0||l>o.length||h<0||l+h-o.length>0)throw new M2;this.ensureCapacity(this.count+h),yo.arraycopy(o,l,this.buf,this.count,h),this.count+=h},e.prototype.writeTo=function(o){o.writeBytesOffset(this.buf,0,this.count)},e.prototype.reset=function(){this.count=0},e.prototype.toByteArray=function(){return ka.copyOfUint8Array(this.buf,this.count)},e.prototype.size=function(){return this.count},e.prototype.toString=function(o){return o?typeof o=="string"?this.toString_string(o):this.toString_number(o):this.toString_void()},e.prototype.toString_void=function(){return new String(this.buf).toString()},e.prototype.toString_string=function(o){return new String(this.buf).toString()},e.prototype.toString_number=function(o){return new String(this.buf).toString()},e.prototype.close=function(){},e})(j7),oo;(function(r){r[r.ALPHA=0]="ALPHA",r[r.LOWER=1]="LOWER",r[r.MIXED=2]="MIXED",r[r.PUNCT=3]="PUNCT",r[r.ALPHA_SHIFT=4]="ALPHA_SHIFT",r[r.PUNCT_SHIFT=5]="PUNCT_SHIFT"})(oo||(oo={}));function UR(){if(typeof window<"u")return window.BigInt||null;if(typeof global<"u")return global.BigInt||null;if(typeof self<"u")return self.BigInt||null;throw new Error("Can't search globals for BigInt!")}var sv;function am(r){if(typeof sv>"u"&&(sv=UR()),sv===null)throw new Error("BigInt is not supported!");return sv(r)}function X7(){var r=[];r[0]=am(1);var e=am(900);r[1]=e;for(var o=2;o<16;o++)r[o]=r[o-1]*e;return r}var Z7=(function(){function r(){}return r.decode=function(e,o){var l=new cn(""),h=Fa.ISO8859_1;l.enableDecoding(h);for(var m=1,b=e[m++],n=new N7;m<e[0];){switch(b){case r.TEXT_COMPACTION_MODE_LATCH:m=r.textCompaction(e,m,l);break;case r.BYTE_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH_6:m=r.byteCompaction(b,e,h,m,l);break;case r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:l.append(e[m++]);break;case r.NUMERIC_COMPACTION_MODE_LATCH:m=r.numericCompaction(e,m,l);break;case r.ECI_CHARSET:Fa.getCharacterSetECIByValue(e[m++]);break;case r.ECI_GENERAL_PURPOSE:m+=2;break;case r.ECI_USER_DEFINED:m++;break;case r.BEGIN_MACRO_PDF417_CONTROL_BLOCK:m=r.decodeMacroBlock(e,m,n);break;case r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case r.MACRO_PDF417_TERMINATOR:throw new Ir;default:m--,m=r.textCompaction(e,m,l);break}if(m<e.length)b=e[m++];else throw Ir.getFormatInstance()}if(l.length()===0)throw Ir.getFormatInstance();var C=new Zv(null,l.toString(),null,o);return C.setOther(n),C},r.decodeMacroBlock=function(e,o,l){if(o+r.NUMBER_OF_SEQUENCE_CODEWORDS>e[0])throw Ir.getFormatInstance();for(var h=new Int32Array(r.NUMBER_OF_SEQUENCE_CODEWORDS),m=0;m<r.NUMBER_OF_SEQUENCE_CODEWORDS;m++,o++)h[m]=e[o];l.setSegmentIndex(pn.parseInt(r.decodeBase900toBase10(h,r.NUMBER_OF_SEQUENCE_CODEWORDS)));var b=new cn;o=r.textCompaction(e,o,b),l.setFileId(b.toString());var n=-1;for(e[o]===r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD&&(n=o+1);o<e[0];)switch(e[o]){case r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:switch(o++,e[o]){case r.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME:var C=new cn;o=r.textCompaction(e,o+1,C),l.setFileName(C.toString());break;case r.MACRO_PDF417_OPTIONAL_FIELD_SENDER:var D=new cn;o=r.textCompaction(e,o+1,D),l.setSender(D.toString());break;case r.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE:var L=new cn;o=r.textCompaction(e,o+1,L),l.setAddressee(L.toString());break;case r.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT:var U=new cn;o=r.numericCompaction(e,o+1,U),l.setSegmentCount(pn.parseInt(U.toString()));break;case r.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP:var q=new cn;o=r.numericCompaction(e,o+1,q),l.setTimestamp(UC.parseLong(q.toString()));break;case r.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM:var Z=new cn;o=r.numericCompaction(e,o+1,Z),l.setChecksum(pn.parseInt(Z.toString()));break;case r.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE:var ie=new cn;o=r.numericCompaction(e,o+1,ie),l.setFileSize(UC.parseLong(ie.toString()));break;default:throw Ir.getFormatInstance()}break;case r.MACRO_PDF417_TERMINATOR:o++,l.setLastSegment(!0);break;default:throw Ir.getFormatInstance()}if(n!==-1){var ne=o-n;l.isLastSegment()&&ne--,l.setOptionalData(ka.copyOfRange(e,n,n+ne))}return o},r.textCompaction=function(e,o,l){for(var h=new Int32Array((e[0]-o)*2),m=new Int32Array((e[0]-o)*2),b=0,n=!1;o<e[0]&&!n;){var C=e[o++];if(C<r.TEXT_COMPACTION_MODE_LATCH)h[b]=C/30,h[b+1]=C%30,b+=2;else switch(C){case r.TEXT_COMPACTION_MODE_LATCH:h[b++]=r.TEXT_COMPACTION_MODE_LATCH;break;case r.BYTE_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH_6:case r.NUMERIC_COMPACTION_MODE_LATCH:case r.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case r.MACRO_PDF417_TERMINATOR:o--,n=!0;break;case r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h[b]=r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE,C=e[o++],m[b]=C,b++;break}}return r.decodeTextCompaction(h,m,b,l),o},r.decodeTextCompaction=function(e,o,l,h){for(var m=oo.ALPHA,b=oo.ALPHA,n=0;n<l;){var C=e[n],D="";switch(m){case oo.ALPHA:if(C<26)D=String.fromCharCode(65+C);else switch(C){case 26:D=" ";break;case r.LL:m=oo.LOWER;break;case r.ML:m=oo.MIXED;break;case r.PS:b=m,m=oo.PUNCT_SHIFT;break;case r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[n]);break;case r.TEXT_COMPACTION_MODE_LATCH:m=oo.ALPHA;break}break;case oo.LOWER:if(C<26)D=String.fromCharCode(97+C);else switch(C){case 26:D=" ";break;case r.AS:b=m,m=oo.ALPHA_SHIFT;break;case r.ML:m=oo.MIXED;break;case r.PS:b=m,m=oo.PUNCT_SHIFT;break;case r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[n]);break;case r.TEXT_COMPACTION_MODE_LATCH:m=oo.ALPHA;break}break;case oo.MIXED:if(C<r.PL)D=r.MIXED_CHARS[C];else switch(C){case r.PL:m=oo.PUNCT;break;case 26:D=" ";break;case r.LL:m=oo.LOWER;break;case r.AL:m=oo.ALPHA;break;case r.PS:b=m,m=oo.PUNCT_SHIFT;break;case r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[n]);break;case r.TEXT_COMPACTION_MODE_LATCH:m=oo.ALPHA;break}break;case oo.PUNCT:if(C<r.PAL)D=r.PUNCT_CHARS[C];else switch(C){case r.PAL:m=oo.ALPHA;break;case r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[n]);break;case r.TEXT_COMPACTION_MODE_LATCH:m=oo.ALPHA;break}break;case oo.ALPHA_SHIFT:if(m=b,C<26)D=String.fromCharCode(65+C);else switch(C){case 26:D=" ";break;case r.TEXT_COMPACTION_MODE_LATCH:m=oo.ALPHA;break}break;case oo.PUNCT_SHIFT:if(m=b,C<r.PAL)D=r.PUNCT_CHARS[C];else switch(C){case r.PAL:m=oo.ALPHA;break;case r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE:h.append(o[n]);break;case r.TEXT_COMPACTION_MODE_LATCH:m=oo.ALPHA;break}break}D!==""&&h.append(D),n++}},r.byteCompaction=function(e,o,l,h,m){var b=new $7,n=0,C=0,D=!1;switch(e){case r.BYTE_COMPACTION_MODE_LATCH:for(var L=new Int32Array(6),U=o[h++];h<o[0]&&!D;)switch(L[n++]=U,C=900*C+U,U=o[h++],U){case r.TEXT_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH:case r.NUMERIC_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH_6:case r.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case r.MACRO_PDF417_TERMINATOR:h--,D=!0;break;default:if(n%5===0&&n>0){for(var q=0;q<6;++q)b.write(Number(am(C)>>am(8*(5-q))));C=0,n=0}break}h===o[0]&&U<r.TEXT_COMPACTION_MODE_LATCH&&(L[n++]=U);for(var Z=0;Z<n;Z++)b.write(L[Z]);break;case r.BYTE_COMPACTION_MODE_LATCH_6:for(;h<o[0]&&!D;){var ie=o[h++];if(ie<r.TEXT_COMPACTION_MODE_LATCH)n++,C=900*C+ie;else switch(ie){case r.TEXT_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH:case r.NUMERIC_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH_6:case r.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case r.MACRO_PDF417_TERMINATOR:h--,D=!0;break}if(n%5===0&&n>0){for(var q=0;q<6;++q)b.write(Number(am(C)>>am(8*(5-q))));C=0,n=0}}break}return m.append(Bu.decode(b.toByteArray(),l)),h},r.numericCompaction=function(e,o,l){for(var h=0,m=!1,b=new Int32Array(r.MAX_NUMERIC_CODEWORDS);o<e[0]&&!m;){var n=e[o++];if(o===e[0]&&(m=!0),n<r.TEXT_COMPACTION_MODE_LATCH)b[h]=n,h++;else switch(n){case r.TEXT_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH:case r.BYTE_COMPACTION_MODE_LATCH_6:case r.BEGIN_MACRO_PDF417_CONTROL_BLOCK:case r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD:case r.MACRO_PDF417_TERMINATOR:o--,m=!0;break}(h%r.MAX_NUMERIC_CODEWORDS===0||n===r.NUMERIC_COMPACTION_MODE_LATCH||m)&&h>0&&(l.append(r.decodeBase900toBase10(b,h)),h=0)}return o},r.decodeBase900toBase10=function(e,o){for(var l=am(0),h=0;h<o;h++)l+=r.EXP900[o-h-1]*am(e[h]);var m=l.toString();if(m.charAt(0)!=="1")throw new Ir;return m.substring(1)},r.TEXT_COMPACTION_MODE_LATCH=900,r.BYTE_COMPACTION_MODE_LATCH=901,r.NUMERIC_COMPACTION_MODE_LATCH=902,r.BYTE_COMPACTION_MODE_LATCH_6=924,r.ECI_USER_DEFINED=925,r.ECI_GENERAL_PURPOSE=926,r.ECI_CHARSET=927,r.BEGIN_MACRO_PDF417_CONTROL_BLOCK=928,r.BEGIN_MACRO_PDF417_OPTIONAL_FIELD=923,r.MACRO_PDF417_TERMINATOR=922,r.MODE_SHIFT_TO_BYTE_COMPACTION_MODE=913,r.MAX_NUMERIC_CODEWORDS=15,r.MACRO_PDF417_OPTIONAL_FIELD_FILE_NAME=0,r.MACRO_PDF417_OPTIONAL_FIELD_SEGMENT_COUNT=1,r.MACRO_PDF417_OPTIONAL_FIELD_TIME_STAMP=2,r.MACRO_PDF417_OPTIONAL_FIELD_SENDER=3,r.MACRO_PDF417_OPTIONAL_FIELD_ADDRESSEE=4,r.MACRO_PDF417_OPTIONAL_FIELD_FILE_SIZE=5,r.MACRO_PDF417_OPTIONAL_FIELD_CHECKSUM=6,r.PL=25,r.LL=27,r.AS=27,r.ML=28,r.AL=28,r.PS=29,r.PAL=29,r.PUNCT_CHARS=`;<>@[\\]_\`~!\r	,:
-.$/"|*()?{}'`,r.MIXED_CHARS="0123456789&\r	,:#-.$/+%*=^",r.EXP900=UR()?X7():[],r.NUMBER_OF_SEQUENCE_CODEWORDS=2,r})(),J0=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},W7=(function(){function r(){}return r.decode=function(e,o,l,h,m,b,n){for(var C=new Rw(e,o,l,h,m),D=null,L=null,U,q=!0;;q=!1){if(o!=null&&(D=r.getRowIndicatorColumn(e,C,o,!0,b,n)),h!=null&&(L=r.getRowIndicatorColumn(e,C,h,!1,b,n)),U=r.merge(D,L),U==null)throw Xt.getNotFoundInstance();var Z=U.getBoundingBox();if(q&&Z!=null&&(Z.getMinY()<C.getMinY()||Z.getMaxY()>C.getMaxY()))C=Z;else break}U.setBoundingBox(C);var ie=U.getBarcodeColumnCount()+1;U.setDetectionResultColumn(0,D),U.setDetectionResultColumn(ie,L);for(var ne=D!=null,be=1;be<=ie;be++){var ve=ne?be:ie-be;if(U.getDetectionResultColumn(ve)===void 0){var we=void 0;ve===0||ve===ie?we=new VC(C,ve===0):we=new VR(C),U.setDetectionResultColumn(ve,we);for(var Pe=-1,Ze=Pe,$e=C.getMinY();$e<=C.getMaxY();$e++){if(Pe=r.getStartColumn(U,ve,$e,ne),Pe<0||Pe>C.getMaxX()){if(Ze===-1)continue;Pe=Ze}var xt=r.detectCodeword(e,C.getMinX(),C.getMaxX(),ne,Pe,$e,b,n);xt!=null&&(we.setCodeword($e,xt),Ze=Pe,b=Math.min(b,xt.getWidth()),n=Math.max(n,xt.getWidth()))}}}return r.createDecoderResult(U)},r.merge=function(e,o){if(e==null&&o==null)return null;var l=r.getBarcodeMetadata(e,o);if(l==null)return null;var h=Rw.merge(r.adjustBoundingBox(e),r.adjustBoundingBox(o));return new z7(l,h)},r.adjustBoundingBox=function(e){var o,l;if(e==null)return null;var h=e.getRowHeights();if(h==null)return null;var m=r.getMax(h),b=0;try{for(var n=J0(h),C=n.next();!C.done;C=n.next()){var D=C.value;if(b+=m-D,D>0)break}}catch(Z){o={error:Z}}finally{try{C&&!C.done&&(l=n.return)&&l.call(n)}finally{if(o)throw o.error}}for(var L=e.getCodewords(),U=0;b>0&&L[U]==null;U++)b--;for(var q=0,U=h.length-1;U>=0&&(q+=m-h[U],!(h[U]>0));U--);for(var U=L.length-1;q>0&&L[U]==null;U--)q--;return e.getBoundingBox().addMissingRows(b,q,e.isLeft())},r.getMax=function(e){var o,l,h=-1;try{for(var m=J0(e),b=m.next();!b.done;b=m.next()){var n=b.value;h=Math.max(h,n)}}catch(C){o={error:C}}finally{try{b&&!b.done&&(l=m.return)&&l.call(m)}finally{if(o)throw o.error}}return h},r.getBarcodeMetadata=function(e,o){var l;if(e==null||(l=e.getBarcodeMetadata())==null)return o==null?null:o.getBarcodeMetadata();var h;return o==null||(h=o.getBarcodeMetadata())==null?l:l.getColumnCount()!==h.getColumnCount()&&l.getErrorCorrectionLevel()!==h.getErrorCorrectionLevel()&&l.getRowCount()!==h.getRowCount()?null:l},r.getRowIndicatorColumn=function(e,o,l,h,m,b){for(var n=new VC(o,h),C=0;C<2;C++)for(var D=C===0?1:-1,L=Math.trunc(Math.trunc(l.getX())),U=Math.trunc(Math.trunc(l.getY()));U<=o.getMaxY()&&U>=o.getMinY();U+=D){var q=r.detectCodeword(e,0,e.getWidth(),h,L,U,m,b);q!=null&&(n.setCodeword(U,q),h?L=q.getStartX():L=q.getEndX())}return n},r.adjustCodewordCount=function(e,o){var l=o[0][1],h=l.getValue(),m=e.getBarcodeColumnCount()*e.getBarcodeRowCount()-r.getNumberOfECCodeWords(e.getBarcodeECLevel());if(h.length===0){if(m<1||m>Dn.MAX_CODEWORDS_IN_BARCODE)throw Xt.getNotFoundInstance();l.setValue(m)}else h[0]!==m&&l.setValue(m)},r.createDecoderResult=function(e){var o=r.createBarcodeMatrix(e);r.adjustCodewordCount(e,o);for(var l=new Array,h=new Int32Array(e.getBarcodeRowCount()*e.getBarcodeColumnCount()),m=[],b=new Array,n=0;n<e.getBarcodeRowCount();n++)for(var C=0;C<e.getBarcodeColumnCount();C++){var D=o[n][C+1].getValue(),L=n*e.getBarcodeColumnCount()+C;D.length===0?l.push(L):D.length===1?h[L]=D[0]:(b.push(L),m.push(D))}for(var U=new Array(m.length),q=0;q<U.length;q++)U[q]=m[q];return r.createDecoderResultFromAmbiguousValues(e.getBarcodeECLevel(),h,Dn.toIntArray(l),Dn.toIntArray(b),U)},r.createDecoderResultFromAmbiguousValues=function(e,o,l,h,m){for(var b=new Int32Array(h.length),n=100;n-- >0;){for(var C=0;C<b.length;C++)o[h[C]]=m[C][b[C]];try{return r.decodeCodewords(o,e,l)}catch(L){var D=L instanceof Ka;if(!D)throw L}if(b.length===0)throw Ka.getChecksumInstance();for(var C=0;C<b.length;C++)if(b[C]<m[C].length-1){b[C]++;break}else if(b[C]=0,C===b.length-1)throw Ka.getChecksumInstance()}throw Ka.getChecksumInstance()},r.createBarcodeMatrix=function(e){for(var o,l,h,m,b=Array.from({length:e.getBarcodeRowCount()},function(){return new Array(e.getBarcodeColumnCount()+2)}),n=0;n<b.length;n++)for(var C=0;C<b[n].length;C++)b[n][C]=new oy;var D=0;try{for(var L=J0(e.getDetectionResultColumns()),U=L.next();!U.done;U=L.next()){var q=U.value;if(q!=null)try{for(var Z=(h=void 0,J0(q.getCodewords())),ie=Z.next();!ie.done;ie=Z.next()){var ne=ie.value;if(ne!=null){var be=ne.getRowNumber();if(be>=0){if(be>=b.length)continue;b[be][D].setValue(ne.getValue())}}}}catch(ve){h={error:ve}}finally{try{ie&&!ie.done&&(m=Z.return)&&m.call(Z)}finally{if(h)throw h.error}}D++}}catch(ve){o={error:ve}}finally{try{U&&!U.done&&(l=L.return)&&l.call(L)}finally{if(o)throw o.error}}return b},r.isValidBarcodeColumn=function(e,o){return o>=0&&o<=e.getBarcodeColumnCount()+1},r.getStartColumn=function(e,o,l,h){var m,b,n=h?1:-1,C=null;if(r.isValidBarcodeColumn(e,o-n)&&(C=e.getDetectionResultColumn(o-n).getCodeword(l)),C!=null)return h?C.getEndX():C.getStartX();if(C=e.getDetectionResultColumn(o).getCodewordNearby(l),C!=null)return h?C.getStartX():C.getEndX();if(r.isValidBarcodeColumn(e,o-n)&&(C=e.getDetectionResultColumn(o-n).getCodewordNearby(l)),C!=null)return h?C.getEndX():C.getStartX();for(var D=0;r.isValidBarcodeColumn(e,o-n);){o-=n;try{for(var L=(m=void 0,J0(e.getDetectionResultColumn(o).getCodewords())),U=L.next();!U.done;U=L.next()){var q=U.value;if(q!=null)return(h?q.getEndX():q.getStartX())+n*D*(q.getEndX()-q.getStartX())}}catch(Z){m={error:Z}}finally{try{U&&!U.done&&(b=L.return)&&b.call(L)}finally{if(m)throw m.error}}D++}return h?e.getBoundingBox().getMinX():e.getBoundingBox().getMaxX()},r.detectCodeword=function(e,o,l,h,m,b,n,C){m=r.adjustCodewordStartColumn(e,o,l,h,m,b);var D=r.getModuleBitCount(e,o,l,h,m,b);if(D==null)return null;var L,U=zn.sum(D);if(h)L=m+U;else{for(var q=0;q<D.length/2;q++){var Z=D[q];D[q]=D[D.length-1-q],D[D.length-1-q]=Z}L=m,m=L-U}if(!r.checkCodewordSkew(U,n,C))return null;var ie=k7.getDecodedValue(D),ne=Dn.getCodeword(ie);return ne===-1?null:new F7(m,L,r.getCodewordBucketNumber(ie),ne)},r.getModuleBitCount=function(e,o,l,h,m,b){for(var n=m,C=new Int32Array(8),D=0,L=h?1:-1,U=h;(h?n<l:n>=o)&&D<C.length;)e.get(n,b)===U?(C[D]++,n+=L):(D++,U=!U);return D===C.length||n===(h?l:o)&&D===C.length-1?C:null},r.getNumberOfECCodeWords=function(e){return 2<<e},r.adjustCodewordStartColumn=function(e,o,l,h,m,b){for(var n=m,C=h?-1:1,D=0;D<2;D++){for(;(h?n>=o:n<l)&&h===e.get(n,b);){if(Math.abs(m-n)>r.CODEWORD_SKEW_SIZE)return m;n+=C}C=-C,h=!h}return n},r.checkCodewordSkew=function(e,o,l){return o-r.CODEWORD_SKEW_SIZE<=e&&e<=l+r.CODEWORD_SKEW_SIZE},r.decodeCodewords=function(e,o,l){if(e.length===0)throw Ir.getFormatInstance();var h=1<<o+1,m=r.correctErrors(e,l,h);r.verifyCodewordCount(e,h);var b=Z7.decode(e,""+o);return b.setErrorsCorrected(m),b.setErasures(l.length),b},r.correctErrors=function(e,o,l){if(o!=null&&o.length>l/2+r.MAX_ERRORS||l<0||l>r.MAX_EC_CODEWORDS)throw Ka.getChecksumInstance();return r.errorCorrection.decode(e,l,o)},r.verifyCodewordCount=function(e,o){if(e.length<4)throw Ir.getFormatInstance();var l=e[0];if(l>e.length)throw Ir.getFormatInstance();if(l===0)if(o<e.length)e[0]=e.length-o;else throw Ir.getFormatInstance()},r.getBitCountForCodeword=function(e){for(var o=new Int32Array(8),l=0,h=o.length-1;!((e&1)!==l&&(l=e&1,h--,h<0));)o[h]++,e>>=1;return o},r.getCodewordBucketNumber=function(e){return e instanceof Int32Array?this.getCodewordBucketNumber_Int32Array(e):this.getCodewordBucketNumber_number(e)},r.getCodewordBucketNumber_number=function(e){return r.getCodewordBucketNumber(r.getBitCountForCodeword(e))},r.getCodewordBucketNumber_Int32Array=function(e){return(e[0]-e[2]+e[4]-e[6]+9)%9},r.toString=function(e){for(var o=new B2,l=0;l<e.length;l++){o.format("Row %2d: ",l);for(var h=0;h<e[l].length;h++){var m=e[l][h];m.getValue().length===0?o.format("        ",null):o.format("%4d(%2d)",m.getValue()[0],m.getConfidence(m.getValue()[0]))}o.format("%n")}return o.toString()},r.CODEWORD_SKEW_SIZE=2,r.MAX_ERRORS=3,r.MAX_EC_CODEWORDS=512,r.errorCorrection=new R7,r})(),Y7=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Mw=(function(){function r(){}return r.prototype.decode=function(e,o){o===void 0&&(o=null);var l=r.decode(e,o,!1);if(l==null||l.length===0||l[0]==null)throw Xt.getNotFoundInstance();return l[0]},r.prototype.decodeMultiple=function(e,o){o===void 0&&(o=null);try{return r.decode(e,o,!0)}catch(l){throw l instanceof Ir||l instanceof Ka?Xt.getNotFoundInstance():l}},r.decode=function(e,o,l){var h,m,b=new Array,n=S7.detectMultiple(e,o,l);try{for(var C=Y7(n.getPoints()),D=C.next();!D.done;D=C.next()){var L=D.value,U=W7.decode(n.getBits(),L[4],L[5],L[6],L[7],r.getMinCodewordWidth(L),r.getMaxCodewordWidth(L)),q=new Hs(U.getText(),U.getRawBytes(),void 0,L,yi.PDF_417);q.putMetadata(gs.ERROR_CORRECTION_LEVEL,U.getECLevel());var Z=U.getOther();Z!=null&&q.putMetadata(gs.PDF417_EXTRA_METADATA,Z),b.push(q)}}catch(ie){h={error:ie}}finally{try{D&&!D.done&&(m=C.return)&&m.call(C)}finally{if(h)throw h.error}}return b.map(function(ie){return ie})},r.getMaxWidth=function(e,o){return e==null||o==null?0:Math.trunc(Math.abs(e.getX()-o.getX()))},r.getMinWidth=function(e,o){return e==null||o==null?pn.MAX_VALUE:Math.trunc(Math.abs(e.getX()-o.getX()))},r.getMaxCodewordWidth=function(e){return Math.floor(Math.max(Math.max(r.getMaxWidth(e[0],e[4]),r.getMaxWidth(e[6],e[2])*Dn.MODULES_IN_CODEWORD/Dn.MODULES_IN_STOP_PATTERN),Math.max(r.getMaxWidth(e[1],e[5]),r.getMaxWidth(e[7],e[3])*Dn.MODULES_IN_CODEWORD/Dn.MODULES_IN_STOP_PATTERN)))},r.getMinCodewordWidth=function(e){return Math.floor(Math.min(Math.min(r.getMinWidth(e[0],e[4]),r.getMinWidth(e[6],e[2])*Dn.MODULES_IN_CODEWORD/Dn.MODULES_IN_STOP_PATTERN),Math.min(r.getMinWidth(e[1],e[5]),r.getMinWidth(e[7],e[3])*Dn.MODULES_IN_CODEWORD/Dn.MODULES_IN_STOP_PATTERN)))},r.prototype.reset=function(){},r})(),Q7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),jC=(function(r){Q7(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="ReaderException",e})(Xl),GC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},K7=(function(){function r(){}return r.prototype.decode=function(e,o){return this.setHints(o),this.decodeInternal(e)},r.prototype.decodeWithState=function(e){return(this.readers===null||this.readers===void 0)&&this.setHints(null),this.decodeInternal(e)},r.prototype.setHints=function(e){this.hints=e;var o=e!=null&&e.get(Io.TRY_HARDER)!==void 0,l=e==null?null:e.get(Io.POSSIBLE_FORMATS),h=new Array;if(l!=null){var m=l.some(function(b){return b===yi.UPC_A||b===yi.UPC_E||b===yi.EAN_13||b===yi.EAN_8||b===yi.CODABAR||b===yi.CODE_39||b===yi.CODE_93||b===yi.CODE_128||b===yi.ITF||b===yi.RSS_14||b===yi.RSS_EXPANDED});m&&!o&&h.push(new ny(e)),l.includes(yi.QR_CODE)&&h.push(new Iw),l.includes(yi.DATA_MATRIX)&&h.push(new Cw),l.includes(yi.AZTEC)&&h.push(new Aw),l.includes(yi.PDF_417)&&h.push(new Mw),m&&o&&h.push(new ny(e))}h.length===0&&(o||h.push(new ny(e)),h.push(new Iw),h.push(new Cw),h.push(new Aw),h.push(new Mw),o&&h.push(new ny(e))),this.readers=h},r.prototype.reset=function(){var e,o;if(this.readers!==null)try{for(var l=GC(this.readers),h=l.next();!h.done;h=l.next()){var m=h.value;m.reset()}}catch(b){e={error:b}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(e)throw e.error}}},r.prototype.decodeInternal=function(e){var o,l;if(this.readers===null)throw new jC("No readers where selected, nothing can be read.");try{for(var h=GC(this.readers),m=h.next();!m.done;m=h.next()){var b=m.value;try{return b.decode(e,this.hints)}catch(n){if(n instanceof jC)continue}}}catch(n){o={error:n}}finally{try{m&&!m.done&&(l=h.return)&&l.call(h)}finally{if(o)throw o.error}}throw new Xt("No MultiFormat Readers were able to detect the code.")},r})(),J7=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){J7(e,r);function e(o,l){o===void 0&&(o=null),l===void 0&&(l=500);var h=this,m=new K7;return m.setHints(o),h=r.call(this,m,l)||this,h}return e.prototype.decodeBitmap=function(o){return this.reader.decodeWithState(o)},e})(J_);var eV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){eV(e,r);function e(o){return o===void 0&&(o=500),r.call(this,new Mw,o)||this}return e})(J_);var tV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){tV(e,r);function e(o){return o===void 0&&(o=500),r.call(this,new Iw,o)||this}return e})(J_);var Dw;(function(r){r[r.ERROR_CORRECTION=0]="ERROR_CORRECTION",r[r.CHARACTER_SET=1]="CHARACTER_SET",r[r.DATA_MATRIX_SHAPE=2]="DATA_MATRIX_SHAPE",r[r.DATA_MATRIX_COMPACT=3]="DATA_MATRIX_COMPACT",r[r.MIN_SIZE=4]="MIN_SIZE",r[r.MAX_SIZE=5]="MAX_SIZE",r[r.MARGIN=6]="MARGIN",r[r.PDF417_COMPACT=7]="PDF417_COMPACT",r[r.PDF417_COMPACTION=8]="PDF417_COMPACTION",r[r.PDF417_DIMENSIONS=9]="PDF417_DIMENSIONS",r[r.AZTEC_LAYERS=10]="AZTEC_LAYERS",r[r.QR_VERSION=11]="QR_VERSION",r[r.GS1_FORMAT=12]="GS1_FORMAT",r[r.FORCE_C40=13]="FORCE_C40"})(Dw||(Dw={}));const lv=Dw;var jR=(function(){function r(e){this.field=e,this.cachedGenerators=[],this.cachedGenerators.push(new cm(e,Int32Array.from([1])))}return r.prototype.buildGenerator=function(e){var o=this.cachedGenerators;if(e>=o.length)for(var l=o[o.length-1],h=this.field,m=o.length;m<=e;m++){var b=l.multiply(new cm(h,Int32Array.from([1,h.exp(m-1+h.getGeneratorBase())])));o.push(b),l=b}return o[e]},r.prototype.encode=function(e,o){if(o===0)throw new bi("No error correction bytes");var l=e.length-o;if(l<=0)throw new bi("No data bytes provided");var h=this.buildGenerator(o),m=new Int32Array(l);yo.arraycopy(e,0,m,0,l);var b=new cm(this.field,m);b=b.multiplyByMonomial(o,1);for(var n=b.divide(h)[1],C=n.getCoefficients(),D=o-C.length,L=0;L<D;L++)e[l+L]=0;yo.arraycopy(C,0,e,l+D,C.length)},r})(),ay=(function(){function r(){}return r.applyMaskPenaltyRule1=function(e){return r.applyMaskPenaltyRule1Internal(e,!0)+r.applyMaskPenaltyRule1Internal(e,!1)},r.applyMaskPenaltyRule2=function(e){for(var o=0,l=e.getArray(),h=e.getWidth(),m=e.getHeight(),b=0;b<m-1;b++)for(var n=l[b],C=0;C<h-1;C++){var D=n[C];D===n[C+1]&&D===l[b+1][C]&&D===l[b+1][C+1]&&o++}return r.N2*o},r.applyMaskPenaltyRule3=function(e){for(var o=0,l=e.getArray(),h=e.getWidth(),m=e.getHeight(),b=0;b<m;b++)for(var n=0;n<h;n++){var C=l[b];n+6<h&&C[n]===1&&C[n+1]===0&&C[n+2]===1&&C[n+3]===1&&C[n+4]===1&&C[n+5]===0&&C[n+6]===1&&(r.isWhiteHorizontal(C,n-4,n)||r.isWhiteHorizontal(C,n+7,n+11))&&o++,b+6<m&&l[b][n]===1&&l[b+1][n]===0&&l[b+2][n]===1&&l[b+3][n]===1&&l[b+4][n]===1&&l[b+5][n]===0&&l[b+6][n]===1&&(r.isWhiteVertical(l,n,b-4,b)||r.isWhiteVertical(l,n,b+7,b+11))&&o++}return o*r.N3},r.isWhiteHorizontal=function(e,o,l){o=Math.max(o,0),l=Math.min(l,e.length);for(var h=o;h<l;h++)if(e[h]===1)return!1;return!0},r.isWhiteVertical=function(e,o,l,h){l=Math.max(l,0),h=Math.min(h,e.length);for(var m=l;m<h;m++)if(e[m][o]===1)return!1;return!0},r.applyMaskPenaltyRule4=function(e){for(var o=0,l=e.getArray(),h=e.getWidth(),m=e.getHeight(),b=0;b<m;b++)for(var n=l[b],C=0;C<h;C++)n[C]===1&&o++;var D=e.getHeight()*e.getWidth(),L=Math.floor(Math.abs(o*2-D)*10/D);return L*r.N4},r.getDataMaskBit=function(e,o,l){var h,m;switch(e){case 0:h=l+o&1;break;case 1:h=l&1;break;case 2:h=o%3;break;case 3:h=(l+o)%3;break;case 4:h=Math.floor(l/2)+Math.floor(o/3)&1;break;case 5:m=l*o,h=(m&1)+m%3;break;case 6:m=l*o,h=(m&1)+m%3&1;break;case 7:m=l*o,h=m%3+(l+o&1)&1;break;default:throw new bi("Invalid mask pattern: "+e)}return h===0},r.applyMaskPenaltyRule1Internal=function(e,o){for(var l=0,h=o?e.getHeight():e.getWidth(),m=o?e.getWidth():e.getHeight(),b=e.getArray(),n=0;n<h;n++){for(var C=0,D=-1,L=0;L<m;L++){var U=o?b[n][L]:b[L][n];U===D?C++:(C>=5&&(l+=r.N1+(C-5)),C=1,D=U)}C>=5&&(l+=r.N1+(C-5))}return l},r.N1=3,r.N2=3,r.N3=40,r.N4=10,r})(),rV=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},iV=(function(){function r(e,o){this.width=e,this.height=o;for(var l=new Array(o),h=0;h!==o;h++)l[h]=new Uint8Array(e);this.bytes=l}return r.prototype.getHeight=function(){return this.height},r.prototype.getWidth=function(){return this.width},r.prototype.get=function(e,o){return this.bytes[o][e]},r.prototype.getArray=function(){return this.bytes},r.prototype.setNumber=function(e,o,l){this.bytes[o][e]=l},r.prototype.setBoolean=function(e,o,l){this.bytes[o][e]=l?1:0},r.prototype.clear=function(e){var o,l;try{for(var h=rV(this.bytes),m=h.next();!m.done;m=h.next()){var b=m.value;ka.fill(b,e)}}catch(n){o={error:n}}finally{try{m&&!m.done&&(l=h.return)&&l.call(h)}finally{if(o)throw o.error}}},r.prototype.equals=function(e){if(!(e instanceof r))return!1;var o=e;if(this.width!==o.width||this.height!==o.height)return!1;for(var l=0,h=this.height;l<h;++l)for(var m=this.bytes[l],b=o.bytes[l],n=0,C=this.width;n<C;++n)if(m[n]!==b[n])return!1;return!0},r.prototype.toString=function(){for(var e=new cn,o=0,l=this.height;o<l;++o){for(var h=this.bytes[o],m=0,b=this.width;m<b;++m)switch(h[m]){case 0:e.append(" 0");break;case 1:e.append(" 1");break;default:e.append("  ");break}e.append(`
`)}return e.toString()},r})(),Ow=(function(){function r(){this.maskPattern=-1}return r.prototype.getMode=function(){return this.mode},r.prototype.getECLevel=function(){return this.ecLevel},r.prototype.getVersion=function(){return this.version},r.prototype.getMaskPattern=function(){return this.maskPattern},r.prototype.getMatrix=function(){return this.matrix},r.prototype.toString=function(){var e=new cn;return e.append(`<<
`),e.append(" mode: "),e.append(this.mode?this.mode.toString():"null"),e.append(`
 ecLevel: `),e.append(this.ecLevel?this.ecLevel.toString():"null"),e.append(`
 version: `),e.append(this.version?this.version.toString():"null"),e.append(`
 maskPattern: `),e.append(this.maskPattern.toString()),this.matrix?(e.append(`
 matrix:
`),e.append(this.matrix.toString())):e.append(`
 matrix: null
`),e.append(`>>
`),e.toString()},r.prototype.setMode=function(e){this.mode=e},r.prototype.setECLevel=function(e){this.ecLevel=e},r.prototype.setVersion=function(e){this.version=e},r.prototype.setMaskPattern=function(e){this.maskPattern=e},r.prototype.setMatrix=function(e){this.matrix=e},r.isValidMaskPattern=function(e){return e>=0&&e<r.NUM_MASK_PATTERNS},r.NUM_MASK_PATTERNS=8,r})(),nV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),So=(function(r){nV(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.kind="WriterException",e})(Xl),HC=(function(){function r(){}return r.clearMatrix=function(e){e.clear(255)},r.buildMatrix=function(e,o,l,h,m){r.clearMatrix(m),r.embedBasicPatterns(l,m),r.embedTypeInfo(o,h,m),r.maybeEmbedVersionInfo(l,m),r.embedDataBits(e,h,m)},r.embedBasicPatterns=function(e,o){r.embedPositionDetectionPatternsAndSeparators(o),r.embedDarkDotAtLeftBottomCorner(o),r.maybeEmbedPositionAdjustmentPatterns(e,o),r.embedTimingPatterns(o)},r.embedTypeInfo=function(e,o,l){var h=new Ja;r.makeTypeInfoBits(e,o,h);for(var m=0,b=h.getSize();m<b;++m){var n=h.get(h.getSize()-1-m),C=r.TYPE_INFO_COORDINATES[m],D=C[0],L=C[1];if(l.setBoolean(D,L,n),m<8){var U=l.getWidth()-m-1,q=8;l.setBoolean(U,q,n)}else{var U=8,q=l.getHeight()-7+(m-8);l.setBoolean(U,q,n)}}},r.maybeEmbedVersionInfo=function(e,o){if(!(e.getVersionNumber()<7)){var l=new Ja;r.makeVersionInfoBits(e,l);for(var h=17,m=0;m<6;++m)for(var b=0;b<3;++b){var n=l.get(h);h--,o.setBoolean(m,o.getHeight()-11+b,n),o.setBoolean(o.getHeight()-11+b,m,n)}}},r.embedDataBits=function(e,o,l){for(var h=0,m=-1,b=l.getWidth()-1,n=l.getHeight()-1;b>0;){for(b===6&&(b-=1);n>=0&&n<l.getHeight();){for(var C=0;C<2;++C){var D=b-C;if(r.isEmpty(l.get(D,n))){var L=void 0;h<e.getSize()?(L=e.get(h),++h):L=!1,o!==255&&ay.getDataMaskBit(o,D,n)&&(L=!L),l.setBoolean(D,n,L)}}n+=m}m=-m,n+=m,b-=2}if(h!==e.getSize())throw new So("Not all bits consumed: "+h+"/"+e.getSize())},r.findMSBSet=function(e){return 32-pn.numberOfLeadingZeros(e)},r.calculateBCHCode=function(e,o){if(o===0)throw new bi("0 polynomial");var l=r.findMSBSet(o);for(e<<=l-1;r.findMSBSet(e)>=l;)e^=o<<r.findMSBSet(e)-l;return e},r.makeTypeInfoBits=function(e,o,l){if(!Ow.isValidMaskPattern(o))throw new So("Invalid mask pattern");var h=e.getBits()<<3|o;l.appendBits(h,5);var m=r.calculateBCHCode(h,r.TYPE_INFO_POLY);l.appendBits(m,10);var b=new Ja;if(b.appendBits(r.TYPE_INFO_MASK_PATTERN,15),l.xor(b),l.getSize()!==15)throw new So("should not happen but we got: "+l.getSize())},r.makeVersionInfoBits=function(e,o){o.appendBits(e.getVersionNumber(),6);var l=r.calculateBCHCode(e.getVersionNumber(),r.VERSION_INFO_POLY);if(o.appendBits(l,12),o.getSize()!==18)throw new So("should not happen but we got: "+o.getSize())},r.isEmpty=function(e){return e===255},r.embedTimingPatterns=function(e){for(var o=8;o<e.getWidth()-8;++o){var l=(o+1)%2;r.isEmpty(e.get(o,6))&&e.setNumber(o,6,l),r.isEmpty(e.get(6,o))&&e.setNumber(6,o,l)}},r.embedDarkDotAtLeftBottomCorner=function(e){if(e.get(8,e.getHeight()-8)===0)throw new So;e.setNumber(8,e.getHeight()-8,1)},r.embedHorizontalSeparationPattern=function(e,o,l){for(var h=0;h<8;++h){if(!r.isEmpty(l.get(e+h,o)))throw new So;l.setNumber(e+h,o,0)}},r.embedVerticalSeparationPattern=function(e,o,l){for(var h=0;h<7;++h){if(!r.isEmpty(l.get(e,o+h)))throw new So;l.setNumber(e,o+h,0)}},r.embedPositionAdjustmentPattern=function(e,o,l){for(var h=0;h<5;++h)for(var m=r.POSITION_ADJUSTMENT_PATTERN[h],b=0;b<5;++b)l.setNumber(e+b,o+h,m[b])},r.embedPositionDetectionPattern=function(e,o,l){for(var h=0;h<7;++h)for(var m=r.POSITION_DETECTION_PATTERN[h],b=0;b<7;++b)l.setNumber(e+b,o+h,m[b])},r.embedPositionDetectionPatternsAndSeparators=function(e){var o=r.POSITION_DETECTION_PATTERN[0].length;r.embedPositionDetectionPattern(0,0,e),r.embedPositionDetectionPattern(e.getWidth()-o,0,e),r.embedPositionDetectionPattern(0,e.getWidth()-o,e);var l=8;r.embedHorizontalSeparationPattern(0,l-1,e),r.embedHorizontalSeparationPattern(e.getWidth()-l,l-1,e),r.embedHorizontalSeparationPattern(0,e.getWidth()-l,e);var h=7;r.embedVerticalSeparationPattern(h,0,e),r.embedVerticalSeparationPattern(e.getHeight()-h-1,0,e),r.embedVerticalSeparationPattern(h,e.getHeight()-h,e)},r.maybeEmbedPositionAdjustmentPatterns=function(e,o){if(!(e.getVersionNumber()<2))for(var l=e.getVersionNumber()-1,h=r.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE[l],m=0,b=h.length;m!==b;m++){var n=h[m];if(n>=0)for(var C=0;C!==b;C++){var D=h[C];D>=0&&r.isEmpty(o.get(D,n))&&r.embedPositionAdjustmentPattern(D-2,n-2,o)}}},r.POSITION_DETECTION_PATTERN=Array.from([Int32Array.from([1,1,1,1,1,1,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,1,1,1,0,1]),Int32Array.from([1,0,0,0,0,0,1]),Int32Array.from([1,1,1,1,1,1,1])]),r.POSITION_ADJUSTMENT_PATTERN=Array.from([Int32Array.from([1,1,1,1,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,0,1,0,1]),Int32Array.from([1,0,0,0,1]),Int32Array.from([1,1,1,1,1])]),r.POSITION_ADJUSTMENT_PATTERN_COORDINATE_TABLE=Array.from([Int32Array.from([-1,-1,-1,-1,-1,-1,-1]),Int32Array.from([6,18,-1,-1,-1,-1,-1]),Int32Array.from([6,22,-1,-1,-1,-1,-1]),Int32Array.from([6,26,-1,-1,-1,-1,-1]),Int32Array.from([6,30,-1,-1,-1,-1,-1]),Int32Array.from([6,34,-1,-1,-1,-1,-1]),Int32Array.from([6,22,38,-1,-1,-1,-1]),Int32Array.from([6,24,42,-1,-1,-1,-1]),Int32Array.from([6,26,46,-1,-1,-1,-1]),Int32Array.from([6,28,50,-1,-1,-1,-1]),Int32Array.from([6,30,54,-1,-1,-1,-1]),Int32Array.from([6,32,58,-1,-1,-1,-1]),Int32Array.from([6,34,62,-1,-1,-1,-1]),Int32Array.from([6,26,46,66,-1,-1,-1]),Int32Array.from([6,26,48,70,-1,-1,-1]),Int32Array.from([6,26,50,74,-1,-1,-1]),Int32Array.from([6,30,54,78,-1,-1,-1]),Int32Array.from([6,30,56,82,-1,-1,-1]),Int32Array.from([6,30,58,86,-1,-1,-1]),Int32Array.from([6,34,62,90,-1,-1,-1]),Int32Array.from([6,28,50,72,94,-1,-1]),Int32Array.from([6,26,50,74,98,-1,-1]),Int32Array.from([6,30,54,78,102,-1,-1]),Int32Array.from([6,28,54,80,106,-1,-1]),Int32Array.from([6,32,58,84,110,-1,-1]),Int32Array.from([6,30,58,86,114,-1,-1]),Int32Array.from([6,34,62,90,118,-1,-1]),Int32Array.from([6,26,50,74,98,122,-1]),Int32Array.from([6,30,54,78,102,126,-1]),Int32Array.from([6,26,52,78,104,130,-1]),Int32Array.from([6,30,56,82,108,134,-1]),Int32Array.from([6,34,60,86,112,138,-1]),Int32Array.from([6,30,58,86,114,142,-1]),Int32Array.from([6,34,62,90,118,146,-1]),Int32Array.from([6,30,54,78,102,126,150]),Int32Array.from([6,24,50,76,102,128,154]),Int32Array.from([6,28,54,80,106,132,158]),Int32Array.from([6,32,58,84,110,136,162]),Int32Array.from([6,26,54,82,110,138,166]),Int32Array.from([6,30,58,86,114,142,170])]),r.TYPE_INFO_COORDINATES=Array.from([Int32Array.from([8,0]),Int32Array.from([8,1]),Int32Array.from([8,2]),Int32Array.from([8,3]),Int32Array.from([8,4]),Int32Array.from([8,5]),Int32Array.from([8,7]),Int32Array.from([8,8]),Int32Array.from([7,8]),Int32Array.from([5,8]),Int32Array.from([4,8]),Int32Array.from([3,8]),Int32Array.from([2,8]),Int32Array.from([1,8]),Int32Array.from([0,8])]),r.VERSION_INFO_POLY=7973,r.TYPE_INFO_POLY=1335,r.TYPE_INFO_MASK_PATTERN=21522,r})(),oV=(function(){function r(e,o){this.dataBytes=e,this.errorCorrectionBytes=o}return r.prototype.getDataBytes=function(){return this.dataBytes},r.prototype.getErrorCorrectionBytes=function(){return this.errorCorrectionBytes},r})(),qC=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};(function(){function r(){}return r.calculateMaskPenalty=function(e){return ay.applyMaskPenaltyRule1(e)+ay.applyMaskPenaltyRule2(e)+ay.applyMaskPenaltyRule3(e)+ay.applyMaskPenaltyRule4(e)},r.encode=function(e,o,l){l===void 0&&(l=null);var h=r.DEFAULT_BYTE_MODE_ENCODING,m=l!==null&&l.get(lv.CHARACTER_SET)!==void 0;m&&(h=l.get(lv.CHARACTER_SET).toString());var b=this.chooseMode(e,h),n=new Ja;if(b===To.BYTE&&(m||r.DEFAULT_BYTE_MODE_ENCODING!==h)){var C=Fa.getCharacterSetECIByName(h);C!==void 0&&this.appendECI(C,n)}this.appendModeInfo(b,n);var D=new Ja;this.appendBytes(e,b,D,h);var L;if(l!==null&&l.get(lv.QR_VERSION)!==void 0){var U=Number.parseInt(l.get(lv.QR_VERSION).toString(),10);L=wg.getVersionForNumber(U);var q=this.calculateBitsNeeded(b,n,D,L);if(!this.willFit(q,L,o))throw new So("Data too big for requested version")}else L=this.recommendVersion(o,b,n,D);var Z=new Ja;Z.appendBitArray(n);var ie=b===To.BYTE?D.getSizeInBytes():e.length;this.appendLengthInfo(ie,L,b,Z),Z.appendBitArray(D);var ne=L.getECBlocksForLevel(o),be=L.getTotalCodewords()-ne.getTotalECCodewords();this.terminateBits(be,Z);var ve=this.interleaveWithECBytes(Z,L.getTotalCodewords(),be,ne.getNumBlocks()),we=new Ow;we.setECLevel(o),we.setMode(b),we.setVersion(L);var Pe=L.getDimensionForVersion(),Ze=new iV(Pe,Pe),$e=this.chooseMaskPattern(ve,o,L,Ze);return we.setMaskPattern($e),HC.buildMatrix(ve,o,L,$e,Ze),we.setMatrix(Ze),we},r.recommendVersion=function(e,o,l,h){var m=this.calculateBitsNeeded(o,l,h,wg.getVersionForNumber(1)),b=this.chooseVersion(m,e),n=this.calculateBitsNeeded(o,l,h,b);return this.chooseVersion(n,e)},r.calculateBitsNeeded=function(e,o,l,h){return o.getSize()+e.getCharacterCountBits(h)+l.getSize()},r.getAlphanumericCode=function(e){return e<r.ALPHANUMERIC_TABLE.length?r.ALPHANUMERIC_TABLE[e]:-1},r.chooseMode=function(e,o){if(o===void 0&&(o=null),Fa.SJIS.getName()===o&&this.isOnlyDoubleByteKanji(e))return To.KANJI;for(var l=!1,h=!1,m=0,b=e.length;m<b;++m){var n=e.charAt(m);if(r.isDigit(n))l=!0;else if(this.getAlphanumericCode(n.charCodeAt(0))!==-1)h=!0;else return To.BYTE}return h?To.ALPHANUMERIC:l?To.NUMERIC:To.BYTE},r.isOnlyDoubleByteKanji=function(e){var o;try{o=Bu.encode(e,Fa.SJIS)}catch{return!1}var l=o.length;if(l%2!==0)return!1;for(var h=0;h<l;h+=2){var m=o[h]&255;if((m<129||m>159)&&(m<224||m>235))return!1}return!0},r.chooseMaskPattern=function(e,o,l,h){for(var m=Number.MAX_SAFE_INTEGER,b=-1,n=0;n<Ow.NUM_MASK_PATTERNS;n++){HC.buildMatrix(e,o,l,n,h);var C=this.calculateMaskPenalty(h);C<m&&(m=C,b=n)}return b},r.chooseVersion=function(e,o){for(var l=1;l<=40;l++){var h=wg.getVersionForNumber(l);if(r.willFit(e,h,o))return h}throw new So("Data too big")},r.willFit=function(e,o,l){var h=o.getTotalCodewords(),m=o.getECBlocksForLevel(l),b=m.getTotalECCodewords(),n=h-b,C=(e+7)/8;return n>=C},r.terminateBits=function(e,o){var l=e*8;if(o.getSize()>l)throw new So("data bits cannot fit in the QR Code"+o.getSize()+" > "+l);for(var h=0;h<4&&o.getSize()<l;++h)o.appendBit(!1);var m=o.getSize()&7;if(m>0)for(var h=m;h<8;h++)o.appendBit(!1);for(var b=e-o.getSizeInBytes(),h=0;h<b;++h)o.appendBits((h&1)===0?236:17,8);if(o.getSize()!==l)throw new So("Bits size does not equal capacity")},r.getNumDataBytesAndNumECBytesForBlockID=function(e,o,l,h,m,b){if(h>=l)throw new So("Block ID too large");var n=e%l,C=l-n,D=Math.floor(e/l),L=D+1,U=Math.floor(o/l),q=U+1,Z=D-U,ie=L-q;if(Z!==ie)throw new So("EC bytes mismatch");if(l!==C+n)throw new So("RS blocks mismatch");if(e!==(U+Z)*C+(q+ie)*n)throw new So("Total bytes mismatch");h<C?(m[0]=U,b[0]=Z):(m[0]=q,b[0]=ie)},r.interleaveWithECBytes=function(e,o,l,h){var m,b,n,C;if(e.getSizeInBytes()!==l)throw new So("Number of bits and data bytes does not match");for(var D=0,L=0,U=0,q=new Array,Z=0;Z<h;++Z){var ie=new Int32Array(1),ne=new Int32Array(1);r.getNumDataBytesAndNumECBytesForBlockID(o,l,h,Z,ie,ne);var be=ie[0],ve=new Uint8Array(be);e.toBytes(8*D,ve,0,be);var we=r.generateECBytes(ve,ne[0]);q.push(new oV(ve,we)),L=Math.max(L,be),U=Math.max(U,we.length),D+=ie[0]}if(l!==D)throw new So("Data bytes does not match offset");for(var Pe=new Ja,Z=0;Z<L;++Z)try{for(var Ze=(m=void 0,qC(q)),$e=Ze.next();!$e.done;$e=Ze.next()){var xt=$e.value,ve=xt.getDataBytes();Z<ve.length&&Pe.appendBits(ve[Z],8)}}catch(hr){m={error:hr}}finally{try{$e&&!$e.done&&(b=Ze.return)&&b.call(Ze)}finally{if(m)throw m.error}}for(var Z=0;Z<U;++Z)try{for(var Ct=(n=void 0,qC(q)),Ft=Ct.next();!Ft.done;Ft=Ct.next()){var xt=Ft.value,we=xt.getErrorCorrectionBytes();Z<we.length&&Pe.appendBits(we[Z],8)}}catch(hr){n={error:hr}}finally{try{Ft&&!Ft.done&&(C=Ct.return)&&C.call(Ct)}finally{if(n)throw n.error}}if(o!==Pe.getSizeInBytes())throw new So("Interleaving error: "+o+" and "+Pe.getSizeInBytes()+" differ.");return Pe},r.generateECBytes=function(e,o){for(var l=e.length,h=new Int32Array(l+o),m=0;m<l;m++)h[m]=e[m]&255;new jR(ql.QR_CODE_FIELD_256).encode(h,o);for(var b=new Uint8Array(o),m=0;m<o;m++)b[m]=h[l+m];return b},r.appendModeInfo=function(e,o){o.appendBits(e.getBits(),4)},r.appendLengthInfo=function(e,o,l,h){var m=l.getCharacterCountBits(o);if(e>=1<<m)throw new So(e+" is bigger than "+((1<<m)-1));h.appendBits(e,m)},r.appendBytes=function(e,o,l,h){switch(o){case To.NUMERIC:r.appendNumericBytes(e,l);break;case To.ALPHANUMERIC:r.appendAlphanumericBytes(e,l);break;case To.BYTE:r.append8BitBytes(e,l,h);break;case To.KANJI:r.appendKanjiBytes(e,l);break;default:throw new So("Invalid mode: "+o)}},r.getDigit=function(e){return e.charCodeAt(0)-48},r.isDigit=function(e){var o=r.getDigit(e);return o>=0&&o<=9},r.appendNumericBytes=function(e,o){for(var l=e.length,h=0;h<l;){var m=r.getDigit(e.charAt(h));if(h+2<l){var b=r.getDigit(e.charAt(h+1)),n=r.getDigit(e.charAt(h+2));o.appendBits(m*100+b*10+n,10),h+=3}else if(h+1<l){var b=r.getDigit(e.charAt(h+1));o.appendBits(m*10+b,7),h+=2}else o.appendBits(m,4),h++}},r.appendAlphanumericBytes=function(e,o){for(var l=e.length,h=0;h<l;){var m=r.getAlphanumericCode(e.charCodeAt(h));if(m===-1)throw new So;if(h+1<l){var b=r.getAlphanumericCode(e.charCodeAt(h+1));if(b===-1)throw new So;o.appendBits(m*45+b,11),h+=2}else o.appendBits(m,6),h++}},r.append8BitBytes=function(e,o,l){var h;try{h=Bu.encode(e,l)}catch(C){throw new So(C)}for(var m=0,b=h.length;m!==b;m++){var n=h[m];o.appendBits(n,8)}},r.appendKanjiBytes=function(e,o){var l;try{l=Bu.encode(e,Fa.SJIS)}catch(U){throw new So(U)}for(var h=l.length,m=0;m<h;m+=2){var b=l[m]&255,n=l[m+1]&255,C=b<<8&4294967295|n,D=-1;if(C>=33088&&C<=40956?D=C-33088:C>=57408&&C<=60351&&(D=C-49472),D===-1)throw new So("Invalid byte sequence");var L=(D>>8)*192+(D&255);o.appendBits(L,13)}},r.appendECI=function(e,o){o.appendBits(To.ECI.getBits(),4),o.appendBits(e.getValue(),8)},r.ALPHANUMERIC_TABLE=Int32Array.from([-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,-1,36,-1,-1,-1,37,38,-1,-1,-1,-1,39,40,-1,41,42,43,0,1,2,3,4,5,6,7,8,9,44,-1,-1,-1,-1,-1,-1,10,11,12,13,14,15,16,17,18,19,20,21,22,23,24,25,26,27,28,29,30,31,32,33,34,35,-1,-1,-1,-1,-1]),r.DEFAULT_BYTE_MODE_ENCODING=Fa.UTF8.getName(),r})();var aV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){aV(e,r);function e(o,l,h,m,b,n,C,D){var L=r.call(this,n,C)||this;if(L.yuvData=o,L.dataWidth=l,L.dataHeight=h,L.left=m,L.top=b,m+n>l||b+C>h)throw new bi("Crop rectangle does not fit within image data.");return D&&L.reverseHorizontal(n,C),L}return e.prototype.getRow=function(o,l){if(o<0||o>=this.getHeight())throw new bi("Requested row is outside the image: "+o);var h=this.getWidth();(l==null||l.length<h)&&(l=new Uint8ClampedArray(h));var m=(o+this.top)*this.dataWidth+this.left;return yo.arraycopy(this.yuvData,m,l,0,h),l},e.prototype.getMatrix=function(){var o=this.getWidth(),l=this.getHeight();if(o===this.dataWidth&&l===this.dataHeight)return this.yuvData;var h=o*l,m=new Uint8ClampedArray(h),b=this.top*this.dataWidth+this.left;if(o===this.dataWidth)return yo.arraycopy(this.yuvData,b,m,0,h),m;for(var n=0;n<l;n++){var C=n*o;yo.arraycopy(this.yuvData,b,m,C,o),b+=this.dataWidth}return m},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(o,l,h,m){return new e(this.yuvData,this.dataWidth,this.dataHeight,this.left+o,this.top+l,h,m,!1)},e.prototype.renderThumbnail=function(){for(var o=this.getWidth()/e.THUMBNAIL_SCALE_FACTOR,l=this.getHeight()/e.THUMBNAIL_SCALE_FACTOR,h=new Int32Array(o*l),m=this.yuvData,b=this.top*this.dataWidth+this.left,n=0;n<l;n++){for(var C=n*o,D=0;D<o;D++){var L=m[b+D*e.THUMBNAIL_SCALE_FACTOR]&255;h[C+D]=4278190080|L*65793}b+=this.dataWidth*e.THUMBNAIL_SCALE_FACTOR}return h},e.prototype.getThumbnailWidth=function(){return this.getWidth()/e.THUMBNAIL_SCALE_FACTOR},e.prototype.getThumbnailHeight=function(){return this.getHeight()/e.THUMBNAIL_SCALE_FACTOR},e.prototype.reverseHorizontal=function(o,l){for(var h=this.yuvData,m=0,b=this.top*this.dataWidth+this.left;m<l;m++,b+=this.dataWidth)for(var n=b+o/2,C=b,D=b+o-1;C<n;C++,D--){var L=h[C];h[C]=h[D],h[D]=L}},e.prototype.invert=function(){return new D2(this)},e.THUMBNAIL_SCALE_FACTOR=2,e})(Xv);var sV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();(function(r){sV(e,r);function e(o,l,h,m,b,n,C){var D=r.call(this,l,h)||this;if(D.dataWidth=m,D.dataHeight=b,D.left=n,D.top=C,o.BYTES_PER_ELEMENT===4){for(var L=l*h,U=new Uint8ClampedArray(L),q=0;q<L;q++){var Z=o[q],ie=Z>>16&255,ne=Z>>7&510,be=Z&255;U[q]=(ie+ne+be)/4&255}D.luminances=U}else D.luminances=o;if(m===void 0&&(D.dataWidth=l),b===void 0&&(D.dataHeight=h),n===void 0&&(D.left=0),C===void 0&&(D.top=0),D.left+l>D.dataWidth||D.top+h>D.dataHeight)throw new bi("Crop rectangle does not fit within image data.");return D}return e.prototype.getRow=function(o,l){if(o<0||o>=this.getHeight())throw new bi("Requested row is outside the image: "+o);var h=this.getWidth();(l==null||l.length<h)&&(l=new Uint8ClampedArray(h));var m=(o+this.top)*this.dataWidth+this.left;return yo.arraycopy(this.luminances,m,l,0,h),l},e.prototype.getMatrix=function(){var o=this.getWidth(),l=this.getHeight();if(o===this.dataWidth&&l===this.dataHeight)return this.luminances;var h=o*l,m=new Uint8ClampedArray(h),b=this.top*this.dataWidth+this.left;if(o===this.dataWidth)return yo.arraycopy(this.luminances,b,m,0,h),m;for(var n=0;n<l;n++){var C=n*o;yo.arraycopy(this.luminances,b,m,C,o),b+=this.dataWidth}return m},e.prototype.isCropSupported=function(){return!0},e.prototype.crop=function(o,l,h,m){return new e(this.luminances,h,m,this.dataWidth,this.dataHeight,this.left+o,this.top+l)},e.prototype.invert=function(){return new D2(this)},e})(Xv);var lV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),cV=(function(r){lV(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.forName=function(o){return this.getCharacterSetECIByName(o)},e})(Fa),uV=(function(){function r(){}return r.ISO_8859_1=Fa.ISO8859_1,r})(),Pw,hV=301,fV=function(r,e){for(var o=1,l=0;l<255;l++)e[l]=o,r[o]=l,o*=2,o>=256&&(o^=hV);return{LOG:r,ALOG:e}};Pw=fV([],[]),Pw.LOG;Pw.ALOG;var $C;(function(r){r[r.FORCE_NONE=0]="FORCE_NONE",r[r.FORCE_SQUARE=1]="FORCE_SQUARE",r[r.FORCE_RECTANGLE=2]="FORCE_RECTANGLE"})($C||($C={}));var XC=129,GR=230,dV=231,pV=235,mV=236,gV=237,_V=238,yV=239,vV=240,Bb=254,xV=254,ZC="[)>05",WC="[)>06",YC="",Jn=0,ds=1,dl=2,La=3,Qa=4,js=5,bV=(function(){function r(){}return r.prototype.getEncodingMode=function(){return Jn},r.prototype.encode=function(e){var o=Th.determineConsecutiveDigitCount(e.getMessage(),e.pos);if(o>=2)e.writeCodeword(this.encodeASCIIDigits(e.getMessage().charCodeAt(e.pos),e.getMessage().charCodeAt(e.pos+1))),e.pos+=2;else{var l=e.getCurrentChar(),h=Th.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode());if(h!==this.getEncodingMode())switch(h){case js:e.writeCodeword(dV),e.signalEncoderChange(js);return;case ds:e.writeCodeword(GR),e.signalEncoderChange(ds);return;case La:e.writeCodeword(_V),e.signalEncoderChange(La);break;case dl:e.writeCodeword(yV),e.signalEncoderChange(dl);break;case Qa:e.writeCodeword(vV),e.signalEncoderChange(Qa);break;default:throw new Error("Illegal mode: "+h)}else Th.isExtendedASCII(l)?(e.writeCodeword(pV),e.writeCodeword(l-128+1),e.pos++):(e.writeCodeword(l+1),e.pos++)}},r.prototype.encodeASCIIDigits=function(e,o){if(Th.isDigit(e)&&Th.isDigit(o)){var l=(e-48)*10+(o-48);return l+130}throw new Error("not digits: "+e+o)},r})(),wV=(function(){function r(){}return r.prototype.getEncodingMode=function(){return js},r.prototype.encode=function(e){var o=new cn;for(o.append(0);e.hasMoreCharacters();){var l=e.getCurrentChar();o.append(l),e.pos++;var h=Th.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode());if(h!==this.getEncodingMode()){e.signalEncoderChange(Jn);break}}var m=o.length()-1,b=1,n=e.getCodewordCount()+m+b;e.updateSymbolInfo(n);var C=e.getSymbolInfo().getDataCapacity()-n>0;if(e.hasMoreCharacters()||C)if(m<=249)o.setCharAt(0,En.getCharAt(m));else if(m<=1555)o.setCharAt(0,En.getCharAt(Math.floor(m/250)+249)),o.insert(1,En.getCharAt(m%250));else throw new Error("Message length not in valid ranges: "+m);for(var D=0,l=o.length();D<l;D++)e.writeCodeword(this.randomize255State(o.charAt(D).charCodeAt(0),e.getCodewordCount()+1))},r.prototype.randomize255State=function(e,o){var l=149*o%255+1,h=e+l;return h<=255?h:h-256},r})(),z2=(function(){function r(){}return r.prototype.getEncodingMode=function(){return ds},r.prototype.encodeMaximal=function(e){for(var o=new cn,l=0,h=e.pos,m=0;e.hasMoreCharacters();){var b=e.getCurrentChar();e.pos++,l=this.encodeChar(b,o),o.length()%3===0&&(h=e.pos,m=o.length())}if(m!==o.length()){var n=Math.floor(o.length()/3*2),C=Math.floor(e.getCodewordCount()+n+1);e.updateSymbolInfo(C);var D=e.getSymbolInfo().getDataCapacity()-C,L=Math.floor(o.length()%3);(L===2&&D!==2||L===1&&(l>3||D!==1))&&(e.pos=h)}o.length()>0&&e.writeCodeword(GR),this.handleEOD(e,o)},r.prototype.encode=function(e){for(var o=new cn;e.hasMoreCharacters();){var l=e.getCurrentChar();e.pos++;var h=this.encodeChar(l,o),m=Math.floor(o.length()/3)*2,b=e.getCodewordCount()+m;e.updateSymbolInfo(b);var n=e.getSymbolInfo().getDataCapacity()-b;if(!e.hasMoreCharacters()){var C=new cn;for(o.length()%3===2&&n!==2&&(h=this.backtrackOneCharacter(e,o,C,h));o.length()%3===1&&(h>3||n!==1);)h=this.backtrackOneCharacter(e,o,C,h);break}var D=o.length();if(D%3===0){var L=Th.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode());if(L!==this.getEncodingMode()){e.signalEncoderChange(Jn);break}}}this.handleEOD(e,o)},r.prototype.backtrackOneCharacter=function(e,o,l,h){var m=o.length(),b=o.toString().substring(0,m-h);o.setLengthToZero(),o.append(b),e.pos--;var n=e.getCurrentChar();return h=this.encodeChar(n,l),e.resetSymbolInfo(),h},r.prototype.writeNextTriplet=function(e,o){e.writeCodewords(this.encodeToCodewords(o.toString()));var l=o.toString().substring(3);o.setLengthToZero(),o.append(l)},r.prototype.handleEOD=function(e,o){var l=Math.floor(o.length()/3*2),h=o.length()%3,m=e.getCodewordCount()+l;e.updateSymbolInfo(m);var b=e.getSymbolInfo().getDataCapacity()-m;if(h===2){for(o.append("\0");o.length()>=3;)this.writeNextTriplet(e,o);e.hasMoreCharacters()&&e.writeCodeword(Bb)}else if(b===1&&h===1){for(;o.length()>=3;)this.writeNextTriplet(e,o);e.hasMoreCharacters()&&e.writeCodeword(Bb),e.pos--}else if(h===0){for(;o.length()>=3;)this.writeNextTriplet(e,o);(b>0||e.hasMoreCharacters())&&e.writeCodeword(Bb)}else throw new Error("Unexpected case. Please report!");e.signalEncoderChange(Jn)},r.prototype.encodeChar=function(e,o){if(e===32)return o.append(3),1;if(e>=48&&e<=57)return o.append(e-48+4),1;if(e>=65&&e<=90)return o.append(e-65+14),1;if(e<32)return o.append(0),o.append(e),2;if(e<=47)return o.append(1),o.append(e-33),2;if(e<=64)return o.append(1),o.append(e-58+15),2;if(e<=95)return o.append(1),o.append(e-91+22),2;if(e<=127)return o.append(2),o.append(e-96),2;o.append("1");var l=2;return l+=this.encodeChar(e-128,o),l},r.prototype.encodeToCodewords=function(e){var o=1600*e.charCodeAt(0)+40*e.charCodeAt(1)+e.charCodeAt(2)+1,l=o/256,h=o%256,m=new cn;return m.append(l),m.append(h),m.toString()},r})(),SV=(function(){function r(){}return r.prototype.getEncodingMode=function(){return Qa},r.prototype.encode=function(e){for(var o=new cn;e.hasMoreCharacters();){var l=e.getCurrentChar();this.encodeChar(l,o),e.pos++;var h=o.length();if(h>=4){e.writeCodewords(this.encodeToCodewords(o.toString()));var m=o.toString().substring(4);o.setLengthToZero(),o.append(m);var b=Th.lookAheadTest(e.getMessage(),e.pos,this.getEncodingMode());if(b!==this.getEncodingMode()){e.signalEncoderChange(Jn);break}}}o.append(En.getCharAt(31)),this.handleEOD(e,o)},r.prototype.handleEOD=function(e,o){try{var l=o.length();if(l===0)return;if(l===1){e.updateSymbolInfo();var h=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount(),m=e.getRemainingCharacters();if(m>h&&(e.updateSymbolInfo(e.getCodewordCount()+1),h=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount()),m<=h&&h<=2)return}if(l>4)throw new Error("Count must not exceed 4");var b=l-1,n=this.encodeToCodewords(o.toString()),C=!e.hasMoreCharacters(),D=C&&b<=2;if(b<=2){e.updateSymbolInfo(e.getCodewordCount()+b);var h=e.getSymbolInfo().getDataCapacity()-e.getCodewordCount();h>=3&&(D=!1,e.updateSymbolInfo(e.getCodewordCount()+n.length))}D?(e.resetSymbolInfo(),e.pos-=b):e.writeCodewords(n)}finally{e.signalEncoderChange(Jn)}},r.prototype.encodeChar=function(e,o){e>=32&&e<=63?o.append(e):e>=64&&e<=94?o.append(En.getCharAt(e-64)):Th.illegalCharacter(En.getCharAt(e))},r.prototype.encodeToCodewords=function(e){var o=e.length;if(o===0)throw new Error("StringBuilder must not be empty");var l=e.charAt(0).charCodeAt(0),h=o>=2?e.charAt(1).charCodeAt(0):0,m=o>=3?e.charAt(2).charCodeAt(0):0,b=o>=4?e.charAt(3).charCodeAt(0):0,n=(l<<18)+(h<<12)+(m<<6)+b,C=n>>16&255,D=n>>8&255,L=n&255,U=new cn;return U.append(C),o>=2&&U.append(D),o>=3&&U.append(L),U.toString()},r})(),TV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),AV=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},Gn=(function(){function r(e,o,l,h,m,b,n,C){n===void 0&&(n=0),C===void 0&&(C=0),this.rectangular=e,this.dataCapacity=o,this.errorCodewords=l,this.matrixWidth=h,this.matrixHeight=m,this.dataRegions=b,this.rsBlockData=n,this.rsBlockError=C}return r.lookup=function(e,o,l,h,m){var b,n;o===void 0&&(o=0),l===void 0&&(l=null),h===void 0&&(h=null),m===void 0&&(m=!0);try{for(var C=AV(CV),D=C.next();!D.done;D=C.next()){var L=D.value;if(!(o===1&&L.rectangular)&&!(o===2&&!L.rectangular)&&!(l!=null&&(L.getSymbolWidth()<l.getWidth()||L.getSymbolHeight()<l.getHeight()))&&!(h!=null&&(L.getSymbolWidth()>h.getWidth()||L.getSymbolHeight()>h.getHeight()))&&e<=L.dataCapacity)return L}}catch(U){b={error:U}}finally{try{D&&!D.done&&(n=C.return)&&n.call(C)}finally{if(b)throw b.error}}if(m)throw new Error("Can't find a symbol arrangement that matches the message. Data codewords: "+e);return null},r.prototype.getHorizontalDataRegions=function(){switch(this.dataRegions){case 1:return 1;case 2:case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},r.prototype.getVerticalDataRegions=function(){switch(this.dataRegions){case 1:case 2:return 1;case 4:return 2;case 16:return 4;case 36:return 6;default:throw new Error("Cannot handle this number of data regions")}},r.prototype.getSymbolDataWidth=function(){return this.getHorizontalDataRegions()*this.matrixWidth},r.prototype.getSymbolDataHeight=function(){return this.getVerticalDataRegions()*this.matrixHeight},r.prototype.getSymbolWidth=function(){return this.getSymbolDataWidth()+this.getHorizontalDataRegions()*2},r.prototype.getSymbolHeight=function(){return this.getSymbolDataHeight()+this.getVerticalDataRegions()*2},r.prototype.getCodewordCount=function(){return this.dataCapacity+this.errorCodewords},r.prototype.getInterleavedBlockCount=function(){return this.rsBlockData?this.dataCapacity/this.rsBlockData:1},r.prototype.getDataCapacity=function(){return this.dataCapacity},r.prototype.getErrorCodewords=function(){return this.errorCodewords},r.prototype.getDataLengthForInterleavedBlock=function(e){return this.rsBlockData},r.prototype.getErrorLengthForInterleavedBlock=function(e){return this.rsBlockError},r})(),EV=(function(r){TV(e,r);function e(){return r.call(this,!1,1558,620,22,22,36,-1,62)||this}return e.prototype.getInterleavedBlockCount=function(){return 10},e.prototype.getDataLengthForInterleavedBlock=function(o){return o<=8?156:155},e})(Gn),CV=[new Gn(!1,3,5,8,8,1),new Gn(!1,5,7,10,10,1),new Gn(!0,5,7,16,6,1),new Gn(!1,8,10,12,12,1),new Gn(!0,10,11,14,6,2),new Gn(!1,12,12,14,14,1),new Gn(!0,16,14,24,10,1),new Gn(!1,18,14,16,16,1),new Gn(!1,22,18,18,18,1),new Gn(!0,22,18,16,10,2),new Gn(!1,30,20,20,20,1),new Gn(!0,32,24,16,14,2),new Gn(!1,36,24,22,22,1),new Gn(!1,44,28,24,24,1),new Gn(!0,49,28,22,14,2),new Gn(!1,62,36,14,14,4),new Gn(!1,86,42,16,16,4),new Gn(!1,114,48,18,18,4),new Gn(!1,144,56,20,20,4),new Gn(!1,174,68,22,22,4),new Gn(!1,204,84,24,24,4,102,42),new Gn(!1,280,112,14,14,16,140,56),new Gn(!1,368,144,16,16,16,92,36),new Gn(!1,456,192,18,18,16,114,48),new Gn(!1,576,224,20,20,16,144,56),new Gn(!1,696,272,22,22,16,174,68),new Gn(!1,816,336,24,24,16,136,56),new Gn(!1,1050,408,18,18,36,175,68),new Gn(!1,1304,496,20,20,36,163,62),new EV],IV=(function(){function r(e){this.msg=e,this.pos=0,this.skipAtEnd=0;for(var o=e.split("").map(function(n){return n.charCodeAt(0)}),l=new cn,h=0,m=o.length;h<m;h++){var b=String.fromCharCode(o[h]&255);if(b==="?"&&e.charAt(h)!=="?")throw new Error("Message contains characters outside ISO-8859-1 encoding.");l.append(b)}this.msg=l.toString(),this.shape=0,this.codewords=new cn,this.newEncoding=-1}return r.prototype.setSymbolShape=function(e){this.shape=e},r.prototype.setSizeConstraints=function(e,o){this.minSize=e,this.maxSize=o},r.prototype.getMessage=function(){return this.msg},r.prototype.setSkipAtEnd=function(e){this.skipAtEnd=e},r.prototype.getCurrentChar=function(){return this.msg.charCodeAt(this.pos)},r.prototype.getCurrent=function(){return this.msg.charCodeAt(this.pos)},r.prototype.getCodewords=function(){return this.codewords},r.prototype.writeCodewords=function(e){this.codewords.append(e)},r.prototype.writeCodeword=function(e){this.codewords.append(e)},r.prototype.getCodewordCount=function(){return this.codewords.length()},r.prototype.getNewEncoding=function(){return this.newEncoding},r.prototype.signalEncoderChange=function(e){this.newEncoding=e},r.prototype.resetEncoderSignal=function(){this.newEncoding=-1},r.prototype.hasMoreCharacters=function(){return this.pos<this.getTotalMessageCharCount()},r.prototype.getTotalMessageCharCount=function(){return this.msg.length-this.skipAtEnd},r.prototype.getRemainingCharacters=function(){return this.getTotalMessageCharCount()-this.pos},r.prototype.getSymbolInfo=function(){return this.symbolInfo},r.prototype.updateSymbolInfo=function(e){e===void 0&&(e=this.getCodewordCount()),(this.symbolInfo==null||e>this.symbolInfo.getDataCapacity())&&(this.symbolInfo=Gn.lookup(e,this.shape,this.minSize,this.maxSize,!0))},r.prototype.resetSymbolInfo=function(){this.symbolInfo=null},r})(),RV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),MV=(function(r){RV(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEncodingMode=function(){return La},e.prototype.encode=function(o){for(var l=new cn;o.hasMoreCharacters();){var h=o.getCurrentChar();o.pos++,this.encodeChar(h,l);var m=l.length();if(m%3===0){this.writeNextTriplet(o,l);var b=Th.lookAheadTest(o.getMessage(),o.pos,this.getEncodingMode());if(b!==this.getEncodingMode()){o.signalEncoderChange(Jn);break}}}this.handleEOD(o,l)},e.prototype.encodeChar=function(o,l){switch(o){case 13:l.append(0);break;case 42:l.append(1);break;case 62:l.append(2);break;case 32:l.append(3);break;default:o>=48&&o<=57?l.append(o-48+4):o>=65&&o<=90?l.append(o-65+14):Th.illegalCharacter(En.getCharAt(o));break}return 1},e.prototype.handleEOD=function(o,l){o.updateSymbolInfo();var h=o.getSymbolInfo().getDataCapacity()-o.getCodewordCount(),m=l.length();o.pos-=m,(o.getRemainingCharacters()>1||h>1||o.getRemainingCharacters()!==h)&&o.writeCodeword(xV),o.getNewEncoding()<0&&o.signalEncoderChange(Jn)},e})(z2),DV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),OV=(function(r){DV(e,r);function e(){return r!==null&&r.apply(this,arguments)||this}return e.prototype.getEncodingMode=function(){return dl},e.prototype.encodeChar=function(o,l){if(o===32)return l.append(3),1;if(o>=48&&o<=57)return l.append(o-48+4),1;if(o>=97&&o<=122)return l.append(o-97+14),1;if(o<32)return l.append(0),l.append(o),2;if(o<=47)return l.append(1),l.append(o-33),2;if(o<=64)return l.append(1),l.append(o-58+15),2;if(o>=91&&o<=95)return l.append(1),l.append(o-91+22),2;if(o===96)return l.append(2),l.append(0),2;if(o<=90)return l.append(2),l.append(o-65+1),2;if(o<=127)return l.append(2),l.append(o-123+27),2;l.append("1");var h=2;return h+=this.encodeChar(o-128,l),h},e})(z2),Th=(function(){function r(){}return r.randomize253State=function(e){var o=149*e%253+1,l=XC+o;return l<=254?l:l-254},r.encodeHighLevel=function(e,o,l,h,m){o===void 0&&(o=0),l===void 0&&(l=null),h===void 0&&(h=null),m===void 0&&(m=!1);var b=new z2,n=[new bV,b,new OV,new MV,new SV,new wV],C=new IV(e);C.setSymbolShape(o),C.setSizeConstraints(l,h),e.startsWith(ZC)&&e.endsWith(YC)?(C.writeCodeword(mV),C.setSkipAtEnd(2),C.pos+=ZC.length):e.startsWith(WC)&&e.endsWith(YC)&&(C.writeCodeword(gV),C.setSkipAtEnd(2),C.pos+=WC.length);var D=Jn;for(m&&(b.encodeMaximal(C),D=C.getNewEncoding(),C.resetEncoderSignal());C.hasMoreCharacters();)n[D].encode(C),C.getNewEncoding()>=0&&(D=C.getNewEncoding(),C.resetEncoderSignal());var L=C.getCodewordCount();C.updateSymbolInfo();var U=C.getSymbolInfo().getDataCapacity();L<U&&D!==Jn&&D!==js&&D!==Qa&&C.writeCodeword("þ");var q=C.getCodewords();for(q.length()<U&&q.append(XC);q.length()<U;)q.append(this.randomize253State(q.length()+1));return C.getCodewords().toString()},r.lookAheadTest=function(e,o,l){var h=this.lookAheadTestIntern(e,o,l);if(l===La&&h===La){for(var m=Math.min(o+3,e.length),b=o;b<m;b++)if(!this.isNativeX12(e.charCodeAt(b)))return Jn}else if(l===Qa&&h===Qa){for(var m=Math.min(o+4,e.length),b=o;b<m;b++)if(!this.isNativeEDIFACT(e.charCodeAt(b)))return Jn}return h},r.lookAheadTestIntern=function(e,o,l){if(o>=e.length)return l;var h;l===Jn?h=[0,1,1,1,1,1.25]:(h=[1,2,2,2,2,2.25],h[l]=0);for(var m=0,b=new Uint8Array(6),n=[];;){if(o+m===e.length){ka.fill(b,0),ka.fill(n,0);var C=this.findMinimums(h,n,pn.MAX_VALUE,b),D=this.getMinimumCount(b);if(n[Jn]===C)return Jn;if(D===1){if(b[js]>0)return js;if(b[Qa]>0)return Qa;if(b[dl]>0)return dl;if(b[La]>0)return La}return ds}var L=e.charCodeAt(o+m);if(m++,this.isDigit(L)?h[Jn]+=.5:this.isExtendedASCII(L)?(h[Jn]=Math.ceil(h[Jn]),h[Jn]+=2):(h[Jn]=Math.ceil(h[Jn]),h[Jn]++),this.isNativeC40(L)?h[ds]+=2/3:this.isExtendedASCII(L)?h[ds]+=8/3:h[ds]+=4/3,this.isNativeText(L)?h[dl]+=2/3:this.isExtendedASCII(L)?h[dl]+=8/3:h[dl]+=4/3,this.isNativeX12(L)?h[La]+=2/3:this.isExtendedASCII(L)?h[La]+=13/3:h[La]+=10/3,this.isNativeEDIFACT(L)?h[Qa]+=3/4:this.isExtendedASCII(L)?h[Qa]+=17/4:h[Qa]+=13/4,this.isSpecialB256(L)?h[js]+=4:h[js]++,m>=4){if(ka.fill(b,0),ka.fill(n,0),this.findMinimums(h,n,pn.MAX_VALUE,b),n[Jn]<this.min(n[js],n[ds],n[dl],n[La],n[Qa]))return Jn;if(n[js]<n[Jn]||n[js]+1<this.min(n[ds],n[dl],n[La],n[Qa]))return js;if(n[Qa]+1<this.min(n[js],n[ds],n[dl],n[La],n[Jn]))return Qa;if(n[dl]+1<this.min(n[js],n[ds],n[Qa],n[La],n[Jn]))return dl;if(n[La]+1<this.min(n[js],n[ds],n[Qa],n[dl],n[Jn]))return La;if(n[ds]+1<this.min(n[Jn],n[js],n[Qa],n[dl])){if(n[ds]<n[La])return ds;if(n[ds]===n[La]){for(var U=o+m+1;U<e.length;){var q=e.charCodeAt(U);if(this.isX12TermSep(q))return La;if(!this.isNativeX12(q))break;U++}return ds}}}}},r.min=function(e,o,l,h,m){var b=Math.min(e,Math.min(o,Math.min(l,h)));return m===void 0?b:Math.min(b,m)},r.findMinimums=function(e,o,l,h){for(var m=0;m<6;m++){var b=o[m]=Math.ceil(e[m]);l>b&&(l=b,ka.fill(h,0)),l===b&&(h[m]=h[m]+1)}return l},r.getMinimumCount=function(e){for(var o=0,l=0;l<6;l++)o+=e[l];return o||0},r.isDigit=function(e){return e>=48&&e<=57},r.isExtendedASCII=function(e){return e>=128&&e<=255},r.isNativeC40=function(e){return e===32||e>=48&&e<=57||e>=65&&e<=90},r.isNativeText=function(e){return e===32||e>=48&&e<=57||e>=97&&e<=122},r.isNativeX12=function(e){return this.isX12TermSep(e)||e===32||e>=48&&e<=57||e>=65&&e<=90},r.isX12TermSep=function(e){return e===13||e===42||e===62},r.isNativeEDIFACT=function(e){return e>=32&&e<=94},r.isSpecialB256=function(e){return!1},r.determineConsecutiveDigitCount=function(e,o){o===void 0&&(o=0);for(var l=e.length,h=o;h<l&&this.isDigit(e.charCodeAt(h));)h++;return h-o},r.illegalCharacter=function(e){var o=pn.toHexString(e.charCodeAt(0));throw o="0000".substring(0,4-o.length)+o,new Error("Illegal character: "+e+" (0x"+o+")")},r})(),zb=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},QC=(function(){function r(e){this.charset=e,this.name=e.name}return r.prototype.canEncode=function(e){try{return Bu.encode(e,this.charset)!=null}catch{return!1}},r})(),PV=(function(){function r(e,o,l){var h,m,b,n,C,D;this.ENCODERS=["IBM437","ISO-8859-2","ISO-8859-3","ISO-8859-4","ISO-8859-5","ISO-8859-6","ISO-8859-7","ISO-8859-8","ISO-8859-9","ISO-8859-10","ISO-8859-11","ISO-8859-13","ISO-8859-14","ISO-8859-15","ISO-8859-16","windows-1250","windows-1251","windows-1252","windows-1256","Shift_JIS"].map(function(Yt){return new QC(cV.forName(Yt))}),this.encoders=[];var L=[];L.push(new QC(uV.ISO_8859_1));for(var U=o!=null&&o.name.startsWith("UTF"),q=0;q<e.length;q++){var Z=!1;try{for(var ie=(h=void 0,zb(L)),ne=ie.next();!ne.done;ne=ie.next()){var be=ne.value,ve=e.charAt(q),we=ve.charCodeAt(0);if(we===l||be.canEncode(ve)){Z=!0;break}}}catch(Yt){h={error:Yt}}finally{try{ne&&!ne.done&&(m=ie.return)&&m.call(ie)}finally{if(h)throw h.error}}if(!Z)try{for(var Pe=(b=void 0,zb(this.ENCODERS)),Ze=Pe.next();!Ze.done;Ze=Pe.next()){var be=Ze.value;if(be.canEncode(e.charAt(q))){L.push(be),Z=!0;break}}}catch(Yt){b={error:Yt}}finally{try{Ze&&!Ze.done&&(n=Pe.return)&&n.call(Pe)}finally{if(b)throw b.error}}Z||(U=!0)}if(L.length===1&&!U)this.encoders=[L[0]];else{this.encoders=[];var $e=0;try{for(var xt=zb(L),Ct=xt.next();!Ct.done;Ct=xt.next()){var be=Ct.value;this.encoders[$e++]=be}}catch(Yt){C={error:Yt}}finally{try{Ct&&!Ct.done&&(D=xt.return)&&D.call(xt)}finally{if(C)throw C.error}}}var Ft=-1;if(o!=null){for(var q=0;q<this.encoders.length;q++)if(this.encoders[q]!=null&&o.name===this.encoders[q].name){Ft=q;break}}this.priorityEncoderIndex=Ft}return r.prototype.length=function(){return this.encoders.length},r.prototype.getCharsetName=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].name},r.prototype.getCharset=function(e){if(!(e<this.length()))throw new Error("index must be less than length");return this.encoders[e].charset},r.prototype.getECIValue=function(e){return this.encoders[e].charset.getValueIdentifier()},r.prototype.getPriorityEncoderIndex=function(){return this.priorityEncoderIndex},r.prototype.canEncode=function(e,o){if(!(o<this.length()))throw new Error("index must be less than length");return!0},r.prototype.encode=function(e,o){if(!(o<this.length()))throw new Error("index must be less than length");return Bu.encode(En.getCharAt(e),this.encoders[o].name)},r})(),LV=3,BV=(function(){function r(e,o,l){this.fnc1=l;var h=new PV(e,o,l);if(h.length()===1)for(var m=0;m<this.bytes.length;m++){var b=e.charAt(m).charCodeAt(0);this.bytes[m]=b===l?1e3:b}else this.bytes=this.encodeMinimally(e,h,l)}return r.prototype.getFNC1Character=function(){return this.fnc1},r.prototype.length=function(){return this.bytes.length},r.prototype.haveNCharacters=function(e,o){if(e+o-1>=this.bytes.length)return!1;for(var l=0;l<o;l++)if(this.isECI(e+l))return!1;return!0},r.prototype.charAt=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(this.isECI(e))throw new Error("value at "+e+" is not a character but an ECI");return this.isFNC1(e)?this.fnc1:this.bytes[e]},r.prototype.subSequence=function(e,o){if(e<0||e>o||o>this.length())throw new Error(""+e);for(var l=new cn,h=e;h<o;h++){if(this.isECI(h))throw new Error("value at "+h+" is not a character but an ECI");l.append(this.charAt(h))}return l.toString()},r.prototype.isECI=function(e){if(e<0||e>=this.length())throw new Error(""+e);return this.bytes[e]>255&&this.bytes[e]<=999},r.prototype.isFNC1=function(e){if(e<0||e>=this.length())throw new Error(""+e);return this.bytes[e]===1e3},r.prototype.getECIValue=function(e){if(e<0||e>=this.length())throw new Error(""+e);if(!this.isECI(e))throw new Error("value at "+e+" is not an ECI but a character");return this.bytes[e]-256},r.prototype.addEdge=function(e,o,l){(e[o][l.encoderIndex]==null||e[o][l.encoderIndex].cachedTotalSize>l.cachedTotalSize)&&(e[o][l.encoderIndex]=l)},r.prototype.addEdges=function(e,o,l,h,m,b){var n=e.charAt(h).charCodeAt(0),C=0,D=o.length();o.getPriorityEncoderIndex()>=0&&(n===b||o.canEncode(n,o.getPriorityEncoderIndex()))&&(C=o.getPriorityEncoderIndex(),D=C+1);for(var L=C;L<D;L++)(n===b||o.canEncode(n,L))&&this.addEdge(l,h+1,new KC(n,o,L,m,b))},r.prototype.encodeMinimally=function(e,o,l){var h=e.length,m=new KC[h+1][o.length()];this.addEdges(e,o,m,0,null,l);for(var b=1;b<=h;b++){for(var n=0;n<o.length();n++)m[b][n]!=null&&b<h&&this.addEdges(e,o,m,b,m[b][n],l);for(var n=0;n<o.length();n++)m[b-1][n]=null}for(var C=-1,D=pn.MAX_VALUE,n=0;n<o.length();n++)if(m[h][n]!=null){var L=m[h][n];L.cachedTotalSize<D&&(D=L.cachedTotalSize,C=n)}if(C<0)throw new Error('Failed to encode "'+e+'"');for(var U=[],q=m[h][C];q!=null;){if(q.isFNC1())U.unshift(1e3);else for(var Z=o.encode(q.c,q.encoderIndex),b=Z.length-1;b>=0;b--)U.unshift(Z[b]&255);var ie=q.previous===null?0:q.previous.encoderIndex;ie!==q.encoderIndex&&U.unshift(256+o.getECIValue(q.encoderIndex)),q=q.previous}for(var ne=[],b=0;b<ne.length;b++)ne[b]=U[b];return ne},r})(),KC=(function(){function r(e,o,l,h,m){this.c=e,this.encoderSet=o,this.encoderIndex=l,this.previous=h,this.fnc1=m,this.c=e===m?1e3:e;var b=this.isFNC1()?1:o.encode(e,l).length,n=h===null?0:h.encoderIndex;n!==l&&(b+=LV),h!=null&&(b+=h.cachedTotalSize),this.cachedTotalSize=b}return r.prototype.isFNC1=function(){return this.c===1e3},r})(),zV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})();var JC;(function(r){r[r.ASCII=0]="ASCII",r[r.C40=1]="C40",r[r.TEXT=2]="TEXT",r[r.X12=3]="X12",r[r.EDF=4]="EDF",r[r.B256=5]="B256"})(JC||(JC={}));(function(r){zV(e,r);function e(o,l,h,m,b){var n=r.call(this,o,l,h)||this;return n.shape=m,n.macroId=b,n}return e.prototype.getMacroId=function(){return this.macroId},e.prototype.getShapeHint=function(){return this.shape},e})(BV);var FV=(function(){function r(){}return r.prototype.isCompact=function(){return this.compact},r.prototype.setCompact=function(e){this.compact=e},r.prototype.getSize=function(){return this.size},r.prototype.setSize=function(e){this.size=e},r.prototype.getLayers=function(){return this.layers},r.prototype.setLayers=function(e){this.layers=e},r.prototype.getCodeWords=function(){return this.codeWords},r.prototype.setCodeWords=function(e){this.codeWords=e},r.prototype.getMatrix=function(){return this.matrix},r.prototype.setMatrix=function(e){this.matrix=e},r})(),e3=(function(){function r(){}return r.singletonList=function(e){return[e]},r.min=function(e,o){return e.sort(o)[0]},r})(),kV=(function(){function r(e){this.previous=e}return r.prototype.getPrevious=function(){return this.previous},r})(),NV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),F2=(function(r){NV(e,r);function e(o,l,h){var m=r.call(this,o)||this;return m.value=l,m.bitCount=h,m}return e.prototype.appendTo=function(o,l){o.appendBits(this.value,this.bitCount)},e.prototype.add=function(o,l){return new e(this,o,l)},e.prototype.addBinaryShift=function(o,l){return console.warn("addBinaryShift on SimpleToken, this simply returns a copy of this token"),new e(this,o,l)},e.prototype.toString=function(){var o=this.value&(1<<this.bitCount)-1;return o|=1<<this.bitCount,"<"+pn.toBinaryString(o|1<<this.bitCount).substring(1)+">"},e})(kV),VV=(function(){var r=function(e,o){return r=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,h){l.__proto__=h}||function(l,h){for(var m in h)h.hasOwnProperty(m)&&(l[m]=h[m])},r(e,o)};return function(e,o){r(e,o);function l(){this.constructor=e}e.prototype=o===null?Object.create(o):(l.prototype=o.prototype,new l)}})(),UV=(function(r){VV(e,r);function e(o,l,h){var m=r.call(this,o,0,0)||this;return m.binaryShiftStart=l,m.binaryShiftByteCount=h,m}return e.prototype.appendTo=function(o,l){for(var h=0;h<this.binaryShiftByteCount;h++)(h===0||h===31&&this.binaryShiftByteCount<=62)&&(o.appendBits(31,5),this.binaryShiftByteCount>62?o.appendBits(this.binaryShiftByteCount-31,16):h===0?o.appendBits(Math.min(this.binaryShiftByteCount,31),5):o.appendBits(this.binaryShiftByteCount-31,5)),o.appendBits(l[this.binaryShiftStart+h],8)},e.prototype.addBinaryShift=function(o,l){return new e(this,o,l)},e.prototype.toString=function(){return"<"+this.binaryShiftStart+"::"+(this.binaryShiftStart+this.binaryShiftByteCount-1)+">"},e})(F2);function jV(r,e,o){return new UV(r,e,o)}function ey(r,e,o){return new F2(r,e,o)}var GV=["UPPER","LOWER","DIGIT","MIXED","PUNCT"],um=0,zv=1,Pu=2,HR=3,Tf=4,HV=new F2(null,0,0),Fb=[Int32Array.from([0,(5<<16)+28,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(9<<16)+480+14,0,(5<<16)+30,(5<<16)+29,656318]),Int32Array.from([(4<<16)+14,(9<<16)+448+28,0,(9<<16)+448+29,932798]),Int32Array.from([(5<<16)+29,(5<<16)+28,656318,0,(5<<16)+30]),Int32Array.from([(5<<16)+31,656380,656382,656381,0])],qV=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};function $V(r){var e,o;try{for(var l=qV(r),h=l.next();!h.done;h=l.next()){var m=h.value;ka.fill(m,-1)}}catch(b){e={error:b}}finally{try{h&&!h.done&&(o=l.return)&&o.call(l)}finally{if(e)throw e.error}}return r[um][Tf]=0,r[zv][Tf]=0,r[zv][um]=28,r[HR][Tf]=0,r[Pu][Tf]=0,r[Pu][um]=15,r}var qR=$V(ka.createInt32Array(6,6)),XV=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},ZV=(function(){function r(e,o,l,h){this.token=e,this.mode=o,this.binaryShiftByteCount=l,this.bitCount=h}return r.prototype.getMode=function(){return this.mode},r.prototype.getToken=function(){return this.token},r.prototype.getBinaryShiftByteCount=function(){return this.binaryShiftByteCount},r.prototype.getBitCount=function(){return this.bitCount},r.prototype.latchAndAppend=function(e,o){var l=this.bitCount,h=this.token;if(e!==this.mode){var m=Fb[this.mode][e];h=ey(h,m&65535,m>>16),l+=m>>16}var b=e===Pu?4:5;return h=ey(h,o,b),new r(h,e,0,l+b)},r.prototype.shiftAndAppend=function(e,o){var l=this.token,h=this.mode===Pu?4:5;return l=ey(l,qR[this.mode][e],h),l=ey(l,o,5),new r(l,this.mode,0,this.bitCount+h+5)},r.prototype.addBinaryShiftChar=function(e){var o=this.token,l=this.mode,h=this.bitCount;if(this.mode===Tf||this.mode===Pu){var m=Fb[l][um];o=ey(o,m&65535,m>>16),h+=m>>16,l=um}var b=this.binaryShiftByteCount===0||this.binaryShiftByteCount===31?18:this.binaryShiftByteCount===62?9:8,n=new r(o,l,this.binaryShiftByteCount+1,h+b);return n.binaryShiftByteCount===2078&&(n=n.endBinaryShift(e+1)),n},r.prototype.endBinaryShift=function(e){if(this.binaryShiftByteCount===0)return this;var o=this.token;return o=jV(o,e-this.binaryShiftByteCount,this.binaryShiftByteCount),new r(o,this.mode,0,this.bitCount)},r.prototype.isBetterThanOrEqualTo=function(e){var o=this.bitCount+(Fb[this.mode][e.mode]>>16);return this.binaryShiftByteCount<e.binaryShiftByteCount?o+=r.calculateBinaryShiftCost(e)-r.calculateBinaryShiftCost(this):this.binaryShiftByteCount>e.binaryShiftByteCount&&e.binaryShiftByteCount>0&&(o+=10),o<=e.bitCount},r.prototype.toBitArray=function(e){for(var o,l,h=[],m=this.endBinaryShift(e.length).token;m!==null;m=m.getPrevious())h.unshift(m);var b=new Ja;try{for(var n=XV(h),C=n.next();!C.done;C=n.next()){var D=C.value;D.appendTo(b,e)}}catch(L){o={error:L}}finally{try{C&&!C.done&&(l=n.return)&&l.call(n)}finally{if(o)throw o.error}}return b},r.prototype.toString=function(){return En.format("%s bits=%d bytes=%d",GV[this.mode],this.bitCount,this.binaryShiftByteCount)},r.calculateBinaryShiftCost=function(e){return e.binaryShiftByteCount>62?21:e.binaryShiftByteCount>31?20:e.binaryShiftByteCount>0?10:0},r.INITIAL_STATE=new r(HV,um,0,0),r})();function WV(r){var e=En.getCharCode(" "),o=En.getCharCode("."),l=En.getCharCode(",");r[um][e]=1;for(var h=En.getCharCode("Z"),m=En.getCharCode("A"),b=m;b<=h;b++)r[um][b]=b-m+2;r[zv][e]=1;for(var n=En.getCharCode("z"),C=En.getCharCode("a"),b=C;b<=n;b++)r[zv][b]=b-C+2;r[Pu][e]=1;for(var D=En.getCharCode("9"),L=En.getCharCode("0"),b=L;b<=D;b++)r[Pu][b]=b-L+2;r[Pu][l]=12,r[Pu][o]=13;for(var U=["\0"," ","","","","","","","\x07","\b","	",`
`,"\v","\f","\r","\x1B","","","","","@","\\","^","_","`","|","~",""],q=0;q<U.length;q++)r[HR][En.getCharCode(U[q])]=q;for(var Z=["\0","\r","\0","\0","\0","\0","!","'","#","$","%","&","'","(",")","*","+",",","-",".","/",":",";","<","=",">","?","[","]","{","}"],q=0;q<Z.length;q++)En.getCharCode(Z[q])>0&&(r[Tf][En.getCharCode(Z[q])]=q);return r}var kb=WV(ka.createInt32Array(5,256)),cv=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")},YV=(function(){function r(e){this.text=e}return r.prototype.encode=function(){for(var e=En.getCharCode(" "),o=En.getCharCode(`
`),l=e3.singletonList(ZV.INITIAL_STATE),h=0;h<this.text.length;h++){var m=void 0,b=h+1<this.text.length?this.text[h+1]:0;switch(this.text[h]){case En.getCharCode("\r"):m=b===o?2:0;break;case En.getCharCode("."):m=b===e?3:0;break;case En.getCharCode(","):m=b===e?4:0;break;case En.getCharCode(":"):m=b===e?5:0;break;default:m=0}m>0?(l=r.updateStateListForPair(l,h,m),h++):l=this.updateStateListForChar(l,h)}var n=e3.min(l,function(C,D){return C.getBitCount()-D.getBitCount()});return n.toBitArray(this.text)},r.prototype.updateStateListForChar=function(e,o){var l,h,m=[];try{for(var b=cv(e),n=b.next();!n.done;n=b.next()){var C=n.value;this.updateStateForChar(C,o,m)}}catch(D){l={error:D}}finally{try{n&&!n.done&&(h=b.return)&&h.call(b)}finally{if(l)throw l.error}}return r.simplifyStates(m)},r.prototype.updateStateForChar=function(e,o,l){for(var h=this.text[o]&255,m=kb[e.getMode()][h]>0,b=null,n=0;n<=Tf;n++){var C=kb[n][h];if(C>0){if(b==null&&(b=e.endBinaryShift(o)),!m||n===e.getMode()||n===Pu){var D=b.latchAndAppend(n,C);l.push(D)}if(!m&&qR[e.getMode()][n]>=0){var L=b.shiftAndAppend(n,C);l.push(L)}}}if(e.getBinaryShiftByteCount()>0||kb[e.getMode()][h]===0){var U=e.addBinaryShiftChar(o);l.push(U)}},r.updateStateListForPair=function(e,o,l){var h,m,b=[];try{for(var n=cv(e),C=n.next();!C.done;C=n.next()){var D=C.value;this.updateStateForPair(D,o,l,b)}}catch(L){h={error:L}}finally{try{C&&!C.done&&(m=n.return)&&m.call(n)}finally{if(h)throw h.error}}return this.simplifyStates(b)},r.updateStateForPair=function(e,o,l,h){var m=e.endBinaryShift(o);if(h.push(m.latchAndAppend(Tf,l)),e.getMode()!==Tf&&h.push(m.shiftAndAppend(Tf,l)),l===3||l===4){var b=m.latchAndAppend(Pu,16-l).latchAndAppend(Pu,1);h.push(b)}if(e.getBinaryShiftByteCount()>0){var n=e.addBinaryShiftChar(o).addBinaryShiftChar(o+1);h.push(n)}},r.simplifyStates=function(e){var o,l,h,m,b=[];try{for(var n=cv(e),C=n.next();!C.done;C=n.next()){var D=C.value,L=!0,U=function(be){if(be.isBetterThanOrEqualTo(D))return L=!1,"break";D.isBetterThanOrEqualTo(be)&&(b=b.filter(function(ve){return ve!==be}))};try{for(var q=(h=void 0,cv(b)),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value,ne=U(ie);if(ne==="break")break}}catch(be){h={error:be}}finally{try{Z&&!Z.done&&(m=q.return)&&m.call(q)}finally{if(h)throw h.error}}L&&b.push(D)}}catch(be){o={error:be}}finally{try{C&&!C.done&&(l=n.return)&&l.call(n)}finally{if(o)throw o.error}}return b},r})(),QV=function(r){var e=typeof Symbol=="function"&&Symbol.iterator,o=e&&r[e],l=0;if(o)return o.call(r);if(r&&typeof r.length=="number")return{next:function(){return r&&l>=r.length&&(r=void 0),{value:r&&r[l++],done:!r}}};throw new TypeError(e?"Object is not iterable.":"Symbol.iterator is not defined.")};(function(){function r(){}return r.encodeBytes=function(e){return r.encode(e,r.DEFAULT_EC_PERCENT,r.DEFAULT_AZTEC_LAYERS)},r.encode=function(e,o,l){var h=new YV(e).encode(),m=pn.truncDivision(h.getSize()*o,100)+11,b=h.getSize()+m,n,C,D,L,U;if(l!==r.DEFAULT_AZTEC_LAYERS){if(n=l<0,C=Math.abs(l),C>(n?r.MAX_NB_BITS_COMPACT:r.MAX_NB_BITS))throw new bi(En.format("Illegal value %s for layers",l));D=r.totalBitsInLayer(C,n),L=r.WORD_SIZE[C];var q=D-D%L;if(U=r.stuffBits(h,L),U.getSize()+m>q)throw new bi("Data to large for user specified layer");if(n&&U.getSize()>L*64)throw new bi("Data to large for user specified layer")}else{L=0,U=null;for(var Z=0;;Z++){if(Z>r.MAX_NB_BITS)throw new bi("Data too large for an Aztec code");if(n=Z<=3,C=n?Z+1:Z,D=r.totalBitsInLayer(C,n),!(b>D)){(U==null||L!==r.WORD_SIZE[C])&&(L=r.WORD_SIZE[C],U=r.stuffBits(h,L));var q=D-D%L;if(!(n&&U.getSize()>L*64)&&U.getSize()+m<=q)break}}}var ie=r.generateCheckWords(U,D,L),ne=U.getSize()/L,be=r.generateModeMessage(n,C,ne),ve=(n?11:14)+C*4,we=new Int32Array(ve),Pe;if(n){Pe=ve;for(var Z=0;Z<we.length;Z++)we[Z]=Z}else{Pe=ve+1+2*pn.truncDivision(pn.truncDivision(ve,2)-1,15);for(var Ze=pn.truncDivision(ve,2),$e=pn.truncDivision(Pe,2),Z=0;Z<Ze;Z++){var xt=Z+pn.truncDivision(Z,15);we[Ze-Z-1]=$e-xt-1,we[Ze+Z]=$e+xt+1}}for(var Ct=new If(Pe),Z=0,Ft=0;Z<C;Z++){for(var Yt=(C-Z)*4+(n?9:12),hr=0;hr<Yt;hr++)for(var pr=hr*2,Kr=0;Kr<2;Kr++)ie.get(Ft+pr+Kr)&&Ct.set(we[Z*2+Kr],we[Z*2+hr]),ie.get(Ft+Yt*2+pr+Kr)&&Ct.set(we[Z*2+hr],we[ve-1-Z*2-Kr]),ie.get(Ft+Yt*4+pr+Kr)&&Ct.set(we[ve-1-Z*2-Kr],we[ve-1-Z*2-hr]),ie.get(Ft+Yt*6+pr+Kr)&&Ct.set(we[ve-1-Z*2-hr],we[Z*2+Kr]);Ft+=Yt*8}if(r.drawModeMessage(Ct,n,Pe,be),n)r.drawBullsEye(Ct,pn.truncDivision(Pe,2),5);else{r.drawBullsEye(Ct,pn.truncDivision(Pe,2),7);for(var Z=0,hr=0;Z<pn.truncDivision(ve,2)-1;Z+=15,hr+=16)for(var Kr=pn.truncDivision(Pe,2)&1;Kr<Pe;Kr+=2)Ct.set(pn.truncDivision(Pe,2)-hr,Kr),Ct.set(pn.truncDivision(Pe,2)+hr,Kr),Ct.set(Kr,pn.truncDivision(Pe,2)-hr),Ct.set(Kr,pn.truncDivision(Pe,2)+hr)}var ui=new FV;return ui.setCompact(n),ui.setSize(Pe),ui.setLayers(C),ui.setCodeWords(ne),ui.setMatrix(Ct),ui},r.drawBullsEye=function(e,o,l){for(var h=0;h<l;h+=2)for(var m=o-h;m<=o+h;m++)e.set(m,o-h),e.set(m,o+h),e.set(o-h,m),e.set(o+h,m);e.set(o-l,o-l),e.set(o-l+1,o-l),e.set(o-l,o-l+1),e.set(o+l,o-l),e.set(o+l,o-l+1),e.set(o+l,o+l-1)},r.generateModeMessage=function(e,o,l){var h=new Ja;return e?(h.appendBits(o-1,2),h.appendBits(l-1,6),h=r.generateCheckWords(h,28,4)):(h.appendBits(o-1,5),h.appendBits(l-1,11),h=r.generateCheckWords(h,40,4)),h},r.drawModeMessage=function(e,o,l,h){var m=pn.truncDivision(l,2);if(o)for(var b=0;b<7;b++){var n=m-3+b;h.get(b)&&e.set(n,m-5),h.get(b+7)&&e.set(m+5,n),h.get(20-b)&&e.set(n,m+5),h.get(27-b)&&e.set(m-5,n)}else for(var b=0;b<10;b++){var n=m-5+b+pn.truncDivision(b,5);h.get(b)&&e.set(n,m-7),h.get(b+10)&&e.set(m+7,n),h.get(29-b)&&e.set(n,m+7),h.get(39-b)&&e.set(m-7,n)}},r.generateCheckWords=function(e,o,l){var h,m,b=e.getSize()/l,n=new jR(r.getGF(l)),C=pn.truncDivision(o,l),D=r.bitsToWords(e,l,C);n.encode(D,C-b);var L=o%l,U=new Ja;U.appendBits(0,L);try{for(var q=QV(Array.from(D)),Z=q.next();!Z.done;Z=q.next()){var ie=Z.value;U.appendBits(ie,l)}}catch(ne){h={error:ne}}finally{try{Z&&!Z.done&&(m=q.return)&&m.call(q)}finally{if(h)throw h.error}}return U},r.bitsToWords=function(e,o,l){var h=new Int32Array(l),m,b;for(m=0,b=e.getSize()/o;m<b;m++){for(var n=0,C=0;C<o;C++)n|=e.get(m*o+C)?1<<o-C-1:0;h[m]=n}return h},r.getGF=function(e){switch(e){case 4:return ql.AZTEC_PARAM;case 6:return ql.AZTEC_DATA_6;case 8:return ql.AZTEC_DATA_8;case 10:return ql.AZTEC_DATA_10;case 12:return ql.AZTEC_DATA_12;default:throw new bi("Unsupported word size "+e)}},r.stuffBits=function(e,o){for(var l=new Ja,h=e.getSize(),m=(1<<o)-2,b=0;b<h;b+=o){for(var n=0,C=0;C<o;C++)(b+C>=h||e.get(b+C))&&(n|=1<<o-1-C);(n&m)===m?(l.appendBits(n&m,o),b--):(n&m)===0?(l.appendBits(n|1,o),b--):l.appendBits(n,o)}return l},r.totalBitsInLayer=function(e,o){return((o?88:112)+16*e)*e},r.DEFAULT_EC_PERCENT=33,r.DEFAULT_AZTEC_LAYERS=0,r.MAX_NB_BITS=32,r.MAX_NB_BITS_COMPACT=4,r.WORD_SIZE=Int32Array.from([4,6,6,8,8,8,8,8,8,10,10,10,10,10,10,10,10,10,10,10,10,10,10,12,12,12,12,12,12,12,12,12,12]),r})();const $R=r=>{const e=Xe.useCallback(o=>(...l)=>{const h=r?`[${r}]`:"";Fn[o](h,...l)},[r]);return Xe.useMemo(()=>({info:e("info"),warn:e("warn"),error:e("error"),env:Fn.env,object:Fn.object,array:Fn.array,api:Fn.api,state:Fn.state,perf:Fn.perf,logger:Fn}),[e])};function KV(){return rt.jsxs("div",{className:"flex items-center justify-center p-10 text-[color:var(--color-text-muted)]",children:[rt.jsx(ER,{className:"mr-3 h-5 w-5 animate-spin text-[color:var(--color-cyan)]"}),rt.jsx("span",{className:"font-mono text-xs uppercase tracking-[0.32em]",children:"Загрузка…"})]})}function JV(){const r=$R("ModernHomePage"),{isSignedIn:e,registerAdmin:o}=d4(),{mutate:l}=VF(),{recordPageView:h}=I2(),m=Xe.useRef(!1);Xe.useEffect(()=>{m.current||(m.current=!0,r.info("Инициализация дашборда"),h(),r.state("Dashboard Store",{pageViews:"tracked"}))},[]),Xe.useEffect(()=>{if(e){r.info("Пользователь подписан, bootstrap player");const n=Date.now();l(),setTimeout(()=>{r.perf("Bootstrap player data",n)},0)}else r.warn("Пользователь не авторизован")},[e,l,r]);const b=()=>{const n=new Date().getHours();return n<12?"Доброе утро":n<17?"Добрый день":"Добрый вечер"};return rt.jsxs("div",{className:"relative min-h-screen overflow-hidden bg-[color:var(--color-bg)] px-4 pb-16 pt-8",children:[rt.jsxs("div",{className:"pointer-events-none absolute inset-0 opacity-60",children:[rt.jsx("div",{className:"absolute -left-24 top-32 h-80 w-80 rounded-full bg-[radial-gradient(circle,rgba(79,70,229,0.28),transparent_60%)] blur-3xl"}),rt.jsx("div",{className:"absolute -right-10 top-20 h-72 w-72 rounded-full bg-[radial-gradient(circle,rgba(14,165,233,0.22),transparent_65%)] blur-3xl"}),rt.jsx("div",{className:"absolute bottom-10 left-1/2 h-96 w-96 -translate-x-1/2 rounded-full bg-[radial-gradient(circle,rgba(244,114,182,0.18),transparent_70%)] blur-3xl"})]}),rt.jsxs("div",{className:"relative z-10 mx-auto max-w-6xl",children:[rt.jsxs(ms.div,{className:"mb-12 text-center",initial:{opacity:0,y:-20},animate:{opacity:1,y:0},transition:{duration:.6},children:[rt.jsx("div",{className:"badge-glow mx-auto mb-3 bg-[linear-gradient(135deg,rgba(79,70,229,0.85),rgba(14,165,233,0.85))] text-[color:var(--color-bg)]",children:"Интерактивный дашборд QR-Boost"}),rt.jsx("h1",{className:"text-5xl font-bold text-[color:var(--color-text-primary)]",children:"QR-Boost"}),rt.jsxs("p",{className:"mt-4 text-sm uppercase tracking-[0.35em] text-[color:var(--color-text-muted)]",children:[b(),", игрок!"]})]}),rt.jsxs(Xe.Suspense,{fallback:rt.jsx(KV,{}),children:[rt.jsxs("div",{className:"panel-grid mb-10",children:[rt.jsx("div",{className:"panel-span-7",children:rt.jsx(JF,{})}),rt.jsx("div",{className:"panel-span-5",children:rt.jsx(tk,{})})]}),rt.jsxs("div",{className:"panel-grid",children:[rt.jsx("div",{className:"panel-span-7",children:rt.jsx(hk,{})}),rt.jsx("div",{className:"panel-span-5",children:rt.jsx(fk,{})})]})]}),!e&&rt.jsxs(ms.div,{className:"mt-10 text-center",initial:{opacity:0},animate:{opacity:1},transition:{delay:.5},children:[rt.jsxs(My,{to:"/novel",className:"inline-flex items-center gap-3 rounded-full border border-[color:var(--color-border-strong)]/60 bg-[color:var(--color-surface-elevated)] px-6 py-3 text-xs uppercase tracking-[0.32em] text-[color:var(--color-text-primary)] transition hover:border-[color:var(--color-cyan)]/70 hover:text-[color:var(--color-cyan)]",children:[rt.jsx("span",{className:"h-2 w-2 rounded-full bg-[color:var(--color-cyan)]"}),"Перейти к новелле"]}),rt.jsx("div",{className:"mt-4"}),rt.jsxs("button",{type:"button",onClick:()=>o("Admin"),className:"inline-flex items-center gap-3 rounded-full border border-[color:var(--color-border-strong)]/60 bg-[color:var(--color-surface-elevated)] px-6 py-3 text-xs uppercase tracking-[0.32em] text-[color:var(--color-text-primary)] transition hover:border-[color:var(--color-cyan)]/70 hover:text-[color:var(--color-cyan)]",children:[rt.jsx("span",{className:"h-2 w-2 rounded-full bg-[color:var(--color-cyan)]"}),"Быстрая регистрация администратора"]})]})]})]})}var wv={exports:{}},eU=wv.exports,t3;function tU(){return t3||(t3=1,(function(r,e){(function(o,l){r.exports=l()})(eU,(function(){var o,l,h;function m(n,C){if(!o)o=C;else if(!l)l=C;else{var D="self.onerror = function() { console.error('An error occurred while parsing the WebWorker bundle. This is most likely due to improper transpilation by Babel; please see https://docs.mapbox.com/mapbox-gl-js/guides/install/#transpiling'); }; var sharedChunk = {}; ("+o+")(sharedChunk); ("+l+")(sharedChunk); self.onerror = null;",L={};o(L),h=C(L),typeof window<"u"&&window&&window.URL&&window.URL.createObjectURL&&(h.workerUrl=window.URL.createObjectURL(new Blob([D],{type:"text/javascript"})))}}m(["exports"],(function(n){var C=1e-6,D=typeof Float32Array<"u"?Float32Array:Array;function L(s,t){var a=t[0],u=t[1],d=t[2],_=t[3],v=a*_-d*u;return v?(s[0]=_*(v=1/v),s[1]=-u*v,s[2]=-d*v,s[3]=a*v,s):null}function U(){var s=new D(9);return D!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[5]=0,s[6]=0,s[7]=0),s[0]=1,s[4]=1,s[8]=1,s}function q(s,t){var a=t[0],u=t[1],d=t[2],_=t[3],v=t[4],S=t[5],E=t[6],R=t[7],P=t[8];return s[0]=v*P-S*R,s[1]=d*R-u*P,s[2]=u*S-d*v,s[3]=S*E-_*P,s[4]=a*P-d*E,s[5]=d*_-a*S,s[6]=_*R-v*E,s[7]=u*E-a*R,s[8]=a*v-u*_,s}function Z(s,t,a){var u=t[0],d=t[1],_=t[2],v=t[3],S=t[4],E=t[5],R=t[6],P=t[7],B=t[8],F=a[0],j=a[1],G=a[2],Q=a[3],J=a[4],ee=a[5],se=a[6],le=a[7],he=a[8];return s[0]=F*u+j*v+G*R,s[1]=F*d+j*S+G*P,s[2]=F*_+j*E+G*B,s[3]=Q*u+J*v+ee*R,s[4]=Q*d+J*S+ee*P,s[5]=Q*_+J*E+ee*B,s[6]=se*u+le*v+he*R,s[7]=se*d+le*S+he*P,s[8]=se*_+le*E+he*B,s}function ie(){var s=new D(16);return D!=Float32Array&&(s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=0,s[12]=0,s[13]=0,s[14]=0),s[0]=1,s[5]=1,s[10]=1,s[15]=1,s}function ne(s){return s[0]=1,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=1,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=1,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function be(s,t){var a=t[0],u=t[1],d=t[2],_=t[3],v=t[4],S=t[5],E=t[6],R=t[7],P=t[8],B=t[9],F=t[10],j=t[11],G=t[12],Q=t[13],J=t[14],ee=t[15],se=a*S-u*v,le=a*E-d*v,he=a*R-_*v,Ee=u*E-d*S,Ce=u*R-_*S,De=d*R-_*E,Le=P*Q-B*G,Fe=P*J-F*G,ut=P*ee-j*G,Ue=B*J-F*Q,dt=B*ee-j*Q,St=F*ee-j*J,gt=se*St-le*dt+he*Ue+Ee*ut-Ce*Fe+De*Le;return gt?(s[0]=(S*St-E*dt+R*Ue)*(gt=1/gt),s[1]=(d*dt-u*St-_*Ue)*gt,s[2]=(Q*De-J*Ce+ee*Ee)*gt,s[3]=(F*Ce-B*De-j*Ee)*gt,s[4]=(E*ut-v*St-R*Fe)*gt,s[5]=(a*St-d*ut+_*Fe)*gt,s[6]=(J*he-G*De-ee*le)*gt,s[7]=(P*De-F*he+j*le)*gt,s[8]=(v*dt-S*ut+R*Le)*gt,s[9]=(u*ut-a*dt-_*Le)*gt,s[10]=(G*Ce-Q*he+ee*se)*gt,s[11]=(B*he-P*Ce-j*se)*gt,s[12]=(S*Fe-v*Ue-E*Le)*gt,s[13]=(a*Ue-u*Fe+d*Le)*gt,s[14]=(Q*le-G*Ee-J*se)*gt,s[15]=(P*Ee-B*le+F*se)*gt,s):null}function ve(s,t,a){var u=t[0],d=t[1],_=t[2],v=t[3],S=t[4],E=t[5],R=t[6],P=t[7],B=t[8],F=t[9],j=t[10],G=t[11],Q=t[12],J=t[13],ee=t[14],se=t[15],le=a[0],he=a[1],Ee=a[2],Ce=a[3];return s[0]=le*u+he*S+Ee*B+Ce*Q,s[1]=le*d+he*E+Ee*F+Ce*J,s[2]=le*_+he*R+Ee*j+Ce*ee,s[3]=le*v+he*P+Ee*G+Ce*se,s[4]=(le=a[4])*u+(he=a[5])*S+(Ee=a[6])*B+(Ce=a[7])*Q,s[5]=le*d+he*E+Ee*F+Ce*J,s[6]=le*_+he*R+Ee*j+Ce*ee,s[7]=le*v+he*P+Ee*G+Ce*se,s[8]=(le=a[8])*u+(he=a[9])*S+(Ee=a[10])*B+(Ce=a[11])*Q,s[9]=le*d+he*E+Ee*F+Ce*J,s[10]=le*_+he*R+Ee*j+Ce*ee,s[11]=le*v+he*P+Ee*G+Ce*se,s[12]=(le=a[12])*u+(he=a[13])*S+(Ee=a[14])*B+(Ce=a[15])*Q,s[13]=le*d+he*E+Ee*F+Ce*J,s[14]=le*_+he*R+Ee*j+Ce*ee,s[15]=le*v+he*P+Ee*G+Ce*se,s}function we(s,t,a){var u,d,_,v,S,E,R,P,B,F,j,G,Q=a[0],J=a[1],ee=a[2];return t===s?(s[12]=t[0]*Q+t[4]*J+t[8]*ee+t[12],s[13]=t[1]*Q+t[5]*J+t[9]*ee+t[13],s[14]=t[2]*Q+t[6]*J+t[10]*ee+t[14],s[15]=t[3]*Q+t[7]*J+t[11]*ee+t[15]):(d=t[1],_=t[2],v=t[3],S=t[4],E=t[5],R=t[6],P=t[7],B=t[8],F=t[9],j=t[10],G=t[11],s[0]=u=t[0],s[1]=d,s[2]=_,s[3]=v,s[4]=S,s[5]=E,s[6]=R,s[7]=P,s[8]=B,s[9]=F,s[10]=j,s[11]=G,s[12]=u*Q+S*J+B*ee+t[12],s[13]=d*Q+E*J+F*ee+t[13],s[14]=_*Q+R*J+j*ee+t[14],s[15]=v*Q+P*J+G*ee+t[15]),s}function Pe(s,t,a){var u=a[0],d=a[1],_=a[2];return s[0]=t[0]*u,s[1]=t[1]*u,s[2]=t[2]*u,s[3]=t[3]*u,s[4]=t[4]*d,s[5]=t[5]*d,s[6]=t[6]*d,s[7]=t[7]*d,s[8]=t[8]*_,s[9]=t[9]*_,s[10]=t[10]*_,s[11]=t[11]*_,s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15],s}function Ze(s,t,a){var u=Math.sin(a),d=Math.cos(a),_=t[4],v=t[5],S=t[6],E=t[7],R=t[8],P=t[9],B=t[10],F=t[11];return t!==s&&(s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[3],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[4]=_*d+R*u,s[5]=v*d+P*u,s[6]=S*d+B*u,s[7]=E*d+F*u,s[8]=R*d-_*u,s[9]=P*d-v*u,s[10]=B*d-S*u,s[11]=F*d-E*u,s}function $e(s,t,a){var u=Math.sin(a),d=Math.cos(a),_=t[0],v=t[1],S=t[2],E=t[3],R=t[8],P=t[9],B=t[10],F=t[11];return t!==s&&(s[4]=t[4],s[5]=t[5],s[6]=t[6],s[7]=t[7],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=_*d-R*u,s[1]=v*d-P*u,s[2]=S*d-B*u,s[3]=E*d-F*u,s[8]=_*u+R*d,s[9]=v*u+P*d,s[10]=S*u+B*d,s[11]=E*u+F*d,s}function xt(s,t,a){var u=Math.sin(a),d=Math.cos(a),_=t[0],v=t[1],S=t[2],E=t[3],R=t[4],P=t[5],B=t[6],F=t[7];return t!==s&&(s[8]=t[8],s[9]=t[9],s[10]=t[10],s[11]=t[11],s[12]=t[12],s[13]=t[13],s[14]=t[14],s[15]=t[15]),s[0]=_*d+R*u,s[1]=v*d+P*u,s[2]=S*d+B*u,s[3]=E*d+F*u,s[4]=R*d-_*u,s[5]=P*d-v*u,s[6]=B*d-S*u,s[7]=F*d-E*u,s}function Ct(s,t){return s[0]=t[0],s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=t[1],s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=t[2],s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}function Ft(s,t,a){var u,d,_,v=a[0],S=a[1],E=a[2],R=Math.sqrt(v*v+S*S+E*E);return R<C?null:(v*=R=1/R,S*=R,E*=R,u=Math.sin(t),d=Math.cos(t),s[0]=v*v*(_=1-d)+d,s[1]=S*v*_+E*u,s[2]=E*v*_-S*u,s[3]=0,s[4]=v*S*_-E*u,s[5]=S*S*_+d,s[6]=E*S*_+v*u,s[7]=0,s[8]=v*E*_+S*u,s[9]=S*E*_-v*u,s[10]=E*E*_+d,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s)}function Yt(s,t){var a=t[0],u=t[1],d=t[2],_=t[3],v=a+a,S=u+u,E=d+d,R=a*v,P=u*v,B=u*S,F=d*v,j=d*S,G=d*E,Q=_*v,J=_*S,ee=_*E;return s[0]=1-B-G,s[1]=P+ee,s[2]=F-J,s[3]=0,s[4]=P-ee,s[5]=1-R-G,s[6]=j+Q,s[7]=0,s[8]=F+J,s[9]=j-Q,s[10]=1-R-B,s[11]=0,s[12]=0,s[13]=0,s[14]=0,s[15]=1,s}var hr=ve;function pr(){var s=new D(3);return D!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s}function Kr(s){var t=new D(3);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t}function ui(s){var t=s[0],a=s[1],u=s[2];return Math.sqrt(t*t+a*a+u*u)}function zi(s,t,a){var u=new D(3);return u[0]=s,u[1]=t,u[2]=a,u}function Qr(s,t,a,u){return s[0]=t,s[1]=a,s[2]=u,s}function Ot(s,t,a){return s[0]=t[0]+a[0],s[1]=t[1]+a[1],s[2]=t[2]+a[2],s}function sr(s,t,a){return s[0]=t[0]-a[0],s[1]=t[1]-a[1],s[2]=t[2]-a[2],s}function Fr(s,t,a){return s[0]=t[0]*a[0],s[1]=t[1]*a[1],s[2]=t[2]*a[2],s}function Pi(s,t,a){return s[0]=Math.min(t[0],a[0]),s[1]=Math.min(t[1],a[1]),s[2]=Math.min(t[2],a[2]),s}function it(s,t,a){return s[0]=Math.max(t[0],a[0]),s[1]=Math.max(t[1],a[1]),s[2]=Math.max(t[2],a[2]),s}function Vt(s,t,a){return s[0]=t[0]*a,s[1]=t[1]*a,s[2]=t[2]*a,s}function Er(s,t,a,u){return s[0]=t[0]+a[0]*u,s[1]=t[1]+a[1]*u,s[2]=t[2]+a[2]*u,s}function Rr(s,t){var a=t[0]-s[0],u=t[1]-s[1],d=t[2]-s[2];return a*a+u*u+d*d}function oi(s){var t=s[0],a=s[1],u=s[2];return t*t+a*a+u*u}function Gi(s,t){return s[0]=-t[0],s[1]=-t[1],s[2]=-t[2],s}function Cr(s,t){var a=t[0],u=t[1],d=t[2],_=a*a+u*u+d*d;return _>0&&(_=1/Math.sqrt(_)),s[0]=t[0]*_,s[1]=t[1]*_,s[2]=t[2]*_,s}function Vi(s,t){return s[0]*t[0]+s[1]*t[1]+s[2]*t[2]}function vi(s,t,a){var u=t[0],d=t[1],_=t[2],v=a[0],S=a[1],E=a[2];return s[0]=d*E-_*S,s[1]=_*v-u*E,s[2]=u*S-d*v,s}function ho(s,t,a,u){var d=t[0],_=t[1],v=t[2];return s[0]=d+u*(a[0]-d),s[1]=_+u*(a[1]-_),s[2]=v+u*(a[2]-v),s}function Tn(s,t,a){var u=t[0],d=t[1],_=t[2],v=a[3]*u+a[7]*d+a[11]*_+a[15];return s[0]=(a[0]*u+a[4]*d+a[8]*_+a[12])/(v=v||1),s[1]=(a[1]*u+a[5]*d+a[9]*_+a[13])/v,s[2]=(a[2]*u+a[6]*d+a[10]*_+a[14])/v,s}function qs(s,t,a){var u=t[0],d=t[1],_=t[2];return s[0]=u*a[0]+d*a[3]+_*a[6],s[1]=u*a[1]+d*a[4]+_*a[7],s[2]=u*a[2]+d*a[5]+_*a[8],s}function gl(s,t,a){var u=a[0],d=a[1],_=a[2],v=a[3],S=t[0],E=t[1],R=t[2],P=d*R-_*E,B=_*S-u*R,F=u*E-d*S;return s[0]=S+v*(P+=P)+d*(F+=F)-_*(B+=B),s[1]=E+v*B+_*P-u*F,s[2]=R+v*F+u*B-d*P,s}function zu(s){return s[0]=0,s[1]=0,s[2]=0,s}function Va(s,t){return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]}var On=sr,Mf=Fr,Zo=ui;function Df(){var s=new D(4);return D!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0,s[3]=0),s}function na(s,t,a){return s[0]=t[0]*a,s[1]=t[1]*a,s[2]=t[2]*a,s[3]=t[3]*a,s}function Zl(s,t){var a=t[0],u=t[1],d=t[2],_=t[3],v=a*a+u*u+d*d+_*_;return v>0&&(v=1/Math.sqrt(v)),s[0]=a*v,s[1]=u*v,s[2]=d*v,s[3]=_*v,s}function Wo(s,t,a){var u=t[0],d=t[1],_=t[2],v=t[3];return s[0]=a[0]*u+a[4]*d+a[8]*_+a[12]*v,s[1]=a[1]*u+a[5]*d+a[9]*_+a[13]*v,s[2]=a[2]*u+a[6]*d+a[10]*_+a[14]*v,s[3]=a[3]*u+a[7]*d+a[11]*_+a[15]*v,s}function Wl(){var s=new D(4);return D!=Float32Array&&(s[0]=0,s[1]=0,s[2]=0),s[3]=1,s}function _l(s){return s[0]=0,s[1]=0,s[2]=0,s[3]=1,s}function Fu(s,t,a){a*=.5;var u=t[0],d=t[1],_=t[2],v=t[3],S=Math.sin(a),E=Math.cos(a);return s[0]=u*E+v*S,s[1]=d*E+_*S,s[2]=_*E-d*S,s[3]=v*E-u*S,s}function ku(s,t,a){a*=.5;var u=t[0],d=t[1],_=t[2],v=t[3],S=Math.sin(a),E=Math.cos(a);return s[0]=u*E-_*S,s[1]=d*E+v*S,s[2]=_*E+u*S,s[3]=v*E-d*S,s}pr(),Df();var Ro,$n,ys,vo=Zl,Ah=(Ro=pr(),$n=zi(1,0,0),ys=zi(0,1,0),function(s,t,a){var u=Vi(t,a);return u<-.999999?(vi(Ro,$n,t),Zo(Ro)<1e-6&&vi(Ro,ys,t),Cr(Ro,Ro),(function(d,_,v){v*=.5;var S=Math.sin(v);d[0]=S*_[0],d[1]=S*_[1],d[2]=S*_[2],d[3]=Math.cos(v)})(s,Ro,Math.PI),s):u>.999999?(s[0]=0,s[1]=0,s[2]=0,s[3]=1,s):(vi(Ro,t,a),s[0]=Ro[0],s[1]=Ro[1],s[2]=Ro[2],s[3]=1+u,vo(s,s))});function Mo(){var s=new D(2);return D!=Float32Array&&(s[0]=0,s[1]=0),s}function $s(s,t){var a=new D(2);return a[0]=s,a[1]=t,a}function Nc(s,t,a){return s[0]=t,s[1]=a,s}function Xs(s,t,a){return s[0]=t[0]+a[0],s[1]=t[1]+a[1],s}function oa(s,t,a){return s[0]=t[0]-a[0],s[1]=t[1]-a[1],s}function vs(s,t,a){return s[0]=t[0]*a,s[1]=t[1]*a,s}function Zs(s){var t=s[0],a=s[1];return Math.sqrt(t*t+a*a)}function gn(s,t){var a=t[0],u=t[1],d=a*a+u*u;return d>0&&(d=1/Math.sqrt(d)),s[0]=t[0]*d,s[1]=t[1]*d,s}function xo(s,t){return s[0]*t[0]+s[1]*t[1]}Wl(),Wl(),U();var Eh,Yl,ya=oa;function Of(s){return s&&s.__esModule&&Object.prototype.hasOwnProperty.call(s,"default")?s.default:s}Mo();var Ch=(function(){if(Yl)return Eh;function s(t,a,u,d){this.cx=3*t,this.bx=3*(u-t)-this.cx,this.ax=1-this.cx-this.bx,this.cy=3*a,this.by=3*(d-a)-this.cy,this.ay=1-this.cy-this.by,this.p1x=t,this.p1y=a,this.p2x=u,this.p2y=d}return Yl=1,Eh=s,s.prototype={sampleCurveX:function(t){return((this.ax*t+this.bx)*t+this.cx)*t},sampleCurveY:function(t){return((this.ay*t+this.by)*t+this.cy)*t},sampleCurveDerivativeX:function(t){return(3*this.ax*t+2*this.bx)*t+this.cx},solveCurveX:function(t,a){if(a===void 0&&(a=1e-6),t<0)return 0;if(t>1)return 1;for(var u=t,d=0;d<8;d++){var _=this.sampleCurveX(u)-t;if(Math.abs(_)<a)return u;var v=this.sampleCurveDerivativeX(u);if(Math.abs(v)<1e-6)break;u-=_/v}var S=0,E=1;for(u=t,d=0;d<20&&(_=this.sampleCurveX(u),!(Math.abs(_-t)<a));d++)t>_?S=u:E=u,u=.5*(E-S)+S;return u},solve:function(t,a){return this.sampleCurveY(this.solveCurveX(t,a))}},Eh})(),Pf=Of(Ch);function Tt(s,t){this.x=s,this.y=t}function Ws(s,t){if(Array.isArray(s)){if(!Array.isArray(t)||s.length!==t.length)return!1;for(let a=0;a<s.length;a++)if(!Ws(s[a],t[a]))return!1;return!0}if(typeof s=="object"&&s!==null&&t!==null){if(typeof t!="object"||Object.keys(s).length!==Object.keys(t).length)return!1;for(const a in s)if(!Ws(s[a],t[a]))return!1;return!0}return s===t}Tt.prototype={clone(){return new Tt(this.x,this.y)},add(s){return this.clone()._add(s)},sub(s){return this.clone()._sub(s)},multByPoint(s){return this.clone()._multByPoint(s)},divByPoint(s){return this.clone()._divByPoint(s)},mult(s){return this.clone()._mult(s)},div(s){return this.clone()._div(s)},rotate(s){return this.clone()._rotate(s)},rotateAround(s,t){return this.clone()._rotateAround(s,t)},matMult(s){return this.clone()._matMult(s)},unit(){return this.clone()._unit()},perp(){return this.clone()._perp()},round(){return this.clone()._round()},mag(){return Math.sqrt(this.x*this.x+this.y*this.y)},equals(s){return this.x===s.x&&this.y===s.y},dist(s){return Math.sqrt(this.distSqr(s))},distSqr(s){const t=s.x-this.x,a=s.y-this.y;return t*t+a*a},angle(){return Math.atan2(this.y,this.x)},angleTo(s){return Math.atan2(this.y-s.y,this.x-s.x)},angleWith(s){return this.angleWithSep(s.x,s.y)},angleWithSep(s,t){return Math.atan2(this.x*t-this.y*s,this.x*s+this.y*t)},_matMult(s){const t=s[2]*this.x+s[3]*this.y;return this.x=s[0]*this.x+s[1]*this.y,this.y=t,this},_add(s){return this.x+=s.x,this.y+=s.y,this},_sub(s){return this.x-=s.x,this.y-=s.y,this},_mult(s){return this.x*=s,this.y*=s,this},_div(s){return this.x/=s,this.y/=s,this},_multByPoint(s){return this.x*=s.x,this.y*=s.y,this},_divByPoint(s){return this.x/=s.x,this.y/=s.y,this},_unit(){return this._div(this.mag()),this},_perp(){const s=this.y;return this.y=this.x,this.x=-s,this},_rotate(s){const t=Math.cos(s),a=Math.sin(s),u=a*this.x+t*this.y;return this.x=t*this.x-a*this.y,this.y=u,this},_rotateAround(s,t){const a=Math.cos(s),u=Math.sin(s),d=t.y+u*(this.x-t.x)+a*(this.y-t.y);return this.x=t.x+a*(this.x-t.x)-u*(this.y-t.y),this.y=d,this},_round(){return this.x=Math.round(this.x),this.y=Math.round(this.y),this},constructor:Tt},Tt.convert=function(s){if(s instanceof Tt)return s;if(Array.isArray(s))return new Tt(+s[0],+s[1]);if(s.x!==void 0&&s.y!==void 0)return new Tt(+s.x,+s.y);throw new Error("Expected [x, y] or {x, y} point format")};const Ud=Math.PI/180,Ih=180/Math.PI;function Ne(s){return s*Ud}function te(s){return s*Ih}const oe=[[0,0],[1,0],[1,1],[0,1]];function me(s){if(s<=0)return 0;if(s>=1)return 1;const t=s*s,a=t*s;return 4*(s<.5?a:3*(s-t)+a-.75)}function Me(s,t,a,u){const d=new Pf(s,t,a,u);return function(_){return d.solve(_)}}const Re=Me(.25,.1,.25,1);function Ie(s,t,a){return Math.min(a,Math.max(t,s))}function Qe(s,t,a){return(a=Ie((a-s)/(t-s),0,1))*a*(3-2*a)}function Be(s,t,a){const u=a-t,d=((s-t)%u+u)%u+t;return d===t?a:d}function Je(s,t,a){if(!s.length)return a(null,[]);let u=s.length;const d=new Array(s.length);let _=null;s.forEach(((v,S)=>{t(v,((E,R)=>{E&&(_=E),d[S]=R,--u==0&&a(_,d)}))}))}let Pt=1;function _t(){return Pt++}function lr(s){return s<=1?1:Math.pow(2,Math.ceil(Math.log2(s)))}function yr(s,t){s.forEach((a=>{t[a]&&(t[a]=t[a].bind(t))}))}function gr(s,t,a){const u={};for(const d in s)u[d]=t.call(this,s[d],d,s);return u}function Jr(s,t,a){const u={};for(const d in s)t.call(this,s[d],d,s)&&(u[d]=s[d]);return u}function qr(s){return Array.isArray(s)?s.map(qr):typeof s=="object"&&s?gr(s,qr):s}function Yr(s,t){for(let a=0;a<s.length;a++)if(t.indexOf(s[a])>=0)return!0;return!1}const Ri={};function ri(s){Ri[s]||(typeof console<"u"&&console.warn(s),Ri[s]=!0)}function An(s,t,a){return(a.y-s.y)*(t.x-s.x)>(t.y-s.y)*(a.x-s.x)}function Xn(s){let t=0;for(let a,u,d=0,_=s.length,v=_-1;d<_;v=d++)a=s[d],u=s[v],t+=(u.x-a.x)*(a.y+u.y);return t}function eo([s,t,a]){const u=Ne(t+90),d=Ne(a);return{x:s*Math.cos(u)*Math.sin(d),y:s*Math.sin(u)*Math.sin(d),z:s*Math.cos(d),azimuthal:t,polar:a}}function Li(s){return(typeof self<"u"||s!==void 0)&&typeof WorkerGlobalScope<"u"&&(s!==void 0?s:self)instanceof WorkerGlobalScope}function mi(s){const t={};if(s.replace(/(?:^|(?:\s*\,\s*))([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)(?:\=(?:([^\x00-\x20\(\)<>@\,;\:\\"\/\[\]\?\=\{\}\x7F]+)|(?:\"((?:[^"\\]|\\.)*)\")))?/g,((a,u,d,_)=>{const v=d||_;return t[u]=!v||v.toLowerCase(),""})),t["max-age"]){const a=parseInt(t["max-age"],10);isNaN(a)?delete t["max-age"]:t["max-age"]=a}return t}let $i=null;function _n(s,t){return[s[4*t],s[4*t+1],s[4*t+2],s[4*t+3]]}function Wi(s,t,a,u){for(;t<a;){const d=t+a>>1;s[d]<u?t=d+1:a=d}return t}function to(s,t,a,u){for(;t<a;){const d=t+a>>1;s[d]<=u?t=d+1:a=d}return t}function No(s){return s>0?1/(1.001-s):1+s}function va(s){return s>0?1-1/(1.001-s):-s}function Ql(s,t,a){return(s-t.min)*(a.max-a.min)/(t.max-t.min)+a.min}const Vo={API_URL:"https://api.mapbox.com",get API_URL_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/|\?|$)/i},get API_TILEJSON_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/v[0-9]*\/.*\.json.*$)/i},get API_SPRITE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*\/sprite.*\..*$)/i},get API_FONTS_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/fonts\/v[0-9]*\/)(.*\.pbf.*$)/i},get API_STYLE_REGEX(){return/^((https?:)?\/\/)?([^\/]+\.)?mapbox\.c(n|om)(\/styles\/v[0-9]*\/)(.*$)/i},get API_CDN_URL_REGEX(){return/^((https?:)?\/\/)?api\.mapbox\.c(n|om)(\/mapbox-gl-js\/)(.*$)/i},get EVENTS_URL(){if(!Vo.API_URL)return null;try{const s=new URL(Vo.API_URL);return s.hostname==="api.mapbox.cn"?"https://events.mapbox.cn/events/v2":s.hostname==="api.mapbox.com"?"https://events.mapbox.com/events/v2":null}catch{return null}},SESSION_PATH:"/map-sessions/v1",FEEDBACK_URL:"https://apps.mapbox.com/feedback",TILE_URL_VERSION:"v4",RASTER_URL_PREFIX:"raster/v1",RASTERARRAYS_URL_PREFIX:"rasterarrays/v1",REQUIRE_ACCESS_TOKEN:!0,ACCESS_TOKEN:null,DEFAULT_STYLE:"mapbox://styles/mapbox/standard",MAX_PARALLEL_IMAGE_REQUESTS:16,DRACO_URL:"https://api.mapbox.com/mapbox-gl-js/draco_decoder_gltf_v1.5.6.wasm",MESHOPT_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_base_v0.20.wasm",MESHOPT_SIMD_URL:"https://api.mapbox.com/mapbox-gl-js/meshopt_simd_v0.20.wasm",BUILDING_GEN_URL:"https://api.mapbox.com/mapbox-gl-js/building-gen/building_gen_v1.2.3.wasm",GLYPHS_URL:"mapbox://fonts/mapbox/{fontstack}/{range}.pbf",TILES3D_URL_PREFIX:"3dtiles/v1"};function Yo(s){return Vo.API_URL_REGEX.test(s)}function pm(s){return Vo.API_SPRITE_REGEX.test(s)}let Vc,Kl,Rh,Uc,jc,aa;function Lf(){return Vc==null&&(Vc=self.OffscreenCanvas&&new OffscreenCanvas(1,1).getContext("2d")&&typeof self.createImageBitmap=="function"),Vc}const Ys={now:()=>Uc!==void 0?Uc:performance.now(),setNow(s){Uc=s},restoreNow(){Uc=void 0},frame(s){const t=requestAnimationFrame(s);return{cancel:()=>cancelAnimationFrame(t)}},getImageData(s,t=0){const{width:a,height:u}=s;jc||(jc=document.createElement("canvas"));const d=jc.getContext("2d",{willReadFrequently:!0});if(!d)throw new Error("failed to create canvas 2d context");return(a>jc.width||u>jc.height)&&(jc.width=a,jc.height=u),d.clearRect(-t,-t,a+2*t,u+2*t),d.drawImage(s,0,0,a,u),d.getImageData(-t,-t,a+2*t,u+2*t)},resolveURL:s=>(Kl||(Kl=document.createElement("a")),Kl.href=s,Kl.href),get devicePixelRatio(){return window.devicePixelRatio},get prefersReducedMotion(){return!!window.matchMedia&&(Rh==null&&(Rh=window.matchMedia("(prefers-reduced-motion: reduce)")),Rh.matches)},hasCanvasFingerprintNoise(){if(aa!==void 0)return aa;if(!Lf())return aa=!1,!1;const s=new OffscreenCanvas(85,1),t=s.getContext("2d",{willReadFrequently:!0});let a=0;for(let d=0;d<s.width;++d)t.fillStyle=`rgba(${a++},${a++},${a++}, 255)`,t.fillRect(d,0,1,1);const u=t.getImageData(0,0,s.width,s.height);a=0;for(let d=0;d<u.data.length;++d)if(d%4!=3&&a++!==u.data[d])return aa=!0,!0;return aa=!1,!1}};function Bf(s,t){const a=s.indexOf("?");if(a<0)return`${s}?${new URLSearchParams(t).toString()}`;const u=new URLSearchParams(s.slice(a));for(const d in t)u.set(d,t[d]);return`${s.slice(0,a)}?${u.toString()}`}function Jl(s,t={persistentParams:[]}){const a=s.indexOf("?");if(a<0)return s;const u=new URLSearchParams,d=new URLSearchParams(s.slice(a));for(const v of t.persistentParams){const S=d.get(v);S&&u.set(v,S)}const _=u.toString();return`${s.slice(0,a)}${_.length>0?`?${_}`:""}`}const Ua="mapbox-tiles";let xs=500,ja=50;const Qs=["language","worldview","jobid"];let Qo,Gc;function zf(){try{return caches}catch{}}function Ff(){const s=zf();s&&Qo==null&&(Qo=s.open(Ua))}let Hc=1/0;const qc={supported:!1,testSupport:function(s){!Uo&&$c&&(Xc?Zc(s):Nu=s)}};let Nu,$c,Uo=!1,Xc=!1;const kf=typeof self<"u"?self:{};function Zc(s){const t=s.createTexture();s.bindTexture(s.TEXTURE_2D,t);try{if(s.texImage2D(s.TEXTURE_2D,0,s.RGBA,s.RGBA,s.UNSIGNED_BYTE,$c),s.isContextLost())return;qc.supported=!0}catch{}s.deleteTexture(t),Uo=!0}kf.document&&($c=kf.document.createElement("img"),$c.onload=function(){Nu&&Zc(Nu),Nu=null,Xc=!0},$c.onerror=function(){Uo=!0,Nu=null},$c.src="data:image/webp;base64,UklGRh4AAABXRUJQVlA4TBEAAAAvAQAAAAfQ//73v/+BiOh/AAA=");const Nf={Unknown:"Unknown",Style:"Style",Source:"Source",Tile:"Tile",Glyphs:"Glyphs",SpriteImage:"SpriteImage",SpriteJSON:"SpriteJSON",Iconset:"Iconset",Image:"Image",Model:"Model"};typeof Object.freeze=="function"&&Object.freeze(Nf);class Vu extends Error{constructor(t,a,u){a===401&&Yo(u)&&(t+=": you may have provided an invalid Mapbox access token. See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes"),super(t),this.status=a,this.url=u}toString(){return`${this.name}: ${this.message} (${this.status}): ${this.url}`}}const bs=Li()?()=>self.worker.referrer:()=>(location.protocol==="blob:"?parent:self).location.href,ai=function(s,t){if(!(/^file:/.test(a=s.url)||/^file:/.test(bs())&&!/^\w+:/.test(a))){if(self.fetch&&self.Request&&self.AbortController&&Request.prototype.hasOwnProperty("signal"))return(function(u,d){const _=new AbortController,v=new Request(u.url,{method:u.method||"GET",body:u.body,credentials:u.credentials,headers:u.headers,referrer:bs(),referrerPolicy:u.referrerPolicy,signal:_.signal});let S=!1,E=!1;const R=(P=v.url).indexOf("sku=")>0&&Yo(P);var P;u.type==="json"&&v.headers.set("Accept","application/json");const B=(j,G,Q)=>{if(E)return;if(j&&j.message!=="SecurityError"&&ri(j.toString()),G&&Q)return F(G);const J=Date.now();fetch(v).then((ee=>{if(ee.ok){const se=R?ee.clone():null;return F(ee,se,J)}return d(new Vu(ee.statusText,ee.status,u.url))})).catch((ee=>{ee.name!=="AbortError"&&d(new Error(`${ee.message} ${u.url}`))}))},F=(j,G,Q)=>{(u.type==="arrayBuffer"?j.arrayBuffer():u.type==="json"?j.json():j.text()).then((J=>{E||(G&&Q&&(function(ee,se,le){if(Ff(),Qo==null)return;const he=mi(se.headers.get("Cache-Control")||"");if(he["no-store"])return;const Ee={status:se.status,statusText:se.statusText,headers:new Headers};se.headers.forEach(((Le,Fe)=>Ee.headers.set(Fe,Le))),he["max-age"]&&Ee.headers.set("Expires",new Date(le+1e3*he["max-age"]).toUTCString());const Ce=Ee.headers.get("Expires");if(!Ce||new Date(Ce).getTime()-le<42e4)return;let De=Jl(ee.url,{persistentParams:Qs});if(se.status===206){const Le=ee.headers.get("Range");if(!Le)return;Ee.status=200,De=Bf(De,{range:Le})}(function(Le,Fe){if(Gc===void 0)try{new Response(new ReadableStream),Gc=!0}catch{Gc=!1}Gc?Fe(Le.body):Le.blob().then(Fe).catch((ut=>ri(ut.message)))})(se,(Le=>{const Fe=new Response((ut=se.status)!==200&&ut!==404&&[101,103,204,205,304].includes(ut)?null:Le,Ee);var ut;Ff(),Qo?.then((Ue=>Ue.put(De,Fe))).catch((Ue=>ri(Ue.message)))}))})(v,G,Q),S=!0,d(null,J,j.headers.get("Cache-Control"),j.headers.get("Expires")))})).catch((J=>{E||d(new Error(J.message))}))};return R?(function(j,G){if(Ff(),Qo==null)return G(null);Qo.then((Q=>{let J=Jl(j.url,{persistentParams:Qs});const ee=j.headers.get("Range");ee&&(J=Bf(J,{range:ee})),Q.match(J).then((se=>{const le=(function(he){if(!he)return!1;const Ee=new Date(he.headers.get("Expires")||0),Ce=mi(he.headers.get("Cache-Control")||"");return Number(Ee)>Date.now()&&!Ce["no-cache"]})(se);Q.delete(J).catch(G),le&&Q.put(J,se.clone()).catch(G),G(null,se,le)})).catch(G)})).catch(G)})(v,B):B(null,null),{cancel:()=>{E=!0,S||_.abort()}}})(s,t);if(Li(self)&&self.worker.actor)return self.worker.actor.send("getResource",s,t,void 0,!0)}var a;return(function(u,d){const _=new XMLHttpRequest;_.open(u.method||"GET",u.url,!0),u.type==="arrayBuffer"&&(_.responseType="arraybuffer");for(const v in u.headers)_.setRequestHeader(v,u.headers[v]);return u.type==="json"&&(_.responseType="text",_.setRequestHeader("Accept","application/json")),_.withCredentials=u.credentials==="include",_.onerror=()=>{d(new Error(_.statusText))},_.onload=()=>{if((_.status>=200&&_.status<300||_.status===0)&&_.response!==null){let v=_.response;if(u.type==="json")try{v=JSON.parse(_.response)}catch(S){return d(S)}d(null,v,_.getResponseHeader("Cache-Control"),_.getResponseHeader("Expires"))}else d(new Vu(_.statusText,_.status,u.url))},_.send(u.body),{cancel:()=>_.abort()}})(s,t)},yl=function(s,t){return ai(Object.assign(s,{type:"arrayBuffer"}),t)};function ec(s){const t=document.createElement("a");return t.href=s,t.protocol===location.protocol&&t.host===location.host}const jd="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAAAEAAAABCAYAAAAfFcSJAAAAC0lEQVQYV2NgAAIAAAUAAarVyFEAAAAASUVORK5CYII=";let Uu,tc;Uu=[],tc=0;const rc=function(s,t){if(qc.supported&&(s.headers||(s.headers={}),s.headers.accept="image/webp,*/*"),tc>=Vo.MAX_PARALLEL_IMAGE_REQUESTS){const _={requestParameters:s,callback:t,cancelled:!1,cancel(){this.cancelled=!0}};return Uu.push(_),_}tc++;let a=!1;const u=()=>{if(!a)for(a=!0,tc--;Uu.length&&tc<Vo.MAX_PARALLEL_IMAGE_REQUESTS;){const _=Uu.shift(),{requestParameters:v,callback:S,cancelled:E}=_;E||(_.cancel=rc(v,S).cancel)}},d=yl(s,((_,v,S,E)=>{u(),_?t(_):v&&(self.createImageBitmap?(function(R,P){const B=new Blob([new Uint8Array(R)],{type:"image/png"});createImageBitmap(B).then((F=>{P(null,F)})).catch((F=>{P(new Error(`Could not load image because of ${F.message}. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported.`))}))})(v,((R,P)=>t(R,P,S,E))):(function(R,P){const B=new Image;B.onload=()=>{P(null,B),URL.revokeObjectURL(B.src),B.onload=null,requestAnimationFrame((()=>{B.src=jd}))},B.onerror=()=>P(new Error("Could not load image. Please make sure to use a supported image type such as PNG or JPEG. Note that SVGs are not supported."));const F=new Blob([new Uint8Array(R)],{type:"image/png"});B.src=R.byteLength?URL.createObjectURL(F):jd})(v,((R,P)=>t(R,P,S,E))))}));return{cancel:()=>{d.cancel(),u()}}};var Wc,Vf,xa,es={exports:{}},Uf={exports:{}},ju={exports:{}},Mh=(function(){if(xa)return es.exports;xa=1;var s=(Wc||(Wc=1,Uf.exports=function(a,u){var d,_,v,S,E,R,P,B;for(_=a.length-(d=3&a.length),v=u,E=3432918353,R=461845907,B=0;B<_;)P=255&a.charCodeAt(B)|(255&a.charCodeAt(++B))<<8|(255&a.charCodeAt(++B))<<16|(255&a.charCodeAt(++B))<<24,++B,v=27492+(65535&(S=5*(65535&(v=(v^=P=(65535&(P=(P=(65535&P)*E+(((P>>>16)*E&65535)<<16)&4294967295)<<15|P>>>17))*R+(((P>>>16)*R&65535)<<16)&4294967295)<<13|v>>>19))+((5*(v>>>16)&65535)<<16)&4294967295))+((58964+(S>>>16)&65535)<<16);switch(P=0,d){case 3:P^=(255&a.charCodeAt(B+2))<<16;case 2:P^=(255&a.charCodeAt(B+1))<<8;case 1:v^=P=(65535&(P=(P=(65535&(P^=255&a.charCodeAt(B)))*E+(((P>>>16)*E&65535)<<16)&4294967295)<<15|P>>>17))*R+(((P>>>16)*R&65535)<<16)&4294967295}return v^=a.length,v=2246822507*(65535&(v^=v>>>16))+((2246822507*(v>>>16)&65535)<<16)&4294967295,v=3266489909*(65535&(v^=v>>>13))+((3266489909*(v>>>16)&65535)<<16)&4294967295,(v^=v>>>16)>>>0}),Uf.exports),t=(Vf||(Vf=1,ju.exports=function(a,u){for(var d,_=a.length,v=u^_,S=0;_>=4;)d=1540483477*(65535&(d=255&a.charCodeAt(S)|(255&a.charCodeAt(++S))<<8|(255&a.charCodeAt(++S))<<16|(255&a.charCodeAt(++S))<<24))+((1540483477*(d>>>16)&65535)<<16),v=1540483477*(65535&v)+((1540483477*(v>>>16)&65535)<<16)^(d=1540483477*(65535&(d^=d>>>24))+((1540483477*(d>>>16)&65535)<<16)),_-=4,++S;switch(_){case 3:v^=(255&a.charCodeAt(S+2))<<16;case 2:v^=(255&a.charCodeAt(S+1))<<8;case 1:v=1540483477*(65535&(v^=255&a.charCodeAt(S)))+((1540483477*(v>>>16)&65535)<<16)}return v=1540483477*(65535&(v^=v>>>13))+((1540483477*(v>>>16)&65535)<<16),(v^=v>>>15)>>>0}),ju.exports);return es.exports=s,es.exports.murmur3=s,es.exports.murmur2=t,es.exports})(),Dh=Of(Mh);class ts{constructor(t,...a){Object.assign(this,a[0]||{}),this.type=t}}class ic extends ts{constructor(t,a={}){super("error",Object.assign({error:t},a))}}function Gu(s,t,a){a[s]&&a[s].indexOf(t)!==-1||(a[s]=a[s]||[],a[s].push(t))}function Ga(s,t,a){if(a&&a[s]){const u=a[s].indexOf(t);u!==-1&&a[s].splice(u,1)}}class Hu{on(t,a){return this._listeners=this._listeners||{},Gu(t,a,this._listeners),this}off(t,a){return Ga(t,a,this._listeners),Ga(t,a,this._oneTimeListeners),this}once(t,a){return a?(this._oneTimeListeners=this._oneTimeListeners||{},Gu(t,a,this._oneTimeListeners),this):new Promise((u=>{this.once(t,u)}))}fire(t,a){const u=typeof t=="string"?new ts(t,a):t,d=u.type;if(this.listens(d)){u.target=this;const _=this._listeners&&this._listeners[d]?this._listeners[d].slice():[];for(const E of _)E.call(this,u);const v=this._oneTimeListeners&&this._oneTimeListeners[d]?this._oneTimeListeners[d].slice():[];for(const E of v)Ga(d,E,this._oneTimeListeners),E.call(this,u);const S=this._eventedParent;if(S){const E=typeof this._eventedParentData=="function"?this._eventedParentData():this._eventedParentData;Object.assign(u,E),S.fire(u)}}else u instanceof ic&&console.error(u.error);return this}listens(t){return!!(this._listeners&&this._listeners[t]&&this._listeners[t].length>0||this._oneTimeListeners&&this._oneTimeListeners[t]&&this._oneTimeListeners[t].length>0||this._eventedParent&&this._eventedParent.listens(t))}setEventedParent(t,a){return this._eventedParent=t,this._eventedParentData=a,this}}class rs{constructor(t){typeof t=="string"?this.name=t:(this.name=t.name,this.iconsetId=t.iconsetId)}static from(t){return new rs(t)}static toString(t){return t.iconsetId?`${t.name}${t.iconsetId}`:t.name}static parse(t){const[a,u]=t.split("");return new rs({name:a,iconsetId:u})}static isEqual(t,a){return t.name===a.name&&t.iconsetId===a.iconsetId}toString(){return rs.toString(this)}serialize(){return{name:this.name,iconsetId:this.iconsetId}}}var mm,Oh={},gm=(function(){if(mm)return Oh;mm=1;var s={transparent:[0,0,0,0],aliceblue:[240,248,255,1],antiquewhite:[250,235,215,1],aqua:[0,255,255,1],aquamarine:[127,255,212,1],azure:[240,255,255,1],beige:[245,245,220,1],bisque:[255,228,196,1],black:[0,0,0,1],blanchedalmond:[255,235,205,1],blue:[0,0,255,1],blueviolet:[138,43,226,1],brown:[165,42,42,1],burlywood:[222,184,135,1],cadetblue:[95,158,160,1],chartreuse:[127,255,0,1],chocolate:[210,105,30,1],coral:[255,127,80,1],cornflowerblue:[100,149,237,1],cornsilk:[255,248,220,1],crimson:[220,20,60,1],cyan:[0,255,255,1],darkblue:[0,0,139,1],darkcyan:[0,139,139,1],darkgoldenrod:[184,134,11,1],darkgray:[169,169,169,1],darkgreen:[0,100,0,1],darkgrey:[169,169,169,1],darkkhaki:[189,183,107,1],darkmagenta:[139,0,139,1],darkolivegreen:[85,107,47,1],darkorange:[255,140,0,1],darkorchid:[153,50,204,1],darkred:[139,0,0,1],darksalmon:[233,150,122,1],darkseagreen:[143,188,143,1],darkslateblue:[72,61,139,1],darkslategray:[47,79,79,1],darkslategrey:[47,79,79,1],darkturquoise:[0,206,209,1],darkviolet:[148,0,211,1],deeppink:[255,20,147,1],deepskyblue:[0,191,255,1],dimgray:[105,105,105,1],dimgrey:[105,105,105,1],dodgerblue:[30,144,255,1],firebrick:[178,34,34,1],floralwhite:[255,250,240,1],forestgreen:[34,139,34,1],fuchsia:[255,0,255,1],gainsboro:[220,220,220,1],ghostwhite:[248,248,255,1],gold:[255,215,0,1],goldenrod:[218,165,32,1],gray:[128,128,128,1],green:[0,128,0,1],greenyellow:[173,255,47,1],grey:[128,128,128,1],honeydew:[240,255,240,1],hotpink:[255,105,180,1],indianred:[205,92,92,1],indigo:[75,0,130,1],ivory:[255,255,240,1],khaki:[240,230,140,1],lavender:[230,230,250,1],lavenderblush:[255,240,245,1],lawngreen:[124,252,0,1],lemonchiffon:[255,250,205,1],lightblue:[173,216,230,1],lightcoral:[240,128,128,1],lightcyan:[224,255,255,1],lightgoldenrodyellow:[250,250,210,1],lightgray:[211,211,211,1],lightgreen:[144,238,144,1],lightgrey:[211,211,211,1],lightpink:[255,182,193,1],lightsalmon:[255,160,122,1],lightseagreen:[32,178,170,1],lightskyblue:[135,206,250,1],lightslategray:[119,136,153,1],lightslategrey:[119,136,153,1],lightsteelblue:[176,196,222,1],lightyellow:[255,255,224,1],lime:[0,255,0,1],limegreen:[50,205,50,1],linen:[250,240,230,1],magenta:[255,0,255,1],maroon:[128,0,0,1],mediumaquamarine:[102,205,170,1],mediumblue:[0,0,205,1],mediumorchid:[186,85,211,1],mediumpurple:[147,112,219,1],mediumseagreen:[60,179,113,1],mediumslateblue:[123,104,238,1],mediumspringgreen:[0,250,154,1],mediumturquoise:[72,209,204,1],mediumvioletred:[199,21,133,1],midnightblue:[25,25,112,1],mintcream:[245,255,250,1],mistyrose:[255,228,225,1],moccasin:[255,228,181,1],navajowhite:[255,222,173,1],navy:[0,0,128,1],oldlace:[253,245,230,1],olive:[128,128,0,1],olivedrab:[107,142,35,1],orange:[255,165,0,1],orangered:[255,69,0,1],orchid:[218,112,214,1],palegoldenrod:[238,232,170,1],palegreen:[152,251,152,1],paleturquoise:[175,238,238,1],palevioletred:[219,112,147,1],papayawhip:[255,239,213,1],peachpuff:[255,218,185,1],peru:[205,133,63,1],pink:[255,192,203,1],plum:[221,160,221,1],powderblue:[176,224,230,1],purple:[128,0,128,1],rebeccapurple:[102,51,153,1],red:[255,0,0,1],rosybrown:[188,143,143,1],royalblue:[65,105,225,1],saddlebrown:[139,69,19,1],salmon:[250,128,114,1],sandybrown:[244,164,96,1],seagreen:[46,139,87,1],seashell:[255,245,238,1],sienna:[160,82,45,1],silver:[192,192,192,1],skyblue:[135,206,235,1],slateblue:[106,90,205,1],slategray:[112,128,144,1],slategrey:[112,128,144,1],snow:[255,250,250,1],springgreen:[0,255,127,1],steelblue:[70,130,180,1],tan:[210,180,140,1],teal:[0,128,128,1],thistle:[216,191,216,1],tomato:[255,99,71,1],turquoise:[64,224,208,1],violet:[238,130,238,1],wheat:[245,222,179,1],white:[255,255,255,1],whitesmoke:[245,245,245,1],yellow:[255,255,0,1],yellowgreen:[154,205,50,1]};function t(_){return(_=Math.round(_))<0?0:_>255?255:_}function a(_){return t(_[_.length-1]==="%"?parseFloat(_)/100*255:parseInt(_))}function u(_){return(v=_[_.length-1]==="%"?parseFloat(_)/100:parseFloat(_))<0?0:v>1?1:v;var v}function d(_,v,S){return S<0?S+=1:S>1&&(S-=1),6*S<1?_+(v-_)*S*6:2*S<1?v:3*S<2?_+(v-_)*(2/3-S)*6:_}try{Oh.parseCSSColor=function(_){var v,S=_.replace(/ /g,"").toLowerCase();if(S in s)return s[S].slice();if(S[0]==="#")return S.length===4?(v=parseInt(S.substr(1),16))>=0&&v<=4095?[(3840&v)>>4|(3840&v)>>8,240&v|(240&v)>>4,15&v|(15&v)<<4,1]:null:S.length===7&&(v=parseInt(S.substr(1),16))>=0&&v<=16777215?[(16711680&v)>>16,(65280&v)>>8,255&v,1]:null;var E=S.indexOf("("),R=S.indexOf(")");if(E!==-1&&R+1===S.length){var P=S.substr(0,E),B=S.substr(E+1,R-(E+1)).split(","),F=1;switch(P){case"rgba":if(B.length!==4)return null;F=u(B.pop());case"rgb":return B.length!==3?null:[a(B[0]),a(B[1]),a(B[2]),F];case"hsla":if(B.length!==4)return null;F=u(B.pop());case"hsl":if(B.length!==3)return null;var j=(parseFloat(B[0])%360+360)%360/360,G=u(B[1]),Q=u(B[2]),J=Q<=.5?Q*(G+1):Q+G-Q*G,ee=2*Q-J;return[t(255*d(ee,J,j+1/3)),t(255*d(ee,J,j)),t(255*d(ee,J,j-1/3)),F];default:return null}}return null}}catch{}return Oh})();class Ei{constructor(t,a,u,d=1){this.r=t,this.g=a,this.b=u,this.a=d}static parse(t){if(!t)return;if(t instanceof Ei)return t;if(typeof t!="string")return;const a=gm.parseCSSColor(t);return a?new Ei(a[0]/255,a[1]/255,a[2]/255,a[3]):void 0}toString(){const[t,a,u,d]=[this.r,this.g,this.b,this.a];return`rgba(${Math.round(255*t)},${Math.round(255*a)},${Math.round(255*u)},${d})`}toNonPremultipliedRenderColor(t){const{r:a,g:u,b:d,a:_}=this;return new Eg(t,a,u,d,_)}toPremultipliedRenderColor(t){const{r:a,g:u,b:d,a:_}=this;return new Gd(t,a*_,u*_,d*_,_)}clone(){return new Ei(this.r,this.g,this.b,this.a)}}class _m{constructor(t,a,u,d,_,v=!1){if(this.premultiplied=!1,this.premultiplied=v,t){const S=t.image.height,E=S*S;this.premultiplied?(a=_===0?0:a/_*(S-1),u=_===0?0:u/_*(S-1),d=_===0?0:d/_*(S-1)):(a*=S-1,u*=S-1,d*=S-1);const R=Math.floor(a),P=Math.floor(u),B=Math.floor(d),F=Math.ceil(a),j=Math.ceil(u),G=Math.ceil(d),Q=a-R,J=u-P,ee=d-B,se=t.image.data,le=4*(R+P*E+B*S),he=4*(R+P*E+G*S),Ee=4*(R+j*E+B*S),Ce=4*(R+j*E+G*S),De=4*(F+P*E+B*S),Le=4*(F+P*E+G*S),Fe=4*(F+j*E+B*S),ut=4*(F+j*E+G*S);if(le<0||ut>=se.length)throw new Error("out of range");this.r=xr(xr(xr(se[le],se[he],ee),xr(se[Ee],se[Ce],ee),J),xr(xr(se[De],se[Le],ee),xr(se[Fe],se[ut],ee),J),Q)/255*(this.premultiplied?_:1),this.g=xr(xr(xr(se[le+1],se[he+1],ee),xr(se[Ee+1],se[Ce+1],ee),J),xr(xr(se[De+1],se[Le+1],ee),xr(se[Fe+1],se[ut+1],ee),J),Q)/255*(this.premultiplied?_:1),this.b=xr(xr(xr(se[le+2],se[he+2],ee),xr(se[Ee+2],se[Ce+2],ee),J),xr(xr(se[De+2],se[Le+2],ee),xr(se[Fe+2],se[ut+2],ee),J),Q)/255*(this.premultiplied?_:1),this.a=_}else this.r=a,this.g=u,this.b=d,this.a=_}toArray(){const{r:t,g:a,b:u,a:d}=this;return[255*t,255*a,255*u,d]}toHslaArray(){let{r:t,g:a,b:u,a:d}=this;if(this.premultiplied){if(d===0)return[0,0,0,0];const G=1/d;t*=G,a*=G,u*=G}const _=Math.min(Math.max(t,0),1),v=Math.min(Math.max(a,0),1),S=Math.min(Math.max(u,0),1),E=Math.min(_,v,S),R=Math.max(_,v,S),P=R-E,B=.5*(E+R);if(P===0)return[0,0,100*B,d];const F=B>.5?P/(2-R-E):P/(R+E);let j;switch(R){case _:j=60*((v-S)/P+(v<S?6:0));break;case v:j=60*((S-_)/P+2);break;default:j=60*((_-v)/P+4)}return[j,100*F,100*B,d]}toArray01(){const{r:t,g:a,b:u,a:d}=this;return[t,a,u,d]}toArray01Scaled(t){const{r:a,g:u,b:d}=this;return[a*t,u*t,d*t]}toArray01Linear(){const{r:t,g:a,b:u,a:d}=this;return[Math.pow(t,2.2),Math.pow(a,2.2),Math.pow(u,2.2),d]}}class Eg extends _m{constructor(t,a,u,d,_){super(t,a,u,d,_,!1)}}class Gd extends _m{constructor(t,a,u,d,_){super(t,a,u,d,_,!0)}}function xr(s,t,a){return s*(1-a)+t*a}function ym(s,t,a){return s.map(((u,d)=>xr(u,t[d],a)))}Ei.black=new Ei(0,0,0,1),Ei.white=new Ei(1,1,1,1),Ei.transparent=new Ei(0,0,0,0),Ei.red=new Ei(1,0,0,1),Ei.blue=new Ei(0,0,1,1);var is=Object.freeze({__proto__:null,array:ym,color:function(s,t,a){return new Ei(xr(s.r,t.r,a),xr(s.g,t.g,a),xr(s.b,t.b,a),xr(s.a,t.a,a))},number:xr});class Ks extends Error{constructor(t,a){super(a),this.message=a,this.key=t}}class Hd{constructor(t,a=[]){this.parent=t,this.bindings={};for(const[u,d]of a)this.bindings[u]=d}concat(t){return new Hd(this,t)}get(t){if(this.bindings[t])return this.bindings[t];if(this.parent)return this.parent.get(t);throw new Error(`${t} not found in scope.`)}has(t){return!!this.bindings[t]||!!this.parent&&this.parent.has(t)}}const ws={kind:"null"},cr={kind:"number"},Ci={kind:"string"},Mi={kind:"boolean"},ba={kind:"color"},qu={kind:"object"},wi={kind:"value"},qd={kind:"collator"},Yc={kind:"formatted"},jf={kind:"resolvedImage"};function Ko(s,t){return{kind:"array",itemType:s,N:t}}function ro(s){if(s.kind==="array"){const t=ro(s.itemType);return typeof s.N=="number"?`array<${t}, ${s.N}>`:s.itemType.kind==="value"?"array":`array<${t}>`}return s.kind}const e0=[ws,cr,Ci,Mi,ba,Yc,qu,Ko(wi),jf];function Gf(s,t){if(t.kind==="error")return null;if(s.kind==="array"){if(t.kind==="array"&&(t.N===0&&t.itemType.kind==="value"||!Gf(s.itemType,t.itemType))&&(typeof s.N!="number"||s.N===t.N))return null}else{if(s.kind===t.kind)return null;if(s.kind==="value"){for(const a of e0)if(!Gf(a,t))return null}}return`Expected ${ro(s)} but found ${ro(t)} instead.`}function Hf(s,t){return t.some((a=>a.kind===s.kind))}function nc(s,t){return t.some((a=>a==="null"?s===null:a==="array"?Array.isArray(s):a==="object"?s&&!Array.isArray(s)&&typeof s=="object":a===typeof s))}function qf(s,t){return s.kind==="array"&&t.kind==="array"?s.N===t.N&&qf(s.itemType,t.itemType):s.kind===t.kind}class oc{constructor(t,a,u){this.sensitivity=t?a?"variant":"case":a?"accent":"base",this.locale=u,this.collator=new Intl.Collator(this.locale?this.locale:[],{sensitivity:this.sensitivity,usage:"search"})}compare(t,a){return this.collator.compare(t,a)}resolvedLocale(){return new Intl.Collator(this.locale?this.locale:[]).resolvedOptions().locale}}class $f{constructor(t,a,u,d,_){this.text=t.normalize?t.normalize():t,this.image=a,this.scale=u,this.fontStack=d,this.textColor=_}}class Jo{constructor(t){this.sections=t}static fromString(t){return new Jo([new $f(t,null,null,null,null)])}isEmpty(){return this.sections.length===0||!this.sections.some((t=>t.text.length!==0||!!t.image&&t.image.hasPrimary()))}static factory(t){return t instanceof Jo?t:Jo.fromString(t)}toString(){return this.sections.length===0?"":this.sections.map((t=>t.text)).join("")}serialize(){const t=["format"];for(const a of this.sections){if(a.image){const d=a.image.getPrimary().id.toString();t.push(["image",d]);continue}t.push(a.text);const u={};a.fontStack&&(u["text-font"]=["literal",a.fontStack.split(",")]),a.scale&&(u["font-scale"]=a.scale),a.textColor&&(u["text-color"]=["rgba"].concat(a.textColor.toNonPremultipliedRenderColor(null).toArray())),t.push(u)}return t}}class Ss{constructor(t,a={}){if(this.id=rs.from(t),this.options=Object.assign({},a),a.transform){const{a:u,b:d,c:_,d:v,e:S,f:E}=a.transform;this.options.transform=new DOMMatrix([u,d,_,v,S,E])}else this.options.transform=new DOMMatrix([1,0,0,1,0,0])}toString(){const{a:t,b:a,c:u,d,e:_,f:v}=this.options.transform;return JSON.stringify({name:this.id.name,iconsetId:this.id.iconsetId,params:this.options.params,transform:{a:t,b:a,c:u,d,e:_,f:v}})}static parse(t){let a,u,d,_;try{({name:a,iconsetId:u,params:d,transform:_}=JSON.parse(t)||{})}catch{return null}if(!a)return null;const{a:v,b:S,c:E,d:R,e:P,f:B}=_||{};return new Ss({name:a,iconsetId:u},{params:d,transform:new DOMMatrix([v,S,E,R,P,B])})}scaleSelf(t,a){return this.options.transform.scaleSelf(t,a),this}}class sa{constructor(t,a,u,d,_=!1){this.primaryId=rs.from(t),this.primaryOptions=a,u&&(this.secondaryId=rs.from(u)),this.secondaryOptions=d,this.available=_}toString(){return this.primaryId&&this.secondaryId?`[${this.primaryId.name},${this.secondaryId.name}]`:this.primaryId.name}hasPrimary(){return!!this.primaryId}getPrimary(){return new Ss(this.primaryId,this.primaryOptions)}hasSecondary(){return!!this.secondaryId}getSecondary(){return this.secondaryId?new Ss(this.secondaryId,this.secondaryOptions):null}static from(t){return typeof t=="string"?sa.build({name:t}):t}static build(t,a,u,d){return!t||typeof t=="object"&&!("name"in t)?null:new sa(t,u,a,d)}}function $u(s,t,a,u){return typeof s=="number"&&s>=0&&s<=255&&typeof t=="number"&&t>=0&&t<=255&&typeof a=="number"&&a>=0&&a<=255?u===void 0||typeof u=="number"&&u>=0&&u<=1?null:`Invalid rgba value [${[s,t,a,u].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid rgba value [${(typeof u=="number"?[s,t,a,u]:[s,t,a]).join(", ")}]: 'r', 'g', and 'b' must be between 0 and 255.`}function Ph(s){if(s===null||typeof s=="string"||typeof s=="boolean"||typeof s=="number"||s instanceof Ei||s instanceof oc||s instanceof Jo||s instanceof sa)return!0;if(Array.isArray(s)){for(const t of s)if(!Ph(t))return!1;return!0}if(typeof s=="object"){for(const t in s)if(!Ph(s[t]))return!1;return!0}return!1}function fo(s){if(s===null)return ws;if(typeof s=="string")return Ci;if(typeof s=="boolean")return Mi;if(typeof s=="number")return cr;if(s instanceof Ei)return ba;if(s instanceof oc)return qd;if(s instanceof Jo)return Yc;if(s instanceof sa)return jf;if(Array.isArray(s)){const t=s.length;let a;for(const u of s){const d=fo(u);if(a){if(a===d)continue;a=wi;break}a=d}return Ko(a||wi,t)}return qu}function wa(s){const t=typeof s;return s===null?"":t==="string"||t==="number"||t==="boolean"?String(s):s instanceof Jo||s instanceof sa||s instanceof Ei?s.toString():JSON.stringify(s)}class kr{constructor(t,a){this.type=t,this.value=a}static parse(t,a){if(t.length!==2)return a.error(`'literal' expression requires exactly one argument, but found ${t.length-1} instead.`);if(!Ph(t[1]))return a.error("invalid value");const u=t[1];let d=fo(u);const _=a.expectedType;return d.kind!=="array"||d.N!==0||!_||_.kind!=="array"||typeof _.N=="number"&&_.N!==0||(d=_),new kr(d,u)}evaluate(){return this.value}eachChild(){}outputDefined(){return!0}serialize(){return this.type.kind==="array"||this.type.kind==="object"?["literal",this.value]:this.value instanceof Ei?["rgba"].concat(this.value.toNonPremultipliedRenderColor(null).toArray()):this.value instanceof Jo?this.value.serialize():this.value}}class qt{constructor(t){this.name="ExpressionEvaluationError",this.message=t}toJSON(){return this.message}}const ac={string:Ci,number:cr,boolean:Mi,object:qu};class vr{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");let u,d=1;const _=t[0];if(_==="array"){let S,E;if(t.length>2){const R=t[1];if(typeof R!="string"||!(R in ac)||R==="object")return a.error('The item type argument of "array" must be one of string, number, boolean',1);S=ac[R],d++}else S=wi;if(t.length>3){if(t[2]!==null&&(typeof t[2]!="number"||t[2]<0||t[2]!==Math.floor(t[2])))return a.error('The length argument to "array" must be a positive integer literal',2);E=t[2],d++}u=Ko(S,E)}else u=ac[_];const v=[];for(;d<t.length;d++){const S=a.parse(t[d],d,wi);if(!S)return null;v.push(S)}return new vr(u,v)}evaluate(t){for(let a=0;a<this.args.length;a++){const u=this.args[a].evaluate(t);if(!Gf(this.type,fo(u)))return u;if(a===this.args.length-1)throw new qt(`The expression ${JSON.stringify(this.args[a].serialize())} evaluated to ${ro(fo(u))} but was expected to be of type ${ro(this.type)}.`)}return null}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=this.type,a=[t.kind];if(t.kind==="array"){const u=t.itemType;if(u.kind==="string"||u.kind==="number"||u.kind==="boolean"){a.push(u.kind);const d=t.N;(typeof d=="number"||this.args.length>1)&&a.push(d)}}return a.concat(this.args.map((u=>u.serialize())))}}class Xu{constructor(t){this.type=Yc,this.sections=t}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[1];if(!Array.isArray(u)&&typeof u=="object")return a.error("First argument must be an image or text section.");const d=[];let _=!1;for(let v=1;v<=t.length-1;++v){const S=t[v];if(_&&typeof S=="object"&&!Array.isArray(S)){_=!1;let E=null;if(S["font-scale"]&&(E=a.parseObjectValue(S["font-scale"],v,"font-scale",cr),!E))return null;let R=null;if(S["text-font"]&&(R=a.parseObjectValue(S["text-font"],v,"text-font",Ko(Ci)),!R))return null;let P=null;if(S["text-color"]&&(P=a.parseObjectValue(S["text-color"],v,"text-color",ba),!P))return null;const B=d[d.length-1];B.scale=E,B.font=R,B.textColor=P}else{const E=a.parse(t[v],v,wi);if(!E)return null;const R=E.type.kind;if(R!=="string"&&R!=="value"&&R!=="null"&&R!=="resolvedImage")return a.error("Formatted text type must be 'string', 'value', 'image' or 'null'.");_=!0,d.push({content:E,scale:null,font:null,textColor:null})}}return new Xu(d)}evaluate(t){return new Jo(this.sections.map((a=>{const u=a.content.evaluate(t);return qf(fo(u),jf)?new $f("",u,null,null,null):new $f(wa(u),null,a.scale?a.scale.evaluate(t):null,a.font?a.font.evaluate(t).join(","):null,a.textColor?a.textColor.evaluate(t):null)})))}eachChild(t){for(const a of this.sections)t(a.content),a.scale&&t(a.scale),a.font&&t(a.font),a.textColor&&t(a.textColor)}outputDefined(){return!1}serialize(){const t=["format"];for(const a of this.sections){t.push(a.content.serialize());const u={};a.scale&&(u["font-scale"]=a.scale.serialize()),a.font&&(u["text-font"]=a.font.serialize()),a.textColor&&(u["text-color"]=a.textColor.serialize()),t.push(u)}return t}}class sc{constructor(t,a,u,d){this._imageWarnHistory={},this.type=jf,this.namePrimary=t,this.nameSecondary=a,u&&(this.paramsPrimary=u.params,this.iconsetIdPrimary=u.iconset?u.iconset.id:void 0),d&&(this.paramsSecondary=d.params,this.iconsetIdSecondary=d.iconset?d.iconset.id:void 0)}static parse(t,a){if(t.length<2)return a.error("Expected two or more arguments.");let u=1;const d=[];function _(){if(u<t.length){const S=a.parse(t[u],u++,Ci);return S?(d.push({image:S,options:{}}),!0):(a.error(d.length?"Secondary image variant is not a string.":"No image name provided."),!1)}return!0}function v(){if(u<t.length){const E=t[u];if((S=E)===null||typeof S!="object"||Array.isArray(S))return!0;const R=E.params,P=E.iconset,B=a.concat(u);if(!R&&!P)return u++,!0;if(R){if(typeof R!="object"||R.constructor!==Object)return B.error('Image options "params" should be an object'),!1;const F={},j=B.concat(void 0,"params");for(const G in R){if(!G)return j.error("Image parameter name should be non-empty"),!1;const Q=j.concat(void 0,G).parse(R[G],void 0,ba,void 0,{typeAnnotation:"coerce"});if(!Q)return!1;F[G]=Q}d[d.length-1].options.params=F}if(P){if(typeof P!="object"||P.constructor!==Object)return B.error('Image options "iconset" should be an object'),!1;if(!P.id)return B.error('Image options "iconset" should have an "id" property'),!1;d[d.length-1].options.iconset=P}return u++,!0}var S;return!0}for(let S=0;S<2;S++)if(!_()||!v())return;return new sc(d[0].image,d[1]?d[1].image:void 0,d[0].options,d[1]?d[1].options:void 0)}evaluateParams(t,a){const u={};if(a){for(const d in a)if(a[d])try{u[d]=a[d].evaluate(t)}catch{continue}if(Object.keys(u).length!==0)return{params:u}}}evaluate(t){const a={name:this.namePrimary.evaluate(t),iconsetId:this.iconsetIdPrimary},u=this.nameSecondary?{name:this.nameSecondary.evaluate(t),iconsetId:this.iconsetIdSecondary}:void 0,d=sa.build(a,u,this.paramsPrimary?this.evaluateParams(t,this.paramsPrimary):void 0,this.paramsSecondary?this.evaluateParams(t,this.paramsSecondary):void 0);if(d&&t.availableImages){const _=d.getPrimary().id;if(d.available=t.availableImages.some((v=>rs.isEqual(v,_))),d.available){const v=d.getSecondary()?d.getSecondary().id:null;v&&(d.available=t.availableImages.some((S=>rs.isEqual(S,v))))}}return d}eachChild(t){if(t(this.namePrimary),this.paramsPrimary)for(const a in this.paramsPrimary)this.paramsPrimary[a]&&t(this.paramsPrimary[a]);if(this.nameSecondary&&(t(this.nameSecondary),this.paramsSecondary))for(const a in this.paramsSecondary)this.paramsSecondary[a]&&t(this.paramsSecondary[a])}outputDefined(){return!1}serializeOptions(t,a){const u={};if(a&&(u.iconset={id:a}),t){u.params={};for(const d in t)t[d]&&(u.params[d]=t[d].serialize())}return Object.keys(u).length>0?u:void 0}serialize(){const t=["image",this.namePrimary.serialize()];if(this.paramsPrimary||this.iconsetIdPrimary){const a=this.serializeOptions(this.paramsPrimary,this.iconsetIdPrimary);a&&t.push(a)}if(this.nameSecondary&&(t.push(this.nameSecondary.serialize()),this.paramsSecondary||this.iconsetIdSecondary)){const a=this.serializeOptions(this.paramsSecondary,this.iconsetIdSecondary);a&&t.push(a)}return t}}function Tr(s){return Zu(s)?"string":Wu(s)?"number":Xd(s)?"boolean":Array.isArray(s)?"array":s===null?"null":$d(s)?"object":typeof s}function $d(s){return s!=null&&!Array.isArray(s)&&typeof s!="function"&&!(s instanceof String||s instanceof Number||s instanceof Boolean)&&typeof s=="object"}function Zu(s){return typeof s=="string"||s instanceof String}function Wu(s){return typeof s=="number"||s instanceof Number}function Xd(s){return typeof s=="boolean"||s instanceof Boolean}const Xf={"to-boolean":Mi,"to-color":ba,"to-number":cr,"to-string":Ci};class kn{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expected at least one argument.");const u=t[0],d=[];let _=ws;if(u==="to-array"){if(!Array.isArray(t[1]))return null;const v=t[1].length;if(a.expectedType){if(a.expectedType.kind!=="array")return a.error(`Expected ${a.expectedType.kind} but found array.`);_=Ko(a.expectedType.itemType,v)}else{if(!(v>0&&Ph(t[1][0])))return null;_=Ko(fo(t[1][0]),v)}for(let S=0;S<v;S++){const E=t[1][S];let R;if(Array.isArray(E))R=a.parse(E,void 0,_.itemType);else{const P=Tr(E);if(P!==_.itemType.kind)return a.error(`Expected ${_.itemType.kind} but found ${P}.`);R=a.registry.literal.parse(["literal",E===void 0?null:E],a)}if(!R)return null;d.push(R)}}else{if((u==="to-boolean"||u==="to-string")&&t.length!==2)return a.error("Expected one argument.");_=Xf[u];for(let v=1;v<t.length;v++){const S=a.parse(t[v],v,wi);if(!S)return null;d.push(S)}}return new kn(_,d)}evaluate(t){if(this.type.kind==="boolean")return!!this.args[0].evaluate(t);if(this.type.kind==="color"){let a,u;for(const d of this.args){if(a=d.evaluate(t),u=null,a instanceof Ei)return a;if(typeof a=="string"){const _=t.parseColor(a);if(_)return _}else if(Array.isArray(a)&&(u=a.length<3||a.length>4?`Invalid rbga value ${JSON.stringify(a)}: expected an array containing either three or four numeric values.`:$u(a[0],a[1],a[2],a[3]),!u))return new Ei(a[0]/255,a[1]/255,a[2]/255,a[3])}throw new qt(u||`Could not parse color from value '${typeof a=="string"?a:String(JSON.stringify(a))}'`)}if(this.type.kind==="number"){let a=null;for(const u of this.args){if(a=u.evaluate(t),a===null)return 0;const d=Number(a);if(!isNaN(d))return d}throw new qt(`Could not convert ${JSON.stringify(a)} to number.`)}return this.type.kind==="formatted"?Jo.fromString(wa(this.args[0].evaluate(t))):this.type.kind==="resolvedImage"?sa.build(wa(this.args[0].evaluate(t))):this.type.kind==="array"?this.args.map((a=>a.evaluate(t))):wa(this.args[0].evaluate(t))}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){if(this.type.kind==="formatted")return new Xu([{content:this.args[0],scale:null,font:null,textColor:null}]).serialize();if(this.type.kind==="resolvedImage")return new sc(this.args[0]).serialize();const t=this.type.kind==="array"?[]:[`to-${this.type.kind}`];return this.eachChild((a=>{t.push(a.serialize())})),t}}const vm=["Unknown","Point","LineString","Polygon"];class lc{constructor(t,a,u){this.globals=null,this.feature=null,this.featureState=null,this.formattedSection=null,this._parseColorCache={},this.availableImages=null,this.canonical=null,this.featureTileCoord=null,this.featureDistanceData=null,this.scope=t,this.options=a,this.iconImageUseTheme=u}id(){return this.feature&&this.feature.id!==void 0?this.feature.id:null}geometryType(){return this.feature?typeof this.feature.type=="number"?vm[this.feature.type]:this.feature.type:null}geometry(){return this.feature&&"geometry"in this.feature?this.feature.geometry:null}canonicalID(){return this.canonical}properties(){return this.feature&&this.feature.properties||{}}measureLight(t){return this.globals.brightness||0}distanceFromCenter(){if(this.featureTileCoord&&this.featureDistanceData){const t=this.featureDistanceData.center,a=this.featureDistanceData.scale,{x:u,y:d}=this.featureTileCoord;return this.featureDistanceData.bearing[0]*(u*a-t[0])+this.featureDistanceData.bearing[1]*(d*a-t[1])}return 0}parseColor(t){let a=this._parseColorCache[t];return a||(a=this._parseColorCache[t]=Ei.parse(t)),a}getConfig(t){return this.options?this.options.get(t):null}}class la{constructor(t,a,u,d,_){this.name=t,this.type=a,this._evaluate=u,this.args=d,this._overloadIndex=_}evaluate(t){if(!this._evaluate){const a=la.definitions[this.name];this._evaluate=Array.isArray(a)?a[2]:a.overloads[this._overloadIndex][1]}return this._evaluate(t,this.args)}eachChild(t){this.args.forEach(t)}outputDefined(){return!1}serialize(){return[this.name].concat(this.args.map((t=>t.serialize())))}static parse(t,a){const u=t[0],d=la.definitions[u];if(!d)return a.error(`Unknown expression "${u}". If you wanted a literal array, use ["literal", [...]].`,0);const _=Array.isArray(d)?d[0]:d.type,v=Array.isArray(d)?[[d[1],d[2]]]:d.overloads,S=[];let E=null,R=-1;for(const[P,B]of v){if(Array.isArray(P)&&P.length!==t.length-1)continue;S.push(P),R++,E=new au(a.registry,a.path,null,a.scope,void 0,a._scope,a.options,a.iconImageUseTheme);const F=[];let j=!1;for(let G=1;G<t.length;G++){const Q=t[G],J=Array.isArray(P)?P[G-1]:P.type,ee=E.parse(Q,1+F.length,J);if(!ee){j=!0;break}F.push(ee)}if(!j)if(Array.isArray(P)&&P.length!==F.length)E.error(`Expected ${P.length} arguments, but found ${F.length} instead.`);else{for(let G=0;G<F.length;G++){const Q=Array.isArray(P)?P[G]:P.type,J=F[G];E.concat(G+1).checkSubtype(Q,J.type)}if(E.errors.length===0)return new la(u,_,B,F,R)}}if(S.length===1)a.errors.push(...E.errors);else{const P=(S.length?S:v.map((([F])=>F))).map(Qc).join(" | "),B=[];for(let F=1;F<t.length;F++){const j=a.parse(t[F],1+B.length);if(!j)return null;B.push(ro(j.type))}a.error(`Expected arguments of type ${P}, but found (${B.join(", ")}) instead.`)}return null}static register(t,a){la.definitions=a;for(const u in a)t[u]=la}}function Qc(s){return Array.isArray(s)?`(${s.map(ro).join(", ")})`:`(${ro(s.type)}...)`}class Do{constructor(t,a,u){this.type=qd,this.locale=u,this.caseSensitive=t,this.diacriticSensitive=a}static parse(t,a){if(t.length!==2)return a.error("Expected one argument.");const u=t[1];if(typeof u!="object"||Array.isArray(u))return a.error("Collator options argument must be an object.");const d=u["case-sensitive"]===void 0?a.parse(!1,1,Mi):a.parseObjectValue(u["case-sensitive"],1,"case-sensitive",Mi);if(!d)return null;const _=u["diacritic-sensitive"]===void 0?a.parse(!1,1,Mi):a.parseObjectValue(u["diacritic-sensitive"],1,"diacritic-sensitive",Mi);if(!_)return null;let v=null;return u.locale&&(v=a.parseObjectValue(u.locale,1,"locale",Ci),!v)?null:new Do(d,_,v)}evaluate(t){return new oc(this.caseSensitive.evaluate(t),this.diacriticSensitive.evaluate(t),this.locale?this.locale.evaluate(t):null)}eachChild(t){t(this.caseSensitive),t(this.diacriticSensitive),this.locale&&t(this.locale)}outputDefined(){return!1}serialize(){const t={};return t["case-sensitive"]=this.caseSensitive.serialize(),t["diacritic-sensitive"]=this.diacriticSensitive.serialize(),this.locale&&(t.locale=this.locale.serialize()),["collator",t]}}function Ha(s,t,a=0,u=s.length-1,d=Cg){for(;u>a;){if(u-a>600){const E=u-a+1,R=t-a+1,P=Math.log(E),B=.5*Math.exp(2*P/3),F=.5*Math.sqrt(P*B*(E-B)/E)*(R-E/2<0?-1:1);Ha(s,t,Math.max(a,Math.floor(t-R*B/E+F)),Math.min(u,Math.floor(t+(E-R)*B/E+F)),d)}const _=s[t];let v=a,S=u;for(cc(s,a,t),d(s[u],_)>0&&cc(s,a,u);v<S;){for(cc(s,v,S),v++,S--;d(s[v],_)<0;)v++;for(;d(s[S],_)>0;)S--}d(s[a],_)===0?cc(s,a,S):(S++,cc(s,S,u)),S<=t&&(a=S+1),t<=S&&(u=S-1)}}function cc(s,t,a){const u=s[t];s[t]=s[a],s[a]=u}function Cg(s,t){return s<t?-1:s>t?1:0}function Zf(s){let t=0;for(let a,u,d=0,_=s.length,v=_-1;d<_;v=d++)a=s[d],u=s[v],t+=(u.x-a.x)*(a.y+u.y);return t}function Yu(s,t){s[0]=Math.min(s[0],t[0]),s[1]=Math.min(s[1],t[1]),s[2]=Math.max(s[2],t[0]),s[3]=Math.max(s[3],t[1])}function Ts(s,t){return!(s[0]<=t[0]||s[2]>=t[2]||s[1]<=t[1]||s[3]>=t[3])}function xm(s,t,a){const u=s[0]-t[0],d=s[1]-t[1],_=s[0]-a[0],v=s[1]-a[1];return u*v-_*d==0&&u*_<=0&&d*v<=0}function Lh(s,t,a=!1){let u=!1;for(let S=0,E=t.length;S<E;S++){const R=t[S];for(let P=0,B=R.length,F=B-1;P<B;F=P++){const j=R[F],G=R[P];if(xm(s,j,G))return a;(_=j)[1]>(d=s)[1]!=(v=G)[1]>d[1]&&d[0]<(v[0]-_[0])*(d[1]-_[1])/(v[1]-_[1])+_[0]&&(u=!u)}}var d,_,v;return u}function Qu(s,t,a,u){const d=u[0]-a[0],_=u[1]-a[1],v=(s[0]-a[0])*_-d*(s[1]-a[1]),S=(t[0]-a[0])*_-d*(t[1]-a[1]);return v>0&&S<0||v<0&&S>0}function Bh(s,t,a,u){return(d=[u[0]-a[0],u[1]-a[1]])[0]*(_=[t[0]-s[0],t[1]-s[1]])[1]-d[1]*_[0]!=0&&!(!Qu(s,t,a,u)||!Qu(a,u,s,t));var d,_}function Kc(s){const t=new Tt(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),a=new Tt(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY);for(const u of s[0])t.x>u.x&&(t.x=u.x),t.y>u.y&&(t.y=u.y),a.x<u.x&&(a.x=u.x),a.y<u.y&&(a.y=u.y);return{min:t,max:a}}const vl=8192;function Jc(s,t){const a=(180+s[0])/360,u=(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s[1]*Math.PI/360)))/360,d=Math.pow(2,t.z);return[Math.round(a*d*vl),Math.round(u*d*vl)]}function Ku(s,t){for(let a=0;a<t.length;a++)if(Lh(s,t[a]))return!0;return!1}function zh(s,t,a){for(const u of a)for(let d=0,_=u.length,v=_-1;d<_;v=d++)if(Bh(s,t,u[v],u[d]))return!0;return!1}function Fh(s,t){for(let a=0;a<s.length;++a)if(!Lh(s[a],t))return!1;for(let a=0;a<s.length-1;++a)if(zh(s[a],s[a+1],t))return!1;return!0}function bm(s,t){for(let a=0;a<t.length;a++)if(Fh(s,t[a]))return!0;return!1}function xl(s,t,a){const u=[];for(let d=0;d<s.length;d++){const _=[];for(let v=0;v<s[d].length;v++){const S=Jc(s[d][v],a);Yu(t,S),_.push(S)}u.push(_)}return u}function ns(s,t,a){const u=[];for(let d=0;d<s.length;d++){const _=xl(s[d],t,a);u.push(_)}return u}function wm(s,t,a,u){if(s[0]<a[0]||s[0]>a[2]){const d=.5*u;let _=s[0]-a[0]>d?-u:a[0]-s[0]>d?u:0;_===0&&(_=s[0]-a[2]>d?-u:a[2]-s[0]>d?u:0),s[0]+=_}Yu(t,s)}function Sm(s,t,a,u){const d=Math.pow(2,u.z)*vl,_=[u.x*vl,u.y*vl],v=[];if(!s)return v;for(const S of s)for(const E of S){const R=[E.x+_[0],E.y+_[1]];wm(R,t,a,d),v.push(R)}return v}function Ig(s,t,a,u){const d=Math.pow(2,u.z)*vl,_=[u.x*vl,u.y*vl],v=[];if(!s)return v;for(const E of s){const R=[];for(const P of E){const B=[P.x+_[0],P.y+_[1]];Yu(t,B),R.push(B)}v.push(R)}if(t[2]-t[0]<=d/2){(S=t)[0]=S[1]=1/0,S[2]=S[3]=-1/0;for(const E of v)for(const R of E)wm(R,t,a,d)}var S;return v}class Ju{constructor(t,a){this.type=Mi,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'within' expression requires exactly one argument, but found ${t.length-1} instead.`);if(Ph(t[1])){const u=t[1];if(u.type==="FeatureCollection")for(let d=0;d<u.features.length;++d){const _=u.features[d].geometry.type;if(_==="Polygon"||_==="MultiPolygon")return new Ju(u,u.features[d].geometry)}else if(u.type==="Feature"){const d=u.geometry.type;if(d==="Polygon"||d==="MultiPolygon")return new Ju(u,u.geometry)}else if(u.type==="Polygon"||u.type==="MultiPolygon")return new Ju(u,u)}return a.error("'within' expression requires valid geojson object that contains polygon geometry type.")}evaluate(t){if(t.geometry()!=null&&t.canonicalID()!=null){if(t.geometryType()==="Point")return(function(a,u){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(!v)return!1;if(u.type==="Polygon"){const S=xl(u.coordinates,_,v),E=Sm(a.geometry(),d,_,v);if(!Ts(d,_))return!1;for(const R of E)if(!Lh(R,S))return!1}if(u.type==="MultiPolygon"){const S=ns(u.coordinates,_,v),E=Sm(a.geometry(),d,_,v);if(!Ts(d,_))return!1;for(const R of E)if(!Ku(R,S))return!1}return!0})(t,this.geometries);if(t.geometryType()==="LineString")return(function(a,u){const d=[1/0,1/0,-1/0,-1/0],_=[1/0,1/0,-1/0,-1/0],v=a.canonicalID();if(!v)return!1;if(u.type==="Polygon"){const S=xl(u.coordinates,_,v),E=Ig(a.geometry(),d,_,v);if(!Ts(d,_))return!1;for(const R of E)if(!Fh(R,S))return!1}if(u.type==="MultiPolygon"){const S=ns(u.coordinates,_,v),E=Ig(a.geometry(),d,_,v);if(!Ts(d,_))return!1;for(const R of E)if(!bm(R,S))return!1}return!0})(t,this.geometries)}return!1}eachChild(){}outputDefined(){return!0}serialize(){return["within",this.geojson]}}const Wf={kilometers:1,miles:1e3/1609.344,nauticalmiles:1e3/1852,meters:1e3,metres:1e3,yards:1e3/.9144,feet:1e3/.3048,inches:1e3/.0254},Zd=1/298.257223563,Wd=Zd*(2-Zd),eu=Math.PI/180;class ca{static fromTile(t,a,u){const d=Math.PI*(1-2*(t+.5)/Math.pow(2,a)),_=Math.atan(.5*(Math.exp(d)-Math.exp(-d)))/eu;return new ca(_,u)}static get units(){return Wf}constructor(t,a){if(t===void 0)throw new Error("No latitude given.");if(a&&!Wf[a])throw new Error(`Unknown unit ${a}. Use one of: ${Object.keys(Wf).join(", ")}`);const u=6378.137*eu*(a?Wf[a]:1),d=Math.cos(t*eu),_=1/(1-Wd*(1-d*d)),v=Math.sqrt(_);this.kx=u*v*d,this.ky=u*v*_*(1-Wd)}distance(t,a){const u=io(t[0]-a[0])*this.kx,d=(t[1]-a[1])*this.ky;return Math.sqrt(u*u+d*d)}bearing(t,a){const u=io(a[0]-t[0])*this.kx;return Math.atan2(u,(a[1]-t[1])*this.ky)/eu}destination(t,a,u){const d=u*eu;return this.offset(t,Math.sin(d)*a,Math.cos(d)*a)}offset(t,a,u){return[t[0]+a/this.kx,t[1]+u/this.ky]}lineDistance(t){let a=0;for(let u=0;u<t.length-1;u++)a+=this.distance(t[u],t[u+1]);return a}area(t){let a=0;for(let u=0;u<t.length;u++){const d=t[u];for(let _=0,v=d.length,S=v-1;_<v;S=_++)a+=io(d[_][0]-d[S][0])*(d[_][1]+d[S][1])*(u?-1:1)}return Math.abs(a)/2*this.kx*this.ky}along(t,a){let u=0;if(a<=0)return t[0];for(let d=0;d<t.length-1;d++){const _=t[d],v=t[d+1],S=this.distance(_,v);if(u+=S,u>a)return Sa(_,v,(a-(u-S))/S)}return t[t.length-1]}pointToSegmentDistance(t,a,u){let[d,_]=a,v=io(u[0]-d)*this.kx,S=(u[1]-_)*this.ky;if(v!==0||S!==0){const E=(io(t[0]-d)*this.kx*v+(t[1]-_)*this.ky*S)/(v*v+S*S);E>1?(d=u[0],_=u[1]):E>0&&(d+=v/this.kx*E,_+=S/this.ky*E)}return v=io(t[0]-d)*this.kx,S=(t[1]-_)*this.ky,Math.sqrt(v*v+S*S)}pointOnLine(t,a){let u=1/0,d=t[0][0],_=t[0][1],v=0,S=0;for(let E=0;E<t.length-1;E++){let R=t[E][0],P=t[E][1],B=io(t[E+1][0]-R)*this.kx,F=(t[E+1][1]-P)*this.ky,j=0;B===0&&F===0||(j=(io(a[0]-R)*this.kx*B+(a[1]-P)*this.ky*F)/(B*B+F*F),j>1?(R=t[E+1][0],P=t[E+1][1]):j>0&&(R+=B/this.kx*j,P+=F/this.ky*j)),B=io(a[0]-R)*this.kx,F=(a[1]-P)*this.ky;const G=B*B+F*F;G<u&&(u=G,d=R,_=P,v=E,S=j)}return{point:[d,_],index:v,t:Math.max(0,Math.min(1,S))}}lineSlice(t,a,u){let d=this.pointOnLine(u,t),_=this.pointOnLine(u,a);if(d.index>_.index||d.index===_.index&&d.t>_.t){const R=d;d=_,_=R}const v=[d.point],S=d.index+1,E=_.index;!Yd(u[S],v[0])&&S<=E&&v.push(u[S]);for(let R=S+1;R<=E;R++)v.push(u[R]);return Yd(u[E],_.point)||v.push(_.point),v}lineSliceAlong(t,a,u){let d=0;const _=[];for(let v=0;v<u.length-1;v++){const S=u[v],E=u[v+1],R=this.distance(S,E);if(d+=R,d>t&&_.length===0&&_.push(Sa(S,E,(t-(d-R))/R)),d>=a)return _.push(Sa(S,E,(a-(d-R))/R)),_;d>t&&_.push(E)}return _}bufferPoint(t,a){const u=a/this.ky,d=a/this.kx;return[t[0]-d,t[1]-u,t[0]+d,t[1]+u]}bufferBBox(t,a){const u=a/this.ky,d=a/this.kx;return[t[0]-d,t[1]-u,t[2]+d,t[3]+u]}insideBBox(t,a){return io(t[0]-a[0])>=0&&io(t[0]-a[2])<=0&&t[1]>=a[1]&&t[1]<=a[3]}}function Yd(s,t){return s[0]===t[0]&&s[1]===t[1]}function Sa(s,t,a){const u=io(t[0]-s[0]);return[s[0]+u*a,s[1]+(t[1]-s[1])*a]}function io(s){for(;s<-180;)s+=360;for(;s>180;)s-=360;return s}class uc{constructor(t=[],a=((u,d)=>u<d?-1:u>d?1:0)){if(this.data=t,this.length=this.data.length,this.compare=a,this.length>0)for(let u=(this.length>>1)-1;u>=0;u--)this._down(u)}push(t){this.data.push(t),this._up(this.length++)}pop(){if(this.length===0)return;const t=this.data[0],a=this.data.pop();return--this.length>0&&(this.data[0]=a,this._down(0)),t}peek(){return this.data[0]}_up(t){const{data:a,compare:u}=this,d=a[t];for(;t>0;){const _=t-1>>1,v=a[_];if(u(d,v)>=0)break;a[t]=v,t=_}a[t]=d}_down(t){const{data:a,compare:u}=this,d=this.length>>1,_=a[t];for(;t<d;){let v=1+(t<<1);const S=v+1;if(S<this.length&&u(a[S],a[v])<0&&(v=S),u(a[v],_)>=0)break;a[t]=a[v],t=v}a[t]=_}}var Bt=8192;function kh(s,t){return t.dist-s.dist}const hc=100,tu=50;function bl(s){const t=[1/0,1/0,-1/0,-1/0];if(t.length!==s.length)return!1;for(let a=0;a<t.length;a++)if(t[a]!==s[a])return!1;return!0}function Nh(s){return s[1]-s[0]+1}function os(s,t){const a=s[1]>=s[0]&&s[1]<t;return a||console.warn("Distance Expression: Index is out of range"),a}function fc(s,t){if(s[0]>s[1])return[null,null];const a=Nh(s);if(t){if(a===2)return[s,null];const u=Math.floor(a/2);return[[s[0],s[0]+u],[s[0]+u,s[1]]]}{if(a===1)return[s,null];const u=Math.floor(a/2)-1;return[[s[0],s[0]+u],[s[0]+u+1,s[1]]]}}function As(s,t){const a=[1/0,1/0,-1/0,-1/0];if(!os(t,s.length))return a;for(let u=t[0];u<=t[1];++u)Yu(a,s[u]);return a}function Nr(s){const t=[1/0,1/0,-1/0,-1/0];for(let a=0;a<s.length;++a)for(let u=0;u<s[a].length;++u)Yu(t,s[a][u]);return t}function ru(s,t,a){if(bl(s)||bl(t))return NaN;let u=0,d=0;return s[2]<t[0]&&(u=t[0]-s[2]),s[0]>t[2]&&(u=s[0]-t[2]),s[1]>t[3]&&(d=s[1]-t[3]),s[3]<t[1]&&(d=t[1]-s[3]),a.distance([0,0],[u,d])}function dc(s){return 360*s-180}function Rg(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function eh(s,t){const a=Math.pow(2,t.z),u=(s.y/Bt+t.y)/a;return[dc((s.x/Bt+t.x)/a),Rg(u)]}function th(s,t){const a=[];for(let u=0;u<s.length;++u)a.push(eh(s[u],t));return a}function tn(s,t,a){const u=a.pointOnLine(t,s).point;return a.distance(s,u)}function Qd(s,t,a,u,d){const _=a.slice(u[0],u[1]+1);let v=1/0;for(let S=t[0];S<=t[1];++S)if((v=Math.min(v,tn(s[S],_,d)))===0)return 0;return v}function iu(s,t,a,u,d){const _=Math.min(d.pointToSegmentDistance(s,a,u),d.pointToSegmentDistance(t,a,u)),v=Math.min(d.pointToSegmentDistance(a,s,t),d.pointToSegmentDistance(u,s,t));return Math.min(_,v)}function Vh(s,t,a,u,d){if(!os(t,s.length)||!os(u,a.length))return NaN;let _=1/0;for(let v=t[0];v<t[1];++v)for(let S=u[0];S<u[1];++S){if(Bh(s[v],s[v+1],a[S],a[S+1]))return 0;_=Math.min(_,iu(s[v],s[v+1],a[S],a[S+1],d))}return _}function Kd(s,t,a,u,d){if(!os(t,s.length)||!os(u,a.length))return NaN;let _=1/0;for(let v=t[0];v<=t[1];++v)for(let S=u[0];S<=u[1];++S)if((_=Math.min(_,d.distance(s[v],a[S])))===0)return _;return _}function Jd(s,t,a){if(Lh(s,t,!0))return 0;let u=1/0;for(const d of t){const _=d.length;if(_<2)return console.warn("Distance Expression: Invalid polygon!"),NaN;if(d[0]!==d[_-1]&&(u=Math.min(u,a.pointToSegmentDistance(s,d[_-1],d[0])))===0||(u=Math.min(u,tn(s,d,a)))===0)return u}return u}function Es(s,t,a,u){if(!os(t,s.length))return NaN;for(let _=t[0];_<=t[1];++_)if(Lh(s[_],a,!0))return 0;let d=1/0;for(let _=t[0];_<t[1];++_)for(const v of a)for(let S=0,E=v.length,R=E-1;S<E;R=S++){if(Bh(s[_],s[_+1],v[R],v[S]))return 0;d=Math.min(d,iu(s[_],s[_+1],v[R],v[S],u))}return d}function as(s,t){for(const a of s)for(let u=0;u<=a.length-1;++u)if(Lh(a[u],t,!0))return!0;return!1}function rh(s,t,a,u=1/0){const d=Nr(s),_=Nr(t);if(u!==1/0&&ru(d,_,a)>=u)return u;if(Ts(d,_)){if(as(s,t))return 0}else if(as(t,s))return 0;let v=u;for(const S of s)for(let E=0,R=S.length,P=R-1;E<R;P=E++)for(const B of t)for(let F=0,j=B.length,G=j-1;F<j;G=F++){if(Bh(S[P],S[E],B[G],B[F]))return 0;v=Math.min(v,iu(S[P],S[E],B[G],B[F],a))}return v}function Cs(s,t,a,u,d,_,v){if(_===null||v===null)return;const S=ru(As(u,_),As(d,v),a);S<t&&s.push({dist:S,range1:_,range2:v})}function pc(s,t,a,u,d=1/0){let _=Math.min(u.distance(s[0],a[0][0]),d);if(_===0)return _;const v=new uc([{dist:0,range1:[0,s.length-1],range2:[0,0]}],kh),S=t?tu:hc,E=Nr(a);for(;v.length;){const R=v.pop();if(R.dist>=_)continue;const P=R.range1;if(Nh(P)<=S){if(!os(P,s.length))return NaN;if(t){const B=Es(s,P,a,u);if((_=Math.min(_,B))===0)return _}else for(let B=P[0];B<=P[1];++B){const F=Jd(s[B],a,u);if((_=Math.min(_,F))===0)return _}}else{const B=fc(P,t);if(B[0]!==null){const F=ru(As(s,B[0]),E,u);F<_&&v.push({dist:F,range1:B[0],range2:[0,0]})}if(B[1]!==null){const F=ru(As(s,B[1]),E,u);F<_&&v.push({dist:F,range1:B[1],range2:[0,0]})}}}return _}function nu(s,t,a,u,d,_=1/0){let v=Math.min(_,d.distance(s[0],a[0]));if(v===0)return v;const S=new uc([{dist:0,range1:[0,s.length-1],range2:[0,a.length-1]}],kh),E=t?tu:hc,R=u?tu:hc;for(;S.length;){const P=S.pop();if(P.dist>=v)continue;const B=P.range1,F=P.range2;if(Nh(B)<=E&&Nh(F)<=R){if(!os(B,s.length)||!os(F,a.length))return NaN;if(t&&u?v=Math.min(v,Vh(s,B,a,F,d)):t||u?t&&!u?v=Math.min(v,Qd(a,F,s,B,d)):!t&&u&&(v=Math.min(v,Qd(s,B,a,F,d))):v=Math.min(v,Kd(s,B,a,F,d)),v===0)return v}else{const j=fc(B,t),G=fc(F,u);Cs(S,v,d,s,a,j[0],G[0]),Cs(S,v,d,s,a,j[0],G[1]),Cs(S,v,d,s,a,j[1],G[0]),Cs(S,v,d,s,a,j[1],G[1])}}return v}function ep(s,t,a,u,d=1/0){let _=d;const v=As(s,[0,s.length-1]);for(const S of a)if(!(_!==1/0&&ru(v,As(S,[0,S.length-1]),u)>=_)&&(_=Math.min(_,nu(s,t,S,!0,u,_)),_===0))return _;return _}function Uh(s,t,a,u,d=1/0){let _=d;const v=As(s,[0,s.length-1]);for(const S of a){if(_!==1/0&&ru(v,Nr(S),u)>=_)continue;const E=pc(s,t,S,u,_);if(isNaN(E))return E;if((_=Math.min(_,E))===0)return _}return _}function Yf(s){return s==="Point"||s==="MultiPoint"||s==="LineString"||s==="MultiLineString"||s==="Polygon"||s==="MultiPolygon"}class bo{constructor(t,a){this.type=cr,this.geojson=t,this.geometries=a}static parse(t,a){if(t.length!==2)return a.error(`'distance' expression requires either one argument, but found ' ${t.length-1} instead.`);if(Ph(t[1])){const u=t[1];if(u.type==="FeatureCollection"){for(let d=0;d<u.features.length;++d)if(Yf(u.features[d].geometry.type))return new bo(u,u.features[d].geometry)}else if(u.type==="Feature"){if(Yf(u.geometry.type))return new bo(u,u.geometry)}else if(Yf(u.type))return new bo(u,u)}return a.error("'distance' expression needs to be an array with format ['Distance', GeoJSONObj].")}evaluate(t){const a=t.geometry(),u=t.canonicalID();if(a!=null&&u!=null){if(t.geometryType()==="Point")return(function(d,_,v){const S=[];for(const R of d)for(const P of R)S.push(eh(P,_));const E=new ca(S[0][1],"meters");return v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString"?nu(S,!1,v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",E):v.type==="MultiLineString"?ep(S,!1,v.coordinates,E):v.type==="Polygon"||v.type==="MultiPolygon"?Uh(S,!1,v.type==="Polygon"?[v.coordinates]:v.coordinates,E):null})(a,u,this.geometries);if(t.geometryType()==="LineString")return(function(d,_,v){const S=[];for(const R of d){const P=[];for(const B of R)P.push(eh(B,_));S.push(P)}const E=new ca(S[0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return ep(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",S,E);if(v.type==="MultiLineString"){let R=1/0;for(let P=0;P<v.coordinates.length;P++){const B=ep(v.coordinates[P],!0,S,E,R);if(isNaN(B))return B;if((R=Math.min(R,B))===0)return R}return R}if(v.type==="Polygon"||v.type==="MultiPolygon"){let R=1/0;for(let P=0;P<S.length;P++){const B=Uh(S[P],!0,v.type==="Polygon"?[v.coordinates]:v.coordinates,E,R);if(isNaN(B))return B;if((R=Math.min(R,B))===0)return R}return R}return null})(a,u,this.geometries);if(t.geometryType()==="Polygon")return(function(d,_,v){const S=[];for(const R of(function(P,B){const F=P.length;if(F<=1)return[P];const j=[];let G,Q;for(let J=0;J<F;J++){const ee=Zf(P[J]);ee!==0&&(P[J].area=Math.abs(ee),Q===void 0&&(Q=ee<0),Q===ee<0?(G&&j.push(G),G=[P[J]]):G.push(P[J]))}return G&&j.push(G),j})(d)){const P=[];for(let B=0;B<R.length;++B)P.push(th(R[B],_));S.push(P)}const E=new ca(S[0][0][0][1],"meters");if(v.type==="Point"||v.type==="MultiPoint"||v.type==="LineString")return Uh(v.type==="Point"?[v.coordinates]:v.coordinates,v.type==="LineString",S,E);if(v.type==="MultiLineString"){let R=1/0;for(let P=0;P<v.coordinates.length;P++){const B=Uh(v.coordinates[P],!0,S,E,R);if(isNaN(B))return B;if((R=Math.min(R,B))===0)return R}return R}return v.type==="Polygon"||v.type==="MultiPolygon"?(function(R,P,B){let F=1/0;for(const j of R)for(const G of P){const Q=rh(j,G,B,F);if(isNaN(Q))return Q;if((F=Math.min(F,Q))===0)return F}return F})(v.type==="Polygon"?[v.coordinates]:v.coordinates,S,E):null})(a,u,this.geometries);console.warn("Distance Expression: currently only evaluates valid Point/LineString/Polygon geometries.")}else console.warn("Distance Expression: requirs valid feature and canonical information.");return null}eachChild(){}outputDefined(){return!0}serialize(){return["distance",this.geojson]}}function Nn(s){if(s instanceof la&&(s.name==="get"&&s.args.length===1||s.name==="feature-state"||s.name==="has"&&s.args.length===1||s.name==="properties"||s.name==="geometry-type"||s.name==="id"||/^filter-/.test(s.name))||s instanceof Ju||s instanceof bo)return!1;if(s instanceof ih)return s.featureConstant;let t=!0;return s.eachChild((a=>{t&&!Nn(a)&&(t=!1)})),t}function un(s){if(s instanceof la&&s.name==="feature-state")return!1;let t=!0;return s.eachChild((a=>{t&&!un(a)&&(t=!1)})),t}function wl(s){if(s instanceof ih)return new Set([s.key]);let t=new Set;return s.eachChild((a=>{t=new Set([...t,...wl(a)])})),t}function Ta(s,t){if(s instanceof la&&t.indexOf(s.name)>=0)return!1;let a=!0;return s.eachChild((u=>{a&&!Ta(u,t)&&(a=!1)})),a}function tp(s,t,a){return[s,t,a].filter(Boolean).join("")}function mc(s,t){switch(s){case"string":return wa(t);case"number":return+t;case"boolean":return!!t;case"color":return Ei.parse(t);case"formatted":return Jo.fromString(wa(t));case"resolvedImage":return sa.build(wa(t))}return t}function Tm(s,t,a,u){return u!==void 0&&(s=u*Math.round(s/u)),t!==void 0&&s<t&&(s=t),a!==void 0&&s>a&&(s=a),s}class ih{constructor(t,a,u,d=!1){this.type=t,this.key=a,this.scope=u,this.featureConstant=d}static parse(t,a){let u=a.expectedType;if(u==null&&(u=wi),t.length<2||t.length>3)return a.error("Invalid number of arguments for 'config' expression.");const d=a.parse(t[1],1);if(!(d instanceof kr))return a.error("Key name of 'config' expression must be a string literal.");let _,v=!0;const S=wa(d.value);if(t.length>=3){const E=a.parse(t[2],2);if(!(E instanceof kr))return a.error("Scope of 'config' expression must be a string literal.");_=wa(E.value)}if(a.options){const E=tp(S,_,a._scope),R=a.options.get(E);R&&(v=Nn(R.value||R.default))}return new ih(u,S,_,v)}evaluate(t){const a=tp(this.key,this.scope,t.scope),u=t.getConfig(a);if(!u)return null;const{type:d,value:_,values:v,minValue:S,maxValue:E,stepValue:R}=u,P=u.default.evaluate(t);let B=P;if(_){const F=t.scope;t.scope=(F||"").split("").slice(1).join(""),B=_.evaluate(t),t.scope=F}return d&&(B=mc(d,B)),B===void 0||S===void 0&&E===void 0&&R===void 0||(typeof B=="number"?B=Tm(B,S,E,R):Array.isArray(B)&&(B=B.map((F=>typeof F=="number"?Tm(F,S,E,R):F)))),_!==void 0&&B!==void 0&&v&&!v.includes(B)&&(B=P,d&&(B=mc(d,B))),(d&&d!==this.type||B!==void 0&&!qf(fo(B),this.type))&&(B=mc(this.type.kind,B)),B}eachChild(){}outputDefined(){return!1}serialize(){const t=["config",this.key];return this.scope&&t.concat(this.scope),t}}class ou{constructor(t,a){this.type=a.type,this.name=t,this.boundExpression=a}static parse(t,a){if(t.length!==2||typeof t[1]!="string")return a.error("'var' expression requires exactly one string literal argument.");const u=t[1];return a.scope.has(u)?new ou(u,a.scope.get(u)):a.error(`Unknown variable "${u}". Make sure "${u}" has been bound in an enclosing "let" expression before using it.`,1)}evaluate(t){return this.boundExpression.evaluate(t)}eachChild(){}outputDefined(){return!1}serialize(){return["var",this.name]}}class au{constructor(t,a=[],u,d=new Hd,_=[],v,S,E){this.registry=t,this.path=a,this.key=a.map((R=>typeof R=="string"?`['${R}']`:`[${R}]`)).join(""),this.scope=d,this.errors=_,this.expectedType=u,this._scope=v,this.options=S,this.iconImageUseTheme=E}parse(t,a,u,d,_={}){return a||u?this.concat(a,null,u,d)._parse(t,_):this._parse(t,_)}parseObjectValue(t,a,u,d,_,v={}){return this.concat(a,u,d,_)._parse(t,v)}_parse(t,a){function u(d,_,v){return v==="assert"?new vr(_,[d]):v==="coerce"?new kn(_,[d]):d}if(t!==null&&typeof t!="string"&&typeof t!="boolean"&&typeof t!="number"||(t=["literal",t]),Array.isArray(t)){if(t.length===0)return this.error('Expected an array with at least one element. If you wanted a literal array, use ["literal", []].');const d=typeof t[0]=="string"?this.registry[t[0]]:void 0;if(d){let _=d.parse(t,this);if(!_)return null;if(this.expectedType){const v=this.expectedType,S=_.type;if(v.kind!=="string"&&v.kind!=="number"&&v.kind!=="boolean"&&v.kind!=="object"&&v.kind!=="array"||S.kind!=="value")if(v.kind!=="color"&&v.kind!=="formatted"&&v.kind!=="resolvedImage"||S.kind!=="value"&&S.kind!=="string"){if(this.checkSubtype(v,S))return null}else _=u(_,v,a.typeAnnotation||"coerce");else _=u(_,v,a.typeAnnotation||"assert")}if(!(_ instanceof kr)&&_.type.kind!=="resolvedImage"&&rp(_)){const v=new lc(this._scope,this.options,this.iconImageUseTheme);try{_=new kr(_.type,_.evaluate(v))}catch(S){return this.error(S.message),null}}return _}return kn.parse(["to-array",t],this)}return this.error(t===void 0?"'undefined' value invalid. Use null instead.":typeof t=="object"?'Bare objects invalid. Use ["literal", {...}] instead.':`Expected an array, but found ${typeof t} instead.`)}concat(t,a,u,d){let _=typeof t=="number"?this.path.concat(t):this.path;_=typeof a=="string"?_.concat(a):_;const v=d?this.scope.concat(d):this.scope;return new au(this.registry,_,u||null,v,this.errors,this._scope,this.options,this.iconImageUseTheme)}error(t,...a){const u=`${this.key}${a.map((d=>`[${d}]`)).join("")}`;this.errors.push(new Ks(u,t))}checkSubtype(t,a){const u=Gf(t,a);return u&&this.error(u),u}}function rp(s){if(s instanceof ou)return rp(s.boundExpression);if(s instanceof la&&s.name==="error"||s instanceof Do||s instanceof Ju||s instanceof bo||s instanceof ih)return!1;const t=s instanceof kn||s instanceof vr;let a=!0;return s.eachChild((u=>{a=t?a&&rp(u):a&&u instanceof kr})),!!a&&Nn(s)&&Ta(s,["zoom","heatmap-density","worldview","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])}function su(s,t){const a=s.length-1;let u,d,_=0,v=a,S=0;for(;_<=v;)if(S=Math.floor((_+v)/2),u=s[S],d=s[S+1],u<=t){if(S===a||t<d)return S;_=S+1}else{if(!(u>t))throw new qt("Input is not a number.");v=S-1}return 0}class nh{constructor(t,a,u){this.type=t,this.input=a,this.labels=[],this.outputs=[];for(const[d,_]of u)this.labels.push(d),this.outputs.push(_)}static parse(t,a){if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if((t.length-1)%2!=0)return a.error("Expected an even number of arguments.");const u=a.parse(t[1],1,cr);if(!u)return null;const d=[];let _=null;a.expectedType&&a.expectedType.kind!=="value"&&(_=a.expectedType);for(let v=1;v<t.length;v+=2){const S=v===1?-1/0:t[v],E=t[v+1],R=v,P=v+1;if(typeof S!="number")return a.error('Input/output pairs for "step" expressions must be defined using literal numeric values (not computed expressions) for the input values.',R);if(d.length&&d[d.length-1][0]>=S)return a.error('Input/output pairs for "step" expressions must be arranged with input values in strictly ascending order.',R);const B=a.parse(E,P,_);if(!B)return null;_=_||B.type,d.push([S,B])}return new nh(_,u,d)}evaluate(t){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return u[0].evaluate(t);const _=a.length;return d>=a[_-1]?u[_-1].evaluate(t):u[su(a,d)].evaluate(t)}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){const t=["step",this.input.serialize()];for(let a=0;a<this.labels.length;a++)a>0&&t.push(this.labels[a]),t.push(this.outputs[a].serialize());return t}}const lu=.95047,Sl=1.08883,gc=4/29,ua=6/29,ip=3*ua*ua,np=ua*ua*ua,Qf=Math.PI/180,op=180/Math.PI;function _c(s){return s>np?Math.pow(s,1/3):s/ip+gc}function Oo(s){return s>ua?s*s*s:ip*(s-gc)}function oh(s){return 255*(s<=.0031308?12.92*s:1.055*Math.pow(s,1/2.4)-.055)}function yc(s){return(s/=255)<=.04045?s/12.92:Math.pow((s+.055)/1.055,2.4)}function Am(s){const t=yc(s.r),a=yc(s.g),u=yc(s.b),d=_c((.4124564*t+.3575761*a+.1804375*u)/lu),_=_c((.2126729*t+.7151522*a+.072175*u)/1);return{l:116*_-16,a:500*(d-_),b:200*(_-_c((.0193339*t+.119192*a+.9503041*u)/Sl)),alpha:s.a}}function Em(s){let t=(s.l+16)/116,a=isNaN(s.a)?t:t+s.a/500,u=isNaN(s.b)?t:t-s.b/200;return t=1*Oo(t),a=lu*Oo(a),u=Sl*Oo(u),new Ei(oh(3.2404542*a-1.5371385*t-.4985314*u),oh(-.969266*a+1.8760108*t+.041556*u),oh(.0556434*a-.2040259*t+1.0572252*u),s.alpha)}function t0(s,t,a){const u=t-s;return s+a*(u>180||u<-180?u-360*Math.round(u/360):u)}const Zn={forward:Am,reverse:Em,interpolate:function(s,t,a){return{l:xr(s.l,t.l,a),a:xr(s.a,t.a,a),b:xr(s.b,t.b,a),alpha:xr(s.alpha,t.alpha,a)}}},vc={forward:function(s){const{l:t,a,b:u}=Am(s),d=Math.atan2(u,a)*op;return{h:d<0?d+360:d,c:Math.sqrt(a*a+u*u),l:t,alpha:s.a}},reverse:function(s){const t=s.h*Qf,a=s.c;return Em({l:s.l,a:Math.cos(t)*a,b:Math.sin(t)*a,alpha:s.alpha})},interpolate:function(s,t,a){return{h:t0(s.h,t.h,a),c:xr(s.c,t.c,a),l:xr(s.l,t.l,a),alpha:xr(s.alpha,t.alpha,a)}}};var jh=Object.freeze({__proto__:null,hcl:vc,lab:Zn});class ea{constructor(t,a,u,d,_){this.type=t,this.operator=a,this.interpolation=u,this.input=d,this.labels=[],this.outputs=[];for(const[v,S]of _)this.labels.push(v),this.outputs.push(S)}static interpolationFactor(t,a,u,d){let _=0;if(t.name==="exponential")_=Gh(a,t.base,u,d);else if(t.name==="linear")_=Gh(a,1,u,d);else if(t.name==="cubic-bezier"){const v=t.controlPoints;_=new Pf(v[0],v[1],v[2],v[3]).solve(Gh(a,1,u,d))}return _}static parse(t,a){let[u,d,_,...v]=t;if(!Array.isArray(d)||d.length===0)return a.error("Expected an interpolation type expression.",1);if(d[0]==="linear")d={name:"linear"};else if(d[0]==="exponential"){const R=d[1];if(typeof R!="number")return a.error("Exponential interpolation requires a numeric base.",1,1);d={name:"exponential",base:R}}else{if(d[0]!=="cubic-bezier")return a.error(`Unknown interpolation type ${String(d[0])}`,1,0);{const R=d.slice(1);if(R.length!==4||R.some((P=>typeof P!="number"||P<0||P>1)))return a.error("Cubic bezier interpolation requires four numeric arguments with values between 0 and 1.",1);d={name:"cubic-bezier",controlPoints:R}}}if(t.length-1<4)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length-1>3&&(t.length-1)%2!=0)return a.error("Expected an even number of arguments.");if(_=a.parse(_,2,cr),!_)return null;const S=[];let E=null;u==="interpolate-hcl"||u==="interpolate-lab"?E=ba:a.expectedType&&a.expectedType.kind!=="value"&&(E=a.expectedType);for(let R=0;R<v.length;R+=2){const P=v[R],B=v[R+1],F=R+3,j=R+4;if(typeof P!="number")return a.error('Input/output pairs for "interpolate" expressions must be defined using literal numeric values (not computed expressions) for the input values.',F);if(S.length&&S[S.length-1][0]>=P)return a.error('Input/output pairs for "interpolate" expressions must be arranged with input values in strictly ascending order.',F);const G=a.parse(B,j,E);if(!G)return null;E=E||G.type,S.push([P,G])}return E.kind==="number"||E.kind==="color"||E.kind==="array"&&E.itemType.kind==="number"&&typeof E.N=="number"?new ea(E,u,d,_,S):a.error(`Type ${ro(E)} is not interpolatable.`)}evaluate(t){const a=this.labels,u=this.outputs;if(a.length===1)return u[0].evaluate(t);const d=this.input.evaluate(t);if(d<=a[0])return u[0].evaluate(t);const _=a.length;if(d>=a[_-1])return u[_-1].evaluate(t);const v=su(a,d),S=ea.interpolationFactor(this.interpolation,d,a[v],a[v+1]),E=u[v].evaluate(t),R=u[v+1].evaluate(t);return this.operator==="interpolate"?is[this.type.kind.toLowerCase()](E,R,S):this.operator==="interpolate-hcl"?vc.reverse(vc.interpolate(vc.forward(E),vc.forward(R),S)):Zn.reverse(Zn.interpolate(Zn.forward(E),Zn.forward(R),S))}eachChild(t){t(this.input);for(const a of this.outputs)t(a)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))}serialize(){let t;t=this.interpolation.name==="linear"?["linear"]:this.interpolation.name==="exponential"?this.interpolation.base===1?["linear"]:["exponential",this.interpolation.base]:["cubic-bezier",...this.interpolation.controlPoints];const a=[this.operator,t,this.input.serialize()];for(let u=0;u<this.labels.length;u++)a.push(this.labels[u],this.outputs[u].serialize());return a}}function Gh(s,t,a,u){const d=u-a,_=s-a;return d===0?0:t===1?_/d:(Math.pow(t,_)-1)/(Math.pow(t,d)-1)}class Tl{constructor(t,a){this.type=t,this.args=a}static parse(t,a){if(t.length<2)return a.error("Expectected at least one argument.");let u=null;const d=a.expectedType;d&&d.kind!=="value"&&(u=d);const _=[];for(const S of t.slice(1)){const E=a.parse(S,1+_.length,u,void 0,{typeAnnotation:"omit"});if(!E)return null;u=u||E.type,_.push(E)}const v=d&&_.some((S=>Gf(d,S.type)));return new Tl(v?wi:u,_)}evaluate(t){let a,u=null,d=0;for(const _ of this.args){if(d++,u=_.evaluate(t),u&&u instanceof sa&&!u.available&&(a||(a=u),u=null,d===this.args.length))return a;if(u!==null)break}return u}eachChild(t){this.args.forEach(t)}outputDefined(){return this.args.every((t=>t.outputDefined()))}serialize(){const t=["coalesce"];return this.eachChild((a=>{t.push(a.serialize())})),t}}class xc{constructor(t,a){this.type=a.type,this.bindings=[].concat(t),this.result=a}evaluate(t){return this.result.evaluate(t)}eachChild(t){for(const a of this.bindings)t(a[1]);t(this.result)}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found ${t.length-1} instead.`);const u=[];for(let _=1;_<t.length-1;_+=2){const v=t[_];if(typeof v!="string")return a.error(`Expected string, but found ${typeof v} instead.`,_);if(/[^a-zA-Z0-9_]/.test(v))return a.error("Variable names must contain only alphanumeric characters or '_'.",_);const S=a.parse(t[_+1],_+1);if(!S)return null;u.push([v,S])}const d=a.parse(t[t.length-1],t.length-1,a.expectedType,u);return d?new xc(u,d):null}outputDefined(){return this.result.outputDefined()}serialize(){const t=["let"];for(const[a,u]of this.bindings)t.push(a,u.serialize());return t.push(this.result.serialize()),t}}class Cm{constructor(t,a,u){this.type=t,this.index=a,this.input=u}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,cr),d=a.parse(t[2],2,Ko(a.expectedType||wi));return u&&d?new Cm(d.type.itemType,u,d):null}evaluate(t){const a=this.index.evaluate(t),u=this.input.evaluate(t);if(a<0)throw new qt("Array index out of bounds: negative index");if(a>=u.length)throw new qt("Array index out of bounds: index exceeds array size");if(a!==Math.floor(a))throw new qt("Array index must be an integer. Use at-interpolated for fractional indices");return u[a]}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at",this.index.serialize(),this.input.serialize()]}}class ap{constructor(t,a,u){this.type=t,this.index=a,this.input=u}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,cr),d=a.parse(t[2],2,Ko(a.expectedType||wi));return u&&d?new ap(d.type.itemType,u,d):null}evaluate(t){const a=this.index.evaluate(t),u=this.input.evaluate(t);if(a<0)throw new qt(`Array index out of bounds: ${a} < 0.`);if(a>u.length-1)throw new qt(`Array index out of bounds: ${a} > ${u.length-1}.`);if(a===Math.floor(a))return u[a];const d=Math.floor(a),_=Math.ceil(a),v=u[d],S=u[_];if(typeof v!="number"||typeof S!="number")throw new qt(`Cannot interpolate between non-number values at index ${a}.`);const E=a-d;return v*(1-E)+S*E}eachChild(t){t(this.index),t(this.input)}outputDefined(){return!1}serialize(){return["at-interpolated",this.index.serialize(),this.input.serialize()]}}class sp{constructor(t,a){this.type=Mi,this.needle=t,this.haystack=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,wi),d=a.parse(t[2],2,wi);return u&&d?Hf(u.type,[Mi,Ci,cr,ws,wi])?new sp(u,d):a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ro(u.type)} instead`):null}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(u==null)return!1;if(!nc(a,["boolean","string","number","null"]))throw new qt(`Expected first argument to be of type boolean, string, number or null, but found ${ro(fo(a))} instead.`);if(!nc(u,["string","array"]))throw new qt(`Expected second argument to be of type array or string, but found ${ro(fo(u))} instead.`);return u.indexOf(a)>=0}eachChild(t){t(this.needle),t(this.haystack)}outputDefined(){return!0}serialize(){return["in",this.needle.serialize(),this.haystack.serialize()]}}class Hh{constructor(t,a,u){this.type=cr,this.needle=t,this.haystack=a,this.fromIndex=u}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,wi),d=a.parse(t[2],2,wi);if(!u||!d)return null;if(!Hf(u.type,[Mi,Ci,cr,ws,wi]))return a.error(`Expected first argument to be of type boolean, string, number or null, but found ${ro(u.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,cr);return _?new Hh(u,d,_):null}return new Hh(u,d)}evaluate(t){const a=this.needle.evaluate(t),u=this.haystack.evaluate(t);if(!nc(a,["boolean","string","number","null"]))throw new qt(`Expected first argument to be of type boolean, string, number or null, but found ${ro(fo(a))} instead.`);if(!nc(u,["string","array"]))throw new qt(`Expected second argument to be of type array or string, but found ${ro(fo(u))} instead.`);if(this.fromIndex){const d=this.fromIndex.evaluate(t);return u.indexOf(a,d)}return u.indexOf(a)}eachChild(t){t(this.needle),t(this.haystack),this.fromIndex&&t(this.fromIndex)}outputDefined(){return!1}serialize(){if(this.fromIndex!=null&&this.fromIndex!==void 0){const t=this.fromIndex.serialize();return["index-of",this.needle.serialize(),this.haystack.serialize(),t]}return["index-of",this.needle.serialize(),this.haystack.serialize()]}}class Is{constructor(t,a,u,d,_,v){this.inputType=t,this.type=a,this.input=u,this.cases=d,this.outputs=_,this.otherwise=v}static parse(t,a){if(t.length<5)return a.error(`Expected at least 4 arguments, but found only ${t.length-1}.`);if(t.length%2!=1)return a.error("Expected an even number of arguments.");let u,d;a.expectedType&&a.expectedType.kind!=="value"&&(d=a.expectedType);const _={},v=[];for(let R=2;R<t.length-1;R+=2){let P=t[R];const B=t[R+1];Array.isArray(P)||(P=[P]);const F=a.concat(R);if(P.length===0)return F.error("Expected at least one branch label.");for(const G of P){if(typeof G!="number"&&typeof G!="string")return F.error("Branch labels must be numbers or strings.");if(typeof G=="number"&&Math.abs(G)>Number.MAX_SAFE_INTEGER)return F.error(`Branch labels must be integers no larger than ${Number.MAX_SAFE_INTEGER}.`);if(typeof G=="number"&&Math.floor(G)!==G)return F.error("Numeric branch labels must be integer values.");if(u){if(F.checkSubtype(u,fo(G)))return null}else u=fo(G);if(_[String(G)]!==void 0)return F.error("Branch labels must be unique.");_[String(G)]=v.length}const j=a.parse(B,R,d);if(!j)return null;d=d||j.type,v.push(j)}const S=a.parse(t[1],1,wi);if(!S)return null;const E=a.parse(t[t.length-1],t.length-1,d);return E?S.type.kind!=="value"&&a.concat(1).checkSubtype(u,S.type)?null:new Is(u,d,S,_,v,E):null}evaluate(t){const a=this.input.evaluate(t);return(qf(fo(a),this.inputType)&&this.outputs[this.cases[a]]||this.otherwise).evaluate(t)}eachChild(t){t(this.input),this.outputs.forEach(t),t(this.otherwise)}outputDefined(){return this.outputs.every((t=>t.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["match",this.input.serialize()],a=Object.keys(this.cases).sort(),u=[],d={};for(const v of a){const S=d[this.cases[v]];S===void 0?(d[this.cases[v]]=u.length,u.push([this.cases[v],[v]])):u[S][1].push(v)}const _=v=>this.inputType.kind==="number"?Number(v):v;for(const[v,S]of u)t.push(S.length===1?_(S[0]):S.map(_)),t.push(this.outputs[v].serialize());return t.push(this.otherwise.serialize()),t}}class Kf{constructor(t,a,u){this.type=t,this.branches=a,this.otherwise=u}static parse(t,a){if(t.length<4)return a.error(`Expected at least 3 arguments, but found only ${t.length-1}.`);if(t.length%2!=0)return a.error("Expected an odd number of arguments.");let u;a.expectedType&&a.expectedType.kind!=="value"&&(u=a.expectedType);const d=[];for(let v=1;v<t.length-1;v+=2){const S=a.parse(t[v],v,Mi);if(!S)return null;const E=a.parse(t[v+1],v+1,u);if(!E)return null;d.push([S,E]),u=u||E.type}const _=a.parse(t[t.length-1],t.length-1,u);return _?new Kf(u,d,_):null}evaluate(t){for(const[a,u]of this.branches)if(a.evaluate(t))return u.evaluate(t);return this.otherwise.evaluate(t)}eachChild(t){for(const[a,u]of this.branches)t(a),t(u);t(this.otherwise)}outputDefined(){return this.branches.every((([t,a])=>a.outputDefined()))&&this.otherwise.outputDefined()}serialize(){const t=["case"];return this.eachChild((a=>{t.push(a.serialize())})),t}}class cu{constructor(t,a,u,d){this.type=t,this.input=a,this.beginIndex=u,this.endIndex=d}static parse(t,a){if(t.length<=2||t.length>=5)return a.error(`Expected 3 or 4 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,wi),d=a.parse(t[2],2,cr);if(!u||!d)return null;if(!Hf(u.type,[Ko(wi),Ci,wi]))return a.error(`Expected first argument to be of type array or string, but found ${ro(u.type)} instead`);if(t.length===4){const _=a.parse(t[3],3,cr);return _?new cu(u.type,u,d,_):null}return new cu(u.type,u,d)}evaluate(t){const a=this.input.evaluate(t),u=this.beginIndex.evaluate(t);if(!nc(a,["string","array"]))throw new qt(`Expected first argument to be of type array or string, but found ${ro(fo(a))} instead.`);if(this.endIndex){const d=this.endIndex.evaluate(t);return a.slice(u,d)}return a.slice(u)}eachChild(t){t(this.input),t(this.beginIndex),this.endIndex&&t(this.endIndex)}outputDefined(){return!1}serialize(){if(this.endIndex!=null&&this.endIndex!==void 0){const t=this.endIndex.serialize();return["slice",this.input.serialize(),this.beginIndex.serialize(),t]}return["slice",this.input.serialize(),this.beginIndex.serialize()]}}class lp{constructor(t,a){this.type=Ko(Ci),this.str=t,this.delimiter=a}static parse(t,a){if(t.length!==3)return a.error(`Expected 2 arguments, but found ${t.length-1} instead.`);const u=a.parse(t[1],1,Ci),d=a.parse(t[2],2,Ci);return u&&d?new lp(u,d):void 0}evaluate(t){const a=this.str.evaluate(t),u=this.delimiter.evaluate(t);return a.split(u)}eachChild(t){t(this.str),t(this.delimiter)}outputDefined(){return!1}serialize(){return["split",this.str.serialize(),this.delimiter.serialize()]}}function qh(s,t){return s==="=="||s==="!="?t.kind==="boolean"||t.kind==="string"||t.kind==="number"||t.kind==="null"||t.kind==="value":t.kind==="string"||t.kind==="number"||t.kind==="value"}function cp(s,t,a,u){return u.compare(t,a)===0}function Al(s,t,a){const u=s!=="=="&&s!=="!=";return class XR{constructor(_,v,S){this.type=Mi,this.lhs=_,this.rhs=v,this.collator=S,this.hasUntypedArgument=_.type.kind==="value"||v.type.kind==="value"}static parse(_,v){if(_.length!==3&&_.length!==4)return v.error("Expected two or three arguments.");const S=_[0];let E=v.parse(_[1],1,wi);if(!E)return null;if(!qh(S,E.type))return v.concat(1).error(`"${S}" comparisons are not supported for type '${ro(E.type)}'.`);let R=v.parse(_[2],2,wi);if(!R)return null;if(!qh(S,R.type))return v.concat(2).error(`"${S}" comparisons are not supported for type '${ro(R.type)}'.`);if(E.type.kind!==R.type.kind&&E.type.kind!=="value"&&R.type.kind!=="value")return v.error(`Cannot compare types '${ro(E.type)}' and '${ro(R.type)}'.`);u&&(E.type.kind==="value"&&R.type.kind!=="value"?E=new vr(R.type,[E]):E.type.kind!=="value"&&R.type.kind==="value"&&(R=new vr(E.type,[R])));let P=null;if(_.length===4){if(E.type.kind!=="string"&&R.type.kind!=="string"&&E.type.kind!=="value"&&R.type.kind!=="value")return v.error("Cannot use collator to compare non-string types.");if(P=v.parse(_[3],3,qd),!P)return null}return new XR(E,R,P)}evaluate(_){const v=this.lhs.evaluate(_),S=this.rhs.evaluate(_);if(u&&this.hasUntypedArgument){const E=fo(v),R=fo(S);if(E.kind!==R.kind||E.kind!=="string"&&E.kind!=="number")throw new qt(`Expected arguments for "${s}" to be (string, string) or (number, number), but found (${E.kind}, ${R.kind}) instead.`)}if(this.collator&&!u&&this.hasUntypedArgument){const E=fo(v),R=fo(S);if(E.kind!=="string"||R.kind!=="string")return t(_,v,S)}return this.collator?a(_,v,S,this.collator.evaluate(_)):t(_,v,S)}eachChild(_){_(this.lhs),_(this.rhs),this.collator&&_(this.collator)}outputDefined(){return!0}serialize(){const _=[s];return this.eachChild((v=>{_.push(v.serialize())})),_}}}const Im=Al("==",(function(s,t,a){return t===a}),cp),Mg=Al("!=",(function(s,t,a){return t!==a}),(function(s,t,a,u){return!cp(0,t,a,u)})),up=Al("<",(function(s,t,a){return t<a}),(function(s,t,a,u){return u.compare(t,a)<0})),Jf=Al(">",(function(s,t,a){return t>a}),(function(s,t,a,u){return u.compare(t,a)>0})),ed=Al("<=",(function(s,t,a){return t<=a}),(function(s,t,a,u){return u.compare(t,a)<=0})),Dg=Al(">=",(function(s,t,a){return t>=a}),(function(s,t,a,u){return u.compare(t,a)>=0}));class hp{constructor(t,a,u,d,_,v){this.type=Ci,this.number=t,this.locale=a,this.currency=u,this.unit=d,this.minFractionDigits=_,this.maxFractionDigits=v}static parse(t,a){if(t.length!==3)return a.error("Expected two arguments.");const u=a.parse(t[1],1,cr);if(!u)return null;const d=t[2];if(typeof d!="object"||Array.isArray(d))return a.error("NumberFormat options argument must be an object.");let _=null;if(d.locale&&(_=a.parseObjectValue(d.locale,2,"locale",Ci),!_))return null;let v=null;if(d.currency&&(v=a.parseObjectValue(d.currency,2,"currency",Ci),!v))return null;let S=null;if(d.unit&&(S=a.parseObjectValue(d.unit,2,"unit",Ci),!S))return null;let E=null;if(d["min-fraction-digits"]&&(E=a.parseObjectValue(d["min-fraction-digits"],2,"min-fraction-digits",cr),!E))return null;let R=null;return d["max-fraction-digits"]&&(R=a.parseObjectValue(d["max-fraction-digits"],2,"max-fraction-digits",cr),!R)?null:new hp(u,_,v,S,E,R)}evaluate(t){return new Intl.NumberFormat(this.locale?this.locale.evaluate(t):[],{style:(this.currency?"currency":this.unit&&"unit")||"decimal",currency:this.currency?this.currency.evaluate(t):void 0,unit:this.unit?this.unit.evaluate(t):void 0,minimumFractionDigits:this.minFractionDigits?this.minFractionDigits.evaluate(t):void 0,maximumFractionDigits:this.maxFractionDigits?this.maxFractionDigits.evaluate(t):void 0}).format(this.number.evaluate(t))}eachChild(t){t(this.number),this.locale&&t(this.locale),this.currency&&t(this.currency),this.unit&&t(this.unit),this.minFractionDigits&&t(this.minFractionDigits),this.maxFractionDigits&&t(this.maxFractionDigits)}outputDefined(){return!1}serialize(){const t={};return this.locale&&(t.locale=this.locale.serialize()),this.currency&&(t.currency=this.currency.serialize()),this.unit&&(t.unit=this.unit.serialize()),this.minFractionDigits&&(t["min-fraction-digits"]=this.minFractionDigits.serialize()),this.maxFractionDigits&&(t["max-fraction-digits"]=this.maxFractionDigits.serialize()),["number-format",this.number.serialize(),t]}}class El{constructor(t){this.type=cr,this.input=t}static parse(t,a){if(t.length!==2)return a.error(`Expected 1 argument, but found ${t.length-1} instead.`);const u=a.parse(t[1],1);return u?u.type.kind!=="array"&&u.type.kind!=="string"&&u.type.kind!=="value"?a.error(`Expected argument of type string or array, but found ${ro(u.type)} instead.`):new El(u):null}evaluate(t){const a=this.input.evaluate(t);if(typeof a=="string"||Array.isArray(a))return a.length;throw new qt(`Expected value to be of type string or array, but found ${ro(fo(a))} instead.`)}eachChild(t){t(this.input)}outputDefined(){return!1}serialize(){const t=["length"];return this.eachChild((a=>{t.push(a.serialize())})),t}}function td(s){return function(){s=1831565813+(s|=0)|0;let t=Math.imul(s^s>>>15,1|s);return t=t+Math.imul(t^t>>>7,61|t)^t,((t^t>>>14)>>>0)/4294967296}}const uu={"==":Im,"!=":Mg,">":Jf,"<":up,">=":Dg,"<=":ed,array:vr,at:Cm,"at-interpolated":ap,boolean:vr,case:Kf,coalesce:Tl,collator:Do,format:Xu,image:sc,in:sp,"index-of":Hh,interpolate:ea,"interpolate-hcl":ea,"interpolate-lab":ea,length:El,let:xc,literal:kr,match:Is,number:vr,"number-format":hp,object:vr,slice:cu,step:nh,string:vr,"to-boolean":kn,"to-color":kn,"to-number":kn,"to-string":kn,var:ou,within:Ju,distance:bo,config:ih,split:lp};function bc(s,[t,a,u,d]){t=t.evaluate(s),a=a.evaluate(s),u=u.evaluate(s);const _=d?d.evaluate(s):1,v=$u(t,a,u,_);if(v)throw new qt(v);return new Ei(t/255,a/255,u/255,_)}function Cl(s,[t,a,u,d]){t=t.evaluate(s),a=a.evaluate(s),u=u.evaluate(s);const _=d?d.evaluate(s):1,v=(function(R,P,B,F){return typeof R=="number"&&R>=0&&R<=360?typeof P=="number"&&P>=0&&P<=100&&typeof B=="number"&&B>=0&&B<=100?F===void 0||typeof F=="number"&&F>=0&&F<=1?null:`Invalid hsla value [${[R,P,B,F].join(", ")}]: 'a' must be between 0 and 1.`:`Invalid hsla value [${(typeof F=="number"?[R,P,B,F]:[R,P,B]).join(", ")}]: 's', and 'l' must be between 0 and 100.`:`Invalid hsla value [${(typeof F=="number"?[R,P,B,F]:[R,P,B]).join(", ")}]: 'h' must be between 0 and 360.`})(t,a,u,_);if(v)throw new qt(v);const S=`hsla(${t}, ${a}%, ${u}%, ${_})`,E=Ei.parse(S);if(!E)throw new qt(`Failed to parse HSLA color: ${S}`);return E}function ah(s,t){return s in t}function $h(s,t){const a=t[s];return a===void 0?null:a}function wc(s){return{type:s}}function Js(s){return{result:"success",value:s}}function Rs(s){return{result:"error",value:s}}function fp(s,t){return!!s&&!!s.parameters&&s.parameters.indexOf(t)>-1}function rd(s){return s["property-type"]==="data-driven"}function hu(s){return fp(s.expression,"measure-light")}function Xh(s){return fp(s.expression,"zoom")}function id(s){return!!s.expression&&s.expression.interpolated}function Zh(s){return typeof s=="object"&&s!==null&&!Array.isArray(s)}function nd(s){return s}function el(s,t){const a=t.type==="color",u=s.stops&&typeof s.stops[0][0]=="object",d=u||!(u||s.property!==void 0),_=s.type||(id(t)?"exponential":"interval");if(a&&((s=Object.assign({},s)).stops&&(s.stops=s.stops.map((R=>[R[0],Ei.parse(R[1])]))),s.default=Ei.parse(s.default?s.default:t.default)),s.colorSpace&&s.colorSpace!=="rgb"&&!jh[s.colorSpace])throw new Error(`Unknown color space: ${s.colorSpace}`);let v,S,E;if(_==="exponential")v=od;else if(_==="interval")v=Vn;else if(_==="categorical"){v=Pn,S=Object.create(null);for(const R of s.stops)S[R[0]]=R[1];E=typeof s.stops[0][0]}else{if(_!=="identity")throw new Error(`Unknown function type "${_}"`);v=Wh}if(u){const R={},P=[];for(let j=0;j<s.stops.length;j++){const G=s.stops[j],Q=G[0].zoom;R[Q]===void 0&&(R[Q]={zoom:Q,type:s.type,property:s.property,default:s.default,stops:[]},P.push(Q)),R[Q].stops.push([G[0].value,G[1]])}const B=[];for(const j of P)B.push([R[j].zoom,el(R[j],t)]);const F={name:"linear"};return{kind:"composite",interpolationType:F,interpolationFactor:ea.interpolationFactor.bind(void 0,F),zoomStops:B.map((j=>j[0])),evaluate:({zoom:j},G)=>od({stops:B,base:s.base},t,j).evaluate(j,G)}}if(d){const R=_==="exponential"?{name:"exponential",base:s.base!==void 0?s.base:1}:null;return{kind:"camera",interpolationType:R,interpolationFactor:ea.interpolationFactor.bind(void 0,R),zoomStops:s.stops.map((P=>P[0])),evaluate:({zoom:P})=>v(s,t,P,S,E)}}return{kind:"source",evaluate(R,P){const B=P&&P.properties?P.properties[s.property]:void 0;return B===void 0?Di(s.default,t.default):v(s,t,B,S,E)}}}function Di(s,t,a){return s!==void 0?s:t!==void 0?t:a!==void 0?a:void 0}function Pn(s,t,a,u,d){return Di(typeof a===d?u[a]:void 0,s.default,t.default)}function Vn(s,t,a){if(!Wu(a))return Di(s.default,t.default);const u=s.stops.length;if(u===1||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[u-1][0])return s.stops[u-1][1];const d=su(s.stops.map((_=>_[0])),a);return s.stops[d][1]}function od(s,t,a){const u=s.base!==void 0?s.base:1;if(!Wu(a))return Di(s.default,t.default);const d=s.stops.length;if(d===1||a<=s.stops[0][0])return s.stops[0][1];if(a>=s.stops[d-1][0])return s.stops[d-1][1];const _=su(s.stops.map((P=>P[0])),a),v=(function(P,B,F,j){const G=j-F,Q=P-F;return G===0?0:B===1?Q/G:(Math.pow(B,Q)-1)/(Math.pow(B,G)-1)})(a,u,s.stops[_][0],s.stops[_+1][0]),S=s.stops[_][1],E=s.stops[_+1][1];let R=is[t.type]||nd;if(s.colorSpace&&s.colorSpace!=="rgb"){const P=jh[s.colorSpace];R=(B,F)=>P.reverse(P.interpolate(P.forward(B),P.forward(F),v))}return typeof S.evaluate=="function"?{evaluate(...P){const B=S.evaluate.apply(void 0,P),F=E.evaluate.apply(void 0,P);if(B!==void 0&&F!==void 0)return R(B,F,v)}}:R(S,E,v)}function Wh(s,t,a){return t.type==="color"?a=Ei.parse(a):t.type==="formatted"?a=Jo.fromString(a.toString()):t.type==="resolvedImage"?a=sa.build(a.toString()):Tr(a)===t.type||t.type==="enum"&&t.values[a]||(a=void 0),Di(a,s.default,t.default)}la.register(uu,{error:[{kind:"error"},[Ci],(s,[t])=>{throw new qt(t.evaluate(s))}],typeof:[Ci,[wi],(s,[t])=>ro(fo(t.evaluate(s)))],"to-rgba":[Ko(cr,4),[ba],(s,[t])=>t.evaluate(s).toNonPremultipliedRenderColor(null).toArray()],"to-hsla":[Ko(cr,4),[ba],(s,[t])=>t.evaluate(s).toNonPremultipliedRenderColor(null).toHslaArray()],rgb:[ba,[cr,cr,cr],bc],rgba:[ba,[cr,cr,cr,cr],bc],hsl:[ba,[cr,cr,cr],Cl],hsla:[ba,[cr,cr,cr,cr],Cl],has:{type:Mi,overloads:[[[Ci],(s,[t])=>ah(t.evaluate(s),s.properties())],[[Ci,qu],(s,[t,a])=>ah(t.evaluate(s),a.evaluate(s))]]},get:{type:wi,overloads:[[[Ci],(s,[t])=>$h(t.evaluate(s),s.properties())],[[Ci,qu],(s,[t,a])=>$h(t.evaluate(s),a.evaluate(s))]]},"feature-state":[wi,[Ci],(s,[t])=>$h(t.evaluate(s),s.featureState||{})],properties:[qu,[],s=>s.properties()],"geometry-type":[Ci,[],s=>s.geometryType()],worldview:[Ci,[],s=>s.globals.worldview||""],id:[wi,[],s=>s.id()],zoom:[cr,[],s=>s.globals.zoom],pitch:[cr,[],s=>s.globals.pitch||0],"distance-from-center":[cr,[],s=>s.distanceFromCenter()],"measure-light":[cr,[Ci],(s,[t])=>s.measureLight(t.evaluate(s))],"heatmap-density":[cr,[],s=>s.globals.heatmapDensity||0],"line-progress":[cr,[],s=>s.globals.lineProgress||0],"raster-value":[cr,[],s=>s.globals.rasterValue||0],"raster-particle-speed":[cr,[],s=>s.globals.rasterParticleSpeed||0],"sky-radial-progress":[cr,[],s=>s.globals.skyRadialProgress||0],accumulated:[wi,[],s=>s.globals.accumulated===void 0?null:s.globals.accumulated],"+":[cr,wc(cr),(s,t)=>{let a=0;for(const u of t)a+=u.evaluate(s);return a}],"*":[cr,wc(cr),(s,t)=>{let a=1;for(const u of t)a*=u.evaluate(s);return a}],"-":{type:cr,overloads:[[[cr,cr],(s,[t,a])=>t.evaluate(s)-a.evaluate(s)],[[cr],(s,[t])=>-t.evaluate(s)]]},"/":[cr,[cr,cr],(s,[t,a])=>t.evaluate(s)/a.evaluate(s)],"%":[cr,[cr,cr],(s,[t,a])=>t.evaluate(s)%a.evaluate(s)],ln2:[cr,[],()=>Math.LN2],pi:[cr,[],()=>Math.PI],e:[cr,[],()=>Math.E],"^":[cr,[cr,cr],(s,[t,a])=>Math.pow(t.evaluate(s),a.evaluate(s))],sqrt:[cr,[cr],(s,[t])=>Math.sqrt(t.evaluate(s))],log10:[cr,[cr],(s,[t])=>Math.log(t.evaluate(s))/Math.LN10],ln:[cr,[cr],(s,[t])=>Math.log(t.evaluate(s))],log2:[cr,[cr],(s,[t])=>Math.log2(t.evaluate(s))],sin:[cr,[cr],(s,[t])=>Math.sin(t.evaluate(s))],cos:[cr,[cr],(s,[t])=>Math.cos(t.evaluate(s))],tan:[cr,[cr],(s,[t])=>Math.tan(t.evaluate(s))],asin:[cr,[cr],(s,[t])=>Math.asin(t.evaluate(s))],acos:[cr,[cr],(s,[t])=>Math.acos(t.evaluate(s))],atan:[cr,[cr],(s,[t])=>Math.atan(t.evaluate(s))],min:[cr,wc(cr),(s,t)=>Math.min(...t.map((a=>a.evaluate(s))))],max:[cr,wc(cr),(s,t)=>Math.max(...t.map((a=>a.evaluate(s))))],abs:[cr,[cr],(s,[t])=>Math.abs(t.evaluate(s))],round:[cr,[cr],(s,[t])=>{const a=t.evaluate(s);return a<0?-Math.round(-a):Math.round(a)}],floor:[cr,[cr],(s,[t])=>Math.floor(t.evaluate(s))],ceil:[cr,[cr],(s,[t])=>Math.ceil(t.evaluate(s))],"filter-==":[Mi,[Ci,wi],(s,[t,a])=>s.properties()[t.value]===a.value],"filter-id-==":[Mi,[wi],(s,[t])=>s.id()===t.value],"filter-type-==":[Mi,[Ci],(s,[t])=>s.geometryType()===t.value],"filter-<":[Mi,[Ci,wi],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u<d}],"filter-id-<":[Mi,[wi],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a<u}],"filter->":[Mi,[Ci,wi],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u>d}],"filter-id->":[Mi,[wi],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a>u}],"filter-<=":[Mi,[Ci,wi],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u<=d}],"filter-id-<=":[Mi,[wi],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a<=u}],"filter->=":[Mi,[Ci,wi],(s,[t,a])=>{const u=s.properties()[t.value],d=a.value;return typeof u==typeof d&&u>=d}],"filter-id->=":[Mi,[wi],(s,[t])=>{const a=s.id(),u=t.value;return typeof a==typeof u&&a>=u}],"filter-has":[Mi,[wi],(s,[t])=>t.value in s.properties()],"filter-has-id":[Mi,[],s=>s.id()!==null&&s.id()!==void 0],"filter-type-in":[Mi,[Ko(Ci)],(s,[t])=>t.value.indexOf(s.geometryType())>=0],"filter-id-in":[Mi,[Ko(wi)],(s,[t])=>t.value.indexOf(s.id())>=0],"filter-in-small":[Mi,[Ci,Ko(wi)],(s,[t,a])=>a.value.indexOf(s.properties()[t.value])>=0],"filter-in-large":[Mi,[Ci,Ko(wi)],(s,[t,a])=>(function(u,d,_,v){for(;_<=v;){const S=_+v>>1;if(d[S]===u)return!0;d[S]>u?v=S-1:_=S+1}return!1})(s.properties()[t.value],a.value,0,a.value.length-1)],all:{type:Mi,overloads:[[[Mi,Mi],(s,[t,a])=>t.evaluate(s)&&a.evaluate(s)],[wc(Mi),(s,t)=>{for(const a of t)if(!a.evaluate(s))return!1;return!0}]]},any:{type:Mi,overloads:[[[Mi,Mi],(s,[t,a])=>t.evaluate(s)||a.evaluate(s)],[wc(Mi),(s,t)=>{for(const a of t)if(a.evaluate(s))return!0;return!1}]]},"!":[Mi,[Mi],(s,[t])=>!t.evaluate(s)],"is-supported-script":[Mi,[Ci],(s,[t])=>{const a=s.globals&&s.globals.isSupportedScript;return!a||a(t.evaluate(s))}],upcase:[Ci,[Ci],(s,[t])=>t.evaluate(s).toUpperCase()],downcase:[Ci,[Ci],(s,[t])=>t.evaluate(s).toLowerCase()],concat:[Ci,wc(wi),(s,t)=>t.map((a=>wa(a.evaluate(s)))).join("")],"resolved-locale":[Ci,[qd],(s,[t])=>t.evaluate(s).resolvedLocale()],random:[cr,[cr,cr,wi],(s,t)=>{const[a,u,d]=t.map((v=>v.evaluate(s)));if(a>u||a===u)return a;let _;if(typeof d=="string")_=(function(v){let S=0;if(v.length===0)return S;for(let E=0;E<v.length;E++)S=(S<<5)-S+v.charCodeAt(E),S|=0;return S})(d);else{if(typeof d!="number")throw new qt(`Invalid seed input: ${d}`);_=d}return a+td(_)()*(u-a)}]});class Il{constructor(t,a,u,d,_){this.expression=t,this._warningHistory={},this._evaluator=new lc(u,d,_),this._defaultValue=a?(function(v){return v.type==="color"&&(Zh(v.default)||Array.isArray(v.default))?new Ei(0,0,0,0):v.type==="color"?Ei.parse(v.default)||null:v.default===void 0?null:v.default})(a):null,this._enumValues=a&&a.type==="enum"?a.values:null,this.configDependencies=wl(t)}evaluateWithoutErrorHandling(t,a,u,d,_,v,S,E){return this._evaluator.globals=t,this._evaluator.feature=a,this._evaluator.featureState=u,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null,this.expression.evaluate(this._evaluator)}evaluate(t,a,u,d,_,v,S,E,R){this._evaluator.globals=t,this._evaluator.feature=a||null,this._evaluator.featureState=u||null,this._evaluator.canonical=d||null,this._evaluator.availableImages=_||null,this._evaluator.formattedSection=v||null,this._evaluator.featureTileCoord=S||null,this._evaluator.featureDistanceData=E||null,this._evaluator.iconImageUseTheme=R||null;try{const P=this.expression.evaluate(this._evaluator);if(P==null||typeof P=="number"&&P!=P)return this._defaultValue;if(this._enumValues&&!(P in this._enumValues))throw new qt(`Expected value to be one of ${Object.keys(this._enumValues).map((B=>JSON.stringify(B))).join(", ")}, but found ${JSON.stringify(P)} instead.`);return P}catch(P){return this._warningHistory[P.message]||(this._warningHistory[P.message]=!0,typeof console<"u"&&console.warn(`Failed to evaluate expression "${JSON.stringify(this.expression.serialize())}". ${P.message}`)),this._defaultValue}}}function Yh(s){return Array.isArray(s)&&s.length>0&&typeof s[0]=="string"&&s[0]in uu}function qa(s,t,a,u,d){const _=new au(uu,[],t?(function(S){const E={color:ba,string:Ci,number:cr,enum:Ci,boolean:Mi,formatted:Yc,resolvedImage:jf};return S.type==="array"?Ko(E[S.value]||wi,S.length):E[S.type]})(t):void 0,void 0,void 0,a,u,d),v=_.parse(s,void 0,void 0,void 0,t&&t.type==="string"?{typeAnnotation:"coerce"}:void 0);return v?Js(new Il(v,t,a,u,d)):Rs(_.errors)}class Rl{constructor(t,a,u,d){this.kind=t,this._styleExpression=a,this.isLightConstant=u,this.isLineProgressConstant=d,this.isStateDependent=t!=="constant"&&!un(a.expression),this.configDependencies=wl(a.expression)}evaluateWithoutErrorHandling(t,a,u,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,d,_,v)}evaluate(t,a,u,d,_,v,S){return this._styleExpression.evaluate(t,a,u,d,_,v,void 0,void 0,S)}}class fu{constructor(t,a,u,d,_,v){this.kind=t,this.zoomStops=u,this._styleExpression=a,this.isStateDependent=t!=="camera"&&!un(a.expression),this.isLightConstant=_,this.isLineProgressConstant=v,this.configDependencies=wl(a.expression),this.interpolationType=d}evaluateWithoutErrorHandling(t,a,u,d,_,v){return this._styleExpression.evaluateWithoutErrorHandling(t,a,u,d,_,v)}evaluate(t,a,u,d,_,v){return this._styleExpression.evaluate(t,a,u,d,_,v)}interpolationFactor(t,a,u){return this.interpolationType?ea.interpolationFactor(this.interpolationType,t,a,u):0}}function ao(s,t,a,u,d){if((s=qa(s,t,a,u,d)).result==="error")return s;const _=s.value.expression,v=Nn(_);if(!v&&!rd(t))return Rs([new Ks("","data expressions not supported")]);const S=Ta(_,["zoom","pitch","distance-from-center"]);if(!S&&!Xh(t))return Rs([new Ks("","zoom expressions not supported")]);const E=Ta(_,["measure-light"]);if(!E&&!hu(t))return Rs([new Ks("","measure-light expression not supported")]);const R=Ta(_,["line-progress"]);if(!R&&!(function(F){return fp(F.expression,"line-progress")})(t))return Rs([new Ks("","line-progress expression not supported")]);const P=t.expression&&t.expression.relaxZoomRestriction,B=Kh(_);return B||S||P?B instanceof Ks?Rs([B]):B instanceof ea&&!id(t)?Rs([new Ks("",'"interpolate" expressions cannot be used with this property')]):Js(B?new fu(v&&R?"camera":"composite",s.value,B.labels,B instanceof ea?B.interpolation:void 0,E,R):new Rl(v&&R?"constant":"source",s.value,E,R)):Rs([new Ks("",'"zoom" expression may only be used as input to a top-level "step" or "interpolate" expression, or in the properties of atmosphere.')])}class Qh{constructor(t,a){this._parameters=t,this._specification=a,Object.assign(this,el(this._parameters,this._specification))}static deserialize(t){return new Qh(t._parameters,t._specification)}static serialize(t){return{_parameters:t._parameters,_specification:t._specification}}}function Kh(s){let t=null;if(s instanceof xc)t=Kh(s.result);else if(s instanceof Tl){for(const a of s.args)if(t=Kh(a),t)break}else(s instanceof nh||s instanceof ea)&&s.input instanceof la&&s.input.name==="zoom"&&(t=s);return t instanceof Ks||s.eachChild((a=>{const u=Kh(a);u instanceof Ks?t=u:t&&u&&t!==u&&(t=new Ks("",'Only one zoom-based "step" or "interpolate" subexpression may be used in an expression.'))})),t}var Jh,ad,Og=(function(){if(ad)return Jh;ad=1,Jh=t;var s=3;function t(a,u,d){var _=this.cells=[];if(a instanceof ArrayBuffer){this.arrayBuffer=a;var v=new Int32Array(this.arrayBuffer);a=v[0],this.d=(u=v[1])+2*(d=v[2]);for(var S=0;S<this.d*this.d;S++){var E=v[s+S],R=v[s+S+1];_.push(E===R?null:v.subarray(E,R))}var P=v[s+_.length+1];this.keys=v.subarray(v[s+_.length],P),this.bboxes=v.subarray(P),this.insert=this._insertReadonly}else{this.d=u+2*d;for(var B=0;B<this.d*this.d;B++)_.push([]);this.keys=[],this.bboxes=[]}this.n=u,this.extent=a,this.padding=d,this.scale=u/a,this.uid=0;var F=d/u*a;this.min=-F,this.max=a+F}return t.prototype.insert=function(a,u,d,_,v){this._forEachCell(u,d,_,v,this._insertCell,this.uid++),this.keys.push(a),this.bboxes.push(u),this.bboxes.push(d),this.bboxes.push(_),this.bboxes.push(v)},t.prototype._insertReadonly=function(){throw"Cannot insert into a GridIndex created from an ArrayBuffer."},t.prototype._insertCell=function(a,u,d,_,v,S){this.cells[v].push(S)},t.prototype.query=function(a,u,d,_,v){var S=this.min,E=this.max;if(a<=S&&u<=S&&E<=d&&E<=_&&!v)return Array.prototype.slice.call(this.keys);var R=[];return this._forEachCell(a,u,d,_,this._queryCell,R,{},v),R},t.prototype._queryCell=function(a,u,d,_,v,S,E,R){var P=this.cells[v];if(P!==null)for(var B=this.keys,F=this.bboxes,j=0;j<P.length;j++){var G=P[j];if(E[G]===void 0){var Q=4*G;(R?R(F[Q+0],F[Q+1],F[Q+2],F[Q+3]):a<=F[Q+2]&&u<=F[Q+3]&&d>=F[Q+0]&&_>=F[Q+1])?(E[G]=!0,S.push(B[G])):E[G]=!1}}},t.prototype._forEachCell=function(a,u,d,_,v,S,E,R){for(var P=this._convertToCellCoord(a),B=this._convertToCellCoord(u),F=this._convertToCellCoord(d),j=this._convertToCellCoord(_),G=P;G<=F;G++)for(var Q=B;Q<=j;Q++){var J=this.d*Q+G;if((!R||R(this._convertFromCellCoord(G),this._convertFromCellCoord(Q),this._convertFromCellCoord(G+1),this._convertFromCellCoord(Q+1)))&&v.call(this,a,u,d,_,J,S,E,R))return}},t.prototype._convertFromCellCoord=function(a){return(a-this.padding)/this.scale},t.prototype._convertToCellCoord=function(a){return Math.max(0,Math.min(this.d-1,Math.floor(a*this.scale)+this.padding))},t.prototype.toArrayBuffer=function(){if(this.arrayBuffer)return this.arrayBuffer;for(var a=this.cells,u=s+this.cells.length+1+1,d=0,_=0;_<this.cells.length;_++)d+=this.cells[_].length;var v=new Int32Array(u+d+this.keys.length+this.bboxes.length);v[0]=this.extent,v[1]=this.n,v[2]=this.padding;for(var S=u,E=0;E<a.length;E++){var R=a[E];v[s+E]=S,v.set(R,S),S+=R.length}return v[s+a.length]=S,v.set(this.keys,S),v[s+a.length+1]=S+=this.keys.length,v.set(this.bboxes,S),S+=this.bboxes.length,v.buffer},Jh})(),Sc=Of(Og);const du={};function $t(s,t,a={}){Object.defineProperty(s,"_classRegistryKey",{value:t,writable:!1}),du[t]={klass:s,omit:a.omit||[]}}$t(Object,"Object"),Sc.serialize=function(s,t){const a=s.toArrayBuffer();return t&&t.add(a),{buffer:a}},Sc.deserialize=function(s){return new Sc(s.buffer)},Object.defineProperty(Sc,"name",{value:"Grid"}),$t(Sc,"Grid"),delete Tt.prototype.constructor,typeof DOMMatrix<"u"&&$t(DOMMatrix,"DOMMatrix"),$t(Ei,"Color"),$t(Error,"Error"),$t(Jo,"Formatted"),$t($f,"FormattedSection"),$t(Vu,"AJAXError"),$t(sa,"ResolvedImage"),$t(Qh,"StylePropertyFunction"),$t(Il,"StyleExpression",{omit:["_evaluator"]}),$t(rs,"ImageId"),$t(Ss,"ImageVariant"),$t(fu,"ZoomDependentExpression"),$t(Rl,"ZoomConstantExpression"),$t(la,"CompoundExpression",{omit:["_evaluate"]});for(const s in uu)du[uu[s]._classRegistryKey]||$t(uu[s],`Expression${s}`);function ha(s){return s&&typeof ArrayBuffer<"u"&&(s instanceof ArrayBuffer||s.constructor&&s.constructor.name==="ArrayBuffer")}function Ln(s){return self.ImageBitmap&&s instanceof ImageBitmap}function Ml(s,t){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp)return s;if(ha(s)||Ln(s))return t&&t.add(s),s;if(ArrayBuffer.isView(s))return t&&t.add(s.buffer),s;if(s instanceof ImageData)return t&&t.add(s.data.buffer),s;if(Array.isArray(s)){const a=[];for(const u of s)a.push(Ml(u,t));return a}if(s instanceof Map){const a={$name:"Map",entries:[]};for(const[u,d]of s.entries())a.entries.push(Ml(u),Ml(d,t));return a}if(s instanceof Set){const a={$name:"Set"};let u=0;for(const d of s.values())a[++u]=Ml(d);return a}if(s instanceof DOMMatrix){const a={$name:"DOMMatrix"},u=["is2D","m11","m12","m13","m14","m21","m22","m23","m24","m31","m32","m33","m34","m41","m42","m43","m44","a","b","c","d","e","f"];for(const d of u)a[d]=s[d];return a}if(typeof s=="bigint")return{$name:"BigInt",value:s.toString()};if(typeof s=="object"){const a=s.constructor,u=a._classRegistryKey;if(!u)throw new Error(`Can't serialize object of unregistered class "${a.name}".`);const d=a.serialize?a.serialize(s,t):{};if(!a.serialize){for(const _ in s)s.hasOwnProperty(_)&&(du[u].omit.indexOf(_)>=0||(d[_]=Ml(s[_],t)));s instanceof Error&&(d.message=s.message)}if(d.$name)throw new Error("$name property is reserved for worker serialization logic.");return u!=="Object"&&(d.$name=u),d}throw new Error("can't serialize object of type "+typeof s)}function Ms(s){if(s==null||typeof s=="boolean"||typeof s=="number"||typeof s=="string"||s instanceof Boolean||s instanceof Number||s instanceof String||s instanceof Date||s instanceof RegExp||ha(s)||Ln(s)||ArrayBuffer.isView(s)||s instanceof ImageData)return s;if(Array.isArray(s))return s.map(Ms);if(typeof s=="object"){const t=s.$name||"Object";if(t==="Map"){const d=s.entries||[],_=new Map;for(let v=0;v<d.length;v+=2)_.set(Ms(d[v]),Ms(d[v+1]));return _}if(t==="Set"){const d=new Set;for(const _ of Object.keys(s))_!=="$name"&&d.add(Ms(s[_]));return d}if(t==="DOMMatrix"){let d;return d=s.is2D?[s.a,s.b,s.c,s.d,s.e,s.f]:[s.m11,s.m12,s.m13,s.m14,s.m21,s.m22,s.m23,s.m24,s.m31,s.m32,s.m33,s.m34,s.m41,s.m42,s.m43,s.m44],new DOMMatrix(d)}if(t==="BigInt")return BigInt(s.value);const{klass:a}=du[t];if(!a)throw new Error(`Can't deserialize unregistered class "${t}".`);if(a.deserialize)return a.deserialize(s);const u=Object.create(a.prototype);for(const d of Object.keys(s))d!=="$name"&&(u[d]=Ms(s[d]));return u}throw new Error("can't deserialize object of type "+typeof s)}const _r={"Latin-1 Supplement":s=>s>=128&&s<=255,Arabic:s=>s>=1536&&s<=1791,"Arabic Supplement":s=>s>=1872&&s<=1919,"Arabic Extended-A":s=>s>=2208&&s<=2303,"Hangul Jamo":s=>s>=4352&&s<=4607,"Unified Canadian Aboriginal Syllabics":s=>s>=5120&&s<=5759,Khmer:s=>s>=6016&&s<=6143,"Unified Canadian Aboriginal Syllabics Extended":s=>s>=6320&&s<=6399,"General Punctuation":s=>s>=8192&&s<=8303,"Letterlike Symbols":s=>s>=8448&&s<=8527,"Number Forms":s=>s>=8528&&s<=8591,"Miscellaneous Technical":s=>s>=8960&&s<=9215,"Control Pictures":s=>s>=9216&&s<=9279,"Optical Character Recognition":s=>s>=9280&&s<=9311,"Enclosed Alphanumerics":s=>s>=9312&&s<=9471,"Geometric Shapes":s=>s>=9632&&s<=9727,"Miscellaneous Symbols":s=>s>=9728&&s<=9983,"Miscellaneous Symbols and Arrows":s=>s>=11008&&s<=11263,"CJK Radicals Supplement":s=>s>=11904&&s<=12031,"Kangxi Radicals":s=>s>=12032&&s<=12255,"Ideographic Description Characters":s=>s>=12272&&s<=12287,"CJK Symbols and Punctuation":s=>s>=12288&&s<=12351,Hiragana:s=>s>=12352&&s<=12447,Katakana:s=>s>=12448&&s<=12543,Bopomofo:s=>s>=12544&&s<=12591,"Hangul Compatibility Jamo":s=>s>=12592&&s<=12687,Kanbun:s=>s>=12688&&s<=12703,"Bopomofo Extended":s=>s>=12704&&s<=12735,"CJK Strokes":s=>s>=12736&&s<=12783,"Katakana Phonetic Extensions":s=>s>=12784&&s<=12799,"Enclosed CJK Letters and Months":s=>s>=12800&&s<=13055,"CJK Compatibility":s=>s>=13056&&s<=13311,"CJK Unified Ideographs Extension A":s=>s>=13312&&s<=19903,"Yijing Hexagram Symbols":s=>s>=19904&&s<=19967,"CJK Unified Ideographs":s=>s>=19968&&s<=40959,"Yi Syllables":s=>s>=40960&&s<=42127,"Yi Radicals":s=>s>=42128&&s<=42191,"Hangul Jamo Extended-A":s=>s>=43360&&s<=43391,"Hangul Syllables":s=>s>=44032&&s<=55215,"Hangul Jamo Extended-B":s=>s>=55216&&s<=55295,"Private Use Area":s=>s>=57344&&s<=63743,"CJK Compatibility Ideographs":s=>s>=63744&&s<=64255,"Arabic Presentation Forms-A":s=>s>=64336&&s<=65023,"Vertical Forms":s=>s>=65040&&s<=65055,"CJK Compatibility Forms":s=>s>=65072&&s<=65103,"Small Form Variants":s=>s>=65104&&s<=65135,"Arabic Presentation Forms-B":s=>s>=65136&&s<=65279,"Halfwidth and Fullwidth Forms":s=>s>=65280&&s<=65519,Osage:s=>s>=66736&&s<=66815,"CJK Unified Ideographs Extension B":s=>s>=131072&&s<=173791};function sd(s){for(const t of s)if(ef(t.charCodeAt(0)))return!0;return!1}function Dl(s){for(const t of s)if(!sh(t.charCodeAt(0)))return!1;return!0}function sh(s){return!(_r.Arabic(s)||_r["Arabic Supplement"](s)||_r["Arabic Extended-A"](s)||_r["Arabic Presentation Forms-A"](s)||_r["Arabic Presentation Forms-B"](s))}function ef(s){return!(s!==746&&s!==747&&(s<4352||!(_r["Bopomofo Extended"](s)||_r.Bopomofo(s)||_r["CJK Compatibility Forms"](s)&&!(s>=65097&&s<=65103)||_r["CJK Compatibility Ideographs"](s)||_r["CJK Compatibility"](s)||_r["CJK Radicals Supplement"](s)||_r["CJK Strokes"](s)||!(!_r["CJK Symbols and Punctuation"](s)||s>=12296&&s<=12305||s>=12308&&s<=12319||s===12336)||_r["CJK Unified Ideographs Extension A"](s)||_r["CJK Unified Ideographs"](s)||_r["Enclosed CJK Letters and Months"](s)||_r["Hangul Compatibility Jamo"](s)||_r["Hangul Jamo Extended-A"](s)||_r["Hangul Jamo Extended-B"](s)||_r["Hangul Jamo"](s)||_r["Hangul Syllables"](s)||_r.Hiragana(s)||_r["Ideographic Description Characters"](s)||_r.Kanbun(s)||_r["Kangxi Radicals"](s)||_r["Katakana Phonetic Extensions"](s)||_r.Katakana(s)&&s!==12540||!(!_r["Halfwidth and Fullwidth Forms"](s)||s===65288||s===65289||s===65293||s>=65306&&s<=65310||s===65339||s===65341||s===65343||s>=65371&&s<=65503||s===65507||s>=65512&&s<=65519)||!(!_r["Small Form Variants"](s)||s>=65112&&s<=65118||s>=65123&&s<=65126)||_r["Unified Canadian Aboriginal Syllabics"](s)||_r["Unified Canadian Aboriginal Syllabics Extended"](s)||_r["Vertical Forms"](s)||_r["Yijing Hexagram Symbols"](s)||_r["Yi Syllables"](s)||_r["Yi Radicals"](s))))}function tf(s){return!(ef(s)||(function(t){return!!(_r["Latin-1 Supplement"](t)&&(t===167||t===169||t===174||t===177||t===188||t===189||t===190||t===215||t===247)||_r["General Punctuation"](t)&&(t===8214||t===8224||t===8225||t===8240||t===8241||t===8251||t===8252||t===8258||t===8263||t===8264||t===8265||t===8273)||_r["Letterlike Symbols"](t)||_r["Number Forms"](t)||_r["Miscellaneous Technical"](t)&&(t>=8960&&t<=8967||t>=8972&&t<=8991||t>=8996&&t<=9e3||t===9003||t>=9085&&t<=9114||t>=9150&&t<=9165||t===9167||t>=9169&&t<=9179||t>=9186&&t<=9215)||_r["Control Pictures"](t)&&t!==9251||_r["Optical Character Recognition"](t)||_r["Enclosed Alphanumerics"](t)||_r["Geometric Shapes"](t)||_r["Miscellaneous Symbols"](t)&&!(t>=9754&&t<=9759)||_r["Miscellaneous Symbols and Arrows"](t)&&(t>=11026&&t<=11055||t>=11088&&t<=11097||t>=11192&&t<=11243)||_r["CJK Symbols and Punctuation"](t)||_r.Katakana(t)||_r["Private Use Area"](t)||_r["CJK Compatibility Forms"](t)||_r["Small Form Variants"](t)||_r["Halfwidth and Fullwidth Forms"](t)||t===8734||t===8756||t===8757||t>=9984&&t<=10087||t>=10102&&t<=10131||t===65532||t===65533)})(s))}function Pg(s){return _r.Arabic(s)||_r["Arabic Supplement"](s)||_r["Arabic Extended-A"](s)||_r["Arabic Presentation Forms-A"](s)||_r["Arabic Presentation Forms-B"](s)}function Rm(s){return s>=1424&&s<=2303||_r["Arabic Presentation Forms-A"](s)||_r["Arabic Presentation Forms-B"](s)}function Lg(s,t){return!(!t&&Rm(s)||s>=2304&&s<=3583||s>=3840&&s<=4255||_r.Khmer(s))}function Bg(s){for(const t of s)if(Rm(t.charCodeAt(0)))return!0;return!1}const Aa={unavailable:"unavailable",deferred:"deferred",loading:"loading",parsing:"parsing",parsed:"parsed",loaded:"loaded",error:"error"};let dp=null,jo=Aa.unavailable,Tc=null;const zg=function(s){s&&typeof s=="string"&&s.indexOf("NetworkError")>-1&&(jo=Aa.error),dp&&dp(s)};function pp(){mp.fire(new ts("pluginStateChange",{pluginStatus:jo,pluginURL:Tc}))}const mp=new Hu,ld=function(){return jo},Ac=function(){if(jo!==Aa.deferred||!Tc)throw new Error("rtl-text-plugin cannot be downloaded unless a pluginURL is specified");jo=Aa.loading,pp(),Tc&&yl({url:Tc},(s=>{s?zg(s):(jo=Aa.loaded,pp())}))},tl={applyArabicShaping:null,processBidirectionalText:null,processStyledBidirectionalText:null,isLoaded:()=>jo===Aa.loaded||tl.applyArabicShaping!=null,isLoading:()=>jo===Aa.loading,setState(s){jo=s.pluginStatus,Tc=s.pluginURL},isParsing:()=>jo===Aa.parsing,isParsed:()=>jo===Aa.parsed,getPluginURL:()=>Tc};class Hi{constructor(t,a){this.zoom=t,a?(this.now=a.now,this.fadeDuration=a.fadeDuration,this.transition=a.transition,this.pitch=a.pitch,this.brightness=a.brightness,this.worldview=a.worldview):(this.now=0,this.fadeDuration=0,this.transition={},this.pitch=0,this.brightness=0)}isSupportedScript(t){return(function(a,u){for(const d of a)if(!Lg(d.charCodeAt(0),u))return!1;return!0})(t,tl.isLoaded())}}class pu{constructor(t,a,u,d,_){this.property=t,this.value=a,this.expression=(function(v,S,E,R,P){if(Zh(v))return new Qh(v,S);if(Yh(v)||Array.isArray(v)&&v.length>0){const B=ao(v,S,E,R,P);if(B.result==="error")throw new Error(B.value.map((F=>`${F.key}: ${F.message}`)).join(", "));return B.value}{let B=v;return typeof v=="string"&&S.type==="color"&&(B=Ei.parse(v)),{kind:"constant",configDependencies:new Set,evaluate:()=>B}}})(a===void 0?t.specification.default:a,t.specification,u,d,_)}isDataDriven(){return this.expression.kind==="source"||this.expression.kind==="composite"}possiblyEvaluate(t,a,u,d){return this.property.possiblyEvaluate(this,t,a,u,d)}}class gp{constructor(t,a,u,d){this.property=t,this.value=new pu(t,void 0,a,u,d)}transitioned(t,a){return new Ec(this.property,this.value,a,Object.assign({},t.transition,this.transition),t.now)}untransitioned(){return new Ec(this.property,this.value,null,{},0)}}class Mm{constructor(t,a,u,d){this._properties=t,this._values=Object.create(t.defaultTransitionablePropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=d,this.configDependencies=new Set}getValue(t){return qr(this._values[t].value.value)}setValue(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new gp(this._values[t].property,this._scope,this._options,this._iconImageUseTheme)),this._values[t].value=new pu(this._values[t].property,a===null?void 0:qr(a),this._scope,this._options,this._iconImageUseTheme),this._values[t].value.expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].value.expression.configDependencies]))}setTransitionOrValue(t,a){a&&(this._options=a);const u=this._properties.properties;if(t)for(const d in t){const _=t[d];if(d.endsWith("-transition")){const v=d.slice(0,-11);u[v]&&this.setTransition(v,_)}else u.hasOwnProperty(d)&&this.setValue(d,_)}}getTransition(t){return qr(this._values[t].transition)}setTransition(t,a){this._values.hasOwnProperty(t)||(this._values[t]=new gp(this._values[t].property)),this._values[t].transition=qr(a)||void 0}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(t[a]=u);const d=this.getTransition(a);d!==void 0&&(t[`${a}-transition`]=d)}return t}transitioned(t,a){const u=new _p(this._properties);for(const d of Object.keys(this._values))u._values[d]=this._values[d].transitioned(t,a._values[d]);return u}untransitioned(){const t=new _p(this._properties);for(const a of Object.keys(this._values))t._values[a]=this._values[a].untransitioned();return t}}class Ec{constructor(t,a,u,d,_){const v=d.delay||0,S=d.duration||0;_=_||0,this.property=t,this.value=a,this.begin=_+v,this.end=this.begin+S,t.specification.transition&&(d.delay||d.duration)&&(this.prior=u)}possiblyEvaluate(t,a,u){const d=t.now||0,_=this.value.possiblyEvaluate(t,a,u),v=this.prior;if(v){if(d>this.end)return this.prior=null,_;if(this.value.isDataDriven())return this.prior=null,_;if(d<this.begin)return v.possiblyEvaluate(t,a,u);{const S=(d-this.begin)/(this.end-this.begin);return this.property.interpolate(v.possiblyEvaluate(t,a,u),_,me(S))}}return _}}class _p{constructor(t){this._properties=t,this._values=Object.create(t.defaultTransitioningPropertyValues)}possiblyEvaluate(t,a,u){const d=new mu(this._properties);for(const _ of Object.keys(this._values))d._values[_]=this._values[_].possiblyEvaluate(t,a,u);return d}hasTransition(){for(const t of Object.keys(this._values))if(this._values[t].prior)return!0;return!1}}class Ds{constructor(t,a,u,d){this._properties=t,this._values=Object.create(t.defaultPropertyValues),this._scope=a,this._options=u,this._iconImageUseTheme=d,this.configDependencies=new Set}getValue(t){return qr(this._values[t].value)}setValue(t,a){this._values[t]=new pu(this._values[t].property,a===null?void 0:qr(a),this._scope,this._options,this._iconImageUseTheme),this._values[t].expression.configDependencies&&(this.configDependencies=new Set([...this.configDependencies,...this._values[t].expression.configDependencies]))}serialize(){const t={};for(const a of Object.keys(this._values)){const u=this.getValue(a);u!==void 0&&(t[a]=u)}return t}possiblyEvaluate(t,a,u,d){const _=new mu(this._properties);for(const v of Object.keys(this._values))_._values[v]=this._values[v].possiblyEvaluate(t,a,u,d);return _}}class Ol{constructor(t,a,u,d){this.property=t,this.value=a,this.parameters=u,this.iconImageUseTheme=d}isConstant(){return this.value.kind==="constant"}constantOr(t){return this.value.kind==="constant"?this.value.value:t}evaluate(t,a,u,d){return this.property.evaluate(this.value,this.parameters,t,a,u,d,this.iconImageUseTheme)}}class mu{constructor(t){this._properties=t,this._values=Object.create(t.defaultPossiblyEvaluatedValues)}get(t){return this._values[t]}}class At{constructor(t){this.specification=t}possiblyEvaluate(t,a){return t.expression.evaluate(a)}interpolate(t,a,u){const d=is[this.specification.type];return d?d(t,a,u):t}}class Ut{constructor(t,a){this.specification=t,this.overrides=a}possiblyEvaluate(t,a,u,d,_){return t.expression.kind==="constant"||t.expression.kind==="camera"?new Ol(this,{kind:"constant",value:t.expression.evaluate(a,null,{},u,d,void 0,_)},a):new Ol(this,t.expression,a,_)}interpolate(t,a,u){if(t.value.kind!=="constant"||a.value.kind!=="constant")return t;if(t.value.value===void 0||a.value.value===void 0)return new Ol(this,{kind:"constant",value:void 0},t.parameters);const d=is[this.specification.type];return d?new Ol(this,{kind:"constant",value:d(t.value.value,a.value.value,u)},t.parameters):t}evaluate(t,a,u,d,_,v,S){return t.kind==="constant"?t.value:t.evaluate(a,u,d,_,v,void 0,S)}}class lh{constructor(t){this.specification=t}possiblyEvaluate(t,a,u,d){return!!t.expression.evaluate(a,null,{},u,d)}interpolate(){return!1}}class yn{constructor(t){this.properties=t,this.defaultPropertyValues={},this.defaultTransitionablePropertyValues={},this.defaultTransitioningPropertyValues={},this.defaultPossiblyEvaluatedValues={},this.overridableProperties=[];const a=new Hi(0,{});for(const u in t){const d=t[u];d.specification.overridable&&this.overridableProperties.push(u);const _=this.defaultPropertyValues[u]=new pu(d,void 0),v=this.defaultTransitionablePropertyValues[u]=new gp(d);this.defaultTransitioningPropertyValues[u]=v.untransitioned(),this.defaultPossiblyEvaluatedValues[u]=_.possiblyEvaluate(a)}}}$t(Ut,"DataDrivenProperty"),$t(At,"DataConstantProperty"),$t(lh,"ColorRampProperty");var Ve=JSON.parse('{"$version":8,"$root":{"version":{"type":"enum","values":[8]},"fragment":{"type":"boolean"},"name":{"type":"string"},"metadata":{"type":"*"},"center":{"type":"array","value":"number"},"zoom":{"type":"number"},"bearing":{"type":"number","default":0,"period":360},"pitch":{"type":"number","default":0},"light":{"type":"light"},"lights":{"type":"array","value":"light-3d"},"terrain":{"type":"terrain","optional":true},"fog":{"type":"fog"},"snow":{"type":"snow"},"rain":{"type":"rain"},"camera":{"type":"camera"},"color-theme":{"type":"colorTheme"},"indoor":{"type":"indoor"},"imports":{"type":"array","value":"import"},"iconsets":{"type":"iconsets"},"schema":{"type":"schema"},"sources":{"type":"sources"},"sprite":{"type":"string"},"glyphs":{"type":"string","default":"mapbox://fonts/mapbox/{fontstack}/{range}.pbf"},"transition":{"type":"transition"},"projection":{"type":"projection"},"layers":{"type":"array","value":"layer"},"models":{"type":"models"},"featuresets":{"type":"featuresets"}},"featuresets":{"*":{"type":"featureset"}},"featureset":{"metadata":{"type":"*"},"selectors":{"type":"array","value":"selector"}},"selector":{"layer":{"type":"string"},"properties":{"type":"selectorProperty"},"featureNamespace":{"type":"string"},"_uniqueFeatureID":{"type":"boolean"}},"selectorProperty":{"*":{"type":"*"}},"model":{"type":"string"},"import":{"id":{"type":"string"},"url":{"type":"string"},"config":{"type":"config"},"data":{"type":"$root"},"color-theme":{"type":"colorTheme","optional":true}},"config":{"*":{"type":"*"}},"schema":{"*":{"type":"option"}},"option":{"default":{"type":"*","expression":{}},"type":{"type":"enum","values":{"string":1,"number":1,"boolean":1,"color":1}},"array":{"type":"boolean"},"minValue":{"type":"number"},"maxValue":{"type":"number"},"stepValue":{"type":"number"},"values":{"type":"array","value":"*"},"metadata":{"type":"*"}},"models":{"*":{"type":"model"}},"light-3d":{"id":{"type":"string"},"properties":{"type":"properties"},"type":{"type":"enum","values":{"ambient":{},"directional":{},"flat":{}}}},"properties":["properties_light_directional","properties_light_ambient","properties_light_flat"],"properties_light_directional":{"direction":{"type":"array","default":[210,30],"minimum":[0,0],"maximum":[360,90],"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"cast-shadows":{"type":"boolean","default":false},"shadow-quality":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"parameters":["zoom"]}},"shadow-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_ambient":{"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"properties_light_flat":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"iconsets":{"*":{"type":"iconset"}},"iconset":["iconset_sprite","iconset_source"],"iconset_sprite":{"type":{"type":"enum","values":{"sprite":1}},"url":{"type":"string"}},"iconset_source":{"type":{"type":"enum","values":{"source":1}},"source":{"type":"string"}},"sources":{"*":{"type":"source"}},"source":["source_vector","source_raster","source_raster_dem","source_raster_array","source_geojson","source_video","source_image","source_model"],"source_vector":{"type":{"type":"enum","values":{"vector":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"attribution":{"type":"string"},"promoteId":{"type":"promoteId"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster":{"type":{"type":"enum","values":{"raster":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"scheme":{"type":"enum","values":{"xyz":1,"tms":1},"default":"xyz"},"attribution":{"type":"string"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_dem":{"type":{"type":"enum","values":{"raster-dem":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"encoding":{"type":"enum","values":{"terrarium":1,"mapbox":1},"default":"mapbox"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_raster_array":{"type":{"type":"enum","values":{"raster-array":1}},"url":{"type":"string"},"tiles":{"type":"array","value":"string"},"bounds":{"type":"array","value":"number","length":4,"default":[-180,-85.051129,180,85.051129]},"extra_bounds":{"type":"array","value":{"type":"array","value":"number","length":4}},"minzoom":{"type":"number","default":0},"maxzoom":{"type":"number","default":22},"tileSize":{"type":"number","default":512},"attribution":{"type":"string"},"rasterLayers":{"type":"*"},"volatile":{"type":"boolean","default":false},"*":{"type":"*"}},"source_geojson":{"type":{"type":"enum","values":{"geojson":1}},"data":{"type":"*"},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"attribution":{"type":"string"},"buffer":{"type":"number","default":128,"maximum":512,"minimum":0},"filter":{"type":"*"},"tolerance":{"type":"number","default":0.375},"cluster":{"type":"boolean","default":false},"clusterRadius":{"type":"number","default":50,"minimum":0},"clusterMaxZoom":{"type":"number"},"clusterMinPoints":{"type":"number"},"clusterProperties":{"type":"*"},"lineMetrics":{"type":"boolean","default":false},"generateId":{"type":"boolean","default":false},"promoteId":{"type":"promoteId"},"dynamic":{"type":"boolean","default":false}},"source_video":{"type":{"type":"enum","values":{"video":1}},"urls":{"type":"array","value":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"source_image":{"type":{"type":"enum","values":{"image":1}},"url":{"type":"string"},"coordinates":{"type":"array","length":4,"value":{"type":"array","length":2,"value":"number"}}},"modelNodeOverride":{"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360}},"modelNodeOverrides":{"*":{"type":"modelNodeOverride"}},"modelMaterialOverride":{"model-color":{"type":"color"},"model-color-mix-intensity":{"type":"number"},"model-opacity":{"type":"number"},"model-emissive-strength":{"type":"number"}},"modelMaterialOverrides":{"*":{"type":"modelMaterialOverride"}},"modelSourceModel":{"uri":{"type":"string"},"position":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[-180,-90],"maximum":[180,90]},"orientation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360},"nodeOverrides":{"type":"modelNodeOverrides"},"materialOverrides":{"type":"modelMaterialOverrides"},"nodeOverrideNames":{"type":"array","value":"string"},"materialOverrideNames":{"type":"array","value":"string"},"featureProperties":{"type":"*"}},"modelSourceModels":{"*":{"type":"modelSourceModel"}},"source_model":{"type":{"type":"enum","values":{"model":1,"batched-model":1}},"maxzoom":{"type":"number","default":18},"minzoom":{"type":"number","default":0},"tiles":{"type":"array","value":"string"},"models":{"type":"modelSourceModels"}},"layer":{"id":{"type":"string"},"type":{"type":"enum","values":{"fill":{},"line":{},"symbol":{},"circle":{},"heatmap":{},"fill-extrusion":{},"building":{},"raster":{},"raster-particle":{},"hillshade":{},"model":{},"background":{},"sky":{},"slot":{},"clip":{}}},"metadata":{"type":"*"},"source":{"type":"string"},"source-layer":{"type":"string"},"slot":{"type":"string"},"minzoom":{"type":"number","minimum":0,"maximum":24},"maxzoom":{"type":"number","minimum":0,"maximum":24},"filter":{"type":"filter"},"layout":{"type":"layout"},"paint":{"type":"paint"},"appearances":{"type":"array","value":"appearance","supported-layer-types":["symbol"]}},"appearance":{"condition":{"type":"boolean","expression":{"parameters":["zoom","pitch","feature","feature-state","measure-light","distance-from-center"]},"property-type":"data-driven"},"name":{"type":"string"},"properties":{"type":"*"}},"layout":["layout_clip","layout_fill","layout_line","layout_circle","layout_heatmap","layout_fill-extrusion","layout_building","layout_symbol","layout_raster","layout_raster-particle","layout_hillshade","layout_background","layout_sky","layout_model"],"layout_background":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_sky":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_model":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"model-id":{"type":"string","default":"","property-type":"data-driven","expression":{"parameters":["zoom","feature"]}}},"layout_clip":{"clip-layer-types":{"type":"array","value":"enum","values":{"model":1,"symbol":1},"default":[],"expression":{}},"clip-layer-scope":{"type":"array","value":"string","default":[],"expression":{}}},"layout_fill":{"fill-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-base":1,"hd-road-markup":1},"default":"none","expression":{}},"fill-construct-bridge-guard-rail":{"type":"boolean","default":"true","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"}},"layout_circle":{"circle-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"circle-elevation-reference":{"type":"enum","values":{"none":1,"hd-road-markup":1},"default":"none","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_heatmap":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_fill-extrusion":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"fill-extrusion-edge-radius":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}}},"layout_building":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"building-facade":{"type":"boolean","default":false,"expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-facade-floors":{"type":"number","minimum":1,"maximum":200,"default":3,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-unit-width":{"type":"number","minimum":1,"maximum":20,"default":3.1,"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-facade-window":{"type":"array","length":2,"value":"number","minimum":0.1,"maximum":1,"default":[0.9,0.9],"property-type":"data-driven","expression":{"parameters":["feature"]}},"building-roof-shape":{"type":"enum","values":{"flat":1,"hipped":1,"gabled":1,"parapet":1,"mansard":1,"skillion":1,"pyramidal":1},"default":"flat","expression":{"parameters":["feature"]},"property-type":"data-driven"},"building-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{},"property-type":"data-driven"},"building-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"building-flip-roof-orientation":{"property-type":"data-driven","type":"boolean","default":false,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}}},"layout_line":{"line-cap":{"type":"enum","values":{"butt":1,"round":1,"square":1},"default":"butt","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-join":{"type":"enum","values":{"bevel":1,"round":1,"miter":1,"none":1},"default":"miter","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-miter-limit":{"type":"number","default":2,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-round-limit":{"type":"number","default":1.05,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-z-offset":{"type":"number","default":0,"expression":{"parameters":["zoom","feature","line-progress"]},"property-type":"data-driven"},"line-elevation-reference":{"type":"enum","values":{"none":1,"sea":1,"ground":1,"hd-road-markup":1},"default":"none","expression":{}},"line-cross-slope":{"type":"number","expression":{}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}},"line-width-unit":{"type":"enum","values":{"pixels":1,"meters":1},"default":"pixels","expression":{"parameters":["zoom"]}}},"layout_symbol":{"symbol-placement":{"type":"enum","values":{"point":1,"line":1,"line-center":1},"default":"point","expression":{"parameters":["zoom"]}},"symbol-spacing":{"type":"number","default":250,"minimum":1,"expression":{"interpolated":true,"parameters":["zoom"]}},"symbol-avoid-edges":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-sort-key":{"type":"number","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"symbol-z-order":{"type":"enum","values":{"auto":1,"viewport-y":1,"source":1},"default":"auto","expression":{"parameters":["zoom"]}},"symbol-z-elevate":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"symbol-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{"parameters":["zoom"]}},"icon-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"icon-size":{"type":"number","default":1,"minimum":0,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"icon-text-fit":{"type":"enum","values":{"none":1,"width":1,"height":1,"both":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-text-fit-padding":{"type":"array","value":"number","length":4,"default":[0,0,0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-image":{"type":"resolvedImage","tokens":true,"appearance":true,"use-theme":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-rotate":{"type":"number","default":0,"period":360,"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-keep-upright":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"icon-offset":{"type":"array","value":"number","length":2,"default":[0,0],"appearance":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"icon-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-rotation-alignment":{"type":"enum","values":{"map":1,"viewport":1,"auto":1},"default":"auto","expression":{"parameters":["zoom"]}},"text-field":{"type":"formatted","default":"","tokens":true,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-font":{"type":"array","value":"string","default":["Open Sans Regular","Arial Unicode MS Regular"],"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size":{"type":"number","default":16,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-size-scale-range":{"type":"array","value":"number","length":2,"default":[0.8,2],"minimum":0.1,"maximum":10,"expression":{}},"text-max-width":{"type":"number","default":10,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-line-height":{"type":"number","default":1.2,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-letter-spacing":{"type":"number","default":0,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-justify":{"type":"enum","values":{"auto":1,"left":1,"center":1,"right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-radial-offset":{"type":"number","default":0,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["zoom","feature"]}},"text-variable-anchor":{"type":"array","value":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"expression":{"parameters":["zoom"]}},"text-anchor":{"type":"enum","values":{"center":1,"left":1,"right":1,"top":1,"bottom":1,"top-left":1,"top-right":1,"bottom-left":1,"bottom-right":1},"default":"center","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-max-angle":{"type":"number","default":45,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-writing-mode":{"type":"array","value":"enum","values":{"horizontal":1,"vertical":1},"expression":{"parameters":["zoom"]}},"text-rotate":{"type":"number","default":0,"period":360,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-padding":{"type":"number","default":2,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-keep-upright":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"text-transform":{"type":"enum","values":{"none":1,"uppercase":1,"lowercase":1},"default":"none","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-offset":{"type":"array","value":"number","length":2,"default":[0,0],"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"text-allow-overlap":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-ignore-placement":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"text-optional":{"type":"boolean","default":false,"expression":{"parameters":["zoom"]}},"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_raster-particle":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"layout_hillshade":{"visibility":{"type":"enum","values":{"visible":1,"none":1},"default":"visible","expression":{}}},"filter":{"type":"array","value":"*"},"filter_symbol":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature","pitch","distance-from-center"]}},"filter_fill":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_hillshade":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_raster-particle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_clip":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_model":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_line":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_circle":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_fill-extrusion":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_building":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_heatmap":{"type":"boolean","default":false,"property-type":"data-driven","expression":{"parameters":["zoom","feature"]}},"filter_operator":{"type":"enum","values":{"==":1,"!=":1,">":1,">=":1,"<":1,"<=":1,"in":1,"!in":1,"all":1,"any":1,"none":1,"has":1,"!has":1}},"geometry_type":{"type":"enum","values":{"Point":1,"LineString":1,"Polygon":1}},"function":{"expression":{"type":"expression"},"stops":{"type":"array","value":"function_stop"},"base":{"type":"number","default":1,"minimum":0},"property":{"type":"string","default":"$zoom"},"type":{"type":"enum","values":{"identity":1,"exponential":1,"interval":1,"categorical":1},"default":"exponential"},"colorSpace":{"type":"enum","values":{"rgb":1,"lab":1,"hcl":1},"default":"rgb"},"default":{"type":"*"}},"function_stop":{"type":"array","minimum":0,"maximum":24,"value":["number","color"],"length":2},"expression":{"type":"array","value":"*","minimum":1},"fog":{"range":{"type":"array","default":[0.5,10],"minimum":-20,"maximum":20,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"high-color":{"type":"color","default":"#245cdf","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"space-color":{"type":"color","default":["interpolate",["linear"],["zoom"],4,"#010b19",7,"#367ab9"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"horizon-blend":{"type":"number","default":["interpolate",["linear"],["zoom"],4,0.2,7,0.1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"star-intensity":{"type":"number","default":["interpolate",["linear"],["zoom"],5,0.35,6,0],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vertical-range":{"type":"array","default":[0,0],"minimum":0,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}}},"snow":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.85],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.3],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.4,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,50],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"flake-size":{"type":"number","default":0.71,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"rain":{"density":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,0.5],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#03113d",0.3,"#a8adbc"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"opacity":{"type":"number","default":["interpolate",["linear"],["measure-light","brightness"],0,0.88,1,0.7],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette":{"type":"number","default":["interpolate",["linear"],["zoom"],11,0,13,1],"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"vignette-color":{"type":"color","default":["interpolate",["linear"],["measure-light","brightness"],0,"#001736",0.3,"#464646"],"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"use-theme":true,"transition":true},"center-thinning":{"type":"number","default":0.57,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true},"direction":{"type":"array","default":[0,80],"minimum":0,"maximum":360,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"droplet-size":{"type":"array","default":[2.6,18.2],"minimum":0,"maximum":50,"length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true}},"distortion-strength":{"type":"number","default":0.7,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"],"relaxZoomRestriction":true},"transition":true}},"camera":{"camera-projection":{"type":"enum","values":{"perspective":1,"orthographic":1},"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]},"default":"perspective"}},"colorTheme":{"data":{"type":"string","expression":{}}},"indoor":{"floorplanFeaturesetId":{"type":"string","expression":{}},"buildingFeaturesetId":{"type":"string","expression":{}}},"light":{"anchor":{"type":"enum","default":"viewport","values":{"map":1,"viewport":1},"expression":{"parameters":["zoom"]}},"position":{"type":"array","default":[1.15,210,30],"length":3,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"color":{"type":"color","default":"#ffffff","expression":{"interpolated":true,"parameters":["zoom"]},"use-theme":true,"transition":true},"intensity":{"type":"number","default":0.5,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"projection":{"name":{"type":"enum","values":{"albers":1,"equalEarth":1,"equirectangular":1,"lambertConformalConic":1,"mercator":1,"naturalEarth":1,"winkelTripel":1,"globe":1},"default":"mercator"},"center":{"type":"array","length":2,"value":"number","minimum":[-180,-90],"maximum":[180,90]},"parallels":{"type":"array","length":2,"value":"number","minimum":[-90,-90],"maximum":[90,90]}},"terrain":{"source":{"type":"string"},"exaggeration":{"type":"number","default":1,"minimum":0,"maximum":1000,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint":["paint_fill","paint_line","paint_circle","paint_heatmap","paint_fill-extrusion","paint_building","paint_symbol","paint_raster","paint_raster-particle","paint_hillshade","paint_background","paint_sky","paint_model"],"paint_fill":{"fill-antialias":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-outline-color":{"type":"color","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-bridge-guard-rail-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"},"fill-tunnel-structure-color":{"type":"color","default":"rgba(241, 236, 225, 255)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature"]},"property-type":"data-driven"}},"paint_fill-extrusion":{"fill-extrusion-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"fill-extrusion-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"fill-extrusion-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-height":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-base":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"fill-extrusion-height-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"flat"},"fill-extrusion-base-alignment":{"type":"enum","values":{"terrain":1,"flat":1},"default":"terrain"},"fill-extrusion-vertical-gradient":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-wall-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"fill-extrusion-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"fill-extrusion-flood-light-wall-radius":{"property-type":"data-driven","type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-radius":{"property-type":"data-driven","type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state"]}},"fill-extrusion-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"fill-extrusion-rounded-roof":{"type":"boolean","default":true,"expression":{"parameters":["zoom"]}},"fill-extrusion-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"fill-extrusion-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"fill-extrusion-line-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"fill-extrusion-cast-shadows":{"type":"boolean","default":true}},"paint_building":{"building-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-ambient-occlusion-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"parameters":[]},"transition":true},"building-ambient-occlusion-ground-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-radius":{"type":"number","default":3,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"building-ambient-occlusion-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-vertical-scale":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"building-cast-shadows":{"type":"boolean","default":true},"building-color":{"type":"color","default":"rgba(193, 154, 127, 1)","use-theme":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-emissive-strength":{"type":"number","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"property-type":"data-driven"},"building-facade-emissive-chance":{"type":"number","default":0.35,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["measure-light","zoom"]}},"building-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"building-flood-light-color":{"type":"color","default":"#ffffff","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-intensity":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"building-flood-light-ground-attenuation":{"type":"number","default":0.69,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_line":{"line-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"line-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"line-width":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light","line-progress"]},"property-type":"data-driven"},"line-gap-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-offset":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"line-dasharray":{"type":"array","value":"number","minimum":0,"expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom","feature"]},"property-type":"data-driven"},"line-pattern-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-gradient":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["line-progress"]}},"line-trim-offset":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1]},"line-trim-fade-range":{"type":"array","value":"number","length":2,"default":[0,0],"minimum":[0,0],"maximum":[1,1],"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-trim-color":{"type":"color","default":"transparent","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"line-border-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-border-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state"]},"property-type":"data-driven"},"line-occlusion-opacity":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true}},"paint_circle":{"circle-radius":{"type":"number","default":5,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-blur":{"type":"number","default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"circle-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-scale":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"circle-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"circle-stroke-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-stroke-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"circle-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_heatmap":{"heatmap-radius":{"type":"number","default":30,"minimum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-weight":{"type":"number","default":1,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"heatmap-intensity":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"heatmap-color":{"type":"color","default":["interpolate",["linear"],["heatmap-density"],0,"rgba(0, 0, 255, 0)",0.1,"royalblue",0.3,"cyan",0.5,"lime",0.7,"yellow",1,"red"],"use-theme":true,"expression":{"interpolated":true,"parameters":["heatmap-density"]}},"heatmap-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_symbol":{"icon-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"text-emissive-strength":{"type":"number","default":1,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light","feature-state"]},"property-type":"data-driven"},"icon-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"icon-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"icon-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-image-cross-fade":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"text-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-occlusion-opacity":{"type":"number","minimum":0,"maximum":1,"default":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"overridable":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-color":{"type":"color","default":"rgba(0, 0, 0, 0)","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-width":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-halo-blur":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature","feature-state","measure-light"]},"property-type":"data-driven"},"text-translate":{"type":"array","value":"number","length":2,"default":[0,0],"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"text-translate-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":["zoom"]}},"icon-color-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"expression":{}},"icon-color-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"icon-color-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{}},"symbol-z-offset":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","feature"]},"property-type":"data-driven"}},"paint_raster":{"raster-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-value"]}},"raster-color-mix":{"type":"array","default":[0.2126,0.7152,0.0722,0],"length":4,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-color-range":{"type":"array","length":2,"value":"number","transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-hue-rotate":{"type":"number","default":0,"period":360,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-min":{"type":"number","default":0,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-brightness-max":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-saturation":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-contrast":{"type":"number","default":0,"minimum":-1,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-resampling":{"type":"enum","values":{"linear":1,"nearest":1},"default":"linear","expression":{"parameters":["zoom"]}},"raster-fade-duration":{"type":"number","default":300,"minimum":0,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"raster-array-band":{"type":"string"},"raster-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_raster-particle":{"raster-particle-array-band":{"type":"string"},"raster-particle-count":{"type":"number","default":512,"minimum":1},"raster-particle-color":{"type":"color","use-theme":true,"expression":{"interpolated":true,"parameters":["raster-particle-speed"]}},"raster-particle-max-speed":{"type":"number","default":1,"minimum":1},"raster-particle-speed-factor":{"type":"number","default":0.2,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-fade-opacity-factor":{"type":"number","default":0.98,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"raster-particle-reset-rate-factor":{"type":"number","default":0.8,"minimum":0,"maximum":1},"raster-particle-elevation":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_hillshade":{"hillshade-illumination-direction":{"type":"number","default":335,"minimum":0,"maximum":359,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-illumination-anchor":{"type":"enum","values":{"map":1,"viewport":1},"default":"viewport","expression":{"parameters":["zoom"]}},"hillshade-exaggeration":{"type":"number","default":0.5,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"hillshade-shadow-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-highlight-color":{"type":"color","default":"#FFFFFF","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-accent-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}},"hillshade-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_background":{"background-pitch-alignment":{"type":"enum","values":{"map":1,"viewport":1},"default":"map","expression":{"parameters":[]}},"background-color":{"type":"color","default":"#000000","use-theme":true,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-pattern":{"type":"resolvedImage","expression":{"parameters":["zoom"]}},"background-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}},"background-emissive-strength":{"type":"number","default":0,"minimum":0,"transition":true,"expression":{"interpolated":true,"parameters":["zoom","measure-light"]}}},"paint_sky":{"sky-type":{"type":"enum","values":{"gradient":1,"atmosphere":1},"default":"atmosphere","expression":{"parameters":["zoom"]}},"sky-atmosphere-sun":{"type":"array","value":"number","length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-atmosphere-sun-intensity":{"type":"number","default":10,"minimum":0,"maximum":100},"sky-gradient-center":{"type":"array","value":"number","default":[0,0],"length":2,"minimum":[0,0],"maximum":[360,180],"expression":{"parameters":["zoom"]}},"sky-gradient-radius":{"type":"number","default":90,"minimum":0,"maximum":180,"expression":{"parameters":["zoom"]}},"sky-gradient":{"type":"color","default":["interpolate",["linear"],["sky-radial-progress"],0.8,"#87ceeb",1,"white"],"use-theme":true,"expression":{"interpolated":true,"parameters":["sky-radial-progress"]}},"sky-atmosphere-halo-color":{"type":"color","default":"white","use-theme":true},"sky-atmosphere-color":{"type":"color","default":"white","use-theme":true},"sky-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["zoom"]}}},"paint_model":{"model-opacity":{"type":"number","default":1,"minimum":0,"maximum":1,"transition":true,"expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"property-type":"data-driven"},"model-rotation":{"type":"array","value":"number","length":3,"default":[0,0,0],"period":360,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-scale":{"type":"array","value":"number","length":3,"default":[1,1,1],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-translation":{"type":"array","value":"number","length":3,"default":[0,0,0],"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","zoom"]},"transition":true},"model-color":{"type":"color","default":"#ffffff","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light","zoom"]},"use-theme":true,"transition":true},"model-color-mix-intensity":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-type":{"type":"enum","values":{"common-3d":1,"location-indicator":1},"default":"common-3d"},"model-cast-shadows":{"type":"boolean","default":true},"model-receive-shadows":{"type":"boolean","default":true},"model-ambient-occlusion-intensity":{"type":"number","default":1,"minimum":0,"maximum":1,"expression":{"interpolated":true,"parameters":["zoom"]},"transition":true},"model-emissive-strength":{"type":"number","property-type":"data-driven","default":0,"minimum":0,"maximum":5,"expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-roughness":{"type":"number","default":1,"minimum":0,"maximum":1,"property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state"]},"transition":true},"model-height-based-emissive-strength-multiplier":{"type":"array","default":[1,1,1,1,0],"length":5,"value":"number","property-type":"data-driven","expression":{"interpolated":true,"parameters":["feature","feature-state","measure-light"]},"transition":true},"model-cutoff-fade-range":{"type":"number","default":0,"minimum":0,"maximum":1,"expression":{}},"model-front-cutoff":{"type":"array","value":"number","expression":{"interpolated":true,"parameters":["zoom"]},"length":3,"default":[0,0,1],"minimum":[0,0,0],"maximum":[1,1,1]},"model-elevation-reference":{"type":"enum","values":{"sea":1,"ground":1,"hd-road-markup":1},"default":"ground","expression":{}}},"transition":{"duration":{"type":"number","default":300,"minimum":0},"delay":{"type":"number","default":0,"minimum":0}},"promoteId":{"*":{"type":"*"}}}');function cd(s){return s instanceof Number||s instanceof String||s instanceof Boolean?s.valueOf():s}function gu(s){if(Array.isArray(s))return s.map(gu);if(s instanceof Object&&!(s instanceof Number||s instanceof String||s instanceof Boolean)){const t={};for(const a in s)t[a]=gu(s[a]);return t}return cd(s)}function ud(s){if(s===!0||s===!1)return!0;if(!Array.isArray(s)||s.length===0)return!1;switch(s[0]){case"has":return s.length>=2&&s[1]!=="$id"&&s[1]!=="$type";case"in":return s.length>=3&&(typeof s[1]!="string"||Array.isArray(s[2]));case"!in":case"!has":case"none":return!1;case"==":case"!=":case">":case">=":case"<":case"<=":return s.length!==3||Array.isArray(s[1])||Array.isArray(s[2]);case"any":case"all":for(const t of s.slice(1))if(!ud(t)&&typeof t!="boolean")return!1;return!0;default:return!0}}function ch(s,t="",a=null,u="fill"){if(s==null)return{filter:()=>!0,needGeometry:!1,needFeature:!1};ud(s)||(s=rf(s));const d=s;let _=!0;try{_=(function(P){if(!_u(P))return P;let B=gu(P);return Os(B),B=Dm(B),B})(d)}catch{console.warn(`Failed to extract static filter. Filter will continue working, but at higher memory usage and slower framerate.
This is most likely a bug, please report this via https://github.com/mapbox/mapbox-gl-js/issues/new?assignees=&labels=&template=Bug_report.md
and paste the contents of this message in the report.
Thank you!
Filter Expression:
${JSON.stringify(d,null,2)}
        `)}let v=null,S=null;if(u!=="background"&&u!=="sky"&&u!=="slot"){S=Ve[`filter_${u}`];const P=qa(_,S,t,a);if(P.result==="error")throw new Error(P.value.map((B=>`${B.key}: ${B.message}`)).join(", "));v=(B,F,j)=>P.value.evaluate(B,F,{},j)}let E=null,R=null;if(_!==d){const P=qa(d,S,t,a);if(P.result==="error")throw new Error(P.value.map((B=>`${B.key}: ${B.message}`)).join(", "));E=(B,F,j,G,Q)=>P.value.evaluate(B,F,{},j,void 0,void 0,G,Q),R=!Nn(P.value.expression)}return{filter:v,dynamicFilter:E||void 0,needGeometry:kg(_),needFeature:!!R}}function Dm(s){if(!Array.isArray(s))return s;const t=(function(a){if(Om.has(a[0])){for(let u=1;u<a.length;u++)if(_u(a[u]))return!0}return a})(s);return t===!0?t:t.map((a=>Dm(a)))}function Os(s){let t=!1;const a=[];if(s[0]==="case"){for(let u=1;u<s.length-1;u+=2)t=t||_u(s[u]),a.push(s[u+1]);a.push(s[s.length-1])}else if(s[0]==="match"){t=t||_u(s[1]);for(let u=2;u<s.length-1;u+=2)a.push(s[u+1]);a.push(s[s.length-1])}else if(s[0]==="step"){t=t||_u(s[1]);for(let u=1;u<s.length-1;u+=2)a.push(s[u+1])}t&&(s.length=0,s.push("any",...a));for(let u=1;u<s.length;u++)Os(s[u])}function _u(s){if(!Array.isArray(s))return!1;if((t=s[0])==="pitch"||t==="distance-from-center")return!0;var t;for(let a=1;a<s.length;a++)if(_u(s[a]))return!0;return!1}const Om=new Set(["in","==","!=",">",">=","<","<=","to-boolean"]);function Fg(s,t){return s<t?-1:s>t?1:0}function kg(s){if(!Array.isArray(s))return!1;if(s[0]==="within"||s[0]==="distance")return!0;for(let t=1;t<s.length;t++)if(kg(s[t]))return!0;return!1}function rf(s){if(!s)return!0;const t=s[0];return s.length<=1?t!=="any":t==="=="?yp(s[1],s[2],"=="):t==="!="?hd(yp(s[1],s[2],"==")):t==="<"||t===">"||t==="<="||t===">="?yp(s[1],s[2],t):t==="any"?(a=s.slice(1),["any"].concat(a.map(rf))):t==="all"?["all"].concat(s.slice(1).map(rf)):t==="none"?["all"].concat(s.slice(1).map(rf).map(hd)):t==="in"?Pm(s[1],s.slice(2)):t==="!in"?hd(Pm(s[1],s.slice(2))):t==="has"?vp(s[1]):t!=="!has"||hd(vp(s[1]));var a}function yp(s,t,a){switch(s){case"$type":return[`filter-type-${a}`,t];case"$id":return[`filter-id-${a}`,t];default:return[`filter-${a}`,s,t]}}function Pm(s,t){if(t.length===0)return!1;switch(s){case"$type":return["filter-type-in",["literal",t]];case"$id":return["filter-id-in",["literal",t]];default:return t.length>200&&!t.some((a=>typeof a!=typeof t[0]))?["filter-in-large",s,["literal",t.sort(Fg)]]:["filter-in-small",s,["literal",t]]}}function vp(s){switch(s){case"$type":return!0;case"$id":return["filter-has-id"];default:return["filter-has",s]}}function hd(s){return["!",s]}const nf="";function of(s,t){return t?`${s}${nf}${t}`:s}let Lm;const Bm=()=>Lm||(Lm=new yn({"icon-size":new Ut(Ve.layout_symbol["icon-size"]),"icon-image":new Ut(Ve.layout_symbol["icon-image"]),"icon-rotate":new Ut(Ve.layout_symbol["icon-rotate"]),"icon-offset":new Ut(Ve.layout_symbol["icon-offset"])}));class fd{constructor(t,a,u,d,_,v){const S=qa(t,Ve.appearance.condition);if(S.result==="success"&&(this.condition=S.value),this.name=a,u){this.properties=new mu(Bm()),this.unevaluatedLayout=new Ds(Bm(),d,_,v);for(const E in u)this.unevaluatedLayout.setValue(E,u[E])}}isActive(t){return!(this.condition||!t.isHidden||this.name!=="hidden")||this.condition.evaluate(t.globals,t.feature,t.featureState,t.canonical)}getCondition(){return this.condition}getName(){return this.name}getProperty(t){return this.properties.get(t)}getUnevaluatedProperties(){return this.unevaluatedLayout}serialize(){const t={};return t.condition=this.condition.expression.serialize(),this.name&&(t.name=this.name),this.properties&&(t.properties=this.properties),t}}const xp="-transition",dd=new Set(["fill","line","background","hillshade","raster"]);class Go extends Hu{constructor(t,a,u,d,_,v){if(super(),this.id=t.id,this.fqid=of(this.id,u),this.type=t.type,this.scope=u,this.lut=d,this.options=_,this.iconImageUseTheme=v,this.appearances=new Array,this._featureFilter={filter:()=>!0,needGeometry:!1,needFeature:!1},this._filterCompiled=!1,this.configDependencies=new Set,t.type!=="custom"){if(this.metadata=t.metadata,this.minzoom=t.minzoom,this.maxzoom=t.maxzoom,t.type&&t.type!=="background"&&t.type!=="sky"&&t.type!=="slot"){this.source=t.source,this.sourceLayer=t["source-layer"],this.filter=t.filter;const S=qa(this.filter,Ve[`filter_${t.type}`]);S.result!=="error"&&(this.configDependencies=new Set([...this.configDependencies,...S.value.configDependencies]))}if(t.slot&&(this.slot=t.slot),t.appearances&&t.appearances.forEach((S=>{this.appearances.push(new fd(S.condition,S.name,S.properties,this.scope,_,this.iconImageUseTheme))})),a.layout&&(this._unevaluatedLayout=new Ds(a.layout,this.scope,_,this.iconImageUseTheme),this.configDependencies=new Set([...this.configDependencies,...this._unevaluatedLayout.configDependencies])),a.paint){this._transitionablePaint=new Mm(a.paint,this.scope,_);for(const S in t.paint)this.setPaintProperty(S,t.paint[S]);for(const S in t.layout)this.setLayoutProperty(S,t.layout[S]);this.configDependencies=new Set([...this.configDependencies,...this._transitionablePaint.configDependencies]),this._transitioningPaint=this._transitionablePaint.untransitioned(),this.paint=new mu(a.paint)}}}onAdd(t){}onRemove(t){}isDraped(t){return!this.is3D(!0)&&dd.has(this.type)}getLayoutProperty(t){return t==="visibility"?this.visibility:this._unevaluatedLayout.getValue(t)}setLayoutProperty(t,a){if(this.type==="custom"&&t==="visibility")return void(this.visibility=a);const u=this._unevaluatedLayout;u._properties.properties[t]&&(u.setValue(t,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),t==="visibility"&&this.possiblyEvaluateVisibility())}possiblyEvaluateVisibility(){this._unevaluatedLayout._values.visibility&&(this.visibility=this._unevaluatedLayout._values.visibility.possiblyEvaluate({zoom:0}))}getPaintProperty(t){return t.endsWith(xp)?this._transitionablePaint.getTransition(t.slice(0,-11)):this._transitionablePaint.getValue(t)}setPaintProperty(t,a){const u=this._transitionablePaint,d=u._properties.properties;if(t.endsWith(xp)){const B=t.slice(0,-11);return d[B]&&u.setTransition(B,a||void 0),!1}if(!d[t])return!1;const _=u._values[t],v=_.value.isDataDriven(),S=_.value;u.setValue(t,a),this.configDependencies=new Set([...this.configDependencies,...u.configDependencies]),this._handleSpecialPaintPropertyUpdate(t);const E=u._values[t].value,R=E.isDataDriven(),P=t.endsWith("pattern")||t==="line-dasharray";return R||v||P||this._handleOverridablePaintPropertyUpdate(t,S,E)}_handleSpecialPaintPropertyUpdate(t){}getProgramIds(){return null}getDefaultProgramParams(t,a,u){return null}_handleOverridablePaintPropertyUpdate(t,a,u){return!1}isHidden(t){return!!(this.minzoom&&t<this.minzoom)||!!(this.maxzoom&&t>=this.maxzoom)||this.visibility==="none"}updateTransitions(t){this._transitioningPaint=this._transitionablePaint.transitioned(t,this._transitioningPaint)}hasTransition(){return this._transitioningPaint.hasTransition()}recalculate(t,a){this._unevaluatedLayout&&(this.layout=this._unevaluatedLayout.possiblyEvaluate(t,void 0,a,this.iconImageUseTheme)),this.paint=this._transitioningPaint.possiblyEvaluate(t,void 0,a)}serialize(){const t={id:this.id,type:this.type,slot:this.slot,source:this.source,"source-layer":this.sourceLayer,metadata:this.metadata,minzoom:this.minzoom,maxzoom:this.maxzoom,filter:this.filter,layout:this._unevaluatedLayout&&this._unevaluatedLayout.serialize(),paint:this._transitionablePaint&&this._transitionablePaint.serialize()};return this.appearances.length!==0&&(t.appearances=this.appearances.map((a=>a.serialize()))),Jr(t,((a,u)=>!(a===void 0||u==="layout"&&!Object.keys(a).length||u==="paint"&&!Object.keys(a).length)))}is3D(t){return!1}hasElevation(){return!1}isSky(){return!1}isTileClipped(){return!1}hasOffscreenPass(){return!1}hasShadowPass(){return!1}canCastShadows(){return!1}hasLightBeamPass(){return!1}cutoffRange(){return 0}tileCoverLift(){return 0}resize(){}_clear(){}isStateDependent(){for(const t in this.paint._values){const a=this.paint.get(t);if(a instanceof Ol&&rd(a.property.specification)&&(a.value.kind==="source"||a.value.kind==="composite")&&a.value.isStateDependent)return!0}return!1}compileFilter(t){this._filterCompiled||(this._featureFilter=ch(this.filter,this.scope,t),this._filterCompiled=!0)}invalidateCompiledFilter(){this._filterCompiled=!1}dynamicFilter(){return this._featureFilter.dynamicFilter}dynamicFilterNeedsFeature(){return this._featureFilter.needFeature}getLayerRenderingStats(){return this._stats}resetLayerRenderingStats(t){this._stats&&(t.renderPass==="shadow"?this._stats.numRenderedVerticesInShadowPass=0:this._stats.numRenderedVerticesInTransparentPass=0)}getAppearances(){return this.appearances}queryRadius(t){}queryIntersectsFeature(t,a,u,d,_,v,S,E,R){}}const Cc={Int8:Int8Array,Uint8:Uint8Array,Int16:Int16Array,Uint16:Uint16Array,Int32:Int32Array,Uint32:Uint32Array,Float32:Float32Array};class Ic{constructor(t,a){this._structArray=t,this._pos1=a*this.size,this._pos2=this._pos1/2,this._pos4=this._pos1/4,this._pos8=this._pos1/8}}class Yi{constructor(){this.capacity=-1,this.resize(0)}static serialize(t,a){return t._trim(),a&&a.add(t.arrayBuffer),{length:t.length,arrayBuffer:t.arrayBuffer}}static deserialize(t){const a=Object.create(this.prototype);return a.arrayBuffer=t.arrayBuffer,a.length=t.length,a.capacity=t.arrayBuffer.byteLength/a.bytesPerElement,a._refreshViews(),a}_trim(){this.length!==this.capacity&&(this.capacity=this.length,this.arrayBuffer=this.arrayBuffer.slice(0,this.length*this.bytesPerElement),this._refreshViews())}clear(){this.length=0}resize(t){this.reserve(t),this.length=t}reserve(t){if(t>this.capacity){this.capacity=Math.max(t,Math.floor(5*this.capacity),128),this.arrayBuffer=new ArrayBuffer(this.capacity*this.bytesPerElement);const a=this.uint8;this._refreshViews(),a&&this.uint8.set(a)}}_refreshViews(){throw new Error("StructArray#_refreshViews() must be implemented by each concrete StructArray layout")}emplace(...t){throw new Error("StructArray#emplace() must be implemented by each concrete StructArray layout")}emplaceBack(...t){throw new Error("StructArray#emplaceBack() must be implemented by each concrete StructArray layout")}destroy(){this.int8=this.uint8=this.int16=this.uint16=this.int32=this.uint32=this.float32=null,this.arrayBuffer=null}}function ei(s,t=1){let a=0,u=0;return{members:s.map((d=>{const _=Cc[d.type].BYTES_PER_ELEMENT,v=a=Ng(a,Math.max(t,_)),S=d.components||1;return u=Math.max(u,_),a+=_*S,{name:d.name,type:d.type,components:S,offset:v}})),size:Ng(a,Math.max(u,t)),alignment:t}}function Ng(s,t){return Math.ceil(s/t)*t}class ss extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.int16[d+0]=a,this.int16[d+1]=u,t}}ss.prototype.bytesPerElement=4,$t(ss,"StructArrayLayout2i4");class rl extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=3*t;return this.int16[_+0]=a,this.int16[_+1]=u,this.int16[_+2]=d,t}}rl.prototype.bytesPerElement=6,$t(rl,"StructArrayLayout3i6");class Pl extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const v=4*t;return this.int16[v+0]=a,this.int16[v+1]=u,this.int16[v+2]=d,this.int16[v+3]=_,t}}Pl.prototype.bytesPerElement=8,$t(Pl,"StructArrayLayout4i8");class Ps extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.float32[1*t+0]=a,t}}Ps.prototype.bytesPerElement=4,$t(Ps,"StructArrayLayout1f4");class af extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=4*t,v=2*t;return this.int16[_+0]=a,this.int16[_+1]=u,this.float32[v+1]=d,t}}af.prototype.bytesPerElement=8,$t(af,"StructArrayLayout2i1f8");class pd extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=4*t;return this.int16[_+0]=a,this.int16[_+1]=u,this.int16[_+2]=d,t}}pd.prototype.bytesPerElement=8,$t(pd,"StructArrayLayout3i8");class bp extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,u,d,_)}emplace(t,a,u,d,_,v){const S=5*t;return this.int16[S+0]=a,this.int16[S+1]=u,this.int16[S+2]=d,this.int16[S+3]=_,this.int16[S+4]=v,t}}bp.prototype.bytesPerElement=10,$t(bp,"StructArrayLayout5i10");class Rc extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,u,d,_,v,S)}emplace(t,a,u,d,_,v,S,E){const R=6*t,P=12*t,B=3*t;return this.int16[R+0]=a,this.int16[R+1]=u,this.uint8[P+4]=d,this.uint8[P+5]=_,this.uint8[P+6]=v,this.uint8[P+7]=S,this.float32[B+2]=E,t}}Rc.prototype.bytesPerElement=12,$t(Rc,"StructArrayLayout2i4ub1f12");class fa extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=3*t;return this.float32[_+0]=a,this.float32[_+1]=u,this.float32[_+2]=d,t}}fa.prototype.bytesPerElement=12,$t(fa,"StructArrayLayout3f12");class Po extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,u,d,_)}emplace(t,a,u,d,_,v){const S=6*t,E=3*t;return this.uint16[S+0]=a,this.uint16[S+1]=u,this.uint16[S+2]=d,this.uint16[S+3]=_,this.float32[E+2]=v,t}}Po.prototype.bytesPerElement=12,$t(Po,"StructArrayLayout4ui1f12");class Ea extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const v=4*t;return this.uint16[v+0]=a,this.uint16[v+1]=u,this.uint16[v+2]=d,this.uint16[v+3]=_,t}}Ea.prototype.bytesPerElement=8,$t(Ea,"StructArrayLayout4ui8");class il extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,v)}emplace(t,a,u,d,_,v,S){const E=6*t;return this.int16[E+0]=a,this.int16[E+1]=u,this.int16[E+2]=d,this.int16[E+3]=_,this.int16[E+4]=v,this.int16[E+5]=S,t}}il.prototype.bytesPerElement=12,$t(il,"StructArrayLayout6i12");class wp extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S,E,R,P,B,F){const j=this.length;return this.resize(j+1),this.emplace(j,t,a,u,d,_,v,S,E,R,P,B,F)}emplace(t,a,u,d,_,v,S,E,R,P,B,F,j){const G=12*t;return this.int16[G+0]=a,this.int16[G+1]=u,this.int16[G+2]=d,this.int16[G+3]=_,this.uint16[G+4]=v,this.uint16[G+5]=S,this.uint16[G+6]=E,this.uint16[G+7]=R,this.int16[G+8]=P,this.int16[G+9]=B,this.int16[G+10]=F,this.int16[G+11]=j,t}}wp.prototype.bytesPerElement=24,$t(wp,"StructArrayLayout4i4ui4i24");class Ll extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,v)}emplace(t,a,u,d,_,v,S){const E=10*t,R=5*t;return this.int16[E+0]=a,this.int16[E+1]=u,this.int16[E+2]=d,this.float32[R+2]=_,this.float32[R+3]=v,this.float32[R+4]=S,t}}Ll.prototype.bytesPerElement=20,$t(Ll,"StructArrayLayout3i3f20");class Lo extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const v=4*t;return this.float32[v+0]=a,this.float32[v+1]=u,this.float32[v+2]=d,this.float32[v+3]=_,t}}Lo.prototype.bytesPerElement=16,$t(Lo,"StructArrayLayout4f16");class no extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint32[1*t+0]=a,t}}no.prototype.bytesPerElement=4,$t(no,"StructArrayLayout1ul4");class Un extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.uint16[d+0]=a,this.uint16[d+1]=u,t}}Un.prototype.bytesPerElement=4,$t(Un,"StructArrayLayout2ui4");class yu extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S,E,R,P,B,F,j){const G=this.length;return this.resize(G+1),this.emplace(G,t,a,u,d,_,v,S,E,R,P,B,F,j)}emplace(t,a,u,d,_,v,S,E,R,P,B,F,j,G){const Q=20*t,J=10*t;return this.int16[Q+0]=a,this.int16[Q+1]=u,this.int16[Q+2]=d,this.int16[Q+3]=_,this.int16[Q+4]=v,this.float32[J+3]=S,this.float32[J+4]=E,this.float32[J+5]=R,this.float32[J+6]=P,this.int16[Q+14]=B,this.uint32[J+8]=F,this.uint16[Q+18]=j,this.uint16[Q+19]=G,t}}yu.prototype.bytesPerElement=40,$t(yu,"StructArrayLayout5i4f1i1ul2ui40");class sf extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,u,d,_,v,S)}emplace(t,a,u,d,_,v,S,E){const R=8*t;return this.int16[R+0]=a,this.int16[R+1]=u,this.int16[R+2]=d,this.int16[R+4]=_,this.int16[R+5]=v,this.int16[R+6]=S,this.int16[R+7]=E,t}}sf.prototype.bytesPerElement=16,$t(sf,"StructArrayLayout3i2i2i16");class Sp extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,u,d,_)}emplace(t,a,u,d,_,v){const S=4*t,E=8*t;return this.float32[S+0]=a,this.float32[S+1]=u,this.float32[S+2]=d,this.int16[E+6]=_,this.int16[E+7]=v,t}}Sp.prototype.bytesPerElement=16,$t(Sp,"StructArrayLayout2f1f2i16");class Tp extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,v)}emplace(t,a,u,d,_,v,S){const E=20*t,R=5*t;return this.uint8[E+0]=a,this.uint8[E+1]=u,this.float32[R+1]=d,this.float32[R+2]=_,this.float32[R+3]=v,this.float32[R+4]=S,t}}Tp.prototype.bytesPerElement=20,$t(Tp,"StructArrayLayout2ub4f20");class Cn extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u){const d=this.length;return this.resize(d+1),this.emplace(d,t,a,u)}emplace(t,a,u,d){const _=3*t;return this.uint16[_+0]=a,this.uint16[_+1]=u,this.uint16[_+2]=d,t}}Cn.prototype.bytesPerElement=6,$t(Cn,"StructArrayLayout3ui6");class vu extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee,se,le,he,Ee){const Ce=this.length;return this.resize(Ce+1),this.emplace(Ce,t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee,se,le,he,Ee)}emplace(t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee,se,le,he,Ee,Ce){const De=30*t,Le=15*t,Fe=60*t;return this.int16[De+0]=a,this.int16[De+1]=u,this.int16[De+2]=d,this.float32[Le+2]=_,this.float32[Le+3]=v,this.uint16[De+8]=S,this.uint16[De+9]=E,this.uint32[Le+5]=R,this.uint32[Le+6]=P,this.uint32[Le+7]=B,this.uint16[De+16]=F,this.uint16[De+17]=j,this.uint16[De+18]=G,this.float32[Le+10]=Q,this.float32[Le+11]=J,this.uint8[Fe+48]=ee,this.uint8[Fe+49]=se,this.uint8[Fe+50]=le,this.uint32[Le+13]=he,this.int16[De+28]=Ee,this.uint8[Fe+58]=Ce,t}}vu.prototype.bytesPerElement=60,$t(vu,"StructArrayLayout3i2f2ui3ul3ui2f3ub1ul1i1ub60");class Ap extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee,se,le,he,Ee,Ce,De,Le,Fe,ut,Ue,dt,St,gt,yt,Rt,lt){const vt=this.length;return this.resize(vt+1),this.emplace(vt,t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee,se,le,he,Ee,Ce,De,Le,Fe,ut,Ue,dt,St,gt,yt,Rt,lt)}emplace(t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee,se,le,he,Ee,Ce,De,Le,Fe,ut,Ue,dt,St,gt,yt,Rt,lt,vt){const et=20*t,We=40*t,Dt=80*t;return this.float32[et+0]=a,this.float32[et+1]=u,this.int16[We+4]=d,this.int16[We+5]=_,this.int16[We+6]=v,this.int16[We+7]=S,this.int16[We+8]=E,this.int16[We+9]=R,this.int16[We+10]=P,this.int16[We+11]=B,this.int16[We+12]=F,this.uint16[We+13]=j,this.uint16[We+14]=G,this.uint16[We+15]=Q,this.uint16[We+16]=J,this.uint16[We+17]=ee,this.uint16[We+18]=se,this.uint16[We+19]=le,this.uint16[We+20]=he,this.uint16[We+21]=Ee,this.uint16[We+22]=Ce,this.uint16[We+23]=De,this.uint16[We+24]=Le,this.uint16[We+25]=Fe,this.uint16[We+26]=ut,this.uint16[We+27]=Ue,this.uint32[et+14]=dt,this.float32[et+15]=St,this.float32[et+16]=gt,this.float32[et+17]=yt,this.float32[et+18]=Rt,this.uint8[Dt+76]=lt,this.uint16[We+39]=vt,t}}Ap.prototype.bytesPerElement=80,$t(Ap,"StructArrayLayout2f9i15ui1ul4f1ub1ui80");class lf extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v){const S=this.length;return this.resize(S+1),this.emplace(S,t,a,u,d,_,v)}emplace(t,a,u,d,_,v,S){const E=6*t;return this.float32[E+0]=a,this.float32[E+1]=u,this.float32[E+2]=d,this.float32[E+3]=_,this.float32[E+4]=v,this.float32[E+5]=S,t}}lf.prototype.bytesPerElement=24,$t(lf,"StructArrayLayout6f24");class xu extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_){const v=this.length;return this.resize(v+1),this.emplace(v,t,a,u,d,_)}emplace(t,a,u,d,_,v){const S=5*t;return this.float32[S+0]=a,this.float32[S+1]=u,this.float32[S+2]=d,this.float32[S+3]=_,this.float32[S+4]=v,t}}xu.prototype.bytesPerElement=20,$t(xu,"StructArrayLayout5f20");class cf extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,u,d,_,v,S)}emplace(t,a,u,d,_,v,S,E){const R=7*t;return this.float32[R+0]=a,this.float32[R+1]=u,this.float32[R+2]=d,this.float32[R+3]=_,this.float32[R+4]=v,this.float32[R+5]=S,this.float32[R+6]=E,t}}cf.prototype.bytesPerElement=28,$t(cf,"StructArrayLayout7f28");class md extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S,E,R,P,B){const F=this.length;return this.resize(F+1),this.emplace(F,t,a,u,d,_,v,S,E,R,P,B)}emplace(t,a,u,d,_,v,S,E,R,P,B,F){const j=11*t;return this.float32[j+0]=a,this.float32[j+1]=u,this.float32[j+2]=d,this.float32[j+3]=_,this.float32[j+4]=v,this.float32[j+5]=S,this.float32[j+6]=E,this.float32[j+7]=R,this.float32[j+8]=P,this.float32[j+9]=B,this.float32[j+10]=F,t}}md.prototype.bytesPerElement=44,$t(md,"StructArrayLayout11f44");class uh extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S,E,R){const P=this.length;return this.resize(P+1),this.emplace(P,t,a,u,d,_,v,S,E,R)}emplace(t,a,u,d,_,v,S,E,R,P){const B=9*t;return this.float32[B+0]=a,this.float32[B+1]=u,this.float32[B+2]=d,this.float32[B+3]=_,this.float32[B+4]=v,this.float32[B+5]=S,this.float32[B+6]=E,this.float32[B+7]=R,this.float32[B+8]=P,t}}uh.prototype.bytesPerElement=36,$t(uh,"StructArrayLayout9f36");class hh extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a){const u=this.length;return this.resize(u+1),this.emplace(u,t,a)}emplace(t,a,u){const d=2*t;return this.float32[d+0]=a,this.float32[d+1]=u,t}}hh.prototype.bytesPerElement=8,$t(hh,"StructArrayLayout2f8");class gd extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint32=new Uint32Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t,a,u,d){const _=this.length;return this.resize(_+1),this.emplace(_,t,a,u,d)}emplace(t,a,u,d,_){const v=6*t;return this.uint32[3*t+0]=a,this.uint16[v+2]=u,this.uint16[v+3]=d,this.uint16[v+4]=_,t}}gd.prototype.bytesPerElement=12,$t(gd,"StructArrayLayout1ul3ui12");class Ep extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint16[1*t+0]=a,t}}Ep.prototype.bytesPerElement=2,$t(Ep,"StructArrayLayout1ui2");class Cp extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J){const ee=this.length;return this.resize(ee+1),this.emplace(ee,t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J)}emplace(t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee){const se=16*t;return this.float32[se+0]=a,this.float32[se+1]=u,this.float32[se+2]=d,this.float32[se+3]=_,this.float32[se+4]=v,this.float32[se+5]=S,this.float32[se+6]=E,this.float32[se+7]=R,this.float32[se+8]=P,this.float32[se+9]=B,this.float32[se+10]=F,this.float32[se+11]=j,this.float32[se+12]=G,this.float32[se+13]=Q,this.float32[se+14]=J,this.float32[se+15]=ee,t}}Cp.prototype.bytesPerElement=64,$t(Cp,"StructArrayLayout16f64");class so extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.uint16=new Uint16Array(this.arrayBuffer),this.float32=new Float32Array(this.arrayBuffer)}emplaceBack(t,a,u,d,_,v,S){const E=this.length;return this.resize(E+1),this.emplace(E,t,a,u,d,_,v,S)}emplace(t,a,u,d,_,v,S,E){const R=10*t,P=5*t;return this.uint16[R+0]=a,this.uint16[R+1]=u,this.uint16[R+2]=d,this.uint16[R+3]=_,this.float32[P+2]=v,this.float32[P+3]=S,this.float32[P+4]=E,t}}so.prototype.bytesPerElement=20,$t(so,"StructArrayLayout4ui3f20");class po extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer),this.int16=new Int16Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.int16[1*t+0]=a,t}}po.prototype.bytesPerElement=2,$t(po,"StructArrayLayout1i2");class _d extends Yi{_refreshViews(){this.uint8=new Uint8Array(this.arrayBuffer)}emplaceBack(t){const a=this.length;return this.resize(a+1),this.emplace(a,t)}emplace(t,a){return this.uint8[1*t+0]=a,t}}_d.prototype.bytesPerElement=1,$t(_d,"StructArrayLayout1ub1");class zm extends Ic{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.int16[this._pos2+3]}get tileAnchorY(){return this._structArray.int16[this._pos2+4]}get x1(){return this._structArray.float32[this._pos4+3]}get y1(){return this._structArray.float32[this._pos4+4]}get x2(){return this._structArray.float32[this._pos4+5]}get y2(){return this._structArray.float32[this._pos4+6]}get padding(){return this._structArray.int16[this._pos2+14]}get featureIndex(){return this._structArray.uint32[this._pos4+8]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+18]}get bucketIndex(){return this._structArray.uint16[this._pos2+19]}}zm.prototype.size=40;class Ip extends yu{get(t){return new zm(this,t)}}$t(Ip,"CollisionBoxArray");class Fm extends Ic{get projectedAnchorX(){return this._structArray.int16[this._pos2+0]}get projectedAnchorY(){return this._structArray.int16[this._pos2+1]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+2]}get tileAnchorX(){return this._structArray.float32[this._pos4+2]}get tileAnchorY(){return this._structArray.float32[this._pos4+3]}get glyphStartIndex(){return this._structArray.uint16[this._pos2+8]}get numGlyphs(){return this._structArray.uint16[this._pos2+9]}get vertexStartIndex(){return this._structArray.uint32[this._pos4+5]}get lineStartIndex(){return this._structArray.uint32[this._pos4+6]}get lineLength(){return this._structArray.uint32[this._pos4+7]}get segment(){return this._structArray.uint16[this._pos2+16]}get lowerSize(){return this._structArray.uint16[this._pos2+17]}get upperSize(){return this._structArray.uint16[this._pos2+18]}get lineOffsetX(){return this._structArray.float32[this._pos4+10]}get lineOffsetY(){return this._structArray.float32[this._pos4+11]}get writingMode(){return this._structArray.uint8[this._pos1+48]}get placedOrientation(){return this._structArray.uint8[this._pos1+49]}set placedOrientation(t){this._structArray.uint8[this._pos1+49]=t}get hidden(){return this._structArray.uint8[this._pos1+50]}set hidden(t){this._structArray.uint8[this._pos1+50]=t}get crossTileID(){return this._structArray.uint32[this._pos4+13]}set crossTileID(t){this._structArray.uint32[this._pos4+13]=t}get associatedIconIndex(){return this._structArray.int16[this._pos2+28]}get flipState(){return this._structArray.uint8[this._pos1+58]}set flipState(t){this._structArray.uint8[this._pos1+58]=t}}Fm.prototype.size=60;class yd extends vu{get(t){return new Fm(this,t)}}$t(yd,"PlacedSymbolArray");class vd extends Ic{get tileAnchorX(){return this._structArray.float32[this._pos4+0]}get tileAnchorY(){return this._structArray.float32[this._pos4+1]}get projectedAnchorX(){return this._structArray.int16[this._pos2+4]}get projectedAnchorY(){return this._structArray.int16[this._pos2+5]}get projectedAnchorZ(){return this._structArray.int16[this._pos2+6]}get rightJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+7]}get centerJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+8]}get leftJustifiedTextSymbolIndex(){return this._structArray.int16[this._pos2+9]}get verticalPlacedTextSymbolIndex(){return this._structArray.int16[this._pos2+10]}get placedIconSymbolIndex(){return this._structArray.int16[this._pos2+11]}get verticalPlacedIconSymbolIndex(){return this._structArray.int16[this._pos2+12]}get key(){return this._structArray.uint16[this._pos2+13]}get textBoxStartIndex(){return this._structArray.uint16[this._pos2+14]}get textBoxEndIndex(){return this._structArray.uint16[this._pos2+15]}get verticalTextBoxStartIndex(){return this._structArray.uint16[this._pos2+16]}get verticalTextBoxEndIndex(){return this._structArray.uint16[this._pos2+17]}get iconBoxStartIndex(){return this._structArray.uint16[this._pos2+18]}get iconBoxEndIndex(){return this._structArray.uint16[this._pos2+19]}get verticalIconBoxStartIndex(){return this._structArray.uint16[this._pos2+20]}get verticalIconBoxEndIndex(){return this._structArray.uint16[this._pos2+21]}get featureIndex(){return this._structArray.uint16[this._pos2+22]}get numHorizontalGlyphVertices(){return this._structArray.uint16[this._pos2+23]}get numVerticalGlyphVertices(){return this._structArray.uint16[this._pos2+24]}get numIconVertices(){return this._structArray.uint16[this._pos2+25]}get numVerticalIconVertices(){return this._structArray.uint16[this._pos2+26]}get useRuntimeCollisionCircles(){return this._structArray.uint16[this._pos2+27]}get crossTileID(){return this._structArray.uint32[this._pos4+14]}set crossTileID(t){this._structArray.uint32[this._pos4+14]=t}get textOffset0(){return this._structArray.float32[this._pos4+15]}get textOffset1(){return this._structArray.float32[this._pos4+16]}get collisionCircleDiameter(){return this._structArray.float32[this._pos4+17]}get zOffset(){return this._structArray.float32[this._pos4+18]}set zOffset(t){this._structArray.float32[this._pos4+18]=t}get hasIconTextFit(){return this._structArray.uint8[this._pos1+76]}get elevationFeatureIndex(){return this._structArray.uint16[this._pos2+39]}}vd.prototype.size=80;class Rp extends Ap{get(t){return new vd(this,t)}}$t(Rp,"SymbolInstanceArray");class km extends Ps{getoffsetX(t){return this.float32[1*t+0]}}$t(km,"GlyphOffsetArray");class Nm extends ss{getx(t){return this.int16[2*t+0]}gety(t){return this.int16[2*t+1]}}$t(Nm,"SymbolLineVertexArray");class Mp extends Ic{get featureIndex(){return this._structArray.uint32[this._pos4+0]}get sourceLayerIndex(){return this._structArray.uint16[this._pos2+2]}get bucketIndex(){return this._structArray.uint16[this._pos2+3]}get layoutVertexArrayOffset(){return this._structArray.uint16[this._pos2+4]}}Mp.prototype.size=12;class Dp extends gd{get(t){return new Mp(this,t)}}$t(Dp,"FeatureIndexArray");class Op extends Un{geta_centroid_pos0(t){return this.uint16[2*t+0]}geta_centroid_pos1(t){return this.uint16[2*t+1]}}$t(Op,"FillExtrusionCentroidArray");class Pp extends Ic{get a_join_normal_inside0(){return this._structArray.int16[this._pos2+0]}get a_join_normal_inside1(){return this._structArray.int16[this._pos2+1]}get a_join_normal_inside2(){return this._structArray.int16[this._pos2+2]}}Pp.prototype.size=6;class Vm extends rl{get(t){return new Pp(this,t)}}$t(Vm,"FillExtrusionWallArray");const Um=ei([{name:"a_pos",components:2,type:"Int16"}],4),Lp=ei([{name:"a_circle_z_offset",components:1,type:"Float32"}],4),jm=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]);class hn{constructor(t=[]){this.segments=t}_prepareSegment(t,a,u,d){let _=this.segments[this.segments.length-1];return t>hn.MAX_VERTEX_ARRAY_LENGTH&&ri(`Max vertices per segment is ${hn.MAX_VERTEX_ARRAY_LENGTH}: bucket requested ${t}`),(!_||_.vertexLength+t>hn.MAX_VERTEX_ARRAY_LENGTH||_.sortKey!==d)&&(_={vertexOffset:a,primitiveOffset:u,vertexLength:0,primitiveLength:0},d!==void 0&&(_.sortKey=d),this.segments.push(_)),_}prepareSegment(t,a,u,d){return this._prepareSegment(t,a.length,u.length,d)}get(){return this.segments}destroy(){for(const t of this.segments)for(const a in t.vaos)t.vaos[a].destroy()}static simpleSegment(t,a,u,d){return new hn([{vertexOffset:t,primitiveOffset:a,vertexLength:u,primitiveLength:d,vaos:{},sortKey:0}])}}function fh(s,t){return 256*(s=Ie(Math.floor(s),0,255))+Ie(Math.floor(t),0,255)}hn.MAX_VERTEX_ARRAY_LENGTH=Math.pow(2,16)-1,$t(hn,"SegmentVector");const Vg=ei([{name:"a_pattern",components:4,type:"Uint16"},{name:"a_pixel_ratio",components:1,type:"Float32"}]),Mc=ei([{name:"a_pattern_b",components:4,type:"Uint16"}]),uf=ei([{name:"a_dash",components:4,type:"Uint16"}]);class xd{constructor(){this.ids=[],this.uniqueIds=[],this.positions=[],this.indexed=!1}add(t,a,u,d){this.ids.push(Bp(t)),this.positions.push(a,u,d)}eachPosition(t,a){const u=Bp(t);let d=0,_=this.ids.length-1;for(;d<_;){const v=d+_>>1;this.ids[v]>=u?_=v:d=v+1}for(;this.ids[d]===u;)a(this.positions[3*d],this.positions[3*d+1],this.positions[3*d+2]),d++}static serialize(t,a){const u=new Float64Array(t.ids),d=new Uint32Array(t.positions);return nl(u,d,0,u.length-1),a&&(a.add(u.buffer),a.add(d.buffer)),{ids:u,positions:d}}static deserialize(t){const a=new xd;let u;a.ids=t.ids,a.positions=t.positions;for(const d of a.ids)d!==u&&a.uniqueIds.push(d),u=d;return a.indexed=!0,a}}function Bp(s){const t=+s;return Number.isSafeInteger(t)?t:Dh(String(s))}function nl(s,t,a,u){for(;a<u;){const d=s[a+u>>1];let _=a-1,v=u+1;for(;;){do _++;while(s[_]<d);do v--;while(s[v]>d);if(_>=v)break;hf(s,_,v),hf(t,3*_,3*v),hf(t,3*_+1,3*v+1),hf(t,3*_+2,3*v+2)}v-a<u-v?(nl(s,t,a,v),a=v+1):(nl(s,t,v+1,u),u=v)}}function hf(s,t,a){const u=s[t];s[t]=s[a],s[a]=u}$t(xd,"FeaturePositionMap");class ls{constructor(t){this.gl=t.gl,this.initialized=!1}fetchUniformLocation(t,a){return this.location||this.initialized||(this.location=this.gl.getUniformLocation(t,a),this.initialized=!0),!!this.location}set(t,a,u){throw new Error("Uniform#set() must be implemented by each concrete Uniform")}}class Dc extends ls{constructor(t){super(t),this.current=0}set(t,a,u){this.fetchUniformLocation(t,a)&&this.current!==u&&(this.current=u,this.gl.uniform1i(this.location,u))}}class gi extends ls{constructor(t){super(t),this.current=0}set(t,a,u){this.fetchUniformLocation(t,a)&&this.current!==u&&(this.current=u,this.gl.uniform1f(this.location,u))}}class Bl extends ls{constructor(t){super(t),this.current=[0,0]}set(t,a,u){this.fetchUniformLocation(t,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]||(this.current=u,this.gl.uniform2f(this.location,u[0],u[1])))}}class bd extends ls{constructor(t){super(t),this.current=[0,0,0]}set(t,a,u){this.fetchUniformLocation(t,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]||(this.current=u,this.gl.uniform3f(this.location,u[0],u[1],u[2])))}}class ff extends ls{constructor(t){super(t),this.current=[0,0,0,0]}set(t,a,u){this.fetchUniformLocation(t,a)&&(u[0]===this.current[0]&&u[1]===this.current[1]&&u[2]===this.current[2]&&u[3]===this.current[3]||(this.current=u,this.gl.uniform4f(this.location,u[0],u[1],u[2],u[3])))}}class df extends ls{constructor(t){super(t),this.current=Ei.transparent.toPremultipliedRenderColor(null)}set(t,a,u){this.fetchUniformLocation(t,a)&&(u.r===this.current.r&&u.g===this.current.g&&u.b===this.current.b&&u.a===this.current.a||(this.current=u,this.gl.uniform4f(this.location,u.r,u.g,u.b,u.a)))}}const bu=new Float32Array(16);class pf extends ls{constructor(t){super(t),this.current=bu}set(t,a,u){if(this.fetchUniformLocation(t,a)){if(u[12]!==this.current[12]||u[0]!==this.current[0])return this.current=u,void this.gl.uniformMatrix4fv(this.location,!1,u);for(let d=1;d<16;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix4fv(this.location,!1,u);break}}}}const Ug=new Float32Array(9),wd=new Float32Array(4);class cs extends ls{constructor(t){super(t),this.current=wd}set(t,a,u){if(this.fetchUniformLocation(t,a)){for(let d=0;d<4;d++)if(u[d]!==this.current[d]){this.current=u,this.gl.uniformMatrix2fv(this.location,!1,u);break}}}}function mf(s){return[fh(255*s.r,255*s.g),fh(255*s.b,255*s.a)]}class Ca{constructor(t,a,u,d){this.value=t,this.uniformNames=a.map((_=>`u_${_}`)),this.type=u,this.context=d}setUniform(t,a,u,d,_){const v=d.constantOr(this.value);a.set(t,_,v instanceof Ei?v.toPremultipliedRenderColor(this.lutExpression&&this.lutExpression.kind==="constant"&&this.lutExpression.value==="none"?null:this.context.lut):v)}getBinding(t,a){return this.type==="color"?new df(t):new gi(t)}}class wu{constructor(t,a){this.uniformNames=a.map((u=>`u_${u}`)),this.pattern=null,this.patternTransition=null,this.pixelRatio=1}setConstantPatternPositions(t,a){this.pixelRatio=t.pixelRatio||1,this.pattern=t.tl.concat(t.br),this.patternTransition=a?a.tl.concat(a.br):this.pattern}setUniform(t,a,u,d,_){let v=null;_!=="u_pattern"&&_!=="u_dash"||(v=this.pattern),_==="u_pattern_b"&&(v=this.patternTransition),_==="u_pixel_ratio"&&(v=this.pixelRatio),v&&a.set(t,_,v)}getBinding(t,a){return a==="u_pattern"||a==="u_pattern_b"||a==="u_dash"?new ff(t):new gi(t)}}class zl{constructor(t,a,u,d){this.expression=t,this.type=u,this.maxValue=0,this.paintVertexAttributes=a.map((_=>({name:`a_${_}`,type:"Float32",components:u==="color"?2:1,offset:0}))),this.paintVertexArray=new d}populatePaintArray(t,a,u,d,_,v,S,E){const R=this.paintVertexArray.length,P=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate(new Hi(0,{brightness:v,worldview:E}),a,{},_,d,S):this.expression.kind==="constant"&&this.expression.value,B=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hi(0,{brightness:v,worldview:E}),a,{},_,d,S):this.lutExpression.value)==="none";this.paintVertexArray.resize(t),this._setPaintValue(R,t,P,B?null:this.context.lut)}updatePaintArray(t,a,u,d,_,v,S,E){const R=this.expression.kind==="composite"||this.expression.kind==="source"?this.expression.evaluate({zoom:0,brightness:S,worldview:E},u,d,void 0,_):this.expression.kind==="constant"&&this.expression.value,P=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hi(0,{brightness:S,worldview:E}),u,d,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(t,a,R,P?null:this.context.lut)}_setPaintValue(t,a,u,d){if(this.type==="color"){const _=mf(u.toPremultipliedRenderColor(d));for(let v=t;v<a;v++)this.paintVertexArray.emplace(v,_[0],_[1])}else{for(let _=t;_<a;_++)this.paintVertexArray.emplace(_,u);this.maxValue=Math.max(this.maxValue,Math.abs(u))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.lutExpression&&this.lutExpression.kind!=="constant"&&(this.lutExpression.isStateDependent||!this.lutExpression.isLightConstant)||this.expression.kind!=="constant"&&(this.expression.isStateDependent||!this.expression.isLightConstant)))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}}class ol{constructor(t,a,u,d,_,v){this.expression=t,this.uniformNames=a.map((S=>`u_${S}_t`)),this.type=u,this.useIntegerZoom=d,this.context=_,this.maxValue=0,this.paintVertexAttributes=a.map((S=>({name:`a_${S}`,type:"Float32",components:u==="color"?4:2,offset:0}))),this.paintVertexArray=new v}populatePaintArray(t,a,u,d,_,v,S,E){const R=this.expression.evaluate(new Hi(this.context.zoom,{brightness:v,worldview:E}),a,{},_,d,S),P=this.expression.evaluate(new Hi(this.context.zoom+1,{brightness:v,worldview:E}),a,{},_,d,S),B=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hi(0,{brightness:v,worldview:E}),a,{},_,d,S):this.lutExpression.value)==="none",F=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValue(F,t,R,P,B?null:this.context.lut)}updatePaintArray(t,a,u,d,_,v,S,E){const R=this.expression.evaluate({zoom:this.context.zoom,brightness:S,worldview:E},u,d,void 0,_),P=this.expression.evaluate({zoom:this.context.zoom+1,brightness:S,worldview:E},u,d,void 0,_),B=!!this.lutExpression&&(this.lutExpression.kind==="composite"||this.lutExpression.kind==="source"?this.lutExpression.evaluate(new Hi(0,{brightness:S,worldview:E}),u,d,void 0,_):this.lutExpression.value)==="none";this._setPaintValue(t,a,R,P,B?null:this.context.lut)}_setPaintValue(t,a,u,d,_){if(this.type==="color"){const v=mf(u.toPremultipliedRenderColor(_)),S=mf(u.toPremultipliedRenderColor(_));for(let E=t;E<a;E++)this.paintVertexArray.emplace(E,v[0],v[1],S[0],S[1])}else{for(let v=t;v<a;v++)this.paintVertexArray.emplace(v,u,d);this.maxValue=Math.max(this.maxValue,Math.abs(u),Math.abs(d))}}upload(t){this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer&&this.paintVertexBuffer.buffer?this.paintVertexBuffer.updateData(this.paintVertexArray):this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,this.expression.isStateDependent||!this.expression.isLightConstant))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy()}setUniform(t,a,u,d,_){const v=this.useIntegerZoom?Math.floor(u.zoom):u.zoom,S=Ie(this.expression.interpolationFactor(v,this.context.zoom,this.context.zoom+1),0,1);a.set(t,_,S)}getBinding(t,a){return new gi(t)}}class Ls{constructor(t,a,u,d,_){this.expression=t,this.layerId=_,this.paintVertexAttributes=(u==="array"?uf:Vg).members;for(let v=0;v<a.length;++v);this.paintVertexArray=new d,this.paintTransitionVertexArray=new Ea}populatePaintArray(t,a,u,d){const _=this.paintVertexArray.length;this.paintVertexArray.resize(t),this._setPaintValues(_,t,a.patterns&&a.patterns[this.layerId],u)}updatePaintArray(t,a,u,d,_,v,S){this._setPaintValues(t,a,u.patterns&&u.patterns[this.layerId],v)}_setPaintValues(t,a,u,d){if(!d||!u)return;const _=d[u[0]],v=d[u[1]];if(_){if(_){const{tl:S,br:E,pixelRatio:R}=_;for(let P=t;P<a;P++)this.paintVertexArray.emplace(P,S[0],S[1],E[0],E[1],R)}if(v){this.paintTransitionVertexArray.resize(this.paintVertexArray.length);const{tl:S,br:E}=v;for(let R=t;R<a;R++)this.paintTransitionVertexArray.emplace(R,S[0],S[1],E[0],E[1])}}}upload(t){const a=this.expression.isStateDependent||!this.expression.isLightConstant;this.paintVertexArray&&this.paintVertexArray.arrayBuffer&&(this.paintVertexBuffer=t.createVertexBuffer(this.paintVertexArray,this.paintVertexAttributes,a)),this.paintTransitionVertexArray&&this.paintTransitionVertexArray.length&&(this.paintTransitionVertexBuffer=t.createVertexBuffer(this.paintTransitionVertexArray,Mc.members,a))}destroy(){this.paintVertexBuffer&&this.paintVertexBuffer.destroy(),this.paintTransitionVertexBuffer&&this.paintTransitionVertexBuffer.destroy()}}class Su{constructor(t,a,u=(()=>!0)){this.binders={},this._buffers=[],this.context=a;const d=[];for(const _ in t.paint._values){const v=t.paint.get(_);if(_.endsWith("-use-theme")||!u(_)||!(v instanceof Ol&&rd(v.property.specification)))continue;const S=jg(_,t.type),E=v.value,R=v.property.specification.type,P=!!v.property.useIntegerZoom,B=_==="line-dasharray"||_.endsWith("pattern"),F=t.paint.get(`${_}-use-theme`),j=_==="line-dasharray"&&t.layout.get("line-cap").value.kind!=="constant"||F&&F.value.kind!=="constant";if(E.kind!=="constant"||j)if(E.kind==="source"||j||B){const G=c(_,R,"source");this.binders[_]=B?new Ls(E,S,R,G,t.id):new zl(E,S,R,G),d.push(`/a_${_}`)}else{const G=c(_,R,"composite");this.binders[_]=new ol(E,S,R,P,a,G),d.push(`/z_${_}`)}else this.binders[_]=B?new wu(E.value,S):new Ca(E.value,S,R,a),d.push(`/u_${_}`);F&&(this.binders[_].lutExpression=F.value)}this.cacheKey=d.sort().join("")}getMaxValue(t){const a=this.binders[t];return a instanceof zl||a instanceof ol?a.maxValue:0}populatePaintArrays(t,a,u,d,_,v,S,E){for(const R in this.binders){const P=this.binders[R];P.context=this.context,(P instanceof zl||P instanceof ol||P instanceof Ls)&&P.populatePaintArray(t,a,u,d,_,v,S,E)}}setConstantPatternPositions(t,a){for(const u in this.binders){const d=this.binders[u];d instanceof wu&&d.setConstantPatternPositions(t,a)}}getPatternTransitionVertexBuffer(t){const a=this.binders[t];return a instanceof Ls?a.paintTransitionVertexBuffer:null}updatePaintArrays(t,a,u,d,_,v,S,E,R,P){let B=!1;const F=Object.keys(t),j=F.length!==0&&!E,G=j?F:a.uniqueIds;this.context.lut=_.lut;for(const Q in this.binders){const J=this.binders[Q];if(J.context=this.context,(J instanceof zl||J instanceof ol||J instanceof Ls)&&J.expression&&J.expression.kind&&J.expression.kind!=="constant"&&(J.expression.isStateDependent===!0||J.expression.isLightConstant===!1)){const ee=_.paint.get(Q);J.expression=ee.value;for(const se of G){const le=t[se.toString()];a.eachPosition(se,((he,Ee,Ce)=>{const De=d.feature(he);J.updatePaintArray(Ee,Ce,De,le,v,S,R,P)}))}if(!j)for(const se of u.uniqueIds){const le=t[se.toString()];u.eachPosition(se,((he,Ee,Ce)=>{const De=d.feature(he);J.updatePaintArray(Ee,Ce,De,le,v,S,R,P)}))}B=!0}}return B}defines(){const t=[];for(const a in this.binders){const u=this.binders[a];(u instanceof Ca||u instanceof wu)&&t.push(...u.uniformNames.map((d=>`#define HAS_UNIFORM_${d}`)))}return t}getPaintVertexBuffers(){return this._buffers}getUniforms(t){const a=[];for(const u in this.binders){const d=this.binders[u];if(d instanceof Ca||d instanceof wu||d instanceof ol)for(const _ of d.uniformNames)a.push({name:_,property:u,binding:d.getBinding(t,_)})}return a}setUniforms(t,a,u,d,_){for(const{name:v,property:S,binding:E}of u)this.binders[S].setUniform(t,E,_,d.get(S),v)}updatePaintBuffers(){this._buffers=[];for(const t in this.binders){const a=this.binders[t];(a instanceof zl||a instanceof ol||a instanceof Ls)&&a.paintVertexBuffer&&this._buffers.push(a.paintVertexBuffer),a instanceof Ls&&a.paintTransitionVertexBuffer&&this._buffers.push(a.paintTransitionVertexBuffer)}}upload(t){for(const a in this.binders){const u=this.binders[a];(u instanceof zl||u instanceof ol||u instanceof Ls)&&u.upload(t)}this.updatePaintBuffers()}destroy(){for(const t in this.binders){const a=this.binders[t];(a instanceof zl||a instanceof ol||a instanceof Ls)&&a.destroy()}}}class Bo{constructor(t,a,u=(()=>!0)){this.programConfigurations={};for(const d of t)this.programConfigurations[d.id]=new Su(d,a,u);this.needsUpload=!1,this._featureMap=new xd,this._featureMapWithoutIds=new xd,this._bufferOffset=0,this._idlessCounter=0}populatePaintArrays(t,a,u,d,_,v,S,E,R){for(const P in this.programConfigurations)this.programConfigurations[P].populatePaintArrays(t,a,d,_,v,S,E,R);a.id!==void 0?this._featureMap.add(a.id,u,this._bufferOffset,t):(this._featureMapWithoutIds.add(this._idlessCounter,u,this._bufferOffset,t),this._idlessCounter+=1),this._bufferOffset=t,this.needsUpload=!0}updatePaintArrays(t,a,u,d,_,v,S,E){for(const R of u)this.needsUpload=this.programConfigurations[R.id].updatePaintArrays(t,this._featureMap,this._featureMapWithoutIds,a,R,d,_,v,S||0,E)||this.needsUpload}get(t){return this.programConfigurations[t]}upload(t){if(this.needsUpload){for(const a in this.programConfigurations)this.programConfigurations[a].upload(t);this.needsUpload=!1}}destroy(){for(const t in this.programConfigurations)this.programConfigurations[t].destroy()}}const mo={"text-opacity":["opacity"],"icon-opacity":["opacity"],"text-occlusion-opacity":["occlusion_opacity"],"icon-occlusion-opacity":["occlusion_opacity"],"text-color":["fill_color"],"icon-color":["fill_color"],"text-emissive-strength":["emissive_strength"],"icon-emissive-strength":["emissive_strength"],"text-halo-color":["halo_color"],"icon-halo-color":["halo_color"],"text-halo-blur":["halo_blur"],"icon-halo-blur":["halo_blur"],"text-halo-width":["halo_width"],"icon-halo-width":["halo_width"],"symbol-z-offset":["z_offset"],"line-gap-width":["gapwidth"],"line-pattern":["pattern","pixel_ratio","pattern_b"],"fill-pattern":["pattern","pixel_ratio","pattern_b"],"fill-extrusion-pattern":["pattern","pixel_ratio","pattern_b"],"line-dasharray":["dash"],"fill-bridge-guard-rail-color":["structure_color"],"fill-tunnel-structure-color":["structure_color"]};function jg(s,t){return mo[s]||[s.replace(`${t}-`,"").replace(/-/g,"_")]}const g={"line-pattern":{source:Po,composite:Po},"fill-pattern":{source:Po,composite:Po},"fill-extrusion-pattern":{source:Po,composite:Po},"line-dasharray":{source:Ea,composite:Ea}},i={color:{source:hh,composite:Lo},number:{source:Ps,composite:hh}};function c(s,t,a){const u=g[s];return u&&u[a]||i[t][a]}$t(Ca,"ConstantBinder"),$t(wu,"PatternConstantBinder"),$t(zl,"SourceExpressionBinder"),$t(Ls,"PatternCompositeBinder"),$t(ol,"CompositeExpressionBinder"),$t(Su,"ProgramConfiguration",{omit:["_buffers"]}),$t(Bo,"ProgramConfigurationSet");const p=Bt/Math.PI/2,x=5,w=6,A=16383,I=64,O=[I,32,16],z=-p,k=p;function H(s,t,a,u=p){return a=Ne(a),[s*Math.sin(a)*u,-t*u,s*Math.cos(a)*u]}function V(s,t,a){return H(Math.cos(Ne(s)),Math.sin(Ne(s)),t,a)}const X=63710088e-1,Y=2*Math.PI*X;class W{constructor(t,a){if(isNaN(t)||isNaN(a))throw new Error(`Invalid LngLat object: (${t}, ${a})`);if(this.lng=+t,this.lat=+a,this.lat>90||this.lat<-90)throw new Error("Invalid LngLat latitude value: must be between -90 and 90")}wrap(){return new W(Be(this.lng,-180,180),this.lat)}toArray(){return[this.lng,this.lat]}toString(){return`LngLat(${this.lng}, ${this.lat})`}distanceTo(t){const a=Math.PI/180,u=this.lat*a,d=t.lat*a,_=Math.sin(u)*Math.sin(d)+Math.cos(u)*Math.cos(d)*Math.cos((t.lng-this.lng)*a);return X*Math.acos(Math.min(_,1))}toBounds(t=0){const a=360*t/40075017,u=a/Math.cos(Math.PI/180*this.lat);return new re({lng:this.lng-u,lat:this.lat-a},{lng:this.lng+u,lat:this.lat+a})}toEcef(t){return V(this.lat,this.lng,p+t*p/X)}static convert(t){if(t instanceof W)return t;if(Array.isArray(t)&&(t.length===2||t.length===3))return new W(Number(t[0]),Number(t[1]));if(!Array.isArray(t)&&typeof t=="object"&&t!==null)return new W(Number("lng"in t?t.lng:t.lon),Number(t.lat));throw new Error("`LngLatLike` argument must be specified as a LngLat instance, an object {lng: <lng>, lat: <lat>}, an object {lon: <lng>, lat: <lat>}, or an array of [<lng>, <lat>]")}}class re{constructor(t,a){t&&(a?this.setSouthWest(t).setNorthEast(a):Array.isArray(t)&&t.length===4?this.setSouthWest([t[0],t[1]]).setNorthEast([t[2],t[3]]):this.setSouthWest(t[0]).setNorthEast(t[1]))}setNorthEast(t){return this._ne=t instanceof W?new W(t.lng,t.lat):W.convert(t),this}setSouthWest(t){return this._sw=t instanceof W?new W(t.lng,t.lat):W.convert(t),this}extend(t){const a=this._sw,u=this._ne;let d,_;if(t instanceof W)d=t,_=t;else{if(!(t instanceof re))return Array.isArray(t)?t.length===4||t.every(Array.isArray)?this.extend(re.convert(t)):this.extend(W.convert(t)):typeof t=="object"&&t!==null&&t.hasOwnProperty("lat")&&(t.hasOwnProperty("lon")||t.hasOwnProperty("lng"))?this.extend(W.convert(t)):this;if(d=t._sw,_=t._ne,!d||!_)return this}return a||u?(a.lng=Math.min(d.lng,a.lng),a.lat=Math.min(d.lat,a.lat),u.lng=Math.max(_.lng,u.lng),u.lat=Math.max(_.lat,u.lat)):(this._sw=new W(d.lng,d.lat),this._ne=new W(_.lng,_.lat)),this}getCenter(){return new W((this._sw.lng+this._ne.lng)/2,(this._sw.lat+this._ne.lat)/2)}getSouthWest(){return this._sw}getNorthEast(){return this._ne}getNorthWest(){return new W(this.getWest(),this.getNorth())}getSouthEast(){return new W(this.getEast(),this.getSouth())}getWest(){return this._sw.lng}getSouth(){return this._sw.lat}getEast(){return this._ne.lng}getNorth(){return this._ne.lat}toArray(){return[this._sw.toArray(),this._ne.toArray()]}toString(){return`LngLatBounds(${this._sw.toString()}, ${this._ne.toString()})`}isEmpty(){return!(this._sw&&this._ne)}contains(t){const{lng:a,lat:u}=W.convert(t);let d=this._sw.lng<=a&&a<=this._ne.lng;return this._sw.lng>this._ne.lng&&(d=this._sw.lng>=a&&a>=this._ne.lng),this._sw.lat<=u&&u<=this._ne.lat&&d}static convert(t){if(t)return t instanceof re?t:new re(t)}}const K=0,ae=25.5;function ue(s){return Y*Math.cos(s*Math.PI/180)}function fe(s){return(180+s)/360}function xe(s){return(180-180/Math.PI*Math.log(Math.tan(Math.PI/4+s*Math.PI/360)))/360}function ge(s,t){return s/ue(t)}function Te(s){return 360*s-180}function ye(s){return 360/Math.PI*Math.atan(Math.exp((180-360*s)*Math.PI/180))-90}function _e(s,t){return s*ue(ye(t))}const Se=85.051129;function He(s){return Math.cos(Ne(Ie(s,-Se,Se)))}function ze(s,t){const a=Ie(t,K,ae),u=Math.pow(2,a);return He(s)*Y/(512*u)}function nt(s){return 1/Math.cos(s*Math.PI/180)}function Ge(s,t=0){const a=Math.exp(Math.PI*(1-(s.y+t/Bt)/(1<<s.z)*2));return 80150034*a/(a*a+1)/Bt/(1<<s.z)}class tt{constructor(t,a,u=0){this.x=+t,this.y=+a,this.z=+u}static fromLngLat(t,a=0){const u=W.convert(t);return new tt(fe(u.lng),xe(u.lat),ge(a,u.lat))}toLngLat(){return new W(Te(this.x),ye(this.y))}toAltitude(){return _e(this.z,this.y)}meterInMercatorCoordinateUnits(){return 1/Y*nt(ye(this.y))}}function It(s,t,a,u,d,_,v,S,E){const R=(t+u)/2,P=(a+d)/2,B=new Tt(R,P);S(B),(function(F,j,G,Q,J,ee){const se=G-J,le=Q-ee;return Math.abs((Q-j)*se-(G-F)*le)/Math.hypot(se,le)})(B.x,B.y,_.x,_.y,v.x,v.y)>=E?(It(s,t,a,R,P,_,B,S,E),It(s,R,P,u,d,B,v,S,E)):s.push(v)}function qe(s,t,a){let u=s[0],d=u.x,_=u.y;t(u);const v=[u];for(let S=1;S<s.length;S++){const E=s[S],{x:R,y:P}=E;t(E),It(v,d,_,R,P,u,E,t,a),d=R,_=P,u=E}return v}function Oe(s,t,a,u){if(u(t,a)){const d=t.add(a)._mult(.5);Oe(s,t,d,u),Oe(s,d,a,u)}else s.push(a)}function ot(s,t){let a=s[0];const u=[a];for(let d=1;d<s.length;d++){const _=s[d];Oe(u,a,_,t),a=_}return u}const je=Math.pow(2,14)-1,at=-je-1;function ht(s,t){const a=Math.round(s.x*t),u=Math.round(s.y*t);return s.x=Ie(a,at,je),s.y=Ie(u,at,je),(a<s.x||a>s.x+1||u<s.y||u>s.y+1)&&ri("Geometry exceeds allowed extent, reduce your vector tile buffer size"),s}function wt(s,t,a){const u=s.loadGeometry(),d=s.extent,_=Bt/d;if(t&&a&&a.projection.isReprojectedInTileSpace){const v=1<<t.z,{scale:S,x:E,y:R,projection:P}=a,B=F=>{const j=Te((t.x+F.x/d)/v),G=ye((t.y+F.y/d)/v),Q=P.project(j,G);F.x=(Q.x*S-E)*d,F.y=(Q.y*S-R)*d};for(let F=0;F<u.length;F++)if(s.type!==1)u[F]=qe(u[F],B,1);else{const j=[];for(const G of u[F])G.x<0||G.x>=d||G.y<0||G.y>=d||(B(G),j.push(G));u[F]=j}}for(const v of u)for(const S of v)ht(S,_);return u}function ft(s,t){return{type:s.type,id:s.id,properties:s.properties,geometry:t?wt(s):[]}}class pt{constructor(t,a,u,d,_){this.properties={},this.extent=u,this.type=0,this.id=void 0,this._pbf=t,this._geometry=-1,this._keys=d,this._values=_,t.readFields(rr,this,a)}loadGeometry(){const t=this._pbf;t.pos=this._geometry;const a=t.readVarint()+t.pos,u=[];let d,_=1,v=0,S=0,E=0;for(;t.pos<a;){if(v<=0){const R=t.readVarint();_=7&R,v=R>>3}if(v--,_===1||_===2)S+=t.readSVarint(),E+=t.readSVarint(),_===1&&(d&&u.push(d),d=[]),d&&d.push(new Tt(S,E));else{if(_!==7)throw new Error(`unknown command ${_}`);d&&d.push(d[0].clone())}}return d&&u.push(d),u}bbox(){const t=this._pbf;t.pos=this._geometry;const a=t.readVarint()+t.pos;let u=1,d=0,_=0,v=0,S=1/0,E=-1/0,R=1/0,P=-1/0;for(;t.pos<a;){if(d<=0){const B=t.readVarint();u=7&B,d=B>>3}if(d--,u===1||u===2)_+=t.readSVarint(),v+=t.readSVarint(),_<S&&(S=_),_>E&&(E=_),v<R&&(R=v),v>P&&(P=v);else if(u!==7)throw new Error(`unknown command ${u}`)}return[S,R,E,P]}toGeoJSON(t,a,u){const d=this.extent*Math.pow(2,u),_=this.extent*t,v=this.extent*a,S=this.loadGeometry();function E(F){return[360*(F.x+_)/d-180,360/Math.PI*Math.atan(Math.exp((1-2*(F.y+v)/d)*Math.PI))-90]}function R(F){return F.map(E)}let P;if(this.type===1){const F=[];for(const G of S)F.push(G[0]);const j=R(F);P=F.length===1?{type:"Point",coordinates:j[0]}:{type:"MultiPoint",coordinates:j}}else if(this.type===2){const F=S.map(R);P=F.length===1?{type:"LineString",coordinates:F[0]}:{type:"MultiLineString",coordinates:F}}else{if(this.type!==3)throw new Error("unknown feature type");{const F=(function(G){const Q=G.length;if(Q<=1)return[G];const J=[];let ee,se;for(let le=0;le<Q;le++){const he=tr(G[le]);he!==0&&(se===void 0&&(se=he<0),se===he<0?(ee&&J.push(ee),ee=[G[le]]):ee&&ee.push(G[le]))}return ee&&J.push(ee),J})(S),j=[];for(const G of F)j.push(G.map(R));P=j.length===1?{type:"Polygon",coordinates:j[0]}:{type:"MultiPolygon",coordinates:j}}}const B={type:"Feature",geometry:P,properties:this.properties};return this.id!=null&&(B.id=this.id),B}}function rr(s,t,a){s===1?t.id=a.readVarint():s===2?(function(u,d){const _=u.readVarint()+u.pos;for(;u.pos<_;){const v=d._keys[u.readVarint()],S=d._values[u.readVarint()];d.properties[v]=S}})(a,t):s===3?t.type=a.readVarint():s===4&&(t._geometry=a.pos)}function tr(s){let t=0;for(let a,u,d=0,_=s.length,v=_-1;d<_;v=d++)a=s[d],u=s[v],t+=(u.x-a.x)*(a.y+u.y);return t}pt.types=["Unknown","Point","LineString","Polygon"];class or{constructor(t,a){this.version=1,this.name="",this.extent=4096,this.length=0,this._pbf=t,this._keys=[],this._values=[],this._features=[],t.readFields(Qt,this,a),this.length=this._features.length}feature(t){if(t<0||t>=this._features.length)throw new Error("feature index out of bounds");this._pbf.pos=this._features[t];const a=this._pbf.readVarint()+this._pbf.pos;return new pt(this._pbf,a,this.extent,this._keys,this._values)}}function Qt(s,t,a){s===15?t.version=a.readVarint():s===1?t.name=a.readString():s===5?t.extent=a.readVarint():s===2?t._features.push(a.pos):s===3?t._keys.push(a.readString()):s===4&&t._values.push((function(u){let d=null;const _=u.readVarint()+u.pos;for(;u.pos<_;){const v=u.readVarint()>>3;d=v===1?u.readString():v===2?u.readFloat():v===3?u.readDouble():v===4?u.readVarint64():v===5?u.readVarint():v===6?u.readSVarint():v===7?u.readBoolean():null}if(d==null)throw new Error("unknown feature value");return d})(a))}class fr{constructor(t,a){this.layers=t.readFields(Mr,{},a)}}function Mr(s,t,a){if(s===3){const u=new or(a,a.readVarint()+a.pos);u.length&&(t[u.name]=u)}}const Or="3d_elevation_id",Si="level";class wr{constructor(){this._valid=!1}reset(t){return this.feature=t,this._valid=!0,this._geometry=t.loadGeometry(),this._geometry.length!==0&&this._geometry[0].length!==0||(this._valid=!1),this}geometry(t,a){return this._valid&&t(a(this._geometry)),this}require(t,a,u){return this.get(t,!0,a,u)}optional(t,a,u){return this.get(t,!1,a,u)}success(){return this._valid}get(t,a,u,d){const _=this.feature.properties.hasOwnProperty(t)?+this.feature.properties[t]:void 0;return this._valid&&_!==void 0&&!Number.isNaN(_)?u(d?d(_):_):a&&(this._valid=!1),this}}class ii{constructor(t,a){this.featureFunc=t,this.vertexFunc=a}parseFeature(t,a,u){return this.featureFunc(t,a,u)}parseVertex(t,a,u){return this.vertexFunc(t,a,u)}}const hi=new ii(((s,t,a)=>s.reset(t).require(Or,(u=>{a.id=u})).optional("fixed_height_relative",(u=>{a.constantHeight=u}),Lr.decodeRelativeHeight).geometry((u=>{a.bounds=u}),Kc).success()),((s,t,a)=>s.reset(t).require(Or,(u=>{a.id=u})).require("elevation_idx",(u=>{a.idx=u})).require("extent",(u=>{a.extent=u})).require("height_relative",(u=>{a.height=u}),Lr.decodeRelativeHeight).geometry((u=>{a.position=u}),Lr.getPoint).success())),_i=new ii(((s,t,a)=>s.reset(t).require(Or,(u=>{a.id=u})).optional("fixed_height",(u=>{a.constantHeight=u}),Lr.decodeMetricHeight).geometry((u=>{a.bounds=u}),Kc).success()),((s,t,a)=>s.reset(t).require(Or,(u=>{a.id=u})).require("elevation_idx",(u=>{a.idx=u})).require("extent",(u=>{a.extent=u})).require("height",(u=>{a.height=u}),Lr.decodeMetricHeight).geometry((u=>{a.position=u}),Lr.getPoint).success()));class Lr{static getPoint(t){return $s(t[0][0].x,t[0][0].y)}static decodeRelativeHeight(t){return 1e-4*t*5}static decodeMetricHeight(t){return 1e-4*t}static getVersionSchema(t){return t?t==="1.0.1"?_i:void 0:hi}static parse(t){const a=[],u=[],d=t.length,_=new wr;for(let v=0;v<d;v++){const S=t.feature(v),E=S.properties.version,R=Lr.getVersionSchema(E);if(R===void 0){ri(`Unknown elevation feature version number ${E||"(unknown)"}`);continue}const P=S.properties.type;if(!P)continue;const B=pt.types[S.type];if(B==="Point"&&P==="curve_point"){const F={};R.parseVertex(_,S,F)&&a.push(F)}else if(B==="Polygon"&&P==="curve_meta"){const F={};R.parseFeature(_,S,F)&&u.push(F)}}return{vertices:a,features:u}}}class fi{constructor(t,a){this.pos=t,this.dir=a}intersectsPlane(t,a,u){const d=xo(a,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((t[0]-this.pos[0])*a[0]+(t[1]-this.pos[1])*a[1])/d;return u[0]=this.pos[0]+this.dir[0]*_,u[1]=this.pos[1]+this.dir[1]*_,!0}}class li{constructor(t,a){this.pos=t,this.dir=a}intersectsPlane(t,a,u){const d=Vi(a,this.dir);if(Math.abs(d)<1e-6)return!1;const _=((t[0]-this.pos[0])*a[0]+(t[1]-this.pos[1])*a[1]+(t[2]-this.pos[2])*a[2])/d;return u[0]=this.pos[0]+this.dir[0]*_,u[1]=this.pos[1]+this.dir[1]*_,u[2]=this.pos[2]+this.dir[2]*_,!0}closestPointOnSphere(t,a,u){if((function(j,G){var Q=j[0],J=j[1],ee=j[2],se=G[0],le=G[1],he=G[2];return Math.abs(Q-se)<=C*Math.max(1,Math.abs(Q),Math.abs(se))&&Math.abs(J-le)<=C*Math.max(1,Math.abs(J),Math.abs(le))&&Math.abs(ee-he)<=C*Math.max(1,Math.abs(ee),Math.abs(he))})(this.pos,t)||a===0)return u[0]=u[1]=u[2]=0,!1;const[d,_,v]=this.dir,S=this.pos[0]-t[0],E=this.pos[1]-t[1],R=this.pos[2]-t[2],P=d*d+_*_+v*v,B=2*(S*d+E*_+R*v),F=B*B-4*P*(S*S+E*E+R*R-a*a);if(F<0){const j=Math.max(-B/2,0),G=S+d*j,Q=E+_*j,J=R+v*j,ee=Math.hypot(G,Q,J);return u[0]=G*a/ee,u[1]=Q*a/ee,u[2]=J*a/ee,!1}{const j=(-B-Math.sqrt(F))/(2*P);if(j<0){const G=Math.hypot(S,E,R);return u[0]=S*a/G,u[1]=E*a/G,u[2]=R*a/G,!1}return u[0]=S+d*j,u[1]=E+_*j,u[2]=R+v*j,!0}}}class di{constructor(t,a,u,d,_){this.TL=t,this.TR=a,this.BR=u,this.BL=d,this.horizon=_}static fromInvProjectionMatrix(t,a,u){const d=[-1,1,1],_=[1,1,1],v=[1,-1,1],S=[-1,-1,1],E=Tn(d,d,t),R=Tn(_,_,t),P=Tn(v,v,t),B=Tn(S,S,t);return new di(E,R,P,B,a/u)}}function Fi(s,t,a){let u=1/0,d=-1/0;const _=[];for(const v of s){On(_,v,t);const S=Vi(_,a);u=Math.min(u,S),d=Math.max(d,S)}return[u,d]}function Ii(s,t){let a=!0;for(let u=0;u<s.planes.length;u++){const d=s.planes[u];let _=0;for(let v=0;v<t.length;v++)_+=+(Vi(d,t[v])+d[3]>=0);if(_===0)return 0;_!==t.length&&(a=!1)}return a?2:1}function In(s,t){for(const a of s.projections){const u=Fi(t,s.points[0],a.axis);if(a.projection[1]<u[0]||a.projection[0]>u[1])return 0}return 1}function Ui(s,t){let a=0;const u=[0,0,0,0];for(let v=0;v<s.length;v++)u[0]=s[v][0],u[1]=s[v][1],u[2]=s[v][2],u[3]=1,(d=u)[0]*(_=t)[0]+d[1]*_[1]+d[2]*_[2]+d[3]*_[3]>=0&&a++;var d,_;return a}class Pr{constructor(t,a){this.points=t||new Array(8).fill([0,0,0]),this.planes=a||new Array(6).fill([0,0,0,0]),this.bounds=br.fromPoints(this.points),this.projections=[],this.frustumEdges=[On([],this.points[2],this.points[3]),On([],this.points[0],this.points[3]),On([],this.points[4],this.points[0]),On([],this.points[5],this.points[1]),On([],this.points[6],this.points[2]),On([],this.points[7],this.points[3])];for(const u of this.frustumEdges){const d=[0,-u[2],u[1]],_=[u[2],0,-u[0]];this.projections.push({axis:d,projection:Fi(this.points,this.points[0],d)}),this.projections.push({axis:_,projection:Fi(this.points,this.points[0],_)})}}static fromInvProjectionMatrix(t,a,u,d){const _=Math.pow(2,u),v=[[-1,1,-1,1],[1,1,-1,1],[1,-1,-1,1],[-1,-1,-1,1],[-1,1,1,1],[1,1,1,1],[1,-1,1,1],[-1,-1,1,1]].map((R=>{const P=Wo([],R,t),B=1/P[3]/a*_;return(F=P)[0]=(j=P)[0]*(G=[B,B,d?1/P[3]:B,B])[0],F[1]=j[1]*G[1],F[2]=j[2]*G[2],F[3]=j[3]*G[3],F;var F,j,G})),S=[[0,1,2],[6,5,4],[0,3,7],[2,1,5],[3,2,6],[0,4,5]].map((R=>{const P=Cr([],vi([],On([],v[R[0]],v[R[1]]),On([],v[R[2]],v[R[1]]))),B=-Vi(P,v[R[1]]);return P.concat(B)})),E=[];for(let R=0;R<v.length;R++)E.push([v[R][0],v[R][1],v[R][2]]);return new Pr(E,S)}intersectsPrecise(t,a,u){for(let d=0;d<a.length;d++)if(!Ui(t,a[d]))return 0;for(let d=0;d<this.planes.length;d++)if(!Ui(t,this.planes[d]))return 0;for(const d of u)for(const _ of this.frustumEdges){const v=vi([],d,_),S=ui(v);if(S===0)continue;Vt(v,v,1/S);const E=Fi(this.points,this.points[0],v),R=Fi(t,this.points[0],v);if(E[0]>R[1]||R[0]>E[1])return 0}return 1}containsPoint(t){for(const a of this.planes){const u=a[3];if(Vi([a[0],a[1],a[2]],t)+u<0)return!1}return!0}}class br{static fromPoints(t){const a=[1/0,1/0,1/0],u=[-1/0,-1/0,-1/0];for(const d of t)Pi(a,a,d),it(u,u,d);return new br(a,u)}static fromTileIdAndHeight(t,a,u){const d=1<<t.canonical.z,_=t.canonical.x,v=t.canonical.y;return new br([_/d,v/d,a],[(_+1)/d,(v+1)/d,u])}static applyTransform(t,a){const u=t.getCorners();for(let d=0;d<u.length;++d)Tn(u[d],u[d],a);return br.fromPoints(u)}static applyTransformFast(t,a){const u=[a[12],a[13],a[14]],d=[...u];for(let _=0;_<3;_++)for(let v=0;v<3;v++){const S=a[4*v+_],E=S*t.min[v],R=S*t.max[v];u[_]+=Math.min(E,R),d[_]+=Math.max(E,R)}return new br(u,d)}static projectAabbCorners(t,a){const u=t.getCorners();for(let d=0;d<u.length;++d)Tn(u[d],u[d],a);return u}constructor(t,a){this.min=t,this.max=a,this.center=Vt([],Ot([],this.min,this.max),.5)}quadrant(t){const a=[t%2==0,t<2],u=Kr(this.min),d=Kr(this.max);for(let _=0;_<a.length;_++)u[_]=a[_]?this.min[_]:this.center[_],d[_]=a[_]?this.center[_]:this.max[_];return d[2]=this.max[2],new br(u,d)}distanceX(t){return Math.max(Math.min(this.max[0],t[0]),this.min[0])-t[0]}distanceY(t){return Math.max(Math.min(this.max[1],t[1]),this.min[1])-t[1]}distanceZ(t){return Math.max(Math.min(this.max[2],t[2]),this.min[2])-t[2]}getCorners(){const t=this.min,a=this.max;return[[t[0],t[1],t[2]],[a[0],t[1],t[2]],[a[0],a[1],t[2]],[t[0],a[1],t[2]],[t[0],t[1],a[2]],[a[0],t[1],a[2]],[a[0],a[1],a[2]],[t[0],a[1],a[2]]]}intersects(t){return this.intersectsAabb(t.bounds)?Ii(t,this.getCorners()):0}intersectsFlat(t){return this.intersectsAabb(t.bounds)?Ii(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsPrecise(t,a){return a||this.intersects(t)?In(t,this.getCorners()):0}intersectsPreciseFlat(t,a){return a||this.intersectsFlat(t)?In(t,[[this.min[0],this.min[1],0],[this.max[0],this.min[1],0],[this.max[0],this.max[1],0],[this.min[0],this.max[1],0]]):0}intersectsAabb(t){for(let a=0;a<3;++a)if(this.min[a]>t.max[a]||t.min[a]>this.max[a])return!1;return!0}intersectsAabbXY(t){return!(this.min[0]>t.max[0]||t.min[0]>this.max[0]||this.min[1]>t.max[1]||t.min[1]>this.max[1])}encapsulate(t){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],t.min[a]),this.max[a]=Math.max(this.max[a],t.max[a])}encapsulatePoint(t){for(let a=0;a<3;a++)this.min[a]=Math.min(this.min[a],t[a]),this.max[a]=Math.max(this.max[a],t[a])}closestPoint(t){return[Math.max(Math.min(this.max[0],t[0]),this.min[0]),Math.max(Math.min(this.max[1],t[1]),this.min[1]),Math.max(Math.min(this.max[2],t[2]),this.min[2])]}}$t(br,"Aabb");class Ti{constructor(t,a){this.feature=t,this.metersToTile=a,this.index=0}get(){const t=this.feature.vertices[this.index],a=this.feature.vertexProps[this.index].dir,u=a[1],d=-a[0],_=(t.extent+1)*this.metersToTile;return[new Tt(Math.trunc(t.position[0]+u*_),Math.trunc(t.position[1]+d*_)),new Tt(Math.trunc(t.position[0]-u*_),Math.trunc(t.position[1]-d*_))]}next(){this.index++}valid(){return this.index<this.feature.vertices.length}}class vn{constructor(t,a,u,d,_,v){if(this.vertices=new Array,this.vertexProps=new Array,this.edges=new Array,this.edgeProps=new Array,this._tmpVec2=[Mo(),Mo(),Mo(),Mo(),Mo(),Mo(),Mo()],this.id=t,this.heightRange={min:u,max:u},this.safeArea=a,this.constantHeight=u,this.constantHeight==null&&(this.constantHeight!=null||d.length!==0)){this.vertices=d,this.edges=_,this.edges=this.edges.filter((S=>{return S.a<this.vertices.length&&S.b<this.vertices.length&&!((E=this.vertices[S.a].position)[0]===(R=this.vertices[S.b].position)[0]&&E[1]===R[1]);var E,R})),this.heightRange={min:Number.POSITIVE_INFINITY,max:Number.NEGATIVE_INFINITY};for(const S of this.vertices)this.vertexProps.push({dir:$s(0,0)}),this.heightRange.min=Math.min(this.heightRange.min,S.height),this.heightRange.max=Math.max(this.heightRange.max,S.height);for(const S of this.edges){const E=this.vertices[S.a].position,R=this.vertices[S.b].position,P=oa(Mo(),R,E),B=Zs(P),F=vs(Mo(),P,1/B);this.edgeProps.push({vec:P,dir:F,len:B});const j=this.vertexProps[S.a].dir,G=this.vertexProps[S.b].dir;Xs(j,j,F),Xs(G,G,F)}for(const S of this.vertexProps)S.dir[0]===0&&S.dir[1]===0||gn(S.dir,S.dir);this.tessellate(v)}}pointElevation(t){if(this.constantHeight!=null)return this.constantHeight;const a=this.getClosestEdge(t);if(a==null)return 0;const[u,d]=a;return xr(this.vertices[this.edges[u].a].height,this.vertices[this.edges[u].b].height,d)}computeSlopeNormal(t,a){const u=this.getClosestEdge(t);if(!u)return zi(0,0,1);const d=u[0],_=this.edges[d],v=this.edgeProps[d].vec,S=zi(v[0],v[1],(this.vertices[_.b].height-this.vertices[_.a].height)*a),E=zi(S[1],-S[0],0);vi(E,E,S);const R=ui(E);return R>0?Vt(E,E,1/R):Qr(E,0,0,1)}getSafeArea(){return this.safeArea}isTunnel(){return this.heightRange.max<=-5}getClosestEdge(t){if(this.edges.length===0)return;let a=0,u=Number.POSITIVE_INFINITY,d=0;const[_,v,S,E,R,P,B]=this._tmpVec2;Nc(B,t.x,t.y);const F=new fi(B,null);for(let j=0;j<this.edges.length;j++){const G=this.edges[j],Q=this.edgeProps[j].dir;F.dir=Q;const J=this.vertices[G.a].position,ee=this.vertices[G.b].position,se=F.intersectsPlane(J,this.vertexProps[G.a].dir,_),le=F.intersectsPlane(ee,this.vertexProps[G.b].dir,v);if(!se||!le)continue;oa(S,v,_),oa(E,B,_);const he=xo(S,S),Ee=he>0?xo(E,S)/he:0,Ce=Ie(Ee,0,1),De=Math.abs((Ee-Ce)*this.edgeProps[j].len);oa(R,B,J),Nc(P,Q[1],-Q[0]);const Le=De+Math.abs(xo(R,P));Le<u&&(a=j,u=Le,d=Ce)}return[a,d]}tessellate(t){const a=pr(),u=pr(),d=pr(),_=pr();for(let v=this.edges.length-1;v>=0;--v){const S=this.edges[v].a,E=this.edges[v].b,{position:R,height:P,extent:B}=this.vertices[S],{position:F,height:j,extent:G}=this.vertices[E],Q=this.vertexProps[S].dir,J=this.vertexProps[E].dir;if(Qr(a,R[0]/t,R[1]/t,P),Qr(u,F[0]/t,F[1]/t,j),Qr(d,Q[1],-Q[0],0),Vt(d,d,B),Qr(_,J[1],-J[0],0),Vt(_,_,G),this.distSqLines(zi(a[0]+.5*d[0],a[1]+.5*d[1],a[2]+.5*d[2]),zi(u[0]-.5*_[0],u[1]-.5*_[1],u[2]-.5*_[2]),zi(a[0]-.5*d[0],a[1]-.5*d[1],a[2]-.5*d[2]),zi(u[0]+.5*_[0],u[1]+.5*_[1],u[2]+.5*_[2]))<=.0025000000000000005)continue;const ee=this.vertices.length,se=Xs(Mo(),R,F);this.vertices.push({position:vs(se,se,.5),height:.5*(P+j),extent:.5*(B+G)});const le=Xs(Mo(),Q,J);this.vertexProps.push({dir:gn(le,le)}),this.edges.splice(v,1),this.edgeProps.splice(v,1),this.edges.push({a:S,b:ee}),this.edges.push({a:ee,b:E});const he=oa(Mo(),this.vertices[ee].position,R),Ee=Zs(he),Ce={vec:he,dir:vs(Mo(),he,1/Ee),len:Ee};this.edgeProps.push(Ce),this.edgeProps.push(Ce)}}distSqLines(t,a,u,d){const _=sr(pr(),a,t),v=sr(pr(),d,u),S=sr(pr(),t,u),E=Vi(_,_),R=Vi(_,v),P=Vi(_,S),B=Vi(v,v),F=Vi(v,S),j=E*B-R*R;if(j===0)return Rr(ho(_,u,d,Vi(S,v)/Vi(v,v)),t);const G=(E*F-R*P)/j;return Rr(ho(_,t,a,(R*F-P*B)/j),ho(v,u,d,G))}}class Xi{static parseFrom(t,a){const u=Lr.parse(t);if(!u)return[];let{vertices:d,features:_}=u;const v=1/Ge(a);_.sort(((P,B)=>P.id-B.id)),d.sort(((P,B)=>P.id-B.id||P.idx-B.idx)),d=d.filter(((P,B,F)=>B===F.findIndex((j=>j.id===P.id&&j.idx===P.idx))));const S=new Array;let E=0;const R=d.length;for(const P of _){if(P.constantHeight){S.push(new vn(P.id,P.bounds,P.constantHeight));continue}for(;E!==R&&d[E].id<P.id;)E++;if(E===R||d[E].id!==P.id)continue;const B=new Array,F=new Array,j=E;for(;E!==R&&d[E].id===P.id;){const G=d[E];if(B.push({position:G.position,height:G.height,extent:G.extent}),E!==j&&d[E-1].idx===G.idx-1){const Q=E-j;F.push({a:Q-1,b:Q})}E++}S.push(new vn(P.id,P.bounds,void 0,B,F,v))}return S}static getElevationFeature(t,a){if(!a)return;const u=+t.properties[Or];return Number.isNaN(u)?void 0:a.find((d=>d.id===u))}}class Bn{constructor(t,a){this.zScale=1,this.xOffset=0,this.yOffset=0,t.equals(a)||(this.zScale=Math.pow(2,a.z-t.z),this.xOffset=(t.x*this.zScale-a.x)*Bt,this.yOffset=(t.y*this.zScale-a.y)*Bt)}constantElevation(t,a){if(t.constantHeight!=null)return this.computeBiasedHeight(t.constantHeight,a)}pointElevation(t,a,u){const d=this.constantElevation(a,u);return d??(t.x=t.x*this.zScale+this.xOffset,t.y=t.y*this.zScale+this.yOffset,this.computeBiasedHeight(a.pointElevation(t),u))}computeBiasedHeight(t,a){return a<=0?t:t+a*Qe(0,a,t>=0?t:Math.abs(.5*t))}}$t(vn,"ElevationFeature");class xn{constructor(t){this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.projection=t.projection,this.layoutVertexArray=new ss,this.indexArray=new Cn,this.segments=new hn,this.programConfigurations=new Bo(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.elevationMode=this.layers[0].layout.get("circle-elevation-reference"),this.hasElevation=!1,this.elevationMode!=="none"&&(this.elevatedLayoutVertexArray=new Ps),this.worldview=t.worldview}updateFootprints(t,a){}populate(t,a,u,d){const _=this.layers[0],v=[];let S=null;_.type==="circle"&&(S=_.layout.get("circle-sort-key"));for(const{feature:R,id:P,index:B,sourceLayerIndex:F}of t){const j=this.layers[0]._featureFilter.needGeometry,G=ft(R,j);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom,{worldview:this.worldview}),G,u))continue;const Q=S?S.evaluate(G,{},u):void 0,J={id:P,properties:R.properties,type:R.type,sourceLayerIndex:F,index:B,geometry:j?G.geometry:wt(R,u,d),patterns:{},sortKey:Q};v.push(J)}S&&v.sort(((R,P)=>R.sortKey-P.sortKey));let E=null;d.projection.name==="globe"&&(this.globeExtVertexArray=new il,E=d.projection);for(const R of v){const{geometry:P,index:B,sourceLayerIndex:F}=R,j=t[B].feature;this.addFeature(R,P,B,a.availableImages,u,E,a.brightness,a.elevationFeatures),a.featureIndex.insert(j,P,B,F,this.index)}this.hasElevation||(this.elevatedLayoutVertexArray=void 0)}update(t,a,u,d,_,v,S){this.programConfigurations.updatePaintArrays(t,a,_,u,d,v,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Um.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.globeExtVertexArray&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,jm.members)),this.elevatedLayoutVertexArray&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,Lp.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy())}addFeature(t,a,u,d,_,v,S,E){let R;this.elevationMode!=="none"&&(R=Xi.getElevationFeature(t,E));for(const P of a)for(const B of P){const F=B.x,j=B.y;if(F<0||F>=Bt||j<0||j>=Bt)continue;if(v){const J=v.projectTilePoint(F,j,_),ee=v.upVector(_,F,j);this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee),this.addGlobeExtVertex(J,ee)}const G=this.segments.prepareSegment(4,this.layoutVertexArray,this.indexArray,t.sortKey),Q=G.vertexLength;if(this.addCircleVertex(F,j,-1,-1),this.addCircleVertex(F,j,1,-1),this.addCircleVertex(F,j,1,1),this.addCircleVertex(F,j,-1,1),this.elevationMode!=="none"){const J=R?R.pointElevation(new Tt(F,j)):0;this.hasElevation=this.hasElevation||J!==0;for(let ee=0;ee<4;ee++)this.elevatedLayoutVertexArray.emplaceBack(J)}this.indexArray.emplaceBack(Q,Q+1,Q+2),this.indexArray.emplaceBack(Q,Q+2,Q+3),G.vertexLength+=4,G.primitiveLength+=2}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,{},d,_,S,void 0,this.worldview)}addCircleVertex(t,a,u,d){this.layoutVertexArray.emplaceBack(2*t+(u+1)/2,2*a+(d+1)/2)}addGlobeExtVertex(t,a){this.globeExtVertexArray.emplaceBack(t.x,t.y,t.z,a[0]*16384,a[1]*16384,a[2]*16384)}}function $a(s,t){for(let a=0;a<s.length;a++)if(lo(t,s[a]))return!0;for(let a=0;a<t.length;a++)if(lo(s,t[a]))return!0;return!!da(s,t)}function Wn(s,t,a){return!!lo(s,t)||!!fn(t,s,a)}function Ia(s,t){if(s.length===1)return Yn(t,s[0]);for(let a=0;a<t.length;a++){const u=t[a];for(let d=0;d<u.length;d++)if(lo(s,u[d]))return!0}for(let a=0;a<s.length;a++)if(Yn(t,s[a]))return!0;for(let a=0;a<t.length;a++)if(da(s,t[a]))return!0;return!1}function Ra(s,t,a){if(s.length>1){if(da(s,t))return!0;for(let u=0;u<t.length;u++)if(fn(t[u],s,a))return!0}for(let u=0;u<s.length;u++)if(fn(s[u],t,a))return!0;return!1}function da(s,t){if(s.length===0||t.length===0)return!1;for(let a=0;a<s.length-1;a++){const u=s[a],d=s[a+1];for(let _=0;_<t.length-1;_++)if(zo(u,d,t[_],t[_+1]))return!0}return!1}function zo(s,t,a,u){return An(s,a,u)!==An(t,a,u)&&An(s,t,a)!==An(s,t,u)}function Xa(s,t,a){return(s.x-a.x)*(t.y-a.y)-(s.y-a.y)*(t.x-a.x)}function bn(s,t,a,u){const d=Xa(s,t,u),_=Xa(s,t,a);if(Math.sign(d)===Math.sign(_))return;const v=Xa(a,u,s),S=v+_-d;return Math.sign(v)!==Math.sign(S)?[v/(v-S),_/(_-d)]:void 0}function fn(s,t,a){const u=a*a;if(t.length===1)return s.distSqr(t[0])<u;for(let d=1;d<t.length;d++)if(rn(s,t[d-1],t[d])<u)return!0;return!1}function rn(s,t,a){const u=t.distSqr(a);if(u===0)return s.distSqr(t);const d=((s.x-t.x)*(a.x-t.x)+(s.y-t.y)*(a.y-t.y))/u;return s.distSqr(d<0?t:d>1?a:a.sub(t)._mult(d)._add(t))}function Yn(s,t){let a,u,d,_=!1;for(let v=0;v<s.length;v++){a=s[v];for(let S=0,E=a.length-1;S<a.length;E=S++)u=a[S],d=a[E],u.y>t.y!=d.y>t.y&&t.x<(d.x-u.x)*(t.y-u.y)/(d.y-u.y)+u.x&&(_=!_)}return _}function lo(s,t){let a=!1;for(let u=0,d=s.length-1;u<s.length;d=u++){const _=s[u],v=s[d];_.y>t.y!=v.y>t.y&&t.x<(v.x-_.x)*(t.y-_.y)/(v.y-_.y)+_.x&&(a=!a)}return a}function Rn(s,t,a,u,d){for(const v of s)if(t<=v.x&&a<=v.y&&u>=v.x&&d>=v.y)return!0;const _=[new Tt(t,a),new Tt(t,d),new Tt(u,d),new Tt(u,a)];if(s.length>2){for(const v of _)if(lo(s,v))return!0}for(let v=0;v<s.length-1;v++)if(Ao(s[v],s[v+1],_))return!0;return!1}function Ao(s,t,a){const u=a[0],d=a[2];if(s.x<u.x&&t.x<u.x||s.x>d.x&&t.x>d.x||s.y<u.y&&t.y<u.y||s.y>d.y&&t.y>d.y)return!1;const _=An(s,t,a[0]);return _!==An(s,t,a[1])||_!==An(s,t,a[2])||_!==An(s,t,a[3])}function Fl(s,t,a,u,d,_){let v=t.y-s.y,S=s.x-t.x;if(_=_||0){const E=v*v+S*S;if(E===0)return!0;const R=Math.sqrt(E);v/=R,S/=R}return!((a.x-s.x)*v+(a.y-s.y)*S-_<0||(u.x-s.x)*v+(u.y-s.y)*S-_<0||(d.x-s.x)*v+(d.y-s.y)*S-_<0)}function Oc(s,t,a,u,d,_,v){return!(Fl(s,t,u,d,_,v)||Fl(t,a,u,d,_,v)||Fl(a,s,u,d,_,v)||Fl(u,d,s,t,a,v)||Fl(d,_,s,t,a,v)||Fl(_,u,s,t,a,v))}function al(s,t,a){const u=t.paint.get(s).value;return u.kind==="constant"?u.value:a.programConfigurations.get(t.id).getMaxValue(s)}function Pc(s){return Math.sqrt(s[0]*s[0]+s[1]*s[1])}function Lc(s,t,a,u,d){if(!t[0]&&!t[1])return s;const _=Tt.convert(t)._mult(d);a==="viewport"&&_._rotate(-u);const v=[];for(let S=0;S<s.length;S++)v.push(s[S].sub(_));return v}function Ma(s,t,a,u){const d=Tt.convert(s)._mult(u);return t==="viewport"&&d._rotate(-a),d}let Bc,kl;function sl(s,t,a){var u=2*Math.PI*6378137/256/Math.pow(2,a);return[s*u-2*Math.PI*6378137/2,t*u-2*Math.PI*6378137/2]}$t(xn,"CircleBucket",{omit:["layers"]});class Nl{constructor(t,a,u){this.z=t,this.x=a,this.y=u,this.key=Td(0,t,t,a,u)}equals(t){return this.z===t.z&&this.x===t.x&&this.y===t.y}isChildOf(t){const a=this.z-t.z;return t.z===0||t.z<this.z&&t.x===this.x>>a&&t.y===this.y>>a}url(t,a){const u=(function(_,v,S){var E=sl(256*_,256*(v=Math.pow(2,S)-v-1),S),R=sl(256*(_+1),256*(v+1),S);return E[0]+","+E[1]+","+R[0]+","+R[1]})(this.x,this.y,this.z),d=(function(_,v,S){let E,R="";for(let P=_;P>0;P--)E=1<<P-1,R+=(v&E?1:0)+(S&E?2:0);return R})(this.z,this.x,this.y);return t[(this.x+this.y)%t.length].replace("{prefix}",(this.x%16).toString(16)+(this.y%16).toString(16)).replace(/{z}/g,String(this.z)).replace(/{x}/g,String(this.x)).replace(/{y}/g,String(a==="tms"?Math.pow(2,this.z)-this.y-1:this.y)).replace("{quadkey}",d).replace("{bbox-epsg-3857}",u)}toString(){return`${this.z}/${this.x}/${this.y}`}}class Sd{constructor(t,a){this.wrap=t,this.canonical=a,this.key=Td(t,a.z,a.z,a.x,a.y)}}class ta{constructor(t,a,u,d,_){this.overscaledZ=t,this.wrap=a,this.canonical=new Nl(u,+d,+_),this.key=a===0&&t===u?this.canonical.key:Td(a,t,u,d,_)}equals(t){return this.overscaledZ===t.overscaledZ&&this.wrap===t.wrap&&this.canonical.equals(t.canonical)}scaledTo(t){const a=this.canonical.z-t;return t>this.canonical.z?new ta(t,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y):new ta(t,this.wrap,t,this.canonical.x>>a,this.canonical.y>>a)}calculateScaledKey(t,a=!0){if(this.overscaledZ===t&&a)return this.key;if(t>this.canonical.z)return Td(this.wrap*+a,t,this.canonical.z,this.canonical.x,this.canonical.y);{const u=this.canonical.z-t;return Td(this.wrap*+a,t,t,this.canonical.x>>u,this.canonical.y>>u)}}isChildOf(t){if(t.wrap!==this.wrap)return!1;const a=this.canonical.z-t.canonical.z;return t.overscaledZ===0||t.overscaledZ<this.overscaledZ&&t.canonical.z<this.canonical.z&&t.canonical.x===this.canonical.x>>a&&t.canonical.y===this.canonical.y>>a}children(t){if(this.overscaledZ>=t)return[new ta(this.overscaledZ+1,this.wrap,this.canonical.z,this.canonical.x,this.canonical.y)];const a=this.canonical.z+1,u=2*this.canonical.x,d=2*this.canonical.y;return[new ta(a,this.wrap,a,u,d),new ta(a,this.wrap,a,u+1,d),new ta(a,this.wrap,a,u,d+1),new ta(a,this.wrap,a,u+1,d+1)]}isLessThan(t){return this.wrap<t.wrap||!(this.wrap>t.wrap)&&(this.overscaledZ<t.overscaledZ||!(this.overscaledZ>t.overscaledZ)&&(this.canonical.x<t.canonical.x||!(this.canonical.x>t.canonical.x)&&this.canonical.y<t.canonical.y))}wrapped(){return new ta(this.overscaledZ,0,this.canonical.z,this.canonical.x,this.canonical.y)}unwrapTo(t){return new ta(this.overscaledZ,t,this.canonical.z,this.canonical.x,this.canonical.y)}overscaleFactor(){return Math.pow(2,this.overscaledZ-this.canonical.z)}toUnwrapped(){return new Sd(this.wrap,this.canonical)}toString(){return`${this.overscaledZ}/${this.canonical.x}/${this.canonical.y}`}}function Td(s,t,a,u,d){const _=1<<Math.min(a,22);let v=_*(d%_)+u%_;return s&&a<22&&(v+=_*_*((s<0?-2*s-1:2*s)%(1<<2*(22-a)))),16*(32*v+a)+(t-a)}const Gg=[s=>{let t=s.canonical.x-1,a=s.wrap;return t<0&&(t=(1<<s.canonical.z)-1,a--),new ta(s.overscaledZ,a,s.canonical.z,t,s.canonical.y)},s=>{let t=s.canonical.x+1,a=s.wrap;return t===1<<s.canonical.z&&(t=0,a++),new ta(s.overscaledZ,a,s.canonical.z,t,s.canonical.y)},s=>new ta(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,(s.canonical.y===0?1<<s.canonical.z:s.canonical.y)-1),s=>new ta(s.overscaledZ,s.wrap,s.canonical.z,s.canonical.x,s.canonical.y===(1<<s.canonical.z)-1?0:s.canonical.y+1)];$t(Nl,"CanonicalTileID"),$t(ta,"OverscaledTileID",{omit:["projMatrix","expandedProjMatrix"]});const Fy=ei([{type:"Float32",name:"a_globe_pos",components:3},{type:"Float32",name:"a_uv",components:2}]),{members:Gm}=Fy,Qn=ei([{name:"a_pos_3",components:3,type:"Int16"}]);var Hg=ei([{name:"a_pos",type:"Int16",components:2}]);function qg(s){return s*p/X}const ky=[new br([z,z,z],[k,k,k]),new br([z,z,z],[0,0,k]),new br([0,z,z],[k,0,k]),new br([z,0,z],[0,k,k]),new br([0,0,z],[k,k,k])];function Ny(s,t,a,u=!0){const d=Vt([],s._camera.position,s.worldSize),_=[t,a,1,1];Wo(_,_,s.pixelMatrixInverse),na(_,_,1/_[3]);const v=Cr([],On([],_,d)),S=s.globeMatrix,E=[S[12],S[13],S[14]],R=On([],E,d),P=ui(R),B=Cr([],R),F=s.worldSize/(2*Math.PI),j=Vi(B,v),G=Math.asin(F/P);if(G<Math.acos(j)){if(!u)return null;const ut=[],Ue=[];Vt(ut,v,P/j),Cr(Ue,On(Ue,ut,R)),Cr(v,Ot(v,R,Vt(v,Ue,Math.tan(G)*P)))}const Q=[];new li(d,v).closestPointOnSphere(E,F,Q);const J=Cr([],_n(S,0)),ee=Cr([],_n(S,1)),se=Cr([],_n(S,2)),le=Vi(J,Q),he=Vi(ee,Q),Ee=Vi(se,Q),Ce=te(Math.asin(-he/F));let De=te(Math.atan2(le,Ee));De=s.center.lng+(function(ut,Ue){const dt=(Ue-ut+180)%360-180;return dt<-180?dt+360:dt})(s.center.lng,De);const Le=fe(De),Fe=Ie(xe(Ce),0,1);return new tt(Le,Fe)}class Yv{constructor(t,a,u){this.a=On([],t,u),this.b=On([],a,u),this.center=u;const d=Cr([],this.a),_=Cr([],this.b);this.angle=Math.acos(Vi(d,_))}}function r0(s,t){if(s.angle===0)return null;let a;return a=s.a[t]===0?1/s.angle*.5*Math.PI:1/s.angle*Math.atan(s.b[t]/s.a[t]/Math.sin(s.angle)-1/Math.tan(s.angle)),a<0||a>1?null:(function(u,d,_,v){const S=Math.sin(_);return u*(Math.sin((1-v)*_)/S)+d*(Math.sin(v*_)/S)})(s.a[t],s.b[t],s.angle,Ie(a,0,1))+s.center[t]}function ll(s){if(s.z<=1)return ky[s.z+2*s.y+s.x];const t=dh(zp(s));return br.fromPoints(t)}function Bs(s,t,a){return Vt(s,s,1-a),Er(s,s,t,a)}function $g(s,t,a){for(const u of s)Tn(u,u,t),Vt(u,u,a)}function Hm(s,t,a,u){const d=t/s.worldSize,_=s.globeMatrix;if(a.z<=1){const Fe=ll(a).getCorners();return $g(Fe,_,d),br.fromPoints(Fe)}const v=zp(a,u),S=dh(v,p+qg(s._tileCoverLift));$g(S,_,d);const E=Number.MAX_VALUE,R=[-E,-E,-E],P=[E,E,E];if(v.contains(s.center)){for(const Ue of S)Pi(P,P,Ue),it(R,R,Ue);R[2]=0;const Fe=s.point,ut=[Fe.x*d,Fe.y*d,0];return Pi(P,P,ut),it(R,R,ut),new br(P,R)}if(s._tileCoverLift>0){for(const Fe of S)Pi(P,P,Fe),it(R,R,Fe);return new br(P,R)}const B=[_[12]*d,_[13]*d,_[14]*d],F=v.getCenter(),j=Ie(s.center.lat,-Se,Se),G=Ie(F.lat,-Se,Se),Q=fe(s.center.lng),J=xe(j);let ee=Q-fe(F.lng);const se=J-xe(G);ee>.5?ee-=1:ee<-.5&&(ee+=1);let le=0;Math.abs(ee)>Math.abs(se)?le=ee>=0?1:3:(le=se>=0?0:2,Er(B,B,[_[4]*d,_[5]*d,_[6]*d],-Math.sin(Ne(se>=0?v.getSouth():v.getNorth()))*p));const he=S[le],Ee=S[(le+1)%4],Ce=new Yv(he,Ee,B),De=[r0(Ce,0)||he[0],r0(Ce,1)||he[1],r0(Ce,2)||he[2]],Le=Tu(s.zoom);if(Le>0){const Fe=(function({x:Ue,y:dt,z:St},gt,yt,Rt,lt){const vt=1/(1<<St);let et=Ue*vt,We=et+vt,Dt=dt*vt,Et=Dt+vt,dr=0;const Zt=(et+We)/2-Rt;return Zt>.5?dr=-1:Zt<-.5&&(dr=1),et=((et+dr)*gt-(Rt*=gt))*yt+Rt,We=((We+dr)*gt-Rt)*yt+Rt,Dt=(Dt*gt-(lt*=gt))*yt+lt,Et=(Et*gt-lt)*yt+lt,[[et,Et,0],[We,Et,0],[We,Dt,0],[et,Dt,0]]})(a,t,s._pixelsPerMercatorPixel,Q,J);for(let Ue=0;Ue<S.length;Ue++)Bs(S[Ue],Fe[Ue],Le);const ut=Ot([],Fe[le],Fe[(le+1)%4]);Vt(ut,ut,.5),Bs(De,ut,Le)}for(const Fe of S)Pi(P,P,Fe),it(R,R,Fe);return P[2]=Math.min(he[2],Ee[2]),Pi(P,P,De),it(R,R,De),new br(P,R)}function zp({x:s,y:t,z:a},u=!1){const d=1/(1<<a),_=new W(Te(s*d),t===(1<<a)-1&&u?-90:ye((t+1)*d)),v=new W(Te((s+1)*d),t===0&&u?90:ye(t*d));return new re(_,v)}function dh(s,t=p){const a=Ne(s.getNorth()),u=Ne(s.getSouth()),d=Math.cos(a),_=Math.cos(u),v=Math.sin(a),S=Math.sin(u),E=s.getWest(),R=s.getEast();return[H(_,S,E,t),H(_,S,R,t),H(d,v,R,t),H(d,v,E,t)]}function zs(s,t,a,u){const d=1<<a.z,_=(s/Bt+a.x)/d;return V(ye((t/Bt+a.y)/d),Te(_),u)}function gf({min:s,max:t}){return A/Math.max(t[0]-s[0],t[1]-s[1],t[2]-s[2])}const Vy=new Float64Array(16);function qm(s){const t=gf(s),a=Ct(Vy,[t,t,t]);return we(a,a,Gi([],s.min))}function Xg(s){const t=(u=s.min,(a=Vy)[0]=1,a[1]=0,a[2]=0,a[3]=0,a[4]=0,a[5]=1,a[6]=0,a[7]=0,a[8]=0,a[9]=0,a[10]=1,a[11]=0,a[12]=u[0],a[13]=u[1],a[14]=u[2],a[15]=1,a);var a,u;const d=1/gf(s);return Pe(t,t,[d,d,d])}function Zg(s){const t=Bt/(2*Math.PI);return s/(2*Math.PI)/t}function i0(s,t){return Bt/(512*Math.pow(2,s))*gf(ll(t))}function Uy(s,t,a,u,d){const _=Zg(a),v=[s,t,-a/(2*Math.PI)],S=ne(new Float64Array(16));return we(S,S,v),Pe(S,S,[_,_,_]),Ze(S,S,Ne(-d)),$e(S,S,Ne(-u)),S}function Tu(s){return Qe(x,w,s)}function n0(s,t){const a=V(t.lat,t.lng),u=(function(G){const Q=V(G._center.lat,G._center.lng);let J=vi([],zi(0,1,0),Q);const ee=Ft([],-G.angle,Q);J=Tn(J,J,ee),Ft(ee,-G._pitch,J);const se=Cr([],Q);return Vt(se,se,qg(G.cameraToCenterDistance/G.pixelsPerMeter)),Tn(se,se,ee),Ot([],Q,se)})(s);return v=(d=sr([],u,a))[0],S=d[1],E=d[2],R=(_=a)[0],P=_[1],B=_[2],j=(F=Math.sqrt((v*v+S*S+E*E)*(R*R+P*P+B*B)))&&Vi(d,_)/F,Math.acos(Math.min(Math.max(j,-1),1));var d,_,v,S,E,R,P,B,F,j}function Wg(s,t){return n0(s,t)>Math.PI/2*1.01}const jy=Ne(85),o0=Math.cos(jy),a0=Math.sin(jy),Qv=ie(),Gy=s=>{const t=[];return s.paint.get("circle-pitch-alignment")==="map"&&t.push("PITCH_WITH_MAP"),s.paint.get("circle-pitch-scale")==="map"&&t.push("SCALE_WITH_MAP"),t};function Fp(s,t,a,u,d,_,v,S,E){if(_&&s.queryGeometry.isAboveHorizon)return!1;_&&(E*=s.pixelToTileUnitsFactor);const R=s.tileID.canonical,P=a.projection.upVectorScale(R,a.center.lat,a.worldSize).metersToTile;for(const B of t)for(const F of B){const j=F.add(S),G=d&&a.elevation?a.elevation.exaggeration()*d.getElevationAt(j.x,j.y,!0):0,Q=a.projection.projectTilePoint(j.x,j.y,R);if(G>0){const le=a.projection.upVector(R,j.x,j.y);Q.x+=le[0]*P*G,Q.y+=le[1]*P*G,Q.z+=le[2]*P*G}const J=_?j:Kv(Q.x,Q.y,Q.z,u),ee=_?s.tilespaceRays.map((le=>l0(le,G))):s.queryGeometry.screenGeometry,se=Wo([],[Q.x,Q.y,Q.z,1],u);if(!v&&_?E*=se[3]/a.cameraToCenterDistance:v&&!_&&(E*=a.cameraToCenterDistance/se[3]),_){const le=ye((F.y/Bt+R.y)/(1<<R.z));E/=a.projection.pixelsPerMeter(le,1)/ge(1,le)}if(Wn(ee,J,E))return!0}return!1}function Kv(s,t,a,u){const d=Wo([],[s,t,a,1],u);return new Tt(d[0]/d[3],d[1]/d[3])}const s0=zi(0,0,0),nn=zi(0,0,1);function l0(s,t){const a=pr();return s0[2]=t,s.intersectsPlane(s0,nn,a),new Tt(a[0],a[1])}class $m extends xn{}let Yg,c0,Qg,kp;function Xm(s,{width:t,height:a},u,d){if(d){if(d instanceof Uint8ClampedArray)d=new Uint8Array(d.buffer);else if(d.length!==t*a*u)throw new RangeError("mismatched image size")}else d=new Uint8Array(t*a*u);return s.width=t,s.height=a,s.data=d,s}function Ad(s,t,a){const{width:u,height:d}=t;u===s.width&&d===s.height||(Kg(s,t,{x:0,y:0},{x:0,y:0},{width:Math.min(s.width,u),height:Math.min(s.height,d)},a,null),s.width=u,s.height=d,s.data=t.data)}function Kg(s,t,a,u,d,_,v,S){if(d.width===0||d.height===0)return t;if(d.width>s.width||d.height>s.height||a.x>s.width-d.width||a.y>s.height-d.height)throw new RangeError("out of range source coordinates for image copy");if(d.width>t.width||d.height>t.height||u.x>t.width-d.width||u.y>t.height-d.height)throw new RangeError("out of range destination coordinates for image copy");const E=s.data,R=t.data,P=_===4&&S;for(let B=0;B<d.height;B++){const F=((a.y+B)*s.width+a.x)*_,j=((u.y+B)*t.width+u.x)*_;if(P)for(let G=0;G<d.width;G++){const Q=F+G*_+3,J=j+G*_;R[J+0]=255,R[J+1]=255,R[J+2]=255,R[J+3]=E[Q]}else if(v)for(let G=0;G<d.width;G++){const Q=F+G*_,J=j+G*_,ee=new Ei(E[Q+0]/255,E[Q+1]/255,E[Q+2]/255,E[Q+3]).toNonPremultipliedRenderColor(v).toArray();R[J+0]=ee[0],R[J+1]=ee[1],R[J+2]=ee[2],R[J+3]=ee[3]}else for(let G=0;G<d.width*_;G++)R[j+G]=E[F+G]}return t}$t($m,"HeatmapBucket",{omit:["layers"]});class _f{constructor(t,a){Xm(this,t,1,a)}resize(t){Ad(this,new _f(t),1)}clone(){return new _f({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,d,_){Kg(t,a,u,d,_,1,null)}}class Ho{constructor(t,a){Xm(this,t,4,a)}resize(t){Ad(this,new Ho(t),4)}replace(t,a){a?this.data.set(t):this.data=t instanceof Uint8ClampedArray?new Uint8Array(t.buffer):t}clone(){return new Ho({width:this.width,height:this.height},new Uint8Array(this.data))}static copy(t,a,u,d,_,v,S){Kg(t,a,u,d,_,4,v,S)}}class u0{constructor(t,a){this.width=t.width,this.height=t.height,this.data=a instanceof Uint8Array?new Float32Array(a.buffer):a}}function Np(s){const t={},a=s.resolution||256,u=s.clips?s.clips.length:1,d=s.image||new Ho({width:a,height:u}),_=(v,S,E)=>{t[s.evaluationKey]=E;const R=s.expression.evaluate(t),P=R?R.toNonPremultipliedRenderColor(null):null;P&&(d.data[v+S+0]=Math.floor(255*P.r),d.data[v+S+1]=Math.floor(255*P.g),d.data[v+S+2]=Math.floor(255*P.b),d.data[v+S+3]=Math.floor(255*P.a))};if(s.clips)for(let v=0,S=0;v<u;++v,S+=4*a)for(let E=0,R=0;E<a;E++,R+=4){const P=E/(a-1),{start:B,end:F}=s.clips[v];_(S,R,B*(1-P)+F*P)}else for(let v=0,S=0;v<a;v++,S+=4)_(0,S,v/(a-1));return d}$t(_f,"AlphaImage"),$t(Ho,"RGBAImage");const Jg=ei([{name:"a_pos",components:2,type:"Int16"}],4),Hn=ei([{name:"a_road_z_offset",components:1,type:"Float32"}],4),h0=ei([{name:"a_pos",components:2,type:"Int16"},{name:"a_height",components:1,type:"Float32"}],4),Da=ei([{name:"a_pos_normal_3",components:3,type:"Int16"}],4);function Vp(s,t,a=2){const u=t&&t.length,d=u?t[0]*a:s.length;let _=e_(s,0,d,a,!0);const v=[];if(!_||_.next===_.prev)return v;let S,E,R;if(u&&(_=(function(P,B,F,j){const G=[];for(let Q=0,J=B.length;Q<J;Q++){const ee=e_(P,B[Q]*j,Q<J-1?B[Q+1]*j:P.length,j,!1);ee===ee.next&&(ee.steiner=!0),G.push(tx(ee))}G.sort(Jv);for(let Q=0;Q<G.length;Q++)F=$y(G[Q],F);return F})(s,t,_,a)),s.length>80*a){S=s[0],E=s[1];let P=S,B=E;for(let F=a;F<d;F+=a){const j=s[F],G=s[F+1];j<S&&(S=j),G<E&&(E=G),j>P&&(P=j),G>B&&(B=G)}R=Math.max(P-S,B-E),R=R!==0?32767/R:0}return yf(_,v,a,S,E,R,0),v}function e_(s,t,a,u,d){let _;if(d===(function(v,S,E,R){let P=0;for(let B=S,F=E-R;B<E;B+=R)P+=(v[F]-v[B])*(v[B+1]+v[F+1]),F=B;return P})(s,t,a,u)>0)for(let v=t;v<a;v+=u)_=p0(v/u|0,s[v],s[v+1],_);else for(let v=a-u;v>=t;v-=u)_=p0(v/u|0,s[v],s[v+1],_);return _&&Up(_,_.next)&&(Gp(_),_=_.next),_}function ph(s,t){if(!s)return s;t||(t=s);let a,u=s;do if(a=!1,u.steiner||!Up(u,u.next)&&co(u.prev,u,u.next)!==0)u=u.next;else{if(Gp(u),u=t=u.prev,u===u.next)break;a=!0}while(a||u!==t);return t}function yf(s,t,a,u,d,_,v){if(!s)return;!v&&_&&(function(E,R,P,B){let F=E;do F.z===0&&(F.z=t_(F.x,F.y,R,P,B)),F.prevZ=F.prev,F.nextZ=F.next,F=F.next;while(F!==E);F.prevZ.nextZ=null,F.prevZ=null,(function(j){let G,Q=1;do{let J,ee=j;j=null;let se=null;for(G=0;ee;){G++;let le=ee,he=0;for(let Ce=0;Ce<Q&&(he++,le=le.nextZ,le);Ce++);let Ee=Q;for(;he>0||Ee>0&&le;)he!==0&&(Ee===0||!le||ee.z<=le.z)?(J=ee,ee=ee.nextZ,he--):(J=le,le=le.nextZ,Ee--),se?se.nextZ=J:j=J,J.prevZ=se,se=J;ee=le}se.nextZ=null,Q*=2}while(G>1)})(F)})(s,u,d,_);let S=s;for(;s.prev!==s.next;){const E=s.prev,R=s.next;if(_?qy(s,u,d,_):Hy(s))t.push(E.i,s.i,R.i),Gp(s),s=R.next,S=R.next;else if((s=R)===S){v?v===1?yf(s=f0(ph(s),t),t,a,u,d,_,2):v===2&&d0(s,t,a,u,d,_):yf(ph(s),t,a,u,d,_,1);break}}}function Hy(s){const t=s.prev,a=s,u=s.next;if(co(t,a,u)>=0)return!1;const d=t.x,_=a.x,v=u.x,S=t.y,E=a.y,R=u.y,P=Math.min(d,_,v),B=Math.min(S,E,R),F=Math.max(d,_,v),j=Math.max(S,E,R);let G=u.next;for(;G!==t;){if(G.x>=P&&G.x<=F&&G.y>=B&&G.y<=j&&Vl(d,S,_,E,v,R,G.x,G.y)&&co(G.prev,G,G.next)>=0)return!1;G=G.next}return!0}function qy(s,t,a,u){const d=s.prev,_=s,v=s.next;if(co(d,_,v)>=0)return!1;const S=d.x,E=_.x,R=v.x,P=d.y,B=_.y,F=v.y,j=Math.min(S,E,R),G=Math.min(P,B,F),Q=Math.max(S,E,R),J=Math.max(P,B,F),ee=t_(j,G,t,a,u),se=t_(Q,J,t,a,u);let le=s.prevZ,he=s.nextZ;for(;le&&le.z>=ee&&he&&he.z<=se;){if(le.x>=j&&le.x<=Q&&le.y>=G&&le.y<=J&&le!==d&&le!==v&&Vl(S,P,E,B,R,F,le.x,le.y)&&co(le.prev,le,le.next)>=0||(le=le.prevZ,he.x>=j&&he.x<=Q&&he.y>=G&&he.y<=J&&he!==d&&he!==v&&Vl(S,P,E,B,R,F,he.x,he.y)&&co(he.prev,he,he.next)>=0))return!1;he=he.nextZ}for(;le&&le.z>=ee;){if(le.x>=j&&le.x<=Q&&le.y>=G&&le.y<=J&&le!==d&&le!==v&&Vl(S,P,E,B,R,F,le.x,le.y)&&co(le.prev,le,le.next)>=0)return!1;le=le.prevZ}for(;he&&he.z<=se;){if(he.x>=j&&he.x<=Q&&he.y>=G&&he.y<=J&&he!==d&&he!==v&&Vl(S,P,E,B,R,F,he.x,he.y)&&co(he.prev,he,he.next)>=0)return!1;he=he.nextZ}return!0}function f0(s,t){let a=s;do{const u=a.prev,d=a.next.next;!Up(u,d)&&Wy(u,a,a.next,d)&&us(u,d)&&us(d,u)&&(t.push(u.i,a.i,d.i),Gp(a),Gp(a.next),a=s=d),a=a.next}while(a!==s);return ph(a)}function d0(s,t,a,u,d,_){let v=s;do{let S=v.next.next;for(;S!==v.prev;){if(v.i!==S.i&&Zy(v,S)){let E=i_(v,S);return v=ph(v,v.next),E=ph(E,E.next),yf(v,t,a,u,d,_,0),void yf(E,t,a,u,d,_,0)}S=S.next}v=v.next}while(v!==s)}function Jv(s,t){let a=s.x-t.x;return a===0&&(a=s.y-t.y,a===0)&&(a=(s.next.y-s.y)/(s.next.x-s.x)-(t.next.y-t.y)/(t.next.x-t.x)),a}function $y(s,t){const a=(function(d,_){let v=_;const S=d.x,E=d.y;let R,P=-1/0;if(Up(d,v))return v;do{if(Up(d,v.next))return v.next;if(E<=v.y&&E>=v.next.y&&v.next.y!==v.y){const Q=v.x+(E-v.y)*(v.next.x-v.x)/(v.next.y-v.y);if(Q<=S&&Q>P&&(P=Q,R=v.x<v.next.x?v:v.next,Q===S))return R}v=v.next}while(v!==_);if(!R)return null;const B=R,F=R.x,j=R.y;let G=1/0;v=R;do{if(S>=v.x&&v.x>=F&&S!==v.x&&Xy(E<j?S:P,E,F,j,E<j?P:S,E,v.x,v.y)){const Q=Math.abs(E-v.y)/(S-v.x);us(v,d)&&(Q<G||Q===G&&(v.x>R.x||v.x===R.x&&ex(R,v)))&&(R=v,G=Q)}v=v.next}while(v!==B);return R})(s,t);if(!a)return t;const u=i_(a,s);return ph(u,u.next),ph(a,a.next)}function ex(s,t){return co(s.prev,s,t.prev)<0&&co(t.next,s,s.next)<0}function t_(s,t,a,u,d){return(s=1431655765&((s=858993459&((s=252645135&((s=16711935&((s=(s-a)*d|0)|s<<8))|s<<4))|s<<2))|s<<1))|(t=1431655765&((t=858993459&((t=252645135&((t=16711935&((t=(t-u)*d|0)|t<<8))|t<<4))|t<<2))|t<<1))<<1}function tx(s){let t=s,a=s;do(t.x<a.x||t.x===a.x&&t.y<a.y)&&(a=t),t=t.next;while(t!==s);return a}function Xy(s,t,a,u,d,_,v,S){return(d-v)*(t-S)>=(s-v)*(_-S)&&(s-v)*(u-S)>=(a-v)*(t-S)&&(a-v)*(_-S)>=(d-v)*(u-S)}function Vl(s,t,a,u,d,_,v,S){return!(s===v&&t===S)&&Xy(s,t,a,u,d,_,v,S)}function Zy(s,t){return s.next.i!==t.i&&s.prev.i!==t.i&&!(function(a,u){let d=a;do{if(d.i!==a.i&&d.next.i!==a.i&&d.i!==u.i&&d.next.i!==u.i&&Wy(d,d.next,a,u))return!0;d=d.next}while(d!==a);return!1})(s,t)&&(us(s,t)&&us(t,s)&&(function(a,u){let d=a,_=!1;const v=(a.x+u.x)/2,S=(a.y+u.y)/2;do d.y>S!=d.next.y>S&&d.next.y!==d.y&&v<(d.next.x-d.x)*(S-d.y)/(d.next.y-d.y)+d.x&&(_=!_),d=d.next;while(d!==a);return _})(s,t)&&(co(s.prev,s,t.prev)||co(s,t.prev,t))||Up(s,t)&&co(s.prev,s,s.next)>0&&co(t.prev,t,t.next)>0)}function co(s,t,a){return(t.y-s.y)*(a.x-t.x)-(t.x-s.x)*(a.y-t.y)}function Up(s,t){return s.x===t.x&&s.y===t.y}function Wy(s,t,a,u){const d=r_(co(s,t,a)),_=r_(co(s,t,u)),v=r_(co(a,u,s)),S=r_(co(a,u,t));return d!==_&&v!==S||!(d!==0||!jp(s,a,t))||!(_!==0||!jp(s,u,t))||!(v!==0||!jp(a,s,u))||!(S!==0||!jp(a,t,u))}function jp(s,t,a){return t.x<=Math.max(s.x,a.x)&&t.x>=Math.min(s.x,a.x)&&t.y<=Math.max(s.y,a.y)&&t.y>=Math.min(s.y,a.y)}function r_(s){return s>0?1:s<0?-1:0}function us(s,t){return co(s.prev,s,s.next)<0?co(s,t,s.next)>=0&&co(s,s.prev,t)>=0:co(s,t,s.prev)<0||co(s,s.next,t)<0}function i_(s,t){const a=Ed(s.i,s.x,s.y),u=Ed(t.i,t.x,t.y),d=s.next,_=t.prev;return s.next=t,t.prev=s,a.next=d,d.prev=a,u.next=a,a.prev=u,_.next=u,u.prev=_,u}function p0(s,t,a,u){const d=Ed(s,t,a);return u?(d.next=u.next,d.prev=u,u.next.prev=d,u.next=d):(d.prev=d,d.next=d),d}function Gp(s){s.next.prev=s.prev,s.prev.next=s.next,s.prevZ&&(s.prevZ.nextZ=s.nextZ),s.nextZ&&(s.nextZ.prevZ=s.prevZ)}function Ed(s,t,a){return{i:s,x:t,y:a,prev:null,next:null,z:0,prevZ:null,nextZ:null,steiner:!1}}function Za(s,t){const a=s.length;if(a<=1)return[s];const u=[];let d,_;for(let v=0;v<a;v++){const S=Xn(s[v]);S!==0&&(s[v].area=Math.abs(S),_===void 0&&(_=S<0),_===S<0?(d&&u.push(d),d=[s[v]]):d.push(s[v]))}if(d&&u.push(d),t>1)for(let v=0;v<u.length;v++)u[v].length<=t||(Ha(u[v],t,1,u[v].length-1,Yy),u[v]=u[v].slice(0,t));return u}function Yy(s,t){return t.area-s.area}function Zm(s,t,a=1){if(!s)return null;const u=typeof s=="string"?sa.from(s).getPrimary():s.getPrimary(),d=typeof s=="string"?null:s.getSecondary();for(const _ of[u,d]){if(!_)continue;const v=_.id.toString();t.has(v)||t.set(v,[]),_.scaleSelf(a),t.get(v).push(_)}return{primary:u.toString(),secondary:d?d.toString():null}}function zc(s,t,a,u){const d=u.patternDependencies;let _=!1;for(const v of t){const S=v.paint.get(`${s}-pattern`);S.isConstant()||(_=!0),Zm(S.constantOr(null),d,a)&&(_=!0)}return _}function m0(s,t,a,u,d,_){const v=_.patternDependencies;for(const S of t){const E=S.paint.get(`${s}-pattern`).value;if(E.kind!=="constant"){let R=E.evaluate({zoom:u},a,{},_.availableImages);R=R&&R.name?R.name:R;const P=Zm(R,v,d);if(!P)continue;const{primary:B,secondary:F}=P;B&&(a.patterns[S.id]=[B,F].filter(Boolean))}}return a}class Qy{constructor(){this.polygons=new Map}add(t,...a){const u=this.polygons.get(t);u?u.push(...a):this.polygons.set(t,a)}merge(t){for(const[a,u]of t.polygons)this.add(a,...u)}}class Fs{constructor(){this.portals=[]}static isOnBorder(t,a){return t<=0&&a<=0||t>=Bt&&a>=Bt}static evaluate(t){if(t.length===0)return new Fs;let a=[];for(const E of t)a.push(...E.portals);if(a.length===0)return new Fs;for(const E of a){const R=E.va,P=E.vb;(Fs.isOnBorder(R.x,P.x)||Fs.isOnBorder(R.y,P.y))&&(E.type="border")}const u=a.filter((E=>E.type!=="unevaluated")),d=a.filter((E=>E.type==="unevaluated"));if(d.length===0)return new Fs;d.sort(((E,R)=>E.hash===R.hash?E.isTunnel===R.isTunnel?0:E.isTunnel?-1:1:E.hash<R.hash?1:-1)),a=u.concat(d);let _=u.length,v=_,S=_;do if(v++,v===a.length||a[_].hash!==a[v].hash){if(v-_==2){S<_&&(a[S]=a[_],a[_]=null);const E=a[S],R=a[v-1];E.type=E.isTunnel!==R.isTunnel?"tunnel":"polygon",E.connection={a:E.connection.a,b:R.connection.a},S++}_=v}while(_!==a.length);return a.splice(S),a.sort(((E,R)=>E.hash<R.hash?1:-1)),{portals:a}}}$t(Fs,"ElevationPortalGraph"),$t(Qy,"ElevationPolygons");class Ky{constructor(t,a,u){this.outPositions=t,this.outNormals=a,this.outIndices=u,this.vertexLookup=new Map}addVertex(t,a,u){let d=t[2];u!=null&&(d*=u);const _=`${t[0]},${t[1]},${t[2]},${a[0]},${a[1]},${a[2]}`,v=this.vertexLookup.get(_);if(v!=null)return v;const S=this.outPositions.length;this.vertexLookup.set(_,S);const E=Math.trunc(16384*a[0]),R=Math.trunc(16384*a[1]),P=Math.trunc(16384*a[2]);return this.outPositions.emplaceBack(t[0],t[1],d),this.outNormals.emplaceBack(E,R,P),S}addTriangle(t,a,u){this.outIndices.emplaceBack(t,a,u)}addTriangles(t,a,u){if(t.length===0)return;const d=u.length===1,_=pr(),v=pr();for(let S=0;S<t.length;S+=3){const E=a[t[S+0]],R=a[t[S+1]],P=a[t[S+2]],B=d?u[0]:u[t[S+1]],F=d?u[0]:u[t[S+2]];Qr(_,E.x,E.y,d?u[0]:u[t[S+0]]);const j=this.addVertex(_,v);Qr(_,R.x,R.y,B);const G=this.addVertex(_,v);Qr(_,P.x,P.y,F);const Q=this.addVertex(_,v);this.outIndices.emplaceBack(j,G,Q)}}addQuad(t,a,u,d,_,v){const S=this.addVertex(t,_,v),E=this.addVertex(a,_,v),R=this.addVertex(u,_,v),P=this.addVertex(d,_,v);this.addTriangle(S,E,R),this.addTriangle(R,P,S)}getVertexCount(){return this.outPositions.length}clearVertexLookup(){this.vertexLookup.clear()}}class hs{constructor(t,a,u,d){this.unevaluatedPortals=new Fs,this.portalPolygons=new Qy,this.bridgeFeatureSections=[],this.tunnelFeatureSections=[],this.vertexHashLookup=new Map,this.unevalVertices=[],this.unevalHeights=[],this.unevalTriangles=[],this.unevalTunnelTriangles=[],this.unevalEdges=[],this.vertexPositions=new af,this.vertexNormals=new pd,this.indexArray=new Cn,this.tileToMeters=Ge(t),this.bridgeProgramConfigurations=new Bo(a,{zoom:u,lut:d},(_=>_!=="fill-tunnel-structure-color")),this.tunnelProgramConfigurations=new Bo(a,{zoom:u,lut:d},(_=>_!=="fill-bridge-guard-rail-color"))}addVertices(t,a){const u=this.unevalVertices.length;for(let d=0;d<t.length;d++)this.unevalVertices.push(t[d]),this.unevalHeights.push(a[d]);return u}addTriangles(t,a,u){const d=u?this.unevalTunnelTriangles:this.unevalTriangles;for(const _ of t)d.push(_+a)}addRenderableRing(t,a,u,d,_,v){const S=[new Tt(_.min.x,_.min.y),new Tt(_.max.x,_.min.y),new Tt(_.max.x,_.max.y),new Tt(_.min.x,_.max.y)];for(let E=0;E<u-1;E++){const R=a+E,P=R+1,B=this.unevalVertices[R],F=this.unevalVertices[P];if(!(B.x>=_.min.x&&B.x<=_.max.x&&B.y>=_.min.y&&B.y<=_.max.y||F.x>=_.min.x&&F.x<=_.max.x&&F.y>=_.min.y&&F.y<=_.max.y||Ao(B,F,S))||this.isOnBorder(B.x,F.x)||this.isOnBorder(B.y,F.y))continue;const j=hs.computeEdgeHash(this.unevalVertices[R],this.unevalVertices[P]);let G,Q=this.vertexHashLookup.get(hs.computePosHash(B));Q!=null?G=Q.next:(Q=this.vertexHashLookup.get(hs.computePosHash(F)),G=Q!=null?Q.prev:j),this.unevalEdges.push({polygonIdx:t,a:R,b:P,hash:j,portalHash:G,isTunnel:d,type:"unevaluated",featureInfo:v})}}addPortalCandidates(t,a,u,d,_){if(a.length===0)return;this.portalPolygons.add(t,{geometry:a,zLevel:_});const v=a[0];this.vertexHashLookup.clear();let S=hs.computeEdgeHash(v[v.length-2],v[v.length-1]);for(let E=0;E<v.length-1;E++){const R=v[E+0],P=v[E+1],B=$s(P.x-R.x,P.y-R.y),F=Zs(B);if(F===0)continue;let j="unevaluated";const G=d.pointElevation(R),Q=d.pointElevation(P);Math.abs(G)<.01&&Math.abs(Q)<.01?j="entrance":(this.isOnBorder(R.x,P.x)||this.isOnBorder(R.y,P.y))&&(j="border");const J=hs.computeEdgeHash(R,P);this.unevaluatedPortals.portals.push({connection:{a:t,b:void 0},va:R,vb:P,vab:B,length:F,hash:J,isTunnel:u,type:j});const ee=hs.computePosHash(R);this.vertexHashLookup.set(ee,{prev:S,next:J}),S=J}}construct(t){if(this.unevalVertices.length===0)return;const a=()=>({vertexOffset:0,primitiveOffset:this.indexArray.length}),u=F=>{F.primitiveLength=this.indexArray.length-F.primitiveOffset},d=new Ky(this.vertexPositions,this.vertexNormals,this.indexArray);this.prepareEdges(t.portals,this.unevalEdges);const _=a(),v=a(),S=a(),E=(F,j)=>{F.sort(((Q,J)=>Q.type===j&&J.type!==j?-1:Q.type!==j&&J.type===j?1:0));const G=F.findIndex((Q=>Q.type!==j));return G>=0?G:F.length};let R=0;this.unevalEdges.length>0&&(R=E(this.unevalEdges,"none"),this.constructBridgeStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},this.tileToMeters)),u(S);const P=a(),B=a();if(this.unevalEdges.length>0){const F=this.unevalEdges.splice(R),j=E(F,"tunnel")+R;this.unevalEdges.push(...F),this.constructTunnelStructures(d,this.unevalVertices,this.unevalHeights,this.unevalEdges,{min:0,max:R},{min:R,max:j})}u(P),d.addTriangles(this.unevalTriangles,this.unevalVertices,this.unevalHeights),u(B),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,this.unevalHeights),u(v),d.addTriangles(this.unevalTunnelTriangles,this.unevalVertices,[-.1]),u(_),this.maskSegments=hn.simpleSegment(0,B.primitiveOffset,0,B.primitiveLength),this.depthSegments=hn.simpleSegment(0,v.primitiveOffset,0,v.primitiveLength),this.renderableBridgeSegments=hn.simpleSegment(0,S.primitiveOffset,0,S.primitiveLength),this.renderableTunnelSegments=hn.simpleSegment(0,P.primitiveOffset,0,P.primitiveLength),this.shadowCasterSegments=hn.simpleSegment(0,_.primitiveOffset,0,_.primitiveLength)}update(t,a,u,d,_,v,S,E){this.bridgeProgramConfigurations.updatePaintArrays(t,a,_,u,d,v,S,E),this.tunnelProgramConfigurations.updatePaintArrays(t,a,_,u,d,v,S,E)}upload(t){this.vertexBuffer||this.vertexPositions.length===0||this.vertexNormals.length===0||this.indexArray.length===0||(this.vertexBuffer=t.createVertexBuffer(this.vertexPositions,h0.members),this.vertexBufferNormal=t.createVertexBuffer(this.vertexNormals,Da.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.bridgeProgramConfigurations.upload(t),this.tunnelProgramConfigurations.upload(t))}destroy(){this.vertexBuffer&&(this.vertexBuffer.destroy(),this.vertexBufferNormal.destroy(),this.indexBuffer.destroy()),this.maskSegments&&(this.maskSegments.destroy(),this.depthSegments.destroy(),this.renderableBridgeSegments.destroy(),this.renderableTunnelSegments.destroy(),this.shadowCasterSegments.destroy()),this.bridgeProgramConfigurations.destroy(),this.tunnelProgramConfigurations.destroy()}populatePaintArrays(t,a,u,d,_){const v=(S,E)=>{for(let R=0;R<E.length-1;R++){const P=E[R].featureIndex,B=E[R+1].vertexStart,F=t.feature(P);S.populatePaintArrays(B,F,P,{},u,a,d,void 0,_)}};v(this.bridgeProgramConfigurations,this.bridgeFeatureSections),v(this.tunnelProgramConfigurations,this.tunnelFeatureSections)}computeVertexConnections(t,a,u,d,_){const v=new Map;for(let S=d;S<_;S++){const E=u[S],R=E.a,P=E.b,B=hs.computePosHash(t[R]),F=hs.computePosHash(t[P]);let j=v.get(B);j||(j={},v.set(B,j));let G=v.get(F);G||(G={},v.set(F,G)),a[R]<=0&&a[P]<=0||(j.to=P,G.from=R)}return v}isTerminalVertex(t,a){const u=hs.computePosHash(this.unevalVertices[t]),d=a.get(u);return!d||!d.from||!d.to}constructBridgeStructures(t,a,u,d,_,v){t.clearVertexLookup();const S=this.computeVertexConnections(a,u,d,_.min,_.max),E=1/v,R=.5*E,P=(yt,Rt)=>Qr(yt,a[Rt].x,a[Rt].y,u[Rt]*E),B=pr(),F=pr(),j=pr(),G=pr(),Q=pr(),J=(yt,Rt)=>{const lt=S.get(hs.computePosHash(a[Rt])),vt=lt.from,et=lt.to;if(!vt||!et)return;P(B,vt),P(F,Rt),P(j,et),zu(G),Va(B,F)||(On(Q,F,B),Cr(G,Q)),Va(j,F)||(On(Q,j,F),Ot(G,G,Cr(Q,Q)));const We=Zo(G);return We>0?Vt(yt,G,1/We):void 0};let ee=Number.POSITIVE_INFINITY;this.sortSubarray(d,_.min,_.max,((yt,Rt)=>yt.featureInfo.featureIndex-Rt.featureInfo.featureIndex));const se=pr(),le=pr(),he=pr(),Ee=pr(),Ce=pr(),De=pr(),Le=pr(),Fe=pr(),ut=pr(),Ue=[pr(),pr(),pr(),pr()],dt=[pr(),pr(),pr(),pr()],St=[{coord:new Tt(0,0),height:0},{coord:new Tt(0,0),height:0}],gt=(yt,Rt)=>yt>Rt;for(let yt=_.min;yt<_.max;yt++){const Rt=d[yt];if(!Rt.featureInfo.guardRailEnabled||!this.prepareEdgePoints(St,a,u,Rt,gt))continue;const[lt,vt]=St;if(Qr(se,lt.coord.x,lt.coord.y,E*lt.height),Qr(le,vt.coord.x,vt.coord.y,E*vt.height),Va(se,le))continue;On(he,le,se),Cr(he,he);const et=J(Fe,Rt.a)||he,We=J(ut,Rt.b)||he;Qr(Ee,et[1],-et[0],0),Cr(Ee,Ee),Qr(Ce,We[1],-We[0],0),Cr(Ce,Ce),vi(Fe,Ee,et),Cr(De,Fe),vi(Fe,Ce,We),Cr(Le,Fe),Ot(Ue[0],se,Vt(Fe,On(Fe,Ee,De),R)),Ot(Ue[1],se,Vt(Fe,Ot(Fe,Ee,De),R)),Ot(Ue[2],se,Vt(Fe,De,R)),Ue[3]=se,Ot(dt[0],le,Vt(Fe,On(Fe,Ce,Le),R)),Ot(dt[1],le,Vt(Fe,Ot(Fe,Ce,Le),R)),Ot(dt[2],le,Vt(Fe,Le,R)),dt[3]=le,ee=this.addFeatureSection(Rt.featureInfo.featureIndex,ee,this.bridgeFeatureSections,t);const Dt=t.addVertex(Ue[0],Ee,v),Et=t.addVertex(Ue[1],Ee,v),dr=t.addVertex(dt[0],Ce,v),Zt=t.addVertex(dt[1],Ce,v);t.addTriangle(Dt,Et,dr),t.addTriangle(Et,Zt,dr);const nr=t.addVertex(Ue[1],De,v),Nt=t.addVertex(Ue[2],De,v),ur=t.addVertex(dt[1],Le,v),Dr=t.addVertex(dt[2],Le,v);t.addTriangle(nr,Nt,ur),t.addTriangle(Nt,Dr,ur),Gi(Ee,Ee),Gi(Ce,Ce);const Ht=t.addVertex(Ue[2],Ee,v),ar=t.addVertex(Ue[3],Ee,v),Sr=t.addVertex(dt[2],Ce,v),Br=t.addVertex(dt[3],Ce,v);t.addTriangle(Ht,ar,Sr),t.addTriangle(ar,Br,Sr);const $r=this.isTerminalVertex(Rt.a,S),Vr=this.isTerminalVertex(Rt.b,S);lt.height<.01&&$r&&t.addQuad(Ue[3],Ue[2],Ue[1],Ue[0],Gi(et,et),v),vt.height<.01&&Vr&&t.addQuad(dt[0],dt[1],dt[2],dt[3],We,v)}this.bridgeFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}constructTunnelStructures(t,a,u,d,_,v){t.clearVertexLookup();let S=Number.POSITIVE_INFINITY;const E=(ee,se)=>ee.featureInfo.featureIndex-se.featureInfo.featureIndex;this.sortSubarray(d,_.min,_.max,E),this.sortSubarray(d,v.min,v.max,E);const R=ee=>Cr(ee,ee),P=[{coord:new Tt(0,0),height:0},{coord:new Tt(0,0),height:0}],B=(ee,se)=>ee<se,F=pr(),j=pr(),G=pr(),Q=pr(),J=pr();for(let ee=_.min;ee<_.max;ee++){if(!this.prepareEdgePoints(P,a,u,d[ee],B))continue;const[se,le]=P,he=R(Qr(J,-(le.coord.y-se.coord.y),le.coord.x-se.coord.x,0));S=this.addFeatureSection(d[ee].featureInfo.featureIndex,S,this.tunnelFeatureSections,t),t.addQuad(Qr(F,se.coord.x,se.coord.y,se.height),Qr(j,le.coord.x,le.coord.y,le.height),Qr(G,le.coord.x,le.coord.y,d[ee].isTunnel?-.1:0),Qr(Q,se.coord.x,se.coord.y,d[ee].isTunnel?-.1:0),he)}for(let ee=v.min;ee<v.max;ee++){const se=d[ee];se.isTunnel&&([se.a,se.b]=[se.b,se.a]);const le=a[se.a],he=a[se.b],Ee=R(Qr(J,-(he.y-le.y),he.x-le.x,0));S=this.addFeatureSection(se.featureInfo.featureIndex,S,this.tunnelFeatureSections,t),t.addQuad(Qr(F,he.x,he.y,0),Qr(j,le.x,le.y,0),Qr(G,le.x,le.y,u[se.a]+4),Qr(Q,he.x,he.y,u[se.b]+4),Ee),t.addQuad(Qr(F,le.x,le.y,0),Qr(j,he.x,he.y,0),Qr(G,he.x,he.y,u[se.b]+4),Qr(Q,le.x,le.y,u[se.a]+4),Ee)}this.tunnelFeatureSections.push({featureIndex:Number.POSITIVE_INFINITY,vertexStart:t.getVertexCount()})}setElevatedPoint(t,a,u,d){t.coord.x=a,t.coord.y=u,t.height=d}prepareEdgePoints(t,a,u,d,_){let v=a[d.a].x,S=a[d.a].y,E=a[d.b].x,R=a[d.b].y,P=u[d.a],B=u[d.b];const F=_(P,0),j=_(B,0);if(F&&j)return this.setElevatedPoint(t[0],v,S,P),this.setElevatedPoint(t[1],E,R,B),!0;if(!F&&!j)return!1;if(F){if(!j){const G=B/(B-P);E=xr(E,v,G),R=xr(R,S,G),B=xr(B,P,G)}}else{const G=P/(P-B);v=xr(v,E,G),S=xr(S,R,G),P=xr(P,B,G)}return this.setElevatedPoint(t[0],v,S,P),this.setElevatedPoint(t[1],E,R,B),!0}prepareEdges(t,a){if(a.length===0)return;a.sort(((S,E)=>S.hash===E.hash?E.polygonIdx-S.polygonIdx:E.hash>S.hash?1:-1));let u=0,d=0,_=0,v=a[u].polygonIdx;do d++,(d===a.length||a[u].hash!==a[d].hash)&&((d-u==1||a[d-1].polygonIdx!==v)&&(_<u&&(a[_]=a[u],a[u]=null),a[_].type="none",_++),u=d,u!==a.length&&(v=a[u].polygonIdx));while(u!==a.length);if(a.splice(_),a.length!==0&&t.length!==0){a.sort(((R,P)=>R.portalHash<P.portalHash?1:-1));let S=0,E=0;for(;S!==a.length&&E!==t.length;){const R=a[S],P=t[E];R.portalHash>P.hash?S++:P.hash>R.portalHash?E++:(R.type=P.type,S++)}}}isOnBorder(t,a){return t<=0&&a<=0||t>=Bt&&a>=Bt}addFeatureSection(t,a,u,d){return t!==a&&(a=t,u.push({featureIndex:t,vertexStart:d.getVertexCount()}),d.clearVertexLookup()),a}sortSubarray(t,a,u,d){const _=t.slice(a,u);_.sort(d),t.splice(a,_.length,..._)}static computeEdgeHash(t,a){return(t.y===a.y&&t.x>a.x||t.y>a.y)&&([t,a]=[a,t]),BigInt(hs.computePosHash(t))<<32n|BigInt(hs.computePosHash(a))}static computePosHash(t){return((65535&t.x)<<16|65535&t.y)>>>0}}var Jy,e1={exports:{}},t1=(Jy||(Jy=1,(function(s,t){(function(a){function u(de,pe){return de>pe?1:de<pe?-1:0}var d=function(de,pe){de===void 0&&(de=u),pe===void 0&&(pe=!1),this._compare=de,this._root=null,this._size=0,this._noDuplicates=!!pe},_={size:{configurable:!0}};function v(de,pe,Ke,ct,Gt){var jt=Gt-ct;if(jt>0){var Kt=ct+Math.floor(jt/2),mr={key:pe[Kt],data:Ke[Kt],parent:de};return mr.left=v(mr,pe,Ke,ct,Kt),mr.right=v(mr,pe,Ke,Kt+1,Gt),mr}return null}function S(de,pe,Ke,ct,Gt){if(!(Ke>=ct)){for(var jt=de[Ke+ct>>1],Kt=Ke-1,mr=ct+1;;){do Kt++;while(Gt(de[Kt],jt)<0);do mr--;while(Gt(de[mr],jt)>0);if(Kt>=mr)break;var Xr=de[Kt];de[Kt]=de[mr],de[mr]=Xr,Xr=pe[Kt],pe[Kt]=pe[mr],pe[mr]=Xr}S(de,pe,Ke,mr,Gt),S(de,pe,mr+1,ct,Gt)}}d.prototype.rotateLeft=function(de){var pe=de.right;pe&&(de.right=pe.left,pe.left&&(pe.left.parent=de),pe.parent=de.parent),de.parent?de===de.parent.left?de.parent.left=pe:de.parent.right=pe:this._root=pe,pe&&(pe.left=de),de.parent=pe},d.prototype.rotateRight=function(de){var pe=de.left;pe&&(de.left=pe.right,pe.right&&(pe.right.parent=de),pe.parent=de.parent),de.parent?de===de.parent.left?de.parent.left=pe:de.parent.right=pe:this._root=pe,pe&&(pe.right=de),de.parent=pe},d.prototype._splay=function(de){for(;de.parent;){var pe=de.parent;pe.parent?pe.left===de&&pe.parent.left===pe?(this.rotateRight(pe.parent),this.rotateRight(pe)):pe.right===de&&pe.parent.right===pe?(this.rotateLeft(pe.parent),this.rotateLeft(pe)):pe.left===de&&pe.parent.right===pe?(this.rotateRight(pe),this.rotateLeft(pe)):(this.rotateLeft(pe),this.rotateRight(pe)):pe.left===de?this.rotateRight(pe):this.rotateLeft(pe)}},d.prototype.splay=function(de){for(var pe,Ke,ct,Gt,jt;de.parent;)(Ke=(pe=de.parent).parent)&&Ke.parent?((ct=Ke.parent).left===Ke?ct.left=de:ct.right=de,de.parent=ct):(de.parent=null,this._root=de),Gt=de.left,jt=de.right,de===pe.left?(Ke&&(Ke.left===pe?(pe.right?(Ke.left=pe.right,Ke.left.parent=Ke):Ke.left=null,pe.right=Ke,Ke.parent=pe):(Gt?(Ke.right=Gt,Gt.parent=Ke):Ke.right=null,de.left=Ke,Ke.parent=de)),jt?(pe.left=jt,jt.parent=pe):pe.left=null,de.right=pe,pe.parent=de):(Ke&&(Ke.right===pe?(pe.left?(Ke.right=pe.left,Ke.right.parent=Ke):Ke.right=null,pe.left=Ke,Ke.parent=pe):(jt?(Ke.left=jt,jt.parent=Ke):Ke.left=null,de.right=Ke,Ke.parent=de)),Gt?(pe.right=Gt,Gt.parent=pe):pe.right=null,de.left=pe,pe.parent=de)},d.prototype.replace=function(de,pe){de.parent?de===de.parent.left?de.parent.left=pe:de.parent.right=pe:this._root=pe,pe&&(pe.parent=de.parent)},d.prototype.minNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.left;)de=de.left;return de},d.prototype.maxNode=function(de){if(de===void 0&&(de=this._root),de)for(;de.right;)de=de.right;return de},d.prototype.insert=function(de,pe){var Ke=this._root,ct=null,Gt=this._compare;if(this._noDuplicates)for(;Ke;){if(ct=Ke,Gt(Ke.key,de)===0)return;Ke=Gt(Ke.key,de)<0?Ke.right:Ke.left}else for(;Ke;)ct=Ke,Ke=Gt(Ke.key,de)<0?Ke.right:Ke.left;return Ke={key:de,data:pe,left:null,right:null,parent:ct},ct?Gt(ct.key,Ke.key)<0?ct.right=Ke:ct.left=Ke:this._root=Ke,this.splay(Ke),this._size++,Ke},d.prototype.find=function(de){for(var pe=this._root,Ke=this._compare;pe;){var ct=Ke(pe.key,de);if(ct<0)pe=pe.right;else{if(!(ct>0))return pe;pe=pe.left}}return null},d.prototype.contains=function(de){for(var pe=this._root,Ke=this._compare;pe;){var ct=Ke(de,pe.key);if(ct===0)return!0;pe=ct<0?pe.left:pe.right}return!1},d.prototype.remove=function(de){var pe=this.find(de);if(!pe)return!1;if(this.splay(pe),pe.left)if(pe.right){var Ke=this.minNode(pe.right);Ke.parent!==pe&&(this.replace(Ke,Ke.right),Ke.right=pe.right,Ke.right.parent=Ke),this.replace(pe,Ke),Ke.left=pe.left,Ke.left.parent=Ke}else this.replace(pe,pe.left);else this.replace(pe,pe.right);return this._size--,!0},d.prototype.removeNode=function(de){if(!de)return!1;if(this.splay(de),de.left)if(de.right){var pe=this.minNode(de.right);pe.parent!==de&&(this.replace(pe,pe.right),pe.right=de.right,pe.right.parent=pe),this.replace(de,pe),pe.left=de.left,pe.left.parent=pe}else this.replace(de,de.left);else this.replace(de,de.right);return this._size--,!0},d.prototype.erase=function(de){var pe=this.find(de);if(pe){this.splay(pe);var Ke=pe.left,ct=pe.right,Gt=null;Ke&&(Ke.parent=null,Gt=this.maxNode(Ke),this.splay(Gt),this._root=Gt),ct&&(Ke?Gt.right=ct:this._root=ct,ct.parent=Gt),this._size--}},d.prototype.pop=function(){var de=this._root,pe=null;if(de){for(;de.left;)de=de.left;pe={key:de.key,data:de.data},this.remove(de.key)}return pe},d.prototype.next=function(de){var pe=de;if(pe)if(pe.right)for(pe=pe.right;pe&&pe.left;)pe=pe.left;else for(pe=de.parent;pe&&pe.right===de;)de=pe,pe=pe.parent;return pe},d.prototype.prev=function(de){var pe=de;if(pe)if(pe.left)for(pe=pe.left;pe&&pe.right;)pe=pe.right;else for(pe=de.parent;pe&&pe.left===de;)de=pe,pe=pe.parent;return pe},d.prototype.forEach=function(de){for(var pe=this._root,Ke=[],ct=!1,Gt=0;!ct;)pe?(Ke.push(pe),pe=pe.left):Ke.length>0?(de(pe=Ke.pop(),Gt++),pe=pe.right):ct=!0;return this},d.prototype.range=function(de,pe,Ke,ct){for(var Gt=[],jt=this._compare,Kt=this._root;Gt.length!==0||Kt;)if(Kt)Gt.push(Kt),Kt=Kt.left;else{if(jt((Kt=Gt.pop()).key,pe)>0)break;if(jt(Kt.key,de)>=0&&Ke.call(ct,Kt))return this;Kt=Kt.right}return this},d.prototype.keys=function(){for(var de=this._root,pe=[],Ke=[],ct=!1;!ct;)de?(pe.push(de),de=de.left):pe.length>0?(de=pe.pop(),Ke.push(de.key),de=de.right):ct=!0;return Ke},d.prototype.values=function(){for(var de=this._root,pe=[],Ke=[],ct=!1;!ct;)de?(pe.push(de),de=de.left):pe.length>0?(de=pe.pop(),Ke.push(de.data),de=de.right):ct=!0;return Ke},d.prototype.at=function(de){for(var pe=this._root,Ke=[],ct=!1,Gt=0;!ct;)if(pe)Ke.push(pe),pe=pe.left;else if(Ke.length>0){if(pe=Ke.pop(),Gt===de)return pe;Gt++,pe=pe.right}else ct=!0;return null},d.prototype.load=function(de,pe,Ke){if(de===void 0&&(de=[]),pe===void 0&&(pe=[]),Ke===void 0&&(Ke=!1),this._size!==0)throw new Error("bulk-load: tree is not empty");var ct=de.length;return Ke&&S(de,pe,0,ct-1,this._compare),this._root=v(null,de,pe,0,ct),this._size=ct,this},d.prototype.min=function(){var de=this.minNode(this._root);return de?de.key:null},d.prototype.max=function(){var de=this.maxNode(this._root);return de?de.key:null},d.prototype.isEmpty=function(){return this._root===null},_.size.get=function(){return this._size},d.createTree=function(de,pe,Ke,ct,Gt){return new d(Ke,Gt).load(de,pe,ct)},Object.defineProperties(d.prototype,_);var E=0,R=1,P=2,B=3,F=0,j=1,G=2,Q=3;function J(de,pe,Ke){pe===null?(de.inOut=!1,de.otherInOut=!0):(de.isSubject===pe.isSubject?(de.inOut=!pe.inOut,de.otherInOut=pe.otherInOut):(de.inOut=!pe.otherInOut,de.otherInOut=pe.isVertical()?!pe.inOut:pe.inOut),pe&&(de.prevInResult=!ee(pe,Ke)||pe.isVertical()?pe.prevInResult:pe));var ct=ee(de,Ke);de.resultTransition=ct?(function(Gt,jt){var Kt,mr=!Gt.inOut,Xr=!Gt.otherInOut;switch(jt){case F:Kt=mr&&Xr;break;case j:Kt=mr||Xr;break;case Q:Kt=mr^Xr;break;case G:Kt=Gt.isSubject?mr&&!Xr:Xr&&!mr}return Kt?1:-1})(de,Ke):0}function ee(de,pe){switch(de.type){case E:switch(pe){case F:return!de.otherInOut;case j:return de.otherInOut;case G:return de.isSubject&&de.otherInOut||!de.isSubject&&!de.otherInOut;case Q:return!0}break;case P:return pe===F||pe===j;case B:return pe===G;case R:return!1}return!1}var se=function(de,pe,Ke,ct,Gt){this.left=pe,this.point=de,this.otherEvent=Ke,this.isSubject=ct,this.type=Gt||E,this.inOut=!1,this.otherInOut=!1,this.prevInResult=null,this.resultTransition=0,this.otherPos=-1,this.outputContourId=-1,this.isExteriorRing=!0},le={inResult:{configurable:!0}};function he(de,pe){return de[0]===pe[0]&&de[1]===pe[1]}se.prototype.isBelow=function(de){var pe=this.point,Ke=this.otherEvent.point;return this.left?(pe[0]-de[0])*(Ke[1]-de[1])-(Ke[0]-de[0])*(pe[1]-de[1])>0:(Ke[0]-de[0])*(pe[1]-de[1])-(pe[0]-de[0])*(Ke[1]-de[1])>0},se.prototype.isAbove=function(de){return!this.isBelow(de)},se.prototype.isVertical=function(){return this.point[0]===this.otherEvent.point[0]},le.inResult.get=function(){return this.resultTransition!==0},se.prototype.clone=function(){var de=new se(this.point,this.left,this.otherEvent,this.isSubject,this.type);return de.contourId=this.contourId,de.resultTransition=this.resultTransition,de.prevInResult=this.prevInResult,de.isExteriorRing=this.isExteriorRing,de.inOut=this.inOut,de.otherInOut=this.otherInOut,de},Object.defineProperties(se.prototype,le);var Ee=11102230246251565e-32,Ce=134217729,De=(3+8*Ee)*Ee;function Le(de,pe,Ke,ct,Gt){var jt,Kt,mr,Xr,Zr=pe[0],Hr=ct[0],Bi=0,mn=0;Hr>Zr==Hr>-Zr?(jt=Zr,Zr=pe[++Bi]):(jt=Hr,Hr=ct[++mn]);var jr=0;if(Bi<de&&mn<Ke)for(Hr>Zr==Hr>-Zr?(mr=jt-((Kt=Zr+jt)-Zr),Zr=pe[++Bi]):(mr=jt-((Kt=Hr+jt)-Hr),Hr=ct[++mn]),jt=Kt,mr!==0&&(Gt[jr++]=mr);Bi<de&&mn<Ke;)Hr>Zr==Hr>-Zr?(mr=jt-((Kt=jt+Zr)-(Xr=Kt-jt))+(Zr-Xr),Zr=pe[++Bi]):(mr=jt-((Kt=jt+Hr)-(Xr=Kt-jt))+(Hr-Xr),Hr=ct[++mn]),jt=Kt,mr!==0&&(Gt[jr++]=mr);for(;Bi<de;)mr=jt-((Kt=jt+Zr)-(Xr=Kt-jt))+(Zr-Xr),Zr=pe[++Bi],jt=Kt,mr!==0&&(Gt[jr++]=mr);for(;mn<Ke;)mr=jt-((Kt=jt+Hr)-(Xr=Kt-jt))+(Hr-Xr),Hr=ct[++mn],jt=Kt,mr!==0&&(Gt[jr++]=mr);return jt===0&&jr!==0||(Gt[jr++]=jt),jr}function Fe(de){return new Float64Array(de)}var ut=33306690738754716e-32,Ue=22204460492503146e-32,dt=11093356479670487e-47,St=Fe(4),gt=Fe(8),yt=Fe(12),Rt=Fe(16),lt=Fe(4);function vt(de,pe,Ke){var ct=(function(Gt,jt,Kt,mr,Xr,Zr){var Hr=(jt-Zr)*(Kt-Xr),Bi=(Gt-Xr)*(mr-Zr),mn=Hr-Bi;if(Hr===0||Bi===0||Hr>0!=Bi>0)return mn;var jr=Math.abs(Hr+Bi);return Math.abs(mn)>=ut*jr?mn:-(function(Ji,ki,Ai,an,sn,Qi,en){var Ni,Wr,ji,Sn,Ar,pi,ln,Mn,dn,go,qi,uo,ks,pa,ra,Ns,bf,_o,Eo=Ji-sn,ma=Ai-sn,Wa=ki-Qi,Oa=an-Qi;St[0]=(ra=(Mn=Eo-(ln=(pi=Ce*Eo)-(pi-Eo)))*(go=Oa-(dn=(pi=Ce*Oa)-(pi-Oa)))-((pa=Eo*Oa)-ln*dn-Mn*dn-ln*go))-((qi=ra-(bf=(Mn=Wa-(ln=(pi=Ce*Wa)-(pi-Wa)))*(go=ma-(dn=(pi=Ce*ma)-(pi-ma)))-((Ns=Wa*ma)-ln*dn-Mn*dn-ln*go)))+(Ar=ra-qi))+(Ar-bf),St[1]=(ks=pa-((uo=pa+qi)-(Ar=uo-pa))+(qi-Ar))-((qi=ks-Ns)+(Ar=ks-qi))+(Ar-Ns),St[2]=uo-((_o=uo+qi)-(Ar=_o-uo))+(qi-Ar),St[3]=_o;var em=(function(pU,gA){for(var _A=gA[0],Kx=1;Kx<4;Kx++)_A+=gA[Kx];return _A})(0,St),X0=Ue*en;if(em>=X0||-em>=X0||(Ni=Ji-(Eo+(Ar=Ji-Eo))+(Ar-sn),ji=Ai-(ma+(Ar=Ai-ma))+(Ar-sn),Wr=ki-(Wa+(Ar=ki-Wa))+(Ar-Qi),Sn=an-(Oa+(Ar=an-Oa))+(Ar-Qi),Ni===0&&Wr===0&&ji===0&&Sn===0)||(X0=dt*en+De*Math.abs(em),(em+=Eo*Sn+Oa*Ni-(Wa*ji+ma*Wr))>=X0||-em>=X0))return em;lt[0]=(ra=(Mn=Ni-(ln=(pi=Ce*Ni)-(pi-Ni)))*(go=Oa-(dn=(pi=Ce*Oa)-(pi-Oa)))-((pa=Ni*Oa)-ln*dn-Mn*dn-ln*go))-((qi=ra-(bf=(Mn=Wr-(ln=(pi=Ce*Wr)-(pi-Wr)))*(go=ma-(dn=(pi=Ce*ma)-(pi-ma)))-((Ns=Wr*ma)-ln*dn-Mn*dn-ln*go)))+(Ar=ra-qi))+(Ar-bf),lt[1]=(ks=pa-((uo=pa+qi)-(Ar=uo-pa))+(qi-Ar))-((qi=ks-Ns)+(Ar=ks-qi))+(Ar-Ns),lt[2]=uo-((_o=uo+qi)-(Ar=_o-uo))+(qi-Ar),lt[3]=_o;var RO=Le(4,St,4,lt,gt);lt[0]=(ra=(Mn=Eo-(ln=(pi=Ce*Eo)-(pi-Eo)))*(go=Sn-(dn=(pi=Ce*Sn)-(pi-Sn)))-((pa=Eo*Sn)-ln*dn-Mn*dn-ln*go))-((qi=ra-(bf=(Mn=Wa-(ln=(pi=Ce*Wa)-(pi-Wa)))*(go=ji-(dn=(pi=Ce*ji)-(pi-ji)))-((Ns=Wa*ji)-ln*dn-Mn*dn-ln*go)))+(Ar=ra-qi))+(Ar-bf),lt[1]=(ks=pa-((uo=pa+qi)-(Ar=uo-pa))+(qi-Ar))-((qi=ks-Ns)+(Ar=ks-qi))+(Ar-Ns),lt[2]=uo-((_o=uo+qi)-(Ar=_o-uo))+(qi-Ar),lt[3]=_o;var MO=Le(RO,gt,4,lt,yt);lt[0]=(ra=(Mn=Ni-(ln=(pi=Ce*Ni)-(pi-Ni)))*(go=Sn-(dn=(pi=Ce*Sn)-(pi-Sn)))-((pa=Ni*Sn)-ln*dn-Mn*dn-ln*go))-((qi=ra-(bf=(Mn=Wr-(ln=(pi=Ce*Wr)-(pi-Wr)))*(go=ji-(dn=(pi=Ce*ji)-(pi-ji)))-((Ns=Wr*ji)-ln*dn-Mn*dn-ln*go)))+(Ar=ra-qi))+(Ar-bf),lt[1]=(ks=pa-((uo=pa+qi)-(Ar=uo-pa))+(qi-Ar))-((qi=ks-Ns)+(Ar=ks-qi))+(Ar-Ns),lt[2]=uo-((_o=uo+qi)-(Ar=_o-uo))+(qi-Ar),lt[3]=_o;var DO=Le(MO,yt,4,lt,Rt);return Rt[DO-1]})(Gt,jt,Kt,mr,Xr,Zr,jr)})(de[0],de[1],pe[0],pe[1],Ke[0],Ke[1]);return ct>0?-1:ct<0?1:0}function et(de,pe){var Ke=de.point,ct=pe.point;return Ke[0]>ct[0]?1:Ke[0]<ct[0]?-1:Ke[1]!==ct[1]?Ke[1]>ct[1]?1:-1:(function(Gt,jt,Kt,mr){return Gt.left!==jt.left?Gt.left?1:-1:vt(Kt,Gt.otherEvent.point,jt.otherEvent.point)!==0?Gt.isBelow(jt.otherEvent.point)?-1:1:!Gt.isSubject&&jt.isSubject?1:-1})(de,pe,Ke)}function We(de,pe,Ke){var ct=new se(pe,!1,de,de.isSubject),Gt=new se(pe,!0,de.otherEvent,de.isSubject);return he(de.point,de.otherEvent.point)&&console.warn("what is that, a collapsed segment?",de),ct.contourId=Gt.contourId=de.contourId,et(Gt,de.otherEvent)>0&&(de.otherEvent.left=!0,Gt.left=!1),de.otherEvent.otherEvent=Gt,de.otherEvent=ct,Ke.push(Gt),Ke.push(ct),Ke}function Dt(de,pe){return de[0]*pe[1]-de[1]*pe[0]}function Et(de,pe){return de[0]*pe[0]+de[1]*pe[1]}function dr(de,pe,Ke){var ct=(function(Xr,Zr,Hr,Bi,mn){var jr=[Zr[0]-Xr[0],Zr[1]-Xr[1]],Ji=[Bi[0]-Hr[0],Bi[1]-Hr[1]];function ki(pi,ln,Mn){return[pi[0]+ln*Mn[0],pi[1]+ln*Mn[1]]}var Ai=[Hr[0]-Xr[0],Hr[1]-Xr[1]],an=Dt(jr,Ji),sn=an*an,Qi=Et(jr,jr);if(sn>0){var en=Dt(Ai,Ji)/an;if(en<0||en>1)return null;var Ni=Dt(Ai,jr)/an;return Ni<0||Ni>1?null:en===0||en===1?[ki(Xr,en,jr)]:Ni===0||Ni===1?[ki(Hr,Ni,Ji)]:[ki(Xr,en,jr)]}if((sn=(an=Dt(Ai,jr))*an)>0)return null;var Wr=Et(jr,Ai)/Qi,ji=Wr+Et(jr,Ji)/Qi,Sn=Math.min(Wr,ji),Ar=Math.max(Wr,ji);return Sn<=1&&Ar>=0?Sn===1?[ki(Xr,Sn>0?Sn:0,jr)]:Ar===0?[ki(Xr,Ar<1?Ar:1,jr)]:[ki(Xr,Sn>0?Sn:0,jr),ki(Xr,Ar<1?Ar:1,jr)]:null})(de.point,de.otherEvent.point,pe.point,pe.otherEvent.point),Gt=ct?ct.length:0;if(Gt===0||Gt===1&&(he(de.point,pe.point)||he(de.otherEvent.point,pe.otherEvent.point))||Gt===2&&de.isSubject===pe.isSubject)return 0;if(Gt===1)return he(de.point,ct[0])||he(de.otherEvent.point,ct[0])||We(de,ct[0],Ke),he(pe.point,ct[0])||he(pe.otherEvent.point,ct[0])||We(pe,ct[0],Ke),1;var jt=[],Kt=!1,mr=!1;return he(de.point,pe.point)?Kt=!0:et(de,pe)===1?jt.push(pe,de):jt.push(de,pe),he(de.otherEvent.point,pe.otherEvent.point)?mr=!0:et(de.otherEvent,pe.otherEvent)===1?jt.push(pe.otherEvent,de.otherEvent):jt.push(de.otherEvent,pe.otherEvent),Kt&&mr||Kt?(pe.type=R,de.type=pe.inOut===de.inOut?P:B,Kt&&!mr&&We(jt[1].otherEvent,jt[0].point,Ke),2):mr?(We(jt[0],jt[1].point,Ke),3):jt[0]!==jt[3].otherEvent?(We(jt[0],jt[1].point,Ke),We(jt[1],jt[2].point,Ke),3):(We(jt[0],jt[1].point,Ke),We(jt[3].otherEvent,jt[2].point,Ke),3)}function Zt(de,pe){if(de===pe)return 0;if(vt(de.point,de.otherEvent.point,pe.point)!==0||vt(de.point,de.otherEvent.point,pe.otherEvent.point)!==0)return he(de.point,pe.point)?de.isBelow(pe.otherEvent.point)?-1:1:de.point[0]===pe.point[0]?de.point[1]<pe.point[1]?-1:1:et(de,pe)===1?pe.isAbove(de.point)?-1:1:de.isBelow(pe.point)?-1:1;if(de.isSubject!==pe.isSubject)return de.isSubject?-1:1;var Ke=de.point,ct=pe.point;return Ke[0]===ct[0]&&Ke[1]===ct[1]?(Ke=de.otherEvent.point)[0]===(ct=pe.otherEvent.point)[0]&&Ke[1]===ct[1]?0:de.contourId>pe.contourId?1:-1:et(de,pe)===1?1:-1}var nr=function(){this.points=[],this.holeIds=[],this.holeOf=null,this.depth=null};function Nt(de,pe,Ke,ct){var Gt,jt=de+1,Kt=pe[de].point,mr=pe.length;for(jt<mr&&(Gt=pe[jt].point);jt<mr&&Gt[0]===Kt[0]&&Gt[1]===Kt[1];){if(!Ke[jt])return jt;++jt<mr&&(Gt=pe[jt].point)}for(jt=de-1;Ke[jt]&&jt>ct;)jt--;return jt}nr.prototype.isExterior=function(){return this.holeOf==null};var ur=Ht,Dr=Ht;function Ht(de,pe){if(!(this instanceof Ht))return new Ht(de,pe);if(this.data=de||[],this.length=this.data.length,this.compare=pe||ar,this.length>0)for(var Ke=(this.length>>1)-1;Ke>=0;Ke--)this._down(Ke)}function ar(de,pe){return de<pe?-1:de>pe?1:0}Ht.prototype={push:function(de){this.data.push(de),this.length++,this._up(this.length-1)},pop:function(){if(this.length!==0){var de=this.data[0];return this.length--,this.length>0&&(this.data[0]=this.data[this.length],this._down(0)),this.data.pop(),de}},peek:function(){return this.data[0]},_up:function(de){for(var pe=this.data,Ke=this.compare,ct=pe[de];de>0;){var Gt=de-1>>1,jt=pe[Gt];if(Ke(ct,jt)>=0)break;pe[de]=jt,de=Gt}pe[de]=ct},_down:function(de){for(var pe=this.data,Ke=this.compare,ct=this.length>>1,Gt=pe[de];de<ct;){var jt=1+(de<<1),Kt=jt+1,mr=pe[jt];if(Kt<this.length&&Ke(pe[Kt],mr)<0&&(jt=Kt,mr=pe[Kt]),Ke(mr,Gt)>=0)break;pe[de]=mr,de=jt}pe[de]=Gt}},ur.default=Dr;var Sr=Math.max,Br=Math.min,$r=0;function Vr(de,pe,Ke,ct,Gt,jt){var Kt,mr,Xr,Zr,Hr,Bi;for(Kt=0,mr=de.length-1;Kt<mr;Kt++)if(Zr=de[Kt+1],Hr=new se(Xr=de[Kt],!1,void 0,pe),Bi=new se(Zr,!1,Hr,pe),Hr.otherEvent=Bi,Xr[0]!==Zr[0]||Xr[1]!==Zr[1]){Hr.contourId=Bi.contourId=Ke,jt||(Hr.isExteriorRing=!1,Bi.isExteriorRing=!1),et(Hr,Bi)>0?Bi.left=!0:Hr.left=!0;var mn=Xr[0],jr=Xr[1];Gt[0]=Br(Gt[0],mn),Gt[1]=Br(Gt[1],jr),Gt[2]=Sr(Gt[2],mn),Gt[3]=Sr(Gt[3],jr),ct.push(Hr),ct.push(Bi)}}var er=[];function zr(de,pe,Ke){typeof de[0][0][0]=="number"&&(de=[de]),typeof pe[0][0][0]=="number"&&(pe=[pe]);var ct=(function(jr,Ji,ki){var Ai=null;return jr.length*Ji.length==0&&(ki===F?Ai=er:ki===G?Ai=jr:ki!==j&&ki!==Q||(Ai=jr.length===0?Ji:jr)),Ai})(de,pe,Ke);if(ct)return ct===er?null:ct;var Gt=[1/0,1/0,-1/0,-1/0],jt=[1/0,1/0,-1/0,-1/0],Kt=(function(jr,Ji,ki,Ai,an){var sn,Qi,en,Ni,Wr,ji,Sn=new ur(null,et);for(en=0,Ni=jr.length;en<Ni;en++)for(Wr=0,ji=(sn=jr[en]).length;Wr<ji;Wr++)(Qi=Wr===0)&&$r++,Vr(sn[Wr],!0,$r,Sn,ki,Qi);for(en=0,Ni=Ji.length;en<Ni;en++)for(Wr=0,ji=(sn=Ji[en]).length;Wr<ji;Wr++)Qi=Wr===0,an===G&&(Qi=!1),Qi&&$r++,Vr(sn[Wr],!1,$r,Sn,Ai,Qi);return Sn})(de,pe,Gt,jt,Ke);if(ct=(function(jr,Ji,ki,Ai,an){var sn=null;return(ki[0]>Ai[2]||Ai[0]>ki[2]||ki[1]>Ai[3]||Ai[1]>ki[3])&&(an===F?sn=er:an===G?sn=jr:an!==j&&an!==Q||(sn=jr.concat(Ji))),sn})(de,pe,Gt,jt,Ke))return ct===er?null:ct;for(var mr=(function(jr){var Ji,ki,Ai=(function(en){var Ni,Wr,ji,Sn,Ar=[];for(Wr=0,ji=en.length;Wr<ji;Wr++)((Ni=en[Wr]).left&&Ni.inResult||!Ni.left&&Ni.otherEvent.inResult)&&Ar.push(Ni);for(var pi=!1;!pi;)for(pi=!0,Wr=0,ji=Ar.length;Wr<ji;Wr++)Wr+1<ji&&et(Ar[Wr],Ar[Wr+1])===1&&(Sn=Ar[Wr],Ar[Wr]=Ar[Wr+1],Ar[Wr+1]=Sn,pi=!1);for(Wr=0,ji=Ar.length;Wr<ji;Wr++)(Ni=Ar[Wr]).otherPos=Wr;for(Wr=0,ji=Ar.length;Wr<ji;Wr++)(Ni=Ar[Wr]).left||(Sn=Ni.otherPos,Ni.otherPos=Ni.otherEvent.otherPos,Ni.otherEvent.otherPos=Sn);return Ar})(jr),an={},sn=[],Qi=function(){if(!an[Ji]){var en=sn.length,Ni=(function(Ar,pi,ln){var Mn=new nr;if(Ar.prevInResult!=null){var dn=Ar.prevInResult,go=dn.outputContourId;if(dn.resultTransition>0){var qi=pi[go];if(qi.holeOf!=null){var uo=qi.holeOf;pi[uo].holeIds.push(ln),Mn.holeOf=uo,Mn.depth=pi[go].depth}else pi[go].holeIds.push(ln),Mn.holeOf=go,Mn.depth=pi[go].depth+1}else Mn.holeOf=null,Mn.depth=pi[go].depth}else Mn.holeOf=null,Mn.depth=0;return Mn})(Ai[Ji],sn,en),Wr=function(Ar){an[Ar]=!0,Ar<Ai.length&&Ai[Ar]&&(Ai[Ar].outputContourId=en)},ji=Ji,Sn=Ji;for(Ni.points.push(Ai[Ji].point);Wr(ji),Wr(ji=Ai[ji].otherPos),Ni.points.push(Ai[ji].point),!((ji=Nt(ji,Ai,an,Sn))==Sn||ji>=Ai.length)&&Ai[ji];);sn.push(Ni)}};for(Ji=0,ki=Ai.length;Ji<ki;Ji++)Qi();return sn})((function(jr,Ji,ki,Ai,an,sn){for(var Qi,en,Ni,Wr=new d(Zt),ji=[],Sn=Math.min(Ai[2],an[2]);jr.length!==0;){var Ar=jr.pop();if(ji.push(Ar),sn===F&&Ar.point[0]>Sn||sn===G&&Ar.point[0]>Ai[2])break;if(Ar.left){en=Qi=Wr.insert(Ar),Qi=Qi!==(Ni=Wr.minNode())?Wr.prev(Qi):null,en=Wr.next(en);var pi=Qi?Qi.key:null;if(J(Ar,pi,sn),en&&dr(Ar,en.key,jr)===2&&(J(Ar,pi,sn),J(en.key,Ar,sn)),Qi&&dr(Qi.key,Ar,jr)===2){var ln=Qi;J(pi,(ln=ln!==Ni?Wr.prev(ln):null)?ln.key:null,sn),J(Ar,pi,sn)}}else en=Qi=Wr.find(Ar=Ar.otherEvent),Qi&&en&&(Qi=Qi!==Ni?Wr.prev(Qi):null,en=Wr.next(en),Wr.remove(Ar),en&&Qi&&dr(Qi.key,en.key,jr))}return ji})(Kt,0,0,Gt,jt,Ke)),Xr=[],Zr=0;Zr<mr.length;Zr++){var Hr=mr[Zr];if(Hr.isExterior()){for(var Bi=[Hr.points],mn=0;mn<Hr.holeIds.length;mn++)Bi.push(mr[Hr.holeIds[mn]].points);Xr.push(Bi)}}return Xr}var ci={UNION:j,DIFFERENCE:G,INTERSECTION:F,XOR:Q};a.diff=function(de,pe){return zr(de,pe,G)},a.intersection=function(de,pe){return zr(de,pe,F)},a.operations=ci,a.union=function(de,pe){return zr(de,pe,j)},a.xor=function(de,pe){return zr(de,pe,Q)},Object.defineProperty(a,"__esModule",{value:!0})})(t)})(0,e1.exports)),e1.exports);/**
 * martinez v0.7.4
 * Martinez polygon clipping algorithm, does boolean operation on polygons (multipolygons, polygons with holes etc): intersection, union, difference, xor
 *
 * @author Alex Milevski <info@w8r.name>
 * @license MIT
 * @preserve
 */function n_(s,t,a,u){const d=[],_=u===0?(v,S,E,R,P,B)=>{v.push(new Tt(B,E+(B-S)/(R-S)*(P-E)))}:(v,S,E,R,P,B)=>{v.push(new Tt(S+(B-E)/(P-E)*(R-S),B))};for(const v of s){const S=[];for(const E of v){if(E.length<=2)continue;const R=[];for(let F=0;F<E.length-1;F++){const j=E[F].x,G=E[F].y,Q=E[F+1].x,J=E[F+1].y,ee=u===0?j:G,se=u===0?Q:J;ee<t?se>t&&_(R,j,G,Q,J,t):ee>a?se<a&&_(R,j,G,Q,J,a):R.push(E[F]),se<t&&ee>=t&&_(R,j,G,Q,J,t),se>a&&ee<=a&&_(R,j,G,Q,J,a)}let P=E[E.length-1];const B=u===0?P.x:P.y;B>=t&&B<=a&&R.push(P),R.length&&(P=R[R.length-1],R[0].x===P.x&&R[0].y===P.y||R.push(R[0]),S.push(R))}S.length&&d.push(S)}return d}function rx(s,t){const a=o_(s),u=o_([t]),d=t1.intersection(a,u);return d==null?[]:Cd(d)}function ix(s,t){let u=o_(s,65536);const d=[];for(;t.valid();t.next()){const[_,v]=t.get(),S=_.x*65536,E=_.y*65536,R=v.x*65536,P=v.y*65536,B=R-S,F=P-E,j=Math.hypot(B,F);if(j===0)continue;const G=Math.trunc(F/j*3),Q=-Math.trunc(B/j*3);d.push([[[S,E],[R,P],[R+G,P+Q],[S+G,E+Q],[S,E]]])}return d.length>0&&(u=t1.diff(u,d)),Cd(u,1/65536)}function o_(s,t=1){return[s.map((a=>a.map((u=>[u.x*t,u.y*t]))))]}function Cd(s,t=1){return s.map((a=>a.map(((u,d)=>{const _=u.map((v=>new Tt(v[0]*t,v[1]*t).round()));return d>0&&_.reverse(),_}))))}class Id{constructor(t,a){this.layoutVertexArray=new ss,this.indexArray=new Cn,this.lineIndexArray=new Un,this.triangleSegments=new hn,this.lineSegments=new hn,this.programConfigurations=new Bo(t.layers,{zoom:t.zoom,lut:t.lut}),this.uploaded=!1,a&&(this.elevatedLayoutVertexArray=new Ps)}update(t,a,u,d,_,v,S,E){this.programConfigurations.updatePaintArrays(t,a,_,u,d,v,S,E)}isEmpty(){return this.layoutVertexArray.length===0}needsUpload(){return this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,Jg.members),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.lineIndexBuffer=t.createIndexBuffer(this.lineIndexArray),this.elevatedLayoutVertexArray&&this.elevatedLayoutVertexArray.length>0&&(this.elevatedLayoutVertexBuffer=t.createVertexBuffer(this.elevatedLayoutVertexArray,Hn.members))),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.elevatedLayoutVertexBuffer&&this.elevatedLayoutVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.lineIndexBuffer.destroy(),this.programConfigurations.destroy(),this.triangleSegments.destroy(),this.lineSegments.destroy())}populatePaintArrays(t,a,u,d,_,v,S){this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,a,u,d,_,v,void 0,S)}}class a_{constructor(t){this.zoom=t.zoom,this.pixelRatio=t.pixelRatio,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.patternFeatures=[],this.lut=t.lut,this.bufferData=new Id(t,!1),this.elevationBufferData=new Id(t,!0),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=t.projection,this.elevationMode=this.layers[0].layout.get("fill-elevation-reference"),this.sourceLayerIndex=t.sourceLayerIndex,this.worldview=t.worldview}updateFootprints(t,a){}populate(t,a,u,d){this.hasPattern=zc("fill",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("fill-sort-key"),v=[];for(const{feature:S,id:E,index:R,sourceLayerIndex:P}of t){const B=this.layers[0]._featureFilter.needGeometry,F=ft(S,B);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom,{worldview:this.worldview}),F,u))continue;const j=_?_.evaluate(F,{},u,a.availableImages):void 0,G={id:E,properties:S.properties,type:S.type,sourceLayerIndex:P,index:R,geometry:B?F.geometry:wt(S,u,d),patterns:{},sortKey:j};v.push(G)}_&&v.sort(((S,E)=>S.sortKey-E.sortKey));for(const S of v){const{geometry:E,index:R,sourceLayerIndex:P}=S;if(this.hasPattern){const B=m0("fill",this.layers,S,this.zoom,this.pixelRatio,a);this.patternFeatures.push(B)}else this.addFeature(S,E,R,u,{},a.availableImages,a.brightness,a.elevationFeatures);a.featureIndex.insert(t[R].feature,E,R,P,this.index)}}update(t,a,u,d,_,v,S){this.bufferData.update(t,a,u,d,_,v,S,this.worldview),this.elevationBufferData.update(t,a,u,d,_,v,S,this.worldview),this.elevatedStructures&&this.elevatedStructures.update(t,a,u,d,_,v,S,this.worldview)}addFeatures(t,a,u,d,_,v){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,u,d,v,t.elevationFeatures)}isEmpty(){return this.bufferData.isEmpty()&&this.elevationBufferData.isEmpty()}uploadPending(){return!this.uploaded||this.bufferData.needsUpload()||this.elevationBufferData.needsUpload()}upload(t){this.bufferData.upload(t),this.elevationBufferData.upload(t),this.elevatedStructures&&this.elevatedStructures.upload(t)}destroy(){this.bufferData.destroy(),this.elevationBufferData.destroy(),this.elevatedStructures&&this.elevatedStructures.destroy()}addFeature(t,a,u,d,_,v=[],S,E){const R=Za(a,500);this.elevationMode!=="none"?this.addElevatedRoadFeature(t,R,d,u,E):this.addGeometry(R,this.bufferData),this.bufferData.populatePaintArrays(t,u,_,v,d,S,this.worldview),this.elevationBufferData.populatePaintArrays(t,u,_,v,d,S,this.worldview)}getUnevaluatedPortalGraph(){return this.elevatedStructures?this.elevatedStructures.unevaluatedPortals:void 0}getElevationPolygons(){return this.elevatedStructures?this.elevatedStructures.portalPolygons:void 0}setEvaluatedPortalGraph(t,a,u,d,_){this.elevatedStructures&&(this.elevatedStructures.construct(t),this.elevatedStructures.populatePaintArrays(a,u,d,_,this.worldview))}addElevatedRoadFeature(t,a,u,d,_){const v=new Array,S=Xi.getElevationFeature(t,_);if(!S)return void this.addGeometry(a,this.bufferData);{const R=this.clipPolygonsToTile(a,1);R.length>0&&v.push({polygons:R,elevationFeature:S,elevationTileID:u})}const E={guardRailEnabled:this.layers[0].layout.get("fill-construct-bridge-guard-rail").evaluate(t,{},u),featureIndex:d};for(const R of v)if(R.elevationFeature){if(this.elevationMode==="hd-road-base"){this.elevatedStructures||(this.elevatedStructures=new hs(R.elevationTileID,this.layers,this.zoom,this.lut));const B=R.elevationFeature.isTunnel();let F=0;t.properties.hasOwnProperty(Si)&&(F=+t.properties[Si]);for(const j of R.polygons)this.elevatedStructures.addPortalCandidates(R.elevationFeature.id,j,B,R.elevationFeature,F)}R.elevationFeature.constantHeight==null&&(R.polygons=this.prepareElevatedPolygons(R.polygons,R.elevationFeature,R.elevationTileID));const P=new Bn(u,R.elevationTileID);this.addElevatedGeometry(R.polygons,P,R.elevationFeature,this.elevationMode==="hd-road-base"?0:.05,d,E)}}addElevatedGeometry(t,a,u,d,_,v){const S={elevation:u,elevationSampler:a,bias:d,index:_,featureInfo:v},[E,R]=this.addGeometry(t,this.elevationBufferData,S);this.elevationBufferData.heightRange==null?this.elevationBufferData.heightRange={min:E,max:R}:(this.elevationBufferData.heightRange.min=Math.min(this.elevationBufferData.heightRange.min,E),this.elevationBufferData.heightRange.max=Math.max(this.elevationBufferData.heightRange.max,R))}addGeometry(t,a,u){let d=Number.POSITIVE_INFINITY,_=Number.NEGATIVE_INFINITY,v=null;u&&(v=u.elevationSampler.constantElevation(u.elevation,u.bias),v!=null&&(d=v,_=v));const S=(E,R,P)=>{if(u!=null)if(R.push(E),v!=null)a.elevatedLayoutVertexArray.emplaceBack(v),P.push(v);else{const B=u.elevationSampler.pointElevation(E,u.elevation,u.bias);a.elevatedLayoutVertexArray.emplaceBack(B),P.push(B),d=Math.min(d,B),_=Math.max(_,B)}};for(const E of t){let R=0;for(const le of E)R+=le.length;const P=a.triangleSegments.prepareSegment(R,a.layoutVertexArray,a.indexArray),B=P.vertexLength,F=[],j=[],G=[],Q=[],J=[],ee=a.layoutVertexArray.length;for(const le of E){if(le.length===0)continue;le!==E[0]&&j.push(F.length/2);const he=a.lineSegments.prepareSegment(le.length,a.layoutVertexArray,a.lineIndexArray),Ee=he.vertexLength;u&&J.push(a.layoutVertexArray.length-ee),S(le[0],G,Q),a.layoutVertexArray.emplaceBack(le[0].x,le[0].y),a.lineIndexArray.emplaceBack(Ee+le.length-1,Ee),F.push(le[0].x),F.push(le[0].y);for(let Ce=1;Ce<le.length;Ce++)S(le[Ce],G,Q),a.layoutVertexArray.emplaceBack(le[Ce].x,le[Ce].y),a.lineIndexArray.emplaceBack(Ee+Ce-1,Ee+Ce),F.push(le[Ce].x),F.push(le[Ce].y);he.vertexLength+=le.length,he.primitiveLength+=le.length}const se=Vp(F,j);for(let le=0;le<se.length;le+=3)a.indexArray.emplaceBack(B+se[le],B+se[le+1],B+se[le+2]);if(se.length>0&&u&&this.elevationMode==="hd-road-base"){const le=u.elevation.isTunnel(),he=u.elevation.safeArea,Ee=this.elevatedStructures.addVertices(G,Q);this.elevatedStructures.addTriangles(se,Ee,le);const Ce=J.length;if(Ce>0){for(let De=0;De<Ce-1;De++)this.elevatedStructures.addRenderableRing(u.index,J[De]+Ee,J[De+1]-J[De],le,he,u.featureInfo);this.elevatedStructures.addRenderableRing(u.index,J[Ce-1]+Ee,G.length-J[Ce-1],le,he,u.featureInfo)}}P.vertexLength+=R,P.primitiveLength+=se.length/3}return[d,_]}prepareElevatedPolygons(t,a,u){const d=1/Ge(u),_=[];for(const v of t){const S=ix(v,new Ti(a,d));_.push(...S)}return _}clipPolygonsToTile(t,a){const u=-a,d=-a,_=Bt+a,v=Bt+a;let S=0;const E=[],R=[];for(;S<t.length;S++){const F=t[S],j=Kc(F);(j.min.x>=u&&j.max.x<=_&&j.min.y>=d&&j.max.y<=v?E:R).push(F)}if(E.length===t.length)return t;const P=[new Tt(u,d),new Tt(_,d),new Tt(_,v),new Tt(u,v),new Tt(u,d)],B=E;for(const F of R)B.push(...rx(F,P));return B}}let r1,Rd,Hp,g0;$t(a_,"FillBucket",{omit:["layers","patternFeatures"]}),$t(Id,"FillBufferData"),$t(hs,"ElevatedStructures");class Md{constructor(t,a,u,d){if(this.triangleCount=a.length/3,this.min=new Tt(0,0),this.max=new Tt(0,0),this.xScale=0,this.yScale=0,this.cellsX=0,this.cellsY=0,this.cells=[],this.payload=[],this.triangleCount===0||t.length===0)return;const[_,v]=[t[0].clone(),t[0].clone()];for(let B=1;B<t.length;++B){const F=t[B];_.x=Math.min(_.x,F.x),_.y=Math.min(_.y,F.y),v.x=Math.max(v.x,F.x),v.y=Math.max(v.y,F.y)}if(d){const B=Math.ceil(Math.max(v.x-_.x,v.y-_.y)/d);u=Math.max(u,B)}if(u===0)return;this.min=_,this.max=v;const S=this.max.sub(this.min);S.x=Math.max(S.x,1),S.y=Math.max(S.y,1);const E=Math.max(S.x,S.y)/u;this.cellsX=Math.max(1,Math.ceil(S.x/E)),this.cellsY=Math.max(1,Math.ceil(S.y/E)),this.xScale=1/E,this.yScale=1/E;const R=[];for(let B=0;B<this.triangleCount;B++){const F=t[a[3*B+0]].sub(this.min),j=t[a[3*B+1]].sub(this.min),G=t[a[3*B+2]].sub(this.min),Q=Ul(Math.floor(Math.min(F.x,j.x,G.x)),this.xScale,this.cellsX),J=Ul(Math.floor(Math.max(F.x,j.x,G.x)),this.xScale,this.cellsX),ee=Ul(Math.floor(Math.min(F.y,j.y,G.y)),this.yScale,this.cellsY),se=Ul(Math.floor(Math.max(F.y,j.y,G.y)),this.yScale,this.cellsY),le=new Tt(0,0),he=new Tt(0,0),Ee=new Tt(0,0),Ce=new Tt(0,0);for(let De=ee;De<=se;++De){le.y=he.y=De*E,Ee.y=Ce.y=(De+1)*E;for(let Le=Q;Le<=J;++Le)le.x=Ee.x=Le*E,he.x=Ce.x=(Le+1)*E,(Oc(F,j,G,le,he,Ce)||Oc(F,j,G,le,Ce,Ee))&&R.push({cellIdx:De*this.cellsX+Le,triIdx:B})}}if(R.length===0)return;R.sort(((B,F)=>B.cellIdx-F.cellIdx||B.triIdx-F.triIdx));let P=0;for(;P<R.length;){const B=R[P].cellIdx,F={start:this.payload.length,len:0};for(;P<R.length&&R[P].cellIdx===B;)++F.len,this.payload.push(R[P++].triIdx);this.cells[B]=F}}_lazyInitLookup(){this.lookup||(this.lookup=new Uint8Array(Math.ceil(this.triangleCount/8))),this.lookup.fill(0)}queryPoint(t,a){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>t.x||t.y>this.max.y||this.min.y>t.y)return;const u=Ul(t.x-this.min.x,this.xScale,this.cellsX),d=Ul(t.y-this.min.y,this.yScale,this.cellsY),_=this.cells[d*this.cellsX+u];if(_){this._lazyInitLookup();for(let v=0;v<_.len;v++){const S=this.payload[_.start+v],E=Math.floor(S/8),R=1<<S%8;if(!(this.lookup[E]&R)&&(this.lookup[E]|=R,a.push(S),a.length===this.triangleCount))return}}}query(t,a,u){if(this.triangleCount===0||this.cells.length===0||t.x>this.max.x||this.min.x>a.x||t.y>this.max.y||this.min.y>a.y)return;this._lazyInitLookup();const d=Ul(t.x-this.min.x,this.xScale,this.cellsX),_=Ul(a.x-this.min.x,this.xScale,this.cellsX),v=Ul(t.y-this.min.y,this.yScale,this.cellsY),S=Ul(a.y-this.min.y,this.yScale,this.cellsY);for(let E=v;E<=S;E++)for(let R=d;R<=_;R++){const P=this.cells[E*this.cellsX+R];if(P)for(let B=0;B<P.len;B++){const F=this.payload[P.start+B],j=Math.floor(F/8),G=1<<F%8;if(!(this.lookup[j]&G)&&(this.lookup[j]|=G,u.push(F),u.length===this.triangleCount))return}}}}function Ul(s,t,a){return Math.max(0,Math.min(a-1,Math.floor(s*t)))}$t(Md,"TriangleGridIndex");class s_{constructor(t){this.zoom=t.zoom,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.footprints=[],this.worldview=t.worldview}updateFootprints(t,a){for(const u of this.footprints)a.push({footprint:u,id:t})}populate(t,a,u,d){const _=[];for(const{feature:v,id:S,index:E,sourceLayerIndex:R}of t){const P=this.layers[0]._featureFilter.needGeometry,B=ft(v,P);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom,{worldview:this.worldview}),B,u))continue;const F={id:S,properties:v.properties,type:v.type,sourceLayerIndex:R,index:E,geometry:P?B.geometry:wt(v,u,d),patterns:{}};_.push(F)}for(const v of _){const{geometry:S,index:E,sourceLayerIndex:R}=v;this.addFeature(v,S,E,u,{},a.availableImages,a.brightness),a.featureIndex.insert(t[E].feature,S,E,R,this.index)}}isEmpty(){return this.footprints.length===0}uploadPending(){return!1}upload(t){}update(t,a,u,d,_,v,S){}destroy(){}addFeature(t,a,u,d,_,v=[],S){for(const E of Za(a,2)){const R=[],P=[],B=[],F=new Tt(1/0,1/0),j=new Tt(-1/0,-1/0);for(const J of E)if(J.length!==0){J!==E[0]&&B.push(P.length/2);for(let ee=0;ee<J.length;ee++)P.push(J[ee].x),P.push(J[ee].y),R.push(J[ee]),F.x=Math.min(F.x,J[ee].x),F.y=Math.min(F.y,J[ee].y),j.x=Math.max(j.x,J[ee].x),j.y=Math.max(j.y,J[ee].y)}const G=Vp(P,B),Q=new Md(R,G,8,256);this.footprints.push({vertices:R,indices:G,grid:Q,min:F,max:j})}}}$t(s_,"ClipBucket",{omit:["layers"]});const l_=ei([{name:"a_pos_normal_ed",components:4,type:"Int16"}]),i1=ei([{name:"a_pos_end",components:4,type:"Int16"},{name:"a_angular_offset_factor",components:1,type:"Int16"}]),n1=ei([{name:"a_centroid_pos",components:2,type:"Uint16"}]),nx=ei([{name:"a_join_normal_inside",components:3,type:"Int16"}]),o1=ei([{name:"a_hidden_by_landmark",components:1,type:"Uint8"}]),Wm=ei([{name:"a_pos_3",components:3,type:"Int16"},{name:"a_pos_normal_3",components:3,type:"Int16"}]),{members:ox}=l_,Ym=Number.MAX_SAFE_INTEGER,a1=Ym-1;function Qm(s,t,a,u){return s.order<t||s.order===Ym||!(s.clipMask&a)||(function(d,_){return _.length!==0&&_.find((v=>v===d))===void 0})(u,s.clipScope)}function Dd(s,t){return s.x-t.x||s.y-t.y}function c_(s,t){return Dd(s.min,t.min)===0&&Dd(s.max,t.max)===0}function _0(s,t){return!(s.min.x>t.max.x||s.max.x<t.min.x||s.min.y>t.max.y||s.max.y<t.min.y)}function vf(s,t){if(s.length!==t.length)return!1;for(let a=0;a<s.length;a++)if(s[a].sourceId!==t[a].sourceId||!c_(s[a],t[a])||s[a].order!==t[a].order||s[a].clipMask!==t[a].clipMask||!Ws(s[a].clipScope,t[a].clipScope))return!1;return!0}function s1(s,t,a){const u=1/Bt,d=1/(1<<a.canonical.z),_=(t.x*u+a.canonical.x)*d+a.wrap,v=(t.y*u+a.canonical.y)*d;return{min:new Tt((s.x*u+a.canonical.x)*d+a.wrap,(s.y*u+a.canonical.y)*d),max:new Tt(_,v)}}function l1(s,t,a){const u=1<<a.canonical.z,d=((t.x-a.wrap)*u-a.canonical.x)*Bt,_=(t.y*u-a.canonical.y)*Bt;return{min:new Tt(((s.x-a.wrap)*u-a.canonical.x)*Bt,(s.y*u-a.canonical.y)*Bt),max:new Tt(d,_)}}function u_(s,t,a,u,d,_,v){const S=s.indices,E=s.vertices,R=[];for(let P=u;P<u+d;P+=3){const B=t[a[P+0]+_],F=t[a[P+1]+_],j=t[a[P+2]+_],G=Math.min(B.x,F.x,j.x),Q=Math.max(B.x,F.x,j.x),J=Math.min(B.y,F.y,j.y),ee=Math.max(B.y,F.y,j.y);R.length=0,s.grid.query(new Tt(G,J),new Tt(Q,ee),R);for(let se=0;se<R.length;se++){const le=R[se];if(Oc(E[S[3*le+0]],E[S[3*le+1]],E[S[3*le+2]],B,F,j,v))return!0}}return!1}function y0(s,t,a,u){if(!s||!a)return!1;let d=s.vertices;if(!t.canonical.equals(u.canonical)||t.wrap!==u.wrap){if(a.vertices.length<s.vertices.length)return y0(a,u,s,t);const _=t.canonical,v=u.canonical,S=Math.pow(2,v.z-_.z);d=s.vertices.map((E=>new Tt((E.x+_.x*Bt)*S-v.x*Bt,(E.y+_.y*Bt)*S-v.y*Bt)))}return u_(a,d,s.indices,0,s.indices.length,0,0)}function v0(s,t,a,u){const d=Math.pow(2,u.z-a.z);return new Tt((s+a.x*Bt)*d-u.x*Bt,(t+a.y*Bt)*d-u.y*Bt)}function Km(s,t){const a=[];t.grid.queryPoint(s,a);const u=t.indices,d=t.vertices;for(let _=0;_<a.length;_++){const v=a[_];if(lo([d[u[3*v+0]],d[u[3*v+1]],d[u[3*v+2]]],s))return!0}return!1}const h_=[new Tt(0,0),new Tt(Bt,0),new Tt(Bt,Bt),new Tt(0,Bt)];function Jm(s,t){const a=[];let u=[];if(!t||s.length<2)return[s];if(s.length===2)return Ao(s[0],s[1],h_)?[s]:[];for(let d=0;d<s.length+2;d++){const _=s[d%s.length],v=s[(d+1)%s.length],S=Ao(d===0?s[s.length-1]:s[(d-1)%s.length],_,h_),E=Ao(_,v,h_),R=S||E;R&&u.push(_),R&&E||u.length>0&&(u.length>1&&a.push(u),u=[])}return u.length>1&&a.push(u),a}const x0=pt.types,ax=["fill-extrusion-base","fill-extrusion-height","fill-extrusion-color","fill-extrusion-pattern","fill-extrusion-flood-light-wall-radius","fill-extrusion-line-width","fill-extrusion-emissive-strength"],b0=["fill-extrusion-flood-light-ground-radius"],w0=Math.pow(2,13),f_=Math.pow(2,15)-1,d_=new Tt(0,1),mh=2147483648;function Od(s,t,a,u,d,_,v,S){s.emplaceBack((t<<1)+v,(a<<1)+_,(Math.floor(u*w0)<<1)+d,Math.round(S))}function jl(s,t,a){s.emplaceBack(t.x*Bt,t.y*Bt,a?1:0)}function Fc(s,t,a,u,d,_){s.emplaceBack(t.x,t.y,(a.x<<1)+u,(a.y<<1)+d,_)}function Gl(s,t,a){s.emplaceBack(t.x,t.y,t.z,a[0]*16384,a[1]*16384,a[2]*16384)}class qp{constructor(){this.vertexOffset=0,this.vertexCount=0,this.indexOffset=0,this.indexCount=0}}class $p{constructor(){this.centroidXY=new Tt(0,0),this.vertexArrayOffset=0,this.vertexCount=0,this.groundVertexArrayOffset=0,this.groundVertexCount=0,this.flags=0,this.footprintSegIdx=-1,this.footprintSegLen=0,this.polygonSegIdx=-1,this.polygonSegLen=0,this.min=new Tt(Number.MAX_VALUE,Number.MAX_VALUE),this.max=new Tt(-Number.MAX_VALUE,-Number.MAX_VALUE),this.height=0,this.buildingId=0}span(){return new Tt(this.max.x-this.min.x,this.max.y-this.min.y)}}class gh{constructor(){this.acc=new Tt(0,0),this.accCount=0,this.centroidDataIndex=0}startRing(t,a){t.min.x===Number.MAX_VALUE&&(t.min.x=t.max.x=a.x,t.min.y=t.max.y=a.y)}appendEdge(t,a,u){this.accCount++,this.acc._add(a);let d=!!this.borders;a.x<t.min.x?(t.min.x=a.x,d=!0):a.x>t.max.x&&(t.max.x=a.x,d=!0),a.y<t.min.y?(t.min.y=a.y,d=!0):a.y>t.max.y&&(t.max.y=a.y,d=!0),((a.x===0||a.x===Bt)&&a.x===u.x)!=((a.y===0||a.y===Bt)&&a.y===u.y)&&this.processBorderOverlap(a,u),d&&this.checkBorderIntersection(a,u)}checkBorderIntersection(t,a){a.x<0!=t.x<0&&this.addBorderIntersection(0,xr(a.y,t.y,(0-a.x)/(t.x-a.x))),a.x>Bt!=t.x>Bt&&this.addBorderIntersection(1,xr(a.y,t.y,(Bt-a.x)/(t.x-a.x))),a.y<0!=t.y<0&&this.addBorderIntersection(2,xr(a.x,t.x,(0-a.y)/(t.y-a.y))),a.y>Bt!=t.y>Bt&&this.addBorderIntersection(3,xr(a.x,t.x,(Bt-a.y)/(t.y-a.y)))}addBorderIntersection(t,a){this.borders||(this.borders=[[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE],[Number.MAX_VALUE,-Number.MAX_VALUE]]);const u=this.borders[t];a<u[0]&&(u[0]=a),a>u[1]&&(u[1]=a)}processBorderOverlap(t,a){if(t.x===a.x){if(t.y===a.y)return;const u=t.x===0?0:1;this.addBorderIntersection(u,a.y),this.addBorderIntersection(u,t.y)}else{const u=t.y===0?2:3;this.addBorderIntersection(u,a.x),this.addBorderIntersection(u,t.x)}}centroid(){return this.accCount===0?new Tt(0,0):new Tt(Math.floor(Math.max(0,this.acc.x)/this.accCount),Math.floor(Math.max(0,this.acc.y)/this.accCount))}intersectsCount(){return this.borders?this.borders.reduce(((t,a)=>t+ +(a[0]!==Number.MAX_VALUE)),0):0}}function c1(s,t){const a=s.add(t)._unit(),u=Ie(s.x*a.x+s.y*a.y,-1,1);var d,_,v;return d=Math.acos(u),Math.min(4,Math.max(-4,Math.tan(d)))/4*f_*((_=s).x*(v=t).y-_.y*v.x<0?-1:1)}const u1=[s=>s.x<0,s=>s.x>Bt,s=>s.y<0,s=>s.y>Bt];function eg(s,t,a,u){const d=[4];if(u===0)return d;a._mult(u);const _=s.sub(a),v=t.sub(a),S=[s,t,_,v];for(let E=0;E<4;E++)for(const R of S)if(u1[E](R)){d.push(E);break}return d}class S0{constructor(t){this.vertexArray=new bp,this.indexArray=new Cn,this.programConfigurations=new Bo(t.layers,{zoom:t.zoom,lut:t.lut},(a=>b0.includes(a))),this._segments=new hn,this.hiddenByLandmarkVertexArray=new _d,this._segmentToGroundQuads={},this._segmentToGroundQuads[0]=[],this._segmentToRegionTriCounts={},this._segmentToRegionTriCounts[0]=[0,0,0,0,0],this.regionSegments={},this.regionSegments[4]=new hn}getDefaultSegment(){return this.regionSegments[4]}hasData(){return this.vertexArray.length!==0}addData(t,a,u,d=!1){const _=t.length;if(_>2){let v=Math.max(0,this._segments.get().length-1);const S=this._segments._prepareSegment(4*_,this.vertexArray.length,2*this._segmentToGroundQuads[v].length);let E;v!==this._segments.get().length-1&&(v++,this._segmentToGroundQuads[v]=[],this._segmentToRegionTriCounts[v]=[0,0,0,0,0]);{const R=t[0],P=t[1];E=c1(R.sub(t[_-1])._perp()._unit(),P.sub(R)._perp()._unit())}for(let R=0;R<_;R++){const P=R===_-1?0:R+1,B=t[R],F=t[P],j=t[P===_-1?0:P+1],G=F.sub(B)._perp()._unit(),Q=c1(G,j.sub(F)._perp()._unit()),J=E,ee=Q;if(Xp(B,F,a)||d&&ig(B,a)&&ig(F,a)){E=Q;continue}const se=S.vertexLength;Fc(this.vertexArray,B,F,1,1,J),Fc(this.vertexArray,B,F,1,0,J),Fc(this.vertexArray,B,F,0,1,ee),Fc(this.vertexArray,B,F,0,0,ee),S.vertexLength+=4;const le=eg(B,F,G,u);for(const he of le)this._segmentToGroundQuads[v].push({id:se,region:he}),this._segmentToRegionTriCounts[v][he]+=2,S.primitiveLength+=2;E=Q}}}prepareBorderSegments(){if(!this.hasData())return;const t=this._segments.get(),a=t.length;for(let u=0;u<a;u++)this._segmentToGroundQuads[u].sort(((d,_)=>d.region-_.region));for(let u=0;u<a;u++){const d=this._segmentToGroundQuads[u],_=t[u],v=this._segmentToRegionTriCounts[u];v.reduce(((E,R)=>E+R),0);let S=0;for(let E=0;E<=4;E++){const R=v[E];if(R!==0){let P=this.regionSegments[E];P||(P=this.regionSegments[E]=new hn);const B={vertexOffset:_.vertexOffset,primitiveOffset:_.primitiveOffset+S,vertexLength:_.vertexLength,primitiveLength:R};P.get().push(B)}S+=R}for(let E=0;E<d.length;E++){const R=d[E].id;this.indexArray.emplaceBack(R,R+1,R+3),this.indexArray.emplaceBack(R,R+3,R+2)}}this._segmentToGroundQuads=null,this._segmentToRegionTriCounts=null,this._segments.destroy(),this._segments=null}addPaintPropertiesData(t,a,u,d,_,v,S){this.hasData()&&this.programConfigurations.populatePaintArrays(this.vertexArray.length,t,a,u,d,_,v,void 0,S)}upload(t){this.hasData()&&(this.vertexBuffer=t.createVertexBuffer(this.vertexArray,i1.members),this.indexBuffer=t.createIndexBuffer(this.indexArray))}uploadPaintProperties(t){this.hasData()&&this.programConfigurations.upload(t)}update(t,a,u,d,_,v,S,E){this.hasData()&&this.programConfigurations.updatePaintArrays(t,a,u,d,_,v,S,E)}updateHiddenByLandmark(t){this.updateHiddenByLandmarkRange(t.groundVertexArrayOffset,t.groundVertexCount,!!(t.flags&mh))}updateHiddenByLandmarkRange(t,a,u){if(!this.hasData())return;const d=a+t;if(a!==0){for(let _=t;_<d;++_)this.hiddenByLandmarkVertexArray.emplace(_,u?1:0);this._needsHiddenByLandmarkUpdate=!0}}uploadHiddenByLandmark(t){this.hasData()&&this._needsHiddenByLandmarkUpdate&&(!this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexArray.length>0?this.hiddenByLandmarkVertexBuffer=t.createVertexBuffer(this.hiddenByLandmarkVertexArray,o1.members,!0):this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.updateData(this.hiddenByLandmarkVertexArray),this._needsHiddenByLandmarkUpdate=!1)}destroy(){if(this.vertexBuffer){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.hiddenByLandmarkVertexBuffer&&this.hiddenByLandmarkVertexBuffer.destroy(),this._segments&&this._segments.destroy(),this.programConfigurations.destroy();for(let t=0;t<=4;t++){const a=this.regionSegments[t];a&&a.destroy()}}}}class tg{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.overscaling=t.overscaling,this.layers=t.layers,this.pixelRatio=t.pixelRatio,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.edgeRadius=0,this.projection=t.projection,this.activeReplacements=[],this.replacementUpdateTime=0,this.centroidData=[],this.footprintIndices=new Cn,this.footprintVertices=new ss,this.footprintSegments=[],this.layoutVertexArray=new Pl,this.centroidVertexArray=new Op,this.wallVertexArray=new Vm,this.indexArray=new Cn,this.programConfigurations=new Bo(t.layers,{zoom:t.zoom,lut:t.lut},(a=>ax.includes(a))),this.segments=new hn,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.groundEffect=new S0(t),this.maxHeight=0,this.partLookup={},this.triangleSubSegments=[],this.polygonSegments=[],this.worldview=t.worldview}updateFootprints(t,a){}populate(t,a,u,d){this.features=[],this.hasPattern=zc("fill-extrusion",this.layers,this.pixelRatio,a),this.featuresOnBorder=[],this.borderFeatureIndices=[[],[],[],[]],this.borderDoneWithNeighborZ=[-1,-1,-1,-1],this.selfDEMTileTimestamp=Number.MAX_VALUE,this.borderDEMTileTimestamp=[Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE,Number.MAX_VALUE],this.tileToMeter=Ge(u),this.edgeRadius=this.layers[0].layout.get("fill-extrusion-edge-radius")/this.tileToMeter,this.wallMode=this.layers[0].paint.get("fill-extrusion-line-width").constantOr(1)!==0;for(const{feature:_,id:v,index:S,sourceLayerIndex:E}of t){const R=this.layers[0]._featureFilter.needGeometry,P=ft(_,R);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom,{worldview:this.worldview}),P,u))continue;const B={id:v,sourceLayerIndex:E,index:S,geometry:R?P.geometry:wt(_,u,d),properties:_.properties,type:_.type,patterns:{}},F=this.layoutVertexArray.length,j=x0[B.type]==="Polygon";if(this.hasPattern)this.features.push({featureId:_.id,feature:m0("fill-extrusion",this.layers,B,this.zoom,this.pixelRatio,a)});else if(this.wallMode)for(const G of B.geometry)for(const Q of Jm(G,j))this.addFeature(_.id,B,[Q],S,u,{},a.availableImages,d,a.brightness);else this.addFeature(_.id,B,B.geometry,S,u,{},a.availableImages,d,a.brightness);a.featureIndex.insert(_,B.geometry,S,E,this.index,F)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles(),this.groundEffect.prepareBorderSegments(),this.polygonSegments.length=0}addFeatures(t,a,u,d,_,v){for(const{featureId:S,feature:E}of this.features){const R=x0[E.type]==="Polygon",{geometry:P}=E;if(this.wallMode)for(const B of P)for(const F of Jm(B,R))this.addFeature(S,E,[F],E.index,a,u,d,_,v);else this.addFeature(S,E,P,E.index,a,u,d,_,v)}this.sortBorders(),this.projection.name==="mercator"&&this.splitToSubtiles()}update(t,a,u,d,_,v,S){this.programConfigurations.updatePaintArrays(t,a,_,u,d,v,S,this.worldview),this.groundEffect.update(t,a,_,u,d,v,S,this.worldview)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,ox),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.wallVertexBuffer=t.createVertexBuffer(this.wallVertexArray,nx.members),this.layoutVertexExtArray&&(this.layoutVertexExtBuffer=t.createVertexBuffer(this.layoutVertexExtArray,Wm.members,!0)),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}uploadCentroid(t){this.groundEffect.uploadHiddenByLandmark(t),this.needsCentroidUpdate&&(!this.centroidVertexBuffer&&this.centroidVertexArray.length>0?this.centroidVertexBuffer=t.createVertexBuffer(this.centroidVertexArray,n1.members,!0):this.centroidVertexBuffer&&this.centroidVertexBuffer.updateData(this.centroidVertexArray),this.needsCentroidUpdate=!1)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.centroidVertexBuffer&&this.centroidVertexBuffer.destroy(),this.layoutVertexExtBuffer&&this.layoutVertexExtBuffer.destroy(),this.groundEffect.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}addFeature(t,a,u,d,_,v,S,E,R){const P=this.layers[0].paint.get("fill-extrusion-flood-light-ground-radius").evaluate(a,{})/this.tileToMeter,B=[new Tt(0,0),new Tt(Bt,Bt)],F=E.projection,j=F.name==="globe",G=this.wallMode||x0[a.type]==="Polygon",Q=new gh;Q.centroidDataIndex=this.centroidData.length;const J=new $p;J.buildingId=t,a.properties&&a.properties.hasOwnProperty("building_id")&&(J.buildingId=a.properties.building_id);const ee=this.layers[0].paint.get("fill-extrusion-base").evaluate(a,{},_)<=0,se=this.layers[0].paint.get("fill-extrusion-height").evaluate(a,{},_);let le;if(J.height=se,J.vertexArrayOffset=this.layoutVertexArray.length,J.groundVertexArrayOffset=this.groundEffect.vertexArray.length,j&&!this.layoutVertexExtArray&&(this.layoutVertexExtArray=new il),this.wallMode){if(j)return void ri("Non zero fill-extrusion-line-width is not yet supported on globe.");if(u.length!==1)return;le=(function(Ue){const dt=Ue[0].x===Ue[Ue.length-1].x&&Ue[0].y===Ue[Ue.length-1].y;(function(Nt){let ur=0;const Dr=Nt.length;for(let Ht=0;Ht<Dr;Ht++)ur+=(Nt[(Ht+1)%Dr].x-Nt[Ht].x)*(Nt[(Ht+1)%Dr].y+Nt[Ht].y);return ur>=0})(Ue)||(Ue=Ue.reverse());const gt={geometry:[],joinNormals:[],indices:[]},yt=[],Rt=[],lt=[];let vt=Ue.length;for(;vt>=2&&Ue[vt-1].equals(Ue[vt-2]);)vt--;if(vt<(dt?3:2))return gt;let et,We,Dt,Et,dr,Zt=0;for(;Zt<vt-1&&Ue[Zt].equals(Ue[Zt+1]);)Zt++;dt&&(et=Ue[vt-2],dr=Ue[Zt].sub(et)._unit()._perp());for(let Nt=Zt;Nt<vt;Nt++){if(Dt=Nt===vt-1?dt?Ue[Zt+1]:void 0:Ue[Nt+1],Dt&&Ue[Nt].equals(Dt))continue;dr&&(Et=dr),et&&(We=et),et=Ue[Nt],dr=Dt?Dt.sub(et)._unit()._perp():Et,Et=Et||dr;let ur=Et.add(dr);ur.x===0&&ur.y===0||ur._unit();const Dr=ur.x*dr.x+ur.y*dr.y,Ht=Dr!==0?1/Dr:1/0,ar=Et.x*dr.y-Et.y*dr.x>0;let Sr="miter";const Br=2;Sr==="miter"&&Ht>Br&&(Sr="bevel"),Sr==="bevel"&&(Ht>100&&(Sr="flipbevel"),Ht<Br&&(Sr="miter"));const $r=(Vr,er,zr,ci)=>{const de=new Tt(Vr.x,Vr.y),pe=new Tt(Vr.x,Vr.y);de.x+=er.x*ci,de.y+=er.y*ci,pe.x-=er.x*Math.max(zr,1),pe.y-=er.y*Math.max(zr,1),lt.push(er),yt.push(de),Rt.push(pe)};if(Sr==="miter")ur._mult(Ht),$r(et,ur,0,0);else if(Sr==="flipbevel")ur=dr.mult(-1),$r(et,ur,0,0),$r(et,ur.mult(-1),0,0);else{const Vr=-Math.sqrt(Ht*Ht-1),er=ar?Vr:0,zr=ar?0:Vr;We&&$r(et,Et,er,zr),Dt&&$r(et,dr,er,zr)}}gt.geometry=[...yt,...Rt.reverse(),yt[0]],gt.joinNormals=[...lt,...lt.reverse(),lt[lt.length-1]];const nr=gt.geometry.length-1;for(let Nt=0;Nt<nr/2;Nt++)if(Nt+1<nr/2){let ur=Nt,Dr=Nt+1,Ht=nr-1-Nt,ar=nr-2-Nt;ur=ur===0?nr-1:ur-1,Dr=Dr===0?nr-1:Dr-1,Ht=Ht===0?nr-1:Ht-1,ar=ar===0?nr-1:ar-1,gt.indices.push(Ht),gt.indices.push(Dr),gt.indices.push(ur),gt.indices.push(Ht),gt.indices.push(ar),gt.indices.push(Dr)}return gt})(u[0]),u=[le.geometry]}const he=(Ue,dt)=>Ue<(dt.length-1)/2||Ue===dt.length-1,Ee=this.wallMode?[u]:Za(u,500);for(let Ue=Ee.length-1;Ue>=0;Ue--){const dt=Ee[Ue];(dt.length===0||(Ce=dt[0]).every((St=>St.x<=0))||Ce.every((St=>St.x>=Bt))||Ce.every((St=>St.y<=0))||Ce.every((St=>St.y>=Bt)))&&Ee.splice(Ue,1)}var Ce;let De;if(j)De=ng(Ee,B,_);else{De=[];for(const Ue of Ee)De.push({polygon:Ue,bounds:B})}const Le=G?this.edgeRadius:0,Fe=Le>0&&this.zoom<17,ut=(Ue,dt)=>{if(Ue.length===0)return!1;const St=Ue[Ue.length-1];return dt.x===St.x&&dt.y===St.y};for(const{polygon:Ue,bounds:dt}of De){let St=0,gt=0;for(const vt of Ue)G&&!vt[0].equals(vt[vt.length-1])&&vt.push(vt[0]),gt+=G?vt.length-1:vt.length;const yt=this.segments.prepareSegment((G?5:4)*gt,this.layoutVertexArray,this.indexArray);J.footprintSegIdx<0&&(J.footprintSegIdx=this.footprintSegments.length),J.polygonSegIdx<0&&(J.polygonSegIdx=this.polygonSegments.length);const Rt={triangleArrayOffset:this.indexArray.length,triangleCount:0,triangleSegIdx:this.segments.segments.length-1},lt=new qp;if(lt.vertexOffset=this.footprintVertices.length,lt.indexOffset=3*this.footprintIndices.length,lt.ringIndices=[],G){const vt=[],et=[];St=yt.vertexLength;for(let Dt=0;Dt<Ue.length;Dt++){const Et=Ue[Dt];Et.length&&Dt!==0&&et.push(vt.length/2);const dr=[];let Zt,nr;Zt=Et[1].sub(Et[0])._perp()._unit(),lt.ringIndices.push(Et.length-1);for(let Nt=1;Nt<Et.length;Nt++){const ur=Et[Nt],Dr=Et[Nt===Et.length-1?1:Nt+1],Ht=ur.clone();if(Le){nr=Dr.sub(ur)._perp()._unit();const ar=Zt.add(nr)._unit(),Sr=Le*Math.min(4,1/(Zt.x*ar.x+Zt.y*ar.y));Ht.x+=Sr*ar.x,Ht.y+=Sr*ar.y,Ht.x=Math.round(Ht.x),Ht.y=Math.round(Ht.y),Zt=nr}if(!ee||Le!==0&&!Fe||ut(dr,Ht)||dr.push(Ht),Od(this.layoutVertexArray,Ht.x,Ht.y,0,0,1,1,0),this.wallMode){const ar=he(Nt,Et);jl(this.wallVertexArray,le.joinNormals[Nt],!ar)}yt.vertexLength++,this.footprintVertices.emplaceBack(ur.x,ur.y),vt.push(ur.x,ur.y),j&&Gl(this.layoutVertexExtArray,F.projectTilePoint(Ht.x,Ht.y,_),F.upVector(_,Ht.x,Ht.y))}ee&&(Le===0||Fe)&&(dr.length!==0&&ut(dr,dr[0])&&dr.pop(),this.groundEffect.addData(dr,dt,P))}const We=this.wallMode?le.indices:Vp(vt,et);for(let Dt=0;Dt<We.length;Dt+=3)this.footprintIndices.emplaceBack(lt.vertexOffset+We[Dt+0],lt.vertexOffset+We[Dt+1],lt.vertexOffset+We[Dt+2]),this.indexArray.emplaceBack(St+We[Dt],St+We[Dt+2],St+We[Dt+1]),yt.primitiveLength++;lt.indexCount+=We.length,lt.vertexCount+=this.footprintVertices.length-lt.vertexOffset}for(let vt=0;vt<Ue.length;vt++){const et=Ue[vt];Q.startRing(J,et[0]);let We=et.length>4&&T0(et[et.length-2],et[0],et[1]),Dt=Le?h1(et[et.length-2],et[0],et[1],Le):0;const Et=[];let dr,Zt,nr;Zt=et[1].sub(et[0])._perp()._unit();let Nt=!0;for(let ur=1,Dr=0;ur<et.length;ur++){let Ht=et[ur-1],ar=et[ur];const Sr=et[ur===et.length-1?1:ur+1];if(Q.appendEdge(J,ar,Ht),Xp(ar,Ht,dt)){Le&&(Zt=Sr.sub(ar)._perp()._unit(),Nt=!Nt);continue}const Br=ar.sub(Ht)._perp(),$r=Br.x/(Math.abs(Br.x)+Math.abs(Br.y)),Vr=Br.y>0?1:0,er=Ht.dist(ar);if(Dr+er>32768&&(Dr=0),Le){nr=Sr.sub(ar)._perp()._unit();let pe=f1(Ht,ar,Sr,rg(Zt,nr),Le);isNaN(pe)&&(pe=0);const Ke=ar.sub(Ht)._unit();Ht=Ht.add(Ke.mult(Dt))._round(),ar=ar.add(Ke.mult(-pe))._round(),Dt=pe,Zt=nr,ee&&this.zoom>=17&&(ut(Et,Ht)||Et.push(Ht),ut(Et,ar)||Et.push(ar))}const zr=yt.vertexLength,ci=et.length>4&&T0(Ht,ar,Sr);let de=Zp(Dr,We,Nt);if(Od(this.layoutVertexArray,Ht.x,Ht.y,$r,Vr,0,0,de),Od(this.layoutVertexArray,Ht.x,Ht.y,$r,Vr,0,1,de),this.wallMode){const pe=he(ur-1,et),Ke=le.joinNormals[ur-1];jl(this.wallVertexArray,Ke,pe),jl(this.wallVertexArray,Ke,pe)}if(Dr+=er,de=Zp(Dr,ci,!Nt),We=ci,Od(this.layoutVertexArray,ar.x,ar.y,$r,Vr,0,0,de),Od(this.layoutVertexArray,ar.x,ar.y,$r,Vr,0,1,de),this.wallMode){const pe=he(ur,et),Ke=le.joinNormals[ur];jl(this.wallVertexArray,Ke,pe),jl(this.wallVertexArray,Ke,pe)}if(yt.vertexLength+=4,this.indexArray.emplaceBack(zr+0,zr+1,zr+2),this.indexArray.emplaceBack(zr+1,zr+3,zr+2),yt.primitiveLength+=2,Le){const pe=St+(ur===1?et.length-2:ur-2),Ke=ur===1?St:pe+1;if(this.indexArray.emplaceBack(zr+1,pe,zr+3),this.indexArray.emplaceBack(pe,Ke,zr+3),yt.primitiveLength+=2,dr===void 0&&(dr=zr),!Xp(Sr,et[ur],dt)){const ct=ur===et.length-1?dr:yt.vertexLength;this.indexArray.emplaceBack(zr+2,zr+3,ct),this.indexArray.emplaceBack(zr+3,ct+1,ct),this.indexArray.emplaceBack(zr+3,Ke,ct+1),yt.primitiveLength+=3}Nt=!Nt}if(j){const pe=this.layoutVertexExtArray,Ke=F.projectTilePoint(Ht.x,Ht.y,_),ct=F.projectTilePoint(ar.x,ar.y,_),Gt=F.upVector(_,Ht.x,Ht.y),jt=F.upVector(_,ar.x,ar.y);Gl(pe,Ke,Gt),Gl(pe,Ke,Gt),Gl(pe,ct,jt),Gl(pe,ct,jt)}}G&&(St+=et.length-1),ee&&Le&&this.zoom>=17&&(Et.length!==0&&ut(Et,Et[0])&&Et.pop(),this.groundEffect.addData(Et,dt,P,Le>0))}this.footprintSegments.push(lt),Rt.triangleCount=this.indexArray.length-Rt.triangleArrayOffset,this.polygonSegments.push(Rt),++J.footprintSegLen,++J.polygonSegLen}if(J.vertexCount=this.layoutVertexArray.length-J.vertexArrayOffset,J.groundVertexCount=this.groundEffect.vertexArray.length-J.groundVertexArrayOffset,J.vertexCount!==0){if(J.centroidXY=Q.borders?d_:this.encodeCentroid(Q,J),this.centroidData.push(J),Q.borders){this.featuresOnBorder.push(Q);const Ue=this.featuresOnBorder.length-1;for(let dt=0;dt<Q.borders.length;dt++)Q.borders[dt][0]!==Number.MAX_VALUE&&this.borderFeatureIndices[dt].push(Ue)}this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,a,d,v,S,_,R,void 0,this.worldview),this.groundEffect.addPaintPropertiesData(a,d,v,S,_,R,this.worldview),this.maxHeight=Math.max(this.maxHeight,se)}}sortBorders(){for(let t=0;t<this.borderFeatureIndices.length;t++)this.borderFeatureIndices[t].sort(((a,u)=>this.featuresOnBorder[a].borders[t][0]-this.featuresOnBorder[u].borders[t][0]))}splitToSubtiles(){const t=[];for(let S=0;S<this.centroidData.length;S++){const E=this.centroidData[S],R=+(E.min.y+E.max.y>Bt),P=2*R+(+(E.min.x+E.max.x>Bt)^R);for(let B=0;B<E.polygonSegLen;B++){const F=E.polygonSegIdx+B;t.push({centroidIdx:S,subtile:P,polygonSegmentIdx:F,triangleSegmentIdx:this.polygonSegments[F].triangleSegIdx})}}const a=new Cn;t.sort(((S,E)=>S.triangleSegmentIdx===E.triangleSegmentIdx?S.subtile-E.subtile:S.triangleSegmentIdx-E.triangleSegmentIdx));let u=0,d=0,_=0;for(const S of t){if(S.triangleSegmentIdx!==u)break;_++}const v=t.length;for(;d!==t.length;){u=t[d].triangleSegmentIdx;let S=0,E=d,R=d;for(let P=E;P<_&&t[P].subtile===S;P++)R++;for(;E!==_;){const P=t[E];S=P.subtile;const B=this.centroidData[P.centroidIdx].min.clone(),F=this.centroidData[P.centroidIdx].max.clone(),j={vertexOffset:this.segments.segments[u].vertexOffset,primitiveOffset:a.length,vertexLength:this.segments.segments[u].vertexLength,primitiveLength:0,sortKey:void 0,vaos:{}};for(let G=E;G<R;G++){const Q=t[G],J=this.polygonSegments[Q.polygonSegmentIdx],ee=this.centroidData[Q.centroidIdx].min,se=this.centroidData[Q.centroidIdx].max,le=this.indexArray.uint16;for(let he=J.triangleArrayOffset;he<J.triangleArrayOffset+J.triangleCount;he++)a.emplaceBack(le[3*he],le[3*he+1],le[3*he+2]);j.primitiveLength+=J.triangleCount,B.x=Math.min(B.x,ee.x),B.y=Math.min(B.y,ee.y),F.x=Math.max(F.x,se.x),F.y=Math.max(F.y,se.y)}j.primitiveLength>0&&this.triangleSubSegments.push({segment:j,min:B,max:F}),E=R;for(let G=E;G<_&&t[G].subtile===t[E].subtile;G++)R++}d=_;for(let P=d;P<v&&t[P].triangleSegmentIdx===t[d].triangleSegmentIdx;P++)_++}a._trim(),this.indexArray=a}getVisibleSegments(t,a,u){const d=new hn;if(this.wallMode){for(const Q of this.triangleSubSegments)d.segments.push(Q.segment);return d}let _=0,v=0;const S=1<<t.canonical.z;if(a){const Q=a.getMinMaxForTile(t);Q&&(_=Q.min,v=Q.max)}v+=this.maxHeight;const E=t.toUnwrapped();let R;const P=[E.canonical.x/S+E.wrap,E.canonical.y/S],B=[(E.canonical.x+1)/S+E.wrap,(E.canonical.y+1)/S],F=(Q,J,ee)=>[Q[0]*(1-ee[0])+J[0]*ee[0],Q[1]*(1-ee[1])+J[1]*ee[1]],j=[],G=[];for(const Q of this.triangleSubSegments){j[0]=Q.min.x/Bt,j[1]=Q.min.y/Bt,G[0]=Q.max.x/Bt,G[1]=Q.max.y/Bt;const J=F(P,B,j),ee=F(P,B,G);if(new br([J[0],J[1],_],[ee[0],ee[1],v]).intersectsPrecise(u)===0){R&&(d.segments.push(R),R=void 0);continue}const se=Q.segment;R&&R.vertexOffset!==se.vertexOffset&&(d.segments.push(R),R=void 0),R?(R.vertexLength+=se.vertexLength,R.primitiveLength+=se.primitiveLength):R={vertexOffset:se.vertexOffset,primitiveLength:se.primitiveLength,vertexLength:se.vertexLength,primitiveOffset:se.primitiveOffset,sortKey:void 0,vaos:{}}}return R&&d.segments.push(R),d}encodeCentroid(t,a){const u=t.centroid(),d=a.span(),_=Math.min(7,Math.round(d.x*this.tileToMeter/10)),v=Math.min(7,Math.round(d.y*this.tileToMeter/10));return new Tt(Ie(u.x,1,Bt-1)<<3|_,Ie(u.y,1,Bt-1)<<3|v)}encodeBorderCentroid(t){if(!t.borders)return new Tt(0,0);const a=t.borders,u=Number.MAX_VALUE;if(a[0][0]!==u||a[1][0]!==u){const d=a[0][0]!==u?0:1;return new Tt(6|(a[0][0]!==u?0:65528),(a[d][0]+a[d][1])/2<<3|6)}{const d=a[2][0]!==u?2:3;return new Tt((a[d][0]+a[d][1])/2<<3|6,6|(a[2][0]!==u?0:65528))}}showCentroid(t){const a=this.centroidData[t.centroidDataIndex];a.flags&=2147483647,a.centroidXY.x=0,a.centroidXY.y=0,this.writeCentroidToBuffer(a)}writeCentroidToBuffer(t){this.groundEffect.updateHiddenByLandmark(t);const a=t.vertexArrayOffset,u=t.vertexCount+t.vertexArrayOffset,d=t.flags&mh?d_:t.centroidXY,_=this.centroidVertexArray.geta_centroid_pos0(a);if(this.centroidVertexArray.geta_centroid_pos1(a)!==d.y||_!==d.x){for(let v=a;v<u;++v)this.centroidVertexArray.emplace(v,d.x,d.y);this.needsCentroidUpdate=!0}}createCentroidsBuffer(){this.centroidVertexArray.resize(this.layoutVertexArray.length),this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const t of this.centroidData)this.writeCentroidToBuffer(t)}updateReplacement(t,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(t.toUnwrapped());if(vf(this.activeReplacements,d))return;if(this.activeReplacements=d,this.centroidVertexArray.length===0)this.createCentroidsBuffer();else for(const v of this.centroidData)v.flags&=2147483647;const _=[];for(const v of this.activeReplacements){if(v.order<u)continue;const S=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-t.canonical.z));if(v.footprint.buildingId){const E=v.footprint.buildingId;for(const R of this.centroidData)R.buildingId===E&&(R.flags|=mh)}else for(const E of this.centroidData)if(!(E.flags&mh||v.min.x>E.max.x||E.min.x>v.max.x||v.min.y>E.max.y||E.min.y>v.max.y))for(let R=0;R<E.footprintSegLen;R++){const P=this.footprintSegments[E.footprintSegIdx+R];if(_.length=0,d1(this.footprintVertices,P.vertexOffset,P.vertexCount,v.footprintTileId.canonical,t.canonical,_),u_(v.footprint,_,this.footprintIndices.uint16,P.indexOffset,P.indexCount,-P.vertexOffset,-S)){E.flags|=mh;break}}}for(const v of this.centroidData)this.writeCentroidToBuffer(v);this.borderDoneWithNeighborZ=[-1,-1,-1,-1]}footprintContainsPoint(t,a,u){let d=!1;for(let _=0;_<u.footprintSegLen;_++){const v=this.footprintSegments[u.footprintSegIdx+_];let S=0;for(const E of v.ringIndices){for(let R=S,P=E+S-1;R<E+S;P=R++){const B=this.footprintVertices.int16[2*(R+v.vertexOffset)+0],F=this.footprintVertices.int16[2*(R+v.vertexOffset)+1],j=this.footprintVertices.int16[2*(P+v.vertexOffset)+1];F>a!=j>a&&t<(this.footprintVertices.int16[2*(P+v.vertexOffset)+0]-B)*(a-F)/(j-F)+B&&(d=!d)}S=E}}return d}getHeightAtTileCoord(t,a){let u=Number.NEGATIVE_INFINITY,d=!0;const _=4*(t+Bt)*Bt+(a+Bt);if(this.partLookup.hasOwnProperty(_)){const v=this.partLookup[_];return v?{height:v.height,hidden:!!(v.flags&mh)}:void 0}for(const v of this.centroidData)t>v.max.x||v.min.x>t||a>v.max.y||v.min.y>a||v.height<=u||this.footprintContainsPoint(t,a,v)&&(u=v.height,this.partLookup[_]=v,d=!!(v.flags&mh));if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.partLookup[_]=void 0}}function rg(s,t){const a=s.add(t)._unit();return s.x*a.x+s.y*a.y}function h1(s,t,a,u){const d=t.sub(s)._perp()._unit(),_=a.sub(t)._perp()._unit();return f1(s,t,a,rg(d,_),u)}function f1(s,t,a,u,d){const _=Math.sqrt(1-u*u);return Math.min(s.dist(t)/3,t.dist(a)/3,d*_/u)}function Xp(s,t,a){return s.x<a[0].x&&t.x<a[0].x||s.x>a[1].x&&t.x>a[1].x||s.y<a[0].y&&t.y<a[0].y||s.y>a[1].y&&t.y>a[1].y}function ig(s,t){return s.x<t[0].x||s.x>t[1].x||s.y<t[0].y||s.y>t[1].y}function T0(s,t,a){if(s.x<0||s.x>=Bt||t.x<0||t.x>=Bt||a.x<0||a.x>=Bt)return!1;const u=a.sub(t),d=u.perp(),_=s.sub(t);return(u.x*_.x+u.y*_.y)/Math.sqrt((u.x*u.x+u.y*u.y)*(_.x*_.x+_.y*_.y))>-.866&&d.x*_.x+d.y*_.y<0}function Zp(s,t,a){const u=t?2|s:-3&s;return a?1|u:-2&u}function p_(){const s=Math.PI/32,t=Math.tan(s),a=X;return a*Math.sqrt(1+2*t*t)-a}function ng(s,t,a){const u=1<<a.z,d=Te(a.x/u),_=Te((a.x+1)/u),v=ye(a.y/u),S=ye((a.y+1)/u);return(function(E,R,P,B,F=0,j){const G=[];if(!E.length||!P||!B)return G;const Q=(Ce,De)=>{for(const Le of Ce)G.push({polygon:Le,bounds:De})},J=Math.ceil(Math.log2(P)),ee=Math.ceil(Math.log2(B)),se=J-ee,le=[];for(let Ce=0;Ce<Math.abs(se);Ce++)le.push(se>0?0:1);for(let Ce=0;Ce<Math.min(J,ee);Ce++)le.push(0),le.push(1);let he=E;if(he=n_(he,R[0].y-F,R[1].y+F,1),he=n_(he,R[0].x-F,R[1].x+F,0),!he.length)return G;const Ee=[];for(le.length?Ee.push({polygons:he,bounds:R,depth:0}):Q(he,R);Ee.length;){const Ce=Ee.pop(),De=Ce.depth,Le=le[De],Fe=Ce.bounds[0],ut=Ce.bounds[1],Ue=Le===0?Fe.x:Fe.y,dt=Le===0?ut.x:ut.y,St=j?j(Le,Ue,dt):.5*(Ue+dt),gt=n_(Ce.polygons,Ue-F,St+F,Le),yt=n_(Ce.polygons,St-F,dt+F,Le);if(gt.length){const Rt=[Fe,new Tt(Le===0?St:ut.x,Le===1?St:ut.y)];le.length>De+1?Ee.push({polygons:gt,bounds:Rt,depth:De+1}):Q(gt,Rt)}if(yt.length){const Rt=[new Tt(Le===0?St:Fe.x,Le===1?St:Fe.y),ut];le.length>De+1?Ee.push({polygons:yt,bounds:Rt,depth:De+1}):Q(yt,Rt)}}return G})(s,t,Math.ceil((_-d)/11.25),Math.ceil((v-S)/11.25),1,((E,R,P)=>{if(E===0)return .5*(R+P);{const B=ye((a.y+R/Bt)/u);return(xe(.5*(ye((a.y+P/Bt)/u)+B))*u-a.y)*Bt}}))}function d1(s,t,a,u,d,_){const v=Math.pow(2,u.z-d.z);for(let S=0;S<a;S++){let E=s.int16[2*(S+t)+0],R=s.int16[2*(S+t)+1];E=(E+d.x*Bt)*v-u.x*Bt,R=(R+d.y*Bt)*v-u.y*Bt,_.push(new Tt(E,R))}}let p1,og;$t(tg,"FillExtrusionBucket",{omit:["layers","features"]}),$t($p,"PartData"),$t(qp,"FootprintSegment"),$t(gh,"BorderCentroidData"),$t(S0,"GroundEffect");class f extends Tt{constructor(t,a,u){super(t,a),this.z=u}}class y extends f{constructor(t,a,u,d){super(t,a,u),this.w=d}}function T(s,t,a,u){const d=a==="x"?"y":"x",_=(u-s[a])/(t[a]-s[a]);s[d]=Math.round(s[d]+(t[d]-s[d])*_),s[a]=u,s.hasOwnProperty("z")&&(s.z=xr(s.z,t.z,_)),s.hasOwnProperty("w")&&(s.w=xr(s.w,t.w,_))}function M(s,t,a,u){const d=a,_=u;for(const v of["x","y"]){let S=s,E=t;S[v]>=E[v]&&(S=t,E=s),S[v]<d&&E[v]>d&&T(S,E,v,d),S[v]<_&&E[v]>_&&T(E,S,v,_)}}function N(s,t,a,u,d,_){const v=[];for(let S=0;S<s.length;S++){const E=s[S];let R;const P=v.length;let B=0;for(let F=0;F<E.length-1;F++){let j=E[F],G=E[F+1],Q=0;const J=B;let ee,se;_&&(Q=Math.hypot(G.x-j.x,G.y-j.y),B+=Q,ee=j,se=G),j.x<t&&G.x<t||(j.x<t?j=new Tt(t,j.y+(t-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x<t&&(G=new Tt(t,j.y+(t-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y<a&&G.y<a||(j.y<a?j=new Tt(j.x+(a-j.y)/(G.y-j.y)*(G.x-j.x),a)._round():G.y<a&&(G=new Tt(j.x+(a-j.y)/(G.y-j.y)*(G.x-j.x),a)._round()),j.x>=u&&G.x>=u||(j.x>=u?j=new Tt(u,j.y+(u-j.x)/(G.x-j.x)*(G.y-j.y))._round():G.x>=u&&(G=new Tt(u,j.y+(u-j.x)/(G.x-j.x)*(G.y-j.y))._round()),j.y>=d&&G.y>=d||(j.y>=d?j=new Tt(j.x+(d-j.y)/(G.y-j.y)*(G.x-j.x),d)._round():G.y>=d&&(G=new Tt(j.x+(d-j.y)/(G.y-j.y)*(G.x-j.x),d)._round()),R&&j.equals(R[R.length-1])||(R=[j],v.push(R),_&&_.push({progress:{min:J+ce(ee,se,j)*Q,max:1},parentIndex:S,prevPoint:ee,nextPoint:se})),R.push(G),_&&(_[_.length-1].progress.max=J+ce(ee,se,G)*Q,_[_.length-1].nextPoint=se)))))}if(_&&B>0)for(let F=P;F<v.length;F++)_[F].progress.min/=B,_[F].progress.max/=B}return v}function $(s,t,a,u,d){if(s.length<2)return void u.push(s);const _=[];for(;t.valid();){const[R,P]=t.get();for(let B=0;B<s.length-1;B++){const F=s[B],j=s[B+1],G=bn(F,j,R,P);if(G){const[Q]=G,J=new Tt(xr(F.x,j.x,Q),xr(F.y,j.y,Q));_.push({t:B+Q,distance:0,point:J})}}t.next()}if(_.length===0)return void u.push(s);_.sort(((R,P)=>R.t-P.t));let v=0,S=0,E=[];for(u.push(E);v!==s.length;){if(S===_.length){for(;v!==s.length;)E.length!==0&&E[E.length-1].equals(s[v])||E.push(s[v]),v++;break}_[S].t<=v?(E.length!==0&&E[E.length-1].equals(_[S].point)||E.push(_[S].point),Math.trunc(_[S].t),S++):(E.length!==0&&E[E.length-1].equals(s[v])||E.push(s[v]),v++)}}function ce(s,t,a){return s.x!==t.x?(a.x-s.x)/(t.x-s.x):s.y!==t.y?(a.y-s.y)/(t.y-s.y):0}function Ae(s,t){return s.x*t.x+s.y*t.y}function Ye(s,t){if(s.length===1){let a=0;const u=t[a++];let d;for(;!d||u.equals(d);)if(d=t[a++],!d)return 1/0;for(;a<t.length;a++){const _=t[a],v=s[0],S=d.sub(u),E=_.sub(u),R=v.sub(u),P=Ae(S,S),B=Ae(S,E),F=Ae(E,E),j=Ae(R,S),G=Ae(R,E),Q=P*F-B*B,J=(F*j-B*G)/Q,ee=(P*G-B*j)/Q,se=u.z*(1-J-ee)+d.z*J+_.z*ee;if(isFinite(se))return se}return 1/0}{let a=1/0;for(const u of t)a=Math.min(a,u.z);return a}}function Mt(s,t,a,u,d,_,v,S){const E=v*d.getElevationAt(s,t,!0,!0),R=_[0]!==0,P=R?_[1]===0?v*(_[0]/7-450):v*(function(B,F,j){const G=Math.floor(F[0]/8),Q=Math.floor(F[1]/8),J=10*(F[0]-8*G),ee=10*(F[1]-8*Q),se=B.getElevationAt(G,Q,!0,!0),le=B.getMeterToDEM(j),he=Math.floor(.5*(J*le-1)),Ee=Math.floor(.5*(ee*le-1)),Ce=B.tileCoordToPixel(G,Q),De=2*he+1,Le=2*Ee+1,Fe=(function(yt,Rt,lt,vt,et){return[yt.getElevationAtPixel(Rt,lt,!0),yt.getElevationAtPixel(Rt+et,lt,!0),yt.getElevationAtPixel(Rt,lt+et,!0),yt.getElevationAtPixel(Rt+vt,lt+et,!0)]})(B,Ce.x-he,Ce.y-Ee,De,Le),ut=Math.abs(Fe[0]-Fe[1]),Ue=Math.abs(Fe[2]-Fe[3]),dt=Math.abs(Fe[0]-Fe[2])+Math.abs(Fe[1]-Fe[3]),St=Math.min(.25,.5*le*(ut+Ue)/De),gt=Math.min(.25,.5*le*dt/Le);return se+Math.max(St*J,gt*ee)})(d,_,S):E;return{base:E+(a===0?-1:a),top:R?Math.max(P+u,E+a+2):E+u}}class Wt{constructor(t){this._callback=t,this._triggered=!1,typeof MessageChannel<"u"&&(this._channel=new MessageChannel,this._channel.port2.onmessage=()=>{this._triggered=!1,this._callback()})}trigger(){this._triggered||(this._triggered=!0,this._channel?this._channel.port1.postMessage(!0):setTimeout((()=>{this._triggered=!1,this._callback()}),0))}remove(){this._channel=void 0,this._callback=()=>{}}}class ir{constructor(){this.tasks={},this.taskQueue=[],yr(["process"],this),this.invoker=new Wt(this.process),this.nextId=0}add(t,a){const u=this.nextId++,d=(function({type:_,isSymbolTile:v,zoom:S}){return S=S||0,_==="message"?0:_!=="maybePrepare"||v?_!=="parseTile"||v?_==="parseTile"&&v?300-S:_==="maybePrepare"&&v?400-S:500:200-S:100-S})(a);if(d===0){try{t()}finally{}return null}return this.tasks[u]={fn:t,metadata:a,priority:d,id:u},this.taskQueue.push(u),this.invoker.trigger(),{cancel:()=>{delete this.tasks[u]}}}process(){try{if(this.taskQueue=this.taskQueue.filter((u=>!!this.tasks[u])),!this.taskQueue.length)return;const t=this.pick();if(t===null)return;const a=this.tasks[t];if(delete this.tasks[t],this.taskQueue.length&&this.invoker.trigger(),!a)return;a.fn()}finally{}}pick(){let t=null,a=1/0;for(let d=0;d<this.taskQueue.length;d++){const _=this.tasks[this.taskQueue[d]];_.priority<a&&(a=_.priority,t=d)}if(t===null)return null;const u=this.taskQueue[t];return this.taskQueue.splice(t,1),u}remove(){this.invoker.remove()}}class zt{constructor(t,a,u){this.target=t,this.parent=a,this.mapId=u,this.callbacks={},this.cancelCallbacks={},yr(["receive"],this),this.target.addEventListener("message",this.receive,!1),this.scheduler=new ir}send(t,a,u,d,_=!1,v){const S=Math.round(1e18*Math.random()).toString(36).substring(0,10);u&&(u.metadata=v,this.callbacks[S]=u);const E=new Set;return this.target.postMessage({id:S,type:t,hasCallback:!!u,targetMapId:d,mustQueue:_,sourceMapId:this.mapId,data:Ml(a,E)},E),{cancel:()=>{u&&delete this.callbacks[S],this.target.postMessage({id:S,type:"<cancel>",targetMapId:d,sourceMapId:this.mapId})}}}receive(t){const a=t.data;if(!a)return;const u=a.id;if(u&&(!a.targetMapId||this.mapId===a.targetMapId))if(a.type==="<cancel>"){const d=this.cancelCallbacks[u];delete this.cancelCallbacks[u],d&&d.cancel()}else if(a.mustQueue||Li(self)){const d=this.callbacks[u],_=this.scheduler.add((()=>this.processTask(u,a)),d&&d.metadata||{type:"message"});_&&(this.cancelCallbacks[u]=_)}else this.processTask(u,a)}processTask(t,a){if(delete this.cancelCallbacks[t],a.type==="<response>"){const u=this.callbacks[t];delete this.callbacks[t],u&&(a.error?u(Ms(a.error)):u(null,Ms(a.data)))}else{const u=new Set,d=a.hasCallback?(v,S)=>{this.target.postMessage({id:t,type:"<response>",sourceMapId:this.mapId,error:v?Ml(v):null,data:Ml(S,u)},u)}:()=>{},_=Ms(a.data);if(this.parent[a.type])this.parent[a.type](a.sourceMapId,_,d);else if(this.parent.getWorkerSource){const v=a.type.split("."),{source:S,scope:E}=_;this.parent.getWorkerSource(a.sourceMapId,v[0],S,E)[v[1]](_,d)}else d(new Error(`Could not find function ${a.type}`))}}remove(){this.scheduler.remove(),this.target.removeEventListener("message",this.receive,!1)}}var kt={workerUrl:"",workerClass:null,workerParams:void 0};const xi="mapboxgl_preloaded_worker_pool";class ni{constructor(){this.active={}}acquire(t,a=ni.workerCount){if(!this.workers)for(this.workers=[];this.workers.length<a;)this.workers.push(kt.workerClass!=null?new kt.workerClass:new self.Worker(kt.workerUrl,kt.workerParams));return this.active[t]=!0,this.workers.slice()}release(t){delete this.active[t],this.workers&&this.numActive()===0&&(this.workers.forEach((a=>{a.terminate()})),this.workers=null)}isPreloaded(){return!!this.active[xi]}numActive(){return Object.keys(this.active).length}}ni.workerCount=2;class wn{constructor(t,a,u="Worker",d=ni.workerCount){this.workerPool=t,this.actors=[],this.currentActor=0,this.id=_t();const _=this.workerPool.acquire(this.id,d);for(let v=0;v<_.length;v++){const S=new wn.Actor(_[v],a,this.id);S.name=`${u} ${v}`,this.actors.push(S)}this.ready=!1,this.broadcast("checkIfReady",null,(()=>{this.ready=!0}))}broadcast(t,a,u){Je(this.actors,((d,_)=>{d.send(t,a,_)}),u=u||function(){})}getActor(){return this.currentActor=(this.currentActor+1)%this.actors.length,this.actors[this.currentActor]}remove(){this.actors.forEach((t=>{t.remove()})),this.actors=[],this.workerPool.release(this.id)}}let mt,st;function bt(){return mt||(mt=new ni),mt}wn.Actor=zt;class Jt{constructor(t){this.module=t}createIntArray(t){const a=new Int32Array(t),u=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heap32.set(a,u/a.BYTES_PER_ELEMENT),u}createFloatArray(t){const a=new Float32Array(t),u=this.module.malloc(a.length*a.BYTES_PER_ELEMENT);return this.module.heapF32.set(a,u/a.BYTES_PER_ELEMENT),u}createStringBuffer(t){const a=this.module.malloc(t.length+1);for(let u=0;u<t.length;++u)this.module.heapU8[a+u]=t.charCodeAt(u);return this.module.heapU8[a+t.length]=0,a}readStringBuffer(t){let a="";for(;this.module.heapU8[t]!==0;)a+=String.fromCharCode(this.module.heapU8[t]),++t;return a}setStyle(t){const a=t.entranceColorRgb,u=t.facadeGlazingColorRgb,d=t.roofColorRgb,_=t.wallColorRgb,v=t.normalScale;this.module.setStyle(a[0],a[1],a[2],u[0],u[1],u[2],d[0],d[1],d[2],_[0],_[1],_[2],v[0],v[1],v[2],t.tileToMeters)}setAOOptions(t,a){this.module.setAOOptions(t?1:0,a)}setMetricOptions(t,a){this.module.setMetricOptions(t?1:0,a)}setStructuralOptions(t){this.module.setStructuralOptions(t?1:0)}setFacadeOptions(t,a){this.module.setFacadeOptions(t,a?1:0)}setFauxFacadeOptions(t,a,u){this.module.setFauxFacadeOptions(t?1:0,a?1:0,u)}setFacadeClassifierOptions(t){this.module.setFacadeClassifierOptions(t)}generateMesh(t,a){for(const S of t){const E=this.createStringBuffer(S.roofType),R=[0],P=[];for(const j of S.coordinates)if(Array.isArray(j)){for(const G of j)P.push(G.x),P.push(G.y);R.push(P.length)}const B=this.createIntArray(R),F=this.createFloatArray(P);this.module.addFeature(S.id,S.sourceId,S.minHeight,S.height,E,S.roofType.length,F,B,R.length-1),this.module.free(E),this.module.free(B),this.module.free(F)}for(const S of a){let E;E=S.entrances?JSON.parse(S.entrances):[];const R=this.createFloatArray(E),P=[];for(const F of S.coordinates)P.push(F.x),P.push(F.y);const B=this.createFloatArray(P);this.module.addFacade(S.sourceId,S.crossPerc,S.distanceToRoad,R,E.length,B,P.length),this.module.free(R),this.module.free(B)}if(!this.module.generateMesh()){const S=this.module.getLastError();return this.readStringBuffer(S)}const u=this.module.getMeshCount(),d=new Array(u);for(let S=0;S<u;S++){const E=this.module.getPositionsPtr(S),R=this.module.getPositionsLength(S),P=new Float32Array(this.module.heapF32.buffer,E,R),B=this.module.getNormalsPtr(S),F=this.module.getNormalsLength(S),j=new Float32Array(this.module.heapF32.buffer,B,F),G=this.module.getColorsPtr(S),Q=this.module.getColorsLength(S),J=new Uint8Array(this.module.heapU8.buffer,G,Q),ee=this.module.getAOPtr(S),se=this.module.getAOLength(S),le=new Float32Array(this.module.heapF32.buffer,ee,se),he=this.module.getUVPtr(S),Ee=this.module.getUVLength(S),Ce=new Float32Array(this.module.heapF32.buffer,he,Ee),De=this.module.getFauxFacadePtr(S),Le=this.module.getFauxFacadeLength(S),Fe=new Uint8Array(this.module.heapU8.buffer,De,Le),ut=this.module.getIndicesPtr(S),Ue=this.module.getIndicesLength(S),dt=new Int32Array(this.module.heap32.buffer,ut,Ue),St=this.module.getBuildingPart(S),gt=this.readStringBuffer(St);d[S]={positions:P,normals:j,colors:J,ao:le,uv:Ce,isFauxFacade:Fe,indices:dt,buildingPart:gt}}const _=this.module.getRingCount(),v=[];for(let S=0;S<_;S++){const E=this.module.getRingPtr(S),R=this.module.getRingLength(S),P=new Float32Array(this.module.heapF32.buffer,E,R);v.push(P)}return{meshes:d,outerRingLength:this.module.getOuterRingLength(),modifiedPolygonRings:v}}}let Ur,Zi,Gr,si,qo,on=null,cl=null,m1=null,g1=null;function k2(){return Li(self)&&self.worker.dracoUrl?self.worker.dracoUrl:Zi||Vo.DRACO_URL}function N2(){if(Li(self)&&self.worker.meshoptUrl)return self.worker.meshoptUrl;if(si)return si;const s=new Uint8Array([0,97,115,109,1,0,0,0,1,4,1,96,0,0,3,3,2,0,0,5,3,1,0,1,12,1,0,10,22,2,12,0,65,0,65,0,65,0,252,10,0,0,11,7,0,65,0,253,15,26,11]);if(typeof WebAssembly!="object")throw new Error("WebAssembly not supported, cannot instantiate meshoptimizer");return si=WebAssembly.validate(s)?Vo.MESHOPT_SIMD_URL:Vo.MESHOPT_URL,si}function ZR(){return g1}const _1={5120:Int8Array,5121:Uint8Array,5122:Int16Array,5123:Uint16Array,5125:Uint32Array,5126:Float32Array},WR={5120:"DT_INT8",5121:"DT_UINT8",5122:"DT_INT16",5123:"DT_UINT16",5125:"DT_UINT32",5126:"DT_FLOAT32"},A0={SCALAR:1,VEC2:2,VEC3:3,VEC4:4,MAT2:4,MAT3:9,MAT4:16};function V2(s,t,a){const u=a.json.bufferViews.length,d=a.buffers.length;t.bufferView=u,a.json.bufferViews[u]={buffer:d,byteLength:s.byteLength},a.buffers[d]=s}const sx="KHR_draco_mesh_compression";function YR(s,t){const a=s.extensions&&s.extensions[sx];if(!a)return;const u=new Gr.Decoder,d=H2(t,a.bufferView),_=new Gr.Mesh;if(!u.DecodeArrayToMesh(d,d.byteLength,_))throw new Error("Failed to decode Draco mesh");const v=t.json.accessors[s.indices],S=_1[v.componentType],E=v.count*S.BYTES_PER_ELEMENT,R=Gr._malloc(E);S===Uint16Array?u.GetTrianglesUInt16Array(_,E,R):u.GetTrianglesUInt32Array(_,E,R),V2(Gr.memory.buffer.slice(R,R+E),v,t),Gr._free(R);for(const P of Object.keys(a.attributes)){const B=u.GetAttributeByUniqueId(_,a.attributes[P]),F=t.json.accessors[s.attributes[P]],j=WR[F.componentType],G=F.count*A0[F.type]*_1[F.componentType].BYTES_PER_ELEMENT,Q=Gr._malloc(G);u.GetAttributeDataArrayForAllPoints(_,B,Gr[j],G,Q),V2(Gr.memory.buffer.slice(Q,Q+G),F,t),Gr._free(Q)}u.destroy(),_.destroy(),delete s.extensions[sx]}const y1="EXT_meshopt_compression";function QR(s,t){if(!s.extensions||!s.extensions[y1])return;const a=s.extensions[y1],u=new Uint8Array(t.buffers[a.buffer],a.byteOffset||0,a.byteLength||0),d=new Uint8Array(a.count*a.byteStride);qo.decodeGltfBuffer(d,a.count,a.byteStride,u,a.mode,a.filter),s.buffer=t.buffers.length,s.byteOffset=0,t.buffers[s.buffer]=d.buffer,delete s.extensions[y1]}const U2=1179937895,j2=new TextDecoder("utf8");function G2(s,t){return new URL(s,t).href}function KR(s,t,a,u){return fetch(G2(s.uri,u)).then((d=>d.arrayBuffer())).then((d=>{t.buffers[a]=d}))}function H2(s,t){const a=s.json.bufferViews[t];return new Uint8Array(s.buffers[a.buffer],a.byteOffset||0,a.byteLength)}function JR(s,t,a,u){if(s.uri){const d=G2(s.uri,u);return fetch(d).then((_=>_.blob())).then((_=>createImageBitmap(_))).then((_=>{t.images[a]=_}))}if(s.bufferView!==void 0){const d=H2(t,s.bufferView),_=new Blob([d],{type:s.mimeType});return createImageBitmap(_).then((v=>{t.images[a]=v}))}}function q2(s,t=0,a){const u={json:null,images:[],buffers:[]};if(new Uint32Array(s,t,1)[0]===U2){const P=new Uint32Array(s,t);let B=2;const F=(P[B++]>>2)-3,j=P[B++]>>2;if(B++,u.json=JSON.parse(j2.decode(P.subarray(B,B+j))),B+=j,B<F){const G=P[B++];B++;const Q=t+(B<<2);u.buffers[0]=s.slice(Q,Q+G)}}else u.json=JSON.parse(j2.decode(new Uint8Array(s,t)));const{buffers:d,images:_,meshes:v,extensionsUsed:S,bufferViews:E}=u.json;let R=Promise.resolve();if(d){const P=[];for(let B=0;B<d.length;B++){const F=d[B];F.uri?P.push(KR(F,u,B,a)):u.buffers[B]||(u.buffers[B]=null)}R=Promise.all(P)}return R.then((()=>{const P=[],B=S&&S.includes(sx),F=S&&S.includes(y1);if(B&&P.push((function(){if(!Gr)return Ur??(Ur=(function(j){let G,Q=null;function J(){G=new Uint8Array(Q.buffer)}function ee(){throw new Error("Unexpected Draco error.")}const se={a:{a:ee,d:function(le,he,Ee){return G.copyWithin(le,he,he+Ee)},c:function(le){const he=G.length,Ee=Math.max(le>>>0,Math.ceil(1.2*he)),Ce=Math.ceil((Ee-he)/65536);try{return Q.grow(Ce),J(),!0}catch{return!1}},b:ee}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(j,se):j.then((le=>le.arrayBuffer())).then((le=>WebAssembly.instantiate(le,se)))).then((le=>{const{Rb:he,Qb:Ee,P:Ce,T:De,X:Le,Ja:Fe,La:ut,Qa:Ue,Va:dt,Wa:St,eb:gt,jb:yt,f:Rt,e:lt,yb:vt,zb:et,Ab:We,Bb:Dt,Db:Et,Gb:dr}=le.instance.exports;Q=lt;const Zt=(()=>{let nr=0,Nt=0,ur=0,Dr=0;return Ht=>{ur&&(he(Dr),he(nr),Nt+=ur,ur=nr=0),nr||(Nt+=128,nr=Ee(Nt));const ar=Ht.length+7&-8;let Sr=nr;ar>=Nt&&(ur=ar,Sr=Dr=Ee(ar));for(let Br=0;Br<Ht.length;Br++)G[Sr+Br]=Ht[Br];return Sr}})();return J(),Rt(),{memory:lt,_free:he,_malloc:Ee,Mesh:class{constructor(){this.ptr=Ce()}destroy(){De(this.ptr)}},Decoder:class{constructor(){this.ptr=Fe()}destroy(){yt(this.ptr)}DecodeArrayToMesh(nr,Nt,ur){const Dr=Zt(nr),Ht=ut(this.ptr,Dr,Nt,ur.ptr);return!!Le(Ht)}GetAttributeByUniqueId(nr,Nt){return{ptr:Ue(this.ptr,nr.ptr,Nt)}}GetTrianglesUInt16Array(nr,Nt,ur){dt(this.ptr,nr.ptr,Nt,ur)}GetTrianglesUInt32Array(nr,Nt,ur){St(this.ptr,nr.ptr,Nt,ur)}GetAttributeDataArrayForAllPoints(nr,Nt,ur,Dr,Ht){gt(this.ptr,nr.ptr,Nt.ptr,ur,Dr,Ht)}},DT_INT8:vt(),DT_UINT8:et(),DT_INT16:We(),DT_UINT16:Dt(),DT_UINT32:Et(),DT_FLOAT32:dr()}}))})(fetch(k2())),Ur.then((j=>{Gr=j,Ur=void 0})))})()),F&&P.push((function(){if(qo)return;const j=(function(G){let Q;const J=WebAssembly.instantiateStreaming(G,{}).then((le=>{Q=le.instance,Q.exports.__wasm_call_ctors()})),ee={NONE:"",OCTAHEDRAL:"meshopt_decodeFilterOct",QUATERNION:"meshopt_decodeFilterQuat",EXPONENTIAL:"meshopt_decodeFilterExp"},se={ATTRIBUTES:"meshopt_decodeVertexBuffer",TRIANGLES:"meshopt_decodeIndexBuffer",INDICES:"meshopt_decodeIndexSequence"};return{ready:J,supported:!0,decodeGltfBuffer(le,he,Ee,Ce,De,Le){(function(Fe,ut,Ue,dt,St,gt,yt){const Rt=Fe.exports.sbrk,lt=dt+3&-4,vt=Rt(lt*St),et=Rt(gt.length),We=new Uint8Array(Fe.exports.memory.buffer);We.set(gt,et);const Dt=ut(vt,dt,St,et,gt.length);if(Dt===0&&yt&&yt(vt,lt,St),Ue.set(We.subarray(vt,vt+dt*St)),Rt(vt-Rt(0)),Dt!==0)throw new Error(`Malformed buffer data: ${Dt}`)})(Q,Q.exports[se[De]],le,he,Ee,Ce,Q.exports[ee[Le]])}}})(fetch(N2()));return j.ready.then((()=>{qo=j}))})()),_)for(let j=0;j<_.length;j++)P.push(JR(_[j],u,j,a));return(P.length?Promise.all(P):Promise.resolve()).then((()=>{if(B&&v)for(const{primitives:j}of v)for(const G of j)YR(G,u);if(F&&v&&E)for(const j of E)QR(j,u);return u}))}))}function lx(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.RGBA;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.DEPTH_COMPONENT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.DEPTH_STENCIL;case WebGL2RenderingContext.R8:case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.RED}}function cx(s){switch(s){case WebGL2RenderingContext.RGBA8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.DEPTH_COMPONENT16:return WebGL2RenderingContext.UNSIGNED_SHORT;case WebGL2RenderingContext.DEPTH24_STENCIL8:return WebGL2RenderingContext.UNSIGNED_INT_24_8;case WebGL2RenderingContext.R8:return WebGL2RenderingContext.UNSIGNED_BYTE;case WebGL2RenderingContext.R32F:return WebGL2RenderingContext.FLOAT}}class ux{constructor(t,a,u,d){this.context=t,this.format=u,this.useMipmap=d&&d.useMipmap,this.texture=t.gl.createTexture(),this.update(a,{premultiply:d&&d.premultiply})}update(t,a){const u=t&&t instanceof HTMLVideoElement&&t.width===0?t.videoWidth:t.width,d=t&&t instanceof HTMLVideoElement&&t.height===0?t.videoHeight:t.height,{context:_}=this,{gl:v}=_,{x:S,y:E}=a&&a.position?a.position:{x:0,y:0},R=S+u,P=E+d;!this.size||this.size[0]===R&&this.size[1]===P||(v.bindTexture(v.TEXTURE_2D,null),v.deleteTexture(this.texture),this.texture=v.createTexture(),this.size=null),v.bindTexture(v.TEXTURE_2D,this.texture),_.pixelStoreUnpackFlipY.set(!1),_.pixelStoreUnpack.set(1),_.pixelStoreUnpackPremultiplyAlpha.set(this.format===v.RGBA8&&(!a||a.premultiply!==!1));const B=t instanceof HTMLImageElement||t instanceof HTMLCanvasElement||t instanceof HTMLVideoElement||t instanceof ImageData||ImageBitmap&&t instanceof ImageBitmap;if(!this.size&&R>0&&P>0){const F=this.useMipmap?Math.floor(Math.log2(Math.max(R,P)))+1:1;v.texStorage2D(v.TEXTURE_2D,F,this.format,R,P),this.size=[R,P]}this.size&&(B?v.texSubImage2D(v.TEXTURE_2D,0,S,E,lx(this.format),cx(this.format),t):"data"in t&&t.data&&v.texSubImage2D(v.TEXTURE_2D,0,S,E,u,d,lx(this.format),cx(this.format),t.data)),this.useMipmap&&v.generateMipmap(v.TEXTURE_2D)}bind(t,a,u=!1){const{context:d}=this,{gl:_}=d;_.bindTexture(_.TEXTURE_2D,this.texture),t!==this.minFilter&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MAG_FILTER,t),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_MIN_FILTER,this.useMipmap&&!u?t===_.NEAREST?_.NEAREST_MIPMAP_NEAREST:_.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),a!==this.wrapS&&(_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_S,a),_.texParameteri(_.TEXTURE_2D,_.TEXTURE_WRAP_T,a),this.wrapS=a)}bindExtraParam(t,a,u,d,_){const{context:v}=this,{gl:S}=v;S.bindTexture(S.TEXTURE_2D,this.texture),a!==this.magFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MAG_FILTER,a),this.magFilter=a),t!==this.minFilter&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_MIN_FILTER,this.useMipmap?t===S.NEAREST?S.NEAREST_MIPMAP_NEAREST:S.LINEAR_MIPMAP_LINEAR:t),this.minFilter=t),u!==this.wrapS&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_S,u),this.wrapS=u),d!==this.wrapT&&(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_WRAP_T,d),this.wrapT=d),_!==this.compareMode&&(_?(S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.COMPARE_REF_TO_TEXTURE),S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_FUNC,_)):S.texParameteri(S.TEXTURE_2D,S.TEXTURE_COMPARE_MODE,S.NONE),this.compareMode=_)}destroy(){const{gl:t}=this.context;t.deleteTexture(this.texture),this.texture=null}}class E0{constructor(t,a){this.context=t,this.texture=a}bind(t,a){const{context:u}=this,{gl:d}=u;d.bindTexture(d.TEXTURE_2D,this.texture),t!==this.minFilter&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MAG_FILTER,t),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_MIN_FILTER,t),this.minFilter=t),a!==this.wrapS&&(d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_S,a),d.texParameteri(d.TEXTURE_2D,d.TEXTURE_WRAP_T,a),this.wrapS=a)}}const eM=ei([{name:"a_pos_3f",components:3,type:"Float32"}]),tM=ei([{name:"a_color_3f",components:3,type:"Float32"}]),rM=ei([{name:"a_color_4f",components:4,type:"Float32"}]),iM=ei([{name:"a_uv_2f",components:2,type:"Float32"}]),nM=ei([{name:"a_normal_3f",components:3,type:"Float32"}]),oM=ei([{name:"a_normal_matrix0",components:4,type:"Float32"},{name:"a_normal_matrix1",components:4,type:"Float32"},{name:"a_normal_matrix2",components:4,type:"Float32"},{name:"a_normal_matrix3",components:4,type:"Float32"}]),aM=ei([{name:"a_pbr",components:4,type:"Uint16"},{name:"a_heightBasedEmissiveStrength",components:3,type:"Float32"}]);function $2(s,t){const a=v1(s.projection,s.zoom,s.width,s.height),u=(function(_,v,S,E,R){const P=new W(S.lng-180*Wp,S.lat),B=new W(S.lng+180*Wp,S.lat),F=_.project(P.lng,P.lat),j=_.project(B.lng,B.lat),G=-Math.atan2(j.y-F.y,j.x-F.x),Q=tt.fromLngLat(S);Q.y=Ie(Q.y,-1+Wp,1-Wp);const J=Q.toLngLat(),ee=_.project(J.lng,J.lat),se=tt.fromLngLat(J);se.x+=Wp;const le=se.toLngLat(),he=_.project(le.lng,le.lat),Ee=Z2(he.x-ee.x,he.y-ee.y,G),Ce=tt.fromLngLat(J);Ce.y+=Wp;const De=Ce.toLngLat(),Le=_.project(De.lng,De.lat),Fe=Z2(Le.x-ee.x,Le.y-ee.y,G),ut=Math.abs(Ee.x)/Math.abs(Fe.y),Ue=ne([]);xt(Ue,Ue,-G*(1-(R?0:E)));const dt=ne([]);return Pe(dt,dt,[1,1-(1-ut)*E,1]),dt[4]=-Fe.x/Fe.y*E,xt(dt,dt,G),ve(dt,Ue,dt),dt})(s.projection,0,s.center,a,t),d=X2(s);return Pe(u,u,[d,d,1]),u}function X2(s){const t=s.projection,a=v1(s.projection,s.zoom,s.width,s.height),u=hx(t,s.center),d=hx(t,W.convert(t.center));return Math.pow(2,u*a+(1-a)*d)}function v1(s,t,a,u,d=1/0){const _=s.range;if(!_)return 0;const v=Math.min(d,Math.max(a,u)),S=Math.log2(v/1024);return Qe(_[0]+S,_[1]+S,t)}const Wp=1/4e4;function hx(s,t){const a=Ie(t.lat,-Se,Se),u=new W(t.lng-180*Wp,a),d=new W(t.lng+180*Wp,a),_=s.project(u.lng,a),v=s.project(d.lng,a),S=tt.fromLngLat(u),E=tt.fromLngLat(d),R=v.x-_.x,P=v.y-_.y,B=E.x-S.x,F=E.y-S.y,j=Math.sqrt((B*B+F*F)/(R*R+P*P));return Math.log2(j)}function Z2(s,t,a){const u=Math.cos(a),d=Math.sin(a);return{x:s*u-t*d,y:s*d+t*u}}function W2(s,t,a){ne(s),xt(s,s,Ne(t[2])),Ze(s,s,Ne(t[0])),$e(s,s,Ne(t[1])),Pe(s,s,a),ve(s,s,[1,0,0,0,0,0,1,0,0,1,0,0,0,0,0,1])}function x1(s,t,a,u,d,_,v,S){const E=[a[0]-t[0],a[1]-t[1],0],R=[u[0]-t[0],u[1]-t[1],0];if(ui(E)<1e-12||ui(R)<1e-12)return _l(s);const P=vi([],E,R);Cr(P,P),sr(R,u,t),E[2]=(_-d)*S,R[2]=(v-d)*S;const B=E;return vi(B,E,R),Cr(B,B),Ah(s,P,B)}function fx(s,t,a=!1){const u=Tu(t.zoom),d=(function(_,v,S){const E=v.worldSize,R=[_[12],_[13],_[14]],P=ye(R[1]/E),B=Te(R[0]/E),F=ne([]),j=ge(1,P)*E,G=ge(1,0)*E*ze(P,v.zoom),Q=1/Zg(E);let J=G*Q;if(S){const he=v1(v.projection,v.zoom,v.width,v.height,1024);J=Q*v.projection.pixelSpaceConversion(v.center.lat,E,he)}const ee=V(P,B);Ot(ee,ee,Vt([],Cr([],ee),j*J*R[2]));const se=(function(he){const Ee=[he[0],he[1],he[2]];let Ce=[0,1,0];const De=vi([],Ce,Ee);return vi(Ce,Ee,De),oi(Ce)===0&&(Ce=[0,1,0],vi(De,Ee,Ce)),Cr(De,De),Cr(Ce,Ce),Cr(Ee,Ee),[De[0],De[1],De[2],0,Ce[0],Ce[1],Ce[2],0,Ee[0],Ee[1],Ee[2],0,he[0],he[1],he[2],1]})(ee);Pe(F,F,[J,J,J*j]),we(F,F,[-R[0],-R[1],-R[2]]);const le=ve([],v.globeMatrix,se);return ve(le,le,F),ve(le,le,_),le})(s,t,a);if(u>0){const _=(function(v,S){const E=S.worldSize,R=ge(1,0)*E*ze(S.center.lat,S.zoom)/Zg(E),P=ge(1,S.center.lat)*E,B=ne([]);$e(B,B,Ne(S.center.lng)),Ze(B,B,Ne(S.center.lat)),we(B,B,[0,0,p]),Pe(B,B,[R,R,R*P]);const F=S.point;return we(B,B,[-F.x,-F.y,0]),ve(B,B,v),ve(B,S.globeMatrix,B)})(s,t);return(function(v,S,E){const R=(G,Q,J)=>{const ee=ui(G),se=ui(Q),le=Bs(G,Q,J);return Vt(le,le,1/ui(le)*xr(ee,se,J))},P=R([v[0],v[1],v[2]],[S[0],S[1],S[2]],E),B=R([v[4],v[5],v[6]],[S[4],S[5],S[6]],E),F=R([v[8],v[9],v[10]],[S[8],S[9],S[10]],E),j=Bs([v[12],v[13],v[14]],[S[12],S[13],S[14]],E);return[P[0],P[1],P[2],0,B[0],B[1],B[2],0,F[0],F[1],F[2],0,j[0],j[1],j[2],1]})(d,_,u)}return d}function Y2(s,t,a,u){const d=br.projectAabbCorners(u,a);let _=Number.MAX_VALUE,v=-1;for(let R=0;R<d.length;++R){const P=d[R];P[0]=(.5*P[0]+.5)*t.width,P[1]=(.5-.5*P[1])*t.height,P[2]<_&&(v=R,_=P[2])}const S=R=>new Tt(d[R][0],d[R][1]);let E;switch(v){case 0:case 6:E=[S(1),S(5),S(4),S(7),S(3),S(2),S(1)];break;case 1:case 7:E=[S(0),S(4),S(5),S(6),S(2),S(3),S(0)];break;case 3:case 5:E=[S(1),S(0),S(4),S(7),S(6),S(2),S(1)];break;default:E=[S(1),S(5),S(6),S(7),S(3),S(0),S(1)]}if($a(s,E))return _}const ag=64,m_={CoordinateSpaceTile:1,HasMapboxMeshFeatures:4,HasMeshoptCompression:8};function Q2(s,t,a,u,d,_,v,S,E,R=!1){const P=a.zoom,B=a.project(u),F=ze(u.lat,P),j=1/F;ne(s),we(s,s,[B.x+v[0]*j,B.y+v[1]*j,v[2]]);let G=1,Q=1;const J=a.worldSize;if(R){if(a.projection.name==="mercator"){let he=0;a.elevation&&(he=a.elevation.getAtPointOrZero(new tt(B.x/J,B.y/J),0));const Ee=Wo([],[B.x,B.y,he,1],a.projMatrix)[3]/a.cameraToCenterDistance;G=Ee,Q=Ee*ze(a.center.lat,P)}else if(a.projection.name==="globe"){const he=fx(s,a),Ee=[0,0,0,1];Wo(Ee,Ee,ve([],a.projMatrix,he));const Ce=Ee[3]/a.cameraToCenterDistance,De=Tu(P),Le=a.projection.pixelsPerMeter(u.lat,J)*ze(u.lat,P),Fe=a.projection.pixelsPerMeter(a.center.lat,J)*ze(a.center.lat,P);G=Ce/xr(Le,He(a.center.lat),De),Q=Ce*F/Le,G*=Fe,Q*=Fe}}else G=j;Pe(s,s,[G,G,Q]);const ee=[...s],se=t.orientation,le=[];if(W2(le,[se[0]+d[0],se[1]+d[1],se[2]+d[2]],_),ve(s,ee,le),S&&a.elevation){let he=0;const Ee=[];if(E&&a.elevation){he=(function(De,Le,Fe,ut,Ue){const dt=Le.elevation;if(!dt)return 0;const St=br.projectAabbCorners(Fe,ut),gt=ge(1,Ue.lat)*Le.worldSize,yt=(function(Nt,ur){const Dr=[0,0,1],Ht=[{corners:[0,1,3,2],dotProductWithUp:0},{corners:[1,5,2,6],dotProductWithUp:0},{corners:[0,4,1,5],dotProductWithUp:0},{corners:[2,6,3,7],dotProductWithUp:0},{corners:[4,7,5,6],dotProductWithUp:0},{corners:[0,3,4,7],dotProductWithUp:0}];for(const ar of Ht){const Sr=Nt[ar.corners[0]],Br=Nt[ar.corners[1]],$r=Nt[ar.corners[2]],Vr=[Br[0]-Sr[0],Br[1]-Sr[1],ur*(Br[2]-Sr[2])],er=vi(Vr,Vr,[$r[0]-Sr[0],$r[1]-Sr[1],ur*($r[2]-Sr[2])]);Cr(er,er),ar.dotProductWithUp=Vi(er,Dr)}return Ht.sort(((ar,Sr)=>ar.dotProductWithUp-Sr.dotProductWithUp)),Ht[0].corners})(St,gt),Rt=St[yt[0]],lt=St[yt[1]],vt=St[yt[2]],et=St[yt[3]],We=dt.getAtPointOrZero(new tt(Rt[0]/Le.worldSize,Rt[1]/Le.worldSize),0),Dt=dt.getAtPointOrZero(new tt(lt[0]/Le.worldSize,lt[1]/Le.worldSize),0),Et=dt.getAtPointOrZero(new tt(vt[0]/Le.worldSize,vt[1]/Le.worldSize),0),dr=dt.getAtPointOrZero(new tt(et[0]/Le.worldSize,et[1]/Le.worldSize),0),Zt=(We+dr)/2,nr=(Dt+Et)/2;return Zt>nr?Dt<Et?x1(De,lt,et,Rt,Dt,dr,We,gt):x1(De,vt,Rt,et,Et,We,dr,gt):We<dr?x1(De,Rt,lt,vt,We,Dt,Et,gt):x1(De,et,vt,lt,dr,Et,Dt,gt),Math.max(Zt,nr)})(Ee,a,t.aabb,s,u);const Ce=ve([],Yt([],Ee),le);ve(s,ee,Ce)}else he=a.elevation.getAtPointOrZero(new tt(B.x/J,B.y/J),0);he!==0&&(s[14]+=he)}}function C0(s,t,a=!1){s.uploaded||(s.gfxTexture=new ux(t,s.image,a?t.gl.R8:t.gl.RGBA8,{useMipmap:s.sampler.minFilter>=t.gl.NEAREST_MIPMAP_NEAREST}),s.uploaded=!0,s.image=null)}function sM(s,t,a){s.indexBuffer=t.createIndexBuffer(s.indexArray,!1,!0),s.vertexBuffer=t.createVertexBuffer(s.vertexArray,eM.members,!1,!0),s.normalArray&&(s.normalBuffer=t.createVertexBuffer(s.normalArray,nM.members,!1,!0)),s.texcoordArray&&(s.texcoordBuffer=t.createVertexBuffer(s.texcoordArray,iM.members,!1,!0)),s.colorArray&&(s.colorBuffer=t.createVertexBuffer(s.colorArray,(s.colorArray.bytesPerElement===12?tM:rM).members,!1,!0)),s.featureArray&&(s.pbrBuffer=t.createVertexBuffer(s.featureArray,aM.members,!0)),s.segments=hn.simpleSegment(0,0,s.vertexArray.length,s.indexArray.length);const u=s.material;u.pbrMetallicRoughness.baseColorTexture&&C0(u.pbrMetallicRoughness.baseColorTexture,t),u.pbrMetallicRoughness.metallicRoughnessTexture&&C0(u.pbrMetallicRoughness.metallicRoughnessTexture,t),u.normalTexture&&C0(u.normalTexture,t),u.occlusionTexture&&C0(u.occlusionTexture,t,a),u.emissionTexture&&C0(u.emissionTexture,t)}function dx(s,t,a){if(s.meshes)for(const u of s.meshes)sM(u,t,a);if(s.children)for(const u of s.children)dx(u,t,a)}function b1(s){if(s.meshes)for(const t of s.meshes)t.indexArray.destroy(),t.vertexArray.destroy(),t.colorArray&&t.colorArray.destroy(),t.normalArray&&t.normalArray.destroy(),t.texcoordArray&&t.texcoordArray.destroy(),t.featureArray&&t.featureArray.destroy();if(s.children)for(const t of s.children)b1(t)}function px(s){if(s.meshes)for(const a of s.meshes)a.vertexBuffer&&(a.vertexBuffer.destroy(),a.indexBuffer.destroy(),a.normalBuffer&&a.normalBuffer.destroy(),a.texcoordBuffer&&a.texcoordBuffer.destroy(),a.colorBuffer&&a.colorBuffer.destroy(),a.pbrBuffer&&a.pbrBuffer.destroy(),a.segments.destroy(),a.material&&((t=a.material).pbrMetallicRoughness.baseColorTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture&&t.pbrMetallicRoughness.baseColorTexture.gfxTexture.destroy(),t.pbrMetallicRoughness.metallicRoughnessTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture&&t.pbrMetallicRoughness.metallicRoughnessTexture.gfxTexture.destroy(),t.normalTexture&&t.normalTexture.gfxTexture&&t.normalTexture.gfxTexture.destroy(),t.emissionTexture&&t.emissionTexture.gfxTexture&&t.emissionTexture.gfxTexture.destroy(),t.occlusionTexture&&t.occlusionTexture.gfxTexture&&t.occlusionTexture.gfxTexture.destroy()));var t;if(s.children)for(const a of s.children)px(a)}function sg(s,t){const a=s.json.bufferViews[t.bufferView],u=_1[t.componentType];return new u(s.buffers[a.buffer],(t.byteOffset||0)+(a.byteOffset||0),t.count*(a.byteStride&&a.byteStride!==A0[t.type]*u.BYTES_PER_ELEMENT?a.byteStride/u.BYTES_PER_ELEMENT:A0[t.type]))}function mx(s,t,a,u){const d=_1[t.componentType],_=(function(P){switch(P){case Int8Array:return 1/127;case Uint8Array:return 1/255;case Int16Array:return 1/32767;case Uint16Array:return 1/65535;default:return 1}})(d),v=s.json.bufferViews[t.bufferView],S=v.byteStride?v.byteStride/d.BYTES_PER_ELEMENT:A0[t.type],E=a.float32,R=E.length/a.capacity;for(let P=0,B=0;P<t.count*S;P+=S,B+=R)for(let F=0;F<R;F++)E[B+F]=u[P+F]*_;a._trim()}function lM(s,t,a){const u=s.indices,d=s.attributes,_={};_.indexArray=new Cn;const v=t.json.accessors[u],S=v.count/3;_.indexArray.reserve(S);const E=sg(t,v);for(let F=0;F<S;F++)_.indexArray.emplaceBack(E[3*F],E[3*F+1],E[3*F+2]);_.indexArray._trim(),_.vertexArray=new fa;const R=t.json.accessors[d.POSITION];_.vertexArray.reserve(R.count);const P=sg(t,R);for(let F=0;F<R.count;F++)_.vertexArray.emplaceBack(P[3*F],P[3*F+1],P[3*F+2]);if(_.vertexArray._trim(),_.aabb=new br(R.min,R.max),_.centroid=(function(F,j){const G=[0,0,0],Q=F.length;if(Q>0){for(let J=0;J<Q;J++){const ee=3*F[J];G[0]+=j[ee],G[1]+=j[ee+1],G[2]+=j[ee+2]}G[0]/=Q,G[1]/=Q,G[2]/=Q}return G})(E,P),d.COLOR_0!==void 0){const F=t.json.accessors[d.COLOR_0],j=A0[F.type],G=sg(t,F);_.colorArray=j===3?new fa:new Lo,_.colorArray.resize(F.count),mx(t,F,_.colorArray,G)}if(d.NORMAL!==void 0){_.normalArray=new fa;const F=t.json.accessors[d.NORMAL];_.normalArray.resize(F.count);const j=sg(t,F);mx(t,F,_.normalArray,j)}if(d.TEXCOORD_0!==void 0&&a.length>0){_.texcoordArray=new hh;const F=t.json.accessors[d.TEXCOORD_0];_.texcoordArray.resize(F.count);const j=sg(t,F);mx(t,F,_.texcoordArray,j)}if(d._FEATURE_ID_RGBA4444!==void 0){const F=t.json.accessors[d._FEATURE_ID_RGBA4444];t.json.extensionsUsed&&t.json.extensionsUsed.includes("EXT_meshopt_compression")&&(_.featureData=sg(t,F))}d._FEATURE_RGBA4444!==void 0&&(_.featureData=new Uint32Array(sg(t,t.json.accessors[d._FEATURE_RGBA4444]).buffer));const B=s.material;return _.material=(function(F,j){const{emissiveFactor:G=[0,0,0],alphaMode:Q="OPAQUE",alphaCutoff:J=.5,normalTexture:ee,occlusionTexture:se,emissiveTexture:le,doubleSided:he}=F,{baseColorFactor:Ee=[1,1,1,1],metallicFactor:Ce=1,roughnessFactor:De=1,baseColorTexture:Le,metallicRoughnessTexture:Fe}=F.pbrMetallicRoughness||{},ut=se?j[se.index]:void 0;if(se&&se.extensions&&se.extensions.KHR_texture_transform&&ut){const Ue=se.extensions.KHR_texture_transform;ut.offsetScale=[Ue.offset[0],Ue.offset[1],Ue.scale[0],Ue.scale[1]]}return{pbrMetallicRoughness:{baseColorFactor:new Ei(...Ee),metallicFactor:Ce,roughnessFactor:De,baseColorTexture:Le?j[Le.index]:void 0,metallicRoughnessTexture:Fe?j[Fe.index]:void 0},doubleSided:he,emissiveFactor:new Ei(...G),alphaMode:Q,alphaCutoff:J,normalTexture:ee?j[ee.index]:void 0,occlusionTexture:ut,emissionTexture:le?j[le.index]:void 0,defined:F.defined===void 0}})(B!==void 0?t.json.materials[B]:{defined:!1},a),_}function K2(s,t,a){const{matrix:u,rotation:d,translation:_,scale:v,mesh:S,extras:E,children:R}=s,P={};if(P.matrix=u||(function(B,F,j,G){var Q=F[0],J=F[1],ee=F[2],se=F[3],le=Q+Q,he=J+J,Ee=ee+ee,Ce=Q*le,De=Q*he,Le=Q*Ee,Fe=J*he,ut=J*Ee,Ue=ee*Ee,dt=se*le,St=se*he,gt=se*Ee,yt=G[0],Rt=G[1],lt=G[2];return B[0]=(1-(Fe+Ue))*yt,B[1]=(De+gt)*yt,B[2]=(Le-St)*yt,B[3]=0,B[4]=(De-gt)*Rt,B[5]=(1-(Ce+Ue))*Rt,B[6]=(ut+dt)*Rt,B[7]=0,B[8]=(Le+St)*lt,B[9]=(ut-dt)*lt,B[10]=(1-(Ce+Fe))*lt,B[11]=0,B[12]=j[0],B[13]=j[1],B[14]=j[2],B[15]=1,B})([],d||[0,0,0,1],_||[0,0,0],v||[1,1,1]),S!==void 0){P.meshes=a[S];const B=P.anchor=[0,0];for(const F of P.meshes){const{min:j,max:G}=F.aabb;B[0]+=j[0]+G[0],B[1]+=j[1]+G[1]}B[0]=Math.floor(B[0]/P.meshes.length/2),B[1]=Math.floor(B[1]/P.meshes.length/2)}if(E&&(E.id&&(P.id=E.id),E.lights&&(P.lights=(function(B){if(!B.length)return[];const F=(function(ee){const se=atob(ee),le=new Uint8Array(se.length);for(let he=0;he<se.length;he++)le[he]=se.codePointAt(he);return le})(B),j=[],G=F.length/24,Q=new Uint16Array(F.buffer),J=new Float32Array(F.buffer);for(let ee=0;ee<G;ee++){const se=Q[2*ee*6]/30,le=Q[2*ee*6+1]/30,he=Q[2*ee*6+10]/100,Ee=J[6*ee+1],Ce=J[6*ee+2],De=J[6*ee+3],Le=J[6*ee+4],Fe=De-Ee,ut=Le-Ce,Ue=Math.hypot(Fe,ut);j.push({pos:[Ee+.5*Fe,Ce+.5*ut,le],normal:[ut/Ue,-Fe/Ue,0],width:Ue,height:se,depth:he,points:[Ee,Ce,De,Le]})}return j})(E.lights))),R){const B=[];for(const F of R)B.push(K2(t.json.nodes[F],t,a));P.children=B}return P}function cM(s){if(s.vertices.length===0||s.indices.length===0)return null;const t=new Md(s.vertices,s.indices,8,256),[a,u]=[t.min.clone(),t.max.clone()];return{vertices:s.vertices,indices:s.indices,grid:t,min:a,max:u}}function uM(s){if(!s.extras||!s.extras.ground)return null;const t=s.extras.ground;if(!t||!Array.isArray(t)||t.length===0)return null;const a=t[0];if(!a||!Array.isArray(a)||a.length===0)return null;const u=[];for(const v of a){if(!Array.isArray(v)||v.length!==2)continue;const S=v[0],E=v[1];typeof S=="number"&&typeof E=="number"&&u.push(new Tt(S,E))}if(u.length<3)return null;u.length>1&&u[u.length-1].equals(u[0])&&u.pop();let d=0;for(let v=0;v<u.length;v++){const S=u[v],E=u[(v+1)%u.length],R=u[(v+2)%u.length];d+=(S.x-E.x)*(R.y-E.y)-(R.x-E.x)*(S.y-E.y)}d>0&&u.reverse();const _=Vp(u.flatMap((v=>[v.x,v.y])),[]);return _.length===0?null:{vertices:u,indices:_}}function hM(s,t){const a=[],u=[];let d=0;const _=[];for(const v of s){d=a.length;const S=v.vertexArray.float32,E=v.indexArray.uint16;for(let R=0;R<v.vertexArray.length;R++)_[0]=S[3*R+0],_[1]=S[3*R+1],_[2]=S[3*R+2],Tn(_,_,t),a.push(new Tt(_[0],_[1]));for(let R=0;R<3*v.indexArray.length;R++)u.push(E[R]+d)}if(u.length%3!=0)return null;for(let v=0;v<u.length;v+=3){const S=a[u[v+0]],E=a[u[v+1]],R=a[u[v+2]];(S.x-E.x)*(R.y-E.y)-(R.x-E.x)*(S.y-E.y)>0&&([u[v+1],u[v+2]]=[u[v+2],u[v+1]])}return{vertices:a,indices:u}}function J2(s){const t=(function(E,R){const P=[],B=WebGL2RenderingContext;if(E.json.textures)for(const F of E.json.textures){const j={magFilter:B.LINEAR,minFilter:B.NEAREST,wrapS:B.REPEAT,wrapT:B.REPEAT};F.sampler!==void 0&&Object.assign(j,E.json.samplers[F.sampler]),P.push({image:R[F.source],sampler:j,uploaded:!1})}return P})(s,s.images),a=(function(E,R){const P=[];for(const B of E.json.meshes){const F=[];for(const j of B.primitives)F.push(lM(j,E,R));P.push(F)}return P})(s,t),{scenes:u,scene:d,nodes:_}=s.json,v=u?u[d||0].nodes:[..._.keys()],S=[];for(const E of v)S.push(K2(_[E],s,a));return(function(E,R,P){const B={},F=new Set;for(let j=0;j<E.length;j++){const G=P[R[j]];if(!G.extras)continue;const Q=G.extras["mapbox:footprint:version"],J=G.extras["mapbox:footprint:id"];(Q||J)&&F.add(j),Q==="1.0.0"&&J&&(B[J]=j)}for(let j=0;j<E.length;j++){if(F.has(j))continue;const G=E[j],Q=P[R[j]];if(!Q.extras)continue;let J=null;G.id in B&&(J=hM(E[B[G.id]].meshes,G.matrix)),J||(J=uM(Q)),J&&(G.footprint=cM(J))}if(F.size>0){const j=Array.from(F.values()).sort(((G,Q)=>G-Q));for(let G=j.length-1;G>=0;G--)E.splice(j[G],1)}})(S,v,s.json.nodes),S}function fM(s){s.heightmap=new Float32Array(4096),s.heightmap.fill(-1);const t=s.vertexArray.float32,a=s.aabb.min[0]-1,u=s.aabb.min[1]-1,d=ag/(s.aabb.max[0]-a+2),_=ag/(s.aabb.max[1]-u+2);for(let v=0;v<t.length;v+=3){const S=t[v+2],E=(t[v+0]-a)*d|0,R=(t[v+1]-u)*_|0;S>s.heightmap[R*ag+E]&&(s.heightmap[R*ag+E]=S)}}function eS(s,t,a,u,d){a.reserve(a.length+4*s.length),u.reserve(u.length+10*s.length),d.reserve(d.length+10*s.length);let _=u.length;for(const v of s){const S=Math.min(10,Math.max(4,1.3*v.height))*t,E=[-v.normal[1],v.normal[0],0],R=Math.min(.29,.1*v.width/v.depth),P=v.width-2*v.depth*t*(R+.01),B=Er([],v.pos,E,P/2),F=Er([],v.pos,E,-P/2),j=[B[0],B[1],B[2]+v.height],G=[F[0],F[1],F[2]+v.height],Q=Er([],v.normal,E,R);Vt(Q,Q,S);const J=Er([],v.normal,E,-R);Vt(J,J,S),Ot(Q,B,Q),Ot(J,F,J),B[2]+=.1,F[2]+=.1,u.emplaceBack(Q[0],Q[1],Q[2]),u.emplaceBack(J[0],J[1],J[2]),u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(F[0],F[1],F[2]),u.emplaceBack(j[0],j[1],j[2]),u.emplaceBack(G[0],G[1],G[2]),u.emplaceBack(B[0],B[1],B[2]),u.emplaceBack(F[0],F[1],F[2]),u.emplaceBack(Q[0],Q[1],Q[2]),u.emplaceBack(J[0],J[1],J[2]);const ee=P/S/2;d.emplaceBack(-ee-R,-1,ee,.8),d.emplaceBack(ee+R,-1,ee,.8),d.emplaceBack(-ee,0,ee,1.3),d.emplaceBack(ee,0,ee,1.3),d.emplaceBack(ee+R,-.8,ee,.7),d.emplaceBack(ee+R,-.8,ee,.7),d.emplaceBack(0,0,ee,1.3),d.emplaceBack(0,0,ee,1.3),d.emplaceBack(ee+R,-1.2,ee,.8),d.emplaceBack(ee+R,-1.2,ee,.8),a.emplaceBack(6+_,4+_,8+_),a.emplaceBack(7+_,9+_,5+_),a.emplaceBack(0+_,1+_,2+_),a.emplaceBack(1+_,3+_,2+_),_+=10}}function dM(s,t){const a={};a.indexArray=new Cn,a.vertexArray=new fa,a.colorArray=new Lo,eS(s,t,a.indexArray,a.vertexArray,a.colorArray);const u={defined:!0};u.emissiveFactor=Ei.black;const d={};return d.baseColorFactor=Ei.white,u.pbrMetallicRoughness=d,a.material=u,a.aabb=new br([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),a}const tS=ei([{name:"a_pos_3f",components:3,type:"Float32"}]),pM=ei([{name:"a_normal_3",components:3,type:"Int16"}]),mM=ei([{name:"a_centroid_3",components:3,type:"Int16"}]),rS=ei([{name:"a_part_color_emissive",components:2,type:"Uint16"}]),gM=ei([{name:"a_faux_facade_color_emissive",components:2,type:"Uint16"}]),_M=ei([{name:"a_faux_facade_data",components:4,type:"Uint16"}]),yM=ei([{name:"a_faux_facade_vertical_range",components:2,type:"Uint16"}]),vM=ei([{name:"a_bloom_attenuation",components:4,type:"Float32"}]),iS=pt.types,gx=32767;function xM(s,t){const a=Bt+t;for(const u of s)for(const d of u)if(d.x<-t||d.x>a||d.y<-t||d.y>a)return!1;return!0}class nS{constructor(){this.layoutVertexArray=new fa,this.layoutAttenuationArray=new Lo,this.layoutColorArray=new Un,this.indexArray=new Cn,this.indexArrayForConflation=new Cn,this.segmentsBucket=new hn}}class _x{constructor(){this.layoutVertexArray=new fa,this.layoutNormalArray=new rl,this.layoutCentroidArray=new rl,this.layoutColorArray=new Un,this.layoutFacadePaintArray=null,this.layoutFacadeDataArray=null,this.layoutFacadeVerticalRangeArray=null,this.layoutAOArray=[],this.indexArray=new Cn,this.indexArrayForConflation=new Cn,this.segmentsBucket=new hn,this.entranceBloom=new nS}}class oS{constructor(t){this.colorBufferUploaded=!1,this.maxHeight=0,this.replacementUpdateTime=0,this.activeReplacements=[],this.footprints=[],this.featuresOnBorder=[],this.buildingFeatures=[],this.buildingWithoutFacade=new _x,this.buildingWithFacade=new _x,this.indexArrayForConflationUploaded=!1,this.footprintLookup={},this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.hasPattern=!1,this.worldview=t.worldview,this.lut=t.lut,this.buildingWithFacade.layoutFacadePaintArray=new Un,this.buildingWithFacade.layoutFacadeDataArray=new Ea,this.buildingWithFacade.layoutFacadeVerticalRangeArray=new Un,this.programConfigurations=new Bo(t.layers,{zoom:t.zoom,lut:t.lut}),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.projection=t.projection,this.groundEffect=new S0(t)}updateFootprints(t,a){for(const u of this.footprints)a.push({footprint:u,id:t})}prepare(){return(function(){if(g1!=null||m1!=null)return null;if(cl!=null)return cl;const t=fetch(Vo.BUILDING_GEN_URL);return cl=(function(a){let u,d,_,v;function S(){u=new Uint8Array(v.buffer),d=new Int32Array(v.buffer),_=new Float32Array(v.buffer)}function E(){throw new Error("Unexpected BuildingGen error.")}const R=()=>{},P={a:{a:E,f:function(B){const F=u.length,j=Math.max(B>>>0,Math.ceil(1.2*F)),G=Math.ceil((j-F)/65536);try{return v.grow(G),S(),!0}catch{return!1}},g:E,b:R,c:R,d:R,e:R}};return(WebAssembly.instantiateStreaming?WebAssembly.instantiateStreaming(a,P):a.then((B=>B.arrayBuffer())).then((B=>WebAssembly.instantiate(B,P)))).then((B=>{const F=B.instance.exports;return(0,F.g)(),v=F.f,S(),new Jt({setStyle:F.h,setAOOptions:F.i,setMetricOptions:F.j,setStructuralOptions:F.k,setFacadeOptions:F.l,setFauxFacadeOptions:F.m,setFacadeClassifierOptions:F.n,addFeature:F.o,addFacade:F.p,generateMesh:F.q,getLastError:F.r,getOuterRingLength:F.s,getMeshCount:F.t,getPositionsPtr:F.u,getPositionsLength:F.v,getNormalsPtr:F.w,getNormalsLength:F.x,getColorsPtr:F.y,getColorsLength:F.z,getAOPtr:F.A,getAOLength:F.B,getUVPtr:F.C,getUVLength:F.D,getFauxFacadePtr:F.E,getFauxFacadeLength:F.F,getIndicesPtr:F.G,getIndicesLength:F.H,getBuildingPart:F.I,getRingCount:F.J,getRingPtr:F.K,getRingLength:F.L,free:F.M,malloc:F.N,heapU8:u,heap32:d,heapF32:_})}))})(t).then((a=>(cl=null,g1=a,g1))).catch((a=>{ri("Could not load building-gen"),cl=null,m1=a})),cl})()}populate(t,a,u,d){const _=ZR();if(!_)return;const v=Ge(u);this.tileToMeter=v,this.brightness=a.brightness,_.setStyle({convertToMeters:!1,entranceColorRgb:[1,1,1],facadeGlazingColorRgb:[.5607843137254902,.6745098039215687,.7215686274509804],normalScale:[1,-1,v],ridgeHeight:3,roofColorRgb:[.886274516,.784313738,.713725507],tileToMeters:v,tileZoom:16,wallColorRgb:[.988235294,.933333337,.811764717]}),_.setAOOptions(!1,.3),_.setMetricOptions(!1,16),_.setStructuralOptions(!0),_.setFacadeClassifierOptions(3);const S=new Map;for(const{feature:E}of t){if(iS[E.type]!=="LineString")continue;const R=this.layers[0]._featureFilter.needGeometry,P=ft(E,R);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),P,u))continue;const B=R?P.geometry:wt(E,u,d),F=[];for(const J of B)for(const ee of J)F.push({x:ee.x,y:ee.y});const j={coordinates:F,crossPerc:E.properties.cross_perc,distanceToRoad:E.properties.distance_to_road,entrances:E.properties.entrances,sourceId:0},G=E.properties.source_id;let Q=S.get(G);Q||(Q=[],S.set(G,Q)),Q.push(j)}this.maxHeight=0;for(const{feature:E,index:R}of t){if(iS[E.type]==="LineString")continue;const P=this.layers[0]._featureFilter.needGeometry,B=ft(E,P);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom),B,u))continue;const F=P?B.geometry:wt(E,u,d),j=Za(F,500);if(!xM(F,163))continue;const G=this.layers[0],Q=G.layout.get("building-base").evaluate(E,{},u),J=G.layout.get("building-height").evaluate(E,{},u),ee=G.layout.get("building-roof-shape").evaluate(E,{},u),se=G.paint.get("building-ambient-occlusion-intensity"),le=G.paint.get("building-ambient-occlusion-ground-radius")/this.tileToMeter;if(ee==="flat")continue;const he=G.layout.get("building-facade").evaluate(E,{},u);_.setFacadeOptions(4,!0),_.setFauxFacadeOptions(he,!1,1);const Ee=E.properties.source_id;let Ce;Ce=S.has(Ee)?S.get(Ee):[];let De=0,Le=0,Fe=0,ut=0,Ue=0,dt=0;if(he){let er=Math.round(G.layout.get("building-facade-floors").evaluate(E,{},u));if(Q===0){er=Math.max(1,er-(Ce.length>0?1:0));let ci=4;if(J>100){const de=[10,13,15];ci=de[E.id?E.id%de.length:0],_.setFacadeOptions(ci,!0)}Ue=1.6803*ci/v}else Ue=Q/v;dt=J/v,Ue=Math.min(Ue,dt),Fe=G.layout.get("building-facade-unit-width").evaluate(E,{},u)/v,ut=(dt-Ue)/er,_.setFauxFacadeOptions(!0,!0,Fe);const zr=G.layout.get("building-facade-window").evaluate(E,{},u);De=zr[0],Le=zr[1]}const St=[],gt=new Tt(1/0,1/0),yt=new Tt(-1/0,-1/0),Rt=new Tt(0,0);let lt=0;for(const er of j)if(er.length>0){const zr=[];for(const ci of er){const de=[];for(let pe=ci.length-1;pe>=0;pe--){const Ke=ci[pe];de.push({x:Ke.x,y:Ke.y}),gt.x=Math.min(gt.x,Ke.x),gt.y=Math.min(gt.y,Ke.y),yt.x=Math.max(yt.x,Ke.x),yt.y=Math.max(yt.y,Ke.y),Rt.x+=Ke.x,Rt.y+=Ke.y,lt++}zr.push(de)}St.push({id:E.id?E.id:0,height:J,minHeight:Q,sourceId:0,roofType:ee,coordinates:zr})}Rt.x/=lt||1,Rt.y/=lt||1;const vt=_.generateMesh(St,Ce);if(typeof vt=="string"){ri(`Unable to generate building ${E.id}: ${vt}`);continue}if(vt.meshes.length===0||vt.modifiedPolygonRings.length===0)continue;let et=0;for(const er of vt.meshes)et+=er.positions.length/3;const We=he?this.buildingWithFacade:this.buildingWithoutFacade,Dt=We.segmentsBucket.prepareSegment(et,We.layoutVertexArray,We.indexArray),Et=[];let dr=null,Zt=0,nr=-1;const Nt=We.indexArray.length;let ur=0;for(const er of vt.meshes){const zr=We.layoutVertexArray.length;if(er.buildingPart==="entrance"){const ct=new Array;for(let mr=0;mr<er.indices.length;mr+=12){const Xr=er.positions[mr+0],Zr=er.positions[mr+1],Hr=er.positions[mr+3],Bi=er.positions[mr+4],mn=er.positions[mr+2],jr=er.positions[mr+8]-mn,Ji=1,ki=Hr-Xr,Ai=Bi-Zr,an=Math.hypot(ki,Ai);ct.push({pos:[Xr+.5*ki,Zr+.5*Ai,mn],normal:[Ai/an,-ki/an,0],width:an,height:jr,depth:Ji,points:[Xr,Zr,Hr,Bi]})}const Gt=We.entranceBloom.segmentsBucket.prepareSegment(10*ct.length,We.entranceBloom.layoutVertexArray,We.entranceBloom.indexArray),jt=We.entranceBloom.layoutVertexArray.length;Zt=We.entranceBloom.indexArray.length,eS(ct,.5/this.tileToMeter,We.entranceBloom.indexArray,We.entranceBloom.layoutVertexArray,We.entranceBloom.layoutAttenuationArray);const Kt=We.entranceBloom.layoutVertexArray.length-jt;nr=We.entranceBloom.indexArray.length-Zt;for(let mr=0;mr<Kt;mr++)We.entranceBloom.layoutColorArray.emplaceBack(65535,65535);Gt.vertexLength+=Kt,Gt.primitiveLength+=nr,dr={part:er.buildingPart,vertexOffset:jt,vertexLength:Kt}}for(let ct=0;ct<er.positions.length;ct+=3)ur=Math.max(ur,er.positions[ct+2]),We.layoutVertexArray.emplaceBack(er.positions[ct],er.positions[ct+1],er.positions[ct+2]);const ci=Math.floor(Rt.x),de=Math.floor(Rt.y),pe=Math.floor(ur);for(let ct=0;ct<er.positions.length;ct+=3)We.layoutCentroidArray.emplaceBack(ci,de,pe);for(let ct=0;ct<er.normals.length;ct+=3)We.layoutNormalArray.emplaceBack(er.normals[ct+0]*gx,er.normals[ct+1]*gx,er.normals[ct+2]*gx);for(let ct=0;ct<er.ao.length;ct++)We.layoutAOArray.push(er.ao[ct]);for(let ct=0;ct<er.colors.length;ct+=3){const Gt=1+(er.ao[ct/3]-1)*se;We.layoutColorArray.emplaceBack(er.colors[ct]*Gt<<8|er.colors[ct+1]*Gt,er.colors[ct+2]*Gt<<8)}if(he){for(let ct=0;ct<er.positions.length;ct+=3)We.layoutFacadePaintArray.emplaceBack(65535,255);for(let ct=0;ct<er.isFauxFacade.length;ct++)if(er.isFauxFacade[ct]){const Gt=1|Math.min(65535,Math.floor(er.uv[2*ct]*vt.outerRingLength)),jt=Math.floor(255*De)<<8|Math.floor(255*Le),Kt=Math.floor(65535*Math.min(1,Fe/Bt)),mr=Math.floor(65535*Math.min(1,ut/Bt));We.layoutFacadeDataArray.emplaceBack(Gt,jt,Kt,mr);const Xr=Math.floor(65535*Math.min(1,Ue/Bt)),Zr=Math.floor(65535*Math.min(1,dt/Bt));We.layoutFacadeVerticalRangeArray.emplaceBack(Xr,Zr)}else We.layoutFacadeDataArray.emplaceBack(0,0,0,0),We.layoutFacadeVerticalRangeArray.emplaceBack(0,0)}const Ke=Dt.vertexLength;for(let ct=0;ct<er.indices.length;ct+=3)We.indexArray.emplaceBack(Ke+er.indices[ct],Ke+er.indices[ct+1],Ke+er.indices[ct+2]);Dt.vertexLength+=er.positions.length/3,Dt.primitiveLength+=er.indices.length/3,(er.buildingPart==="roof"||er.buildingPart==="wall"||er.buildingPart==="facade_glazing"||er.buildingPart==="entrance")&&Et.push({part:er.buildingPart,vertexOffset:zr,vertexLength:er.positions.length/3})}this.maxHeight=Math.max(this.maxHeight,ur),this.buildingFeatures.push({feature:B,hasFauxFacade:he,segment:Dt,parts:Et,buildingBloom:dr});const Dr=We.indexArray.length-Nt,Ht=[],ar=[],Sr=new Tt(1/0,1/0),Br=new Tt(-1/0,-1/0),$r=this.groundEffect.vertexArray.length;for(const er of vt.modifiedPolygonRings){const zr=[],ci=new Tt(1/0,1/0),de=new Tt(-1/0,-1/0);for(let pe=0;pe<er.length;pe+=2){const Ke=er.length-pe-2;ci.x=Math.min(ci.x,er[Ke]),ci.y=Math.min(ci.y,er[Ke+1]),de.x=Math.max(de.x,er[Ke]),de.y=Math.max(de.y,er[Ke+1]);const ct=new Tt(er[Ke],er[Ke+1]);zr.push(ct),Ht.push(ct.x,ct.y),ar.push(ct.clone())}Sr.x=Math.min(Sr.x,ci.x),Sr.y=Math.min(Sr.y,ci.y),Br.x=Math.max(Br.x,de.x),Br.y=Math.max(Br.y,de.y),this.groundEffect.addData(zr,[ci,de],le)}const Vr=this.groundEffect.vertexArray.length-$r;(gt.x<0||yt.x>Bt||gt.y<0||yt.y>Bt)&&this.featuresOnBorder.push({featureId:E.id,footprintIndex:this.footprints.length});{const er=Vp(Ht,null,2),zr=new Md(ar,er,8,256);let ci=E.id;E.properties&&E.properties.hasOwnProperty("building_id")&&(ci=E.properties.building_id),this.footprints.push({vertices:ar,indices:er,grid:zr,min:Sr,max:Br,buildingId:ci,hiddenFlags:0,indicesOffset:Nt,indicesLength:Dr,bloomIndicesOffset:Zt,bloomIndicesLength:nr,groundEffectVertexOffset:$r,groundEffectVertexLength:Vr,hasFauxFacade:he,segment:Dt,height:ur})}this.programConfigurations.populatePaintArrays(We.layoutVertexArray.length,E,R,{},a.availableImages,u,a.brightness),this.groundEffect.addPaintPropertiesData(E,R,{},a.availableImages,u,a.brightness)}this.groundEffect.prepareBorderSegments(),this.evaluate(this.layers[0],{})}update(t,a,u,d,_,v,S){this.programConfigurations.updatePaintArrays(t,a,_,u,d,v,S),this.groundEffect.update(t,a,_,u,d,v,S),this.evaluate(this.layers[0],t),this.colorBufferUploaded=!1}isEmpty(){return this.buildingWithoutFacade.layoutVertexArray.length===0&&this.buildingWithFacade.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload||this.groundEffect.programConfigurations.needsUpload}upload(t){const a=u=>{u.layoutVertexBuffer=t.createVertexBuffer(u.layoutVertexArray,tS.members),u.layoutNormalBuffer=t.createVertexBuffer(u.layoutNormalArray,pM.members),u.layoutCentroidBuffer=t.createVertexBuffer(u.layoutCentroidArray,mM.members),u.layoutFacadeDataArray&&u.layoutFacadeDataArray.length&&(u.layoutFacadeDataBuffer=t.createVertexBuffer(u.layoutFacadeDataArray,_M.members)),u.layoutFacadeVerticalRangeArray&&u.layoutFacadeVerticalRangeArray.length&&(u.layoutFacadeVerticalRangeBuffer=t.createVertexBuffer(u.layoutFacadeVerticalRangeArray,yM.members)),u.entranceBloom.layoutVertexArray.length&&(u.entranceBloom.layoutVertexBuffer=t.createVertexBuffer(u.entranceBloom.layoutVertexArray,tS.members),u.entranceBloom.layoutAttenuationBuffer=t.createVertexBuffer(u.entranceBloom.layoutAttenuationArray,vM.members)),this.uploadUpdatedColorBuffer(t),this.uploadUpdatedIndexBuffer(t)};this.uploaded||(a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.groundEffect.upload(t)),this.groundEffect.uploadPaintProperties(t),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){const t=a=>{a.layoutVertexBuffer&&(a.layoutVertexBuffer.destroy(),a.layoutNormalBuffer.destroy(),a.layoutColorBuffer.destroy(),a.segmentsBucket.destroy(),a.indexBuffer&&a.indexBuffer.destroy(),a.entranceBloom.layoutVertexBuffer&&(a.entranceBloom.layoutVertexBuffer.destroy(),a.entranceBloom.layoutColorBuffer.destroy(),a.entranceBloom.layoutAttenuationBuffer.destroy(),a.entranceBloom.indexBuffer.destroy(),a.entranceBloom.segmentsBucket.destroy()))};t(this.buildingWithoutFacade),t(this.buildingWithFacade),this.groundEffect.destroy(),this.programConfigurations.destroy()}updateFootprintHiddenFlags(t,a,u=!0){let d=!1;const _=u?a:0,v=0|(u?-1:~a);this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const S of t){const E=this.footprints[S],R=E.hiddenFlags&v|_;E.hiddenFlags!==R&&(E.hiddenFlags=R,d=!0,this.groundEffect.updateHiddenByLandmarkRange(E.groundEffectVertexOffset,E.groundEffectVertexLength,E.hiddenFlags!==0))}return d&&(this.indexArrayForConflationUploaded=!1),d}uploadUpdatedIndexBuffer(t){if(this.groundEffect.uploadHiddenByLandmark(t),this.indexArrayForConflationUploaded)return;const a=d=>{d.indexArray.length!==0&&(d.indexArrayForConflation.resize(d.indexArray.length),d.indexArrayForConflation.uint16.set(d.indexArray.uint16),d.entranceBloom.indexArrayForConflation.resize(d.entranceBloom.indexArray.length),d.entranceBloom.indexArrayForConflation.uint16.set(d.entranceBloom.indexArray.uint16))};a(this.buildingWithoutFacade),a(this.buildingWithFacade);for(const d of this.footprints){const _=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade,v=d.indicesOffset+d.indicesLength;if(d.hiddenFlags!==0){for(let E=d.indicesOffset;E<v;E++)_.indexArrayForConflation.uint16[3*E+0]=0,_.indexArrayForConflation.uint16[3*E+1]=0,_.indexArrayForConflation.uint16[3*E+2]=0;const S=d.bloomIndicesOffset+d.bloomIndicesLength;for(let E=d.bloomIndicesOffset;E<S;E++)_.entranceBloom.indexArrayForConflation.uint16[3*E+0]=0,_.entranceBloom.indexArrayForConflation.uint16[3*E+1]=0,_.entranceBloom.indexArrayForConflation.uint16[3*E+2]=0}}const u=d=>{d.indexArray.length!==0&&(d.indexBuffer?d.indexBuffer.updateData(d.indexArrayForConflation):d.indexBuffer=t.createIndexBuffer(d.indexArrayForConflation,!0),d.entranceBloom.indexBuffer?d.entranceBloom.indexBuffer.updateData(d.entranceBloom.indexArrayForConflation):d.entranceBloom.indexBuffer=t.createIndexBuffer(d.entranceBloom.indexArrayForConflation,!0))};u(this.buildingWithoutFacade),u(this.buildingWithFacade),this.indexArrayForConflationUploaded=!0}uploadUpdatedColorBuffer(t){const a=u=>{u.layoutColorBuffer?u.layoutColorBuffer.updateData(u.layoutColorArray):u.layoutColorBuffer=t.createVertexBuffer(u.layoutColorArray,rS.members,!0),u.layoutFacadePaintArray&&(u.layoutFacadePaintBuffer?u.layoutFacadePaintBuffer.updateData(u.layoutFacadePaintArray):u.layoutFacadePaintBuffer=t.createVertexBuffer(u.layoutFacadePaintArray,gM.members,!0)),u.entranceBloom.layoutColorBuffer?u.entranceBloom.layoutColorBuffer.updateData(u.entranceBloom.layoutColorArray):u.entranceBloom.layoutColorBuffer=t.createVertexBuffer(u.entranceBloom.layoutColorArray,rS.members,!0)};a(this.buildingWithoutFacade),a(this.buildingWithFacade),this.colorBufferUploaded=!0}evaluate(t,a){const u=t.paint.get("building-ambient-occlusion-intensity");for(const d of this.buildingFeatures){const _=a[d.feature.id],v=d.feature;v.properties["building-part"]="roof";const S=t.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),E=t.paint.get("building-emissive-strength").evaluate(v,_,this.canonical);v.properties["building-part"]="wall";const R=t.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),P=t.paint.get("building-emissive-strength").evaluate(v,_,this.canonical);v.properties["building-part"]="window";const B=t.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),F=t.paint.get("building-emissive-strength").evaluate(v,_,this.canonical);v.properties["building-part"]="door";const j=t.paint.get("building-color").evaluate(v,_,this.canonical).toPremultipliedRenderColor(this.lut),G=t.paint.get("building-emissive-strength").evaluate(v,_,this.canonical),Q=d.hasFauxFacade?this.buildingWithFacade:this.buildingWithoutFacade;for(const ee of d.parts){let se,le=S;ee.part==="roof"?(le=S,se=E):ee.part==="wall"?(le=R,se=P):ee.part==="facade_glazing"?(le=B,se=F):ee.part==="entrance"&&(le=j,se=G),se=Ie(se,0,1);for(let he=0;he<ee.vertexLength;he++){const Ee=ee.vertexOffset+he,Ce=1+(Q.layoutAOArray[Ee]-1)*u;Q.layoutColorArray.emplace(Ee,le.r*Ce*255<<8|le.g*Ce*255,le.b*Ce*255<<8|255*se),d.hasFauxFacade&&Q.layoutFacadePaintArray.emplace(Ee,255*B.r<<8|255*B.g,255*B.b<<8|255*F)}}const J=d.buildingBloom;if(J)for(let ee=0;ee<J.vertexLength;ee++)Q.entranceBloom.layoutColorArray.emplace(J.vertexOffset+ee,255*j.r<<8|255*j.g,255*j.b<<8|51*G)}}needsEvaluation(){return!this.colorBufferUploaded}updateReplacement(t,a,u){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const d=a.getReplacementRegionsForTile(t.toUnwrapped());if(vf(this.activeReplacements,d))return;this.activeReplacements=d;for(const v of this.footprints)v.hiddenFlags&=-2;const _=[];for(const v of this.activeReplacements){if(v.order<=a1)continue;const S=Math.max(1,Math.pow(2,v.footprintTileId.canonical.z-t.canonical.z));for(const E of this.footprints)E.min.x>v.max.x||E.max.x<v.min.x||E.min.y>v.max.y||E.max.y<v.min.y||(_.length=0,bM(E.vertices,0,E.vertices.length,v.footprintTileId.canonical,t.canonical,_),u_(v.footprint,_,E.indices,0,E.indices.length,0,-S)&&(E.hiddenFlags|=1))}this.groundEffect.hiddenByLandmarkVertexArray.length===0&&this.groundEffect.hiddenByLandmarkVertexArray.resize(this.groundEffect.vertexArray.length);for(const v of this.footprints)this.groundEffect.updateHiddenByLandmarkRange(v.groundEffectVertexOffset,v.groundEffectVertexLength,v.hiddenFlags!==0);this.indexArrayForConflationUploaded=!1}getHeightAtTileCoord(t,a){let u=Number.NEGATIVE_INFINITY,d=!0;const _=4*(t+Bt)*Bt+(a+Bt);if(this.footprintLookup.hasOwnProperty(_)){const S=this.footprintLookup[_];return S?{height:S.height,hidden:S.hiddenFlags!==0}:void 0}const v=new Tt(t,a);for(const S of this.footprints)t>S.max.x||S.min.x>t||a>S.max.y||S.min.y>a||S.height<=u||Km(v,S)&&(u=S.height,this.footprintLookup[_]=S,d=S.hiddenFlags!==0);if(u!==Number.NEGATIVE_INFINITY)return{height:u,hidden:d};this.footprintLookup[_]=void 0}}function bM(s,t,a,u,d,_){const v=Math.pow(2,u.z-d.z);for(let S=0;S<a;S++){let E=s[S+t].x,R=s[S+t].y;E=(E+d.x*Bt)*v-u.x*Bt,R=(R+d.y*Bt)*v-u.y*Bt,_.push(new Tt(E,R))}}let aS,sS;$t(oS,"BuildingBucket",{omit:["layers"]}),$t(_x,"BuildingGeometry"),$t(nS,"BuildingBloomGeometry");const wM=ei([{name:"a_pos_normal",components:2,type:"Int16"},{name:"a_data",components:4,type:"Uint8"},{name:"a_linesofar",components:1,type:"Float32"}],4),SM=ei([{name:"a_z_offset_width",components:3,type:"Float32"}],4),{members:TM}=wM,AM=ei([{name:"a_packed",components:3,type:"Float32"}]),{members:EM}=AM,CM=ei([{name:"a_pattern_data",components:3,type:"Float32"}]),{members:IM}=CM;class lS{constructor(t,a){this.width=t,this.height=a,this.nextRow=0,this.image=new _f({width:t,height:a}),this.positions={},this.uploaded=!1}getDash(t,a){const u=this.getKey(t,a);return this.positions[u]}trim(){const t=this.width,a=this.height=lr(this.nextRow);this.image.resize({width:t,height:a})}getKey(t,a){return t.join(",")+a}getDashRanges(t,a,u){const d=[];let _=t.length%2==1?-t[t.length-1]*u:0,v=t[0]*u,S=!0;d.push({left:_,right:v,isDash:S,zeroLength:t[0]===0});let E=t[0];for(let R=1;R<t.length;R++){S=!S;const P=t[R];_=E*u,E+=P,v=E*u,d.push({left:_,right:v,isDash:S,zeroLength:P===0})}return d}addRoundDash(t,a,u){const d=a/2;for(let _=-u;_<=u;_++){const v=this.width*(this.nextRow+u+_);let S=0,E=t[S];for(let R=0;R<this.width;R++){R/E.right>1&&(E=t[++S]);const P=Math.abs(R-E.left),B=Math.abs(R-E.right),F=Math.min(P,B);let j;const G=_/u*(d+1);if(E.isDash){const Q=d-Math.abs(G);j=Math.sqrt(F*F+Q*Q)}else j=d-Math.sqrt(F*F+G*G);this.image.data[v+R]=Math.max(0,Math.min(255,j+128))}}}addRegularDash(t,a){for(let E=t.length-1;E>=0;--E){const R=t[E],P=t[E+1];R.zeroLength?t.splice(E,1):P&&P.isDash===R.isDash&&(P.left=R.left,t.splice(E,1))}const u=t[0],d=t[t.length-1];u.isDash===d.isDash&&(u.left=d.left-this.width,d.right=u.right+this.width);const _=this.width*this.nextRow;let v=0,S=t[v];for(let E=0;E<this.width;E++){E/S.right>1&&(S=t[++v]);const R=Math.abs(E-S.left),P=Math.abs(E-S.right),B=Math.min(R,P);this.image.data[_+E]=Math.max(0,Math.min(255,(S.isDash?B:-B)+a+128))}}addDash(t,a){const u=this.getKey(t,a);if(this.positions[u])return this.positions[u];const d=a==="round",_=d?7:0,v=2*_+1;if(this.nextRow+v>this.height)return ri("LineAtlas out of space"),null;t.length===0&&t.push(1);let S=0;for(let P=0;P<t.length;P++)t[P]<0&&(ri("Negative value is found in line dasharray, replacing values with 0"),t[P]=0),S+=t[P];if(S!==0){const P=this.width/S,B=this.getDashRanges(t,this.width,P);d?this.addRoundDash(B,P,_):this.addRegularDash(B,a==="square"?.5*P:0)}const E=this.nextRow+_;this.nextRow+=v;const R={tl:[E,_],br:[S,0]};return this.positions[u]=R,R}}$t(lS,"LineAtlas");const RM=pt.types,MM=Math.cos(Math.PI/180*37.5),DM=Math.cos(Math.PI/180*5);class yx{constructor(t){this.evaluationGlobals={zoom:0,lineProgress:void 0},this.elevationType="none",this.zoom=t.zoom,this.evaluationGlobals.zoom=this.zoom,this.overscaling=t.overscaling,this.pixelRatio=t.pixelRatio,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.index=t.index,this.projection=t.projection,this.hasPattern=!1,this.hasCrossSlope=!1,this.patternFeatures=[],this.lineClipsArray=[],this.gradients={},this.layers.forEach((a=>{this.gradients[a.id]={}})),this.layoutVertexArray=new Rc,this.layoutVertexArray2=new fa,this.patternVertexArray=new fa,this.indexArray=new Cn,this.programConfigurations=new Bo(t.layers,{zoom:t.zoom,lut:t.lut}),this.segments=new hn,this.maxLineLength=0,this.zOffsetVertexArray=new fa,this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.tessellationStep=t.tessellationStep?t.tessellationStep:Bt/64,this.worldview=t.worldview}updateFootprints(t,a){}populate(t,a,u,d){this.hasPattern=zc("line",this.layers,this.pixelRatio,a);const _=this.layers[0].layout.get("line-sort-key");this.tileToMeter=Ge(u);const v=this.layers[0].layout.get("line-elevation-reference");if(v==="hd-road-markup")this.elevationType="road";else{const F=this.layers[0].layout.get("line-z-offset"),j=F.isConstant()&&!F.constantOr(0);this.elevationType=v!=="sea"&&v!=="ground"&&j?"none":"offset",this.elevationType==="offset"&&v==="none"&&ri(`line-elevation-reference: ground is used for the layer ${this.layerIds[0]} because non-zero line-z-offset value was found.`)}const S=this.layers[0].layout.get("line-cross-slope");this.hasCrossSlope=this.elevationType==="offset"&&S!==void 0;const E=[];for(const{feature:F,id:j,index:G,sourceLayerIndex:Q}of t){const J=this.layers[0]._featureFilter.needGeometry,ee=ft(F,J);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom,{worldview:this.worldview}),ee,u))continue;const se=_?_.evaluate(ee,{},u):void 0,le={id:j,properties:F.properties,type:F.type,sourceLayerIndex:Q,index:G,geometry:J?ee.geometry:wt(F,u,d),patterns:{},sortKey:se};E.push(le)}_&&E.sort(((F,j)=>F.sortKey-j.sortKey));const{lineAtlas:R,featureIndex:P}=a,B=this.addConstantDashes(R);for(const F of E){const{geometry:j,index:G,sourceLayerIndex:Q}=F;if(B&&this.addFeatureDashes(F,R),this.hasPattern){const J=m0("line",this.layers,F,this.zoom,this.pixelRatio,a);this.patternFeatures.push(J)}else this.addFeature(F,j,G,u,R.positions,a.availableImages,a.brightness,a.elevationFeatures);P.insert(t[G].feature,j,G,Q,this.index)}}addConstantDashes(t){let a=!1;for(const u of this.layers){const d=u.paint.get("line-dasharray").value,_=u.layout.get("line-cap").value;if(d.kind!=="constant"||_.kind!=="constant")a=!0;else{const v=_.value,S=d.value;if(!S)continue;t.addDash(S,v)}}return a}addFeatureDashes(t,a){const u=this.zoom;for(const d of this.layers){const _=d.paint.get("line-dasharray").value,v=d.layout.get("line-cap").value;if(_.kind==="constant"&&v.kind==="constant")continue;let S,E;if(_.kind==="constant"){if(S=_.value,!S)continue}else S=_.evaluate({zoom:u},t);E=v.kind==="constant"?v.value:v.evaluate({zoom:u},t),a.addDash(S,E),t.patterns[d.id]=[a.getKey(S,E)]}}update(t,a,u,d,_,v,S,E){this.programConfigurations.updatePaintArrays(t,a,_,u,d,v,S,E)}addFeatures(t,a,u,d,_,v){for(const S of this.patternFeatures)this.addFeature(S,S.geometry,S.index,a,u,d,v)}isEmpty(){return this.layoutVertexArray.length===0}uploadPending(){return!this.uploaded||this.programConfigurations.needsUpload}upload(t){this.uploaded||(this.layoutVertexArray2.length!==0&&(this.layoutVertexBuffer2=t.createVertexBuffer(this.layoutVertexArray2,EM)),this.patternVertexArray.length!==0&&(this.patternVertexBuffer=t.createVertexBuffer(this.patternVertexArray,IM)),!this.zOffsetVertexBuffer&&this.zOffsetVertexArray.length>0&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,SM.members,!0)),this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,TM),this.indexBuffer=t.createIndexBuffer(this.indexArray)),this.programConfigurations.upload(t),this.uploaded=!0}destroy(){this.layoutVertexBuffer&&(this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy())}lineFeatureClips(t,a){let u,d;if(a&&a>0?(u=`mapbox_clip_start_${a}`,d=`mapbox_clip_end_${a}`):(u="mapbox_clip_start",d="mapbox_clip_end"),t.properties&&t.properties.hasOwnProperty(u)&&t.properties.hasOwnProperty(d))return{start:+t.properties[u],end:+t.properties[d]}}addFeature(t,a,u,d,_,v,S,E){const R=this.layers[0].layout,P=R.get("line-join").evaluate(t,{}),B=R.get("line-cap").evaluate(t,{}),F=R.get("line-miter-limit"),j=R.get("line-round-limit");this.lineClips=this.lineFeatureClips(t),this.lineFeature=t;const G=!(!t.properties||!t.properties.hasOwnProperty("mapbox_line_metrics"))&&t.properties.mapbox_line_metrics;this.zOffsetValue=R.get("line-z-offset").value;const Q=this.layers[0].paint.get("line-width").value;if(Q.kind!=="constant"&&Q.isLineProgressConstant===!1&&(this.variableWidthValue=Q),this.elevationType==="road"){const J=this.layoutVertexArray.length;if(!this.addElevatedRoadFeature(t,a,d,E,P,B,F,j)){const[ee,se]=this.clipRuntimeLinesToTile(a,1);for(let le=0;le<ee.length;le++){const he=ee[le],Ee=se[le],Ce={progress:{min:Ee.progress.min,max:Ee.progress.max},nextDir:this.computeSegNextDir(Ee,he),prevDir:this.computeSegPrevDir(Ee,he)};this.addLine(he,t,d,P,B,F,j,Ce,G&&Ee.parentIndex>0?Ee.parentIndex:null)}this.fillNonElevatedRoadSegment(J)}}else for(let J=0;J<a.length;J++)this.addLine(a[J],t,d,P,B,F,j,void 0,G&&J>0?J:null);this.programConfigurations.populatePaintArrays(this.layoutVertexArray.length,t,u,_,v,d,S,void 0,this.worldview)}computeSegNextDir(t,a){return t.nextPoint.sub(a.at(-2)).unit()}computeSegPrevDir(t,a){return a[1].sub(t.prevPoint).unit()}clipLinesToTile(t,a){return N(t,-a,-a,Bt+a,Bt+a)}clipRuntimeLinesToTile(t,a){const u=[];return[N(t,-a,-a,Bt+a,Bt+a,u),u]}addElevatedRoadFeature(t,a,u,d,_,v,S,E){const R=[],P=Xi.getElevationFeature(t,d);if(P){const B=this.clipLinesToTile(a,1),F=this.prepareElevatedLines(B,P,u);for(const j of F)R.push({geometry:j,elevation:P,elevationTileID:u,segment:{progress:{min:0,max:1},nextDir:void 0,prevDir:void 0}})}if(R.length===0)return!1;for(const B of R){const F=this.layoutVertexArray.length;this.addLine(B.geometry,t,u,_,v,S,E);const j=new Bn(u,B.elevationTileID);if(B.elevation)for(let G=F;G<this.layoutVertexArray.length;G++){const Q=new Tt(this.layoutVertexArray.int16[6*G]>>1,this.layoutVertexArray.int16[6*G+1]>>1),J=j.pointElevation(Q,B.elevation,.05);this.updateHeightRange(J),this.zOffsetVertexArray.emplaceBack(J,0,0)}else this.fillNonElevatedRoadSegment(F)}return!0}prepareElevatedLines(t,a,u){if(a.constantHeight!=null)return t;const d=[],_=1/Ge(u);for(const v of t)$(v,new Ti(a,_),0,d);return d}fillNonElevatedRoadSegment(t){for(let a=t;a<this.layoutVertexArray.length;a++)this.zOffsetVertexArray.emplaceBack(0,0,0)}updateHeightRange(t){this.heightRange?(this.heightRange.min=Math.min(this.heightRange.min,t),this.heightRange.max=Math.max(this.heightRange.max,t)):this.heightRange={min:t,max:t}}addLine(t,a,u,d,_,v,S,E,R){this.distance=0,this.prevDistance=0,this.scaledDistance=0,this.totalDistance=0,this.totalFeatureLength=0,this.lineSoFar=0,this.currentVertex=void 0,this.lineClips=R?this.lineFeatureClips(a,R):this.lineClips;const P=d==="none";this.patternJoinNone=this.hasPattern&&P,this.segmentStart=0,this.segmentStartf32=0,this.segmentPoints=[];const B=E&&E.progress.min>0,F=E&&E.progress.max<1;if(this.lineClips){let Fe={min:this.lineClips.start,max:this.lineClips.end},ut=1;if(E){const St=this.lineClips.end-this.lineClips.start;Fe=(function(gt,yt,Rt){return{min:Ql(gt.min,yt,Rt),max:Ql(gt.max,yt,Rt)}})(E.progress,{min:0,max:1},Fe),St>0&&(ut=(Fe.max-Fe.min)/St)}const Ue=+a.properties.mapbox_clip_feature_len,dt=+a.properties.mapbox_clip_seg_len;if(Number.isNaN(Ue)||Number.isNaN(dt)){for(let gt=0;gt<t.length-1;gt++)this.totalDistance+=t[gt].dist(t[gt+1]);const St=this.totalDistance/(Fe.max-Fe.min);this.totalFeatureLength=Number.isFinite(St)?St:0,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.totalDistance)}else this.totalFeatureLength=Ue,this.distance=dt*ut,this.lineClips.start=Fe.min,this.lineClips.end=Fe.max,this.maxLineLength=Math.max(this.maxLineLength,this.distance);this.lineClipsArray.push(this.lineClips),this.updateScaledDistance()}const j=RM[a.type]==="Polygon";let G=t.length;for(;G>=2&&t[G-1].equals(t[G-2]);)G--;let Q=0;for(;Q<G-1&&t[Q].equals(t[Q+1]);)Q++;if(G<(j?3:2))return;d==="bevel"&&(v=1.05);const J=this.segments.prepareSegment(10*G,this.layoutVertexArray,this.indexArray);let ee,se,le,he,Ee,Ce,De,Le;E&&E.prevDir&&(Ce=E.prevDir.perp()),E&&E.nextDir&&(De=E.nextDir.perp()),this.e1=this.e2=-1,j&&(ee=t[G-2],Ee=t[Q].sub(ee)._unit()._perp());for(let Fe=Q;Fe<G;Fe++){if(le=Fe===G-1?j?t[Q+1]:void 0:t[Fe+1],le&&t[Fe].equals(le))continue;Ee&&(he=Ee),ee&&(se=ee),ee=t[Fe],Le=this.evaluateLineProgressFeatures(se?se.dist(ee):0),Ee=le?le.sub(ee)._unit()._perp():he,he=he||Ee;const ut=se&&le;let Ue=ut?d:j||P?"butt":_;const dt=he.x*Ee.x+he.y*Ee.y;if(P){const We=function(Dt){if(Dt.patternJoinNone){const Et=Dt.segmentPoints.length/2,dr=Dt.lineSoFar-Dt.segmentStart;for(let Zt=0;Zt<Et;++Zt){const nr=Dt.segmentPoints[2*Zt+1],Nt=Math.round(Dt.segmentPoints[2*Zt])+.5+.25*nr;Dt.patternVertexArray.emplaceBack(Nt,dr,Dt.segmentStart),Dt.patternVertexArray.emplaceBack(Nt,dr,Dt.segmentStart)}Dt.segmentPoints.length=0}Dt.e1=Dt.e2=-1};if(ut&&dt<DM){this.updateDistance(se,ee),this.addCurrentVertex(ee,he,1,1,J,Le),We(this),this.addCurrentVertex(ee,Ee,-1,-1,J,Le);continue}if(se){if(!le){this.updateDistance(se,ee),this.addCurrentVertex(ee,he,1,1,J,Le),We(this);continue}Ue="miter"}}let St=he.add(Ee);St.x===0&&St.y===0||St._unit();const gt=St.x*Ee.x+St.y*Ee.y,yt=gt!==0?1/gt:1/0,Rt=2*Math.sqrt(2-2*gt),lt=gt<MM&&se&&le,vt=he.x*Ee.y-he.y*Ee.x>0,et=this.overscaling<=16?15*Bt/(512*this.overscaling):0;if(ut&&Ue==="round"){if(yt<S)Ue="miter";else if(yt<=2){const We=vx(ee,-10,Bt+10);Ue=this.elevationType==="offset"&&(We||this.hasCrossSlope)?"miter":"fakeround"}}if(Ue==="miter"&&yt>v&&(Ue="bevel"),Ue==="bevel"&&(yt>2&&(Ue="flipbevel"),yt<v&&(Ue="miter")),se&&!(Ue==="miter"&&lt)&&this.updateDistance(se,ee),Ue==="miter")if(lt){const We=ee.dist(se);if(We>2*et){const Et=ee.sub(ee.sub(se)._mult(et/We)._round());this.updateDistance(se,Et),this.addCurrentVertex(Et,he,0,0,J,Le),se=Et}this.updateDistance(se,ee),St._mult(yt),this.addCurrentVertex(ee,St,0,0,J,Le);const Dt=ee.dist(le);if(Dt>2*et){const Et=ee.add(le.sub(ee)._mult(et/Dt)._round());this.updateDistance(ee,Et),this.addCurrentVertex(Et,Ee,0,0,J,Le),ee=Et}}else St._mult(yt),this.addCurrentVertex(ee,St,0,0,J,Le);else if(Ue==="flipbevel"){if(yt>100)St=Ee.mult(-1);else{const We=yt*he.add(Ee).mag()/he.sub(Ee).mag();St._perp()._mult(We*(vt?-1:1))}this.addCurrentVertex(ee,St,0,0,J,Le),this.addCurrentVertex(ee,St.mult(-1),0,0,J,Le)}else if(Ue==="bevel"||Ue==="fakeround"){Le!=null&&se&&this.addCurrentVertex(ee,De||he,-1,-1,J,Le);const We=ee.dist(se)<=2*et&&Ue!=="bevel",Dt=St.mult(vt?1:-1);Dt._mult(yt);const Et=Ee.mult(vt?-1:1),dr=he.mult(vt?-1:1),Zt=this.evaluateLineProgressFeatures(this.distance);if(Le==null&&(this.addHalfVertex(ee,Dt.x,Dt.y,!1,!vt,0,J,Zt),We||this.addHalfVertex(ee,Dt.x+2*dr.x,Dt.y+2*dr.y,!1,vt,0,J,Zt)),Ue==="fakeround"){const nr=Math.round(180*Rt/Math.PI/20);this.addHalfVertex(ee,dr.x,dr.y,!1,vt,0,J,Zt);for(let Nt=0;Nt<nr;Nt++){let ur=Nt/nr;if(ur!==.5){const Ht=ur-.5;ur+=ur*Ht*(ur-1)*((1.0904+dt*(dt*(3.55645-1.43519*dt)-3.2452))*Ht*Ht+(.848013+dt*(.215638*dt-1.06021)))}const Dr=Et.sub(dr)._mult(ur)._add(dr)._unit();this.addHalfVertex(ee,Dr.x,Dr.y,!1,vt,0,J,Zt)}this.addHalfVertex(ee,Et.x,Et.y,!1,vt,0,J,Zt)}We||Le!=null||this.addHalfVertex(ee,Dt.x+2*Et.x,Dt.y+2*Et.y,!1,vt,0,J,Zt),Le!=null&&le&&this.addCurrentVertex(ee,Ce||Ee,1,1,J,Le)}else if(Ue==="butt")this.addCurrentVertex(ee,St,0,0,J,Le);else if(Ue==="square"){if(!se){const We=B?0:-1;this.addCurrentVertex(ee,St,We,We,J,Le)}if(this.addCurrentVertex(ee,St,0,0,J,Le),se){const We=F?0:1;this.addCurrentVertex(ee,St,We,We,J,Le)}}else if(Ue==="round"){if(se){const We=!ut&&De?De:he;this.addCurrentVertex(ee,We,0,0,J,Le),!ut&&F||this.addCurrentVertex(ee,We,1,1,J,Le,!0)}if(le){const We=!ut&&Ce?Ce:Ee;!ut&&B||this.addCurrentVertex(ee,We,-1,-1,J,Le,!0),this.addCurrentVertex(ee,We,0,0,J,Le)}}}}addVerticesTo(t,a,u,d,_,v,S,E,R,P){const B=(a.w-t.w)/this.tessellationStep|0;let F=0;const j=this.scaledDistance;if(B>1){this.lineSoFar=t.w;const Q=(a.x-t.x)/B,J=(a.y-t.y)/B,ee=(a.z-t.z)/B,se=(a.w-t.w)/B;for(let le=1;le<B;++le){t.x+=Q,t.y+=J,t.z+=ee,this.lineSoFar+=se,F+=se;const he=this.evaluateLineProgressFeatures(this.prevDistance+F);this.scaledDistance=(this.prevDistance+F)/this.totalDistance,this.addHalfVertex(t,u,d,P,!1,S,R,he),this.addHalfVertex(t,_,v,P,!0,-E,R,he)}}this.lineSoFar=a.w,this.scaledDistance=j;const G=this.evaluateLineProgressFeatures(this.distance);this.addHalfVertex(a,u,d,P,!1,S,R,G),this.addHalfVertex(a,_,v,P,!0,-E,R,G)}evaluateLineProgressFeatures(t){if(!this.variableWidthValue&&this.elevationType!=="offset")return null;this.evaluationGlobals.lineProgress=0,this.lineClips?this.evaluationGlobals.lineProgress=Math.min(1,(this.totalFeatureLength*this.lineClips.start+t)/this.totalFeatureLength):ri(`line-progress evaluation for ${this.layerIds[0]} requires enabling 'lineMetrics' for the source.`);let a=0;return this.variableWidthValue&&this.variableWidthValue.kind!=="constant"&&(a=this.variableWidthValue.evaluate(this.evaluationGlobals,this.lineFeature)||0),this.elevationType!=="offset"?{zOffset:0,variableWidth:a}:this.zOffsetValue.kind==="constant"?{zOffset:this.zOffsetValue.value,variableWidth:a}:{zOffset:this.zOffsetValue.evaluate(this.evaluationGlobals,this.lineFeature)||0,variableWidth:a}}addCurrentVertex(t,a,u,d,_,v,S=!1){const E=a.x+a.y*u,R=a.y-a.x*u,P=a.y*d-a.x,B=-a.y-a.x*d;if(v!=null){const F=this.elevationType==="offset",j=-10,G=Bt+10,Q=v.zOffset,J=new y(t.x,t.y,Q,this.lineSoFar),ee=!!F&&vx(t,j,G),se=this.lineSoFar,le=this.distance;if(this.currentVertex)if(ee){const he=this.currentVertexIsOutside,Ee=this.currentVertex,Ce=new y(t.x,t.y,Q,this.lineSoFar);if(M(Ee,Ce,j,G),!vx(Ce,j,G)){if(he){this.e1=this.e2=-1,this.distance-=Ee.dist(J),this.lineSoFar=Ee.w;const De=this.evaluateLineProgressFeatures(Ee.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(Ee,E,R,S,!1,u,_,De),this.addHalfVertex(Ee,P,B,S,!0,-d,_,De),this.prevDistance=this.distance}this.distance=this.prevDistance+Ee.dist(Ce),this.scaledDistance=this.distance/this.totalDistance,this.addVerticesTo(Ee,Ce,E,R,P,B,u,d,_,S),this.distance=le,this.scaledDistance=this.distance/this.totalDistance}}else{const he=this.currentVertex;if(this.currentVertexIsOutside){M(he,J,j,G),this.e1=this.e2=-1,this.distance-=he.dist(J),this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=he.w;const Ee=this.evaluateLineProgressFeatures(he.w-this.totalFeatureLength*(this.lineClips?this.lineClips.start:0));this.addHalfVertex(he,E,R,S,!1,u,_,Ee),this.addHalfVertex(he,P,B,S,!0,-d,_,Ee),this.prevDistance=this.distance,this.distance=le,this.scaledDistance=this.distance/this.totalDistance}this.addVerticesTo(he,J,E,R,P,B,u,d,_,S)}else ee||(this.addHalfVertex(t,E,R,S,!1,u,_,v),this.addHalfVertex(t,P,B,S,!0,-d,_,v));this.currentVertex=J,this.currentVertexIsOutside=ee,this.lineSoFar=se}else this.addHalfVertex(t,E,R,S,!1,u,_,v),this.addHalfVertex(t,P,B,S,!0,-d,_,v)}addHalfVertex({x:t,y:a},u,d,_,v,S,E,R){if(this.patternJoinNone&&(this.segmentPoints.length===0&&(this.segmentStart=this.lineSoFar,this.segmentStartf32=Math.fround(this.lineSoFar)),v||this.segmentPoints.push(this.lineSoFar-this.segmentStart,S)),this.layoutVertexArray.emplaceBack((t<<1)+(_?1:0),(a<<1)+(v?1:0),Math.round(63*u)+128,Math.round(63*d)+128,1+(S===0?0:S<0?-1:1),0,this.lineSoFar-this.segmentStartf32),this.lineClips){const B=xr(this.lineClips.start,this.lineClips.end,this.scaledDistance);this.layoutVertexArray2.emplaceBack(this.scaledDistance,this.lineClipsArray.length,B)}const P=E.vertexLength++;this.e1>=0&&this.e2>=0&&(this.indexArray.emplaceBack(this.e1,this.e2,P),E.primitiveLength++),v?this.e2=P:this.e1=P,R!=null&&this.zOffsetVertexArray.emplaceBack(R.zOffset,R.variableWidth,R.variableWidth)}updateScaledDistance(){this.lineClips?(this.scaledDistance=this.distance/this.totalDistance,this.lineSoFar=this.totalFeatureLength*this.lineClips.start+this.distance):this.lineSoFar=this.distance}updateDistance(t,a){this.prevDistance=this.distance,this.distance+=t.dist(a),this.updateScaledDistance()}}function vx(s,t,a){return s.x<t||s.x>a||s.y<t||s.y>a}let cS,uS;function hS(s,t,a){return t*(Bt/(s.tileSize*Math.pow(2,a-s.tileID.overscaledZ)))}$t(yx,"LineBucket",{omit:["layers","patternFeatures","currentVertex","currentVertexIsOutside"]});const fS=(s,t,a)=>(1-a)*s+a*t;function dS(s,t){return 1/hS(s,1,t.tileZoom)}function pS(s,t,a,u){return s.translatePosMatrix(u||t.tileID.projMatrix,t,a.paint.get("line-translate"),a.paint.get("line-translate-anchor"))}const mS=s=>{const t=[];gS(s)&&t.push("RENDER_LINE_DASH"),s.paint.get("line-gradient")&&t.push("RENDER_LINE_GRADIENT");const a=s.paint.get("line-trim-offset");a[0]===0&&a[1]===0||t.push("RENDER_LINE_TRIM_OFFSET"),s.paint.get("line-border-width").constantOr(1)!==0&&t.push("RENDER_LINE_BORDER");const u=s.layout.get("line-join").constantOr("miter")==="none",d=!!s.paint.get("line-pattern").constantOr(1);return u&&d&&t.push("LINE_JOIN_NONE"),t};function gS(s){const t=s.paint.get("line-dasharray").value;return t.kind!=="constant"||t.value}let xx;const _S=()=>xx||(xx={layout:cS||(cS=new yn({"line-cap":new Ut(Ve.layout_line["line-cap"]),"line-join":new Ut(Ve.layout_line["line-join"]),"line-miter-limit":new At(Ve.layout_line["line-miter-limit"]),"line-round-limit":new At(Ve.layout_line["line-round-limit"]),"line-sort-key":new Ut(Ve.layout_line["line-sort-key"]),"line-z-offset":new Ut(Ve.layout_line["line-z-offset"]),"line-elevation-reference":new At(Ve.layout_line["line-elevation-reference"]),"line-cross-slope":new At(Ve.layout_line["line-cross-slope"]),visibility:new At(Ve.layout_line.visibility),"line-width-unit":new At(Ve.layout_line["line-width-unit"])})),paint:uS||(uS=new yn({"line-opacity":new Ut(Ve.paint_line["line-opacity"]),"line-color":new Ut(Ve.paint_line["line-color"]),"line-translate":new At(Ve.paint_line["line-translate"]),"line-translate-anchor":new At(Ve.paint_line["line-translate-anchor"]),"line-width":new Ut(Ve.paint_line["line-width"]),"line-gap-width":new Ut(Ve.paint_line["line-gap-width"]),"line-offset":new Ut(Ve.paint_line["line-offset"]),"line-blur":new Ut(Ve.paint_line["line-blur"]),"line-dasharray":new Ut(Ve.paint_line["line-dasharray"]),"line-pattern":new Ut(Ve.paint_line["line-pattern"]),"line-pattern-cross-fade":new At(Ve.paint_line["line-pattern-cross-fade"]),"line-gradient":new lh(Ve.paint_line["line-gradient"]),"line-trim-offset":new At(Ve.paint_line["line-trim-offset"]),"line-trim-fade-range":new At(Ve.paint_line["line-trim-fade-range"]),"line-trim-color":new At(Ve.paint_line["line-trim-color"]),"line-emissive-strength":new At(Ve.paint_line["line-emissive-strength"]),"line-border-width":new Ut(Ve.paint_line["line-border-width"]),"line-border-color":new Ut(Ve.paint_line["line-border-color"]),"line-occlusion-opacity":new At(Ve.paint_line["line-occlusion-opacity"]),"line-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-gradient-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-trim-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"line-border-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},xx);class OM extends Ut{possiblyEvaluate(t,a){return a=new Hi(Math.floor(a.zoom),{now:a.now,fadeDuration:a.fadeDuration,transition:a.transition,worldview:a.worldview}),super.possiblyEvaluate(t,a)}evaluate(t,a,u,d){return a=Object.assign({},a,{zoom:Math.floor(a.zoom)}),super.evaluate(t,a,u,d)}}let I0;function yS(s,t){return t>0?t+2*s:s}const PM=ei([{name:"a_pos_offset",components:4,type:"Int16"},{name:"a_tex_size",components:4,type:"Uint16"},{name:"a_pixeloffset",components:4,type:"Int16"}],4),LM=ei([{name:"a_globe_anchor",components:3,type:"Int16"},{name:"a_globe_normal",components:3,type:"Float32"}],4),BM=ei([{name:"a_projected_pos",components:4,type:"Float32"}],4);ei([{name:"a_fade_opacity",components:1,type:"Uint32"}],4);const zM=ei([{name:"a_auto_z_offset",components:1,type:"Float32"}],4),FM=ei([{name:"a_x_axis",components:3,type:"Float32"},{name:"a_y_axis",components:3,type:"Float32"}]),kM=ei([{name:"a_texb",components:2,type:"Uint16"}]),NM=ei([{name:"a_placed",components:2,type:"Uint8"},{name:"a_shift",components:2,type:"Float32"},{name:"a_elevation_from_sea",components:2,type:"Float32"}]),VM=ei([{name:"a_size_scale",components:1,type:"Float32"},{name:"a_padding",components:2,type:"Float32"},{name:"a_auto_z_offset",components:1,type:"Float32"}]);ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"tileAnchorX"},{type:"Int16",name:"tileAnchorY"},{type:"Float32",name:"x1"},{type:"Float32",name:"y1"},{type:"Float32",name:"x2"},{type:"Float32",name:"y2"},{type:"Int16",name:"padding"},{type:"Uint32",name:"featureIndex"},{type:"Uint16",name:"sourceLayerIndex"},{type:"Uint16",name:"bucketIndex"}]);const vS=ei([{name:"a_pos",components:3,type:"Int16"},{name:"a_anchor_pos",components:2,type:"Int16"},{name:"a_extrude",components:2,type:"Int16"}],4),UM=ei([{name:"a_pos_2f",components:2,type:"Float32"},{name:"a_radius",components:1,type:"Float32"},{name:"a_flags",components:2,type:"Int16"}],4);ei([{name:"triangle",components:3,type:"Uint16"}]),ei([{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Uint16",name:"glyphStartIndex"},{type:"Uint16",name:"numGlyphs"},{type:"Uint32",name:"vertexStartIndex"},{type:"Uint32",name:"lineStartIndex"},{type:"Uint32",name:"lineLength"},{type:"Uint16",name:"segment"},{type:"Uint16",name:"lowerSize"},{type:"Uint16",name:"upperSize"},{type:"Float32",name:"lineOffsetX"},{type:"Float32",name:"lineOffsetY"},{type:"Uint8",name:"writingMode"},{type:"Uint8",name:"placedOrientation"},{type:"Uint8",name:"hidden"},{type:"Uint32",name:"crossTileID"},{type:"Int16",name:"associatedIconIndex"},{type:"Uint8",name:"flipState"}]),ei([{type:"Float32",name:"tileAnchorX"},{type:"Float32",name:"tileAnchorY"},{type:"Int16",name:"projectedAnchorX"},{type:"Int16",name:"projectedAnchorY"},{type:"Int16",name:"projectedAnchorZ"},{type:"Int16",name:"rightJustifiedTextSymbolIndex"},{type:"Int16",name:"centerJustifiedTextSymbolIndex"},{type:"Int16",name:"leftJustifiedTextSymbolIndex"},{type:"Int16",name:"verticalPlacedTextSymbolIndex"},{type:"Int16",name:"placedIconSymbolIndex"},{type:"Int16",name:"verticalPlacedIconSymbolIndex"},{type:"Uint16",name:"key"},{type:"Uint16",name:"textBoxStartIndex"},{type:"Uint16",name:"textBoxEndIndex"},{type:"Uint16",name:"verticalTextBoxStartIndex"},{type:"Uint16",name:"verticalTextBoxEndIndex"},{type:"Uint16",name:"iconBoxStartIndex"},{type:"Uint16",name:"iconBoxEndIndex"},{type:"Uint16",name:"verticalIconBoxStartIndex"},{type:"Uint16",name:"verticalIconBoxEndIndex"},{type:"Uint16",name:"featureIndex"},{type:"Uint16",name:"numHorizontalGlyphVertices"},{type:"Uint16",name:"numVerticalGlyphVertices"},{type:"Uint16",name:"numIconVertices"},{type:"Uint16",name:"numVerticalIconVertices"},{type:"Uint16",name:"useRuntimeCollisionCircles"},{type:"Uint32",name:"crossTileID"},{type:"Float32",components:2,name:"textOffset"},{type:"Float32",name:"collisionCircleDiameter"},{type:"Float32",name:"zOffset"},{type:"Uint8",name:"hasIconTextFit"},{type:"Uint16",name:"elevationFeatureIndex"}]),ei([{type:"Float32",name:"offsetX"}]),ei([{type:"Int16",name:"x"},{type:"Int16",name:"y"}]);var $o=24;function jM(s,t,a){return s.sections.forEach((u=>{u.text=(function(d,_,v){const S=_.layout.get("text-transform").evaluate(v,{});return S==="uppercase"?d=d.toLocaleUpperCase():S==="lowercase"&&(d=d.toLocaleLowerCase()),tl.applyArabicShaping&&(d=tl.applyArabicShaping(d)),d})(u.text,t,a)})),s}const R0={"!":"︕","#":"＃",$:"＄","%":"％","&":"＆","(":"︵",")":"︶","*":"＊","+":"＋",",":"︐","-":"︲",".":"・","/":"／",":":"︓",";":"︔","<":"︿","=":"＝",">":"﹀","?":"︖","@":"＠","[":"﹇","\\":"＼","]":"﹈","^":"＾",_:"︳","`":"｀","{":"︷","|":"―","}":"︸","~":"～","¢":"￠","£":"￡","¥":"￥","¦":"￤","¬":"￢","¯":"￣","–":"︲","—":"︱","‘":"﹃","’":"﹄","“":"﹁","”":"﹂","…":"︙","‧":"・","₩":"￦","、":"︑","。":"︒","〈":"︿","〉":"﹀","《":"︽","》":"︾","「":"﹁","」":"﹂","『":"﹃","』":"﹄","【":"︻","】":"︼","〔":"︹","〕":"︺","〖":"︗","〗":"︘","！":"︕","（":"︵","）":"︶","，":"︐","－":"︲","．":"・","：":"︓","；":"︔","＜":"︿","＞":"﹀","？":"︖","［":"﹇","］":"﹈","＿":"︳","｛":"︷","｜":"―","｝":"︸","｟":"︵","｠":"︶","｡":"︒","｢":"﹁","｣":"﹂","←":"↑","→":"↓"};function GM(s){return s==="︶"||s==="﹈"||s==="︸"||s==="﹄"||s==="﹂"||s==="︾"||s==="︼"||s==="︺"||s==="︘"||s==="﹀"||s==="︐"||s==="︓"||s==="︔"||s==="｀"||s==="￣"||s==="︑"||s==="︒"}function HM(s){return s==="︵"||s==="﹇"||s==="︷"||s==="﹃"||s==="﹁"||s==="︽"||s==="︻"||s==="︹"||s==="︗"||s==="︿"}const bx=4294967296,xS=1/bx,bS=typeof TextDecoder>"u"?null:new TextDecoder("utf-8");let w1=class{constructor(s=new Uint8Array(16)){this.buf=ArrayBuffer.isView(s)?s:new Uint8Array(s),this.dataView=new DataView(this.buf.buffer),this.pos=0,this.type=0,this.length=this.buf.length}readFields(s,t,a=this.length){for(;this.pos<a;){const u=this.readVarint(),d=u>>3,_=this.pos;this.type=7&u,s(d,t,this),this.pos===_&&this.skip(u)}return t}readMessage(s,t){return this.readFields(s,t,this.readVarint()+this.pos)}readFixed32(){const s=this.dataView.getUint32(this.pos,!0);return this.pos+=4,s}readSFixed32(){const s=this.dataView.getInt32(this.pos,!0);return this.pos+=4,s}readFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getUint32(this.pos+4,!0)*bx;return this.pos+=8,s}readSFixed64(){const s=this.dataView.getUint32(this.pos,!0)+this.dataView.getInt32(this.pos+4,!0)*bx;return this.pos+=8,s}readFloat(){const s=this.dataView.getFloat32(this.pos,!0);return this.pos+=4,s}readDouble(){const s=this.dataView.getFloat64(this.pos,!0);return this.pos+=8,s}readVarint(s){const t=this.buf;let a,u;return u=t[this.pos++],a=127&u,u<128?a:(u=t[this.pos++],a|=(127&u)<<7,u<128?a:(u=t[this.pos++],a|=(127&u)<<14,u<128?a:(u=t[this.pos++],a|=(127&u)<<21,u<128?a:(u=t[this.pos],a|=(15&u)<<28,(function(d,_,v){const S=v.buf;let E,R;if(R=S[v.pos++],E=(112&R)>>4,R<128||(R=S[v.pos++],E|=(127&R)<<3,R<128)||(R=S[v.pos++],E|=(127&R)<<10,R<128)||(R=S[v.pos++],E|=(127&R)<<17,R<128)||(R=S[v.pos++],E|=(127&R)<<24,R<128)||(R=S[v.pos++],E|=(1&R)<<31,R<128))return g_(d,E,_);throw new Error("Expected varint not more than 10 bytes")})(a,s,this)))))}readVarint64(){return this.readVarint(!0)}readSVarint(){const s=this.readVarint();return s%2==1?(s+1)/-2:s/2}readBoolean(){return!!this.readVarint()}readString(){const s=this.readVarint()+this.pos,t=this.pos;return this.pos=s,s-t>=12&&bS?bS.decode(this.buf.subarray(t,s)):(function(a,u,d){let _="",v=u;for(;v<d;){const S=a[v];let E,R,P,B=null,F=S>239?4:S>223?3:S>191?2:1;if(v+F>d)break;F===1?S<128&&(B=S):F===2?(E=a[v+1],(192&E)==128&&(B=(31&S)<<6|63&E,B<=127&&(B=null))):F===3?(E=a[v+1],R=a[v+2],(192&E)==128&&(192&R)==128&&(B=(15&S)<<12|(63&E)<<6|63&R,(B<=2047||B>=55296&&B<=57343)&&(B=null))):F===4&&(E=a[v+1],R=a[v+2],P=a[v+3],(192&E)==128&&(192&R)==128&&(192&P)==128&&(B=(15&S)<<18|(63&E)<<12|(63&R)<<6|63&P,(B<=65535||B>=1114112)&&(B=null))),B===null?(B=65533,F=1):B>65535&&(B-=65536,_+=String.fromCharCode(B>>>10&1023|55296),B=56320|1023&B),_+=String.fromCharCode(B),v+=F}return _})(this.buf,t,s)}readBytes(){const s=this.readVarint()+this.pos,t=this.buf.subarray(this.pos,s);return this.pos=s,t}readPackedVarint(s=[],t){const a=this.readPackedEnd();for(;this.pos<a;)s.push(this.readVarint(t));return s}readPackedSVarint(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readSVarint());return s}readPackedBoolean(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readBoolean());return s}readPackedFloat(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readFloat());return s}readPackedDouble(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readDouble());return s}readPackedFixed32(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readFixed32());return s}readPackedSFixed32(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readSFixed32());return s}readPackedFixed64(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readFixed64());return s}readPackedSFixed64(s=[]){const t=this.readPackedEnd();for(;this.pos<t;)s.push(this.readSFixed64());return s}readPackedEnd(){return this.type===2?this.readVarint()+this.pos:this.pos+1}skip(s){const t=7&s;if(t===0)for(;this.buf[this.pos++]>127;);else if(t===2)this.pos=this.readVarint()+this.pos;else if(t===5)this.pos+=4;else{if(t!==1)throw new Error(`Unimplemented type: ${t}`);this.pos+=8}}writeTag(s,t){this.writeVarint(s<<3|t)}realloc(s){let t=this.length||16;for(;t<this.pos+s;)t*=2;if(t!==this.length){const a=new Uint8Array(t);a.set(this.buf),this.buf=a,this.dataView=new DataView(a.buffer),this.length=t}}finish(){return this.length=this.pos,this.pos=0,this.buf.subarray(0,this.length)}writeFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeSFixed32(s){this.realloc(4),this.dataView.setInt32(this.pos,s,!0),this.pos+=4}writeFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*xS),!0),this.pos+=8}writeSFixed64(s){this.realloc(8),this.dataView.setInt32(this.pos,-1&s,!0),this.dataView.setInt32(this.pos+4,Math.floor(s*xS),!0),this.pos+=8}writeVarint(s){(s=+s||0)>268435455||s<0?(function(t,a){let u,d;if(t>=0?(u=t%4294967296|0,d=t/4294967296|0):(u=~(-t%4294967296),d=~(-t/4294967296),4294967295^u?u=u+1|0:(u=0,d=d+1|0)),t>=18446744073709552e3||t<-18446744073709552e3)throw new Error("Given varint doesn't fit into 10 bytes");a.realloc(10),(function(_,v,S){S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,_>>>=7,S.buf[S.pos++]=127&_|128,S.buf[S.pos]=127&(_>>>=7)})(u,0,a),(function(_,v){const S=(7&_)<<4;v.buf[v.pos++]|=S|((_>>>=3)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_|((_>>>=7)?128:0),_&&(v.buf[v.pos++]=127&_)))))})(d,a)})(s,this):(this.realloc(4),this.buf[this.pos++]=127&s|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=127&(s>>>=7)|(s>127?128:0),s<=127||(this.buf[this.pos++]=s>>>7&127))))}writeSVarint(s){this.writeVarint(s<0?2*-s-1:2*s)}writeBoolean(s){this.writeVarint(+s)}writeString(s){s=String(s),this.realloc(4*s.length),this.pos++;const t=this.pos;this.pos=(function(u,d,_){for(let v,S,E=0;E<d.length;E++){if(v=d.charCodeAt(E),v>55295&&v<57344){if(!S){v>56319||E+1===d.length?(u[_++]=239,u[_++]=191,u[_++]=189):S=v;continue}if(v<56320){u[_++]=239,u[_++]=191,u[_++]=189,S=v;continue}v=S-55296<<10|v-56320|65536,S=null}else S&&(u[_++]=239,u[_++]=191,u[_++]=189,S=null);v<128?u[_++]=v:(v<2048?u[_++]=v>>6|192:(v<65536?u[_++]=v>>12|224:(u[_++]=v>>18|240,u[_++]=v>>12&63|128),u[_++]=v>>6&63|128),u[_++]=63&v|128)}return _})(this.buf,s,this.pos);const a=this.pos-t;a>=128&&wS(t,a,this),this.pos=t-1,this.writeVarint(a),this.pos+=a}writeFloat(s){this.realloc(4),this.dataView.setFloat32(this.pos,s,!0),this.pos+=4}writeDouble(s){this.realloc(8),this.dataView.setFloat64(this.pos,s,!0),this.pos+=8}writeBytes(s){const t=s.length;this.writeVarint(t),this.realloc(t);for(let a=0;a<t;a++)this.buf[this.pos++]=s[a]}writeRawMessage(s,t){this.pos++;const a=this.pos;s(t,this);const u=this.pos-a;u>=128&&wS(a,u,this),this.pos=a-1,this.writeVarint(u),this.pos+=u}writeMessage(s,t,a){this.writeTag(s,2),this.writeRawMessage(t,a)}writePackedVarint(s,t){t.length&&this.writeMessage(s,qM,t)}writePackedSVarint(s,t){t.length&&this.writeMessage(s,$M,t)}writePackedBoolean(s,t){t.length&&this.writeMessage(s,WM,t)}writePackedFloat(s,t){t.length&&this.writeMessage(s,XM,t)}writePackedDouble(s,t){t.length&&this.writeMessage(s,ZM,t)}writePackedFixed32(s,t){t.length&&this.writeMessage(s,YM,t)}writePackedSFixed32(s,t){t.length&&this.writeMessage(s,QM,t)}writePackedFixed64(s,t){t.length&&this.writeMessage(s,KM,t)}writePackedSFixed64(s,t){t.length&&this.writeMessage(s,JM,t)}writeBytesField(s,t){this.writeTag(s,2),this.writeBytes(t)}writeFixed32Field(s,t){this.writeTag(s,5),this.writeFixed32(t)}writeSFixed32Field(s,t){this.writeTag(s,5),this.writeSFixed32(t)}writeFixed64Field(s,t){this.writeTag(s,1),this.writeFixed64(t)}writeSFixed64Field(s,t){this.writeTag(s,1),this.writeSFixed64(t)}writeVarintField(s,t){this.writeTag(s,0),this.writeVarint(t)}writeSVarintField(s,t){this.writeTag(s,0),this.writeSVarint(t)}writeStringField(s,t){this.writeTag(s,2),this.writeString(t)}writeFloatField(s,t){this.writeTag(s,5),this.writeFloat(t)}writeDoubleField(s,t){this.writeTag(s,1),this.writeDouble(t)}writeBooleanField(s,t){this.writeVarintField(s,+t)}};function g_(s,t,a){return a?4294967296*t+(s>>>0):4294967296*(t>>>0)+(s>>>0)}function wS(s,t,a){const u=t<=16383?1:t<=2097151?2:t<=268435455?3:Math.floor(Math.log(t)/(7*Math.LN2));a.realloc(u);for(let d=a.pos-1;d>=s;d--)a.buf[d+u]=a.buf[d]}function qM(s,t){for(let a=0;a<s.length;a++)t.writeVarint(s[a])}function $M(s,t){for(let a=0;a<s.length;a++)t.writeSVarint(s[a])}function XM(s,t){for(let a=0;a<s.length;a++)t.writeFloat(s[a])}function ZM(s,t){for(let a=0;a<s.length;a++)t.writeDouble(s[a])}function WM(s,t){for(let a=0;a<s.length;a++)t.writeBoolean(s[a])}function YM(s,t){for(let a=0;a<s.length;a++)t.writeFixed32(s[a])}function QM(s,t){for(let a=0;a<s.length;a++)t.writeSFixed32(s[a])}function KM(s,t){for(let a=0;a<s.length;a++)t.writeFixed64(s[a])}function JM(s,t){for(let a=0;a<s.length;a++)t.writeSFixed64(s[a])}const wx=3;function eD(s,t,a){t.glyphs=[],s===1&&a.readMessage(tD,t)}function tD(s,t,a){if(s===3){const{id:u,bitmap:d,width:_,height:v,left:S,top:E,advance:R}=a.readMessage(rD,{});t.glyphs.push({id:u,bitmap:new _f({width:_+2*wx,height:v+2*wx},d),metrics:{width:_,height:v,left:S,top:E,advance:R}})}else s===4?t.ascender=a.readSVarint():s===5&&(t.descender=a.readSVarint())}function rD(s,t,a){s===1?t.id=a.readVarint():s===2?t.bitmap=a.readBytes():s===3?t.width=a.readVarint():s===4?t.height=a.readVarint():s===5?t.left=a.readSVarint():s===6?t.top=a.readSVarint():s===7&&(t.advance=a.readVarint())}const SS=wx,ul={horizontal:1,vertical:2,horizontalOnly:3};class M0{constructor(){this.scale=1,this.fontStack="",this.image=null}static forText(t,a){const u=new M0;return u.scale=t||1,u.fontStack=a,u}static forImage(t){const a=new M0;return a.image=t,a}}class __{constructor(){this.text="",this.sectionIndex=[],this.sections=[],this.imageSectionID=null}static fromFeature(t,a,u){const d=new __;for(let _=0;_<t.sections.length;_++){const v=t.sections[_];v.image?d.addImageSection(v,u):d.addTextSection(v,a)}return d}length(){return this.text.length}getSection(t){return this.sections[this.sectionIndex[t]]}getSections(){return this.sections}getSectionIndex(t){return this.sectionIndex[t]}getCodePoint(t){return this.text.codePointAt(t)}verticalizePunctuation(t){this.text=(function(a,u){let d="";for(let _=0;_<a.length;_++){const v=a.charCodeAt(_+1)||null,S=a.charCodeAt(_-1)||null;d+=!u&&(v&&tf(v)&&!R0[a[_+1]]||S&&tf(S)&&!R0[a[_-1]])||!R0[a[_]]?a[_]:R0[a[_]]}return d})(this.text,t)}trim(){let t=0;for(let u=0;u<this.text.length&&S1[this.text.charCodeAt(u)];u++)t++;let a=this.text.length;for(let u=this.text.length-1;u>=0&&u>=t&&S1[this.text.charCodeAt(u)];u--)a--;this.text=this.text.substring(t,a),this.sectionIndex=this.sectionIndex.slice(t,a)}substring(t,a){const u=new __;return u.text=this.text.substring(t,a),u.sectionIndex=this.sectionIndex.slice(t,a),u.sections=this.sections,u}toString(){return this.text}getMaxScale(){return this.sectionIndex.reduce(((t,a)=>Math.max(t,this.sections[a].scale)),0)}addTextSection(t,a){this.text+=t.text,this.sections.push(M0.forText(t.scale,t.fontStack||a));const u=this.sections.length-1;for(let d=0;d<t.text.length;++d)this.sectionIndex.push(u)}addImageSection(t,a){const u=t.image?t.image.getPrimary():null;if(!u)return void ri("Can't add FormattedSection with an empty image.");u.scaleSelf(a);const d=this.getNextImageSectionCharCode();d?(this.text+=String.fromCodePoint(d),this.sections.push(M0.forImage(u)),this.sectionIndex.push(this.sections.length-1)):ri("Reached maximum number of images 6401")}getNextImageSectionCharCode(){return this.imageSectionID?this.imageSectionID>=63743?null:++this.imageSectionID:(this.imageSectionID=57344,this.imageSectionID)}}function Sx(s,t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q=1){const J=__.fromFeature(s,d,Q);B===ul.vertical&&J.verticalizePunctuation(F);let ee=[];const se=(function(De,Le,Fe,ut,Ue,dt){if(!De)return[];const St=[],gt=(function(vt,et,We,Dt,Et,dr){let Zt=0;for(let nr=0;nr<vt.length();nr++){const Nt=vt.getSection(nr);Zt+=TS(vt.getCodePoint(nr),Nt,Dt,Et,et,dr)}return Zt/Math.max(1,Math.ceil(Zt/We))})(De,Le,Fe,ut,Ue,dt),yt=De.text.indexOf("​")>=0;let Rt=0;for(let vt=0;vt<De.length();vt++){const et=De.getSection(vt),We=De.getCodePoint(vt);if(S1[We]||(Rt+=TS(We,et,ut,Ue,Le,dt)),vt<De.length()-1){const Dt=!((lt=We)<11904||!(_r["Bopomofo Extended"](lt)||_r.Bopomofo(lt)||_r["CJK Compatibility Forms"](lt)||_r["CJK Compatibility Ideographs"](lt)||_r["CJK Compatibility"](lt)||_r["CJK Radicals Supplement"](lt)||_r["CJK Strokes"](lt)||_r["CJK Symbols and Punctuation"](lt)||_r["CJK Unified Ideographs Extension A"](lt)||_r["CJK Unified Ideographs"](lt)||_r["Enclosed CJK Letters and Months"](lt)||_r["Halfwidth and Fullwidth Forms"](lt)||_r.Hiragana(lt)||_r["Ideographic Description Characters"](lt)||_r["Kangxi Radicals"](lt)||_r["Katakana Phonetic Extensions"](lt)||_r.Katakana(lt)||_r["Vertical Forms"](lt)||_r["Yi Radicals"](lt)||_r["Yi Syllables"](lt)));(iD[We]||Dt||et.image)&&St.push(ES(vt+1,Rt,gt,St,nD(We,De.getCodePoint(vt+1),Dt&&yt),!1))}}var lt;return CS(ES(De.length(),Rt,gt,St,0,!0))})(J,R,_,t,u,j),{processBidirectionalText:le,processStyledBidirectionalText:he}=tl;if(le&&J.sections.length===1){const De=le(J.toString(),se);for(const Le of De){const Fe=new __;Fe.text=Le,Fe.sections=J.sections;for(let ut=0;ut<Le.length;ut++)Fe.sectionIndex.push(0);ee.push(Fe)}}else if(he){const De=he(J.text,J.sectionIndex,se);for(const Le of De){const Fe=new __;Fe.text=Le[0],Fe.sectionIndex=Le[1],Fe.sections=J.sections,ee.push(Fe)}}else ee=(function(De,Le){const Fe=[],ut=De.text;let Ue=0;for(const dt of Le)Fe.push(De.substring(Ue,dt)),Ue=dt;return Ue<ut.length&&Fe.push(De.substring(Ue,ut.length)),Fe})(J,se);const Ee=[],Ce={positionedLines:Ee,text:J.toString(),top:P[1],bottom:P[1],left:P[0],right:P[0],writingMode:B,iconsInText:!1,verticalizable:!1,hasBaseline:!1};if((function(De,Le,Fe,ut,Ue,dt,St,gt,yt,Rt,lt,vt){let et=0,We=0,Dt=0;const Et=gt==="right"?1:gt==="left"?0:.5;let dr=!1;for(const Ht of Ue){const ar=Ht.getSections();for(const Sr of ar){if(Sr.image)continue;const Br=Le[Sr.fontStack];if(Br&&(dr=Br.ascender!==void 0&&Br.descender!==void 0,!dr))break}if(!dr)break}let Zt=0;for(const Ht of Ue){Ht.trim();const ar=Ht.getMaxScale(),Sr=(ar-1)*$o,Br={positionedGlyphs:[],lineOffset:0};De.positionedLines[Zt]=Br;const $r=Br.positionedGlyphs;let Vr=0;if(!Ht.length()){We+=dt,++Zt;continue}let er=0,zr=0;for(let de=0;de<Ht.length();de++){const pe=Ht.getSection(de),Ke=Ht.getSectionIndex(de),ct=Ht.getCodePoint(de);let Gt=pe.scale,jt=null,Kt=null,mr=null,Xr=$o,Zr=0,Hr=yt;Hr===ul.vertical&&((nr=ct)===12312||nr===12313||nr===12316||nr===12540||nr===12448)&&(Hr=ul.horizontal);const Bi=!(Hr===ul.horizontal||!lt&&!ef(ct)||lt&&(S1[ct]||Pg(ct)));if(pe.image){const mn=ut.get(pe.image.toString());if(!mn)continue;mr=pe.image,De.iconsInText=De.iconsInText||!0,Kt=mn.paddedRect;const jr=mn.displaySize;Gt=Gt*$o/vt,jt={width:jr[0],height:jr[1],left:0,top:-SS,advance:Bi?jr[1]:jr[0],localGlyph:!1},Zr=dr?-jt.height*Gt:ar*$o-17-jr[1]*Gt,Xr=jt.advance;const Ji=(Bi?jr[0]:jr[1])*Gt-$o*ar;Ji>0&&Ji>Vr&&(Vr=Ji)}else{const mn=Fe[pe.fontStack];if(!mn)continue;mn[ct]&&(Kt=mn[ct]);const jr=Le[pe.fontStack];if(!jr)continue;const Ji=jr.glyphs[ct];if(!Ji)continue;if(jt=Ji.metrics,Xr=ct!==8203?$o:0,dr){const ki=jr.ascender!==void 0?Math.abs(jr.ascender):0,Ai=jr.descender!==void 0?Math.abs(jr.descender):0,an=(ki+Ai)*Gt;er<an&&(er=an,zr=(ki-Ai)/2*Gt),Zr=-ki*Gt}else Zr=(ar-Gt)*$o-17}Bi?(De.verticalizable=!0,$r.push({glyph:ct,image:mr,x:et,y:We+Zr,vertical:Bi,scale:Gt,localGlyph:jt.localGlyph,fontStack:pe.fontStack,sectionIndex:Ke,metrics:jt,rect:Kt}),et+=Xr*Gt+Rt):($r.push({glyph:ct,image:mr,x:et,y:We+Zr,vertical:Bi,scale:Gt,localGlyph:jt.localGlyph,fontStack:pe.fontStack,sectionIndex:Ke,metrics:jt,rect:Kt}),et+=jt.advance*Gt+Rt)}$r.length!==0&&(Dt=Math.max(et-Rt,Dt),dr?IS($r,Et,Vr,zr,dt*ar/2):IS($r,Et,Vr,0,dt/2)),et=0;const ci=dt*ar+Vr;Br.lineOffset=Math.max(Vr,Sr),We+=ci,++Zt}var nr;const Nt=We,{horizontalAlign:ur,verticalAlign:Dr}=Tx(St);(function(Ht,ar,Sr,Br,$r,Vr){const er=(ar-Sr)*$r,zr=-Vr*Br;for(const ci of Ht)for(const de of ci.positionedGlyphs)de.x+=er,de.y+=zr})(De.positionedLines,Et,ur,Dr,Dt,Nt),De.top+=-Dr*Nt,De.bottom=De.top+Nt,De.left+=-ur*Dt,De.right=De.left+Dt,De.hasBaseline=dr})(Ce,t,a,u,ee,v,S,E,B,R,F,G),!(function(De){for(const Le of De)if(Le.positionedGlyphs.length!==0)return!1;return!0})(Ee))return Ce}const S1={9:!0,10:!0,11:!0,12:!0,13:!0,32:!0},iD={10:!0,32:!0,38:!0,40:!0,41:!0,43:!0,45:!0,47:!0,173:!0,183:!0,8203:!0,8208:!0,8211:!0,8231:!0};function TS(s,t,a,u,d,_){if(t.image){const v=u.get(t.image.toString());return v?v.displaySize[0]*t.scale*$o/_+d:0}{const v=a[t.fontStack],S=v&&v.glyphs[s];return S?S.metrics.advance*t.scale+d:0}}function AS(s,t,a,u){const d=Math.pow(s-t,2);return u?s<t?d/2:2*d:d+Math.abs(a)*a}function nD(s,t,a){let u=0;return s===10&&(u-=1e4),a&&(u+=150),s!==40&&s!==65288||(u+=50),t!==41&&t!==65289||(u+=50),u}function ES(s,t,a,u,d,_){let v=null,S=AS(t,a,d,_);for(const E of u){const R=AS(t-E.x,a,d,_)+E.badness;R<=S&&(v=E,S=R)}return{index:s,x:t,priorBreak:v,badness:S}}function CS(s){return s?CS(s.priorBreak).concat(s.index):[]}function Tx(s){let t=.5,a=.5;switch(s){case"right":case"top-right":case"bottom-right":t=1;break;case"left":case"top-left":case"bottom-left":t=0}switch(s){case"bottom":case"bottom-right":case"bottom-left":a=1;break;case"top":case"top-right":case"top-left":a=0}return{horizontalAlign:t,verticalAlign:a}}function IS(s,t,a,u,d){if(!(t||a||u||d))return;const _=s.length-1,v=s[_],S=(v.x+v.metrics.advance*v.scale)*t;for(let E=0;E<=_;E++)s[E].x-=S,s[E].y+=a+u+d}function RS(s){return s.imagePrimary!==void 0&&s.top!==void 0&&s.bottom!==void 0&&s.left!==void 0&&s.right!==void 0}function oD(s,t,a,u){const{horizontalAlign:d,verticalAlign:_}=Tx(u),v=a[0]-s.displaySize[0]*d,S=a[1]-s.displaySize[1]*_;return{imagePrimary:s,imageSecondary:t,top:S,bottom:S+s.displaySize[1],left:v,right:v+s.displaySize[0]}}function MS(s,t,a,u,d,_){const v=s.imagePrimary;let S;if(v.content){const J=v.content,ee=v.pixelRatio||1;S=[J[0]/ee,J[1]/ee,v.displaySize[0]-J[2]/ee,v.displaySize[1]-J[3]/ee]}const E=t.left*_,R=t.right*_;let P,B,F,j;a==="width"||a==="both"?(j=d[0]+E-u[3],B=d[0]+R+u[1]):(j=d[0]+(E+R-v.displaySize[0])/2,B=j+v.displaySize[0]);const G=t.top*_,Q=t.bottom*_;return a==="height"||a==="both"?(P=d[1]+G-u[0],F=d[1]+Q+u[2]):(P=d[1]+(G+Q-v.displaySize[1])/2,F=P+v.displaySize[1]),{imagePrimary:v,imageSecondary:void 0,top:P,right:B,bottom:F,left:j,collisionPadding:S}}function DS(s){return!s.imagePrimary.stretchX}function OS(s){return!s.imagePrimary.stretchY}function PS(s){return{width:s.right-s.left,height:s.bottom-s.top}}const xf=128;function LS(s,t,a){const{expression:u}=t;if(u.kind==="constant")return{kind:"constant",layoutSize:u.evaluate(new Hi(s+1,{worldview:a}))};if(u.kind==="source")return{kind:"source"};{const{zoomStops:d,interpolationType:_}=u;let v=0;for(;v<d.length&&d[v]<=s;)v++;v=Math.max(0,v-1);let S=v;for(;S<d.length&&d[S]<s+1;)S++;S=Math.min(d.length-1,S);const E=d[v],R=d[S];return u.kind==="composite"?{kind:"composite",minZoom:E,maxZoom:R,interpolationType:_}:{kind:"camera",minZoom:E,maxZoom:R,minSize:u.evaluate(new Hi(E,{worldview:a})),maxSize:u.evaluate(new Hi(R,{worldview:a})),interpolationType:_}}}function Ax(s,{uSize:t,uSizeT:a},{lowerSize:u,upperSize:d}){return s.kind==="source"?u/xf:s.kind==="composite"?xr(u/xf,d/xf,a):t}function D0(s,t,a=1){let u=0,d=0;if(s.kind==="constant")d=s.layoutSize*a;else if(s.kind!=="source"){const{interpolationType:_,minZoom:v,maxZoom:S}=s,E=_?Ie(ea.interpolationFactor(_,t,v,S),0,1):0;s.kind==="camera"?d=xr(s.minSize,s.maxSize,E)*a:u=E*a}return{uSizeT:u,uSize:d}}class Pd extends Tt{constructor(t,a,u,d,_){super(t,a),this.angle=d,this.z=u,_!==void 0&&(this.segment=_)}clone(){return new Pd(this.x,this.y,this.z,this.angle,this.segment)}}function BS(s,t,a,u,d){if(t.segment===void 0)return!0;let _=t,v=t.segment+1,S=0;for(;S>-a/2;){if(v--,v<0)return!1;S-=s[v].dist(_),_=s[v]}S+=s[v].dist(s[v+1]),v++;const E=[];let R=0;for(;S<a/2;){const P=s[v],B=s[v+1];if(!B)return!1;let F=s[v-1].angleTo(P)-P.angleTo(B);for(F=Math.abs((F+3*Math.PI)%(2*Math.PI)-Math.PI),E.push({distance:S,angleDelta:F}),R+=F;S-E[0].distance>u;)R-=E.shift().angleDelta;if(R>d)return!1;v++,S+=P.dist(B)}return!0}function zS(s){let t=0;for(let a=0;a<s.length-1;a++)t+=s[a].dist(s[a+1]);return t}function FS(s,t,a){return s?.6*t*a:0}function kS(s,t){return Math.max(s?s.right-s.left:0,t?t.right-t.left:0)}function aD(s,t,a,u,d,_){const v=FS(a,d,_),S=kS(a,u)*_;let E=0;const R=zS(s)/2;for(let P=0;P<s.length-1;P++){const B=s[P],F=s[P+1],j=B.dist(F);if(E+j>R){const G=(R-E)/j,Q=xr(B.x,F.x,G),J=xr(B.y,F.y,G),ee=new Pd(Q,J,0,F.angleTo(B),P);return!v||BS(s,ee,S,v,t)?ee:void 0}E+=j}}function sD(s,t,a,u,d,_,v,S,E){const R=FS(u,_,v),P=kS(u,d),B=P*v,F=s[0].x===0||s[0].x===E||s[0].y===0||s[0].y===E;return t-B<t/4&&(t=B+t/4),NS(s,F?t/2*S%t:(P/2+2*_)*v*S%t,t,R,a,B,F,!1,E)}function NS(s,t,a,u,d,_,v,S,E){const R=_/2,P=zS(s);let B=0,F=t-a,j=[];for(let G=0;G<s.length-1;G++){const Q=s[G],J=s[G+1],ee=Q.dist(J),se=J.angleTo(Q);for(;F+a<B+ee;){F+=a;const le=(F-B)/ee,he=xr(Q.x,J.x,le),Ee=xr(Q.y,J.y,le);if(he>=0&&he<E&&Ee>=0&&Ee<E&&F-R>=0&&F+R<=P){const Ce=new Pd(he,Ee,0,se,G);u&&!BS(s,Ce,_,u,d)||j.push(Ce)}}B+=ee}return S||j.length||v||(j=NS(s,B/2,a,u,d,_,v,!0,E)),j}function VS(s){let t=0,a=0;for(const v of s)t+=v.w*v.h,a=Math.max(a,v.w);s.sort(((v,S)=>S.h-v.h));const u=[{x:0,y:0,w:Math.max(Math.ceil(Math.sqrt(t/.95)),a),h:1/0}];let d=0,_=0;for(const v of s)for(let S=u.length-1;S>=0;S--){const E=u[S];if(!(v.w>E.w||v.h>E.h)){if(v.x=E.x,v.y=E.y,_=Math.max(_,v.y+v.h),d=Math.max(d,v.x+v.w),v.w===E.w&&v.h===E.h){const R=u.pop();R&&S<u.length&&(u[S]=R)}else v.h===E.h?(E.x+=v.w,E.w-=v.w):v.w===E.w?(E.y+=v.h,E.h-=v.h):(u.push({x:E.x+v.w,y:E.y,w:E.w-v.w,h:v.h}),E.y+=v.h,E.h-=v.h);break}}return{w:d,h:_,fill:t/(d*_)||0}}$t(Pd,"Anchor");const lg=1;class O0{static getImagePositionScale(t,a,u){if(a&&t&&t.options&&t.options.transform){const d=t.options.transform;return{x:d.a,y:d.d}}return{x:u,y:u}}constructor(t,a,u,d){this.paddedRect=t;const{pixelRatio:_,version:v,stretchX:S,stretchY:E,content:R,sdf:P,usvg:B}=a;this.pixelRatio=_,this.stretchX=S,this.stretchY=E,this.content=R,this.version=v,this.padding=u,this.sdf=P,this.usvg=B,this.scale=O0.getImagePositionScale(d,B,_)}get tl(){return[this.paddedRect.x+this.padding,this.paddedRect.y+this.padding]}get br(){return[this.paddedRect.x+this.paddedRect.w-this.padding,this.paddedRect.y+this.paddedRect.h-this.padding]}get displaySize(){return[(this.paddedRect.w-2*this.padding)/this.scale.x,(this.paddedRect.h-2*this.padding)/this.scale.y]}}function Ex(s,t,a){const u=Ss.parse(s),d=(function(_,v,S=[1,1]){return{x:0,y:0,w:(_.data?_.data.width:_.width*S[0])+2*v,h:(_.data?_.data.height:_.height*S[1])+2*v}})(t,a,[u.options.transform.a,u.options.transform.d]);return{bin:d,imagePosition:new O0(d,t,a,u),imageVariant:u}}class US{constructor(t,a,u){const d=new Map,_=new Map;this.haveRenderCallbacks=[];const v=[];this.addImages(t,d,lg,v),this.addImages(a,_,2,v);const{w:S,h:E}=VS(v),R=new Ho({width:S||1,height:E||1});for(const[P,B]of t.entries()){const F=d.get(P).paddedRect;Ho.copy(B.data,R,{x:0,y:0},{x:F.x+lg,y:F.y+lg},B.data,null,B.sdf)}for(const[P,B]of a.entries()){const F=_.get(P),j=F.paddedRect;let G=F.padding;const Q=j.x+G,J=j.y+G,ee=B.data.width,se=B.data.height;G=G>1?G-1:G,Ho.copy(B.data,R,{x:0,y:0},{x:Q,y:J},B.data,u),Ho.copy(B.data,R,{x:0,y:se-G},{x:Q,y:J-G},{width:ee,height:G},u),Ho.copy(B.data,R,{x:0,y:0},{x:Q,y:J+se},{width:ee,height:G},u),Ho.copy(B.data,R,{x:ee-G,y:0},{x:Q-G,y:J},{width:G,height:se},u),Ho.copy(B.data,R,{x:0,y:0},{x:Q+ee,y:J},{width:G,height:se},u),Ho.copy(B.data,R,{x:ee-G,y:se-G},{x:Q-G,y:J-G},{width:G,height:G},u),Ho.copy(B.data,R,{x:0,y:se-G},{x:Q+ee,y:J-G},{width:G,height:G},u),Ho.copy(B.data,R,{x:0,y:0},{x:Q+ee,y:J+se},{width:G,height:G},u),Ho.copy(B.data,R,{x:ee-G,y:0},{x:Q-G,y:J+se},{width:G,height:G},u)}this.lut=u,this.image=R,this.iconPositions=d,this.patternPositions=_}addImages(t,a,u,d){for(const[_,v]of t.entries()){const{bin:S,imagePosition:E,imageVariant:R}=Ex(_,v,u);a.set(_,E),d.push(S),v.hasRenderCallback&&this.haveRenderCallbacks.push(R.id)}}patchUpdatedImages(t,a,u){this.haveRenderCallbacks=this.haveRenderCallbacks.filter((d=>t.hasImage(d,u))),t.dispatchRenderCallbacks(this.haveRenderCallbacks,u);for(const d of t.getUpdatedImages(u)){for(const _ of this.iconPositions.keys()){const v=Ss.parse(_);if(rs.isEqual(v.id,d)){const S=t.getImage(d,u);this.patchUpdatedImage(this.iconPositions.get(_),S,a,null)}}for(const _ of this.patternPositions.keys()){const v=Ss.parse(_);if(rs.isEqual(v.id,d)){const S=t.getImage(d,u);this.patchUpdatedImage(this.patternPositions.get(_),S,a,this.lut)}}}}patchUpdatedImage(t,a,u,d=null){if(!t||!a||t.version===a.version)return;t.version=a.version;const[_,v]=t.tl,S=t.sdf;if(this.lut||S){const E={width:a.data.width,height:a.data.height},R=new Ho(E);Ho.copy(a.data,R,{x:0,y:0},{x:0,y:0},E,d,S),u.update(R,{position:{x:_,y:v}})}else u.update(a.data,{position:{x:_,y:v}})}}$t(O0,"ImagePosition"),$t(US,"ImageAtlas");const P0=1e20;function jS(s,t,a,u,d,_,v,S,E){for(let R=t;R<t+u;R++)GS(s,a*_+R,_,d,v,S,E);for(let R=a;R<a+d;R++)GS(s,R*_+t,1,u,v,S,E)}function GS(s,t,a,u,d,_,v){_[0]=0,v[0]=-P0,v[1]=P0,d[0]=s[t];for(let S=1,E=0,R=0;S<u;S++){d[S]=s[t+S*a];const P=S*S;do{const B=_[E];R=(d[S]-d[B]+P-B*B)/(S-B)/2}while(R<=v[E]&&--E>-1);E++,_[E]=S,v[E]=R,v[E+1]=P0}for(let S=0,E=0;S<u;S++){for(;v[E+1]<S;)E++;const R=_[E],P=S-R;s[t+S*a]=d[R]+P*P}}const _h=2,Cx={none:0,ideographs:1,all:2};class y_{constructor(t,a,u){this.requestManager=t,this.localGlyphMode=a,this.localFontFamily=u,this.url="",this.entries={},this.localGlyphs={200:{},400:{},500:{},900:{}}}setURL(t){this.url=t}getGlyphs(t,a){const u=[],d=this.url||Vo.GLYPHS_URL;for(const _ in t)for(const v of t[_])u.push({stack:_,id:v});Je(u,(({stack:_,id:v},S)=>{let E=this.entries[_];E||(E=this.entries[_]={glyphs:{},requests:{},ranges:{},ascender:void 0,descender:void 0});let R=E.glyphs[v];if(R!==void 0)return void S(null,{stack:_,id:v,glyph:R});if(R=this._tinySDF(E,_,v),R)return E.glyphs[v]=R,void S(null,{stack:_,id:v,glyph:R});const P=Math.floor(v/256);if(256*P>65535)return ri("glyphs > 65535 not supported"),void S(null,{stack:_,id:v,glyph:R});if(E.ranges[P])return void S(null,{stack:_,id:v,glyph:R});let B=E.requests[P];B||(B=E.requests[P]=[],y_.loadGlyphRange(_,P,d,this.requestManager,((F,j)=>{if(j){E.ascender=j.ascender,E.descender=j.descender;for(const G in j.glyphs)this._doesCharSupportLocalGlyph(+G)||(E.glyphs[+G]=j.glyphs[+G]);E.ranges[P]=!0}for(const G of B)G(F,j);delete E.requests[P]}))),B.push(((F,j)=>{F?S(F):j&&S(null,{stack:_,id:v,glyph:j.glyphs[v]||null})}))}),((_,v)=>{if(_)a(_);else if(v){const S={};for(const{stack:E,id:R,glyph:P}of v)S[E]===void 0&&(S[E]={}),S[E].glyphs===void 0&&(S[E].glyphs={}),S[E].glyphs[R]=P&&{id:P.id,bitmap:P.bitmap.clone(),metrics:P.metrics},S[E].ascender=this.entries[E].ascender,S[E].descender=this.entries[E].descender;a(null,S)}}))}_doesCharSupportLocalGlyph(t){return this.localGlyphMode!==Cx.none&&(this.localGlyphMode===Cx.all?!!this.localFontFamily:!!this.localFontFamily&&(_r["CJK Unified Ideographs"](t)||_r["Hangul Syllables"](t)||_r.Hiragana(t)||_r.Katakana(t)||_r["CJK Symbols and Punctuation"](t)||_r["CJK Unified Ideographs Extension A"](t)||_r["CJK Unified Ideographs Extension B"](t)||_r.Osage(t)))}_tinySDF(t,a,u){const d=this.localFontFamily;if(!d||!this._doesCharSupportLocalGlyph(u))return;let _=t.tinySDF;if(!_){let Q="400";/bold/i.test(a)?Q="900":/medium/i.test(a)?Q="500":/light/i.test(a)&&(Q="200"),_=t.tinySDF=new y_.TinySDF({fontFamily:d,fontWeight:Q,fontSize:24*_h,buffer:3*_h,radius:8*_h}),_.fontWeight=Q}if(this.localGlyphs[_.fontWeight][u])return this.localGlyphs[_.fontWeight][u];const v=String.fromCodePoint(u),{data:S,width:E,height:R,glyphWidth:P,glyphHeight:B,glyphLeft:F,glyphTop:j,glyphAdvance:G}=_.draw(v);return this.localGlyphs[_.fontWeight][u]={id:u,bitmap:new _f({width:E,height:R},S),metrics:{width:P/_h,height:B/_h,left:F/_h,top:j/_h-27,advance:G/_h,localGlyph:!0}}}}y_.loadGlyphRange=function(s,t,a,u,d){const _=256*t,v=_+255,S=u.transformRequest(u.normalizeGlyphsURL(a).replace("{fontstack}",s).replace("{range}",`${_}-${v}`),Nf.Glyphs);yl(S,((E,R)=>{if(E)d(E);else if(R){const P={},B=(function(F){return new w1(F).readFields(eD,{})})(R);for(const F of B.glyphs)P[F.id]=F;d(null,{glyphs:P,ascender:B.ascender,descender:B.descender})}}))},y_.TinySDF=class{constructor({fontSize:s=24,buffer:t=3,radius:a=8,cutoff:u=.25,fontFamily:d="sans-serif",fontWeight:_="normal",fontStyle:v="normal",lang:S=null}={}){this.buffer=t,this.cutoff=u,this.radius=a,this.lang=S;const E=this.size=s+4*t,R=this._createCanvas(E),P=this.ctx=R.getContext("2d",{willReadFrequently:!0});P.font=`${v} ${_} ${s}px ${d}`,P.textBaseline="alphabetic",P.textAlign="left",P.fillStyle="black",this.gridOuter=new Float64Array(E*E),this.gridInner=new Float64Array(E*E),this.f=new Float64Array(E),this.z=new Float64Array(E+1),this.v=new Uint16Array(E)}_createCanvas(s){const t=document.createElement("canvas");return t.width=t.height=s,t}draw(s){const{width:t,actualBoundingBoxAscent:a,actualBoundingBoxDescent:u,actualBoundingBoxLeft:d,actualBoundingBoxRight:_}=this.ctx.measureText(s),v=Math.ceil(a),S=Math.max(0,Math.min(this.size-this.buffer,Math.ceil(_-d))),E=Math.min(this.size-this.buffer,v+Math.ceil(u)),R=S+2*this.buffer,P=E+2*this.buffer,B=Math.max(R*P,0),F=new Uint8ClampedArray(B),j={data:F,width:R,height:P,glyphWidth:S,glyphHeight:E,glyphTop:v,glyphLeft:0,glyphAdvance:t};if(S===0||E===0)return j;const{ctx:G,buffer:Q,gridInner:J,gridOuter:ee}=this;this.lang&&(G.lang=this.lang),G.clearRect(Q,Q,S,E),G.fillText(s,Q,Q+v);const se=G.getImageData(Q,Q,S,E);ee.fill(P0,0,B),J.fill(0,0,B);for(let le=0;le<E;le++)for(let he=0;he<S;he++){const Ee=se.data[4*(le*S+he)+3]/255;if(Ee===0)continue;const Ce=(le+Q)*R+he+Q;if(Ee===1)ee[Ce]=0,J[Ce]=P0;else{const De=.5-Ee;ee[Ce]=De>0?De*De:0,J[Ce]=De<0?De*De:0}}jS(ee,0,0,R,P,R,this.f,this.v,this.z),jS(J,Q,Q,S,E,R,this.f,this.v,this.z);for(let le=0;le<B;le++){const he=Math.sqrt(ee[le])-Math.sqrt(J[le]);F[le]=Math.round(255-255*(he/this.radius+this.cutoff))}return j}};const Yp=lg;function HS(s,t){return s+t[1]-t[0]}function qS(s,t,a,u,d=1){const _=[],v=s.imagePrimary,S=v.pixelRatio,E=v.paddedRect.w-2*Yp,R=v.paddedRect.h-2*Yp,P=(s.right-s.left)*d,B=(s.bottom-s.top)*d,F=v.stretchX||[[0,E]],j=v.stretchY||[[0,R]],G=F.reduce(HS,0),Q=j.reduce(HS,0),J=E-G,ee=R-Q;let se=0,le=G,he=0,Ee=Q,Ce=0,De=J,Le=0,Fe=ee;if(v.content&&u){const Ue=v.content;se=T1(F,0,Ue[0]),he=T1(j,0,Ue[1]),le=T1(F,Ue[0],Ue[2]),Ee=T1(j,Ue[1],Ue[3]),Ce=Ue[0]-se,Le=Ue[1]-he,De=Ue[2]-Ue[0]-le,Fe=Ue[3]-Ue[1]-Ee}const ut=(Ue,dt,St,gt)=>{const yt=A1(Ue.stretch-se,le,P,s.left*d),Rt=E1(Ue.fixed-Ce,De,Ue.stretch,G),lt=A1(dt.stretch-he,Ee,B,s.top*d),vt=E1(dt.fixed-Le,Fe,dt.stretch,Q),et=A1(St.stretch-se,le,P,s.left*d),We=E1(St.fixed-Ce,De,St.stretch,G),Dt=A1(gt.stretch-he,Ee,B,s.top*d),Et=E1(gt.fixed-Le,Fe,gt.stretch,Q),dr=new Tt(yt,lt),Zt=new Tt(et,lt),nr=new Tt(et,Dt),Nt=new Tt(yt,Dt),ur=new Tt(Rt/S,vt/S),Dr=new Tt(We/S,Et/S),Ht=t*Math.PI/180;if(Ht){const er=Math.sin(Ht),zr=Math.cos(Ht),ci=[zr,-er,er,zr];dr._matMult(ci),Zt._matMult(ci),Nt._matMult(ci),nr._matMult(ci)}const ar=Ue.stretch+Ue.fixed,Sr=St.stretch+St.fixed,Br=dt.stretch+dt.fixed,$r=gt.stretch+gt.fixed,Vr=s.imageSecondary;return{tl:dr,tr:Zt,bl:Nt,br:nr,texPrimary:{x:v.paddedRect.x+Yp+ar,y:v.paddedRect.y+Yp+Br,w:Sr-ar,h:$r-Br},texSecondary:Vr?{x:Vr.paddedRect.x+Yp+ar,y:Vr.paddedRect.y+Yp+Br,w:Sr-ar,h:$r-Br}:void 0,writingMode:void 0,glyphOffset:[0,0],sectionIndex:0,pixelOffsetTL:ur,pixelOffsetBR:Dr,minFontScaleX:De/S/P,minFontScaleY:Fe/S/B,isSDF:a}};if(u&&(v.stretchX||v.stretchY)){const Ue=$S(F,J,G),dt=$S(j,ee,Q);for(let St=0;St<Ue.length-1;St++){const gt=Ue[St],yt=Ue[St+1];for(let Rt=0;Rt<dt.length-1;Rt++)_.push(ut(gt,dt[Rt],yt,dt[Rt+1]))}}else _.push(ut({fixed:0,stretch:-1},{fixed:0,stretch:-1},{fixed:0,stretch:E+1},{fixed:0,stretch:R+1}));return _}function T1(s,t,a){let u=0;for(const d of s)u+=Math.max(t,Math.min(a,d[1]))-Math.max(t,Math.min(a,d[0]));return u}function $S(s,t,a){const u=[{fixed:-Yp,stretch:0}];for(const[d,_]of s){const v=u[u.length-1];u.push({fixed:d-v.stretch,stretch:v.stretch}),u.push({fixed:d-v.stretch,stretch:v.stretch+(_-d)})}return u.push({fixed:t+Yp,stretch:a}),u}function A1(s,t,a,u){return s/t*a+u}function E1(s,t,a,u){return s-t*a/u}function lD(s,t,a,u){const d=t+s.positionedLines[u].lineOffset;return u===0?a+d/2:a+(d+(t+s.positionedLines[u-1].lineOffset))/2}function cD(s,t=1,a=!1){let u=1/0,d=1/0,_=-1/0,v=-1/0;const S=s[0];for(let j=0;j<S.length;j++){const G=S[j];(!j||G.x<u)&&(u=G.x),(!j||G.y<d)&&(d=G.y),(!j||G.x>_)&&(_=G.x),(!j||G.y>v)&&(v=G.y)}const E=Math.min(_-u,v-d);let R=E/2;const P=new uc([],uD);if(E===0)return new Tt(u,d);for(let j=u;j<_;j+=E)for(let G=d;G<v;G+=E)P.push(new v_(j+R,G+R,R,s));let B=(function(j){let G=0,Q=0,J=0;const ee=j[0];for(let se=0,le=ee.length,he=le-1;se<le;he=se++){const Ee=ee[se],Ce=ee[he],De=Ee.x*Ce.y-Ce.x*Ee.y;Q+=(Ee.x+Ce.x)*De,J+=(Ee.y+Ce.y)*De,G+=3*De}return new v_(Q/G,J/G,0,j)})(s),F=P.length;for(;P.length;){const j=P.pop();(j.d>B.d||!B.d)&&(B=j,a&&console.log("found best %d after %d probes",Math.round(1e4*j.d)/1e4,F)),j.max-B.d<=t||(R=j.h/2,P.push(new v_(j.p.x-R,j.p.y-R,R,s)),P.push(new v_(j.p.x+R,j.p.y-R,R,s)),P.push(new v_(j.p.x-R,j.p.y+R,R,s)),P.push(new v_(j.p.x+R,j.p.y+R,R,s)),F+=4)}return a&&(console.log(`num probes: ${F}`),console.log(`best distance: ${B.d}`)),B.p}function uD(s,t){return t.max-s.max}class v_{constructor(t,a,u,d){this.p=new Tt(t,a),this.h=u,this.d=(function(_,v){let S=!1,E=1/0;for(let R=0;R<v.length;R++){const P=v[R];for(let B=0,F=P.length,j=F-1;B<F;j=B++){const G=P[B],Q=P[j];G.y>_.y!=Q.y>_.y&&_.x<(Q.x-G.x)*(_.y-G.y)/(Q.y-G.y)+G.x&&(S=!S),E=Math.min(E,rn(_,G,Q))}}return(S?1:-1)*Math.sqrt(E)})(this.p,d),this.max=this.d+this.h*Math.SQRT2}}const hD=Object.keys,Ix=Number.POSITIVE_INFINITY,fD=Math.sqrt(2);function XS(s,[t,a]){let u=0,d=0;if(a===Ix){t<0&&(t=0);const _=t/fD;switch(s){case"top-right":case"top-left":d=_-7;break;case"bottom-right":case"bottom-left":d=7-_;break;case"bottom":d=7-t;break;case"top":d=t-7}switch(s){case"top-right":case"bottom-right":u=-_;break;case"top-left":case"bottom-left":u=_;break;case"left":u=t;break;case"right":u=-t}}else{switch(t=Math.abs(t),a=Math.abs(a),s){case"top-right":case"top-left":case"top":d=a-7;break;case"bottom-right":case"bottom-left":case"bottom":d=7-a}switch(s){case"top-right":case"bottom-right":case"right":u=-t;break;case"top-left":case"bottom-left":case"left":u=t}}return[u,d]}function C1(s,t,a,u,d,_,v,S,E){if(!t||!t.usvg)return;const R=PS(u),P=PS(d),B=_!=="both"&&_!=="width"||!DS(u)?1:P.width/R.width,F=_!=="both"&&_!=="height"||!OS(u)?1:P.height/R.height;a.scaleSelf(B,F);const j=a.toString();v.set(j,a),S.set(j,t);const{imagePosition:G}=Ex(j,t,lg);E.set(j,G)}function ZS(s,t,a,u,d,_,v,S,E){if(!s)return;const R=(function(P,B,F,j,G,Q){if(P.kind==="camera")return P.maxSize;if(P.kind==="composite"){const J=B.possiblyEvaluate(new Hi(P.maxZoom,{worldview:Q}),F).evaluate(G,{},F),ee=B.possiblyEvaluate(new Hi(P.minZoom,{worldview:Q}),F).evaluate(G,{},F);return Math.max(J,ee)}return B.possiblyEvaluate(new Hi(j,{worldview:Q})).evaluate(G,{},F)})(t,a,u,d,_,E);return s.scaleSelf(R*S*v)}function WS(s,t,a,u,d,_,v,S,E){return{iconPrimary:ZS(s.getPrimary(),t,a,u,d,_,v,S,E),iconSecondary:ZS(s.getSecondary(),t,a,u,d,_,v,S,E)}}function dD(s,t,a){if(!t)return;const u=a.get(s.toString()),d=a.get(t.toString());u&&d&&(u.paddedRect.w===d.paddedRect.w&&u.paddedRect.h===d.paddedRect.h||ri(`Mismatch in icon variant sizes: ${s.toString()} and ${t.toString()}`),u.usvg!==d.usvg&&ri(`Mismatch in icon variant image types: ${s.id} and ${t.id}`))}function YS(s,t,a,u){if(!s)return;const d=t.get(a.toString());if(s.imagePrimary=d,u){const _=t.get(u.toString());s.imageSecondary=_}}function pD(s,t){for(const a in s.horizontal)QS(s.horizontal[a],t);QS(s.vertical,t)}function QS(s,t){if(s){for(const a of s.positionedLines)for(const u of a.positionedGlyphs)if(u.image!==null){const d=u.image.toString();u.rect=t.get(d).paddedRect}}}function Rx(s){switch(s){case"right":case"top-right":case"bottom-right":return"right";case"left":case"top-left":case"bottom-left":return"left"}return"center"}function mD(s,t,a,u,d,_,v,S,E){const R=Mx(_.horizontal)||_.vertical,P=a.get("icon-text-fit-padding").evaluate(u,{},d);let B,F=t;return t&&E!=="none"&&(s.allowVerticalPlacement&&_.vertical&&(B=MS(t,_.vertical,E,P,S,v)),R&&(F=MS(t,R,E,P,S,v))),{defaultShapedIcon:F,verticallyShapedIcon:B}}function gD(s,t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee,se,le){let he=v.textMaxSize.evaluate(t,{},F);he===void 0?he=S*v.textScaleFactor:he*=v.textScaleFactor;const Ee=s.layers[0].layout,Ce=Mx(a.horizontal)||a.vertical,De=j.name==="globe",Le=$o,Fe=s.tilePixelRatio*he/Le,ut=(Rt=s.overscaling,s.zoom>18&&Rt>2&&(Rt>>=1),Math.max(Bt/(512*Rt),1)*Ee.get("symbol-spacing")),Ue=Ee.get("text-padding")*s.tilePixelRatio,dt=Ee.get("icon-padding")*s.tilePixelRatio,St=Ne(Ee.get("text-max-angle")),gt=Ee.get("icon-rotation-alignment")==="map"&&le!=="point",yt=ut/2;var Rt;s.hasAnyIconTextFit===!1&&J!=="none"&&(s.hasAnyIconTextFit=!0);const lt=t.properties?+t.properties[Or]:null,vt=lt&&s.elevationFeatureIdToIndex?s.elevationFeatureIdToIndex.get(lt):65535,et=(We,Dt,Et)=>{if(Dt.x<0||Dt.x>=Bt||Dt.y<0||Dt.y>=Bt)return;let dr=null;if(De){const{x:Zt,y:nr,z:Nt}=j.projectTilePoint(Dt.x,Dt.y,Et);dr={anchor:new Pd(Zt,nr,Nt,0,void 0),up:j.upVector(Et,Dt.x,Dt.y)}}(function(Zt,nr,Nt,ur,Dr,Ht,ar,Sr,Br,$r,Vr,er,zr,ci,de,pe,Ke,ct,Gt,jt,Kt,mr,Xr,Zr,Hr,Bi,mn,jr,Ji){const ki=Zt.addToLineVertexArray(nr,ur);let Ai,an,sn,Qi,en,Ni,Wr,ji=0,Sn=0,Ar=0,pi=0,ln=-1,Mn=-1;const dn={};let go=Dh("");const qi=Nt?Nt.anchor:nr,uo=jr!=="none";let ks=0,pa=0;if(Br._unevaluatedLayout.getValue("text-radial-offset")===void 0){const _o=Br.layout.get("text-offset").evaluate(Kt,{},Hr);ks=_o[0]*$o,pa=_o[1]*$o}else ks=Br.layout.get("text-radial-offset").evaluate(Kt,{},Hr)*$o,pa=Ix;if(Zt.allowVerticalPlacement&&Dr.vertical){const _o=Dr.vertical;if(de)Ni=Dx(_o),Sr&&(Wr=Dx(Sr));else{const Eo=Br.layout.get("text-rotate").evaluate(Kt,{},Hr)+90;sn=I1($r,qi,nr,Vr,er,zr,_o,ci,Eo,pe),Sr&&(Qi=I1($r,qi,nr,Vr,er,zr,Sr,ct,Eo))}}if(Ht){const _o=Zt.iconSizeData,Eo=Br.layout.get("icon-rotate").evaluate(Kt,{},Hr),ma=qS(Ht,Eo,Xr,uo,mr.iconScaleFactor),Wa=Sr?qS(Sr,Eo,Xr,uo,mr.iconScaleFactor):void 0;an=I1($r,qi,nr,Vr,er,zr,Ht,ct,Eo,null),ji=4*ma.length;let Oa=null;_o.kind==="source"?(Oa=[xf*Br.layout.get("icon-size").evaluate(Kt,{},Hr)*mr.iconScaleFactor],Oa[0]>Qp&&ri(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${L0}. Reduce your "icon-size".`)):_o.kind==="composite"&&(Oa=[xf*mr.compositeIconSizes[0].evaluate(Kt,{},Hr)*mr.iconScaleFactor,xf*mr.compositeIconSizes[1].evaluate(Kt,{},Hr)*mr.iconScaleFactor],(Oa[0]>Qp||Oa[1]>Qp)&&ri(`${Zt.layerIds[0]}: Value for "icon-size" is >= ${L0}. Reduce your "icon-size".`)),Zt.addSymbols(Zt.icon,ma,Oa,jt,Gt,Kt,void 0,Nt,nr,ki.lineStartIndex,ki.lineLength,-1,Zr,Hr,Bi,mn),ln=Zt.icon.placedSymbolArray.length-1,Wa&&(Sn=4*Wa.length,Zt.addSymbols(Zt.icon,Wa,Oa,jt,Gt,Kt,ul.vertical,Nt,nr,ki.lineStartIndex,ki.lineLength,-1,Zr,Hr,Bi,mn),Mn=Zt.icon.placedSymbolArray.length-1)}for(const _o in Dr.horizontal){const Eo=_o,ma=Dr.horizontal[Eo];Ai||(go=Dh(ma.text),de?en=Dx(ma):Ai=I1($r,qi,nr,Vr,er,zr,ma,ci,Br.layout.get("text-rotate").evaluate(Kt,{},Hr),pe));const Wa=ma.positionedLines.length===1;if(Ar+=KS(Zt,Nt,nr,ma,ar,Br,de,Kt,pe,ki,Dr.vertical?ul.horizontal:ul.horizontalOnly,Wa?hD(Dr.horizontal):[Eo],dn,ln,mr,Zr,Hr,Bi),Wa)break}Dr.vertical&&(pi+=KS(Zt,Nt,nr,Dr.vertical,ar,Br,de,Kt,pe,ki,ul.vertical,["vertical"],dn,Mn,mr,Zr,Hr,Bi));let ra=-1;const Ns=(_o,Eo)=>_o?Math.max(_o,Eo):Eo;ra=Ns(en,ra),ra=Ns(Ni,ra),ra=Ns(Wr,ra);const bf=ra>-1?1:0;Zt.glyphOffsetArray.length>=65535&&ri("Too many glyphs being rendered in a tile. See https://github.com/mapbox/mapbox-gl-js/issues/2907"),Kt.sortKey!==void 0&&Zt.addToSortKeyRanges(Zt.symbolInstances.length,Kt.sortKey),Zt.symbolInstances.emplaceBack(nr.x,nr.y,qi.x,qi.y,qi.z,dn.right>=0?dn.right:-1,dn.center>=0?dn.center:-1,dn.left>=0?dn.left:-1,dn.vertical>=0?dn.vertical:-1,ln,Mn,go,Ai!==void 0?Ai:Zt.collisionBoxArray.length,Ai!==void 0?Ai+1:Zt.collisionBoxArray.length,sn!==void 0?sn:Zt.collisionBoxArray.length,sn!==void 0?sn+1:Zt.collisionBoxArray.length,an!==void 0?an:Zt.collisionBoxArray.length,an!==void 0?an+1:Zt.collisionBoxArray.length,Qi||Zt.collisionBoxArray.length,Qi?Qi+1:Zt.collisionBoxArray.length,Vr,Ar,pi,ji,Sn,bf,0,ks,pa,ra,0,uo?1:0,Ji)})(s,Dt,dr,We,a,u,_,d,s.layers[0],s.collisionBoxArray,t.index,t.sourceLayerIndex,s.index,Ue,se,R,0,dt,gt,ee,t,v,P,B,F,G,Q,J,vt)};if(le==="line")for(const We of N(t.geometry,0,0,Bt,Bt)){const Dt=sD(We,ut,St,a.vertical||Ce,u,Le,Fe,s.overscaling,Bt);for(const Et of Dt)Ce&&_D(s,Ce.text,yt,Et)||et(We,Et,F)}else if(le==="line-center"){for(const We of t.geometry)if(We.length>1){const Dt=aD(We,St,a.vertical||Ce,u,Le,Fe);Dt&&et(We,Dt,F)}}else if(t.type==="Polygon")for(const We of Za(t.geometry,0)){const Dt=cD(We,16);et(We[0],new Pd(Dt.x,Dt.y,0,0,void 0),F)}else if(t.type==="LineString")for(const We of t.geometry)et(We,new Pd(We[0].x,We[0].y,0,0,void 0),F);else if(t.type==="Point")for(const We of t.geometry)for(const Dt of We)et([Dt],new Pd(Dt.x,Dt.y,0,0,void 0),F)}const L0=255,Qp=L0*xf;function KS(s,t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J,ee){const se=(function(Ee,Ce,De,Le,Fe,ut,Ue,dt){const St=[];if(Ce.positionedLines.length===0)return St;const gt=Le.layout.get("text-rotate").evaluate(ut,{})*Math.PI/180,yt=(function(We){const Dt=We[0],Et=We[1],dr=Dt*Et;return dr>0?[Dt,-Et]:dr<0?[-Dt,Et]:Dt===0?[Et,Dt]:[Et,-Dt]})(De);let Rt=Math.abs(Ce.top-Ce.bottom);for(const We of Ce.positionedLines)Rt-=We.lineOffset;const lt=Ce.positionedLines.length,vt=Rt/lt;let et=Ce.top-De[1];for(let We=0;We<lt;++We){const Dt=Ce.positionedLines[We];et=lD(Ce,vt,et,We);for(const Et of Dt.positionedGlyphs){if(!Et.rect)continue;const dr=Et.rect||{};let Zt=SS+1,nr=!0,Nt=1,ur=0;if(Et.image){const Kt=Ue.get(Et.image.toString());if(!Kt)continue;if(Kt.sdf){ri("SDF images are not supported in formatted text and will be ignored.");continue}nr=!1,Nt=Kt.pixelRatio,Zt=lg/Nt}const Dr=(Fe||dt)&&Et.vertical,Ht=Et.metrics.advance*Et.scale/2,ar=Et.metrics,Sr=Et.rect;if(Sr===null)continue;dt&&Ce.verticalizable&&(ur=Et.image?Ht-Et.metrics.width*Et.scale/2:0);const Br=Fe?[Et.x+Ht,Et.y]:[0,0];let $r=[0,0],Vr=[0,0],er=!1;Fe||(Dr?(Vr=[Et.x+Ht+yt[0],Et.y+yt[1]-ur],er=!0):$r=[Et.x+Ht+De[0],Et.y+De[1]-ur]);const zr=Sr.w*Et.scale/(Nt*(Et.localGlyph?_h:1)),ci=Sr.h*Et.scale/(Nt*(Et.localGlyph?_h:1));let de,pe,Ke,ct;if(Dr){const Kt=Et.y-et,mr=new Tt(-Ht,Ht-Kt),Xr=-Math.PI/2,Zr=new Tt(...Vr);de=new Tt(-Ht+$r[0],$r[1]),de._rotateAround(Xr,mr)._add(Zr),de.x+=-Kt+Ht,de.y-=(ar.left-Zt)*Et.scale;const Hr=Et.image?ar.advance*Et.scale:$o*Et.scale,Bi=String.fromCodePoint(Et.glyph);GM(Bi)?de.x+=(1-Zt)*Et.scale:HM(Bi)?de.x+=Hr-ar.height*Et.scale+(-Zt-1)*Et.scale:de.x+=Et.image||ar.width+2*Zt===Sr.w&&ar.height+2*Zt===Sr.h?(Hr-ci)/2:(Hr-(ar.height+2*Zt)*Et.scale)/2,pe=new Tt(de.x,de.y-zr),Ke=new Tt(de.x+ci,de.y),ct=new Tt(de.x+ci,de.y-zr)}else{const Kt=(ar.left-Zt)*Et.scale-Ht+$r[0],mr=(-ar.top-Zt)*Et.scale+$r[1],Xr=Kt+zr,Zr=mr+ci;de=new Tt(Kt,mr),pe=new Tt(Xr,mr),Ke=new Tt(Kt,Zr),ct=new Tt(Xr,Zr)}if(gt){let Kt;Kt=Fe?new Tt(0,0):er?new Tt(yt[0],yt[1]):new Tt(De[0],De[1]),de._rotateAround(gt,Kt),pe._rotateAround(gt,Kt),Ke._rotateAround(gt,Kt),ct._rotateAround(gt,Kt)}const Gt=new Tt(0,0),jt=new Tt(0,0);St.push({tl:de,tr:pe,bl:Ke,br:ct,texPrimary:dr,texSecondary:void 0,writingMode:Ce.writingMode,glyphOffset:Br,sectionIndex:Et.sectionIndex,isSDF:nr,pixelOffsetTL:Gt,pixelOffsetBR:jt,minFontScaleX:0,minFontScaleY:0})}}return St})(0,u,E,_,v,S,d,s.allowVerticalPlacement),le=s.textSizeData;let he=null;le.kind==="source"?(he=[xf*_.layout.get("text-size").evaluate(S,{},J)*G.textScaleFactor],he[0]>Qp&&ri(`${s.layerIds[0]}: Value for "text-size" is >= ${L0}. Reduce your "text-size".`)):le.kind==="composite"&&(he=[xf*G.compositeTextSizes[0].evaluate(S,{},J)*G.textScaleFactor,xf*G.compositeTextSizes[1].evaluate(S,{},J)*G.textScaleFactor],(he[0]>Qp||he[1]>Qp)&&ri(`${s.layerIds[0]}: Value for "text-size" is >= ${L0}. Reduce your "text-size".`)),s.addSymbols(s.text,se,he,E,v,S,P,t,a,R.lineStartIndex,R.lineLength,j,Q,J,ee,!1);for(const Ee of B)F[Ee]=s.text.placedSymbolArray.length-1;return 4*se.length}function Mx(s){for(const t in s)return s[t];return null}function I1(s,t,a,u,d,_,v,S,E,R){let P=v.top,B=v.bottom,F=v.left,j=v.right;if(RS(v)&&v.collisionPadding){const G=v.collisionPadding;F-=G[0],P-=G[1],j+=G[2],B+=G[3]}if(E){const G=new Tt(F,P),Q=new Tt(j,P),J=new Tt(F,B),ee=new Tt(j,B),se=Ne(E);let le=new Tt(0,0);R&&(le=new Tt(R[0],R[1])),G._rotateAround(se,le),Q._rotateAround(se,le),J._rotateAround(se,le),ee._rotateAround(se,le),F=Math.min(G.x,Q.x,J.x,ee.x),j=Math.max(G.x,Q.x,J.x,ee.x),P=Math.min(G.y,Q.y,J.y,ee.y),B=Math.max(G.y,Q.y,J.y,ee.y)}return s.emplaceBack(t.x,t.y,t.z,a.x,a.y,F,P,j,B,S,u,d,_),s.length-1}function Dx(s){RS(s)&&s.collisionPadding&&(s.top-=s.collisionPadding[1],s.bottom+=s.collisionPadding[3]);const t=s.bottom-s.top;return t>0?Math.max(10,t):null}function _D(s,t,a,u){const d=s.compareText;if(t in d){const _=d[t];for(let v=_.length-1;v>=0;v--)if(u.dist(_[v])<a)return!0}else d[t]=[];return d[t].push(u),!1}function JS(s,t){const a=s.fovAboveCenter,u=s.elevation?s.elevation.getMinElevationBelowMSL()*t:0,d=(s._camera.position[2]*s.worldSize-u)/Math.cos(s._pitch),_=Math.sin(a)*d/Math.sin(Math.max(Math.PI/2-s._pitch-a,.01));let v=Math.sin(s._pitch)*_+d;const S=d*(1/s._horizonShift);if(!s.elevation||s.elevation.exaggeration()===0){let E=Math.max(s.zoom-17,0);s.isOrthographic&&(E/=10),v*=1+E}return Math.min(1.01*v,S)}function B0(s,t){if(!t.isReprojectedInTileSpace)return{scale:1<<s.z,x:s.x,y:s.y,x2:s.x+1,y2:s.y+1,projection:t};const a=Math.pow(2,-s.z),u=s.x*a,d=(s.x+1)*a,_=s.y*a,v=(s.y+1)*a,S=Te(u),E=Te(d),R=ye(_),P=ye(v),B=t.project(S,R),F=t.project(E,R),j=t.project(E,P),G=t.project(S,P);let Q=Math.min(B.x,F.x,j.x,G.x),J=Math.min(B.y,F.y,j.y,G.y),ee=Math.max(B.x,F.x,j.x,G.x),se=Math.max(B.y,F.y,j.y,G.y);const le=a/16;function he(Ce,De,Le,Fe,ut,Ue){const dt=(Le+ut)/2,St=(Fe+Ue)/2,gt=t.project(Te(dt),ye(St)),yt=Math.max(0,Q-gt.x,J-gt.y,gt.x-ee,gt.y-se);Q=Math.min(Q,gt.x),ee=Math.max(ee,gt.x),J=Math.min(J,gt.y),se=Math.max(se,gt.y),yt>le&&(he(Ce,gt,Le,Fe,dt,St),he(gt,De,dt,St,ut,Ue))}he(B,F,u,_,d,_),he(F,j,d,_,d,v),he(j,G,d,v,u,v),he(G,B,u,v,u,_),Q-=le,J-=le,ee+=le,se+=le;const Ee=1/Math.max(ee-Q,se-J);return{scale:Ee,x:Q*Ee,y:J*Ee,x2:ee*Ee,y2:se*Ee,projection:t}}function eT(s,{x:t,y:a},u=0){return new Tt(((t-u)*s.scale-s.x)*Bt,(a*s.scale-s.y)*Bt)}const yD=ne(new Float32Array(16));class Kp{constructor(t){this.spec=t,this.name=t.name,this.wrap=!1,this.requiresDraping=!1,this.supportsWorldCopies=!1,this.supportsTerrain=!1,this.supportsFog=!1,this.supportsFreeCamera=!1,this.zAxisUnit="meters",this.isReprojectedInTileSpace=!0,this.unsupportedLayers=["custom"],this.center=[0,0],this.range=[3.5,7]}project(t,a){return{x:0,y:0,z:0}}unproject(t,a){return new W(0,0)}projectTilePoint(t,a,u){return{x:t,y:a,z:0}}locationPoint(t,a,u,d=!0){return t._coordinatePoint(t.locationCoordinate(a,u),d)}pixelsPerMeter(t,a){return ge(1,t)*a}pixelSpaceConversion(t,a,u){return 1}farthestPixelDistance(t){return JS(t,t.pixelsPerMeter)}pointCoordinate(t,a,u,d){const _=t.horizonLineFromTop(!1),v=new Tt(a,Math.max(_,u));return t.rayIntersectionCoordinate(t.pointRayIntersection(v,d))}pointCoordinate3D(t,a,u){const d=new Tt(a,u);if(t.elevation)return t.elevation.pointCoordinate(d);{const _=this.pointCoordinate(t,d.x,d.y,0);return[_.x,_.y,_.z]}}isPointAboveHorizon(t,a){if(t.elevation&&t.elevation.visibleDemTiles.length)return!this.pointCoordinate3D(t,a.x,a.y);const u=t.horizonLineFromTop();return a.y<u}createInversionMatrix(t,a){return yD}createTileMatrix(t,a,u){let d,_,v;const S=u.canonical,E=ne(new Float64Array(16));if(this.isReprojectedInTileSpace){const R=B0(S,this);d=1,_=R.x+u.wrap*R.scale,v=R.y,Pe(E,E,[d/R.scale,d/R.scale,t.pixelsPerMeter/a])}else d=a/t.zoomScale(S.z),_=(S.x+Math.pow(2,S.z)*u.wrap)*d,v=S.y*d;return we(E,E,[_,v,0]),Pe(E,E,[d/Bt,d/Bt,1]),E}upVector(t,a,u){return[0,0,1]}upVectorScale(t,a,u){return{metersToTile:1}}}class vD extends Kp{constructor(t){super(t),this.range=[4,7],this.center=t.center||[-96,37.5];const[a,u]=this.parallels=t.parallels||[29.5,45.5],d=Math.sin(Ne(a));this.n=(d+Math.sin(Ne(u)))/2,this.c=1+d*(2*this.n-d),this.r0=Math.sqrt(this.c)/this.n}project(t,a){const{n:u,c:d,r0:_}=this,v=Ne(t-this.center[0]),S=Ne(a),E=Math.sqrt(d-2*u*Math.sin(S))/u;return{x:E*Math.sin(v*u),y:E*Math.cos(v*u)-_,z:0}}unproject(t,a){const{n:u,c:d,r0:_}=this,v=_+a;let S=Math.atan2(t,Math.abs(v))*Math.sign(v);v*u<0&&(S-=Math.PI*Math.sign(t)*Math.sign(v));const E=Ne(this.center[0])*u;S=Be(S,-Math.PI-E,Math.PI-E);const R=Ie(te(S/u)+this.center[0],-180,180),P=Math.asin(Ie((d-(t*t+v*v)*u*u)/(2*u),-1,1)),B=Ie(te(P),-Se,Se);return new W(R,B)}}const z0=1.340264,F0=-.081106,k0=893e-6,N0=.003796,R1=Math.sqrt(3)/2;class xD extends Kp{project(t,a){a=a/180*Math.PI,t=t/180*Math.PI;const u=Math.asin(R1*Math.sin(a)),d=u*u,_=d*d*d;return{x:.5*(t*Math.cos(u)/(R1*(z0+3*F0*d+_*(7*k0+9*N0*d)))/Math.PI+.5),y:1-.5*(u*(z0+F0*d+_*(k0+N0*d))/Math.PI+1),z:0}}unproject(t,a){t=(2*t-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=u*u,_=d*d*d;for(let P,B,F,j=0;j<12&&(B=u*(z0+F0*d+_*(k0+N0*d))-a,F=z0+3*F0*d+_*(7*k0+9*N0*d),P=B/F,u=Ie(u-P,-Math.PI/3,Math.PI/3),d=u*u,_=d*d*d,!(Math.abs(P)<1e-12));++j);const v=R1*t*(z0+3*F0*d+_*(7*k0+9*N0*d))/Math.cos(u),S=Math.asin(Math.sin(u)/R1),E=Ie(180*v/Math.PI,-180,180),R=Ie(180*S/Math.PI,-Se,Se);return new W(E,R)}}class bD extends Kp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0}project(t,a){return{x:.5+t/360,y:.5-a/360,z:0}}unproject(t,a){const u=360*(t-.5),d=Ie(360*(.5-a),-Se,Se);return new W(u,d)}}const x_=Math.PI/2;function M1(s){return Math.tan((x_+s)/2)}class wD extends Kp{constructor(t){super(t),this.center=t.center||[0,30];const[a,u]=this.parallels=t.parallels||[30,30];let d=Ne(a),_=Ne(u);this.southernCenter=d+_<0,this.southernCenter&&(d=-d,_=-_);const v=Math.cos(d),S=M1(d);this.n=d===_?Math.sin(d):Math.log(v/Math.cos(_))/Math.log(M1(_)/S),this.f=v*Math.pow(M1(d),this.n)/this.n}project(t,a){a=Ne(a),this.southernCenter&&(a=-a),t=Ne(t-this.center[0]);const u=1e-6,{n:d,f:_}=this;_>0?a<-x_+u&&(a=-x_+u):a>x_-u&&(a=x_-u);const v=_/Math.pow(M1(a),d);let S=v*Math.sin(d*t),E=_-v*Math.cos(d*t);return S=.5*(S/Math.PI+.5),E=.5*(E/Math.PI+.5),{x:S,y:this.southernCenter?E:1-E,z:0}}unproject(t,a){t=(2*t-.5)*Math.PI,this.southernCenter&&(a=1-a),a=(2*(1-a)-.5)*Math.PI;const{n:u,f:d}=this,_=d-a,v=Math.sign(_),S=Math.sign(u)*Math.sqrt(t*t+_*_);let E=Math.atan2(t,Math.abs(_))*v;_*u<0&&(E-=Math.PI*Math.sign(t)*v);const R=Ie(te(E/u)+this.center[0],-180,180),P=Ie(te(2*Math.atan(Math.pow(d/S,1/u))-x_),-Se,Se);return new W(R,this.southernCenter?-P:P)}}class tT extends Kp{constructor(t){super(t),this.wrap=!0,this.supportsWorldCopies=!0,this.supportsTerrain=!0,this.supportsFog=!0,this.supportsFreeCamera=!0,this.isReprojectedInTileSpace=!1,this.unsupportedLayers=[],this.range=null}project(t,a){return{x:fe(t),y:xe(a),z:0}}unproject(t,a){const u=Te(t),d=ye(a);return new W(u,d)}}const rT=Ne(Se);class SD extends Kp{project(t,a){const u=(a=Ne(a))*a,d=u*u;return{x:.5*((t=Ne(t))*(.8707-.131979*u+d*(d*(.003971*u-.001529*d)-.013791))/Math.PI+.5),y:1-.5*(a*(1.007226+u*(.015085+d*(.028874*u-.044475-.005916*d)))/Math.PI+1),z:0}}unproject(t,a){t=(2*t-.5)*Math.PI;let u=a=(2*(1-a)-1)*Math.PI,d=25,_=0,v=u*u;do{v=u*u;const R=v*v;_=(u*(1.007226+v*(.015085+R*(.028874*v-.044475-.005916*R)))-a)/(1.007226+v*(.045255+R*(.259866*v-.311325-.005916*11*R))),u=Ie(u-_,-rT,rT)}while(Math.abs(_)>1e-6&&--d>0);v=u*u;const S=Ie(te(t/(.8707+v*(v*(v*v*v*(.003971-.001529*v)-.013791)-.131979))),-180,180),E=te(u);return new W(S,E)}}const iT=Ne(Se);class TD extends Kp{project(t,a){a=Ne(a),t=Ne(t);const u=Math.cos(a),d=2/Math.PI,_=Math.acos(u*Math.cos(t/2)),v=Math.sin(_)/_,S=.5*(t*d+2*u*Math.sin(t/2)/v)||0,E=.5*(a+Math.sin(a)/v)||0;return{x:.5*(S/Math.PI+.5),y:1-.5*(E/Math.PI+1),z:0}}unproject(t,a){let u=t=(2*t-.5)*Math.PI,d=a=(2*(1-a)-1)*Math.PI,_=25;const v=1e-6;let S=0,E=0;do{const R=Math.cos(d),P=Math.sin(d),B=2*P*R,F=P*P,j=R*R,G=Math.cos(u/2),Q=Math.sin(u/2),J=2*G*Q,ee=Q*Q,se=1-j*G*G,le=se?1/se:0,he=se?Math.acos(R*G)*Math.sqrt(1/se):0,Ee=.5*(2*he*R*Q+2*u/Math.PI)-t,Ce=.5*(he*P+d)-a,De=.5*le*(j*ee+he*R*G*F)+1/Math.PI,Le=le*(J*B/4-he*P*Q),Fe=.125*le*(B*Q-he*P*j*J),ut=.5*le*(F*G+he*ee*R)+.5,Ue=Le*Fe-ut*De;S=(Ce*Le-Ee*ut)/Ue,E=(Ee*Fe-Ce*De)/Ue,u=Ie(u-S,-Math.PI,Math.PI),d=Ie(d-E,-iT,iT)}while((Math.abs(S)>v||Math.abs(E)>v)&&--_>0);return new W(te(u),te(d))}}class nT extends Kp{constructor(t){super(t),this.center=t.center||[0,0],this.parallels=t.parallels||[0,0],this.cosPhi=Math.max(.01,Math.cos(Ne(this.parallels[0]))),this.scale=1/(2*Math.max(Math.PI*this.cosPhi,1/this.cosPhi)),this.wrap=!0,this.supportsWorldCopies=!0}project(t,a){const{scale:u,cosPhi:d}=this;return{x:Ne(t)*d*u+.5,y:-Math.sin(Ne(a))/d*u+.5,z:0}}unproject(t,a){const{scale:u,cosPhi:d}=this,_=-(a-.5)/u,v=Ie(te((t-.5)/u)/d,-180,180),S=Math.asin(Ie(_*d,-1,1)),E=Ie(te(S),-Se,Se);return new W(v,E)}}class AD extends tT{constructor(t){super(t),this.requiresDraping=!0,this.supportsWorldCopies=!1,this.supportsFog=!0,this.zAxisUnit="pixels",this.unsupportedLayers=["debug"],this.range=[3,5]}projectTilePoint(t,a,u){const d=zs(t,a,u);return Tn(d,d,qm(ll(u))),{x:d[0],y:d[1],z:d[2]}}locationPoint(t,a,u){const d=V(a.lat,a.lng),_=Cr([],d),v=u?t._centerAltitude+u:t.elevation?t.elevation.getAtPointOrZero(t.locationCoordinate(a),t._centerAltitude):t._centerAltitude;Er(d,d,_,ge(1,0)*Bt*v);const S=ne(new Float64Array(16));return ve(S,t.pixelMatrix,t.globeMatrix),Tn(d,d,S),new Tt(d[0],d[1])}pixelsPerMeter(t,a){return ge(1,0)*a}pixelSpaceConversion(t,a,u){const d=ge(1,t)*a,_=xr(ge(1,45)*a,d,u);return this.pixelsPerMeter(t,a)/_}createTileMatrix(t,a,u){const d=Xg(ll(u.canonical));return ve(new Float64Array(16),t.globeMatrix,d)}createInversionMatrix(t,a){const{center:u}=t,d=qm(ll(a));return $e(d,d,Ne(u.lng)),Ze(d,d,Ne(u.lat)),Pe(d,d,[t._pixelsPerMercatorPixel,t._pixelsPerMercatorPixel,1]),Float32Array.from(d)}pointCoordinate(t,a,u,d){return Ny(t,a,u,!0)||new tt(0,0)}pointCoordinate3D(t,a,u){const d=this.pointCoordinate(t,a,u,0);return[d.x,d.y,d.z]}isPointAboveHorizon(t,a){return!Ny(t,a.x,a.y,!1)}farthestPixelDistance(t){const a=(function(d,_){const v=d.cameraToCenterDistance,S=d._centerAltitude*_,E=d._camera,R=d._camera.forward(),P=Ot([],Vt([],R,-v),[0,0,S]),B=d.worldSize/(2*Math.PI),F=[0,0,-B],j=d.width/d.height,G=Math.tan(d.fovAboveCenter),Q=Vt([],E.up(),G),J=Vt([],E.right(),G*j),ee=Cr([],Ot([],Ot([],R,Q),J)),se=[];let le;if(new li(P,ee).closestPointOnSphere(F,B,se)){const he=Ot([],se,F),Ee=On([],he,P);le=Math.cos(d.fovAboveCenter)*ui(Ee)}else{const he=On([],P,F),Ee=On([],F,P);Cr(Ee,Ee);const Ce=ui(he)-B;le=Math.sqrt(Ce*(Ce+2*B));const De=Math.acos(le/(B+Ce))-Math.acos(Vi(R,Ee));le*=Math.cos(De)}return 1.01*le})(t,this.pixelsPerMeter(t.center.lat,t.worldSize)),u=Tu(t.zoom);if(u>0){const d=JS(t,ge(1,t.center.lat)*t.worldSize),_=t.worldSize/(2*Math.PI),v=Math.max(t.width,t.height)/t.worldSize*Math.PI;return xr(a,d+_*(1-Math.cos(v)),Math.pow(u,10))}return a}upVector(t,a,u){return zs(a,u,t,1)}upVectorScale(t){return{metersToTile:qg(gf(ll(t)))}}}function oT(s){const t=s.parallels,a=!!t&&Math.abs(t[0]+t[1])<.01;switch(s.name){case"mercator":return new tT(s);case"equirectangular":return new bD(s);case"naturalEarth":return new SD(s);case"equalEarth":return new xD(s);case"winkelTripel":return new TD(s);case"albers":return a?new nT(s):new vD(s);case"lambertConformalConic":return a?new nT(s):new wD(s);case"globe":return new AD(s)}throw new Error(`Invalid projection name: ${s.name}`)}const ED=pt.types,CD=[{name:"a_fade_opacity",components:1,type:"Uint8",offset:0}];function D1(s,t,a,u,d,_,v,S,E,R,P,B,F){const j=S?Math.min(Qp,Math.round(S[0])):0,G=S?Math.min(Qp,Math.round(S[1])):0;s.emplaceBack(t,a,Math.round(32*u),Math.round(32*d),_,v,(j<<1)+(E?1:0),G,16*R,16*P,256*B,256*F)}function O1(s,t,a){s.emplaceBack(t,a)}function P1(s,t,a,u,d,_,v){s.emplaceBack(t,a,u,d,_,v)}const L1=(s,t,a,u)=>{for(let d=0;d<t;d++)s.emplaceBack(a[0],a[1],a[2],u[0],u[1],u[2])};function B1(s,t,a,u,d){s.emplaceBack(t,a,u,d),s.emplaceBack(t,a,u,d),s.emplaceBack(t,a,u,d),s.emplaceBack(t,a,u,d)}function ID(s){for(const t of s.sections)if(Bg(t.text))return!0;return!1}class Ox{constructor(t){this.layoutVertexArray=new wp,this.indexArray=new Cn,this.programConfigurations=t,this.segments=new hn,this.dynamicLayoutVertexArray=new Lo,this.opacityVertexArray=new no,this.placedSymbolArray=new yd,this.iconTransitioningVertexArray=new Un,this.globeExtVertexArray=new Ll,this.zOffsetVertexArray=new Ps,this.orientationVertexArray=new lf}isEmpty(){return this.layoutVertexArray.length===0&&this.indexArray.length===0&&this.dynamicLayoutVertexArray.length===0&&this.opacityVertexArray.length===0&&this.iconTransitioningVertexArray.length===0}upload(t,a,u,d,_){this.isEmpty()||(u&&(this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,PM.members),this.indexBuffer=t.createIndexBuffer(this.indexArray,a),this.dynamicLayoutVertexBuffer=t.createVertexBuffer(this.dynamicLayoutVertexArray,BM.members,!0),this.opacityVertexBuffer=t.createVertexBuffer(this.opacityVertexArray,CD,!0),this.iconTransitioningVertexArray.length>0&&(this.iconTransitioningVertexBuffer=t.createVertexBuffer(this.iconTransitioningVertexArray,kM.members,!0)),this.globeExtVertexArray.length>0&&(this.globeExtVertexBuffer=t.createVertexBuffer(this.globeExtVertexArray,LM.members,!0)),!this.zOffsetVertexBuffer&&(this.zOffsetVertexArray.length>0||_)&&(this.zOffsetVertexBuffer=t.createVertexBuffer(this.zOffsetVertexArray,zM.members,!0)),!this.orientationVertexBuffer&&this.orientationVertexArray&&this.orientationVertexArray.length>0&&(this.orientationVertexBuffer=t.createVertexBuffer(this.orientationVertexArray,FM.members,!0)),this.opacityVertexBuffer.itemSize=1),(u||d)&&this.programConfigurations.upload(t))}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.programConfigurations.destroy(),this.segments.destroy(),this.dynamicLayoutVertexBuffer.destroy(),this.opacityVertexBuffer.destroy(),this.iconTransitioningVertexBuffer&&this.iconTransitioningVertexBuffer.destroy(),this.globeExtVertexBuffer&&this.globeExtVertexBuffer.destroy(),this.zOffsetVertexBuffer&&this.zOffsetVertexBuffer.destroy(),this.orientationVertexBuffer&&this.orientationVertexBuffer.destroy())}}$t(Ox,"SymbolBuffers");class Px{constructor(t,a,u){this.layoutVertexArray=new t,this.layoutAttributes=a,this.indexArray=new u,this.segments=new hn,this.collisionVertexArray=new Tp,this.collisionVertexArrayExt=new Lo}upload(t){this.layoutVertexBuffer=t.createVertexBuffer(this.layoutVertexArray,this.layoutAttributes),this.indexBuffer=t.createIndexBuffer(this.indexArray),this.collisionVertexBuffer=t.createVertexBuffer(this.collisionVertexArray,NM.members,!0),this.collisionVertexBufferExt=t.createVertexBuffer(this.collisionVertexArrayExt,VM.members,!0)}destroy(){this.layoutVertexBuffer&&(this.layoutVertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy(),this.collisionVertexBuffer.destroy(),this.collisionVertexBufferExt.destroy())}}$t(Px,"CollisionBuffers");class z1{constructor(t){this.collisionBoxArray=t.collisionBoxArray,this.zoom=t.zoom,this.overscaling=t.overscaling,this.layers=t.layers,this.layerIds=this.layers.map((v=>v.fqid)),this.index=t.index,this.pixelRatio=t.pixelRatio,this.sourceLayerIndex=t.sourceLayerIndex,this.hasPattern=!1,this.hasRTLText=!1,this.fullyClipped=!1,this.hasAnyIconTextFit=!1,this.sortKeyRanges=[],this.collisionCircleArray=[],this.placementInvProjMatrix=ne([]),this.placementViewportMatrix=ne([]);const a=this.layers[0]._unevaluatedLayout._values;this.worldview=t.worldview,this.textSizeData=LS(this.zoom,a["text-size"],this.worldview),this.iconSizeData=LS(this.zoom,a["icon-size"],this.worldview);const u=this.layers[0].layout,d=u.get("symbol-sort-key"),_=u.get("symbol-z-order");this.lut=t.lut,this.canOverlap=u.get("text-allow-overlap")||u.get("icon-allow-overlap")||u.get("text-ignore-placement")||u.get("icon-ignore-placement"),this.sortFeaturesByKey=_!=="viewport-y"&&d.constantOr(1)!==void 0,this.sortFeaturesByY=(_==="viewport-y"||_==="auto"&&!this.sortFeaturesByKey)&&this.canOverlap,this.writingModes=u.get("text-writing-mode").map((v=>ul[v])),this.stateDependentLayerIds=this.layers.filter((v=>v.isStateDependent())).map((v=>v.id)),this.sourceID=t.sourceID,this.projection=t.projection,this.hasAnyZOffset=!1,this.zOffsetSortDirty=!1,this.zOffsetBuffersNeedUpload=!1,this.elevationType="none",this.elevationStateComplete=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.hasAnySecondaryIcon=!1}createArrays(){this.text=new Ox(new Bo(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("text")||t.startsWith("symbol")))),this.icon=new Ox(new Bo(this.layers,{zoom:this.zoom,lut:this.lut},(t=>t.startsWith("icon")||t.startsWith("symbol")))),this.glyphOffsetArray=new km,this.lineVertexArray=new Nm,this.symbolInstances=new Rp}calculateGlyphDependencies(t,a,u,d,_){for(const v of t){const S=v.codePointAt(0);if(S===void 0)break;if(a[S]=!0,d&&_&&S<=65535){const E=R0[v];E&&(a[E.charCodeAt(0)]=!0)}}}updateFootprints(t,a){}updateReplacement(t,a){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(t.toUnwrapped(),!0);return!vf(this.activeReplacements,u)&&(this.activeReplacements=u,!0)}populate(t,a,u,d){const _=this.layers[0],v=_.layout,S=this.projection.name==="globe",E=v.get("text-font"),R=v.get("text-field"),P=v.get("icon-image"),[B,F]=v.get("icon-size-scale-range"),j=Ie(a.scaleFactor||1,B,F),G=(R.value.kind!=="constant"||R.value.value instanceof Jo&&!R.value.value.isEmpty()||R.value.value.toString().length>0)&&(E.value.kind!=="constant"||E.value.value.length>0),Q=P.value.kind!=="constant"||!!P.value.value||Object.keys(P.parameters).length>0,J=v.get("symbol-sort-key");if(this.features=[],!G&&!Q)return;const ee=a.iconDependencies,se=a.glyphDependencies,le=a.availableImages,he=new Hi(this.zoom,{worldview:this.worldview});for(const{feature:Ee,id:Ce,index:De,sourceLayerIndex:Le}of t){const Fe=_._featureFilter.needGeometry,ut=ft(Ee,Fe);if(!_._featureFilter.filter(he,ut,u))continue;if(Fe||(ut.geometry=wt(Ee,u,d)),S&&Ee.type!==1&&u.z<=5){const yt=ut.geometry,Rt=.98078528056,lt=(vt,et)=>Vi(zs(vt.x,vt.y,u,1),zs(et.x,et.y,u,1))<Rt;for(let vt=0;vt<yt.length;vt++)yt[vt]=ot(yt[vt],lt)}let Ue,dt;if(G){const yt=_.getValueAndResolveTokens("text-field",ut,u,le),Rt=Jo.factory(yt);ID(Rt)&&(this.hasRTLText=!0),(!this.hasRTLText||ld()==="unavailable"||this.hasRTLText&&tl.isParsed())&&(Ue=jM(Rt,_,ut))}if(Q){const yt=_.getValueAndResolveTokens("icon-image",ut,u,le);dt=typeof yt=="string"?sa.build(yt):yt}if(!Ue&&!dt)continue;const St=this.sortFeaturesByKey?J.evaluate(ut,{},u):void 0,gt={id:Ce,text:Ue,icon:dt,index:De,sourceLayerIndex:Le,geometry:ut.geometry,properties:Ee.properties,type:ED[Ee.type],sortKey:St};if(this.features.push(gt),dt){const yt=this.layers[0]._unevaluatedLayout._values,{iconPrimary:Rt,iconSecondary:lt}=WS(dt,this.iconSizeData,yt["icon-size"],u,this.zoom,gt,this.pixelRatio,j,this.worldview),vt=Rt.id.toString();if(ee.has(vt)?ee.get(vt).push(Rt):ee.set(vt,[Rt]),lt){this.hasAnySecondaryIcon=!0;const et=lt.id.toString();ee.has(et)?ee.get(et).push(lt):ee.set(et,[lt])}}if(Ue){const yt=E.evaluate(ut,{},u).join(","),Rt=v.get("text-rotation-alignment")==="map"&&v.get("symbol-placement")!=="point";this.allowVerticalPlacement=this.writingModes&&this.writingModes.indexOf(ul.vertical)>=0;for(const lt of Ue.sections)if(lt.image){const vt=lt.image.getPrimary().scaleSelf(this.pixelRatio),et=vt.id.toString(),We=ee.get(et)||[];We.push(vt),ee.set(et,We)}else{const vt=sd(Ue.toString()),et=lt.fontStack||yt,We=se[et]=se[et]||{};this.calculateGlyphDependencies(lt.text,We,Rt,this.allowVerticalPlacement,vt)}}}if(v.get("symbol-placement")==="line"&&(this.features=(function(Ee){const Ce={},De={},Le=[];let Fe=0;function ut(gt){Le.push(Ee[gt]),Fe++}function Ue(gt,yt,Rt){const lt=De[gt];return delete De[gt],De[yt]=lt,Le[lt].geometry[0].pop(),Le[lt].geometry[0]=Le[lt].geometry[0].concat(Rt[0]),lt}function dt(gt,yt,Rt){const lt=Ce[yt];return delete Ce[yt],Ce[gt]=lt,Le[lt].geometry[0].shift(),Le[lt].geometry[0]=Rt[0].concat(Le[lt].geometry[0]),lt}function St(gt,yt,Rt){const lt=Rt?yt[0][yt[0].length-1]:yt[0][0];return`${gt}:${lt.x}:${lt.y}`}for(let gt=0;gt<Ee.length;gt++){const yt=Ee[gt],Rt=yt.geometry,lt=yt.text?yt.text.toString():null;if(!lt){ut(gt);continue}const vt=St(lt,Rt),et=St(lt,Rt,!0);if(vt in De&&et in Ce&&De[vt]!==Ce[et]){const We=dt(vt,et,Rt),Dt=Ue(vt,et,Le[We].geometry);delete Ce[vt],delete De[et],De[St(lt,Le[Dt].geometry,!0)]=Dt,Le[We].geometry=null}else vt in De?Ue(vt,et,Rt):et in Ce?dt(vt,et,Rt):(ut(gt),Ce[vt]=Fe-1,De[et]=Fe-1)}return Le.filter((gt=>gt.geometry))})(this.features)),v.get("symbol-elevation-reference")==="hd-road-markup"){if(this.elevationType="road",a.elevationFeatures){!this.elevationFeatures&&a.elevationFeatures.length>0&&(this.elevationFeatures=[],this.elevationFeatureIdToIndex=new Map);for(const Ee of a.elevationFeatures)this.elevationFeatureIdToIndex.set(Ee.id,this.elevationFeatures.length),this.elevationFeatures.push(Ee)}}else v.get("symbol-z-elevate")&&(this.elevationType="offset");this.elevationType!=="none"&&(this.zOffsetBuffersNeedUpload=!0),this.sortFeaturesByKey&&this.features.sort(((Ee,Ce)=>Ee.sortKey-Ce.sortKey))}update(t,a,u,d,_,v,S){this.text.programConfigurations.updatePaintArrays(t,a,_,u,d,v,S,this.worldview),this.icon.programConfigurations.updatePaintArrays(t,a,_,u,d,v,S,this.worldview)}updateRoadElevation(t){if(this.elevationType!=="road"||!this.elevationFeatures||this.elevationStateComplete)return;this.elevationStateComplete=!0,this.hasAnyZOffset=!1;let a=!1;const u=Ge(t),d=1/u;let _=!1,v=!1;for(let S=0;S<this.symbolInstances.length;S++){const E=this.symbolInstances.get(S),R=zi(1,0,0),P=zi(0,1,0),{numHorizontalGlyphVertices:B,numVerticalGlyphVertices:F,numIconVertices:j,numVerticalIconVertices:G}=E,Q=B>0||F>0,J=j>0,ee=this.elevationFeatures[E.elevationFeatureIndex];if(ee){const se=new Tt(E.tileAnchorX,E.tileAnchorY),le=.075+ee.pointElevation(se);E.zOffset!==le&&(a=!0,E.zOffset=le);const he=ee.computeSlopeNormal(se,d),Ee=Ah(Wl(),zi(0,0,1),he);gl(R,R,Ee),gl(P,P,Ee),R[2]*=u,P[2]*=u,R[0]===1&&R[1]===0&&R[2]===0&&P[0]===0&&P[1]===1&&P[2]===0||(_=_||Q,v=v||J)}if(Q&&(L1(this.text.orientationVertexArray,B,R,P),L1(this.text.orientationVertexArray,F,R,P)),J){const{placedIconSymbolIndex:se,verticalPlacedIconSymbolIndex:le}=E;se>=0&&L1(this.icon.orientationVertexArray,j,R,P),le>=0&&L1(this.icon.orientationVertexArray,G,R,P)}}_||(this.text.orientationVertexArray=void 0),v||(this.icon.orientationVertexArray=void 0),a&&(this.zOffsetBuffersNeedUpload=!0,this.zOffsetSortDirty=!0)}updateZOffset(){const t=(_,v,S)=>{u+=v,u>_.length&&_.resize(u);for(let E=-v;E<0;E++)_.emplace(E+u,S)},a=(_,v,S)=>{d+=v,d>_.length&&_.resize(d);for(let E=-v;E<0;E++)_.emplace(E+d,S)};if(!this.zOffsetBuffersNeedUpload)return;this.zOffsetBuffersNeedUpload=!1;let u=0,d=0;for(let _=0;_<this.symbolInstances.length;_++){const v=this.symbolInstances.get(_),{numHorizontalGlyphVertices:S,numVerticalGlyphVertices:E,numIconVertices:R}=v,P=v.zOffset,B=R>0;if((S>0||E>0)&&(t(this.text.zOffsetVertexArray,S,P),t(this.text.zOffsetVertexArray,E,P)),B){const{placedIconSymbolIndex:F,verticalPlacedIconSymbolIndex:j}=v;F>=0&&a(this.icon.zOffsetVertexArray,R,P),j>=0&&a(this.icon.zOffsetVertexArray,v.numVerticalIconVertices,P)}}this.text.zOffsetVertexBuffer&&this.text.zOffsetVertexBuffer.updateData(this.text.zOffsetVertexArray),this.icon.zOffsetVertexBuffer&&this.icon.zOffsetVertexBuffer.updateData(this.icon.zOffsetVertexArray)}isEmpty(){return this.symbolInstances.length===0&&!this.hasRTLText}uploadPending(){return!this.uploaded||this.text.programConfigurations.needsUpload||this.icon.programConfigurations.needsUpload}upload(t){!this.uploaded&&this.hasDebugData()&&(this.textCollisionBox.upload(t),this.iconCollisionBox.upload(t)),this.text.upload(t,this.sortFeaturesByY,!this.uploaded,this.text.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.icon.upload(t,this.sortFeaturesByY,!this.uploaded,this.icon.programConfigurations.needsUpload,this.zOffsetBuffersNeedUpload),this.uploaded=!0}destroyDebugData(){this.textCollisionBox.destroy(),this.iconCollisionBox.destroy()}getProjection(){return this.projectionInstance||(this.projectionInstance=oT(this.projection)),this.projectionInstance}destroy(){this.text.destroy(),this.icon.destroy(),this.hasDebugData()&&this.destroyDebugData()}addToLineVertexArray(t,a){const u=this.lineVertexArray.length;if(t.segment!==void 0)for(const{x:d,y:_}of a)this.lineVertexArray.emplaceBack(d,_);return{lineStartIndex:u,lineLength:this.lineVertexArray.length-u}}addSymbols(t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q,J){const ee=t.indexArray,se=t.layoutVertexArray,le=t.globeExtVertexArray,he=t.segments.prepareSegment(4*a.length,se,ee,this.canOverlap?v.sortKey:void 0),Ee=this.glyphOffsetArray.length,Ce=he.vertexLength,De=this.allowVerticalPlacement&&S===ul.vertical?Math.PI/2:0,Le=v.text&&v.text.sections;for(let ut=0;ut<a.length;ut++){const{tl:Ue,tr:dt,bl:St,br:gt,texPrimary:yt,texSecondary:Rt,pixelOffsetTL:lt,pixelOffsetBR:vt,minFontScaleX:et,minFontScaleY:We,glyphOffset:Dt,isSDF:Et,sectionIndex:dr}=a[ut],Zt=he.vertexLength,nr=Dt[1];if(D1(se,R.x,R.y,Ue.x,nr+Ue.y,yt.x,yt.y,u,Et,lt.x,lt.y,et,We),D1(se,R.x,R.y,dt.x,nr+dt.y,yt.x+yt.w,yt.y,u,Et,vt.x,lt.y,et,We),D1(se,R.x,R.y,St.x,nr+St.y,yt.x,yt.y+yt.h,u,Et,lt.x,vt.y,et,We),D1(se,R.x,R.y,gt.x,nr+gt.y,yt.x+yt.w,yt.y+yt.h,u,Et,vt.x,vt.y,et,We),E){const{x:Nt,y:ur,z:Dr}=E.anchor,[Ht,ar,Sr]=E.up;P1(le,Nt,ur,Dr,Ht,ar,Sr),P1(le,Nt,ur,Dr,Ht,ar,Sr),P1(le,Nt,ur,Dr,Ht,ar,Sr),P1(le,Nt,ur,Dr,Ht,ar,Sr),B1(t.dynamicLayoutVertexArray,Nt,ur,Dr,De)}else B1(t.dynamicLayoutVertexArray,R.x,R.y,R.z,De);if(J){const Nt=Rt||yt;O1(t.iconTransitioningVertexArray,Nt.x,Nt.y),O1(t.iconTransitioningVertexArray,Nt.x+Nt.w,Nt.y),O1(t.iconTransitioningVertexArray,Nt.x,Nt.y+Nt.h),O1(t.iconTransitioningVertexArray,Nt.x+Nt.w,Nt.y+Nt.h)}ee.emplaceBack(Zt,Zt+1,Zt+2),ee.emplaceBack(Zt+1,Zt+2,Zt+3),he.vertexLength+=4,he.primitiveLength+=2,this.glyphOffsetArray.emplaceBack(Dt[0]),ut!==a.length-1&&dr===a[ut+1].sectionIndex||t.programConfigurations.populatePaintArrays(se.length,v,v.index,{},j,G,Q,Le&&Le[dr],this.worldview)}const Fe=E?E.anchor:R;t.placedSymbolArray.emplaceBack(Fe.x,Fe.y,Fe.z,R.x,R.y,Ee,this.glyphOffsetArray.length-Ee,Ce,P,B,R.segment,u?u[0]:0,u?u[1]:0,d[0],d[1],S,0,0,0,F,0)}_commitLayoutVertex(t,a,u,d,_,v,S){t.emplaceBack(a,u,d,_,v,Math.round(S.x),Math.round(S.y))}_addCollisionDebugVertices(t,a,u,d,_,v,S){const E=u.segments.prepareSegment(4,u.layoutVertexArray,u.indexArray),R=E.vertexLength,P=S.tileAnchorX,B=S.tileAnchorY;for(let j=0;j<4;j++)u.collisionVertexArray.emplaceBack(0,0,0,0,0,0);this._commitDebugCollisionVertexUpdate(u.collisionVertexArrayExt,a,t.padding,S.zOffset),this._commitLayoutVertex(u.layoutVertexArray,d,_,v,P,B,new Tt(t.x1,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,_,v,P,B,new Tt(t.x2,t.y1)),this._commitLayoutVertex(u.layoutVertexArray,d,_,v,P,B,new Tt(t.x2,t.y2)),this._commitLayoutVertex(u.layoutVertexArray,d,_,v,P,B,new Tt(t.x1,t.y2)),E.vertexLength+=4;const F=u.indexArray;F.emplaceBack(R,R+1),F.emplaceBack(R+1,R+2),F.emplaceBack(R+2,R+3),F.emplaceBack(R+3,R),E.primitiveLength+=4}_addTextDebugCollisionBoxes(t,a,u,d,_,v){for(let S=d;S<_;S++){const E=u.get(S),R=this.getSymbolInstanceTextSize(t,v,a,S);this._addCollisionDebugVertices(E,R,this.textCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}_addIconDebugCollisionBoxes(t,a,u,d,_,v){for(let S=d;S<_;S++){const E=u.get(S),R=this.getSymbolInstanceIconSize(t,a,v.placedIconSymbolIndex);this._addCollisionDebugVertices(E,R,this.iconCollisionBox,E.projectedAnchorX,E.projectedAnchorY,E.projectedAnchorZ,v)}}generateCollisionDebugBuffers(t,a,u){this.hasDebugData()&&this.destroyDebugData(),this.textCollisionBox=new Px(sf,vS.members,Un),this.iconCollisionBox=new Px(sf,vS.members,Un);const d=D0(this.iconSizeData,t),_=D0(this.textSizeData,t,u);for(let v=0;v<this.symbolInstances.length;v++){const S=this.symbolInstances.get(v);this._addTextDebugCollisionBoxes(_,t,a,S.textBoxStartIndex,S.textBoxEndIndex,S),this._addTextDebugCollisionBoxes(_,t,a,S.verticalTextBoxStartIndex,S.verticalTextBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,t,a,S.iconBoxStartIndex,S.iconBoxEndIndex,S),this._addIconDebugCollisionBoxes(d,t,a,S.verticalIconBoxStartIndex,S.verticalIconBoxEndIndex,S)}}getSymbolInstanceTextSize(t,a,u,d){const _=this.text.placedSymbolArray.get(a.rightJustifiedTextSymbolIndex>=0?a.rightJustifiedTextSymbolIndex:a.centerJustifiedTextSymbolIndex>=0?a.centerJustifiedTextSymbolIndex:a.leftJustifiedTextSymbolIndex>=0?a.leftJustifiedTextSymbolIndex:a.verticalPlacedTextSymbolIndex>=0?a.verticalPlacedTextSymbolIndex:d),v=Ax(this.textSizeData,t,_)/$o;return this.tilePixelRatio*v}getSymbolInstanceIconSize(t,a,u){const d=this.icon.placedSymbolArray.get(u),_=Ax(this.iconSizeData,t,d);return this.tilePixelRatio*_}_commitDebugCollisionVertexUpdate(t,a,u,d){t.emplaceBack(a,-u,-u,d),t.emplaceBack(a,u,-u,d),t.emplaceBack(a,u,u,d),t.emplaceBack(a,-u,u,d)}_updateTextDebugCollisionBoxes(t,a,u,d,_,v,S){for(let E=d;E<_;E++){const R=u.get(E),P=this.getSymbolInstanceTextSize(t,v,a,E);this._commitDebugCollisionVertexUpdate(this.textCollisionBox.collisionVertexArrayExt,P,R.padding,v.zOffset)}}_updateIconDebugCollisionBoxes(t,a,u,d,_,v,S){for(let E=d;E<_;E++){const R=u.get(E),P=this.getSymbolInstanceIconSize(t,a,v.placedIconSymbolIndex);this._commitDebugCollisionVertexUpdate(this.iconCollisionBox.collisionVertexArrayExt,P,R.padding,v.zOffset)}}updateCollisionDebugBuffers(t,a,u,d){if(!this.hasDebugData())return;this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexArrayExt.clear(),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexArrayExt.clear();const _=D0(this.iconSizeData,t,d),v=D0(this.textSizeData,t,u);for(let S=0;S<this.symbolInstances.length;S++){const E=this.symbolInstances.get(S);this._updateTextDebugCollisionBoxes(v,t,a,E.textBoxStartIndex,E.textBoxEndIndex,E,u),this._updateTextDebugCollisionBoxes(v,t,a,E.verticalTextBoxStartIndex,E.verticalTextBoxEndIndex,E,u),this._updateIconDebugCollisionBoxes(_,t,a,E.iconBoxStartIndex,E.iconBoxEndIndex,E,d),this._updateIconDebugCollisionBoxes(_,t,a,E.verticalIconBoxStartIndex,E.verticalIconBoxEndIndex,E,d)}this.hasTextCollisionBoxData()&&this.textCollisionBox.collisionVertexBufferExt&&this.textCollisionBox.collisionVertexBufferExt.updateData(this.textCollisionBox.collisionVertexArrayExt),this.hasIconCollisionBoxData()&&this.iconCollisionBox.collisionVertexBufferExt&&this.iconCollisionBox.collisionVertexBufferExt.updateData(this.iconCollisionBox.collisionVertexArrayExt)}_deserializeCollisionBoxesForSymbol(t,a,u,d,_,v,S,E,R){const P={};if(a<u){const{x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=t.get(a);P.textBox={x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he},P.textFeatureIndex=Ee}if(d<_){const{x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=t.get(d);P.verticalTextBox={x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he},P.verticalTextFeatureIndex=Ee}if(v<S){const{x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=t.get(v);P.iconBox={x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he},P.iconFeatureIndex=Ee}if(E<R){const{x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he,featureIndex:Ee}=t.get(E);P.verticalIconBox={x1:B,y1:F,x2:j,y2:G,padding:Q,projectedAnchorX:J,projectedAnchorY:ee,projectedAnchorZ:se,tileAnchorX:le,tileAnchorY:he},P.verticalIconFeatureIndex=Ee}return P}deserializeCollisionBoxes(t){this.collisionArrays=[];for(let a=0;a<this.symbolInstances.length;a++){const u=this.symbolInstances.get(a);this.collisionArrays.push(this._deserializeCollisionBoxesForSymbol(t,u.textBoxStartIndex,u.textBoxEndIndex,u.verticalTextBoxStartIndex,u.verticalTextBoxEndIndex,u.iconBoxStartIndex,u.iconBoxEndIndex,u.verticalIconBoxStartIndex,u.verticalIconBoxEndIndex))}}hasTextData(){return this.text.segments.get().length>0}hasIconData(){return this.icon.segments.get().length>0}hasDebugData(){return this.textCollisionBox&&this.iconCollisionBox}hasTextCollisionBoxData(){return this.hasDebugData()&&this.textCollisionBox.segments.get().length>0}hasIconCollisionBoxData(){return this.hasDebugData()&&this.iconCollisionBox.segments.get().length>0}hasIconTextFit(){return this.hasAnyIconTextFit}addIndicesForPlacedSymbol(t,a){const u=t.placedSymbolArray.get(a),d=u.vertexStartIndex+4*u.numGlyphs;for(let _=u.vertexStartIndex;_<d;_+=4)t.indexArray.emplaceBack(_,_+1,_+2),t.indexArray.emplaceBack(_+1,_+2,_+3)}getSortedSymbolIndexes(t){if(this.sortedAngle===t&&this.symbolInstanceIndexes!==void 0)return this.symbolInstanceIndexes;const a=Math.sin(t),u=Math.cos(t),d=[],_=[],v=[];for(let S=0;S<this.symbolInstances.length;++S){v.push(S);const E=this.symbolInstances.get(S);d.push(0|Math.round(a*E.tileAnchorX+u*E.tileAnchorY)),_.push(E.featureIndex)}return v.sort(((S,E)=>d[S]-d[E]||_[E]-_[S])),v}getSortedIndexesByZOffset(){if(!this.zOffsetSortDirty)return this.symbolInstanceIndexesSortedZOffset;if(!this.symbolInstanceIndexesSortedZOffset){this.symbolInstanceIndexesSortedZOffset=[];for(let t=0;t<this.symbolInstances.length;++t)this.symbolInstanceIndexesSortedZOffset.push(t)}return this.zOffsetSortDirty=!1,this.symbolInstanceIndexesSortedZOffset.sort(((t,a)=>this.symbolInstances.get(a).zOffset-this.symbolInstances.get(t).zOffset))}addToSortKeyRanges(t,a){const u=this.sortKeyRanges[this.sortKeyRanges.length-1];u&&u.sortKey===a?u.symbolInstanceEnd=t+1:this.sortKeyRanges.push({sortKey:a,symbolInstanceStart:t,symbolInstanceEnd:t+1})}sortFeatures(t){if(this.sortFeaturesByY&&this.sortedAngle!==t&&!(this.text.segments.get().length>1||this.icon.segments.get().length>1)){this.symbolInstanceIndexes=this.getSortedSymbolIndexes(t),this.sortedAngle=t,this.text.indexArray.clear(),this.icon.indexArray.clear(),this.featureSortOrder=[];for(const a of this.symbolInstanceIndexes){const u=this.symbolInstances.get(a);this.featureSortOrder.push(u.featureIndex);const{rightJustifiedTextSymbolIndex:d,centerJustifiedTextSymbolIndex:_,leftJustifiedTextSymbolIndex:v,verticalPlacedTextSymbolIndex:S,placedIconSymbolIndex:E,verticalPlacedIconSymbolIndex:R}=u;d>=0&&this.addIndicesForPlacedSymbol(this.text,d),_>=0&&_!==d&&this.addIndicesForPlacedSymbol(this.text,_),v>=0&&v!==_&&v!==d&&this.addIndicesForPlacedSymbol(this.text,v),S>=0&&this.addIndicesForPlacedSymbol(this.text,S),E>=0&&this.addIndicesForPlacedSymbol(this.icon,E),R>=0&&this.addIndicesForPlacedSymbol(this.icon,R)}this.text.indexBuffer&&this.text.indexBuffer.updateData(this.text.indexArray),this.icon.indexBuffer&&this.icon.indexBuffer.updateData(this.icon.indexArray)}}}let aT,sT,Lx;$t(z1,"SymbolBucket",{omit:["layers","collisionBoxArray","features","compareText"]}),z1.addDynamicAttributes=B1;class lT{constructor(t){this.type=t.property.overrides?t.property.overrides.runtimeType:ws,this.defaultValue=t}evaluate(t){if(t.formattedSection){const a=this.defaultValue.property.overrides;if(a&&a.hasOverride(t.formattedSection))return a.getOverride(t.formattedSection)}return t.feature&&t.featureState?this.defaultValue.evaluate(t.feature,t.featureState):this.defaultValue.property.specification.default}eachChild(t){this.defaultValue.isConstant()||t(this.defaultValue.value._styleExpression.expression)}outputDefined(){return!1}serialize(){return null}}$t(lT,"FormatSectionOverride",{omit:["defaultValue"]});const Bx=()=>Lx||(Lx={layout:aT||(aT=new yn({"symbol-placement":new At(Ve.layout_symbol["symbol-placement"]),"symbol-spacing":new At(Ve.layout_symbol["symbol-spacing"]),"symbol-avoid-edges":new At(Ve.layout_symbol["symbol-avoid-edges"]),"symbol-sort-key":new Ut(Ve.layout_symbol["symbol-sort-key"]),"symbol-z-order":new At(Ve.layout_symbol["symbol-z-order"]),"symbol-z-elevate":new At(Ve.layout_symbol["symbol-z-elevate"]),"symbol-elevation-reference":new At(Ve.layout_symbol["symbol-elevation-reference"]),"icon-allow-overlap":new At(Ve.layout_symbol["icon-allow-overlap"]),"icon-ignore-placement":new At(Ve.layout_symbol["icon-ignore-placement"]),"icon-optional":new At(Ve.layout_symbol["icon-optional"]),"icon-rotation-alignment":new At(Ve.layout_symbol["icon-rotation-alignment"]),"icon-size":new Ut(Ve.layout_symbol["icon-size"]),"icon-size-scale-range":new At(Ve.layout_symbol["icon-size-scale-range"]),"icon-text-fit":new Ut(Ve.layout_symbol["icon-text-fit"]),"icon-text-fit-padding":new Ut(Ve.layout_symbol["icon-text-fit-padding"]),"icon-image":new Ut(Ve.layout_symbol["icon-image"]),"icon-image-use-theme":new At({type:"string",default:"default","property-type":"data-constant"}),"icon-rotate":new Ut(Ve.layout_symbol["icon-rotate"]),"icon-padding":new At(Ve.layout_symbol["icon-padding"]),"icon-keep-upright":new At(Ve.layout_symbol["icon-keep-upright"]),"icon-offset":new Ut(Ve.layout_symbol["icon-offset"]),"icon-anchor":new Ut(Ve.layout_symbol["icon-anchor"]),"icon-pitch-alignment":new At(Ve.layout_symbol["icon-pitch-alignment"]),"text-pitch-alignment":new At(Ve.layout_symbol["text-pitch-alignment"]),"text-rotation-alignment":new At(Ve.layout_symbol["text-rotation-alignment"]),"text-field":new Ut(Ve.layout_symbol["text-field"]),"text-font":new Ut(Ve.layout_symbol["text-font"]),"text-size":new Ut(Ve.layout_symbol["text-size"]),"text-size-scale-range":new At(Ve.layout_symbol["text-size-scale-range"]),"text-max-width":new Ut(Ve.layout_symbol["text-max-width"]),"text-line-height":new Ut(Ve.layout_symbol["text-line-height"]),"text-letter-spacing":new Ut(Ve.layout_symbol["text-letter-spacing"]),"text-justify":new Ut(Ve.layout_symbol["text-justify"]),"text-radial-offset":new Ut(Ve.layout_symbol["text-radial-offset"]),"text-variable-anchor":new At(Ve.layout_symbol["text-variable-anchor"]),"text-anchor":new Ut(Ve.layout_symbol["text-anchor"]),"text-max-angle":new At(Ve.layout_symbol["text-max-angle"]),"text-writing-mode":new At(Ve.layout_symbol["text-writing-mode"]),"text-rotate":new Ut(Ve.layout_symbol["text-rotate"]),"text-padding":new At(Ve.layout_symbol["text-padding"]),"text-keep-upright":new At(Ve.layout_symbol["text-keep-upright"]),"text-transform":new Ut(Ve.layout_symbol["text-transform"]),"text-offset":new Ut(Ve.layout_symbol["text-offset"]),"text-allow-overlap":new At(Ve.layout_symbol["text-allow-overlap"]),"text-ignore-placement":new At(Ve.layout_symbol["text-ignore-placement"]),"text-optional":new At(Ve.layout_symbol["text-optional"]),visibility:new At(Ve.layout_symbol.visibility)})),paint:sT||(sT=new yn({"icon-opacity":new Ut(Ve.paint_symbol["icon-opacity"]),"icon-occlusion-opacity":new Ut(Ve.paint_symbol["icon-occlusion-opacity"]),"icon-emissive-strength":new Ut(Ve.paint_symbol["icon-emissive-strength"]),"text-emissive-strength":new Ut(Ve.paint_symbol["text-emissive-strength"]),"icon-color":new Ut(Ve.paint_symbol["icon-color"]),"icon-halo-color":new Ut(Ve.paint_symbol["icon-halo-color"]),"icon-halo-width":new Ut(Ve.paint_symbol["icon-halo-width"]),"icon-halo-blur":new Ut(Ve.paint_symbol["icon-halo-blur"]),"icon-translate":new At(Ve.paint_symbol["icon-translate"]),"icon-translate-anchor":new At(Ve.paint_symbol["icon-translate-anchor"]),"icon-image-cross-fade":new At(Ve.paint_symbol["icon-image-cross-fade"]),"text-opacity":new Ut(Ve.paint_symbol["text-opacity"]),"text-occlusion-opacity":new Ut(Ve.paint_symbol["text-occlusion-opacity"]),"text-color":new Ut(Ve.paint_symbol["text-color"],{runtimeType:ba,getOverride:s=>s.textColor,hasOverride:s=>!!s.textColor}),"text-halo-color":new Ut(Ve.paint_symbol["text-halo-color"]),"text-halo-width":new Ut(Ve.paint_symbol["text-halo-width"]),"text-halo-blur":new Ut(Ve.paint_symbol["text-halo-blur"]),"text-translate":new At(Ve.paint_symbol["text-translate"]),"text-translate-anchor":new At(Ve.paint_symbol["text-translate-anchor"]),"icon-color-saturation":new At(Ve.paint_symbol["icon-color-saturation"]),"icon-color-contrast":new At(Ve.paint_symbol["icon-color-contrast"]),"icon-color-brightness-min":new At(Ve.paint_symbol["icon-color-brightness-min"]),"icon-color-brightness-max":new At(Ve.paint_symbol["icon-color-brightness-max"]),"symbol-z-offset":new Ut(Ve.paint_symbol["symbol-z-offset"]),"icon-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"icon-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"text-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"text-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},Lx);class F1 extends Go{constructor(t,a,u,d){super(t,Bx(),a,u,d,t.layout?t.layout["icon-image-use-theme"]:null),this._colorAdjustmentMatrix=ne([]),this.hasOcclusionOpacityProperties=t.paint!==void 0&&("icon-occlusion-opacity"in t.paint||"text-occlusion-opacity"in t.paint)}_handleSpecialPaintPropertyUpdate(t){t!=="icon-occlusion-opacity"&&t!=="text-occlusion-opacity"||(this.hasOcclusionOpacityProperties=!0)}recalculate(t,a){super.recalculate(t,a),this.layout.get("icon-rotation-alignment")==="auto"&&(this.layout._values["icon-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-rotation-alignment")==="auto"&&(this.layout._values["text-rotation-alignment"]=this.layout.get("symbol-placement")!=="point"?"map":"viewport"),this.layout.get("text-pitch-alignment")==="auto"&&(this.layout._values["text-pitch-alignment"]=this.layout.get("text-rotation-alignment")),this.layout.get("icon-pitch-alignment")==="auto"&&(this.layout._values["icon-pitch-alignment"]=this.layout.get("icon-rotation-alignment"));const u=this.layout.get("text-writing-mode");if(u){const d=[];for(const _ of u)d.indexOf(_)<0&&d.push(_);this.layout._values["text-writing-mode"]=d}else this.layout._values["text-writing-mode"]=this.layout.get("symbol-placement")==="point"?["horizontal"]:["horizontal","vertical"];this._setPaintOverrides()}getColorAdjustmentMatrix(t,a,u,d){return this._saturation===t&&this._contrast===a&&this._brightnessMin===u&&this._brightnessMax===d||(this._colorAdjustmentMatrix=(function(_,v,S,E){_=va(_),v=No(v);const R=ie(),P=_/3,B=1-2*P,F=[B,P,P,0,P,B,P,0,P,P,B,0,0,0,0,1],j=.5-.5*v,G=E-S;return ve(R,[G,0,0,0,0,G,0,0,0,0,G,0,S,S,S,1],[v,0,0,0,0,v,0,0,0,0,v,0,j,j,j,1]),ve(R,R,F),R})(t,a,u,d),this._saturation=t,this._contrast=a,this._brightnessMin=u,this._brightnessMax=d),this._colorAdjustmentMatrix}getValueAndResolveTokens(t,a,u,d){const _=this.layout.get(t).evaluate(a,{},u,d),v=this._unevaluatedLayout._values[t];return v.isDataDriven()||Yh(v.value)||!_?_:(function(S,E){return E.replace(/{([^{}]+)}/g,((R,P)=>P in S?String(S[P]):""))})(a.properties,_)}createBucket(t){return new z1(t)}queryRadius(){return 0}queryIntersectsFeature(){return!1}_setPaintOverrides(){for(const t of Bx().paint.overridableProperties){if(!F1.hasPaintOverride(this.layout,t))continue;const a=this.paint.get(t),u=new lT(a),d=new Il(u,a.property.specification,this.scope,this.options,this.layout.get("icon-image-use-theme"));let _=null;_=a.value.kind==="constant"||a.value.kind==="source"?new Rl("source",d):new fu("composite",d,a.value.zoomStops,a.value.interpolationType),this.paint._values[t]=new Ol(a.property,_,a.parameters)}}_handleOverridablePaintPropertyUpdate(t,a,u){return!(!this.layout||a.isDataDriven()||u.isDataDriven())&&F1.hasPaintOverride(this.layout,t)}static hasPaintOverride(t,a){const u=t.get("text-field"),d=Bx().paint.properties[a];let _=!1;const v=S=>{for(const E of S)if(d.overrides&&d.overrides.hasOverride(E))return void(_=!0)};if(u.value.kind==="constant"&&u.value.value instanceof Jo)v(u.value.value.sections);else if(u.value.kind==="source"){const S=R=>{_||(R instanceof kr&&fo(R.value)===Yc?v(R.value.sections):R instanceof Xu?v(R.sections):R.eachChild(S))},E=u.value;E._styleExpression&&S(E._styleExpression.expression)}return _}getProgramIds(){return["symbol"]}getDefaultProgramParams(t,a,u){return{config:new Su(this,{zoom:a,lut:u}),overrideFog:!1}}hasElevation(){return this.layout&&this.layout.get("symbol-elevation-reference")==="hd-road-markup"}}let cT,uT,hT,fT;var zx=ei([{name:"a_pos",type:"Int16",components:2},{name:"a_texture_pos",type:"Int16",components:2}]);function k1(s,t,a,u,d,_,v,S){const E=[s,t,1,a,u,1,d,_,1],R=[v,S,1],P=q([],E),[B,F,j]=qs(R,R,P);return Z(E,E,[B,0,0,0,F,0,0,0,j])}function dT(s,t,a,u,d,_,v,S){const E=(function(R,P,B,F,j,G,Q,J){const ee=k1(0,0,1,0,1,1,0,1),se=k1(R,P,B,F,j,G,Q,J);return Z(se,se,q([],ee))})(s,t,a,u,d,_,v,S);return[E[2]/E[8]/Bt,E[5]/E[8]/Bt]}function N1(s){return[s[0],Math.min(Math.max(s[1],-Se),Se)]}class pT extends Hu{constructor(t,a,u,d){super(),this.id=t,this.dispatcher=u,this.coordinates=a.coordinates,this.type="image",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this.tiles={},this._loaded=!1,this.onNorthPole=!1,this.onSouthPole=!1,this.setEventedParent(d),this.options=a,this._dirty=!1}load(t,a){if(this._loaded=a||!1,this.fire(new ts("dataloading",{dataType:"source"})),this.url=this.options.url,!this.url)return t&&(this.coordinates=t),this._loaded=!0,void this._finishLoading();this._imageRequest=rc(this.map._requestManager.transformRequest(this.url,Nf.Image),((u,d)=>{this._imageRequest=null,this._loaded=!0,u?this.fire(new ic(u)):d&&(this.image=d instanceof HTMLImageElement?Ys.getImageData(d):d,this._dirty=!0,this.width=this.image.width,this.height=this.image.height,t&&(this.coordinates=t),this._finishLoading())}))}loaded(){return this._loaded}updateImage(t){return t.url?(this._imageRequest&&t.url!==this.options.url&&(this._imageRequest.cancel(),this._imageRequest=null),this.options.url=t.url,this.load(t.coordinates,this._loaded),this):this}setTexture(t){if(!(t.handle instanceof WebGLTexture))throw new Error("The provided handle is not a WebGLTexture instance");return this.texture=new E0(this.map.painter.context,t.handle),this.width=t.dimensions[0],this.height=t.dimensions[1],this._dirty=!1,this._loaded=!0,this._finishLoading(),this}_finishLoading(){this.map&&(this.setCoordinates(this.coordinates),this.fire(new ts("data",{dataType:"source",sourceDataType:"metadata"})))}onAdd(t){this.map=t,this.load()}onRemove(t){this._imageRequest&&(this._imageRequest.cancel(),this._imageRequest=null),!this.texture||this.texture instanceof E0||this.texture.destroy(),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy())}setCoordinates(t){if(this.coordinates=t,this._boundsArray=void 0,this._unsupportedCoords=!1,!t.length)return this;this.onNorthPole=!1,this.onSouthPole=!1;let a=t[0][1],u=t[0][1];for(const _ of t)_[1]>u&&(u=_[1]),_[1]<a&&(a=_[1]);const d=(u+a)/2;if(d>Se?this.onNorthPole=!0:d<-Se&&(this.onSouthPole=!0),!this.onNorthPole&&!this.onSouthPole){const _=t.map(tt.fromLngLat);this.tileID=(function(v){let S=1/0,E=1/0,R=-1/0,P=-1/0;for(const Q of v)S=Math.min(S,Q.x),E=Math.min(E,Q.y),R=Math.max(R,Q.x),P=Math.max(P,Q.y);const B=Math.max(R-S,P-E),F=Math.max(0,Math.floor(-Math.log2(B))),j=Math.pow(2,F);let G=Math.floor((S+R)/2*j);return G>1&&(G-=1),new Nl(F,G,Math.floor((E+P)/2*j))})(_),this.minzoom=this.maxzoom=this.tileID.z}return this.fire(new ts("data",{dataType:"source",sourceDataType:"content"})),this}_clear(){!this.texture||this.texture instanceof E0||(this.texture.destroy(),this._dirty=!0),this.texture=null,this._boundsArray=void 0,this._unsupportedCoords=!1}_prepareData(t){for(const ee in this.tiles){const se=this.tiles[ee];se.state!=="loaded"&&(se.state="loaded",se.texture=this.texture)}if(this._boundsArray||this.onNorthPole||this.onSouthPole||this._unsupportedCoords)return;const a=B0(new Nl(0,0,0),this.map.transform.projection),u=[a.projection.project(this.coordinates[0][0],this.coordinates[0][1]),a.projection.project(this.coordinates[1][0],this.coordinates[1][1]),a.projection.project(this.coordinates[2][0],this.coordinates[2][1]),a.projection.project(this.coordinates[3][0],this.coordinates[3][1])];if(!(function(ee){const se=ee[1].x-ee[0].x,le=ee[1].y-ee[0].y,he=ee[2].x-ee[1].x,Ee=ee[2].y-ee[1].y,Ce=ee[3].x-ee[2].x,De=ee[3].y-ee[2].y,Le=ee[0].x-ee[3].x,Fe=ee[0].y-ee[3].y,ut=se*Ee-he*le,Ue=he*De-Ce*Ee,dt=Ce*Fe-Le*De,St=Le*le-se*Fe;return ut>0&&Ue>0&&dt>0&&St>0||ut<0&&Ue<0&&dt<0&&St<0})(u))return console.warn("Image source coordinates are defining non-convex area in the Mercator projection"),void(this._unsupportedCoords=!0);const d=B0(this.tileID,this.map.transform.projection),[_,v,S,E]=this.coordinates.map((ee=>{const se=d.projection.project(ee[0],ee[1]);return eT(d,se)._round()}));this.perspectiveTransform=dT(_.x,_.y,v.x,v.y,S.x,S.y,E.x,E.y);const R=this._boundsArray=new Pl;R.emplaceBack(_.x,_.y,0,0),R.emplaceBack(v.x,v.y,Bt,0),R.emplaceBack(E.x,E.y,0,Bt),R.emplaceBack(S.x,S.y,Bt,Bt),this.boundsBuffer&&(this.boundsBuffer.destroy(),this.elevatedGlobeVertexBuffer&&this.elevatedGlobeVertexBuffer.destroy(),this.elevatedGlobeIndexBuffer&&this.elevatedGlobeIndexBuffer.destroy()),this.boundsBuffer=t.createVertexBuffer(R,zx.members),this.boundsSegments=hn.simpleSegment(0,0,4,2);const P=[],B=[N1((F=this.coordinates)[0]),N1(F[1]),N1(F[2]),N1(F[3])];var F;const[j,G,Q,J]=(function(ee){let se=ee[0][0],le=se,he=ee[0][1],Ee=he;for(let Ce=1;Ce<ee.length;Ce++)ee[Ce][0]<se?se=ee[Ce][0]:ee[Ce][0]>le&&(le=ee[Ce][0]),ee[Ce][1]<he?he=ee[Ce][1]:ee[Ce][1]>Ee&&(Ee=ee[Ce][1]);return[se,he,le-se,Ee-he]})(B);{const ee=new Pl,[se,le,he,Ee]=(function(lt){let vt=lt[0].x,et=vt,We=lt[0].y,Dt=We;for(let Et=1;Et<lt.length;Et++)lt[Et].x<vt?vt=lt[Et].x:lt[Et].x>et&&(et=lt[Et].x),lt[Et].y<We?We=lt[Et].y:lt[Et].y>Dt&&(Dt=lt[Et].y);return[vt,We,et-vt,Dt-We]})(u),Ce=lt=>[(lt.x-se)/he,(lt.y-le)/Ee],[De,Le,Fe,ut]=u.map(Ce),Ue=(function(lt,vt,et,We,Dt,Et,dr,Zt){const nr=k1(0,0,1,0,1,1,0,1);return Z(nr,nr,q([],k1(lt,vt,et,We,Dt,Et,dr,Zt)))})(De[0],De[1],Le[0],Le[1],Fe[0],Fe[1],ut[0],ut[1]);this.elevatedGlobePerspectiveTransform=dT(De[0],De[1],Le[0],Le[1],Fe[0],Fe[1],ut[0],ut[1]);const dt=(lt,vt)=>{P.push(lt.lng);const et=Math.round((lt.lng-j)/Q*Bt),We=Math.round((lt.lat-G)/J*Bt),Dt=Ce(vt),Et=qs([],[Dt[0],Dt[1],1],Ue),dr=Math.round(Et[0]/Et[2]*Bt),Zt=Math.round(Et[1]/Et[2]*Bt);ee.emplaceBack(et,We,dr,Zt)},St=u[3].x-u[0].x,gt=u[3].y-u[0].y,yt=u[2].x-u[1].x,Rt=u[2].y-u[1].y;for(let lt=0;lt<65;lt++){const vt=lt/64,et=[u[0].x+vt*St,u[0].y+vt*gt],We=[u[1].x+vt*yt,u[1].y+vt*Rt],Dt=We[0]-et[0],Et=We[1]-et[1];for(let dr=0;dr<65;dr++){const Zt=dr/64,nr={x:et[0]+Dt*Zt,y:et[1]+Et*Zt};dt(a.projection.unproject(nr.x,nr.y),nr)}}this.elevatedGlobeVertexBuffer=t.createVertexBuffer(ee,zx.members)}{this.maxLongitudeTriangleSize=0;let ee=[],se=new Cn;const le=(he,Ee,Ce)=>{se.emplaceBack(he,Ee,Ce);const De=P[he],Le=P[Ee],Fe=P[Ce],ut=Math.min(Math.min(De,Le),Fe),Ue=Math.max(Math.max(De,Le),Fe)-ut;Ue>this.maxLongitudeTriangleSize&&(this.maxLongitudeTriangleSize=Ue),ee.push(ut+Ue/2)};for(let he=0;he<64;he++)for(let Ee=0;Ee<64;Ee++){const Ce=65*he+Ee,De=Ce+1,Le=Ce+65,Fe=Le+1;le(Ce,Le,De),le(De,Le,Fe)}[ee,se]=(function(he,Ee){const Ce=Array.from({length:he.length},((Fe,ut)=>ut));Ce.sort(((Fe,ut)=>he[Fe]-he[ut]));const De=[],Le=new Cn;for(let Fe=0;Fe<Ce.length;Fe++){const ut=Ce[Fe];De.push(he[ut]);const Ue=3*ut,dt=Ue+1;Le.emplaceBack(Ee.uint16[Ue],Ee.uint16[dt],Ee.uint16[dt+1])}return[De,Le]})(ee,se),this.elevatedGlobeTrianglesCenterLongitudes=ee,this.elevatedGlobeIndexBuffer=t.createIndexBuffer(se)}this.elevatedGlobeSegments=hn.simpleSegment(0,0,4225,8192),this.elevatedGlobeGridMatrix=new Float32Array([0,Q/Bt,0,J/Bt,0,0,G,j,0])}prepare(){const t=Object.keys(this.tiles).length!==0;if(this.tileID&&!t)return;const a=this.map.painter.context,u=a.gl;!this._dirty||this.texture instanceof E0||(this.texture?this.texture.update(this.image):(this.texture=new ux(a,this.image,u.RGBA8),this.texture.bind(u.LINEAR,u.CLAMP_TO_EDGE)),this._dirty=!1),t&&this._prepareData(a)}loadTile(t,a){this.tileID&&this.tileID.equals(t.tileID.canonical)?(this.tiles[String(t.tileID.wrap)]=t,t.buckets={},a(null)):(t.state="errored",a(null))}serialize(){return{type:"image",url:this.options.url,coordinates:this.coordinates}}hasTransition(){return!1}getSegmentsForLongitude(t){const a=this.elevatedGlobeSegments;if(!this.elevatedGlobeTrianglesCenterLongitudes||!a)return null;const u=this.elevatedGlobeTrianglesCenterLongitudes;let d=(_=t+180)+360*Math.round((u[0]-_)/360);var _;const v=new hn,S=(B,F)=>{v.segments.push({vertexOffset:0,primitiveOffset:B,vertexLength:a.segments[0].vertexLength,primitiveLength:F,sortKey:void 0,vaos:{}})},E=.51*this.maxLongitudeTriangleSize;if(Math.abs(u[0]-d)<=E){const B=to(u,0,u.length,d+E);return B===u.length||S(B,Wi(u,B+1,u.length,d+360-E)-B),v}d<u[0]&&(d+=360);const R=Wi(u,0,u.length,d-E);if(R===u.length)return S(0,u.length),v;S(0,R-0);const P=to(u,R+1,u.length,d+E);return P!==u.length&&S(P,u.length-P),v}}const RD=(Math.pow(256,2)-1)/16907520;class mT extends Go{constructor(t,a,u,d){super(t,{layout:hT||(hT=new yn({visibility:new At(Ve.layout_raster.visibility)})),paint:fT||(fT=new yn({"raster-opacity":new At(Ve.paint_raster["raster-opacity"]),"raster-color":new lh(Ve.paint_raster["raster-color"]),"raster-color-mix":new At(Ve.paint_raster["raster-color-mix"]),"raster-color-range":new At(Ve.paint_raster["raster-color-range"]),"raster-hue-rotate":new At(Ve.paint_raster["raster-hue-rotate"]),"raster-brightness-min":new At(Ve.paint_raster["raster-brightness-min"]),"raster-brightness-max":new At(Ve.paint_raster["raster-brightness-max"]),"raster-saturation":new At(Ve.paint_raster["raster-saturation"]),"raster-contrast":new At(Ve.paint_raster["raster-contrast"]),"raster-resampling":new At(Ve.paint_raster["raster-resampling"]),"raster-fade-duration":new At(Ve.paint_raster["raster-fade-duration"]),"raster-emissive-strength":new At(Ve.paint_raster["raster-emissive-strength"]),"raster-array-band":new At(Ve.paint_raster["raster-array-band"]),"raster-elevation":new At(Ve.paint_raster["raster-elevation"]),"raster-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},a,u,d),this.updateColorRamp(),this._curRampRange=[NaN,NaN]}getProgramIds(){return["raster"]}hasColorMap(){return!!this._transitionablePaint._values["raster-color"].value.value}tileCoverLift(){return this.paint.get("raster-elevation")}isDraped(t){return!(t&&t._source instanceof pT&&(t._source.onNorthPole||t._source.onSouthPole))&&this.paint.get("raster-elevation")===0}_handleSpecialPaintPropertyUpdate(t){t!=="raster-color"&&t!=="raster-color-range"||(this._curRampRange=[NaN,NaN],this.updateColorRamp())}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}updateColorRamp(t){if(!this.hasColorMap()||!this._curRampRange)return;const a=this._transitionablePaint._values["raster-color"].value.expression,[u,d]=t||this._transitionablePaint._values["raster-color-range"].value.expression.evaluate({zoom:0})||[NaN,NaN];isNaN(u)&&isNaN(d)||u===this._curRampRange[0]&&d===this._curRampRange[1]||(this.colorRamp=Np({expression:a,evaluationKey:"rasterValue",image:this.colorRamp,clips:[{start:u,end:d}],resolution:256}),this.colorRampTexture=null,this._curRampRange=[u,d])}}let gT,_T,yT,vT,xT;class bT extends Go{constructor(t,a,u,d){super(t,{layout:gT||(gT=new yn({visibility:new At(Ve["layout_raster-particle"].visibility)})),paint:_T||(_T=new yn({"raster-particle-array-band":new At(Ve["paint_raster-particle"]["raster-particle-array-band"]),"raster-particle-count":new At(Ve["paint_raster-particle"]["raster-particle-count"]),"raster-particle-color":new lh(Ve["paint_raster-particle"]["raster-particle-color"]),"raster-particle-max-speed":new At(Ve["paint_raster-particle"]["raster-particle-max-speed"]),"raster-particle-speed-factor":new At(Ve["paint_raster-particle"]["raster-particle-speed-factor"]),"raster-particle-fade-opacity-factor":new At(Ve["paint_raster-particle"]["raster-particle-fade-opacity-factor"]),"raster-particle-reset-rate-factor":new At(Ve["paint_raster-particle"]["raster-particle-reset-rate-factor"]),"raster-particle-elevation":new At(Ve["paint_raster-particle"]["raster-particle-elevation"]),"raster-particle-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},a,u,d),this._updateColorRamp(),this.lastInvalidatedAt=Ys.now()}_clear(){this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this.tileFramebuffer&&(this.tileFramebuffer.destroy(),this.tileFramebuffer=null),this.particleFramebuffer&&(this.particleFramebuffer.destroy(),this.particleFramebuffer=null)}onRemove(t){this.colorRampTexture&&this.colorRampTexture.destroy(),this.tileFramebuffer&&this.tileFramebuffer.destroy(),this.particleFramebuffer&&this.particleFramebuffer.destroy()}hasColorMap(){return!!this._transitionablePaint._values["raster-particle-color"].value.value}getProgramIds(){return["rasterParticle"]}hasOffscreenPass(){return this.visibility!=="none"}isDraped(t){return!1}_handleSpecialPaintPropertyUpdate(t){t!=="raster-particle-color"&&t!=="raster-particle-max-speed"||(this._updateColorRamp(),this._invalidateAnimationState()),t==="raster-particle-count"&&this._invalidateAnimationState()}_updateColorRamp(){if(!this.hasColorMap())return;const t=this._transitionablePaint._values["raster-particle-color"].value.expression,a=this._transitionablePaint._values["raster-particle-max-speed"].value.expression.evaluate({zoom:0});this.colorRamp=Np({expression:t,evaluationKey:"rasterParticleSpeed",image:this.colorRamp,clips:[{start:0,end:a}],resolution:256}),this.colorRampTexture=null}_invalidateAnimationState(){this.lastInvalidatedAt=Ys.now()}tileCoverLift(){return this.paint.get("raster-particle-elevation")}}class MD extends Go{constructor(t,a){super(t,{},a,null),this.implementation=t,t.slot&&(this.slot=t.slot)}is3D(t){return this.implementation.renderingMode==="3d"}hasOffscreenPass(){return this.implementation.prerender!==void 0}isDraped(t){return this.implementation.renderToTile!==void 0}shouldRedrape(){return!!this.implementation.shouldRerenderTiles&&this.implementation.shouldRerenderTiles()}recalculate(){}updateTransitions(){}hasTransition(){return!1}serialize(){}onAdd(t){this.implementation.onAdd&&this.implementation.onAdd(t,t.painter.context.gl)}onRemove(t){this.implementation.onRemove&&this.implementation.onRemove(t,t.painter.context.gl)}}function Fx(s,t,a){const u=[0,0,1],d=_l([]);return ku(d,d,a?-Ne(s)+Math.PI:Ne(s)),Fu(d,d,-Ne(t)),gl(u,u,d),Cr(u,u)}const wT={None:0,Model:1,Symbol:2,FillExtrusion:4};class V1{constructor(t,a,u,d){this.message=(t?`${t}: `:"")+u,d&&(this.identifier=d),a!=null&&a.__line__&&(this.line=a.__line__)}}function kx(s,t){const a=s.indexOf("://")===-1;try{return new URL(s,a&&t?"http://example.com":void 0),!0}catch{return!1}}class ST{constructor(t,a){this.feature=t,this.instancedDataOffset=a,this.instancedDataCount=0,this.rotation=[0,0,0],this.scale=[1,1,1],this.translation=[0,0,0]}}class TT{constructor(){this.instancedDataArray=new Cp,this.instancesEvaluatedElevation=[],this.features=[],this.idToFeaturesIndex={}}}class Nx{constructor(t){this.zoom=t.zoom,this.canonical=t.canonical,this.layers=t.layers,this.layerIds=this.layers.map((a=>a.fqid)),this.projection=t.projection,this.index=t.index,this.worldview=t.worldview,this.hasZoomDependentProperties=this.layers[0].isZoomDependent(),this.stateDependentLayerIds=this.layers.filter((a=>a.isStateDependent())).map((a=>a.id)),this.hasPattern=!1,this.instancesPerModel={},this.validForExaggeration=0,this.maxVerticalOffset=0,this.maxScale=0,this.maxHeight=0,this.lookupDim=this.zoom>this.canonical.z+1?0:this.zoom>this.canonical.z?256:this.zoom>15?75:100,this.instanceCount=0,this.terrainElevationMin=0,this.terrainElevationMax=0,this.validForDEMTile={id:null,timestamp:0},this.modelUris=[],this.modelsRequested=!1,this.activeReplacements=[],this.replacementUpdateTime=0,this.styleDefinedModelURLs=t.styleDefinedModelURLs}updateFootprints(t,a){}populate(t,a,u,d){this.tileToMeter=Ge(u);const _=this.layers[0]._featureFilter.needGeometry;this.lookup=new Uint8Array(this.lookupDim*this.lookupDim);for(const{feature:v,id:S,index:E,sourceLayerIndex:R}of t){const P=S??(v.properties&&v.properties.hasOwnProperty("id")?v.properties.id:void 0),B=ft(v,_);if(!this.layers[0]._featureFilter.filter(new Hi(this.zoom,{worldview:this.worldview}),B,u))continue;const F={id:P,sourceLayerIndex:R,index:E,geometry:_?B.geometry:wt(v,u,d),properties:v.properties,type:v.type,patterns:{}},j=this.addFeature(F,F.geometry,B);j&&a.featureIndex.insert(v,F.geometry,E,R,this.index,this.instancesPerModel[j].instancedDataArray.length,Bt/32)}this.lookup=null}update(t,a,u,d){for(const _ in this.instancesPerModel){const v=this.instancesPerModel[_];for(const S in t)v.idToFeaturesIndex.hasOwnProperty(S)&&(this.evaluate(v.features[v.idToFeaturesIndex[S]],t[S],v,!0),this.uploaded=!1)}this.maxHeight=0}updateZoomBasedPaintProperties(){if(!this.hasZoomDependentProperties)return!1;let t=!1;for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];for(const d of u.features){const _=this.layers[0],v=d.feature,S=this.canonical,E=_.paint.get("model-rotation").evaluate(v,{},S),R=_.paint.get("model-scale").evaluate(v,{},S),P=_.paint.get("model-translation").evaluate(v,{},S);Va(d.rotation,E)&&Va(d.scale,R)&&Va(d.translation,P)||(this.evaluate(d,d.featureStates,u,!0),t=!0)}}return t}updateReplacement(t,a,u,d){if(a.updateTime===this.replacementUpdateTime)return!1;this.replacementUpdateTime=a.updateTime;const _=a.getReplacementRegionsForTile(t.toUnwrapped(),!0);if(vf(this.activeReplacements,_))return!1;this.activeReplacements=_;let v=!1;for(const S in this.instancesPerModel){const E=this.instancesPerModel[S],R=E.instancedDataArray;for(const P of E.features){const B=P.instancedDataOffset,F=P.instancedDataCount;for(let j=0;j<F;j++){const G=16*(j+B);let Q=R.float32[G+0];const J=Q>Bt;Q=J?Q-Bt:Q;const ee=Math.floor(Q),se=R.float32[G+1];let le=!1;for(const he of this.activeReplacements)if(!Qm(he,u,wT.Model,d)&&!(he.min.x>ee||ee>he.max.x||he.min.y>se||se>he.max.y)&&(le=Km(v0(ee,se,t.canonical,he.footprintTileId.canonical),he.footprint),le))break;R.float32[G]=le?Q+Bt:Q,v=v||le!==J}}}return v}isEmpty(){for(const t in this.instancesPerModel)if(this.instancesPerModel[t].instancedDataArray.length!==0)return!1;return!0}uploadPending(){return!this.uploaded}upload(t){if(!this.uploaded)for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length<0||u.instancedDataArray.length===0||(u.instancedDataBuffer?u.instancedDataBuffer.updateData(u.instancedDataArray):u.instancedDataBuffer=t.createVertexBuffer(u.instancedDataArray,oM.members,!0,void 0,this.instanceCount))}this.uploaded=!0}destroy(){for(const a in this.instancesPerModel){const u=this.instancesPerModel[a];u.instancedDataArray.length!==0&&u.instancedDataBuffer&&u.instancedDataBuffer.destroy()}const t=this.layers[0].modelManager;if(t&&this.modelUris&&this.modelsRequested)for(const a of this.modelUris)t.removeModel(a,"",!0)}addFeature(t,a,u){const d=this.layers[0],_=d.layout.get("model-id").evaluate(u,{},this.canonical);if(!_)return ri(`modelId is not evaluated for layer ${d.id} and it is not going to get rendered.`),_;(kx(_,!1)||this.styleDefinedModelURLs[_]!==void 0)&&(this.modelUris.includes(_)||this.modelUris.push(_)),this.instancesPerModel[_]||(this.instancesPerModel[_]=new TT);const v=this.instancesPerModel[_],S=v.instancedDataArray,E=new ST(u,S.length);for(const R of a)for(const P of R){if(P.x<0||P.x>=Bt||P.y<0||P.y>=Bt)continue;if(this.lookupDim!==0){const F=(this.lookupDim-1)/Bt,j=this.lookupDim*(P.y*F|0)+P.x*F|0;if(this.lookup){if(this.lookup[j]!==0)continue;this.lookup[j]=1}}this.instanceCount++;const B=S.length;S.resize(B+1),v.instancesEvaluatedElevation.push(0),S.float32[16*B]=P.x,S.float32[16*B+1]=P.y}return E.instancedDataCount=v.instancedDataArray.length-E.instancedDataOffset,E.instancedDataCount>0&&(t.id&&(v.idToFeaturesIndex[t.id]=v.features.length),v.features.push(E),this.evaluate(E,{},v,!1)),_}getModelUris(){return this.modelUris}evaluate(t,a,u,d){const _=this.layers[0],v=t.feature,S=this.canonical,E=t.rotation=_.paint.get("model-rotation").evaluate(v,a,S),R=t.scale=_.paint.get("model-scale").evaluate(v,a,S),P=t.translation=_.paint.get("model-translation").evaluate(v,a,S),B=_.paint.get("model-color").evaluate(v,a,S);B.a=_.paint.get("model-color-mix-intensity").evaluate(v,a,S);const F=[];this.maxVerticalOffset<P[2]&&(this.maxVerticalOffset=P[2]),this.maxScale=Math.max(Math.max(this.maxScale,R[0]),Math.max(R[1],R[2])),W2(F,E,R);const j=Math.round(100*B.a)+B.b/1.05;for(let G=0;G<t.instancedDataCount;++G){const Q=t.instancedDataOffset+G,J=16*Q,ee=u.instancedDataArray.float32;let se=0;d&&(se=ee[J+6]-u.instancesEvaluatedElevation[Q]);const le=0|ee[J+1];ee[J]=(0|ee[J])+B.r/1.05,ee[J+1]=le+B.g/1.05,ee[J+2]=j,ee[J+3]=1/(S.z>10?this.tileToMeter:Ge(S,le)),ee[J+4]=P[0],ee[J+5]=P[1],ee[J+6]=P[2]+se,ee[J+7]=F[0],ee[J+8]=F[1],ee[J+9]=F[2],ee[J+10]=F[4],ee[J+11]=F[5],ee[J+12]=F[6],ee[J+13]=F[8],ee[J+14]=F[9],ee[J+15]=F[10],u.instancesEvaluatedElevation[Q]=P[2]}}}let AT,ET;$t(Nx,"ModelBucket",{omit:["layers"]}),$t(TT,"PerModelAttributes"),$t(ST,"ModelFeature");class b_{constructor(t,a,u){this._demTile=t,this._dem=this._demTile.dem,this._scale=a,this._offset=u}static create(t,a,u){const d=u||t.findDEMTileFor(a);if(!d||!d.dem)return;const _=d.dem,v=d.tileID,S=1<<a.canonical.z-v.canonical.z;return new b_(d,_.dim/Bt/S,[(a.canonical.x/S-v.canonical.x)*_.dim,(a.canonical.y/S-v.canonical.y)*_.dim])}tileCoordToPixel(t,a){const u=a*this._scale+this._offset[1];return new Tt(Math.floor(t*this._scale+this._offset[0]),Math.floor(u))}getElevationAt(t,a,u,d){const _=t*this._scale+this._offset[0],v=a*this._scale+this._offset[1],S=Math.floor(_),E=Math.floor(v),R=this._dem;return d=!!d,u?xr(xr(R.get(S,E,d),R.get(S,E+1,d),v-E),xr(R.get(S+1,E,d),R.get(S+1,E+1,d),v-E),_-S):R.get(S,E,d)}getElevationAtPixel(t,a,u){return this._dem.get(t,a,!!u)}getMeterToDEM(t){return(1<<this._demTile.tileID.canonical.z)*ge(1,t)*this._dem.stride}}const Vx=new Float32Array(262144),cg=new Uint8Array(262144);function CT(s){let t=0;if(s.meshes)for(const a of s.meshes)t=Math.max(t,a.aabb.max[2]);if(s.children)for(const a of s.children)t=Math.max(t,CT(a));return t}function IT(s,t,a){if(s.meshes)for(const u of s.meshes){if(u.aabb.min[0]===1/0)continue;const d=br.applyTransform(u.aabb,s.matrix);a.insert(t,d.min[0],d.min[1],d.max[0],d.max[1])}if(s.children)for(const u of s.children)IT(u,t,a)}const RT=["","wall","door","roof","window","lamp","logo"];class MT{constructor(t){this.node=t,this.evaluatedRMEA=[[1,0,0,1],[1,0,0,1],[1,0,0,1],[1,0,0,1],[.4,1,0,1],[1,0,0,1],[1,0,0,1]],this.hiddenByReplacement=!1,this.evaluatedTranslation=[0,0,0],this.evaluatedScale=[1,1,1],this.evaluatedColor=[],this.emissionHeightBasedParams=[],this.cameraCollisionOpacity=1,this.feature={type:"Point",id:t.id,geometry:[],properties:{height:CT(t)}},this.aabb=this._getLocalBounds(),this.state=null}_getLocalBounds(){if(!this.node.meshes)return new br([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);if(!this.aabb){let t=0;const a=new br([1/0,1/0,1/0],[-1/0,-1/0,-1/0]);for(const u of this.node.meshes)this.node.lightMeshIndex!==t&&(u.transformedAabb=br.applyTransformFast(u.aabb,this.node.matrix),a.encapsulate(u.transformedAabb)),t++;this.aabb=a}return this.aabb}}class U1{constructor(t,a,u,d,_,v,S,E){this.id=u,this.layers=t,this.layerIds=this.layers.map((R=>R.fqid)),this.stateDependentLayerIds=this.layers.filter((R=>R.isStateDependent())).map((R=>R.id)),this.modelTraits|=m_.CoordinateSpaceTile,this.uploaded=!1,this.hasPattern=!1,d&&(this.modelTraits|=m_.HasMapboxMeshFeatures),_&&(this.modelTraits|=m_.HasMeshoptCompression),this.zoom=-1,this.terrainExaggeration=1,this.projection={name:"mercator"},this.replacementUpdateTime=0,this.elevationReadFromZ=255,this.brightness=v,this.worldview=E,this.dirty=!0,this.needsUpload=!1,this.filter=null,this.nodesInfo=[];for(const R of a)this.nodesInfo.push(new MT(R)),IT(R,S.featureIndexArray.length,S.grid),S.featureIndexArray.emplaceBack(this.nodesInfo.length-1,0,S.bucketLayerIDs.length-1,0);this.states={}}updateFootprints(t,a){for(const u of this.getNodesInfo()){const d=u.node;d.footprint&&a.push({footprint:d.footprint,id:t})}}update(t){const a=Object.keys(t).length!==0;if(a&&!this.stateDependentLayers.length)return;const u=a?this.stateDependentLayers:this.layers;if(!Ws(t,this.states))for(const d of u)this.evaluate(d,t);this.states=structuredClone(t)}populate(){console.log("populate 3D model bucket")}uploadPending(){return!this.uploaded||this.needsUpload}upload(t){if(!this.needsUpload)return;const a=this.getNodesInfo();for(const u of a){const d=u.node;this.uploaded?this.updatePbrBuffer(d):dx(d,t,!0)}for(const u of a)b1(u.node);this.uploaded=!0,this.needsUpload=!1}updatePbrBuffer(t){let a=!1;if(!t.meshes)return a;for(const u of t.meshes)u.pbrBuffer&&(u.pbrBuffer.updateData(u.featureArray),a=!0);return a}needsReEvaluation(t,a,u){const d=t.transform.projectionOptions,_=t.style.getBrightness(),v=this.brightness!==_;if(!this.uploaded||this.dirty||d.name!==this.projection.name||V0(u.paint.get("model-color").value,v)||V0(u.paint.get("model-color-mix-intensity").value,v)||V0(u.paint.get("model-roughness").value,v)||V0(u.paint.get("model-emissive-strength").value,v)||V0(u.paint.get("model-height-based-emissive-strength-multiplier").value,v)){this.projection=d,this.brightness=_;const S=this.getNodesInfo();for(const E of S)E.state=null;return!0}return!1}evaluateTransform(t,a){if(t.transform.zoom===this.zoom)return;this.zoom=t.transform.zoom;const u=this.getNodesInfo(),d=this.id.canonical;for(const _ of u){const v=_.feature;_.evaluatedTranslation=a.paint.get("model-translation").evaluate(v,{},d),_.evaluatedScale=a.paint.get("model-scale").evaluate(v,{},d)}}evaluate(t,a){const u=this.getNodesInfo();for(const d of u){if(!d.node.meshes)continue;const _=d.feature,v=a&&a[_.id];if(Ws(v,d.state))continue;d.state=structuredClone(v);const S=d.node.meshes&&d.node.meshes[0].featureData,E=d.evaluatedColor[2],R=d.evaluatedRMEA[2],P=this.id.canonical;if(d.hasTranslucentParts=!1,S){for(let B=0;B<RT.length;B++){const F=RT[B];F.length&&(_.properties.part=F);const j=t.paint.get("model-color").evaluate(_,v,P).toPremultipliedRenderColor(null),G=t.paint.get("model-color-mix-intensity").evaluate(_,v,P);d.evaluatedColor[B]=[j.r,j.g,j.b,G],d.evaluatedRMEA[B][0]=t.paint.get("model-roughness").evaluate(_,v,P),d.evaluatedRMEA[B][2]=t.paint.get("model-emissive-strength").evaluate(_,v,P),d.evaluatedRMEA[B][3]=j.a,d.emissionHeightBasedParams[B]=t.paint.get("model-height-based-emissive-strength-multiplier").evaluate(_,v,P),!d.hasTranslucentParts&&j.a<1&&(d.hasTranslucentParts=!0)}delete _.properties.part,OD(d,E!==d.evaluatedColor[2]||R!==d.evaluatedRMEA[2],this.modelTraits)}else d.evaluatedRMEA[0][2]=t.paint.get("model-emissive-strength").evaluate(_,v,P);d.evaluatedTranslation=t.paint.get("model-translation").evaluate(_,v,P),d.evaluatedScale=t.paint.get("model-scale").evaluate(_,v,P),this.updatePbrBuffer(d.node)||(this.needsUpload=!0)}this.dirty=!1}elevationUpdate(t,a,u,d){const _=t.findDEMTileFor(u);if(_&&(_.tileID.canonical!==this.terrainTile||a!==this.terrainExaggeration)){if(_.dem&&_.tileID.overscaledZ!==this.elevationReadFromZ){this.elevationReadFromZ=_.tileID.overscaledZ;const v=b_.create(t,u,_);if(!v)return;this.modelTraits&m_.HasMapboxMeshFeatures&&this.updateDEM(t,v,u,d);for(const S of this.getNodesInfo()){const E=S.node;if(!E.footprint||!E.footprint.vertices||!E.footprint.vertices.length)continue;const R=E.footprint.vertices;let P=v.getElevationAt(R[0].x,R[0].y,!0,!0);for(let B=1;B<R.length;B++)P=Math.min(P,v.getElevationAt(R[B].x,R[B].y,!0,!0));E.elevation=P}}this.terrainTile=_.tileID.canonical,this.terrainExaggeration=a}}updateDEM(t,a,u,d){let _=a._dem._modifiedForSources[d];if(_===void 0&&(a._dem._modifiedForSources[d]=[],_=a._dem._modifiedForSources[d]),_.includes(u.canonical))return;const v=a._dem.dim;_.push(u.canonical);let S=!1;for(const E of this.getNodesInfo()){const R=E.node;if(!R.footprint||!R.footprint.grid)continue;const P=R.footprint.grid,B=a.tileCoordToPixel(P.min.x,P.min.y),F=a.tileCoordToPixel(P.max.x,P.max.y),j=Math.min(Math.min(v-F.y,B.x),Math.min(B.y,v-F.x));if(j<0)continue;const G=Ie(j,2,5);let Q=Math.max(0,B.x-G),J=Math.max(0,B.y-G),ee=Math.min(F.x+G,v-1),se=Math.min(F.y+G,v-1);for(let Ce=J;Ce<=se;++Ce)for(let De=Q;De<=ee;++De)cg[Ce*v+De]=255;let le=0,he=0;for(let Ce=0;Ce<P.cellsY;++Ce)for(let De=0;De<P.cellsX;++De){if(!P.cells[Ce*P.cellsX+De])continue;const Le=a.tileCoordToPixel(P.min.x+De/P.xScale,P.min.y+Ce/P.yScale),Fe=a.tileCoordToPixel(P.min.x+(De+1)/P.xScale,P.min.y+(Ce+1)/P.yScale);for(let ut=Le.y;ut<=Math.min(Fe.y+1,v-1);++ut)for(let Ue=Le.x;Ue<=Math.min(Fe.x+1,v-1);++Ue)cg[ut*v+Ue]===255&&(cg[ut*v+Ue]=0,le+=a.getElevationAtPixel(Ue,ut),he++)}const Ee=le/he;Q=Math.max(1,B.x-G),J=Math.max(1,B.y-G),ee=Math.min(F.x+G,v-2),se=Math.min(F.y+G,v-2),S=!0;for(let Ce=J;Ce<=se;++Ce)for(let De=Q;De<=ee;++De)cg[Ce*v+De]===0&&(Vx[Ce*v+De]=a._dem.set(De,Ce,Ee));for(let Ce=1;Ce<G;++Ce){Q=Math.max(1,B.x-Ce),J=Math.max(1,B.y-Ce),ee=Math.min(F.x+Ce,v-2),se=Math.min(F.y+Ce,v-2);for(let De=J;De<=se;++De)for(let Le=Q;Le<=ee;++Le){const Fe=De*v+Le;if(cg[Fe]===255){let ut=0,Ue=0,dt=-1,St=-1;for(let gt=-1;gt<=1;++gt)for(let yt=-1;yt<=1;++yt){const Rt=(De+gt)*v+Le+yt;if(cg[Rt]>=Ce)continue;const lt=Vx[Rt],vt=Math.abs(lt);vt>Ue&&(ut=lt,Ue=vt,dt=yt,St=gt)}if(Ue>.1){const gt=1-(Ce+.5*Math.abs(dt*St))/G;let yt=a._dem.get(Le,De)+ut*gt;const Rt=a._dem.get(Le+dt,De+St),lt=a._dem.get(Le-dt,De-St,!0);(yt-Rt)*(yt-lt)>0&&(yt=(Rt+lt)/2),Vx[Fe]=a._dem.set(Le,De,yt),cg[Fe]=Ce}}}}}S&&(a._demTile.needsDEMTextureUpload=!0,a._dem._timestamp=Ys.now())}setFilter(t){this.filter=t?ch(t):null}getNodesInfo(){return this.filter?this.nodesInfo.filter((t=>this.filter.filter(new Hi(this.id.overscaledZ,{worldview:this.worldview}),t.feature,this.id.canonical))):this.nodesInfo}destroy(){const t=this.getNodesInfo();for(const a of t)b1(a.node),px(a.node)}isEmpty(){return!this.nodesInfo.length}updateReplacement(t,a){if(a.updateTime===this.replacementUpdateTime)return;this.replacementUpdateTime=a.updateTime;const u=a.getReplacementRegionsForTile(t.toUnwrapped());for(const d of this.getNodesInfo()){const _=d.node.footprint;d.hiddenByReplacement=!!_&&!u.find((v=>v.footprint===_))}}getHeightAtTileCoord(t,a){const u=[],d=[0,0,0],_=ne([]);for(const v of this.getNodesInfo()){const S=v.node.meshes[0],E=S.transformedAabb;if(t<E.min[0]||a<E.min[1]||t>E.max[0]||a>E.max[1])continue;if(v.node.hidden===!0)return{height:1/0,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};be(_,v.node.matrix),d[0]=t,d[1]=a,Tn(d,d,_);const R=(d[0]-S.aabb.min[0])/(S.aabb.max[0]-S.aabb.min[0])*ag|0,P=Math.min(63,(d[1]-S.aabb.min[1])/(S.aabb.max[1]-S.aabb.min[1])*ag|0)*ag+Math.min(63,R),B=S.heightmap[P];if(!(B<0&&v.node.footprint))return v.hiddenByReplacement?void 0:{height:B,maxHeight:v.feature.properties.height,hidden:!1,verticalScale:v.evaluatedScale[2]};if(v.node.footprint.grid.query(new Tt(t,a),new Tt(t,a),u),u.length>0)return{height:void 0,maxHeight:v.feature.properties.height,hidden:v.hiddenByReplacement,verticalScale:v.evaluatedScale[2]}}}}function V0(s,t){return s instanceof Rl&&!s.isLightConstant&&t}function DD(s,t,a,u,d,_,v,S){let E=(61440&t|(61440&t)>>4)>>8,R=(3840&t|(3840&t)>>4)>>4,P=240&t|(240&t)>>4;a[3]>0&&(E=xr(E,255*a[0],a[3]),R=xr(R,255*a[1],a[3]),P=xr(P,255*a[2],a[3]));const B=E<<8|R,F=P<<8|Math.floor(255*u[3]),j=(function(Ce){const De=Ie(Ce,0,2);return Math.min(Math.round(.5*De*255),255)})(u[2])<<8|15*u[0]<<4|15*u[1],G=Ie(d[0],0,1),Q=Ie(d[1],0,1),J=Ie(d[2],0,1),ee=Ie(d[3],0,1);let se,le,he,Ee;if(G!==Q&&v!==_&&Q!==G){const Ce=v-_;le=1/(Ce*(Q-G)),he=-(_+Ce*G)/(Ce*(Q-G));const De=Ie(d[4],-1,1);Ee=Math.pow(10,De),se=255*J<<8|255*ee}else se=65535,le=0,he=1,Ee=1;if(s.emplaceBack(B,F,j,se,le,he,Ee),S){const Ce=S.length;S.clear();for(let De=0;De<Ce;De++)S.emplaceBack(B,F,j,se,le,he,Ee)}}function OD(s,t,a){const u=s.node;let d=0;const _=a&m_.HasMeshoptCompression;for(const v of u.meshes){if(u.lights&&u.lightMeshIndex===d||!v.featureData)continue;v.featureArray=new so,v.featureArray.reserve(v.featureData.length);let S=t;for(const E of v.featureData){const R=_?65535&E:E>>16&65535,P=_?E>>16&65535:65535&E,B=(15&P)<8?15&P:0,F=s.evaluatedRMEA[B],j=s.evaluatedColor[B],G=s.emissionHeightBasedParams[B];let Q;if(S&&B===2&&u.lights&&(Q=new so,Q.resize(10*u.lights.length)),DD(v.featureArray,R,j,F,G,v.aabb.min[2],v.aabb.max[2],Q),Q&&S){S=!1;const J=u.meshes[u.lightMeshIndex];J.featureArray=Q,J.featureArray._trim()}}v.featureArray._trim(),d++}}function DT(s,t,a,u){const d=1<<s.z;t.lat=ye((u/Bt+s.y)/d),t.lng=Te((a/Bt+s.x)/d)}function PD(s,t,a,u){const d=s.getNodesInfo()[t];if(!d||d.hiddenByReplacement||!d.node.meshes)return;let _=Number.MAX_VALUE;const v=d.node,S=a.tile,E=u.calculatePosMatrix(S.tileID.toUnwrapped(),u.worldSize),R=d.evaluatedScale;let P=0;u.elevation&&v.elevation&&(P=v.elevation*u.elevation.exaggeration()),we(E,E,[(v.anchor?v.anchor[0]:0)*(R[0]-1),(v.anchor?v.anchor[1]:0)*(R[1]-1),P]),Pe(E,E,R);const B=a.queryGeometry,F=B.isPointQuery()?B.screenBounds:B.screenGeometry,j=function(Q){const J=ve([],E,Q.matrix);ve(J,u.expandedFarZProjMatrix,J);for(let ee=0;ee<Q.meshes.length;++ee){const se=Q.meshes[ee];if(ee===Q.lightMeshIndex)continue;const le=Y2(F,u,J,se.aabb);le!=null&&(_=Math.min(le,_))}if(Q.children)for(const ee of Q.children)j(ee)};if(j(v),_===Number.MAX_VALUE)return;const G=new W(0,0);return DT(S.tileID.canonical,G,d.node.anchor[0],d.node.anchor[1]),{intersectionZ:_,position:G,feature:d.feature}}$t(U1,"Tiled3dModelBucket",{omit:["layers"]}),$t(MT,"Tiled3dModelFeature");const LD={circle:class extends Go{constructor(s,t,a,u){super(s,{layout:Bc||(Bc=new yn({"circle-sort-key":new Ut(Ve.layout_circle["circle-sort-key"]),"circle-elevation-reference":new At(Ve.layout_circle["circle-elevation-reference"]),visibility:new At(Ve.layout_circle.visibility)})),paint:kl||(kl=new yn({"circle-radius":new Ut(Ve.paint_circle["circle-radius"]),"circle-color":new Ut(Ve.paint_circle["circle-color"]),"circle-blur":new Ut(Ve.paint_circle["circle-blur"]),"circle-opacity":new Ut(Ve.paint_circle["circle-opacity"]),"circle-translate":new At(Ve.paint_circle["circle-translate"]),"circle-translate-anchor":new At(Ve.paint_circle["circle-translate-anchor"]),"circle-pitch-scale":new At(Ve.paint_circle["circle-pitch-scale"]),"circle-pitch-alignment":new At(Ve.paint_circle["circle-pitch-alignment"]),"circle-stroke-width":new Ut(Ve.paint_circle["circle-stroke-width"]),"circle-stroke-color":new Ut(Ve.paint_circle["circle-stroke-color"]),"circle-stroke-opacity":new Ut(Ve.paint_circle["circle-stroke-opacity"]),"circle-emissive-strength":new At(Ve.paint_circle["circle-emissive-strength"]),"circle-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"circle-stroke-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}createBucket(s){return new xn(s)}queryRadius(s){const t=s;return al("circle-radius",this,t)+al("circle-stroke-width",this,t)+Pc(this.paint.get("circle-translate"))}queryIntersectsFeature(s,t,a,u,d,_,v,S){const E=Ma(this.paint.get("circle-translate"),this.paint.get("circle-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),R=this.paint.get("circle-radius").evaluate(t,a)+this.paint.get("circle-stroke-width").evaluate(t,a);return Fp(s,u,_,v,S,this.paint.get("circle-pitch-alignment")==="map",this.paint.get("circle-pitch-scale")==="map",E,R)}getProgramIds(){return["circle"]}getDefaultProgramParams(s,t,a){const u=Gy(this);return{config:new Su(this,{zoom:t,lut:a}),defines:u,overrideFog:!1}}is3D(s){return!s&&!!this.layout&&this.layout.get("circle-elevation-reference")!=="none"}hasElevation(){return this.layout&&this.layout.get("circle-elevation-reference")!=="none"}},heatmap:class extends Go{createBucket(s){return new $m(s)}constructor(s,t,a,u){super(s,{layout:Yg||(Yg=new yn({visibility:new At(Ve.layout_heatmap.visibility)})),paint:c0||(c0=new yn({"heatmap-radius":new Ut(Ve.paint_heatmap["heatmap-radius"]),"heatmap-weight":new Ut(Ve.paint_heatmap["heatmap-weight"]),"heatmap-intensity":new At(Ve.paint_heatmap["heatmap-intensity"]),"heatmap-color":new lh(Ve.paint_heatmap["heatmap-color"]),"heatmap-opacity":new At(Ve.paint_heatmap["heatmap-opacity"]),"heatmap-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._updateColorRamp()}_handleSpecialPaintPropertyUpdate(s){s==="heatmap-color"&&this._updateColorRamp()}_updateColorRamp(){this.colorRamp=Np({expression:this._transitionablePaint._values["heatmap-color"].value.expression,evaluationKey:"heatmapDensity",image:this.colorRamp}),this.colorRampTexture=null}resize(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null)}_clear(){this.heatmapFbo&&(this.heatmapFbo.destroy(),this.heatmapFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}queryRadius(s){return al("heatmap-radius",this,s)}queryIntersectsFeature(s,t,a,u,d,_,v,S){const E=this.paint.get("heatmap-radius").evaluate(t,a);return Fp(s,u,_,v,S,!0,!0,new Tt(0,0),E)}hasOffscreenPass(){return this.paint.get("heatmap-opacity")!==0&&this.visibility!=="none"}getProgramIds(){return["heatmap","heatmapTexture"]}getDefaultProgramParams(s,t,a){return s==="heatmap"?{config:new Su(this,{zoom:t,lut:a}),overrideFog:!1}:{}}},hillshade:class extends Go{constructor(s,t,a,u){super(s,{layout:Qg||(Qg=new yn({visibility:new At(Ve.layout_hillshade.visibility)})),paint:kp||(kp=new yn({"hillshade-illumination-direction":new At(Ve.paint_hillshade["hillshade-illumination-direction"]),"hillshade-illumination-anchor":new At(Ve.paint_hillshade["hillshade-illumination-anchor"]),"hillshade-exaggeration":new At(Ve.paint_hillshade["hillshade-exaggeration"]),"hillshade-shadow-color":new At(Ve.paint_hillshade["hillshade-shadow-color"]),"hillshade-highlight-color":new At(Ve.paint_hillshade["hillshade-highlight-color"]),"hillshade-accent-color":new At(Ve.paint_hillshade["hillshade-accent-color"]),"hillshade-emissive-strength":new At(Ve.paint_hillshade["hillshade-emissive-strength"]),"hillshade-shadow-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"hillshade-highlight-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"hillshade-accent-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}shouldRedrape(){return this.hasOffscreenPass()&&this.paint.get("hillshade-illumination-anchor")==="viewport"}hasOffscreenPass(){return this.paint.get("hillshade-exaggeration")!==0&&this.visibility!=="none"}getProgramIds(){return["hillshade","hillshadePrepare"]}getDefaultProgramParams(s,t,a){return{overrideFog:!1}}},fill:class extends Go{constructor(s,t,a,u){super(s,{layout:r1||(r1=new yn({"fill-sort-key":new Ut(Ve.layout_fill["fill-sort-key"]),visibility:new At(Ve.layout_fill.visibility),"fill-elevation-reference":new At(Ve.layout_fill["fill-elevation-reference"]),"fill-construct-bridge-guard-rail":new Ut(Ve.layout_fill["fill-construct-bridge-guard-rail"])})),paint:Rd||(Rd=new yn({"fill-antialias":new At(Ve.paint_fill["fill-antialias"]),"fill-opacity":new Ut(Ve.paint_fill["fill-opacity"]),"fill-color":new Ut(Ve.paint_fill["fill-color"]),"fill-outline-color":new Ut(Ve.paint_fill["fill-outline-color"]),"fill-translate":new At(Ve.paint_fill["fill-translate"]),"fill-translate-anchor":new At(Ve.paint_fill["fill-translate-anchor"]),"fill-pattern":new Ut(Ve.paint_fill["fill-pattern"]),"fill-pattern-cross-fade":new At(Ve.paint_fill["fill-pattern-cross-fade"]),"fill-emissive-strength":new At(Ve.paint_fill["fill-emissive-strength"]),"fill-z-offset":new Ut(Ve.paint_fill["fill-z-offset"]),"fill-bridge-guard-rail-color":new Ut(Ve.paint_fill["fill-bridge-guard-rail-color"]),"fill-tunnel-structure-color":new Ut(Ve.paint_fill["fill-tunnel-structure-color"]),"fill-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-outline-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-bridge-guard-rail-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-tunnel-structure-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}getProgramIds(){const s=this.paint.get("fill-pattern"),t=s&&s.constantOr(1),a=[t?"fillPattern":"fill"];return this.paint.get("fill-antialias")&&a.push(t&&!this.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline"),a}getDefaultProgramParams(s,t,a){return{config:new Su(this,{zoom:t,lut:a}),overrideFog:!1}}recalculate(s,t){super.recalculate(s,t);const a=this.paint._values["fill-outline-color"];a.value.kind==="constant"&&a.value.value===void 0&&(this.paint._values["fill-outline-color"]=this.paint._values["fill-color"])}createBucket(s){return new a_(s)}queryRadius(){return Pc(this.paint.get("fill-translate"))}queryIntersectsFeature(s,t,a,u,d,_){return!s.queryGeometry.isAboveHorizon&&Ia(Lc(s.tilespaceGeometry,this.paint.get("fill-translate"),this.paint.get("fill-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),u)}isTileClipped(){return this.paint.get("fill-z-offset").constantOr(1)===0}is3D(s){if(this.paint.get("fill-z-offset").constantOr(1)!==0)return!0;const t=this.layout&&this.layout.get("fill-elevation-reference")!=="none";return s!=null?t&&!s:t}hasElevation(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}hasShadowPass(){return this.layout&&this.layout.get("fill-elevation-reference")!=="none"}},"fill-extrusion":class extends Go{constructor(s,t,a,u){super(s,{layout:p1||(p1=new yn({visibility:new At(Ve["layout_fill-extrusion"].visibility),"fill-extrusion-edge-radius":new At(Ve["layout_fill-extrusion"]["fill-extrusion-edge-radius"])})),paint:og||(og=new yn({"fill-extrusion-opacity":new At(Ve["paint_fill-extrusion"]["fill-extrusion-opacity"]),"fill-extrusion-color":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-color"]),"fill-extrusion-translate":new At(Ve["paint_fill-extrusion"]["fill-extrusion-translate"]),"fill-extrusion-translate-anchor":new At(Ve["paint_fill-extrusion"]["fill-extrusion-translate-anchor"]),"fill-extrusion-pattern":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-pattern"]),"fill-extrusion-pattern-cross-fade":new At(Ve["paint_fill-extrusion"]["fill-extrusion-pattern-cross-fade"]),"fill-extrusion-height":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-height"]),"fill-extrusion-base":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-base"]),"fill-extrusion-height-alignment":new At(Ve["paint_fill-extrusion"]["fill-extrusion-height-alignment"]),"fill-extrusion-base-alignment":new At(Ve["paint_fill-extrusion"]["fill-extrusion-base-alignment"]),"fill-extrusion-vertical-gradient":new At(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-gradient"]),"fill-extrusion-ambient-occlusion-intensity":new At(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-intensity"]),"fill-extrusion-ambient-occlusion-radius":new At(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-radius"]),"fill-extrusion-ambient-occlusion-wall-radius":new At(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-wall-radius"]),"fill-extrusion-ambient-occlusion-ground-radius":new At(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-radius"]),"fill-extrusion-ambient-occlusion-ground-attenuation":new At(Ve["paint_fill-extrusion"]["fill-extrusion-ambient-occlusion-ground-attenuation"]),"fill-extrusion-flood-light-color":new At(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-color"]),"fill-extrusion-flood-light-intensity":new At(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-intensity"]),"fill-extrusion-flood-light-wall-radius":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-wall-radius"]),"fill-extrusion-flood-light-ground-radius":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-radius"]),"fill-extrusion-flood-light-ground-attenuation":new At(Ve["paint_fill-extrusion"]["fill-extrusion-flood-light-ground-attenuation"]),"fill-extrusion-vertical-scale":new At(Ve["paint_fill-extrusion"]["fill-extrusion-vertical-scale"]),"fill-extrusion-rounded-roof":new At(Ve["paint_fill-extrusion"]["fill-extrusion-rounded-roof"]),"fill-extrusion-cutoff-fade-range":new At(Ve["paint_fill-extrusion"]["fill-extrusion-cutoff-fade-range"]),"fill-extrusion-emissive-strength":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-emissive-strength"]),"fill-extrusion-line-width":new Ut(Ve["paint_fill-extrusion"]["fill-extrusion-line-width"]),"fill-extrusion-cast-shadows":new At(Ve["paint_fill-extrusion"]["fill-extrusion-cast-shadows"]),"fill-extrusion-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"fill-extrusion-flood-light-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new tg(s)}queryRadius(){return Pc(this.paint.get("fill-extrusion-translate"))}is3D(s){return!0}hasShadowPass(){return this.paint.get("fill-extrusion-cast-shadows")}cutoffRange(){return this.paint.get("fill-extrusion-cutoff-fade-range")}canCastShadows(){return!0}getProgramIds(){return[this.paint.get("fill-extrusion-pattern").constantOr(1)?"fillExtrusionPattern":"fillExtrusion"]}queryIntersectsFeature(s,t,a,u,d,_,v,S,E){const R=Ma(this.paint.get("fill-extrusion-translate"),this.paint.get("fill-extrusion-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),P=this.paint.get("fill-extrusion-height").evaluate(t,a),B=this.paint.get("fill-extrusion-base").evaluate(t,a),F=[0,0],j=S&&_.elevation,G=_.elevation?_.elevation.exaggeration():1,Q=s.tile.getBucket(this);if(j&&Q instanceof tg){const he=Q.centroidVertexArray,Ee=E+1;Ee<he.length&&(F[0]=he.geta_centroid_pos0(Ee),F[1]=he.geta_centroid_pos1(Ee))}if(F[0]===0&&F[1]===1)return!1;_.projection.name==="globe"&&(u=ng([u],[new Tt(0,0),new Tt(Bt,Bt)],s.tileID.canonical).map((he=>he.polygon)).flat());const J=j?S:null,[ee,se]=(function(he,Ee,Ce,De,Le,Fe,ut,Ue,dt,St,gt){return he.projection.name==="globe"?(function(yt,Rt,lt,vt,et,We,Dt,Et,dr,Zt,nr){const Nt=[],ur=[],Dr=yt.projection.upVectorScale(nr,yt.center.lat,yt.worldSize).metersToTile,Ht=[0,0,0,1],ar=[0,0,0,1],Sr=($r,Vr,er,zr)=>{$r[0]=Vr,$r[1]=er,$r[2]=zr,$r[3]=1},Br=p_();lt>0&&(lt+=Br),vt+=Br;for(const $r of Rt){const Vr=[],er=[];for(const zr of $r){const ci=zr.x+et.x,de=zr.y+et.y,pe=yt.projection.projectTilePoint(ci,de,nr),Ke=yt.projection.upVector(nr,zr.x,zr.y);let ct=lt,Gt=vt;if(Dt){const jt=Mt(ci,de,lt,vt,Dt,Et,dr,Zt);ct+=jt.base,Gt+=jt.top}lt!==0?Sr(Ht,pe.x+Ke[0]*Dr*ct,pe.y+Ke[1]*Dr*ct,pe.z+Ke[2]*Dr*ct):Sr(Ht,pe.x,pe.y,pe.z),Sr(ar,pe.x+Ke[0]*Dr*Gt,pe.y+Ke[1]*Dr*Gt,pe.z+Ke[2]*Dr*Gt),Tn(Ht,Ht,We),Tn(ar,ar,We),Vr.push(new f(Ht[0],Ht[1],Ht[2])),er.push(new f(ar[0],ar[1],ar[2]))}Nt.push(Vr),ur.push(er)}return[Nt,ur]})(he,Ee,Ce,De,Le,Fe,ut,Ue,dt,St,gt):ut?(function(yt,Rt,lt,vt,et,We,Dt,Et,dr){const Zt=[],nr=[],Nt=[0,0,0,1];for(const ur of yt){const Dr=[],Ht=[];for(const ar of ur){const Sr=ar.x+vt.x,Br=ar.y+vt.y,$r=Mt(Sr,Br,Rt,lt,We,Dt,Et,dr);Nt[0]=Sr,Nt[1]=Br,Nt[2]=$r.base,Nt[3]=1,Wo(Nt,Nt,et),Nt[3]=Math.max(Nt[3],1e-5);const Vr=new f(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);Nt[0]=Sr,Nt[1]=Br,Nt[2]=$r.top,Nt[3]=1,Wo(Nt,Nt,et),Nt[3]=Math.max(Nt[3],1e-5);const er=new f(Nt[0]/Nt[3],Nt[1]/Nt[3],Nt[2]/Nt[3]);Dr.push(Vr),Ht.push(er)}Zt.push(Dr),nr.push(Ht)}return[Zt,nr]})(Ee,Ce,De,Le,Fe,ut,Ue,dt,St):(function(yt,Rt,lt,vt,et){const We=[],Dt=[],Et=et[8]*Rt,dr=et[9]*Rt,Zt=et[10]*Rt,nr=et[11]*Rt,Nt=et[8]*lt,ur=et[9]*lt,Dr=et[10]*lt,Ht=et[11]*lt;for(const ar of yt){const Sr=[],Br=[];for(const $r of ar){const Vr=$r.x+vt.x,er=$r.y+vt.y,zr=et[0]*Vr+et[4]*er+et[12],ci=et[1]*Vr+et[5]*er+et[13],de=et[2]*Vr+et[6]*er+et[14],pe=et[3]*Vr+et[7]*er+et[15],Ke=zr+Et,ct=ci+dr,Gt=de+Zt,jt=Math.max(pe+nr,1e-5),Kt=zr+Nt,mr=ci+ur,Xr=de+Dr,Zr=Math.max(pe+Ht,1e-5);Sr.push(new f(Ke/jt,ct/jt,Gt/jt)),Br.push(new f(Kt/Zr,mr/Zr,Xr/Zr))}We.push(Sr),Dt.push(Br)}return[We,Dt]})(Ee,Ce,De,Le,Fe)})(_,u,B,P,R,v,J,F,G,_.center.lat,s.tileID.canonical),le=s.queryGeometry;return(function(he,Ee,Ce){let De=1/0;Ia(Ce,Ee)&&(De=Ye(Ce,Ee[0]));for(let Le=0;Le<Ee.length;Le++){const Fe=Ee[Le],ut=he[Le];for(let Ue=0;Ue<Fe.length-1;Ue++){const dt=Fe[Ue],St=[dt,Fe[Ue+1],ut[Ue+1],ut[Ue],dt];$a(Ce,St)&&(De=Math.min(De,Ye(Ce,St)))}}return De!==1/0&&De})(ee,se,le.isPointQuery()?le.screenBounds:le.screenGeometry)}},building:class extends Go{constructor(s,t,a,u){super(s,{layout:aS||(aS=new yn({visibility:new At(Ve.layout_building.visibility),"building-facade":new Ut(Ve.layout_building["building-facade"]),"building-facade-floors":new Ut(Ve.layout_building["building-facade-floors"]),"building-facade-unit-width":new Ut(Ve.layout_building["building-facade-unit-width"]),"building-facade-window":new Ut(Ve.layout_building["building-facade-window"]),"building-roof-shape":new Ut(Ve.layout_building["building-roof-shape"]),"building-height":new Ut(Ve.layout_building["building-height"]),"building-base":new Ut(Ve.layout_building["building-base"]),"building-flood-light-wall-radius":new Ut(Ve.layout_building["building-flood-light-wall-radius"]),"building-flood-light-ground-radius":new Ut(Ve.layout_building["building-flood-light-ground-radius"]),"building-flip-roof-orientation":new Ut(Ve.layout_building["building-flip-roof-orientation"])})),paint:sS||(sS=new yn({"building-opacity":new At(Ve.paint_building["building-opacity"]),"building-ambient-occlusion-intensity":new At(Ve.paint_building["building-ambient-occlusion-intensity"]),"building-ambient-occlusion-ground-intensity":new At(Ve.paint_building["building-ambient-occlusion-ground-intensity"]),"building-ambient-occlusion-ground-radius":new At(Ve.paint_building["building-ambient-occlusion-ground-radius"]),"building-ambient-occlusion-ground-attenuation":new At(Ve.paint_building["building-ambient-occlusion-ground-attenuation"]),"building-vertical-scale":new At(Ve.paint_building["building-vertical-scale"]),"building-cast-shadows":new At(Ve.paint_building["building-cast-shadows"]),"building-color":new Ut(Ve.paint_building["building-color"]),"building-emissive-strength":new Ut(Ve.paint_building["building-emissive-strength"]),"building-facade-emissive-chance":new At(Ve.paint_building["building-facade-emissive-chance"]),"building-cutoff-fade-range":new At(Ve.paint_building["building-cutoff-fade-range"]),"building-flood-light-color":new At(Ve.paint_building["building-flood-light-color"]),"building-flood-light-intensity":new At(Ve.paint_building["building-flood-light-intensity"]),"building-flood-light-ground-attenuation":new At(Ve.paint_building["building-flood-light-ground-attenuation"]),"building-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"building-flood-light-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new oS(s)}cutoffRange(){return this.paint.get("building-cutoff-fade-range")}hasShadowPass(){return this.paint.get("building-cast-shadows")}hasLightBeamPass(){return!0}canCastShadows(){return!0}is3D(s){return!0}},line:class extends Go{constructor(s,t,a,u){const d=_S();super(s,d,t,a,u),d.layout&&(this.layout=new mu(d.layout)),this.gradientVersion=0,this.hasElevatedBuckets=!1,this.hasNonElevatedBuckets=!1}_handleSpecialPaintPropertyUpdate(s){if(s==="line-gradient"){const t=this._transitionablePaint._values["line-gradient"].value.expression;this.stepInterpolant=t._styleExpression&&t._styleExpression.expression instanceof nh,this.gradientVersion=(this.gradientVersion+1)%Number.MAX_SAFE_INTEGER}}gradientExpression(){return this._transitionablePaint._values["line-gradient"].value.expression}widthExpression(){return this._transitionablePaint._values["line-width"].value.expression}recalculate(s,t){super.recalculate(s,t),this.paint._values["line-floorwidth"]=(()=>{if(I0)return I0;const a=_S();return I0=new OM(a.paint.properties["line-width"].specification),I0.useIntegerZoom=!0,I0})().possiblyEvaluate(this._transitioningPaint._values["line-width"].value,s)}createBucket(s){return new yx(s)}getProgramIds(){return[this.paint.get("line-pattern").constantOr(1)?"linePattern":"line"]}getDefaultProgramParams(s,t,a){const u=mS(this);return{config:new Su(this,{zoom:t,lut:a}),defines:u,overrideFog:!1}}queryRadius(s){const t=s,a=yS(al("line-width",this,t),al("line-gap-width",this,t)),u=al("line-offset",this,t);return a/2+Math.abs(u)+Pc(this.paint.get("line-translate"))}queryIntersectsFeature(s,t,a,u,d,_){if(s.queryGeometry.isAboveHorizon)return!1;const v=Lc(s.tilespaceGeometry,this.paint.get("line-translate"),this.paint.get("line-translate-anchor"),_.angle,s.pixelToTileUnitsFactor),S=s.pixelToTileUnitsFactor/2*yS(this.paint.get("line-width").evaluate(t,a),this.paint.get("line-gap-width").evaluate(t,a)),E=this.paint.get("line-offset").evaluate(t,a);return E&&(u=(function(R,P){const B=[],F=new Tt(0,0);for(let j=0;j<R.length;j++){const G=R[j],Q=[];for(let J=0;J<G.length;J++){const ee=G[J],se=G[J+1],le=J===0?F:ee.sub(G[J-1])._unit()._perp(),he=J===G.length-1?F:se.sub(ee)._unit()._perp(),Ee=le._add(he)._unit();Ee._mult(1/(Ee.x*he.x+Ee.y*he.y)),Q.push(Ee._mult(P)._add(ee))}B.push(Q)}return B})(u,E*s.pixelToTileUnitsFactor)),(function(R,P,B){for(let F=0;F<P.length;F++){const j=P[F];if(R.length>=3){for(let G=0;G<j.length;G++)if(lo(R,j[G]))return!0}if(Ra(R,j,B))return!0}return!1})(v,u,S)}isTileClipped(){return this.hasNonElevatedBuckets}isDraped(s){return!this.hasElevatedBuckets||this.layout&&this.layout.get("line-elevation-reference")==="hd-road-markup"}hasElevation(){return this.layout&&this.layout.get("line-elevation-reference")!=="none"}},symbol:F1,background:class extends Go{constructor(s,t,a,u){super(s,{layout:cT||(cT=new yn({visibility:new At(Ve.layout_background.visibility)})),paint:uT||(uT=new yn({"background-pitch-alignment":new At(Ve.paint_background["background-pitch-alignment"]),"background-color":new At(Ve.paint_background["background-color"]),"background-pattern":new At(Ve.paint_background["background-pattern"]),"background-opacity":new At(Ve.paint_background["background-opacity"]),"background-emissive-strength":new At(Ve.paint_background["background-emissive-strength"]),"background-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u)}getProgramIds(){return[this.paint.get("background-pattern")?"backgroundPattern":"background"]}getDefaultProgramParams(s,t,a){return{overrideFog:!1}}is3D(s){return this.paint.get("background-pitch-alignment")==="viewport"}},raster:mT,"raster-particle":bT,sky:class extends Go{constructor(s,t,a,u){super(s,{layout:yT||(yT=new yn({visibility:new At(Ve.layout_sky.visibility)})),paint:vT||(vT=new yn({"sky-type":new At(Ve.paint_sky["sky-type"]),"sky-atmosphere-sun":new At(Ve.paint_sky["sky-atmosphere-sun"]),"sky-atmosphere-sun-intensity":new At(Ve.paint_sky["sky-atmosphere-sun-intensity"]),"sky-gradient-center":new At(Ve.paint_sky["sky-gradient-center"]),"sky-gradient-radius":new At(Ve.paint_sky["sky-gradient-radius"]),"sky-gradient":new lh(Ve.paint_sky["sky-gradient"]),"sky-atmosphere-halo-color":new At(Ve.paint_sky["sky-atmosphere-halo-color"]),"sky-atmosphere-color":new At(Ve.paint_sky["sky-atmosphere-color"]),"sky-opacity":new At(Ve.paint_sky["sky-opacity"]),"sky-gradient-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-halo-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"}),"sky-atmosphere-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._updateColorRamp()}_clear(){this.skyboxFbo&&(this.skyboxFbo.destroy(),this.skyboxFbo=null),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null),this._skyboxInvalidated=!0}_handleSpecialPaintPropertyUpdate(s){s==="sky-gradient"?this._updateColorRamp():s!=="sky-atmosphere-sun"&&s!=="sky-atmosphere-halo-color"&&s!=="sky-atmosphere-color"&&s!=="sky-atmosphere-sun-intensity"||(this._skyboxInvalidated=!0)}_updateColorRamp(){this.colorRamp=Np({expression:this._transitionablePaint._values["sky-gradient"].value.expression,evaluationKey:"skyRadialProgress"}),this.colorRampTexture&&(this.colorRampTexture.destroy(),this.colorRampTexture=null)}needsSkyboxCapture(s){if(this._skyboxInvalidated||!this.skyboxTexture||!this.skyboxGeometry)return!0;if(!this.paint.get("sky-atmosphere-sun")){const t=s.style.light.properties.get("position");return this._lightPosition.azimuthal!==t.azimuthal||this._lightPosition.polar!==t.polar}return!1}getCenter(s,t){if(this.paint.get("sky-type")==="atmosphere"){const u=this.paint.get("sky-atmosphere-sun"),d=!u,_=s.style.light,v=_.properties.get("position");return d&&_.properties.get("anchor")==="viewport"&&ri("The sun direction is attached to a light with viewport anchor, lighting may behave unexpectedly."),d?Fx(v.azimuthal,90-v.polar,t):Fx(u[0],90-u[1],t)}const a=this.paint.get("sky-gradient-center");return Fx(a[0],90-a[1],t)}isSky(){return!0}markSkyboxValid(s){this._skyboxInvalidated=!1,this._lightPosition=s.style.light.properties.get("position")}hasOffscreenPass(){return!0}getProgramIds(){const s=this.paint.get("sky-type");return s==="atmosphere"?["skyboxCapture","skybox"]:s==="gradient"?["skyboxGradient"]:null}},slot:class extends Go{constructor(s,t,a,u){super(s,{paint:xT||(xT=new yn({}))},t,null)}},model:class extends Go{constructor(s,t,a,u){super(s,{layout:AT||(AT=new yn({visibility:new At(Ve.layout_model.visibility),"model-id":new Ut(Ve.layout_model["model-id"])})),paint:ET||(ET=new yn({"model-opacity":new Ut(Ve.paint_model["model-opacity"]),"model-rotation":new Ut(Ve.paint_model["model-rotation"]),"model-scale":new Ut(Ve.paint_model["model-scale"]),"model-translation":new Ut(Ve.paint_model["model-translation"]),"model-color":new Ut(Ve.paint_model["model-color"]),"model-color-mix-intensity":new Ut(Ve.paint_model["model-color-mix-intensity"]),"model-type":new At(Ve.paint_model["model-type"]),"model-cast-shadows":new At(Ve.paint_model["model-cast-shadows"]),"model-receive-shadows":new At(Ve.paint_model["model-receive-shadows"]),"model-ambient-occlusion-intensity":new At(Ve.paint_model["model-ambient-occlusion-intensity"]),"model-emissive-strength":new Ut(Ve.paint_model["model-emissive-strength"]),"model-roughness":new Ut(Ve.paint_model["model-roughness"]),"model-height-based-emissive-strength-multiplier":new Ut(Ve.paint_model["model-height-based-emissive-strength-multiplier"]),"model-cutoff-fade-range":new At(Ve.paint_model["model-cutoff-fade-range"]),"model-front-cutoff":new At(Ve.paint_model["model-front-cutoff"]),"model-elevation-reference":new At(Ve.paint_model["model-elevation-reference"]),"model-color-use-theme":new Ut({type:"string",default:"default","property-type":"data-driven"})}))},t,a,u),this._stats={numRenderedVerticesInShadowPass:0,numRenderedVerticesInTransparentPass:0}}createBucket(s){return new Nx(s)}getProgramIds(){return["model"]}is3D(s){return!0}hasShadowPass(){return!0}canCastShadows(){return!0}hasLightBeamPass(){return!0}cutoffRange(){return this.paint.get("model-cutoff-fade-range")}queryRadius(s){return s instanceof U1?Bt-1:0}queryIntersectsFeature(s,t,a,u,d,_){if(!this.modelManager)return!1;const v=this.modelManager,S=s.tile.getBucket(this);if(!(S&&S instanceof Nx))return!1;for(const E in S.instancesPerModel){const R=S.instancesPerModel[E],P=t.id!==void 0?t.id:t.properties&&t.properties.hasOwnProperty("id")?t.properties.id:void 0;if(R.idToFeaturesIndex.hasOwnProperty(P)){const B=R.features[R.idToFeaturesIndex[P]],F=v.getModel(E,this.scope);if(!F)return!1;let j=ie();const G=new W(0,0),Q=S.canonical;let J=Number.MAX_VALUE;for(let ee=0;ee<B.instancedDataCount;++ee){const se=16*(B.instancedDataOffset+ee),le=R.instancedDataArray.float32,he=[le[se+4],le[se+5],le[se+6]];DT(Q,G,le[se],0|le[se+1]),Q2(j,F,_,G,B.rotation,B.scale,he,!1,!1,!1),_.projection.name==="globe"&&(j=fx(j,_));const Ee=ve([],_.projMatrix,j),Ce=s.queryGeometry,De=Y2(Ce.isPointQuery()?Ce.screenBounds:Ce.screenGeometry,_,Ee,F.aabb);De!=null&&(J=Math.min(De,J))}return J!==Number.MAX_VALUE&&J}}return!1}_handleOverridablePaintPropertyUpdate(s,t,a){return!(!this.layout||t.isDataDriven()||a.isDataDriven()||s!=="model-color"&&s!=="model-color-mix-intensity"&&s!=="model-rotation"&&s!=="model-scale"&&s!=="model-translation"&&s!=="model-emissive-strength")}_isPropertyZoomDependent(s){const t=this._transitionablePaint._values[s];return t!=null&&t.value!=null&&t.value.expression!=null&&t.value.expression instanceof fu}isZoomDependent(){return this._isPropertyZoomDependent("model-scale")||this._isPropertyZoomDependent("model-rotation")||this._isPropertyZoomDependent("model-translation")}},clip:class extends Go{constructor(s,t,a,u){super(s,{layout:Hp||(Hp=new yn({"clip-layer-types":new At(Ve.layout_clip["clip-layer-types"]),"clip-layer-scope":new At(Ve.layout_clip["clip-layer-scope"])})),paint:g0||(g0=new yn({}))},t,a,u)}recalculate(s,t){super.recalculate(s,t)}createBucket(s){return new s_(s)}is3D(s){return!0}}},Ux=new Ei(0,0,0),jx={PATH_RULE_NON_ZERO:1,PATH_RULE_EVEN_ODD:2},Gx={LINE_CAP_BUTT:1,LINE_CAP_ROUND:2,LINE_CAP_SQUARE:3},j1={LINE_JOIN_MITER:1,LINE_JOIN_MITER_CLIP:2,LINE_JOIN_ROUND:3,LINE_JOIN_BEVEL:4},BD={PAINT_ORDER_FILL_AND_STROKE:1},U0={PATH_COMMAND_MOVE:1,PATH_COMMAND_LINE:2,PATH_COMMAND_QUAD:3,PATH_COMMAND_CUBIC:4,PATH_COMMAND_CLOSE:5},OT={MASK_TYPE_LUMINANCE:1};function zD(s,t,a){s===1&&t.icons.push((function(u,d){return(function(_){if(_.usvg_tree.height||(_.usvg_tree.height=_.usvg_tree.width),!_.metadata)return _;const{metadata:v}=_;if(v.content_area){const{content_area:S}=v;S.left==null&&(S.left=0),S.top==null&&(S.top=S.left),S.width==null&&(S.width=_.usvg_tree.width),S.height==null&&(S.height=S.width)}if(v.text_placeholder){const{text_placeholder:S}=v;S.top==null&&(S.top=S.left),S.height==null&&(S.height=S.width)}return v.stretch_x&&v.stretch_x.length&&PT(v,"x"),v.stretch_y&&v.stretch_y.length&&PT(v,"y"),_})(u.readFields(FD,{name:void 0},d))})(a,a.readVarint()+a.pos))}function PT(s,t){const a=[],u=s[`stretch_${t}`];let d=null;for(let _=0;_<u.length;_++)d===null?d=a.length===0?u[0]:a[a.length-1][1]+u[_]:(a.push([d,d+u[_]]),d=null);s[`stretch_${t}_areas`]=a}function FD(s,t,a){s===1?t.name=a.readString():s===2?t.metadata=(function(u,d){return u.readFields(kD,{stretch_x:null,stretch_y:null,stretch_x_areas:null,stretch_y_areas:null,variables:[]},d)})(a,a.readVarint()+a.pos):s===3&&(t.usvg_tree=(function(u,d){return u.readFields(UD,{width:20,children:[],linear_gradients:[],radial_gradients:[],clip_paths:[],masks:[]},d)})(a,a.readVarint()+a.pos),t.data="usvg_tree")}function kD(s,t,a){s===1?t.stretch_x=a.readPackedVarint():s===2?t.stretch_y=a.readPackedVarint():s===3?t.content_area=LT(a,a.readVarint()+a.pos):s===4?t.variables.push((function(u,d){return u.readFields(VD,{name:void 0},d)})(a,a.readVarint()+a.pos)):s===5&&(t.text_placeholder=LT(a,a.readVarint()+a.pos))}function LT(s,t){return s.readFields(ND,{},t)}function ND(s,t,a){s===1?t.left=a.readVarint():s===2?t.width=a.readVarint():s===3?t.top=a.readVarint():s===4&&(t.height=a.readVarint())}function VD(s,t,a){s===1?t.name=a.readString():s===2&&(t.rgb_color=q1(a.readVarint()),t.value="rgb_color")}function UD(s,t,a){s===1?t.width=t.height=a.readVarint():s===2?t.height=a.readVarint():s===3?t.children.push(G1(a,a.readVarint()+a.pos)):s===4?t.linear_gradients.push((function(u,d){return u.readFields(ZD,{spread_method:1,stops:[],x1:0,y1:0,x2:1,y2:0},d)})(a,a.readVarint()+a.pos)):s===5?t.radial_gradients.push((function(u,d){return u.readFields(YD,{spread_method:1,stops:[],cx:.5,cy:.5,r:.5,fx:.5,fy:.5,fr:0},d)})(a,a.readVarint()+a.pos)):s===7?t.clip_paths.push((function(u,d){return u.readFields(QD,{children:[]},d)})(a,a.readVarint()+a.pos)):s===8&&t.masks.push((function(u,d){const _=u.readFields(KD,{left:0,width:20,mask_type:OT.MASK_TYPE_LUMINANCE,children:[]},d);return _.height==null&&(_.height=_.width),_.top==null&&(_.top=_.left),_})(a,a.readVarint()+a.pos))}function G1(s,t){return s.readFields(jD,{},t)}function jD(s,t,a){s===1?(t.group=(function(u,d){return u.readFields(GD,{opacity:255,children:[]},d)})(a,a.readVarint()+a.pos),t.node="group"):s===2&&(t.path=(function(u,d){return u.readFields(qD,{paint_order:1,commands:[],step:1,diffs:[],rule:jx.PATH_RULE_NON_ZERO},d)})(a,a.readVarint()+a.pos),t.node="path")}function GD(s,t,a){s===1?t.transform=H1(a,a.readVarint()+a.pos):s===2?t.opacity=a.readVarint():s===5?t.clip_path_idx=a.readVarint():s===6?t.mask_idx=a.readVarint():s===7&&t.children.push(G1(a,a.readVarint()+a.pos))}function H1(s,t){return s.readFields(HD,{sx:1,ky:0,kx:0,sy:1,tx:0,ty:0},t)}function HD(s,t,a){s===1?t.sx=a.readFloat():s===2?t.ky=a.readFloat():s===3?t.kx=a.readFloat():s===4?t.sy=a.readFloat():s===5?t.tx=a.readFloat():s===6&&(t.ty=a.readFloat())}function qD(s,t,a){s===1?t.fill=(function(u,d){return u.readFields($D,{rgb_color:Ux,paint:"rgb_color",opacity:255},d)})(a,a.readVarint()+a.pos):s===2?t.stroke=(function(u,d){return u.readFields(XD,{rgb_color:Ux,paint:"rgb_color",dasharray:[],dashoffset:0,miterlimit:4,opacity:255,width:1,linecap:1,linejoin:1},d)})(a,a.readVarint()+a.pos):s===3?t.paint_order=a.readVarint():s===5?a.readPackedVarint(t.commands):s===6?t.step=a.readFloat():s===7?a.readPackedSVarint(t.diffs):s===8&&(t.rule=a.readVarint())}function $D(s,t,a){s===1?(t.rgb_color=q1(a.readVarint()),t.paint="rgb_color"):s===2?(t.linear_gradient_idx=a.readVarint(),t.paint="linear_gradient_idx"):s===3?(t.radial_gradient_idx=a.readVarint(),t.paint="radial_gradient_idx"):s===5&&(t.opacity=a.readVarint())}function q1(s){return new Ei((s>>16&255)/255,(s>>8&255)/255,(255&s)/255,1)}function XD(s,t,a){s===1?(t.rgb_color=q1(a.readVarint()),t.paint="rgb_color"):s===2?(t.linear_gradient_idx=a.readVarint(),t.paint="linear_gradient_idx"):s===3?(t.radial_gradient_idx=a.readVarint(),t.paint="radial_gradient_idx"):s===5?a.readPackedFloat(t.dasharray):s===6?t.dashoffset=a.readFloat():s===7?t.miterlimit=a.readFloat():s===8?t.opacity=a.readVarint():s===9?t.width=a.readFloat():s===10?t.linecap=a.readVarint():s===11&&(t.linejoin=a.readVarint())}function ZD(s,t,a){s===1?t.transform=H1(a,a.readVarint()+a.pos):s===2?t.spread_method=a.readVarint():s===3?t.stops.push(BT(a,a.readVarint()+a.pos)):s===4?t.x1=a.readFloat():s===5?t.y1=a.readFloat():s===6?t.x2=a.readFloat():s===7&&(t.y2=a.readFloat())}function BT(s,t){return s.readFields(WD,{offset:0,opacity:255,rgb_color:Ux},t)}function WD(s,t,a){s===1?t.offset=a.readFloat():s===2?t.opacity=a.readVarint():s===3&&(t.rgb_color=q1(a.readVarint()))}function YD(s,t,a){s===1?t.transform=H1(a,a.readVarint()+a.pos):s===2?t.spread_method=a.readVarint():s===3?t.stops.push(BT(a,a.readVarint()+a.pos)):s===4?t.cx=a.readFloat():s===5?t.cy=a.readFloat():s===6?t.r=a.readFloat():s===7?t.fx=a.readFloat():s===8?t.fy=a.readFloat():s===9&&(t.fr=a.readFloat())}function QD(s,t,a){s===1?t.transform=H1(a,a.readVarint()+a.pos):s===2?t.clip_path_idx=a.readVarint():s===3&&t.children.push(G1(a,a.readVarint()+a.pos))}function KD(s,t,a){s===1?t.left=t.top=a.readFloat():s===2?t.width=t.height=a.readFloat():s===3?t.top=a.readFloat():s===4?t.height=a.readFloat():s===5?t.mask_type=a.readVarint():s===6?t.mask_idx=a.readVarint():s===7&&t.children.push(G1(a,a.readVarint()+a.pos))}class JD{static calculate(t={},a=[]){const u=new Map,d=new Map;if(Object.keys(t).length===0)return u;a.forEach((_=>{d.set(_.name,_.rgb_color||new Ei(0,0,0))}));for(const[_,v]of Object.entries(t))d.has(_)?u.set(d.get(_).toString(),v):console.warn(`Ignoring unknown image variable "${_}"`);return u}}function w_(s,t=255,a){const u=t/255,d=s.toString(),_=a.has(d)?a.get(d).clone():s.clone();return _.a*=u,_.toString()}function j0(s,t){if(!Lf()){const a=document.createElement("canvas");return a.width=s,a.height=t,a}return new OffscreenCanvas(s,t)}function eO(s,t){const a=JD.calculate(t.params,s.metadata?s.metadata.variables:[]),u=s.usvg_tree,d=u.width,_=u.height,v=t.transform?t.transform:new DOMMatrix,S=Math.max(1,Math.round(d*v.a)),E=Math.max(1,Math.round(_*v.d)),R=new DOMMatrix([S/d,0,0,E/_,0,0]),P=j0(S,E).getContext("2d");return Hx(P,R,u,u,a),P.getImageData(0,0,S,E)}function Hx(s,t,a,u,d){for(const _ of u.children)zT(s,t,a,_,d)}function zT(s,t,a,u,d){u.group?(s.save(),(function(_,v,S,E,R){const P=E.mask_idx!=null?S.masks[E.mask_idx]:null,B=E.clip_path_idx!=null?S.clip_paths[E.clip_path_idx]:null;if(E.transform&&(v=S_(E.transform).preMultiplySelf(v)),!(function(G,Q,J){return G.opacity!==255||Q||J})(E,B!=null,P!=null))return void Hx(_,v,S,E,R);const F=j0(_.canvas.width,_.canvas.height),j=F.getContext("2d");Hx(j,v,S,E,R),B&&GT(j,v,S,B),P&&HT(j,v,S,P,R),_.globalAlpha=E.opacity/255,_.drawImage(F,0,0)})(s,t,a,u.group,d),s.restore()):u.path&&(s.save(),(function(_,v,S,E,R){_.setTransform(v),E.paint_order===BD.PAINT_ORDER_FILL_AND_STROKE?(FT(_,S,E,R),NT(_,S,E,R)):(NT(_,S,E,R),FT(_,S,E,R))})(s,t,a,u.path,d),s.restore())}function FT(s,t,a,u){const d=a.fill;if(!d)return;const _=d.opacity/255;switch(s.save(),s.beginPath(),qT(a,s),d.paint){case"rgb_color":s.fillStyle=w_(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":{const v=t.linear_gradients[d.linear_gradient_idx];v.transform&&s.setTransform(S_(v.transform).preMultiplySelf(s.getTransform())),s.fillStyle=VT(s,v,_,u);break}case"radial_gradient_idx":{const v=t.radial_gradients[d.radial_gradient_idx];v.transform&&s.setTransform(S_(v.transform).preMultiplySelf(s.getTransform())),s.fillStyle=UT(s,v,_,u)}}s.fill(kT(a)),s.restore()}function kT(s){return s.rule===jx.PATH_RULE_NON_ZERO?"nonzero":s.rule===jx.PATH_RULE_EVEN_ODD?"evenodd":void 0}function NT(s,t,a,u){const d=a.stroke;if(!d)return;const _=$T(a);s.lineWidth=d.width,s.miterLimit=d.miterlimit,s.setLineDash(d.dasharray),s.lineDashOffset=d.dashoffset;const v=d.opacity/255;switch(d.paint){case"rgb_color":s.strokeStyle=w_(d.rgb_color,d.opacity,u);break;case"linear_gradient_idx":s.strokeStyle=VT(s,t.linear_gradients[d.linear_gradient_idx],v,u,!0);break;case"radial_gradient_idx":s.strokeStyle=UT(s,t.radial_gradients[d.radial_gradient_idx],v,u,!0)}switch(d.linejoin){case j1.LINE_JOIN_MITER_CLIP:case j1.LINE_JOIN_MITER:s.lineJoin="miter";break;case j1.LINE_JOIN_ROUND:s.lineJoin="round";break;case j1.LINE_JOIN_BEVEL:s.lineJoin="bevel"}switch(d.linecap){case Gx.LINE_CAP_BUTT:s.lineCap="butt";break;case Gx.LINE_CAP_ROUND:s.lineCap="round";break;case Gx.LINE_CAP_SQUARE:s.lineCap="square"}s.stroke(_)}function VT(s,t,a,u,d=!1){if(t.stops.length===1){const F=t.stops[0];return w_(F.rgb_color,F.opacity*a,u)}const{x1:_,y1:v,x2:S,y2:E}=t;let R=new DOMPoint(_,v),P=new DOMPoint(S,E);if(d){const F=S_(t.transform);R=F.transformPoint(R),P=F.transformPoint(P)}const B=s.createLinearGradient(R.x,R.y,P.x,P.y);for(const F of t.stops)B.addColorStop(F.offset,w_(F.rgb_color,F.opacity*a,u));return B}function UT(s,t,a,u,d=!1){if(t.stops.length===1){const ee=t.stops[0];return w_(ee.rgb_color,ee.opacity*a,u)}const _=S_(t.transform),{fx:v,fy:S,fr:E,cx:R,cy:P,r:B}=t;let F=new DOMPoint(v,S),j=new DOMPoint(R,P),G=E,Q=B;if(d){F=_.transformPoint(F),j=_.transformPoint(j);const ee=(_.a+_.d)/2;G=E*ee,Q=t.r*ee}const J=s.createRadialGradient(F.x,F.y,G,j.x,j.y,Q);for(const ee of t.stops)J.addColorStop(ee.offset,w_(ee.rgb_color,ee.opacity*a,u));return J}function jT(s,t,a,u){const d=u.transform?S_(u.transform).preMultiplySelf(t):t,_=j0(s.canvas.width,s.canvas.height),v=_.getContext("2d");for(const E of u.children)if(E.group)jT(v,d,a,E.group);else if(E.path){const R=E.path,P=new Path2D;P.addPath($T(R),d),v.fill(P,kT(R))}const S=u.clip_path_idx!=null?a.clip_paths[u.clip_path_idx]:null;S&&GT(v,d,a,S),s.globalCompositeOperation="source-over",s.drawImage(_,0,0)}function GT(s,t,a,u){const d=j0(s.canvas.width,s.canvas.height);jT(d.getContext("2d"),t,a,u),s.globalCompositeOperation="destination-in",s.drawImage(d,0,0)}function HT(s,t,a,u,d){if(u.children.length===0)return;const _=u.mask_idx!=null?a.masks[u.mask_idx]:null;_&&HT(s,t,a,_,d);const v=s.canvas.width,S=s.canvas.height,E=j0(v,S),R=E.getContext("2d"),P=u.width,B=u.height,F=u.left,j=u.top,G=new Path2D,Q=new Path2D;Q.rect(F,j,P,B),G.addPath(Q,t),R.clip(G);for(const se of u.children)zT(R,t,a,se,d);const J=R.getImageData(0,0,v,S),ee=J.data;if(u.mask_type===OT.MASK_TYPE_LUMINANCE)for(let se=0;se<ee.length;se+=4)ee[se+3]=ee[se+3]/255*(.2126*ee[se]+.7152*ee[se+1]+.0722*ee[se+2]);R.putImageData(J,0,0),s.globalCompositeOperation="destination-in",s.drawImage(E,0,0)}function S_(s){return s?new DOMMatrix([s.sx,s.ky,s.kx,s.sy,s.tx,s.ty]):new DOMMatrix}function qT(s,t){const a=s.step;let u=s.diffs[0]*a,d=s.diffs[1]*a;t.moveTo(u,d);for(let _=0,v=2;_<s.commands.length;_++)switch(s.commands[_]){case U0.PATH_COMMAND_MOVE:u+=s.diffs[v++]*a,d+=s.diffs[v++]*a,t.moveTo(u,d);break;case U0.PATH_COMMAND_LINE:u+=s.diffs[v++]*a,d+=s.diffs[v++]*a,t.lineTo(u,d);break;case U0.PATH_COMMAND_QUAD:{const S=u+s.diffs[v++]*a,E=d+s.diffs[v++]*a;u=S+s.diffs[v++]*a,d=E+s.diffs[v++]*a,t.quadraticCurveTo(S,E,u,d);break}case U0.PATH_COMMAND_CUBIC:{const S=u+s.diffs[v++]*a,E=d+s.diffs[v++]*a,R=S+s.diffs[v++]*a,P=E+s.diffs[v++]*a;u=R+s.diffs[v++]*a,d=P+s.diffs[v++]*a,t.bezierCurveTo(S,E,R,P,u,d);break}case U0.PATH_COMMAND_CLOSE:t.closePath()}return t}function $T(s){return qT(s,new Path2D)}class $1{constructor(t){this.capacity=t,this.cache=new Map}get(t){if(!this.cache.has(t))return;const a=this.cache.get(t);return this.cache.delete(t),this.cache.set(t,a),a}put(t,a){this.cache.has(t)?this.cache.delete(t):this.cache.size===this.capacity&&this.cache.delete(this.cache.keys().next().value),this.cache.set(t,a)}delete(t){this.cache.delete(t)}}$t($1,"LRUCache");class qx{constructor(){this.cacheMap=new Map,this.cacheDependenciesMap=new Map}static _getImage(t){return new Ho(t,t.data)}getFromCache(t,a,u){return this.cacheMap.has(u)||this.cacheMap.set(u,new $1(150)),this.cacheMap.get(u).get(of(t.toString(),a))}setInCache(t,a,u,d){this.cacheDependenciesMap.has(d)||this.cacheDependenciesMap.set(d,new Map),this.cacheMap.has(d)||this.cacheMap.set(d,new $1(150));const _=this.cacheDependenciesMap.get(d),v=of(t.id.toString(),u);_.get(v)||_.set(v,new Set);const S=this.cacheMap.get(d),E=t.toString();_.get(v).add(E),S.put(of(t.toString(),u),a)}removeImagesFromCacheByIds(t,a,u=0){if(!this.cacheMap.has(u)||!this.cacheDependenciesMap.has(u))return;const d=this.cacheMap.get(u),_=this.cacheDependenciesMap.get(u);for(const v of t){const S=of(v.toString(),a);if(_.has(S)){for(const E of _.get(S))d.delete(E);_.delete(S)}}}rasterize(t,a,u,d,_=eO){const v=this.getFromCache(t,u,d);if(v)return v.clone();const S=_(a.icon,t.options),E=qx._getImage(S);return this.setInCache(t,E,u,d),E.clone()}}class XT{constructor(t){this.size=t,this.minimums=[],this.maximums=[],this.leaves=[]}getElevation(t,a){const u=this.toIdx(t,a);return{min:this.minimums[u],max:this.maximums[u]}}isLeaf(t,a){return this.leaves[this.toIdx(t,a)]}toIdx(t,a){return a*this.size+t}}function ZT(s,t,a,u){let d=0,_=Number.MAX_VALUE;for(let v=0;v<3;v++)if(Math.abs(u[v])<1e-15){if(a[v]<s[v]||a[v]>t[v])return null}else{const S=1/u[v];let E=(s[v]-a[v])*S,R=(t[v]-a[v])*S;if(E>R){const P=E;E=R,R=P}if(E>d&&(d=E),R<_&&(_=R),d>_)return null}return d}function WT(s,t,a,u,d,_,v,S,E,R,P){const B=u-s,F=d-t,j=_-a,G=v-s,Q=S-t,J=E-a,ee=P[1]*J-P[2]*Q,se=P[2]*G-P[0]*J,le=P[0]*Q-P[1]*G,he=B*ee+F*se+j*le;if(Math.abs(he)<1e-15)return null;const Ee=1/he,Ce=R[0]-s,De=R[1]-t,Le=R[2]-a,Fe=(Ce*ee+De*se+Le*le)*Ee;if(Fe<0||Fe>1)return null;const ut=De*j-Le*F,Ue=Le*B-Ce*j,dt=Ce*F-De*B,St=(P[0]*ut+P[1]*Ue+P[2]*dt)*Ee;return St<0||Fe+St>1?null:(G*ut+Q*Ue+J*dt)*Ee}function YT(s,t,a){return(s-t)/(a-t)}function QT(s,t,a,u,d,_,v,S,E){const R=1<<a,P=_-u,B=v-d,F=(s+1)/R*P+u,j=(t+0)/R*B+d,G=(t+1)/R*B+d;S[0]=(s+0)/R*P+u,S[1]=j,E[0]=F,E[1]=G}class KT{constructor(t){if(this.maximums=[],this.minimums=[],this.leaves=[],this.childOffsets=[],this.nodeCount=0,this.dem=t,this._siblingOffset=[[0,0],[1,0],[0,1],[1,1]],!this.dem)return;const a=(function(_){const v=Math.ceil(Math.log2(_.dim/8)),S=[];let E=Math.ceil(Math.pow(2,v));const R=1/E,P=(j,G,Q,J,ee)=>{const se=J?1:0,le=(j+1)*Q-se,he=G*Q,Ee=(G+1)*Q-se;ee[0]=j*Q,ee[1]=he,ee[2]=le,ee[3]=Ee};let B=new XT(E);const F=[];for(let j=0;j<E*E;j++){P(j%E,Math.floor(j/E),R,!1,F);const G=Jp(F[0],F[1],_),Q=Jp(F[2],F[1],_),J=Jp(F[2],F[3],_),ee=Jp(F[0],F[3],_);B.minimums.push(Math.min(G,Q,J,ee)),B.maximums.push(Math.max(G,Q,J,ee)),B.leaves.push(1)}for(S.push(B),E/=2;E>=1;E/=2){const j=S[S.length-1];B=new XT(E);for(let G=0;G<E*E;G++){P(G%E,Math.floor(G/E),2,!0,F);const Q=j.getElevation(F[0],F[1]),J=j.getElevation(F[2],F[1]),ee=j.getElevation(F[2],F[3]),se=j.getElevation(F[0],F[3]),le=j.isLeaf(F[0],F[1]),he=j.isLeaf(F[2],F[1]),Ee=j.isLeaf(F[2],F[3]),Ce=j.isLeaf(F[0],F[3]),De=Math.min(Q.min,J.min,ee.min,se.min),Le=Math.max(Q.max,J.max,ee.max,se.max),Fe=le&&he&&Ee&&Ce;B.maximums.push(Le),B.minimums.push(De),B.leaves.push(Le-De<=5&&Fe?1:0)}S.push(B)}return S})(this.dem),u=a.length-1,d=a[u];this._addNode(d.minimums[0],d.maximums[0],d.leaves[0]),this._construct(a,0,0,u,0)}raycastRoot(t,a,u,d,_,v,S=1){return ZT([t,a,-100],[u,d,this.maximums[0]*S],_,v)}raycast(t,a,u,d,_,v,S=1){if(!this.nodeCount)return null;const E=this.raycastRoot(t,a,u,d,_,v,S);if(E==null)return null;const R=[],P=[],B=[],F=[],j=[{idx:0,t:E,nodex:0,nodey:0,depth:0}];for(;j.length>0;){const{idx:G,t:Q,nodex:J,nodey:ee,depth:se}=j.pop();if(this.leaves[G]){QT(J,ee,se,t,a,u,d,B,F);const he=1<<se,Ee=(J+0)/he,Ce=(J+1)/he,De=(ee+0)/he,Le=(ee+1)/he,Fe=Jp(Ee,De,this.dem)*S,ut=Jp(Ce,De,this.dem)*S,Ue=Jp(Ce,Le,this.dem)*S,dt=Jp(Ee,Le,this.dem)*S,St=WT(B[0],B[1],Fe,F[0],B[1],ut,F[0],F[1],Ue,_,v),gt=WT(F[0],F[1],Ue,B[0],F[1],dt,B[0],B[1],Fe,_,v),yt=Math.min(St!==null?St:Number.MAX_VALUE,gt!==null?gt:Number.MAX_VALUE);if(yt!==Number.MAX_VALUE)return yt;{const Rt=Er([],_,v,Q);if(JT(Fe,ut,dt,Ue,YT(Rt[0],B[0],F[0]),YT(Rt[1],B[1],F[1]))>=Rt[2])return Q}continue}let le=0;for(let he=0;he<this._siblingOffset.length;he++){QT((J<<1)+this._siblingOffset[he][0],(ee<<1)+this._siblingOffset[he][1],se+1,t,a,u,d,B,F),B[2]=-100,F[2]=this.maximums[this.childOffsets[G]+he]*S;const Ee=ZT(B,F,_,v);if(Ee!=null){const Ce=Ee;R[he]=Ce;let De=!1;for(let Le=0;Le<le&&!De;Le++)Ce>=R[P[Le]]&&(P.splice(Le,0,he),De=!0);De||(P[le]=he),le++}}for(let he=0;he<le;he++){const Ee=P[he];j.push({idx:this.childOffsets[G]+Ee,t:R[Ee],nodex:(J<<1)+this._siblingOffset[Ee][0],nodey:(ee<<1)+this._siblingOffset[Ee][1],depth:se+1})}}return null}_addNode(t,a,u){return this.minimums.push(t),this.maximums.push(a),this.leaves.push(u),this.childOffsets.push(0),this.nodeCount++}_construct(t,a,u,d,_){if(t[d].isLeaf(a,u)===1)return;this.childOffsets[_]||(this.childOffsets[_]=this.nodeCount);const v=d-1,S=t[v];let E=0,R=0;for(let P=0;P<this._siblingOffset.length;P++){const B=2*a+this._siblingOffset[P][0],F=2*u+this._siblingOffset[P][1],j=S.getElevation(B,F),G=S.isLeaf(B,F),Q=this._addNode(j.min,j.max,G);G&&(E|=1<<P),R||(R=Q)}for(let P=0;P<this._siblingOffset.length;P++)E&1<<P||this._construct(t,2*a+this._siblingOffset[P][0],2*u+this._siblingOffset[P][1],v,R+P)}}function JT(s,t,a,u,d,_){return xr(xr(s,a,_),xr(t,u,_),d)}function Jp(s,t,a){const u=a.dim,d=Ie(s*u-.5,0,u-1),_=Ie(t*u-.5,0,u-1),v=Math.floor(d),S=Math.floor(_),E=Math.min(v+1,u-1),R=Math.min(S+1,u-1);return JT(a.get(v,S),a.get(E,S),a.get(v,R),a.get(E,R),d-v,_-S)}const tO={mapbox:[6553.6,25.6,.1,1e4],terrarium:[256,1,1/256,32768]};function rO(s,t,a){return(256*s*256+256*t+a)/10-1e4}function iO(s,t,a){return 256*s+t+a/256-32768}class X1{get tree(){return this._tree||this._buildQuadTree(),this._tree}constructor(t,a,u,d=!1){if(this.uid=t,a.height!==a.width)throw new RangeError("DEM tiles must be square");if(u&&u!=="mapbox"&&u!=="terrarium")return void ri(`"${u}" is not a valid encoding type. Valid types include "mapbox" and "terrarium".`);this.stride=a.height;const _=this.dim=a.height-2,v=new Uint32Array(a.data.buffer);if(this.pixels=new Uint8Array(a.data.buffer),this.floatView=new Float32Array(a.data.buffer),this.borderReady=d,this._modifiedForSources={},!d){for(let E=0;E<_;E++)v[this._idx(-1,E)]=v[this._idx(0,E)],v[this._idx(_,E)]=v[this._idx(_-1,E)],v[this._idx(E,-1)]=v[this._idx(E,0)],v[this._idx(E,_)]=v[this._idx(E,_-1)];v[this._idx(-1,-1)]=v[this._idx(0,0)],v[this._idx(_,-1)]=v[this._idx(_-1,0)],v[this._idx(-1,_)]=v[this._idx(0,_-1)],v[this._idx(_,_)]=v[this._idx(_-1,_-1)]}const S=u==="terrarium"?iO:rO;for(let E=0;E<v.length;++E){const R=4*E;this.floatView[E]=S(this.pixels[R],this.pixels[R+1],this.pixels[R+2])}this._timestamp=Ys.now()}_buildQuadTree(){this._tree=new KT(this)}get(t,a,u=!1){u&&(t=Ie(t,-1,this.dim),a=Ie(a,-1,this.dim));const d=this._idx(t,a);return this.floatView[d]}set(t,a,u){const d=this._idx(t,a),_=this.floatView[d];return this.floatView[d]=u,u-_}static getUnpackVector(t){return tO[t]}_idx(t,a){if(t<-1||t>=this.dim+1||a<-1||a>=this.dim+1)throw new RangeError("out of range source coordinates for DEM data");return(a+1)*this.stride+(t+1)}static pack(t,a){const u=[0,0,0,0],d=X1.getUnpackVector(a);let _=Math.floor((t+d[3])/d[2]);return u[2]=_%256,_=Math.floor(_/256),u[1]=_%256,_=Math.floor(_/256),u[0]=_,u}getPixels(){return new u0({width:this.stride,height:this.stride},this.pixels)}backfillBorder(t,a,u){if(this.dim!==t.dim)throw new Error("dem dimension mismatch");let d=a*this.dim,_=a*this.dim+this.dim,v=u*this.dim,S=u*this.dim+this.dim;switch(a){case-1:d=_-1;break;case 1:_=d+1}switch(u){case-1:v=S-1;break;case 1:S=v+1}const E=-a*this.dim,R=-u*this.dim;for(let P=v;P<S;P++)for(let B=d;B<_;B++){const F=4*this._idx(B,P),j=4*this._idx(B+E,P+R);this.pixels[F+0]=t.pixels[j+0],this.pixels[F+1]=t.pixels[j+1],this.pixels[F+2]=t.pixels[j+2],this.pixels[F+3]=t.pixels[j+3]}}onDeserialize(){this._tree&&(this._tree.dem=this)}}function nO(s,t,a){s===1?t.headerLength=a.readFixed32():s===2?t.x=a.readVarint():s===3?t.y=a.readVarint():s===4?t.z=a.readVarint():s===5&&t.layers.push((function(u,d){return u.readFields(cO,{version:0,name:"",units:"",tileSize:0,buffer:0,pixelFormat:0,dataIndex:[]},d)})(a,a.readVarint()+a.pos))}function oO(s,t,a){s===1?(t.delta_filter=(function(u,d){return u.readFields(aO,{blockSize:0},d)})(a,a.readVarint()+a.pos),t.filter="delta_filter"):s===2?(a.readVarint(),t.filter="zigzag_filter"):s===3?(a.readVarint(),t.filter="bitshuffle_filter"):s===4&&(a.readVarint(),t.filter="byteshuffle_filter")}function aO(s,t,a){s===1&&(t.blockSize=a.readVarint())}function sO(s,t,a){s===1?(a.readVarint(),t.codec="gzip_data"):s===2?(a.readVarint(),t.codec="jpeg_image"):s===3?(a.readVarint(),t.codec="webp_image"):s===4&&(a.readVarint(),t.codec="png_image")}function lO(s,t,a){let u=0,d=0;s===1?t.firstByte=a.readFixed64():s===2?t.lastByte=a.readFixed64():s===3?t.filters.push((function(_,v){return _.readFields(oO,{},v)})(a,a.readVarint()+a.pos)):s===4?t.codec=(function(_,v){return _.readFields(sO,{},v)})(a,a.readVarint()+a.pos):s===5?d=a.readFloat():s===6?u=a.readFloat():s===7?t.bands.push(a.readString()):s===8?t.offset=a.readDouble():s===9&&(t.scale=a.readDouble()),t.offset===0&&(t.offset=d),t.scale===0&&(t.scale=u)}function cO(s,t,a){s===1?t.version=a.readVarint():s===2?t.name=a.readString():s===3?t.units=a.readString():s===4?t.tileSize=a.readVarint():s===5?t.buffer=a.readVarint():s===6?t.pixelFormat=a.readVarint():s===7&&t.dataIndex.push((function(u,d){return u.readFields(lO,{firstByte:0,lastByte:0,filters:[],codec:null,offset:0,scale:0,bands:[]},d)})(a,a.readVarint()+a.pos))}function uO(s,t,a){if(s===2)(function(u,d,_){u.readFields(hO,_,d)})(a,a.readVarint()+a.pos,t);else if(s===3)throw new Error("Not implemented")}function hO(s,t,a){if(s===1){let u=0;const d=a.readVarint()+a.pos;for(;a.pos<d;)t[u++]=a.readVarint()}}function fO(s,t){if(t.length!==4)throw new Error(`Expected data of dimension 4 but got ${t.length}.`);let a=t[3];for(let u=2;u>=1;u--){const d=u===1?1:0,_=u===2?1:0;for(let v=0;v<t[0];v++){const S=t[1]*v;for(let E=d;E<t[1];E++){const R=t[2]*(E+S);for(let P=_;P<t[2];P++){const B=t[3]*(P+R);for(let F=0;F<t[3];F++){const j=B+F;s[j]+=s[j-a]}}}}a*=t[u]}return s}function dO(s){for(let t=0,a=s.length;t<a;t++)s[t]=s[t]>>>1^-(1&s[t]);return s}function pO(s,t){switch(t){case"uint32":return s;case"uint16":for(let a=0;a<s.length;a+=2){const u=s[a],d=s[a+1];s[a]=(240&u)>>4|(61440&u)>>8|(240&d)<<4|61440&d,s[a+1]=15&u|(3840&u)>>4|(15&d)<<8|(3840&d)<<4}return s;case"uint8":for(let a=0;a<s.length;a+=4){const u=s[a],d=s[a+1],_=s[a+2],v=s[a+3];s[a+0]=(192&u)>>6|(192&d)>>4|(192&_)>>2|192&v,s[a+1]=(48&u)>>4|(48&d)>>2|48&_|(48&v)<<2,s[a+2]=(12&u)>>2|12&d|(12&_)<<2|(12&v)<<4,s[a+3]=3&u|(3&d)<<2|(3&_)<<4|(3&v)<<6}return s;default:throw new Error(`Invalid pixel format, "${t}"`)}}$t(X1,"DEMData"),$t(KT,"DemMinMaxQuadTree",{omit:["dem"]});var kc=Uint8Array,G0=Uint16Array,mO=Int32Array,eA=new kc([0,0,0,0,0,0,0,0,1,1,1,1,2,2,2,2,3,3,3,3,4,4,4,4,5,5,5,5,0,0,0,0]),tA=new kc([0,0,0,0,1,1,2,2,3,3,4,4,5,5,6,6,7,7,8,8,9,9,10,10,11,11,12,12,13,13,0,0]),gO=new kc([16,17,18,0,8,7,9,6,10,5,11,4,12,3,13,2,14,1,15]),rA=function(s,t){for(var a=new G0(31),u=0;u<31;++u)a[u]=t+=1<<s[u-1];var d=new mO(a[30]);for(u=1;u<30;++u)for(var _=a[u];_<a[u+1];++_)d[_]=_-a[u]<<5|u;return{b:a,r:d}},iA=rA(eA,2),nA=iA.b,_O=iA.r;nA[28]=258,_O[258]=28;for(var yO=rA(tA,0).b,oA=new G0(32768),wo=0;wo<32768;++wo){var T_=(43690&wo)>>1|(21845&wo)<<1;oA[wo]=((65280&(T_=(61680&(T_=(52428&T_)>>2|(13107&T_)<<2))>>4|(3855&T_)<<4))>>8|(255&T_)<<8)>>1}var H0=function(s,t,a){for(var u=s.length,d=0,_=new G0(t);d<u;++d)s[d]&&++_[s[d]-1];var v,S=new G0(t);for(d=1;d<t;++d)S[d]=S[d-1]+_[d-1]<<1;v=new G0(1<<t);var E=15-t;for(d=0;d<u;++d)if(s[d])for(var R=d<<4|s[d],P=t-s[d],B=S[s[d]-1]++<<P,F=B|(1<<P)-1;B<=F;++B)v[oA[B]>>E]=R;return v},q0=new kc(288);for(wo=0;wo<144;++wo)q0[wo]=8;for(wo=144;wo<256;++wo)q0[wo]=9;for(wo=256;wo<280;++wo)q0[wo]=7;for(wo=280;wo<288;++wo)q0[wo]=8;var aA=new kc(32);for(wo=0;wo<32;++wo)aA[wo]=5;var vO=H0(q0,9),xO=H0(aA,5),$x=function(s){for(var t=s[0],a=1;a<s.length;++a)s[a]>t&&(t=s[a]);return t},yh=function(s,t,a){var u=t/8|0;return(s[u]|s[u+1]<<8)>>(7&t)&a},Xx=function(s,t){var a=t/8|0;return(s[a]|s[a+1]<<8|s[a+2]<<16)>>(7&t)},bO=["unexpected EOF","invalid block type","invalid length/literal","invalid distance","stream finished","no stream handler",,"no callback","invalid UTF-8 data","extra field too long","date not in range 1980-2099","filename too long","stream finishing","invalid zip data"],vh=function(s,t,a){var u=new Error(t||bO[s]);if(u.code=s,Error.captureStackTrace&&Error.captureStackTrace(u,vh),!a)throw u;return u},wO=new kc(0),SO=typeof TextDecoder<"u"&&new TextDecoder;try{SO.decode(wO,{stream:!0})}catch{}const TO={gzip_data:"gzip"};class Au extends Error{constructor(t){super(t),this.name="MRTError"}}const AO={0:"uint32",1:"uint32",2:"uint16",3:"uint8"},sA={uint32:1,uint16:2,uint8:4},EO={uint32:Uint32Array,uint16:Uint16Array,uint8:Uint8Array};let Zx;class Z1{constructor(t=5){this.x=NaN,this.y=NaN,this.z=NaN,this.layers={},this._cacheSize=t}getLayer(t){const a=this.layers[t];if(!a)throw new Au(`Layer '${t}' not found`);return a}getHeaderLength(t){const a=new Uint8Array(t),u=new DataView(t);if(a[0]!==13)throw new Au("File is not a valid MRT.");return u.getUint32(1,!0)}parseHeader(t){const a=new Uint8Array(t),u=this.getHeaderLength(t);if(a.length<u)throw new Au(`Expected header with length >= ${u} but got buffer of length ${a.length}`);const d=new Zx(a.subarray(0,u)).readFields(nO,{headerLength:0,x:0,y:0,z:0,layers:[]},void 0);if(!isNaN(this.x)&&(this.x!==d.x||this.y!==d.y||this.z!==d.z))throw new Au(`Invalid attempt to parse header ${d.z}/${d.x}/${d.y} for tile ${this.z}/${this.x}/${this.y}`);this.x=d.x,this.y=d.y,this.z=d.z;for(const _ of d.layers)this.layers[_.name]=new lA(_,{cacheSize:this._cacheSize});return this}createDecodingTask(t){const a=[],u=this.getLayer(t.layerName);for(let d of t.blockIndices){const _=u.dataIndex[d],v=_.firstByte-t.firstByte,S=_.lastByte-t.firstByte;if(u._blocksInProgress.has(d))continue;const E={layerName:u.name,firstByte:v,lastByte:S,pixelFormat:u.pixelFormat,blockIndex:d,blockShape:[_.bands.length].concat(u.bandShape),buffer:u.buffer,codec:_.codec.codec,filters:_.filters.map((R=>R.filter))};u._blocksInProgress.add(d),a.push(E)}return new cA(a,(()=>{a.forEach((d=>u._blocksInProgress.delete(d.blockIndex)))}),((d,_)=>{if(a.forEach((v=>u._blocksInProgress.delete(v.blockIndex))),d)throw d;_.forEach((v=>{this.getLayer(v.layerName).processDecodedData(v)}))}))}}class lA{constructor({version:t,name:a,units:u,tileSize:d,pixelFormat:_,buffer:v,dataIndex:S},E){if(this.version=t,this.version!==1)throw new Au(`Cannot parse raster layer encoded with MRT version ${t}`);this.name=a,this.units=u,this.tileSize=d,this.buffer=v,this.pixelFormat=AO[_],this.dataIndex=S,this.bandShape=[d+2*v,d+2*v,sA[this.pixelFormat]],this._decodedBlocks=new $1(E?E.cacheSize:5),this._blocksInProgress=new Set}get dimension(){return sA[this.pixelFormat]}get cacheSize(){return this._decodedBlocks.capacity}getBandList(){return this.dataIndex.map((({bands:t})=>t)).flat()}processDecodedData(t){const a=t.blockIndex.toString();this._decodedBlocks.get(a)||this._decodedBlocks.put(a,t.data)}getBlockForBand(t){let a=0;switch(typeof t){case"string":for(const[u,d]of this.dataIndex.entries()){for(const[_,v]of d.bands.entries())if(v===t)return{bandIndex:a+_,blockIndex:u,blockBandIndex:_};a+=d.bands.length}break;case"number":for(const[u,d]of this.dataIndex.entries()){if(t>=a&&t<a+d.bands.length)return{bandIndex:t,blockIndex:u,blockBandIndex:t-a};a+=d.bands.length}break;default:throw new Au(`Invalid band \`${JSON.stringify(t)}\`. Expected string or integer.`)}return{blockIndex:-1,blockBandIndex:-1}}getDataRange(t){let a=1/0,u=-1/0;const d=[],_=new Set;for(const v of t){const{blockIndex:S}=this.getBlockForBand(v);if(S<0)throw new Au(`Invalid band: ${JSON.stringify(v)}`);const E=this.dataIndex[S];d.includes(S)||d.push(S),_.add(S),a=Math.min(a,E.firstByte),u=Math.max(u,E.lastByte)}if(_.size>this.cacheSize)throw new Au(`Number of blocks to decode (${_.size}) exceeds cache size (${this.cacheSize}).`);return{layerName:this.name,firstByte:a,lastByte:u,blockIndices:d}}hasBand(t){const{blockIndex:a}=this.getBlockForBand(t);return a>=0}hasDataForBand(t){const{blockIndex:a}=this.getBlockForBand(t);return a>=0&&!!this._decodedBlocks.get(a.toString())}getBandView(t){const{blockIndex:a,blockBandIndex:u}=this.getBlockForBand(t);if(a<0)throw new Au(`Band not found: ${JSON.stringify(t)}`);const d=this._decodedBlocks.get(a.toString());if(!d)throw new Au(`Data for band ${JSON.stringify(t)} of layer "${this.name}" not decoded.`);const _=this.dataIndex[a],v=this.bandShape.reduce(((R,P)=>R*P),1),S=u*v,E=d.subarray(S,S+v);return{data:E,bytes:new Uint8Array(E.buffer).subarray(E.byteOffset,E.byteOffset+E.byteLength),tileSize:this.tileSize,buffer:this.buffer,pixelFormat:this.pixelFormat,dimension:this.dimension,offset:_.offset,scale:_.scale}}}Z1.setPbf=function(s){Zx=s};class cA{constructor(t,a,u){this.tasks=t,this._onCancel=a,this._onComplete=u,this._finalized=!1}cancel(){this._finalized||(this._onCancel(),this._finalized=!0)}complete(t,a){this._finalized||(this._onComplete(t,a),this._finalized=!0)}}Z1.performDecoding=function(s,t){const a=new Uint8Array(s);return Promise.all(t.tasks.map((u=>{const{layerName:d,firstByte:_,lastByte:v,pixelFormat:S,blockShape:E,blockIndex:R,filters:P,codec:B}=u,F=a.subarray(_,v+1),j=new Uint32Array(E[0]*E[1]*E[2]);let G;if(B!=="gzip_data")throw new Au(`Unhandled codec: ${B}`);return G=(function(Q,J){if(!globalThis.DecompressionStream&&J==="gzip_data")return Promise.resolve(((he=(function(De){De[0]==31&&De[1]==139&&De[2]==8||vh(6,"invalid gzip data");var Le=De[3],Fe=10;4&Le&&(Fe+=2+(De[10]|De[11]<<8));for(var ut=(Le>>3&1)+(Le>>4&1);ut>0;ut-=!De[Fe++]);return Fe+(2&Le)})(le=Q))+8>le.length&&vh(6,"invalid gzip data"),(function(De,Le,Fe,ut){var Ue=De.length;if(!Ue||Le.f&&!Le.l)return Fe||new kc(0);var dt=!Fe,St=dt||Le.i!=2,gt=Le.i;dt&&(Fe=new kc(3*Ue));var yt,Rt,lt=function(an){var sn=Fe.length;if(an>sn){var Qi=new kc(Math.max(2*sn,an));Qi.set(Fe),Fe=Qi}},vt=Le.f||0,et=Le.p||0,We=Le.b||0,Dt=Le.l,Et=Le.d,dr=Le.m,Zt=Le.n,nr=8*Ue;do{if(!Dt){vt=yh(De,et,1);var Nt=yh(De,et+1,3);if(et+=3,!Nt){var ur=De[(de=4+((et+7)/8|0))-4]|De[de-3]<<8,Dr=de+ur;if(Dr>Ue){gt&&vh(0);break}St&&lt(We+ur),Fe.set(De.subarray(de,Dr),We),Le.b=We+=ur,Le.p=et=8*Dr,Le.f=vt;continue}if(Nt==1)Dt=vO,Et=xO,dr=9,Zt=5;else if(Nt==2){var Ht=yh(De,et,31)+257,ar=yh(De,et+10,15)+4,Sr=Ht+yh(De,et+5,31)+1;et+=14;for(var Br=new kc(Sr),$r=new kc(19),Vr=0;Vr<ar;++Vr)$r[gO[Vr]]=yh(De,et+3*Vr,7);et+=3*ar;var er=$x($r),zr=(1<<er)-1,ci=H0($r,er);for(Vr=0;Vr<Sr;){var de,pe=ci[yh(De,et,zr)];if(et+=15&pe,(de=pe>>4)<16)Br[Vr++]=de;else{var Ke=0,ct=0;for(de==16?(ct=3+yh(De,et,3),et+=2,Ke=Br[Vr-1]):de==17?(ct=3+yh(De,et,7),et+=3):de==18&&(ct=11+yh(De,et,127),et+=7);ct--;)Br[Vr++]=Ke}}var Gt=Br.subarray(0,Ht),jt=Br.subarray(Ht);dr=$x(Gt),Zt=$x(jt),Dt=H0(Gt,dr),Et=H0(jt,Zt)}else vh(1);if(et>nr){gt&&vh(0);break}}St&&lt(We+131072);for(var Kt=(1<<dr)-1,mr=(1<<Zt)-1,Xr=et;;Xr=et){var Zr=(Ke=Dt[Xx(De,et)&Kt])>>4;if((et+=15&Ke)>nr){gt&&vh(0);break}if(Ke||vh(2),Zr<256)Fe[We++]=Zr;else{if(Zr==256){Xr=et,Dt=null;break}var Hr=Zr-254;Zr>264&&(Hr=yh(De,et,(1<<(jr=eA[Vr=Zr-257]))-1)+nA[Vr],et+=jr);var Bi=Et[Xx(De,et)&mr],mn=Bi>>4;if(Bi||vh(3),et+=15&Bi,jt=yO[mn],mn>3){var jr=tA[mn];jt+=Xx(De,et)&(1<<jr)-1,et+=jr}if(et>nr){gt&&vh(0);break}St&&lt(We+131072);var Ji=We+Hr;if(We<jt){var ki=0-jt,Ai=Math.min(jt,Ji);for(ki+We<0&&vh(3);We<Ai;++We)Fe[We]=(void 0)[ki+We]}for(;We<Ji;++We)Fe[We]=Fe[We-jt]}}Le.l=Dt,Le.p=Xr,Le.b=We,Le.f=vt,Dt&&(vt=1,Le.m=dr,Le.d=Et,Le.n=Zt)}while(!vt);return We!=Fe.length&&dt?(yt=Fe,((Rt=We)==null||Rt>yt.length)&&(Rt=yt.length),new kc(yt.subarray(0,Rt))):Fe.subarray(0,We)})(le.subarray(he,-8),{i:2},new kc(((ee=le)[(se=ee.length)-4]|ee[se-3]<<8|ee[se-2]<<16|ee[se-1]<<24)>>>0))));var ee,se,le,he;const Ee=TO[J];if(!Ee)throw new Error(`Unhandled codec: ${J}`);const Ce=new globalThis.DecompressionStream(Ee);return new Response(new Blob([Q]).stream().pipeThrough(Ce)).arrayBuffer().then((De=>new Uint8Array(De)))})(F,B).then((Q=>((function(J,ee){J.readFields(uO,ee)})(new Zx(Q),j),new EO[S](j.buffer)))),G.then((Q=>{for(let J=P.length-1;J>=0;J--)switch(P[J]){case"delta_filter":fO(Q,E);break;case"zigzag_filter":dO(Q);break;case"bitshuffle_filter":pO(Q,S);break;default:throw new Au(`Unhandled filter "${P[J]}"`)}return{layerName:d,blockIndex:R,data:Q}})).catch((Q=>{throw Q}))})))},$t(cA,"MRTDecodingBatch",{omit:["_onCancel","_onComplete"]}),$t(Z1,"MapboxRasterTile"),$t(lA,"MapboxRasterLayer",{omit:["_blocksInProgress"]});class uA{constructor(t){this._stringToNumber={},this._numberToString=[];for(let a=0;a<t.length;a++){const u=t[a];this._stringToNumber[u]=a,this._numberToString[a]=u}}encode(t){return this._stringToNumber[t]}decode(t){return this._numberToString[t]}}const CO=["id","tile","layer","source","sourceLayer","state"];class A_{constructor(t,a,u,d,_){this.type="Feature",this._vectorTileFeature=t,this._z=a,this._x=u,this._y=d,this.properties=t.properties,this.id=_}clone(){const t=new A_(this._vectorTileFeature,this._z,this._x,this._y,this.id);return this.state&&(t.state=Object.assign({},this.state)),this.layer&&(t.layer=Object.assign({},this.layer)),this.source&&(t.source=this.source),this.sourceLayer&&(t.sourceLayer=this.sourceLayer),t}get geometry(){return this._geometry===void 0&&(this._geometry=this._vectorTileFeature.toGeoJSON(this._x,this._y,this._z).geometry),this._geometry}set geometry(t){this._geometry=t}toJSON(){const t={type:"Feature",state:void 0,geometry:this.geometry,properties:this.properties};for(const a of CO)this[a]!==void 0&&(t[a]=this[a]);return t}}class hA{constructor(t,a){this.tileID=t,this.x=t.canonical.x,this.y=t.canonical.y,this.z=t.canonical.z,this.grid=new Sc(Bt,16,0),this.featureIndexArray=new Dp,this.promoteId=a,this.is3DTile=!1,this.serializedLayersCache=new Map}insert(t,a,u,d,_,v=0,S=0){const E=this.featureIndexArray.length;this.featureIndexArray.emplaceBack(u,d,_,v);const R=this.grid;for(let P=0;P<a.length;P++){const B=a[P],F=[1/0,1/0,-1/0,-1/0];for(let j=0;j<B.length;j++){const G=B[j];F[0]=Math.min(F[0],G.x),F[1]=Math.min(F[1],G.y),F[2]=Math.max(F[2],G.x),F[3]=Math.max(F[3],G.y)}S!==0&&(F[0]-=S,F[1]-=S,F[2]+=S,F[3]+=S),F[0]<Bt&&F[1]<Bt&&F[2]>=0&&F[3]>=0&&R.insert(E,F[0],F[1],F[2],F[3])}}loadVTLayers(){if(!this.vtLayers){this.vtLayers=new fr(new w1(this.rawTileData)).layers,this.sourceLayerCoder=new uA(this.vtLayers?Object.keys(this.vtLayers).sort():["_geojsonTileLayer"]),this.vtFeatures={};for(const t in this.vtLayers)this.vtFeatures[t]=[]}return this.vtLayers}query(t,a){const{tilespaceGeometry:u,transform:d,tileTransform:_,pixelPosMatrix:v,availableImages:S,worldview:E}=a;this.loadVTLayers(),this.serializedLayersCache.clear();const R=u.bufferedTilespaceBounds,P=this.grid.query(R.min.x,R.min.y,R.max.x,R.max.y,((G,Q,J,ee)=>Rn(u.bufferedTilespaceGeometry,G,Q,J,ee)));P.sort(IO);let B=null;d.elevation&&P.length>0&&(B=b_.create(d.elevation,this.tileID));const F={};let j;for(let G=0;G<P.length;G++){const Q=P[G];if(Q===j)continue;j=Q;const J=this.featureIndexArray.get(Q);let ee=null;this.is3DTile?this.loadMatchingModelFeature(F,J,t,u,d,E):this.loadMatchingFeature(F,J,t,S,E,((se,le,he,Ee=0)=>(ee||(ee=wt(se,this.tileID.canonical,_)),le.queryIntersectsFeature(u,se,he,ee,this.z,d,v,B,Ee))))}return F}loadMatchingFeature(t,a,u,d,_,v){const{featureIndex:S,bucketIndex:E,sourceLayerIndex:R,layoutVertexArrayOffset:P}=a,B=this.bucketLayerIDs[E],F=u.layers,j=Object.keys(F);if(j.length&&!Yr(j,B))return;const G=u.sourceCache,Q=this.sourceLayerCoder.decode(R),J=this.vtLayers[Q].feature(S),ee=this.getId(J,Q);for(let se=0;se<B.length;se++){const le=B[se];if(!F[le])continue;const{styleLayer:he,targets:Ee}=F[le];let Ce={};ee!==void 0&&(Ce=G.getFeatureState(he.sourceLayer,ee));const De=!v||v(J,he,Ce,P);if(!De)continue;const Le=new A_(J,this.z,this.x,this.y,ee);Le.tile=this.tileID.canonical,Le.state=Ce;let Fe=this.serializedLayersCache.get(le);Fe||(Fe=he.serialize(),Fe.id=le,this.serializedLayersCache.set(le,Fe)),Le.source=Fe.source,Le.sourceLayer=Fe["source-layer"],Le.layer=Object.assign({},Fe),Le.layer.paint=fA(Fe.paint,he.paint,J,Ce,d),Le.layer.layout=fA(Fe.layout,he.layout,J,Ce,d);let ut=!1;for(const Ue of Ee){this.updateFeatureProperties(Le,Ue);const{filter:dt}=Ue;if(dt){if(J.properties=Le.properties,dt.needGeometry){const St=ft(J,!0);if(!dt.filter(new Hi(this.tileID.overscaledZ,{worldview:_}),St,this.tileID.canonical))continue}else if(!dt.filter(new Hi(this.tileID.overscaledZ,{worldview:_}),J))continue}ut=!0,Ue.targetId&&this.addFeatureVariant(Le,Ue)}ut&&this.appendToResult(t,le,S,Le,De)}}loadMatchingModelFeature(t,a,u,d,_,v){const{featureIndex:S,bucketIndex:E}=a,R=this.bucketLayerIDs[E],P=u.layers,B=Object.keys(P);if(!B.length||Yr(B,R))for(let F=0;F<R.length;F++){const j=R[F],{styleLayer:G,targets:Q}=P[j];if(G.type!=="model")continue;const J=d.tile,ee=J.getBucket(G);if(!(ee&&ee instanceof U1))continue;const se=PD(ee,S,d,_);if(!se)continue;const{z:le,x:he,y:Ee}=J.tileID.canonical,{feature:Ce,intersectionZ:De,position:Le}=se;let Fe={};Ce.id!==void 0&&(Fe=u.sourceCache.getFeatureState(G.sourceLayer,Ce.id));const ut=new A_({},le,he,Ee,Ce.id);ut.tile=this.tileID.canonical,ut.state=Fe,ut.properties=Ce.properties,ut.geometry={type:"Point",coordinates:[Le.lng,Le.lat]};let Ue=this.serializedLayersCache.get(j);Ue||(Ue=G.serialize(),Ue.id=j,this.serializedLayersCache.set(j,Ue)),ut.source=Ue.source,ut.sourceLayer=Ue["source-layer"],ut.layer=Object.assign({},Ue);let dt=!1;for(const St of Q){this.updateFeatureProperties(ut,St);const{filter:gt}=St;if(gt){if(Ce.properties=ut.properties,gt.needGeometry){if(!gt.filter(new Hi(this.tileID.overscaledZ,{worldview:v}),Ce,this.tileID.canonical))continue}else if(!gt.filter(new Hi(this.tileID.overscaledZ,{worldview:v}),Ce))continue}dt=!0,St.targetId&&this.addFeatureVariant(ut,St)}dt&&this.appendToResult(t,j,S,ut,De)}}updateFeatureProperties(t,a,u){if(a.properties){const d={};for(const _ in a.properties){const v=a.properties[_].evaluate({zoom:this.z},t._vectorTileFeature,t.state,t.tile,u);v!=null&&(d[_]=v)}t.properties=d}}addFeatureVariant(t,a,u){const d={target:a.target,namespace:a.namespace,uniqueFeatureID:a.uniqueFeatureID};a.properties&&(d.properties=t.properties),t.variants=t.variants||{},t.variants[a.targetId]=t.variants[a.targetId]||[],t.variants[a.targetId].push(d)}appendToResult(t,a,u,d,_){let v=t[a];v===void 0&&(v=t[a]=[]),v.push({featureIndex:u,feature:d,intersectionZ:_})}lookupSymbolFeatures(t,a,u,d,_,v){const S={};this.loadVTLayers();for(const E of t)this.loadMatchingFeature(S,{bucketIndex:a,sourceLayerIndex:u,featureIndex:E,layoutVertexArrayOffset:0},d,_,v);return S}loadFeature(t){const{featureIndex:a,sourceLayerIndex:u}=t;this.loadVTLayers();const d=this.sourceLayerCoder.decode(u),_=this.vtFeatures[d];if(_[a])return _[a];const v=this.vtLayers[d].feature(a);return _[a]=v,v}hasLayer(t){for(const a of this.bucketLayerIDs)for(const u of a)if(t===u)return!0;return!1}getId(t,a){let u=t.id;if(this.promoteId){const d=Array.isArray(this.promoteId)||typeof this.promoteId!="object"?this.promoteId:this.promoteId[a];if(d!=null)if(Array.isArray(d)){if(!this.promoteIdExpression){const _=qa(d);if(_.result!=="success"){const v=_.value.map((S=>`${S.key}: ${S.message}`)).join(", ");return void ri(`Failed to create expression for promoteId: ${v}`)}this.promoteIdExpression=_.value}this.promoteIdExpression._evaluator||(this.promoteIdExpression._evaluator=new lc),u=this.promoteIdExpression.evaluate({zoom:0},t)}else u=t.properties[d];typeof u=="boolean"&&(u=Number(u))}return u}}function fA(s,t,a,u,d){return gr(s,((_,v)=>{const S=t instanceof mu?t.get(v):null;return S&&S.evaluate?S.evaluate(a,u,void 0,d):S}))}function IO(s,t){return t-s}$t(hA,"FeatureIndex",{omit:["rawTileData","sourceLayerCoder"]});const dA=[Int8Array,Uint8Array,Uint8ClampedArray,Int16Array,Uint16Array,Int32Array,Uint32Array,Float32Array,Float64Array];class Wx{static from(t){if(!(t instanceof ArrayBuffer))throw new Error("Data must be an instance of ArrayBuffer.");const[a,u]=new Uint8Array(t,0,2);if(a!==219)throw new Error("Data does not appear to be in a KDBush format.");const d=u>>4;if(d!==1)throw new Error(`Got v${d} data when expected v1.`);const _=dA[15&u];if(!_)throw new Error("Unrecognized array type.");const[v]=new Uint16Array(t,2,1),[S]=new Uint32Array(t,4,1);return new Wx(S,v,_,t)}constructor(t,a=64,u=Float64Array,d){if(isNaN(t)||t<0)throw new Error(`Unpexpected numItems value: ${t}.`);this.numItems=+t,this.nodeSize=Math.min(Math.max(+a,2),65535),this.ArrayType=u,this.IndexArrayType=t<65536?Uint16Array:Uint32Array;const _=dA.indexOf(this.ArrayType),v=2*t*this.ArrayType.BYTES_PER_ELEMENT,S=t*this.IndexArrayType.BYTES_PER_ELEMENT,E=(8-S%8)%8;if(_<0)throw new Error(`Unexpected typed array class: ${u}.`);d&&d instanceof ArrayBuffer?(this.data=d,this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+E,2*t),this._pos=2*t,this._finished=!0):(this.data=new ArrayBuffer(8+v+S+E),this.ids=new this.IndexArrayType(this.data,8,t),this.coords=new this.ArrayType(this.data,8+S+E,2*t),this._pos=0,this._finished=!1,new Uint8Array(this.data,0,2).set([219,16+_]),new Uint16Array(this.data,2,1)[0]=a,new Uint32Array(this.data,4,1)[0]=t)}add(t,a){const u=this._pos>>1;return this.ids[u]=u,this.coords[this._pos++]=t,this.coords[this._pos++]=a,u}finish(){const t=this._pos>>1;if(t!==this.numItems)throw new Error(`Added ${t} items when expected ${this.numItems}.`);return Yx(this.ids,this.coords,this.nodeSize,0,this.numItems-1,0),this._finished=!0,this}range(t,a,u,d){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:_,coords:v,nodeSize:S}=this,E=[0,_.length-1,0],R=[];for(;E.length;){const P=E.pop()||0,B=E.pop()||0,F=E.pop()||0;if(B-F<=S){for(let J=F;J<=B;J++){const ee=v[2*J],se=v[2*J+1];ee>=t&&ee<=u&&se>=a&&se<=d&&R.push(_[J])}continue}const j=F+B>>1,G=v[2*j],Q=v[2*j+1];G>=t&&G<=u&&Q>=a&&Q<=d&&R.push(_[j]),(P===0?t<=G:a<=Q)&&(E.push(F),E.push(j-1),E.push(1-P)),(P===0?u>=G:d>=Q)&&(E.push(j+1),E.push(B),E.push(1-P))}return R}within(t,a,u){if(!this._finished)throw new Error("Data not yet indexed - call index.finish().");const{ids:d,coords:_,nodeSize:v}=this,S=[0,d.length-1,0],E=[],R=u*u;for(;S.length;){const P=S.pop()||0,B=S.pop()||0,F=S.pop()||0;if(B-F<=v){for(let J=F;J<=B;J++)mA(_[2*J],_[2*J+1],t,a)<=R&&E.push(d[J]);continue}const j=F+B>>1,G=_[2*j],Q=_[2*j+1];mA(G,Q,t,a)<=R&&E.push(d[j]),(P===0?t-u<=G:a-u<=Q)&&(S.push(F),S.push(j-1),S.push(1-P)),(P===0?t+u>=G:a+u>=Q)&&(S.push(j+1),S.push(B),S.push(1-P))}return E}}function Yx(s,t,a,u,d,_){if(d-u<=a)return;const v=u+d>>1;pA(s,t,v,u,d,_),Yx(s,t,a,u,v-1,1-_),Yx(s,t,a,v+1,d,1-_)}function pA(s,t,a,u,d,_){for(;d>u;){if(d-u>600){const R=d-u+1,P=a-u+1,B=Math.log(R),F=.5*Math.exp(2*B/3),j=.5*Math.sqrt(B*F*(R-F)/R)*(P-R/2<0?-1:1);pA(s,t,a,Math.max(u,Math.floor(a-P*F/R+j)),Math.min(d,Math.floor(a+(R-P)*F/R+j)),_)}const v=t[2*a+_];let S=u,E=d;for($0(s,t,u,a),t[2*d+_]>v&&$0(s,t,u,d);S<E;){for($0(s,t,S,E),S++,E--;t[2*S+_]<v;)S++;for(;t[2*E+_]>v;)E--}t[2*u+_]===v?$0(s,t,u,E):(E++,$0(s,t,E,d)),E<=a&&(u=E+1),a<=E&&(d=E-1)}}function $0(s,t,a,u){Qx(s,a,u),Qx(t,2*a,2*u),Qx(t,2*a+1,2*u+1)}function Qx(s,t,a){const u=s[t];s[t]=s[a],s[a]=u}function mA(s,t,a,u){const d=s-a,_=t-u;return d*d+_*_}n.$=Xd,n.A=Ss,n.B=of,n.C=2,n.D=wn,n.E=Hu,n.F=O0,n.G=VS,n.H=$d,n.I=rs,n.J=cd,n.K=Tr,n.L=Wu,n.M=id,n.N=rd,n.O=Xh,n.P=Tt,n.Q=Yh,n.R=Nf,n.S=gu,n.T=ux,n.U=qa,n.V=V1,n.W=ao,n.X=Ta,n.Y=Nn,n.Z=un,n._=la,n.a=function(s){return Vo.API_CDN_URL_REGEX.test(s)},n.a$=ye,n.a0=Zu,n.a1=gm,n.a2=ud,n.a3=class extends V1{},n.a4=Zh,n.a5=hu,n.a6=Ve,n.a7=function(s){const t=s.value;return t?Zu(t)?kx(t,!0)?[]:[new V1(s.key,t,`invalid url "${t}"`)]:[new V1(s.key,t,`string expected, "${Tr(t)}" found`)]:[]},n.a8=Mm,n.a9=yn,n.aA=Ie,n.aB=ve,n.aC=Wo,n.aD=p,n.aE=lo,n.aF=fe,n.aG=qe,n.aH=function(s,t){const a={};for(let u=0;u<t.length;u++){const d=t[u];d in s&&(a[d]=s[d])}return a},n.aI=re,n.aJ=xe,n.aK=class{constructor(s){this.entries={},this.scheduler=s}request(s,t,a,u){const d=this.entries[s]=this.entries[s]||{callbacks:[]};if(d.result){const[_,v]=d.result;return this.scheduler?this.scheduler.add((()=>{u(_,v)}),t):u(_,v),()=>{}}return d.callbacks.push(u),d.cancel||(d.cancel=a(((_,v)=>{d.result=[_,v];for(const S of d.callbacks)this.scheduler?this.scheduler.add((()=>{S(_,v)}),t):S(_,v);setTimeout((()=>delete this.entries[s]),3e3)}))),()=>{d.result||(d.callbacks=d.callbacks.filter((_=>_!==u)),d.callbacks.length||(d.cancel(),delete this.entries[s]))}}},n.aL=function(s,t,a){const u=JSON.stringify(s.request);return s.data&&(this.deduped.entries[u]={result:[null,s.data]}),this.deduped.request(u,{type:"parseTile",isSymbolTile:s.isSymbolTile,zoom:s.tileZoom},(d=>{const _=yl(s.request,((v,S,E,R)=>{v?d(v):S&&d(null,{vectorTile:a?void 0:new fr(new w1(S)),rawData:S,cacheControl:E,expires:R})}));return()=>{_.cancel(),d()}}),t)},n.aM=function(s){Hc++,Hc>ja&&(s.getActor().send("enforceCacheSizeLimit",xs),Hc=0)},n.aN=function(s){return s<=1?1:Math.pow(2,Math.floor(Math.log2(s)))},n.aO=ta,n.aP=mT,n.aQ=bT,n.aR=W,n.aS=pT,n.aT=function(s,t){const a=document.createElement("video");a.muted=!0,a.onloadstart=function(){t(null,a)};for(let u=0;u<s.length;u++){const d=document.createElement("source");ec(s[u])||(a.crossOrigin="Anonymous"),d.src=s[u],a.appendChild(d)}return{cancel:()=>{}}},n.aU=E0,n.aV=function(s){return fetch(s).then((t=>t.arrayBuffer())).then((t=>q2(t,0,s)))},n.aW=J2,n.aX=class{constructor(s,t,a,u){this.id=s,this.position=t!=null?new W(t[0],t[1]):new W(0,0),this.orientation=a??[0,0,0],this.nodes=u,this.uploaded=!1,this.aabb=new br([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),this.matrix=[]}_applyTransformations(s,t){if(ve(s.matrix,t,s.matrix),s.meshes)for(const a of s.meshes){const u=br.applyTransformFast(a.aabb,s.matrix);this.aabb.encapsulate(u)}if(s.children)for(const a of s.children)this._applyTransformations(a,s.matrix)}computeBoundsAndApplyParent(){const s=ne([]);for(const t of this.nodes)this._applyTransformations(t,s)}computeModelMatrix(s,t,a,u,d,_,v=!1){Q2(this.matrix,this,s.transform,this.position,t,a,u,d,_,v)}upload(s){if(!this.uploaded){for(const t of this.nodes)dx(t,s);for(const t of this.nodes)b1(t);this.uploaded=!0}}destroy(){for(const s of this.nodes)px(s)}},n.aY=yr,n.aZ=B0,n.a_=Te,n.aa=At,n.ab=class{constructor(s){this.specification=s}possiblyEvaluate(s,t){return eo(s.expression.evaluate(t))}interpolate(s,t,a){return{x:xr(s.x,t.x,a),y:xr(s.y,t.y,a),z:xr(s.z,t.z,a),azimuthal:xr(s.azimuthal,t.azimuthal,a),polar:xr(s.polar,t.polar,a)}}},n.ac=Hi,n.ad=fu,n.ae=tt,n.af=Tn,n.ag=ui,n.ah=Qe,n.ai=mu,n.aj=Tu,n.ak=xr,n.al=Bt,n.am=ym,n.an=Ne,n.ao=Ei,n.ap=class{constructor(s){this.specification=s}possiblyEvaluate(s,t){return(function([a,u]){const d=eo([1,a,u]);return{x:d.x,y:d.y,z:d.z}})(s.expression.evaluate(t))}interpolate(s,t,a){return{x:xr(s.x,t.x,a),y:xr(s.y,t.y,a),z:xr(s.z,t.z,a)}}},n.aq=function(s,t,a=0,u=!0){const d=new Tt(a,a),_=s.sub(d),v=t.add(d),S=[_,new Tt(v.x,_.y),v,new Tt(_.x,v.y)];return u&&S.push(_.clone()),S},n.ar=function(s,t){const a=[];for(let u=0;u<s.length;u++){const d=Be(u-1,-1,s.length-1),_=Be(u+1,-1,s.length-1),v=s[u],S=s[_],E=s[d].sub(v).unit(),R=S.sub(v).unit(),P=R.angleWithSep(E.x,E.y),B=E.add(R).unit().mult(-1*t/Math.sin(P/2));a.push(v.add(B))}return a},n.as=eT,n.at=Rn,n.au=function(s,t,a=0){return zi(((t.x-a)*s.scale-s.x)*Bt,(t.y*s.scale-s.y)*Bt,_e(t.z,t.y))},n.av=On,n.aw=Cr,n.ax=li,n.ay=hS,n.az=function(s){let t=1/0,a=1/0,u=-1/0,d=-1/0;for(const _ of s)t=Math.min(t,_.x),a=Math.min(a,_.y),u=Math.max(u,_.x),d=Math.max(d,_.y);return{min:new Tt(t,a),max:new Tt(u,d)}},n.b=function(s){return Vo.API_FONTS_REGEX.test(s)},n.b$=Km,n.b0=Pl,n.b1=Cn,n.b2=_t,n.b3=Ip,n.b4=z1,n.b5=function(){tl.isLoading()||tl.isLoaded()||ld()!=="deferred"||Ac()},n.b6=ch,n.b7=ft,n.b8=A_,n.b9=mi,n.bA=ne,n.bB=xt,n.bC=ie,n.bD=function(s,t){const{x:a,y:u}=s.point,d=Uy(a,u,s.worldSize/s._pixelsPerMercatorPixel,0,0);return ve(d,d,Xg(ll(t)))},n.bE=L,n.bF=zu,n.bG=function(s,t){var a=t[0]-s[0],u=t[1]-s[1],d=t[2]-s[2];return Math.sqrt(a*a+u*u+d*d)},n.bH=Er,n.bI=vi,n.bJ=Vi,n.bK=D0,n.bL=ul,n.bM=Ax,n.bN=function(s,t,a,u,d){const _=5*t+2;s.float32[_+0]=a,s.float32[_+1]=u,s.float32[_+2]=d},n.bO=B1,n.bP=$s,n.bQ=vs,n.bR=Xs,n.bS=ya,n.bT=Be,n.bU=function(s,t,a,u){var d=new D(4);return d[0]=s,d[1]=t,d[2]=a,d[3]=u,d},n.bV=N,n.bW=$a,n.bX=$o,n.bY=Qm,n.bZ=wT,n.b_=v0,n.ba=yx,n.bb=a_,n.bc=wt,n.bd=ss,n.be=Ep,n.bf=Hg,n.bg=hn,n.bh=Vp,n.bi=zx,n.bj=function(s,t){const a=Tu(t.zoom);if(a===0)return ll(s);const u=zp(s),d=dh(u),_=fe(u.getWest())*t.worldSize,v=fe(u.getEast())*t.worldSize,S=xe(u.getNorth())*t.worldSize,E=xe(u.getSouth())*t.worldSize,R=[_,S,0],P=[v,S,0],B=[_,E,0],F=[v,E,0],j=be([],t.globeMatrix);return Tn(R,R,j),Tn(P,P,j),Tn(B,B,j),Tn(F,F,j),d[0]=Bs(d[0],B,a),d[1]=Bs(d[1],F,a),d[2]=Bs(d[2],P,a),d[3]=Bs(d[3],R,a),br.fromPoints(d)},n.bk=qm,n.bl=be,n.bm=zs,n.bn=Bs,n.bo=rl,n.bp=Qn,n.bq=Ct,n.br=we,n.bs=Z1,n.bt=w1,n.bu=yl,n.bv=function(s,t){const a=[];for(const u in s)u in t||a.push(u);return a},n.bw=Je,n.bx=["type","source","source-layer","minzoom","maxzoom","filter","layout"],n.by=Ws,n.bz=function(s){var t=new D(16);return t[0]=s[0],t[1]=s[1],t[2]=s[2],t[3]=s[3],t[4]=s[4],t[5]=s[5],t[6]=s[6],t[7]=s[7],t[8]=s[8],t[9]=s[9],t[10]=s[10],t[11]=s[11],t[12]=s[12],t[13]=s[13],t[14]=s[14],t[15]=s[15],t},n.c=pm,n.c$=function(s){return s*s*s*s*s},n.c0=Tx,n.c1=XS,n.c2=Rx,n.c3=Wx,n.c4=Vt,n.c5=Zo,n.c6=_l,n.c7=function(s,t,a){a*=.5;var u=t[0],d=t[1],_=t[2],v=t[3],S=Math.sin(a),E=Math.cos(a);return s[0]=u*E+d*S,s[1]=d*E-u*S,s[2]=_*E+v*S,s[3]=v*E-_*S,s},n.c8=Fu,n.c9=_n,n.cA=Pr,n.cB=X2,n.cC=Nl,n.cD=Hm,n.cE=function(s,t,a,u,d,_,v,S,E){if(E.name==="globe")return Hm(s,t,new Nl(a,u,d),!1);const R=B0({z:a,x:u,y:d},E);return new br([(_+R.x/R.scale)*t,t*(R.y/R.scale),v],[(_+R.x2/R.scale)*t,t*(R.y2/R.scale),S])},n.cF=function(s,t,a){return s[0]=Math.min(t[0],a[0]),s[1]=Math.min(t[1],a[1]),s[2]=Math.min(t[2],a[2]),s[3]=Math.min(t[3],a[3]),s},n.cG=function(s,t,a){return s[0]=Math.max(t[0],a[0]),s[1]=Math.max(t[1],a[1]),s[2]=Math.max(t[2],a[2]),s[3]=Math.max(t[3],a[3]),s},n.cH=function(s){const t=Math.round((s+45+360)%360/90)%4;return oe[t]},n.cI=Se,n.cJ=na,n.cK=w,n.cL=function(s){const t=ne(new Float64Array(16));ve(t,s.pixelMatrix,s.globeMatrix);const a=[0,z,0],u=[0,k,0];return Tn(a,a,t),Tn(u,u,t),[a[0]>0&&a[0]<=s.width&&a[1]>0&&a[1]<=s.height&&!Wg(s,new W(s.center.lat,90)),u[0]>0&&u[0]<=s.width&&u[1]>0&&u[1]<=s.height&&!Wg(s,new W(s.center.lat,-90))]},n.cM=function(s,t){const{scale:a}=s.tileTransform,u=a*Bt/(s.tileSize*Math.pow(2,t.zoom-s.tileID.overscaledZ+s.tileID.canonical.z));return(function(d,_,v){var S=_[1],E=_[2],R=_[3],P=v[0],B=v[1];return d[0]=_[0]*P,d[1]=S*P,d[2]=E*B,d[3]=R*B,d})(new Float32Array(4),t.inverseAdjustmentMatrix,[u,u])},n.cN=v1,n.cO=hr,n.cP=$2,n.cQ=function(s){const t=$2(s,!0);return L([],[t[0],t[1],t[4],t[5]])},n.cR=Pe,n.cS=di,n.cT=Ze,n.cU=function(s){const{x:t,y:a}=s.point,{lng:u,lat:d}=s._center;return Uy(t,a,s.worldSize,u,d)},n.cV=Fr,n.cW=te,n.cX=Td,n.cY=Ao,n.cZ=x,n.c_=function(s,t,a){let u=0;for(let d=0;d<2;++d)s[d]>0&&(u+=(s[d]-0)*(s[d]-0)),t[d]<0&&(u+=(0-t[d])*(0-t[d]));return u},n.ca=function(s,t){return s[0]=-t[0],s[1]=-t[1],s[2]=-t[2],s[3]=t[3],s},n.cb=Yt,n.cc=function(s,t,a,u,d){var _=1/Math.tan(t/2);if(s[0]=_/a,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=_,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[11]=-1,s[12]=0,s[13]=0,s[15]=0,d!=null&&d!==1/0){var v=1/(u-d);s[10]=(d+u)*v,s[14]=2*d*u*v}else s[10]=-1,s[14]=-2*u;return s},n.cd=function(s,t,a,u,d,_,v){var S=1/(t-a),E=1/(u-d),R=1/(_-v);return s[0]=-2*S,s[1]=0,s[2]=0,s[3]=0,s[4]=0,s[5]=-2*E,s[6]=0,s[7]=0,s[8]=0,s[9]=0,s[10]=2*R,s[11]=0,s[12]=(t+a)*S,s[13]=(d+u)*E,s[14]=(v+_)*R,s[15]=1,s},n.ce=ge,n.cf=function(s,t,a){s[4*t+0]=a[0],s[4*t+1]=a[1],s[4*t+2]=a[2],s[4*t+3]=a[3]},n.cg=Dc,n.ch=bd,n.ci=gi,n.cj=Bl,n.ck=pf,n.cl=oT,n.cm=function(){var s=new D(4);return D!=Float32Array&&(s[1]=0,s[2]=0),s[0]=1,s[3]=1,s},n.cn=function(s,t,a){var u=t[0],d=t[1],_=t[2],v=t[3],S=Math.sin(a),E=Math.cos(a);return s[0]=u*E+_*S,s[1]=d*E+v*S,s[2]=u*-S+_*E,s[3]=d*-S+v*E,s},n.co=function(s,t){return s[0]===t[0]&&s[1]===t[1]&&s[2]===t[2]&&s[3]===t[3]},n.cp=Va,n.cq=function(s){var t=s[0],a=s[1],u=s[2],d=s[3];return Math.sqrt(t*t+a*a+u*u+d*d)},n.cr=vo,n.cs=gl,n.ct=Sd,n.cu=3,n.cv=2,n.cw=7,n.cx=6,n.cy=ho,n.cz=pr,n.d=function(s){return Vo.API_TILEJSON_REGEX.test(s)},n.d$=mS,n.d0=ue,n.d1=45,n.d2=ff,n.d3=function(s,t,a){const u=Math.sqrt(s*s+t*t+a*a),d=u>0?Math.acos(a/u)*Ih:0;let _=s!==0||t!==0?Math.atan2(-t,-s)*Ih+90:0;return _<0&&(_+=360),[u,_,d]},n.d4=zi,n.d5=eo,n.d6=Ge,n.d7=Ot,n.d8=br,n.d9=sr,n.dA=function(s,t,a){const u=Tu(a.zoom),d=s.style.map._antialias,_=s.terrain&&s.terrain.exaggeration()>0;return u===0&&!d&&!_},n.dB=function(s){const t=s.pixelsPerMeter,a=t/ge(1,s.center.lat),u=ne(new Float64Array(16));return we(u,u,[s.point.x,s.point.y,0]),Pe(u,u,[a,a,t]),Float32Array.from(u)},n.dC=zp,n.dD=function(s){const t=Se-5;s=Ie(s,-t,t)/t*90;const a=Math.pow(Math.abs(Math.sin(Ne(s))),3);return Math.round(a*(O.length-1))},n.dE=function(s,t,a,u){const d=t.getNorth(),_=t.getSouth(),v=t.getWest(),S=t.getEast(),E=1<<s.z,R=S-v,P=d-_,B=R/I,F=-P/O[a],j=[0,B,0,F,0,0,d,v,0];if(s.z>0){const G=180/u;Z(j,j,[G/R+1,0,0,0,G/P+1,0,-.5*G/B,.5*G/F,1])}return j[2]=E,j[5]=s.x,j[8]=s.y,j},n.dF=ll,n.dG=function(s,t,a){const u=ne(new Float64Array(16)),d=(t/(1<<s)-.5)*Math.PI*2;return $e(u,a.globeMatrix,d),Float32Array.from(u)},n.dH=class{isDataAvailableAtPoint(s){const t=this._source();if(this.isUsingMockSource()||!t||s.y<0||s.y>1)return!1;const a=t.getSource().maxzoom,u=1<<a,d=Math.floor(s.x),_=Math.floor((s.x-d)*u),v=Math.floor(s.y*u),S=this.findDEMTileFor(new ta(a,d,a,_,v));return!(!S||!S.dem)}getAtPointOrZero(s,t=0){return this.getAtPoint(s,t)||0}getAtPoint(s,t,a=!0){if(this.isUsingMockSource())return null;t==null&&(t=null);const u=this._source();if(!u||s.y<0||s.y>1)return t;const d=u.getSource().maxzoom,_=1<<d,v=Math.floor(s.x),S=s.x-v,E=new ta(d,v,d,Math.floor(S*_),Math.floor(s.y*_)),R=this.findDEMTileFor(E);if(!R||!R.dem)return t;const P=R.dem,B=1<<R.tileID.canonical.z,F=(S*B-R.tileID.canonical.x)*P.dim,j=(s.y*B-R.tileID.canonical.y)*P.dim,G=Math.floor(F),Q=Math.floor(j);return(a?this.exaggeration():1)*xr(xr(P.get(G,Q),P.get(G,Q+1),j-Q),xr(P.get(G+1,Q),P.get(G+1,Q+1),j-Q),F-G)}getAtTileOffset(s,t,a){const u=1<<s.canonical.z;return this.getAtPointOrZero(new tt(s.wrap+(s.canonical.x+t/Bt)/u,(s.canonical.y+a/Bt)/u))}getAtTileOffsetFunc(s,t,a,u){return d=>{const _=this.getAtTileOffset(s,d.x,d.y),v=u.upVector(s.canonical,d.x,d.y);return Vt(v,v,_*u.upVectorScale(s.canonical,t,a).metersToTile),v}}getForTilePoints(s,t,a,u){if(this.isUsingMockSource())return!1;const d=b_.create(this,s,u);return!!d&&(t.forEach((_=>{_[2]=this.exaggeration()*d.getElevationAt(_[0],_[1],a)})),!0)}getMinMaxForTile(s){if(this.isUsingMockSource())return null;const t=this.findDEMTileFor(s);if(!t||!t.dem)return null;const a=t.dem.tree,u=t.tileID,d=1<<s.canonical.z-u.canonical.z;let _=s.canonical.x/d-u.canonical.x,v=s.canonical.y/d-u.canonical.y,S=0;for(let E=0;E<s.canonical.z-u.canonical.z&&!a.leaves[S];E++){_*=2,v*=2;const R=2*Math.floor(v)+Math.floor(_);S=a.childOffsets[S]+R,_%=1,v%=1}return{min:this.exaggeration()*a.minimums[S],max:this.exaggeration()*a.maximums[S]}}getMinElevationBelowMSL(){throw new Error("Pure virtual method called.")}raycast(s,t,a){throw new Error("Pure virtual method called.")}pointCoordinate(s){throw new Error("Pure virtual method called.")}_source(){throw new Error("Pure virtual method called.")}isUsingMockSource(){throw new Error("Pure virtual method called.")}exaggeration(){throw new Error("Pure virtual method called.")}findDEMTileFor(s){throw new Error("Pure virtual method called.")}get visibleDemTiles(){throw new Error("Getter must be implemented in subclass.")}getMinMaxForVisibleTiles(){const s=this.visibleDemTiles;if(s.length===0)return null;let t=!1,a=Number.MAX_VALUE,u=Number.MIN_VALUE;for(const d of s){const _=this.getMinMaxForTile(d.tileID);_&&(a=Math.min(a,_.min),u=Math.max(u,_.max),t=!0)}return t?{min:a,max:u}:null}},n.dI=u0,n.dJ=qg,n.dK=function(s,t){return[Math.pow(s[0],2.2)*t,Math.pow(s[1],2.2)*t,Math.pow(s[2],2.2)*t]},n.dL=U,n.dM=function(s,t){var a=Math.sin(t),u=Math.cos(t);return s[0]=u,s[1]=a,s[2]=0,s[3]=-a,s[4]=u,s[5]=0,s[6]=0,s[7]=0,s[8]=1,s},n.dN=qs,n.dO=i0,n.dP=No,n.dQ=va,n.dR=256,n.dS=function(s,t){const a=[0,0,0];return Tn(a,a,qm(ll(t.canonical))),Tn(a,a,s),a},n.dT=s=>({u_matrix:new pf(s),u_texsize:new Bl(s),u_pixels_to_tile_units:new cs(s),u_device_pixel_ratio:new gi(s),u_width_scale:new gi(s),u_floor_width_scale:new gi(s),u_image:new Dc(s),u_units_to_pixels:new Bl(s),u_tile_units_to_pixels:new gi(s),u_alpha_discard_threshold:new gi(s),u_trim_offset:new Bl(s),u_trim_fade_range:new Bl(s),u_trim_color:new ff(s),u_emissive_strength:new gi(s),u_zbias_factor:new gi(s),u_tile_to_meter:new gi(s),u_ground_shadow_factor:new bd(s),u_pattern_transition:new gi(s)}),n.dU=s=>({u_matrix:new pf(s),u_pixels_to_tile_units:new cs(s),u_device_pixel_ratio:new gi(s),u_width_scale:new gi(s),u_floor_width_scale:new gi(s),u_units_to_pixels:new Bl(s),u_dash_image:new Dc(s),u_gradient_image:new Dc(s),u_image_height:new gi(s),u_texsize:new Bl(s),u_tile_units_to_pixels:new gi(s),u_alpha_discard_threshold:new gi(s),u_trim_offset:new Bl(s),u_trim_fade_range:new Bl(s),u_trim_color:new ff(s),u_emissive_strength:new gi(s),u_zbias_factor:new gi(s),u_tile_to_meter:new gi(s),u_ground_shadow_factor:new bd(s)}),n.dV=s=>({u_camera_to_center_distance:new gi(s),u_extrude_scale:new cs(s),u_device_pixel_ratio:new gi(s),u_matrix:new pf(s),u_inv_rot_matrix:new pf(s),u_merc_center:new Bl(s),u_tile_id:new bd(s),u_zoom_transition:new gi(s),u_up_dir:new bd(s),u_emissive_strength:new gi(s)}),n.dW=Sp,n.dX=UM,n.dY=class{constructor(s,t,a,u){this.context=s,this.format=u,this.size=a,this.texture=s.gl.createTexture();const[d,_,v]=this.size,{gl:S}=s;S.bindTexture(S.TEXTURE_3D,this.texture),s.pixelStoreUnpackFlipY.set(!1),s.pixelStoreUnpack.set(1),s.pixelStoreUnpackPremultiplyAlpha.set(!1),"data"in t&&t.data&&S.texImage3D(S.TEXTURE_3D,0,this.format,d,_,v,0,lx(this.format),cx(this.format),t.data)}bind(s,t){const{context:a}=this,{gl:u}=a;u.bindTexture(u.TEXTURE_3D,this.texture),s!==this.minFilter&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MAG_FILTER,s),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_MIN_FILTER,s),this.minFilter=s),t!==this.wrapS&&(u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_S,t),u.texParameteri(u.TEXTURE_3D,u.TEXTURE_WRAP_T,t),this.wrapS=t)}destroy(){const{gl:s}=this.context;s.deleteTexture(this.texture),this.texture=null}},n.dZ=Gy,n.d_=(s,t,a,u,d,_)=>{const v=s.transform,S=v.projection.name==="globe";let E;if(_.paint.get("circle-pitch-alignment")==="map")if(S){const P=i0(v.zoom,t.canonical)*v._pixelsPerMercatorPixel;E=Float32Array.from([P,0,0,P])}else E=v.calculatePixelsToTileUnitsMatrix(a);else E=new Float32Array([v.pixelsToGLUnits[0],0,0,v.pixelsToGLUnits[1]]);const R={u_camera_to_center_distance:s.transform.getCameraToCenterDistance(v.projection),u_matrix:s.translatePosMatrix(t.projMatrix,a,_.paint.get("circle-translate"),_.paint.get("circle-translate-anchor")),u_device_pixel_ratio:Ys.devicePixelRatio,u_extrude_scale:E,u_inv_rot_matrix:Qv,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0],u_emissive_strength:_.paint.get("circle-emissive-strength")};if(S){R.u_inv_rot_matrix=u,R.u_merc_center=d,R.u_tile_id=[t.canonical.x,t.canonical.y,1<<t.canonical.z],R.u_zoom_transition=Tu(v.zoom);const P=d[0]*Bt,B=d[1]*Bt;R.u_up_dir=v.projection.upVector(new Nl(0,0,0),P,B)}return R},n.da=function(s){return[Math.pow(s[0],1/2.2),Math.pow(s[1],1/2.2),Math.pow(s[2],1/2.2)]},n.db=kx,n.dc=function(s,t){return s.readFields(zD,{icons:[]},t)},n.dd=bt,n.de=y_,n.df=Cx,n.dg=bs,n.dh=zg,n.di=Jl,n.dj=Dh,n.dk=qr,n.dl=function(s){const t=s.indexOf(nf);return t>=0?s.slice(0,t):s},n.dm=function(s){return s.indexOf(nf)>=0},n.dn=function(s){const t=s.lastIndexOf(nf);return t>=0?s.slice(t+1):""},n.dp=function(s){const t=[],a=s.id;return a===void 0&&t.push({message:`layers.${a}: missing required property "id"`}),s.render===void 0&&t.push({message:`layers.${a}: missing required method "render"`}),s.renderingMode&&s.renderingMode!=="2d"&&s.renderingMode!=="3d"&&t.push({message:`layers.${a}: property "renderingMode" must be either "2d" or "3d"`}),t},n.dq=function(s,t,a,u){return s.type==="custom"?new MD(s,t):new LD[s.type](s,t,a,u)},n.dr=Jr,n.ds=function(s){const t=s.indexOf(nf);return t>=0?s.slice(t+1):""},n.dt=class extends A_{constructor(s,t){super(s._vectorTileFeature,s._z,s._x,s._y,s.id),s.state&&(this.state=Object.assign({},s.state)),this.target=t.target,this.namespace=t.namespace,t.properties&&(this.properties=t.properties),this.target&&("featuresetId"in this.target&&!this.target.importId||"layerId"in this.target)&&(this.source=s.source,this.sourceLayer=s.sourceLayer,this.layer=s.layer)}toJSON(){const s=super.toJSON();return s.target=this.target,s.namespace=this.namespace,s}},n.du=mp,n.dv=ai,n.dw=function(s){return s({pluginStatus:jo,pluginURL:Tc}),mp.on("pluginStateChange",s),s},n.dx=df,n.dy=class extends ls{constructor(s){super(s),this.current=Ug}set(s,t,a){if(this.fetchUniformLocation(s,t)){for(let u=0;u<9;u++)if(a[u]!==this.current[u]){this.current=a,this.gl.uniformMatrix3fv(this.location,!1,a);break}}}},n.dz=me,n.e=Vo,n.e$=function(){const s=mt;s&&(s.isPreloaded()&&s.numActive()===1?(s.release(xi),mt=null):console.warn("Could not clear WebWorkers since there are active Map instances that still reference it. The pre-warmed WebWorker pool can only be cleared when all map instances have been removed with map.remove()"))},n.e0=sa,n.e1=(s,t,a,u,d,_,v,S,E,R)=>{const P=s.transform,B=P.pitch<15?fS(.07,.7,Ie((14-P.zoom)/5,0,1)):.07,F=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none";return{u_matrix:pS(s,t,a,u),u_texsize:t.imageAtlasTexture?t.imageAtlasTexture.size:[0,0],u_pixels_to_tile_units:P.calculatePixelsToTileUnitsMatrix(t),u_device_pixel_ratio:d,u_width_scale:_,u_floor_width_scale:v,u_image:0,u_tile_units_to_pixels:dS(t,P),u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_alpha_discard_threshold:0,u_trim_offset:S,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(F?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:B,u_tile_to_meter:Ge(t.tileID.canonical,0),u_ground_shadow_factor:E,u_pattern_transition:R}},n.e2=(s,t,a,u,d,_,v,S,E,R)=>{const P=s.transform,B=P.calculatePixelsToTileUnitsMatrix(t),F=a.paint.get("line-trim-color-use-theme").constantOr("default")==="none",j=P.pitch<15?fS(.07,.7,Ie((14-P.zoom)/5,0,1)):.07;return{u_matrix:pS(s,t,a,u),u_pixels_to_tile_units:B,u_device_pixel_ratio:_,u_width_scale:v,u_floor_width_scale:S,u_units_to_pixels:[1/P.pixelsToGLUnits[0],1/P.pixelsToGLUnits[1]],u_dash_image:0,u_gradient_image:1,u_image_height:d,u_texsize:gS(a)&&t.lineAtlasTexture?t.lineAtlasTexture.size:[0,0],u_tile_units_to_pixels:dS(t,s.transform),u_alpha_discard_threshold:0,u_trim_offset:E,u_trim_fade_range:a.paint.get("line-trim-fade-range"),u_trim_color:a.paint.get("line-trim-color").toPremultipliedRenderColor(F?null:a.lut).toArray01(),u_emissive_strength:a.paint.get("line-emissive-strength"),u_zbias_factor:j,u_tile_to_meter:Ge(t.tileID.canonical,0),u_ground_shadow_factor:R}},n.e3=lr,n.e4=Np,n.e5=_e,n.e6=Gg,n.e7=tg,n.e8=p_,n.e9=mh,n.eA=Un,n.eB=hh,n.eC=function(s,t,a,u,d,_,v,S,E,R,P,B,F,j,G,Q){var J=new D(16);return J[0]=s,J[1]=t,J[2]=a,J[3]=u,J[4]=d,J[5]=_,J[6]=v,J[7]=S,J[8]=E,J[9]=R,J[10]=P,J[11]=B,J[12]=F,J[13]=j,J[14]=G,J[15]=Q,J},n.eD=X,n.eE=uh,n.eF=md,n.eG=class{constructor(){this._updateTime=0,this._sourceIds=[],this._activeRegions=[],this._prevRegions=[],this._globalClipBounds={min:new Tt(1/0,1/0),max:new Tt(-1/0,-1/0)}}clear(){this._activeRegions.length>0&&++this._updateTime,this._activeRegions=[],this._prevRegions=[]}get updateTime(){return this._updateTime}getReplacementRegionsForTile(s,t=!1){const a=s1(new Tt(0,0),new Tt(Bt,Bt),s),u=[];if(t&&!_0(a,this._globalClipBounds))return u;for(const d of this._activeRegions){if(d.hiddenByOverlap||!_0(a,d))continue;const _=l1(d.min,d.max,s);u.push({min:_.min,max:_.max,sourceId:this._sourceIds[d.priority],footprint:d.footprint,footprintTileId:d.tileId,order:d.order,clipMask:d.clipMask,clipScope:d.clipScope})}return u}setSources(s){this._setSources(s.map((t=>({getSourceId:()=>t.cache.id,getFootprints:()=>{const a=[];for(const u of t.cache.getVisibleCoordinates()){const d=t.cache.getTile(u).buckets[t.layer];d&&d.updateFootprints(u.toUnwrapped(),a)}return a},getOrder:()=>t.order,getClipMask:()=>t.clipMask,getClipScope:()=>t.clipScope}))))}_addSource(s){const t=s.getFootprints();if(t.length===0)return;const a=s.getOrder(),u=s.getClipMask(),d=s.getClipScope();for(const _ of t){if(!_.footprint)continue;const v=s1(_.footprint.min,_.footprint.max,_.id);this._activeRegions.push({min:v.min,max:v.max,hiddenByOverlap:!1,priority:this._sourceIds.length,tileId:_.id,footprint:_.footprint,order:a,clipMask:u,clipScope:d})}this._sourceIds.push(s.getSourceId())}_computeReplacement(){this._activeRegions.sort(((t,a)=>t.priority-a.priority||Dd(t.min,a.min)||Dd(t.max,a.max)||t.order-a.order||t.clipMask-a.clipMask||(function(u,d){const _=(v,S)=>v+S;return u.length-d.length||u.reduce(_,"").localeCompare(d.reduce(_,""))})(t.clipScope,a.clipScope)));let s=this._activeRegions.length!==this._prevRegions.length;if(!s){let t=0;for(;!s&&t!==this._activeRegions.length;){const a=this._activeRegions[t],u=this._prevRegions[t];s=a.priority!==u.priority||!c_(a,u)||a.order!==u.order||a.clipMask!==u.clipMask||!Ws(a.clipScope,u.clipScope),++t}}if(s){++this._updateTime;for(const a of this._activeRegions)a.order!==Ym&&(this._globalClipBounds.min.x=Math.min(this._globalClipBounds.min.x,a.min.x),this._globalClipBounds.min.y=Math.min(this._globalClipBounds.min.y,a.min.y),this._globalClipBounds.max.x=Math.max(this._globalClipBounds.max.x,a.max.x),this._globalClipBounds.max.y=Math.max(this._globalClipBounds.max.y,a.max.y));const t=a=>{const u=this._activeRegions;if(a>=u.length)return a;const d=u[a].priority;for(;a<u.length&&u[a].priority===d;)++a;return a};if(this._sourceIds.length>1){let a=0,u=t(a);for(;a!==u;){let d=a;const _=a;for(;d!==u;){const v=this._activeRegions[d];v.hiddenByOverlap=!1;for(let S=0;S<_;S++){const E=this._activeRegions[S];if(!E.hiddenByOverlap&&v.order===Ym&&_0(v,E)&&(v.hiddenByOverlap=y0(v.footprint,v.tileId,E.footprint,E.tileId),v.hiddenByOverlap))break}++d}a=u,u=t(a)}}}}_setSources(s){[this._prevRegions,this._activeRegions]=[this._activeRegions,[]],this._sourceIds=[];for(let t=s.length-1;t>=0;t--)this._addSource(s[t]);this._computeReplacement()}},n.eH=Ym,n.eI=class{constructor(s){this._createGrid(s),this._createPoles(s)}destroy(){this._poleIndexBuffer.destroy(),this._gridBuffer.destroy(),this._gridIndexBuffer.destroy(),this._poleNorthVertexBuffer.destroy(),this._poleSouthVertexBuffer.destroy();for(const s of this._poleSegments)s.destroy();for(const s of this._gridSegments)s.withSkirts.destroy(),s.withoutSkirts.destroy()}_fillGridMeshWithLods(s,t){const a=new ss,u=new Cn,d=[],_=s+1+2,v=t[0]+1,S=t[0]+1+(1+t.length),E=(R,P,B)=>{let F=R===_-1?R-2:R===0?R:R-1;return F+=B?24575:0,[F,P]};for(let R=0;R<_;++R)a.emplaceBack(...E(R,0,!0));for(let R=0;R<v;++R)for(let P=0;P<_;++P)a.emplaceBack(...E(P,R,(P===0||P===_-1)&&!0));for(let R=0;R<t.length;++R){const P=t[R];for(let B=0;B<_;++B)a.emplaceBack(...E(B,P,!0))}for(let R=0;R<t.length;++R){const P=u.length,B=t[R]+1+2,F=new Cn;for(let Q=0;Q<B-1;Q++){const J=Q===B-2,ee=J?_*(S-t.length+R-Q):_;for(let se=0;se<_-1;se++){const le=Q*_+se;Q===0||J||se===0||se===_-2?(F.emplaceBack(le+1,le,le+ee),F.emplaceBack(le+ee,le+ee+1,le+1)):(u.emplaceBack(le+1,le,le+ee),u.emplaceBack(le+ee,le+ee+1,le+1))}}const j=hn.simpleSegment(0,P,a.length,u.length-P);for(let Q=0;Q<F.uint16.length;Q+=3)u.emplaceBack(F.uint16[Q],F.uint16[Q+1],F.uint16[Q+2]);const G=hn.simpleSegment(0,P,a.length,u.length-P);d.push({withoutSkirts:j,withSkirts:G})}return{vertices:a,indices:u,segments:d}}_createGrid(s){const t=this._fillGridMeshWithLods(I,O);this._gridSegments=t.segments,this._gridBuffer=s.createVertexBuffer(t.vertices,Hg.members),this._gridIndexBuffer=s.createIndexBuffer(t.indices,!0)}_createPoles(s){const t=new Cn;for(let v=0;v<=I;v++)t.emplaceBack(0,v+1,v+2);this._poleIndexBuffer=s.createIndexBuffer(t,!0);const a=new xu,u=new xu,d=new xu,_=new xu;this._poleSegments=[];for(let v=0,S=0;v<x;v++){const E=360/(1<<v);a.emplaceBack(0,-p,0,.5,0),u.emplaceBack(0,-p,0,.5,1),d.emplaceBack(0,-p,0,.5,.5),_.emplaceBack(0,-p,0,.5,.5);for(let R=0;R<=I;R++){let P=R/I,B=0;const F=xr(0,E,P),[j,G,Q]=H(o0,a0,F,p);a.emplaceBack(j,G,Q,P,B),u.emplaceBack(j,G,Q,P,1-B);const J=Ne(F);P=.5+.5*Math.sin(J),B=.5+.5*Math.cos(J),d.emplaceBack(j,G,Q,P,B),_.emplaceBack(j,G,Q,P,1-B)}this._poleSegments.push(hn.simpleSegment(S,0,66,64)),S+=66}this._poleNorthVertexBuffer=s.createVertexBuffer(a,Gm,!1),this._poleSouthVertexBuffer=s.createVertexBuffer(u,Gm,!1),this._texturedPoleNorthVertexBuffer=s.createVertexBuffer(d,Gm,!1),this._texturedPoleSouthVertexBuffer=s.createVertexBuffer(_,Gm,!1)}getGridBuffers(s,t){return[this._gridBuffer,this._gridIndexBuffer,t?this._gridSegments[s].withSkirts:this._gridSegments[s].withoutSkirts]}getPoleBuffers(s,t){return[t?this._texturedPoleNorthVertexBuffer:this._poleNorthVertexBuffer,t?this._texturedPoleSouthVertexBuffer:this._poleSouthVertexBuffer,this._poleIndexBuffer,this._poleSegments[s]]}},n.eJ=a1,n.eK=Me,n.eL=function(){return!!document.fullscreenElement||!!document.webkitFullscreenElement},n.eM=Re,n.eN=nt,n.eO=function(s,t,a){return s[0]=t[0]/a[0],s[1]=t[1]/a[1],s[2]=t[2]/a[2],s},n.eP=Mf,n.eQ=V,n.eR=oi,n.eS=Qr,n.eT=function([s,t,a]){const u=Math.hypot(s,t,a),d=Math.atan2(s,a),_=.5*Math.PI-Math.acos(-t/u);return new W(te(d),te(_))},n.eU=Zl,n.eV=hx,n.eW=function(s){const t=s.navigator?s.navigator.userAgent:null;return!!(function(a){if($i==null){const u=a.navigator?a.navigator.userAgent:null;$i=!!a.safari||!(!u||!(/\b(iPad|iPhone|iPod)\b/.test(u)||u.match("Safari")&&!u.match("Chrome")))}return $i})(s)&&!(!t||!(t.match("Version/15.4")||t.match("Version/15.5")||t.match(/CPU (OS|iPhone OS) (15_4|15_5) like Mac OS X/)))},n.eX=function(s,t){xs=s,ja=t},n.eY=Wg,n.eZ=n0,n.e_=function(s){const t=[0,0,0],a=ne(new Float64Array(16));return ve(a,s.pixelMatrix,s.globeMatrix),Tn(t,t,a),new Tt(t[0],t[1])},n.ea=450,n.eb=7,n.ec=ze,n.ed=function(s,t){if(s===t){var a=t[1],u=t[2],d=t[3],_=t[6],v=t[7],S=t[11];s[1]=t[4],s[2]=t[8],s[3]=t[12],s[4]=a,s[6]=t[9],s[7]=t[13],s[8]=u,s[9]=_,s[11]=t[14],s[12]=d,s[13]=v,s[14]=S}else s[0]=t[0],s[1]=t[4],s[2]=t[8],s[3]=t[12],s[4]=t[1],s[5]=t[5],s[6]=t[9],s[7]=t[13],s[8]=t[2],s[9]=t[6],s[10]=t[10],s[11]=t[14],s[12]=t[3],s[13]=t[7],s[14]=t[11],s[15]=t[15];return s},n.ee=RD,n.ef=ei,n.eg=po,n.eh=256,n.ei=Xg,n.ej=fa,n.ek=$e,n.el=function(s,t){return s[0]=t[0],s[1]=t[1],s[2]=t[2],s[3]=t[4],s[4]=t[5],s[5]=t[6],s[6]=t[8],s[7]=t[9],s[8]=t[10],s},n.em=xu,n.en=cf,n.eo=td,n.ep=function(s,t,a,u,d){return Ie((s-t)/(a-t)*(d-u)+u,u,d)},n.eq=ku,n.er=function(s,t){var a=t[0],u=t[1],d=t[2],_=t[3],v=t[4],S=t[5],E=t[6],R=t[7],P=t[8],B=P*v-S*R,F=-P*_+S*E,j=R*_-v*E,G=a*B+u*F+d*j;return G?(s[0]=B*(G=1/G),s[1]=(-P*u+d*R)*G,s[2]=(S*u-d*v)*G,s[3]=F*G,s[4]=(P*a-d*E)*G,s[5]=(-S*a+d*_)*G,s[6]=j*G,s[7]=(-R*a+u*E)*G,s[8]=(v*a-u*_)*G,s):null},n.es=2,n.et=Gi,n.eu=fx,n.ev=[1,1,1],n.ew=b_,n.ex=Df,n.ey=function(s,t,a,u){var d=t[0],_=t[1],v=t[2],S=t[3];return s[0]=d+u*(a[0]-d),s[1]=_+u*(a[1]-_),s[2]=v+u*(a[2]-v),s[3]=S+u*(a[3]-S),s},n.ez=m_,n.f=function(s){return btoa(encodeURIComponent(s).replace(/%([0-9A-F]{2})/g,((t,a)=>String.fromCharCode(+("0x"+a)))))},n.f0=function(){bt().acquire(xi)},n.f1=ld,n.f2=function(s,t,a=!1){if(jo===Aa.deferred||jo===Aa.loading||jo===Aa.loaded)throw new Error("setRTLTextPlugin cannot be called multiple times.");Tc=Ys.resolveURL(s),jo=Aa.deferred,dp=t,pp(),a||Ac()},n.f3=function(s){si=Ys.resolveURL(s),on||(on=new wn(bt(),new Hu)),on.broadcast("setMeshoptUrl",si)},n.f4=N2,n.f5=function(s){Zi=Ys.resolveURL(s),on||(on=new wn(bt(),new Hu)),on.broadcast("setDracoUrl",Zi)},n.f6=k2,n.f7=kt,n.f8=function(s){const t=zf();if(!t)return;const a=t.delete(Ua);s&&a.then((()=>s())).catch(s)},n.f9=ni,n.fA=function(s){Ff(),Qo?.then((t=>{t.keys().then((a=>{for(let u=0;u<a.length-s;u++)t.delete(a[u]).catch((d=>ri(d.message)))})).catch((a=>ri(a.message)))})).catch((t=>ri(t.message)))},n.fa=$t,n.fb=_f,n.fc=_h,n.fd=uA,n.fe=hA,n.ff=lS,n.fg=Or,n.fh="hd_road_elevation",n.fi=Xi,n.fj=gr,n.fk=Fs,n.fl=Ex,n.fm=lg,n.fn=function(s,t,a,u,d,_,v,S=1,E,R,P){s.createArrays(),s.tilePixelRatio=Bt/(512*s.overscaling),s.compareText={},s.iconsNeedLinear=!1;const B=s.layers[0].layout,F=s.layers[0]._unevaluatedLayout._values,j={};j.scaleFactor=S,j.textSizeScaleRange=B.get("text-size-scale-range"),j.iconSizeScaleRange=B.get("icon-size-scale-range");const[G,Q]=j.textSizeScaleRange,[J,ee]=j.iconSizeScaleRange;j.textScaleFactor=Ie(j.scaleFactor,G,Q),j.iconScaleFactor=Ie(j.scaleFactor,J,ee);const se=F["text-size"],le=F["icon-size"];if(s.textSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:ut}=s.textSizeData;j.compositeTextSizes=[se.possiblyEvaluate(new Hi(Fe,{worldview:P}),_),se.possiblyEvaluate(new Hi(ut,{worldview:P}),_)]}if(s.iconSizeData.kind==="composite"){const{minZoom:Fe,maxZoom:ut}=s.iconSizeData;j.compositeIconSizes=[le.possiblyEvaluate(new Hi(Fe,{worldview:P}),_),le.possiblyEvaluate(new Hi(ut,{worldview:P}),_)]}j.layoutTextSize=se.possiblyEvaluate(new Hi(v+1,{worldview:P}),_),j.layoutIconSize=le.possiblyEvaluate(new Hi(v+1,{worldview:P}),_),j.textMaxSize=se.possiblyEvaluate(new Hi(18,{worldview:P}),_);const he=B.get("symbol-placement"),Ee=B.get("text-rotation-alignment")==="map"&&he!=="point",Ce=B.get("text-size");let De=!1;const Le=[];for(const Fe of s.features){const ut=B.get("text-font").evaluate(Fe,{},_).join(","),Ue=Ce.evaluate(Fe,{},_)*j.textScaleFactor,dt=j.layoutTextSize.evaluate(Fe,{},_)*j.textScaleFactor,St=j.layoutIconSize.evaluate(Fe,{},_)*j.iconScaleFactor,gt={horizontal:{},vertical:void 0},yt=Fe.text;let Rt,lt=[0,0];if(yt){const ar=yt.toString(),Sr=B.get("text-letter-spacing").evaluate(Fe,{},_)*$o,Br=B.get("text-line-height").evaluate(Fe,{},_)*$o,$r=Dl(ar)?Sr:0,Vr=B.get("text-anchor").evaluate(Fe,{},_),er=B.get("text-variable-anchor");if(!er){const Ke=B.get("text-radial-offset").evaluate(Fe,{},_);if(Ke)lt=XS(Vr,[Ke*$o,Ix]);else{const ct=B.get("text-offset").evaluate(Fe,{},_);lt=[ct[0]*$o,ct[1]*$o]}}let zr=Ee?"center":B.get("text-justify").evaluate(Fe,{},_);const ci=he==="point",de=ci?B.get("text-max-width").evaluate(Fe,{},_)*$o:1/0,pe=Ke=>{s.allowVerticalPlacement&&sd(ar)&&(gt.vertical=Sx(yt,t,a,d,ut,de,Br,Vr,Ke,$r,lt,ul.vertical,!0,dt,Ue,E))};if(!Ee&&er){const Ke=zr==="auto"?er.map((Gt=>Rx(Gt))):[zr];let ct=!1;for(let Gt=0;Gt<Ke.length;Gt++){const jt=Ke[Gt];if(!gt.horizontal[jt])if(ct)gt.horizontal[jt]=gt.horizontal[0];else{const Kt=Sx(yt,t,a,d,ut,de,Br,"center",jt,$r,lt,ul.horizontal,!1,dt,Ue,E);Kt&&(gt.horizontal[jt]=Kt,ct=Kt.positionedLines.length===1)}}pe("left")}else{if(zr==="auto"&&(zr=Rx(Vr)),ci||B.get("text-writing-mode").indexOf("horizontal")>=0||!sd(ar)){const Ke=Sx(yt,t,a,d,ut,de,Br,Vr,zr,$r,lt,ul.horizontal,!1,dt,Ue,E);Ke&&(gt.horizontal[zr]=Ke)}pe(ci?"left":zr)}}let vt,et,We,Dt,Et,dr,Zt=!1;const nr=B.get("icon-text-fit").evaluate(Fe,{},_);if(Fe.icon&&Fe.icon.hasPrimary()){const ar=WS(Fe.icon,s.iconSizeData,F["icon-size"],_,s.zoom,Fe,E,j.iconScaleFactor,P);vt=ar.iconPrimary,We=ar.iconSecondary;const Sr=vt.toString();if(et=u.get(Sr),et&&(Et=B.get("icon-offset").evaluate(Fe,{},_),dr=B.get("icon-anchor").evaluate(Fe,{},_),Rt=oD(d.get(Sr),We?d.get(We.toString()):void 0,Et,dr),Zt=et.sdf,s.sdfIcons===void 0?s.sdfIcons=et.sdf:s.sdfIcons!==et.sdf&&ri("Style sheet warning: Cannot mix SDF and non-SDF icons in one buffer"),(et.pixelRatio!==s.pixelRatio||B.get("icon-rotate").constantOr(1)!==0)&&(s.iconsNeedLinear=!0)),We){const Br=We.toString();Dt=u.get(Br)}}De=De||!(!Fe.icon||!Fe.icon.hasSecondary());const Nt=Mx(gt.horizontal)||gt.vertical;s.iconsInText||(s.iconsInText=!!Nt&&Nt.iconsInText);const ur=dt*j.textScaleFactor/$o,{defaultShapedIcon:Dr,verticallyShapedIcon:Ht}=mD(s,Rt,B,Fe,_,gt,ur,Et,nr);nr!=="none"&&Rt&&(DS(Rt)||OS(Rt))&&(C1(0,et,vt,Rt,Dr,nr,R,u,d),C1(0,Dt,We,Rt,Dr,nr,R,u,d),Ht&&(C1(0,et,vt,Rt,Ht,nr,R,u,d),C1(0,Dt,We,Rt,Ht,nr,R,u,d))),Rt=Dr,Le.push({feature:Fe,shapedTextOrientations:gt,shapedText:Nt,shapedIcon:Rt,iconPrimary:vt,iconSecondary:We,iconOffset:Et,iconAnchor:dr,verticallyShapedIcon:Ht,layoutTextSize:dt,layoutIconSize:St,textOffset:lt,isSDFIcon:Zt,iconTextFit:nr})}return{featureData:Le,sizes:j,hasAnySecondaryIcon:De,textAlongLine:Ee,symbolPlacement:he}},n.fo=US,n.fp=function(s,t,a,u,d,_,v,S,E,R){const{featureData:P,hasAnySecondaryIcon:B,sizes:F,textAlongLine:j,symbolPlacement:G}=t;for(const Q of P){const{shapedIcon:J,verticallyShapedIcon:ee,feature:se,shapedTextOrientations:le,shapedText:he,layoutTextSize:Ee,textOffset:Ce,isSDFIcon:De,iconPrimary:Le,iconSecondary:Fe,iconTextFit:ut,iconOffset:Ue}=Q;YS(J,R.iconPositions,Le,Fe),YS(ee,R.iconPositions,Le,Fe),pD(le,R.iconPositions),dD(Le,Fe,R.iconPositions),(he||J)&&gD(s,se,le,J,ee,E,F,Ee,0,Ce,De,u,d,v,S,B,ut,Ue,j,G)}a&&s.generateCollisionDebugBuffers(_,s.collisionBoxArray,F.textScaleFactor)},n.fq=fr,n.fr=X1,n.fs=pt,n.ft=function(s){let t=0;if(new Uint32Array(s,0,1)[0]!==U2){const a=new Uint32Array(s,0,7),[,,u,d,_,v]=a;t=a.byteLength+d+_+v+_,(u!==s.byteLength||t>=s.byteLength)&&ri("Invalid b3dm header information.")}return q2(s,t)},n.fu=function(s,t){const a=J2(s);for(const u of a){for(const d of u.meshes)fM(d);u.lights&&(u.lightMeshIndex=u.meshes.length,u.meshes.push(dM(u.lights,t)))}return a},n.fv=U1,n.fw=Li,n.fx=zt,n.fy=tl,n.fz=Aa,n.g=function(s,t){return ai(Object.assign(s,{method:"GET"}),t)},n.h=function(s){return s.indexOf("mapbox:")===0},n.i=function(s){return Vo.API_STYLE_REGEX.test(s)&&!pm(s)},n.j=Yo,n.k=qc,n.l=function(s){return decodeURIComponent(atob(s).split("").map((t=>"%"+("00"+t.charCodeAt(0).toString(16)).slice(-2))).join(""))},n.m=function(s,t){return ai(Object.assign(s,{type:"json"}),t)},n.n=rc,n.o=Ys,n.p=function(s,t){return ai(Object.assign(s,{method:"POST"}),t)},n.q=Ho,n.r=Lf,n.s=function(s){try{const t=self[s];return t.setItem("_mapbox_test_",1),t.removeItem("_mapbox_test_"),!0}catch{return!1}},n.t=function(){return st||(st=new ni),st},n.u=function(){return(function s(t){return t?(t^Math.random()*(16>>t/4)).toString(16):([1e7]+-[1e3]+-4e3+-8e3+-1e11).replace(/[018]/g,s)})()},n.v=function(s){return!!s&&/^[0-9a-f]{8}-[0-9a-f]{4}-[4][0-9a-f]{3}-[89ab][0-9a-f]{3}-[0-9a-f]{12}$/i.test(s)},n.w=ri,n.x=qx,n.y=ic,n.z=ts})),m(["./shared"],(function(n){function C(Ne){const te=Ne?Ne.url.toString():void 0;return te?performance.getEntriesByName(te):[]}function D(Ne){if(typeof Ne=="number"||typeof Ne=="boolean"||typeof Ne=="string"||Ne==null)return JSON.stringify(Ne);if(Array.isArray(Ne)){let oe="[";for(const me of Ne)oe+=`${D(me)},`;return`${oe}]`}let te="{";for(const oe of Object.keys(Ne).sort())te+=`${oe}:${D(Ne[oe])},`;return`${te}}`}function L(Ne){let te="";for(const oe of n.bx)te+=`/${D(Ne[oe])}`;return te}class U{constructor(te){this.keyCache={},this._layers={},this._layerConfigs={},te&&this.replace(te)}replace(te,oe){this._layerConfigs={},this._layers={},this.update(te,[],oe)}update(te,oe,me){this._options=me;for(const Re of te)this._layerConfigs[Re.id]=Re,(this._layers[Re.id]=n.dq(Re,this.scope,null,this._options)).compileFilter(me),this.keyCache[Re.id]&&delete this.keyCache[Re.id];for(const Re of oe)delete this.keyCache[Re],delete this._layerConfigs[Re],delete this._layers[Re];this.familiesBySource={};const Me=(function(Re,Ie){const Qe={};for(let Je=0;Je<Re.length;Je++){const Pt=Re[Je];let _t=Ie&&Ie[Pt.id];_t||(Pt.type==="symbol"?_t=Pt.id:(_t=L(Pt),Pt.type==="line"&&Pt.paint&&(function yr(gr){return typeof gr=="string"&&gr==="line-progress"||(Array.isArray(gr)?gr.some(yr):!(!gr||typeof gr!="object")&&Object.values(gr).some(yr))})(Pt.paint["line-width"])&&(_t+=`/${D(Pt.paint["line-width"])}`))),Ie&&(Ie[Pt.id]=_t);let lr=Qe[_t];lr||(lr=Qe[_t]=[]),lr.push(Pt)}const Be=[];for(const Je in Qe)Be.push(Qe[Je]);return Be})(Object.values(this._layerConfigs),this.keyCache);for(const Re of Me){const Ie=Re.map((lr=>this._layers[lr.id])),Qe=Ie[0];if(Qe.visibility==="none")continue;const Be=Qe.source||"";let Je=this.familiesBySource[Be];Je||(Je=this.familiesBySource[Be]={});const Pt=Qe.sourceLayer||"_geojsonTileLayer";let _t=Je[Pt];_t||(_t=Je[Pt]=[]),_t.push(Ie)}}}const q=1*n.fc;class Z{constructor(te){const oe={},me=[];for(const Qe in te){const Be=te[Qe],Je=oe[Qe]={};for(const Pt in Be.glyphs){const _t=Be.glyphs[+Pt];if(!_t||_t.bitmap.width===0||_t.bitmap.height===0)continue;const lr=_t.metrics.localGlyph?q:1,yr={x:0,y:0,w:_t.bitmap.width+2*lr,h:_t.bitmap.height+2*lr};me.push(yr),Je[Pt]=yr}}const{w:Me,h:Re}=n.G(me),Ie=new n.fb({width:Me||1,height:Re||1});for(const Qe in te){const Be=te[Qe];for(const Je in Be.glyphs){const Pt=Be.glyphs[+Je];if(!Pt||Pt.bitmap.width===0||Pt.bitmap.height===0)continue;const _t=oe[Qe][Je],lr=Pt.metrics.localGlyph?q:1;n.fb.copy(Pt.bitmap,Ie,{x:0,y:0},{x:_t.x+lr,y:_t.y+lr},Pt.bitmap)}}this.image=Ie,this.positions=oe}}n.fa(Z,"GlyphAtlas");class ie{constructor(te){this.tileID=new n.aO(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.lut=te.lut,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.scope=te.scope,this.overscaling=this.tileID.overscaleFactor(),this.showCollisionBoxes=te.showCollisionBoxes,this.collectResourceTiming=!!te.request&&te.request.collectResourceTiming,this.promoteId=te.promoteId,this.isSymbolTile=te.isSymbolTile,this.tileTransform=n.aZ(te.tileID.canonical,te.projection),this.projection=te.projection,this.worldview=te.worldview,this.localizableLayerIds=te.localizableLayerIds,this.brightness=te.brightness,this.extraShadowCaster=!!te.extraShadowCaster,this.tessellationStep=te.tessellationStep,this.scaleFactor=te.scaleFactor,this.worldview=te.worldview}parse(te,oe,me,Me,Re,Ie){this.status="parsing",this.data=te,this.collisionBoxArray=new n.b3;const Qe=new n.fd(Object.keys(te.layers).sort()),Be=new n.fe(this.tileID,this.promoteId);Be.bucketLayerIDs=[];const Je={},Pt=new n.ff(256,256),_t={featureIndex:Be,iconDependencies:new Map,patternDependencies:new Map,glyphDependencies:{},lineAtlas:Pt,availableImages:me,brightness:this.brightness,scaleFactor:this.scaleFactor,elevationFeatures:void 0},lr=[],yr=oe.familiesBySource[this.source];for(const Jr in yr){const qr=te.layers[Jr];if(!qr)continue;let Yr=!1,Ri=!1,ri=!1;for(const Li of yr[Jr])Li[0].type==="symbol"?Yr=!0:Ri=!0,Li[0].is3D()&&Li[0].type!=="model"&&(ri=!0);if(this.extraShadowCaster&&!ri||this.isSymbolTile===!0&&!Yr||this.isSymbolTile===!1&&!Ri)continue;qr.version===1&&n.w(`Vector tile source "${this.source}" layer "${Jr}" does not use vector tile spec v2 and therefore may have some rendering errors.`);const An=Qe.encode(Jr),Xn=[];let eo=!1;for(let Li=0,mi=0;Li<qr.length;Li++){const $i=qr.feature(Li),_n=Be.getId($i,Jr);if(this.localizableLayerIds&&this.localizableLayerIds.has(Jr)){const Wi=$i.properties?$i.properties.worldview:null;if(this.worldview&&typeof Wi=="string")if(Wi==="all")$i.properties.$localized=!0;else{if(!Wi.split(",").includes(this.worldview))continue;$i.properties.$localized=!0,$i.properties.worldview=this.worldview}}!eo&&$i.properties&&$i.properties.hasOwnProperty(n.fg)&&(eo=!0),Xn.push({feature:$i,id:_n,index:mi,sourceLayerIndex:An}),mi++}eo&&!_t.elevationFeatures&&te.layers.hasOwnProperty(n.fh)&&(_t.elevationFeatures=n.fi.parseFrom(te.layers[n.fh],this.canonical));for(const Li of yr[Jr]){const mi=Li[0];if(this.extraShadowCaster&&(!mi.is3D()||mi.type==="model")||this.isSymbolTile!==void 0&&mi.type==="symbol"!==this.isSymbolTile||mi.minzoom&&this.zoom<Math.floor(mi.minzoom)||mi.maxzoom&&this.zoom>=mi.maxzoom||mi.visibility==="none")continue;ne(Li,this.zoom,_t.brightness,me,this.worldview);const $i=Je[mi.id]=mi.createBucket({index:Be.bucketLayerIDs.length,layers:Li,zoom:this.zoom,lut:this.lut,canonical:this.canonical,pixelRatio:this.pixelRatio,overscaling:this.overscaling,collisionBoxArray:this.collisionBoxArray,sourceLayerIndex:An,sourceID:this.source,projection:this.projection.spec,tessellationStep:this.tessellationStep,styleDefinedModelURLs:Me,worldview:this.worldview});Be.bucketLayerIDs.push(Li.map((Wi=>n.B(Wi.id,Wi.scope))));let _n=$i.prepare?$i.prepare():null;_n!=null?(_n=_n.then((()=>$i.populate(Xn,_t,this.tileID.canonical,this.tileTransform))),lr.push(_n)):$i.populate(Xn,_t,this.tileID.canonical,this.tileTransform)}}const gr=()=>{let Jr,qr,Yr,Ri,ri,An;Pt.trim();const Xn={type:"maybePrepare",isSymbolTile:this.isSymbolTile,zoom:this.zoom},eo=()=>{if(Jr)return this.status="done",Ie(Jr);if(this.extraShadowCaster)this.status="done",Ie(null,{buckets:Object.values(Je).filter((mi=>!mi.isEmpty())),featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:_t.brightness,glyphMap:null,iconMap:null,glyphPositions:null});else if(qr&&Yr&&Ri){const mi=new Z(qr),$i=new Map;for(const[to,No]of Yr.entries()){const{imagePosition:va}=n.fl(to,No,n.fm);$i.set(to,va)}const _n={};for(const to in Je){const No=Je[to];No instanceof n.b4&&(ne(No.layers,this.zoom,_t.brightness,me,this.worldview),_n[to]=n.fn(No,qr,mi.positions,Yr,$i,this.tileID.canonical,this.tileZoom,this.scaleFactor,this.pixelRatio,ri,this.worldview))}const Wi={iconsPending:!0,patternsPending:!0};this.rasterizeIfNeeded(Re,Yr,ri,(()=>{Wi.iconsPending=!1,Li(_n,mi,Wi)})),this.rasterizeIfNeeded(Re,Ri,An,(()=>{Wi.patternsPending=!1,Li(_n,mi,Wi)}))}},Li=(mi,$i,_n,Wi)=>{if(_n.iconsPending||_n.patternsPending)return;const to=new n.fo(Yr,Ri,this.lut);for(const No in Je){const va=Je[No];if(No in mi)n.fp(va,mi[No],this.showCollisionBoxes,me,this.tileID.canonical,this.tileZoom,this.projection,this.brightness,Yr,to);else if(va.hasPattern&&(va instanceof n.ba||va instanceof n.bb||va instanceof n.e7)){ne(va.layers,this.zoom,_t.brightness,me,this.worldview);const Ql=Object.fromEntries(to.patternPositions);va.addFeatures(_t,this.tileID.canonical,Ql,me,this.tileTransform,this.brightness)}}this.status="done",Ie(null,{buckets:Object.values(Je).filter((No=>!No.isEmpty())),featureIndex:Be,collisionBoxArray:this.collisionBoxArray,glyphAtlasImage:$i.image,lineAtlas:Pt,imageAtlas:to,brightness:_t.brightness})};if(!this.extraShadowCaster){const mi=n.fj(_t.glyphDependencies,(Wi=>Object.keys(Wi).map(Number)));Object.keys(mi).length?Re.send("getGlyphs",{uid:this.uid,stacks:mi},((Wi,to)=>{Jr||(Jr=Wi,qr=to,eo())}),void 0,!1,Xn):qr={};const $i=Array.from(_t.iconDependencies.keys()).map((Wi=>n.I.parse(Wi)));$i.length?Re.send("getImages",{images:$i,source:this.source,scope:this.scope,tileID:this.tileID,type:"icons"},((Wi,to)=>{Jr||(Jr=Wi,Yr=new Map,ri=this.updateImageMapAndGetImageTaskQueue(Yr,to,_t.iconDependencies),eo())}),void 0,!1,Xn):(Yr=new Map,ri=new Map);const _n=Array.from(_t.patternDependencies.keys()).map((Wi=>n.I.parse(Wi)));_n.length?Re.send("getImages",{images:_n,source:this.source,scope:this.scope,tileID:this.tileID,type:"patterns"},((Wi,to)=>{Jr||(Jr=Wi,Ri=new Map,An=this.updateImageMapAndGetImageTaskQueue(Ri,to,_t.patternDependencies),eo())}),void 0,!1,Xn):(Ri=new Map,An=new Map)}if(_t.elevationFeatures&&_t.elevationFeatures.length>0){const mi=[];for(const _n of Object.values(Je))if(_n instanceof n.bb){const Wi=_n.getUnevaluatedPortalGraph();Wi&&mi.push(Wi)}const $i=n.fk.evaluate(mi);for(const _n of Object.values(Je))if(_n instanceof n.bb){const Wi=te.layers[Qe.decode(_n.sourceLayerIndex)];_n.setEvaluatedPortalGraph($i,Wi,this.tileID.canonical,_t.availableImages,_t.brightness)}}eo()};lr.length>0?Promise.allSettled(lr).then(gr).catch(Ie):gr()}rasterizeIfNeeded(te,oe,me,Me){Array.from(oe.values()).some((Re=>Re.usvg))?this.rasterize(te,oe,me,Me):Me()}updateImageMapAndGetImageTaskQueue(te,oe,me){const Me=new Map;for(const Re of oe.keys()){const Ie=me.get(Re)||[];for(const Qe of Ie){const Be=Qe.toString(),Je=oe.get(Qe.id.toString());Je.usvg?Me.has(Be)||(Me.set(Be,Qe),te.set(Be,Object.assign({},Je))):te.set(Be,Je)}}return Me}rasterize(te,oe,me,Me){this.rasterizeTask=te.send("rasterizeImages",{scope:this.scope,tasks:me},((Re,Ie)=>{if(!Re)for(const[Qe,Be]of Ie.entries()){const Je=Object.assign(oe.get(Qe),{data:Be});oe.set(Qe,Je)}Me()}))}cancelRasterize(){this.rasterizeTask&&this.rasterizeTask.cancel()}}function ne(Ne,te,oe,me,Me){const Re=new n.ac(te,{brightness:oe,worldview:Me});for(const Ie of Ne)Ie.recalculate(Re,me)}class be extends n.E{constructor(te,oe,me,Me,Re,Ie,Qe){super(),this.actor=te,this.layerIndex=oe,this.availableImages=me,this.availableModels=Me,this.loadVectorData=Ie||n.aL,this.loading={},this.loaded={},this.deduped=new n.aK(te.scheduler),this.isSpriteLoaded=Re,this.scheduler=te.scheduler,this.brightness=Qe}loadTile(te,oe){const me=te.uid,Me=te&&te.request,Re=Me&&Me.collectResourceTiming,Ie=this.loading[me]=new ie(te);Ie.abort=this.loadVectorData(te,((Qe,Be)=>{const Je=!this.loading[me];if(delete this.loading[me],Ie.cancelRasterize(),Je||Qe||!Be)return Ie.status="done",Je||(this.loaded[me]=Ie),oe(Qe);const Pt=Be.rawData,_t={};Be.expires&&(_t.expires=Be.expires),Be.cacheControl&&(_t.cacheControl=Be.cacheControl),Ie.vectorTile=Be.vectorTile||new n.fq(new n.bt(Pt));const lr=()=>{Ie.parse(Ie.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,((yr,gr)=>{if(yr||!gr)return oe(yr);const Jr={};if(Re){const qr=C(Me);qr.length>0&&(Jr.resourceTiming=JSON.parse(JSON.stringify(qr)))}oe(null,Object.assign({rawTileData:Pt.slice(0)},gr,_t,Jr))}))};this.isSpriteLoaded?lr():this.once("isSpriteLoaded",(()=>{this.scheduler?this.scheduler.add(lr,{type:"parseTile",isSymbolTile:te.isSymbolTile,zoom:te.tileZoom}):lr()})),this.loaded=this.loaded||{},this.loaded[me]=Ie}))}reloadTile(te,oe){const me=this.loaded,Me=te.uid;if(me&&me[Me]){const Re=me[Me];Re.scaleFactor=te.scaleFactor,Re.showCollisionBoxes=te.showCollisionBoxes,Re.projection=te.projection,Re.brightness=te.brightness,Re.tileTransform=n.aZ(te.tileID.canonical,te.projection),Re.extraShadowCaster=te.extraShadowCaster,Re.lut=te.lut,Re.worldview=te.worldview;const Ie=(Qe,Be)=>{const Je=Re.reloadCallback;Je&&(delete Re.reloadCallback,Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Je)),oe(Qe,Be)};Re.status==="parsing"?Re.reloadCallback=Ie:Re.status==="done"&&(Re.vectorTile?Re.parse(Re.vectorTile,this.layerIndex,this.availableImages,this.availableModels,this.actor,Ie):Ie())}else oe(null,void 0)}abortTile(te,oe){const me=te.uid,Me=this.loading[me];Me&&(Me.abort&&Me.abort(),delete this.loading[me]),oe()}removeTile(te,oe){const me=this.loaded,Me=te.uid;me&&me[Me]&&delete me[Me],oe()}}class ve{loadTile(te,oe){const{uid:me,encoding:Me,rawImageData:Re,padding:Ie}=te,Qe=ImageBitmap&&Re instanceof ImageBitmap?this.getImageData(Re,Ie):Re;oe(null,new n.fr(me,Qe,Me,Ie<1))}reloadTile(te,oe){oe(null,null)}abortTile(te,oe){oe()}removeTile(te,oe){oe()}getImageData(te,oe){this.offscreenCanvas&&this.offscreenCanvasContext||(this.offscreenCanvas=new OffscreenCanvas(te.width,te.height),this.offscreenCanvasContext=this.offscreenCanvas.getContext("2d",{willReadFrequently:!0})),this.offscreenCanvas.width=te.width,this.offscreenCanvas.height=te.height,this.offscreenCanvasContext.drawImage(te,0,0,te.width,te.height);const me=this.offscreenCanvasContext.getImageData(-oe,-oe,te.width+2*oe,te.height+2*oe);return this.offscreenCanvasContext.clearRect(0,0,this.offscreenCanvas.width,this.offscreenCanvas.height),me}}n.bs.setPbf(n.bt);class we{constructor(te){this._mrt=new n.bs(te.partial?30:1/0),this._isHeaderLoaded=!1,this.uid=te.uid,this.tileID=te.tileID,this.source=te.source}parse(te,oe){const me=this._mrt;this.status="parsing",this._entireBuffer=te;try{me.parseHeader(te),this._isHeaderLoaded=!0;const Me=[];for(const Re in me.layers){const Ie=me.getLayer(Re),Qe=Ie.getDataRange(Ie.getBandList()),Be=me.createDecodingTask(Qe),Je=te.slice(Qe.firstByte,Qe.lastByte+1),Pt=n.bs.performDecoding(Je,Be).then((_t=>Be.complete(null,_t))).catch((_t=>Be.complete(_t,null)));Me.push(Pt)}Promise.allSettled(Me).then((()=>oe(null,me))).catch((Re=>oe(Re)))}catch(Me){oe(Me)}}}class Pe{constructor(te){this.actor=te,this.loading={},this.loaded={}}loadTile(te,oe){const me=te.uid,Me=te.request,Re=this.loading[me]=new we(te),{cancel:Ie}=n.bu(Me,((Qe,Be,Je,Pt)=>{const _t=!this.loading[me];if(delete this.loading[me],_t||Qe||!Be)return Re.status="done",_t||(this.loaded[me]=Re),oe(Qe);Re.parse(Be,((lr,yr)=>{if(lr||!yr)return oe(lr);oe(null,yr,Je,Pt)})),this.loaded[me]=Re}));Re.abort=Ie}reloadTile(te,oe){oe(null,void 0)}abortTile(te,oe){const me=te.uid,Me=this.loading[me];Me&&(Me.abort&&Me.abort(),delete this.loading[me]),oe()}removeTile(te,oe){const me=te.uid;this.loaded[me]&&delete this.loaded[me],oe()}decodeRasterArray(te,oe){n.bs.performDecoding(te.buffer,te.task).then((me=>oe(null,me))).catch((me=>oe(me)))}}const Ze=n.fs.prototype.toGeoJSON;class $e{constructor(te){this._feature=te,this.extent=n.al,this.type=te.type,this.properties=te.tags,"id"in te&&!isNaN(te.id)&&(this.id=parseInt(te.id,10))}loadGeometry(){if(this._feature.type===1){const te=[];for(const oe of this._feature.geometry)te.push([new n.P(oe[0],oe[1])]);return te}{const te=[];for(const oe of this._feature.geometry){const me=[];for(const Me of oe)me.push(new n.P(Me[0],Me[1]));te.push(me)}return te}}toGeoJSON(te,oe,me){return Ze.call(this,te,oe,me)}}class xt{constructor(te,oe){this.name=te,this.extent=n.al,this.length=oe.length,this._jsonFeatures=oe}feature(te){return new $e(this._jsonFeatures[te])}}class Ct{constructor(te){this.layers={},this.extent=n.al;for(const oe of Object.keys(te))this.layers[oe]=new xt(oe,te[oe])}}const Ft=64/4096,Yt=128;class hr{constructor(){this.features=new Map}clear(){this.features.clear()}load(te=[],oe){for(const me of te){const Me=me.id;if(Me==null)continue;let Re=this.features.get(Me);Re&&this.updateCache(Re,oe),me.geometry?(Re=Kr(me),this.updateCache(Re,oe),this.features.set(Me,Re)):this.features.delete(Me),this.updateCache(Re,oe)}}updateCache(te,oe){for(const{canonical:me,uid:Me}of Object.values(oe)){const{z:Re,x:Ie,y:Qe}=me;pr(te,Math.pow(2,Re),Ie,Qe)&&delete oe[Me]}}getTile(te,oe,me){const Me=Math.pow(2,te),Re=[];for(const Ie of this.features.values())pr(Ie,Me,oe,me)&&Re.push(Ot(Ie,Me,oe,me));return{features:Re}}getFeatures(){return[...this.features.values()]}}function pr({minX:Ne,minY:te,maxX:oe,maxY:me},Me,Re,Ie){return Ne<(Re+1+Ft)/Me&&te<(Ie+1+Ft)/Me&&oe>(Re-Ft)/Me&&me>(Ie-Ft)/Me}function Kr(Ne){const{id:te,geometry:oe,properties:me}=Ne;if(!oe)return;if(oe.type==="GeometryCollection")throw new Error("GeometryCollection not supported in dynamic mode.");const{type:Me,coordinates:Re}=oe,Ie={id:te,type:1,geometry:[],tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0},Qe=Ie.geometry;if(Me==="Point")ui(Re,Qe,Ie);else if(Me==="MultiPoint")for(const Be of Re)ui(Be,Qe,Ie);else if(Me==="LineString")Ie.type=2,zi(Re,Qe,Ie);else if(Me==="MultiLineString")Ie.type=2,Qr(Re,Qe,Ie);else if(Me==="Polygon")Ie.type=3,Qr(Re,Qe,Ie,!0);else{if(Me!=="MultiPolygon")throw new Error("Input data is not a valid GeoJSON object.");Ie.type=3;for(const Be of Re)Qr(Be,Qe,Ie,!0)}return Ie}function ui([Ne,te],oe,me){const Me=n.aF(Ne);let Re=n.aJ(te);Re=Re<0?0:Re>1?1:Re,oe.push(Me,Re),me.minX=Math.min(me.minX,Me),me.minY=Math.min(me.minY,Re),me.maxX=Math.max(me.maxX,Me),me.maxY=Math.max(me.maxY,Re)}function zi(Ne,te,oe,me=!1,Me=!1){const Re=[];for(const Ie of Ne)ui(Ie,Re,oe);te.push(Re),me&&(function(Ie,Qe){let Be=0;for(let Je=0,Pt=Ie.length,_t=Pt-2;Je<Pt;_t=Je,Je+=2)Be+=(Ie[Je]-Ie[_t])*(Ie[Je+1]+Ie[_t+1]);if(Be>0===Qe)for(let Je=0,Pt=Ie.length;Je<Pt/2;Je+=2){const _t=Ie[Je],lr=Ie[Je+1];Ie[Je]=Ie[Pt-2-Je],Ie[Je+1]=Ie[Pt-1-Je],Ie[Pt-2-Je]=_t,Ie[Pt-1-Je]=lr}})(Re,Me)}function Qr(Ne,te,oe,me=!1){for(let Me=0;Me<Ne.length;Me++)zi(Ne[Me],te,oe,me,Me===0)}function Ot(Ne,te,oe,me){const{id:Me,type:Re,geometry:Ie,tags:Qe}=Ne,Be=[];if(Re===1)(function(Je,Pt,_t,lr,yr){for(let gr=0;gr<Je.length;gr+=2){const Jr=Math.round(n.al*(Je[gr+0]*Pt-_t)),qr=Math.round(n.al*(Je[gr+1]*Pt-lr));yr.push([Jr,qr])}})(Ie,te,oe,me,Be);else for(const Je of Ie)sr(Je,te,oe,me,Be);return{id:Me,type:Re,geometry:Be,tags:Qe}}function sr(Ne,te,oe,me,Me){const Re=-Yt,Ie=n.al+Yt;let Qe;for(let Be=0;Be<Ne.length-2;Be+=2){let Je=Math.round(n.al*(Ne[Be+0]*te-oe)),Pt=Math.round(n.al*(Ne[Be+1]*te-me)),_t=Math.round(n.al*(Ne[Be+2]*te-oe)),lr=Math.round(n.al*(Ne[Be+3]*te-me));const yr=_t-Je,gr=lr-Pt;Je<Re&&_t<Re||(Je<Re?(Pt+=Math.round(gr*((Re-Je)/yr)),Je=Re):_t<Re&&(lr=Pt+Math.round(gr*((Re-Je)/yr)),_t=Re),Pt<Re&&lr<Re||(Pt<Re?(Je+=Math.round(yr*((Re-Pt)/gr)),Pt=Re):lr<Re&&(_t=Je+Math.round(yr*((Re-Pt)/gr)),lr=Re),Je>=Ie&&_t>=Ie||(Je>=Ie?(Pt+=Math.round(gr*((Ie-Je)/yr)),Je=Ie):_t>=Ie&&(lr=Pt+Math.round(gr*((Ie-Je)/yr)),_t=Ie),Pt>=Ie&&lr>=Ie||(Pt>=Ie?(Je+=Math.round(yr*((Ie-Pt)/gr)),Pt=Ie):lr>=Ie&&(_t=Je+Math.round(yr*((Ie-Pt)/gr)),lr=Ie),Qe&&Je===Qe[Qe.length-1][0]&&Pt===Qe[Qe.length-1][1]||(Qe=[[Je,Pt]],Me.push(Qe)),Qe.push([_t,lr])))))}}function Fr({name:Ne,features:te},oe){oe.writeStringField(1,Ne),oe.writeVarintField(5,n.al);const me=new Map,Me=new Map,Re={keys:me,values:Me,feature:null};for(const Ie of te)Re.feature=Ie,oe.writeMessage(2,Pi,Re);for(const Ie of me.keys())oe.writeStringField(3,Ie);for(const Ie of Me.keys())oe.writeMessage(4,oi,Ie)}function Pi(Ne,te){const oe=Ne.feature;oe.id!==void 0&&Number.isSafeInteger(+oe.id)&&te.writeVarintField(1,+oe.id),oe.tags&&te.writeMessage(2,it,Ne),te.writeVarintField(3,oe.type),te.writeMessage(4,Rr,oe)}function it({keys:Ne,values:te,feature:oe},me){for(const Me of Object.keys(oe.tags)){let Re=oe.tags[Me];if(Re===null)continue;let Ie=Ne.get(Me);Ie===void 0&&(Ie=Ne.size,Ne.set(Me,Ie)),me.writeVarint(Ie);const Qe=typeof Re;Qe!=="string"&&Qe!=="boolean"&&Qe!=="number"&&(Re=JSON.stringify(Re));let Be=te.get(Re);Be===void 0&&(Be=te.size,te.set(Re,Be)),me.writeVarint(Be)}}function Vt(Ne,te){return(te<<3)+(7&Ne)}function Er(Ne){return Ne<<1^Ne>>31}function Rr(Ne,te){const{geometry:oe,type:me}=Ne;let Me=0,Re=0;if(me===1){te.writeVarint(Vt(1,oe.length));for(const Ie of oe){const Qe=Ie[0]-Me,Be=Ie[1]-Re;te.writeVarint(Er(Qe)),te.writeVarint(Er(Be)),Me+=Qe,Re+=Be}}else for(const Ie of oe){te.writeVarint(Vt(1,1));const Qe=Ie.length-(me===3?1:0);for(let Be=0;Be<Qe;Be++){Be===1&&te.writeVarint(Vt(2,Qe-1));const Je=Ie[Be][0]-Me,Pt=Ie[Be][1]-Re;te.writeVarint(Er(Je)),te.writeVarint(Er(Pt)),Me+=Je,Re+=Pt}me===3&&te.writeVarint(Vt(7,1))}}function oi(Ne,te){const oe=typeof Ne;oe==="string"?te.writeStringField(1,Ne):oe==="boolean"?te.writeBooleanField(7,Ne):oe==="number"&&(Ne%1!=0?te.writeDoubleField(3,Ne):Ne<0?te.writeSVarintField(6,Ne):te.writeVarintField(5,Ne))}const Gi={minZoom:0,maxZoom:16,minPoints:2,radius:40,extent:512,nodeSize:64,log:!1,generateId:!1,reduce:null,map:Ne=>Ne},Cr=Math.fround||(Vi=new Float32Array(1),Ne=>(Vi[0]=+Ne,Vi[0]));var Vi;const vi=3,ho=5,Tn=6;class qs{constructor(te){this.options=Object.assign(Object.create(Gi),te),this.trees=new Array(this.options.maxZoom+1),this.stride=this.options.reduce?7:6,this.clusterProps=[]}load(te){const{log:oe,minZoom:me,maxZoom:Me}=this.options;oe&&console.time("total time");const Re=`prepare ${te.length} points`;oe&&console.time(Re),this.points=te;const Ie=[];for(let Be=0;Be<te.length;Be++){const Je=te[Be];if(!Je.geometry)continue;const[Pt,_t]=Je.geometry.coordinates,lr=Cr(Va(Pt)),yr=Cr(On(_t));Ie.push(lr,yr,1/0,Be,-1,1),this.options.reduce&&Ie.push(0)}let Qe=this.trees[Me+1]=this._createTree(Ie);oe&&console.timeEnd(Re);for(let Be=Me;Be>=me;Be--){const Je=+Date.now();Qe=this.trees[Be]=this._createTree(this._cluster(Qe,Be)),oe&&console.log("z%d: %d clusters in %dms",Be,Qe.numItems,+Date.now()-Je)}return oe&&console.timeEnd("total time"),this}getClusters(te,oe){let me=((te[0]+180)%360+360)%360-180;const Me=Math.max(-90,Math.min(90,te[1]));let Re=te[2]===180?180:((te[2]+180)%360+360)%360-180;const Ie=Math.max(-90,Math.min(90,te[3]));if(te[2]-te[0]>=360)me=-180,Re=180;else if(me>Re){const _t=this.getClusters([me,Me,180,Ie],oe),lr=this.getClusters([-180,Me,Re,Ie],oe);return _t.concat(lr)}const Qe=this.trees[this._limitZoom(oe)],Be=Qe.range(Va(me),On(Ie),Va(Re),On(Me)),Je=Qe.data,Pt=[];for(const _t of Be){const lr=this.stride*_t;Pt.push(Je[lr+ho]>1?gl(Je,lr,this.clusterProps):this.points[Je[lr+vi]])}return Pt}getChildren(te){const oe=this._getOriginId(te),me=this._getOriginZoom(te),Me="No cluster with the specified id.",Re=this.trees[me];if(!Re)throw new Error(Me);const Ie=Re.data;if(oe*this.stride>=Ie.length)throw new Error(Me);const Qe=this.options.radius/(this.options.extent*Math.pow(2,me-1)),Be=Re.within(Ie[oe*this.stride],Ie[oe*this.stride+1],Qe),Je=[];for(const Pt of Be){const _t=Pt*this.stride;Ie[_t+4]===te&&Je.push(Ie[_t+ho]>1?gl(Ie,_t,this.clusterProps):this.points[Ie[_t+vi]])}if(Je.length===0)throw new Error(Me);return Je}getLeaves(te,oe,me){const Me=[];return this._appendLeaves(Me,te,oe=oe||10,me=me||0,0),Me}getTile(te,oe,me){const Me=this.trees[this._limitZoom(te)],Re=Math.pow(2,te),{extent:Ie,radius:Qe}=this.options,Be=Qe/Ie,Je=(me-Be)/Re,Pt=(me+1+Be)/Re,_t={features:[]};return this._addTileFeatures(Me.range((oe-Be)/Re,Je,(oe+1+Be)/Re,Pt),Me.data,oe,me,Re,_t),oe===0&&this._addTileFeatures(Me.range(1-Be/Re,Je,1,Pt),Me.data,Re,me,Re,_t),oe===Re-1&&this._addTileFeatures(Me.range(0,Je,Be/Re,Pt),Me.data,-1,me,Re,_t),_t.features.length?_t:null}getClusterExpansionZoom(te){let oe=this._getOriginZoom(te)-1;for(;oe<=this.options.maxZoom;){const me=this.getChildren(te);if(oe++,me.length!==1)break;te=me[0].properties.cluster_id}return oe}_appendLeaves(te,oe,me,Me,Re){const Ie=this.getChildren(oe);for(const Qe of Ie){const Be=Qe.properties;if(Be&&Be.cluster?Re+Be.point_count<=Me?Re+=Be.point_count:Re=this._appendLeaves(te,Be.cluster_id,me,Me,Re):Re<Me?Re++:te.push(Qe),te.length===me)break}return Re}_createTree(te){const oe=new n.c3(te.length/this.stride|0,this.options.nodeSize,Float32Array);for(let me=0;me<te.length;me+=this.stride)oe.add(te[me],te[me+1]);return oe.finish(),oe.data=te,oe}_addTileFeatures(te,oe,me,Me,Re,Ie){for(const Qe of te){const Be=Qe*this.stride,Je=oe[Be+ho]>1;let Pt,_t,lr;if(Je)Pt=zu(oe,Be,this.clusterProps),_t=oe[Be],lr=oe[Be+1];else{const Jr=this.points[oe[Be+vi]];Pt=Jr.properties;const[qr,Yr]=Jr.geometry.coordinates;_t=Va(qr),lr=On(Yr)}const yr={type:1,geometry:[[Math.round(this.options.extent*(_t*Re-me)),Math.round(this.options.extent*(lr*Re-Me))]],tags:Pt};let gr;gr=Je||this.options.generateId?oe[Be+vi]:this.points[oe[Be+vi]].id,gr!==void 0&&(yr.id=gr),Ie.features.push(yr)}}_limitZoom(te){return Math.max(this.options.minZoom,Math.min(Math.floor(+te),this.options.maxZoom+1))}_cluster(te,oe){const{radius:me,extent:Me,reduce:Re,minPoints:Ie}=this.options,Qe=me/(Me*Math.pow(2,oe)),Be=te.data,Je=[],Pt=this.stride;for(let _t=0;_t<Be.length;_t+=Pt){if(Be[_t+2]<=oe)continue;Be[_t+2]=oe;const lr=Be[_t],yr=Be[_t+1],gr=te.within(Be[_t],Be[_t+1],Qe),Jr=Be[_t+ho];let qr=Jr;for(const Yr of gr){const Ri=Yr*Pt;Be[Ri+2]>oe&&(qr+=Be[Ri+ho])}if(qr>Jr&&qr>=Ie){let Yr,Ri=lr*Jr,ri=yr*Jr,An=-1;const Xn=(_t/Pt<<5)+(oe+1)+this.points.length;for(const eo of gr){const Li=eo*Pt;if(Be[Li+2]<=oe)continue;Be[Li+2]=oe;const mi=Be[Li+ho];Ri+=Be[Li]*mi,ri+=Be[Li+1]*mi,Be[Li+4]=Xn,Re&&(Yr||(Yr=this._map(Be,_t,!0),An=this.clusterProps.length,this.clusterProps.push(Yr)),Re(Yr,this._map(Be,Li)))}Be[_t+4]=Xn,Je.push(Ri/qr,ri/qr,1/0,Xn,-1,qr),Re&&Je.push(An)}else{for(let Yr=0;Yr<Pt;Yr++)Je.push(Be[_t+Yr]);if(qr>1)for(const Yr of gr){const Ri=Yr*Pt;if(!(Be[Ri+2]<=oe)){Be[Ri+2]=oe;for(let ri=0;ri<Pt;ri++)Je.push(Be[Ri+ri])}}}}return Je}_getOriginId(te){return te-this.points.length>>5}_getOriginZoom(te){return(te-this.points.length)%32}_map(te,oe,me){if(te[oe+ho]>1){const Ie=this.clusterProps[te[oe+Tn]];return me?Object.assign({},Ie):Ie}const Me=this.points[te[oe+vi]].properties,Re=this.options.map(Me);return me&&Re===Me?Object.assign({},Re):Re}}function gl(Ne,te,oe){return{type:"Feature",id:Ne[te+vi],properties:zu(Ne,te,oe),geometry:{type:"Point",coordinates:[(me=Ne[te],360*(me-.5)),Mf(Ne[te+1])]}};var me}function zu(Ne,te,oe){const me=Ne[te+ho],Me=me>=1e4?`${Math.round(me/1e3)}k`:me>=1e3?Math.round(me/100)/10+"k":me,Re=Ne[te+Tn],Ie=Re===-1?{}:Object.assign({},oe[Re]);return Object.assign(Ie,{cluster:!0,cluster_id:Ne[te+vi],point_count:me,point_count_abbreviated:Me})}function Va(Ne){return Ne/360+.5}function On(Ne){const te=Math.sin(Ne*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function Mf(Ne){const te=(180-360*Ne)*Math.PI/180;return 360*Math.atan(Math.exp(te))/Math.PI-90}function Zo(Ne,te,oe,me){let Me=me;const Re=te+(oe-te>>1);let Ie,Qe=oe-te;const Be=Ne[te],Je=Ne[te+1],Pt=Ne[oe],_t=Ne[oe+1];for(let lr=te+3;lr<oe;lr+=3){const yr=Df(Ne[lr],Ne[lr+1],Be,Je,Pt,_t);if(yr>Me)Ie=lr,Me=yr;else if(yr===Me){const gr=Math.abs(lr-Re);gr<Qe&&(Ie=lr,Qe=gr)}}Me>me&&(Ie-te>3&&Zo(Ne,te,Ie,me),Ne[Ie+2]=Me,oe-Ie>3&&Zo(Ne,Ie,oe,me))}function Df(Ne,te,oe,me,Me,Re){let Ie=Me-oe,Qe=Re-me;if(Ie!==0||Qe!==0){const Be=((Ne-oe)*Ie+(te-me)*Qe)/(Ie*Ie+Qe*Qe);Be>1?(oe=Me,me=Re):Be>0&&(oe+=Ie*Be,me+=Qe*Be)}return Ie=Ne-oe,Qe=te-me,Ie*Ie+Qe*Qe}function na(Ne,te,oe,me){const Me={id:Ne??null,type:te,geometry:oe,tags:me,minX:1/0,minY:1/0,maxX:-1/0,maxY:-1/0};if(te==="Point"||te==="MultiPoint"||te==="LineString")Zl(Me,oe);else if(te==="Polygon")Zl(Me,oe[0]);else if(te==="MultiLineString")for(const Re of oe)Zl(Me,Re);else if(te==="MultiPolygon")for(const Re of oe)Zl(Me,Re[0]);return Me}function Zl(Ne,te){for(let oe=0;oe<te.length;oe+=3)Ne.minX=Math.min(Ne.minX,te[oe]),Ne.minY=Math.min(Ne.minY,te[oe+1]),Ne.maxX=Math.max(Ne.maxX,te[oe]),Ne.maxY=Math.max(Ne.maxY,te[oe+1])}function Wo(Ne,te,oe,me){if(!te.geometry)return;const Me=te.geometry.coordinates;if(Me&&Me.length===0)return;const Re=te.geometry.type,Ie=Math.pow(oe.tolerance/((1<<oe.maxZoom)*oe.extent),2);let Qe=[],Be=te.id;if(oe.promoteId?Be=te.properties[oe.promoteId]:oe.generateId&&(Be=me||0),Re==="Point")Wl(Me,Qe);else if(Re==="MultiPoint")for(const Je of Me)Wl(Je,Qe);else if(Re==="LineString")_l(Me,Qe,Ie,!1);else if(Re==="MultiLineString"){if(oe.lineMetrics){for(const Je of Me)Qe=[],_l(Je,Qe,Ie,!1),Ne.push(na(Be,"LineString",Qe,te.properties));return}Fu(Me,Qe,Ie,!1)}else if(Re==="Polygon")Fu(Me,Qe,Ie,!0);else{if(Re!=="MultiPolygon"){if(Re==="GeometryCollection"){for(const Je of te.geometry.geometries)Wo(Ne,{id:Be,geometry:Je,properties:te.properties},oe,me);return}throw new Error("Input data is not a valid GeoJSON object.")}for(const Je of Me){const Pt=[];Fu(Je,Pt,Ie,!0),Qe.push(Pt)}}Ne.push(na(Be,Re,Qe,te.properties))}function Wl(Ne,te){te.push(ku(Ne[0]),Ro(Ne[1]),0)}function _l(Ne,te,oe,me){let Me,Re,Ie=0;for(let Be=0;Be<Ne.length;Be++){const Je=ku(Ne[Be][0]),Pt=Ro(Ne[Be][1]);te.push(Je,Pt,0),Be>0&&(Ie+=me?(Me*Pt-Je*Re)/2:Math.sqrt(Math.pow(Je-Me,2)+Math.pow(Pt-Re,2))),Me=Je,Re=Pt}const Qe=te.length-3;te[2]=1,Zo(te,0,Qe,oe),te[Qe+2]=1,te.size=Math.abs(Ie),te.start=0,te.end=te.size}function Fu(Ne,te,oe,me){for(let Me=0;Me<Ne.length;Me++){const Re=[];_l(Ne[Me],Re,oe,me),te.push(Re)}}function ku(Ne){return Ne/360+.5}function Ro(Ne){const te=Math.sin(Ne*Math.PI/180),oe=.5-.25*Math.log((1+te)/(1-te))/Math.PI;return oe<0?0:oe>1?1:oe}function $n(Ne,te,oe,me,Me,Re,Ie,Qe){if(me/=te,Re>=(oe/=te)&&Ie<me)return Ne;if(Ie<oe||Re>=me)return null;const Be=[];for(const Je of Ne){const Pt=Je.geometry;let _t=Je.type;const lr=Me===0?Je.minX:Je.minY,yr=Me===0?Je.maxX:Je.maxY;if(lr>=oe&&yr<me){Be.push(Je);continue}if(yr<oe||lr>=me)continue;let gr=[];if(_t==="Point"||_t==="MultiPoint")ys(Pt,gr,oe,me,Me);else if(_t==="LineString")vo(Pt,gr,oe,me,Me,!1,Qe.lineMetrics);else if(_t==="MultiLineString")Mo(Pt,gr,oe,me,Me,!1);else if(_t==="Polygon")Mo(Pt,gr,oe,me,Me,!0);else if(_t==="MultiPolygon")for(const Jr of Pt){const qr=[];Mo(Jr,qr,oe,me,Me,!0),qr.length&&gr.push(qr)}if(gr.length){if(Qe.lineMetrics&&_t==="LineString"){for(const Jr of gr)Be.push(na(Je.id,_t,Jr,Je.tags));continue}_t!=="LineString"&&_t!=="MultiLineString"||(gr.length===1?(_t="LineString",gr=gr[0]):_t="MultiLineString"),_t!=="Point"&&_t!=="MultiPoint"||(_t=gr.length===3?"Point":"MultiPoint"),Be.push(na(Je.id,_t,gr,Je.tags))}}return Be.length?Be:null}function ys(Ne,te,oe,me,Me){for(let Re=0;Re<Ne.length;Re+=3){const Ie=Ne[Re+Me];Ie>=oe&&Ie<=me&&$s(te,Ne[Re],Ne[Re+1],Ne[Re+2])}}function vo(Ne,te,oe,me,Me,Re,Ie){let Qe=Ah(Ne);const Be=Me===0?Nc:Xs;let Je,Pt,_t=Ne.start;for(let qr=0;qr<Ne.length-3;qr+=3){const Yr=Ne[qr],Ri=Ne[qr+1],ri=Ne[qr+2],An=Ne[qr+3],Xn=Ne[qr+4],eo=Me===0?Yr:Ri,Li=Me===0?An:Xn;let mi=!1;Ie&&(Je=Math.sqrt(Math.pow(Yr-An,2)+Math.pow(Ri-Xn,2))),eo<oe?Li>oe&&(Pt=Be(Qe,Yr,Ri,An,Xn,oe),Ie&&(Qe.start=_t+Je*Pt)):eo>me?Li<me&&(Pt=Be(Qe,Yr,Ri,An,Xn,me),Ie&&(Qe.start=_t+Je*Pt)):$s(Qe,Yr,Ri,ri),Li<oe&&eo>=oe&&(Pt=Be(Qe,Yr,Ri,An,Xn,oe),mi=!0),Li>me&&eo<=me&&(Pt=Be(Qe,Yr,Ri,An,Xn,me),mi=!0),!Re&&mi&&(Ie&&(Qe.end=_t+Je*Pt),te.push(Qe),Qe=Ah(Ne)),Ie&&(_t+=Je)}let lr=Ne.length-3;const yr=Ne[lr],gr=Ne[lr+1],Jr=Me===0?yr:gr;Jr>=oe&&Jr<=me&&$s(Qe,yr,gr,Ne[lr+2]),lr=Qe.length-3,Re&&lr>=3&&(Qe[lr]!==Qe[0]||Qe[lr+1]!==Qe[1])&&$s(Qe,Qe[0],Qe[1],Qe[2]),Qe.length&&te.push(Qe)}function Ah(Ne){const te=[];return te.size=Ne.size,te.start=Ne.start,te.end=Ne.end,te}function Mo(Ne,te,oe,me,Me,Re){for(const Ie of Ne)vo(Ie,te,oe,me,Me,Re,!1)}function $s(Ne,te,oe,me){Ne.push(te,oe,me)}function Nc(Ne,te,oe,me,Me,Re){const Ie=(Re-te)/(me-te);return $s(Ne,Re,oe+(Me-oe)*Ie,1),Ie}function Xs(Ne,te,oe,me,Me,Re){const Ie=(Re-oe)/(Me-oe);return $s(Ne,te+(me-te)*Ie,Re,1),Ie}function oa(Ne,te){const oe=[];for(let me=0;me<Ne.length;me++){const Me=Ne[me],Re=Me.type;let Ie;if(Re==="Point"||Re==="MultiPoint"||Re==="LineString")Ie=vs(Me.geometry,te);else if(Re==="MultiLineString"||Re==="Polygon"){Ie=[];for(const Qe of Me.geometry)Ie.push(vs(Qe,te))}else if(Re==="MultiPolygon"){Ie=[];for(const Qe of Me.geometry){const Be=[];for(const Je of Qe)Be.push(vs(Je,te));Ie.push(Be)}}oe.push(na(Me.id,Re,Ie,Me.tags))}return oe}function vs(Ne,te){const oe=[];oe.size=Ne.size,Ne.start!==void 0&&(oe.start=Ne.start,oe.end=Ne.end);for(let me=0;me<Ne.length;me+=3)oe.push(Ne[me]+te,Ne[me+1],Ne[me+2]);return oe}function Zs(Ne,te){if(Ne.transformed)return Ne;const oe=1<<Ne.z,me=Ne.x,Me=Ne.y;for(const Re of Ne.features){const Ie=Re.geometry,Qe=Re.type;if(Re.geometry=[],Qe===1)for(let Be=0;Be<Ie.length;Be+=2)Re.geometry.push(gn(Ie[Be],Ie[Be+1],te,oe,me,Me));else for(let Be=0;Be<Ie.length;Be++){const Je=[];for(let Pt=0;Pt<Ie[Be].length;Pt+=2)Je.push(gn(Ie[Be][Pt],Ie[Be][Pt+1],te,oe,me,Me));Re.geometry.push(Je)}}return Ne.transformed=!0,Ne}function gn(Ne,te,oe,me,Me,Re){return[Math.round(oe*(Ne*me-Me)),Math.round(oe*(te*me-Re))]}function xo(Ne,te,oe,me,Me){const Re=te===Me.maxZoom?0:Me.tolerance/((1<<te)*Me.extent),Ie={features:[],numPoints:0,numSimplified:0,numFeatures:Ne.length,source:null,x:oe,y:me,z:te,transformed:!1,minX:2,minY:1,maxX:-1,maxY:0};for(const Qe of Ne)Eh(Ie,Qe,Re,Me);return Ie}function Eh(Ne,te,oe,me){const Me=te.geometry,Re=te.type,Ie=[];if(Ne.minX=Math.min(Ne.minX,te.minX),Ne.minY=Math.min(Ne.minY,te.minY),Ne.maxX=Math.max(Ne.maxX,te.maxX),Ne.maxY=Math.max(Ne.maxY,te.maxY),Re==="Point"||Re==="MultiPoint")for(let Qe=0;Qe<Me.length;Qe+=3)Ie.push(Me[Qe],Me[Qe+1]),Ne.numPoints++,Ne.numSimplified++;else if(Re==="LineString")Yl(Ie,Me,Ne,oe,!1,!1);else if(Re==="MultiLineString"||Re==="Polygon")for(let Qe=0;Qe<Me.length;Qe++)Yl(Ie,Me[Qe],Ne,oe,Re==="Polygon",Qe===0);else if(Re==="MultiPolygon")for(let Qe=0;Qe<Me.length;Qe++){const Be=Me[Qe];for(let Je=0;Je<Be.length;Je++)Yl(Ie,Be[Je],Ne,oe,!0,Je===0)}if(Ie.length){let Qe=te.tags||null;if(Re==="LineString"&&me.lineMetrics){Qe={};for(const Je in te.tags)Qe[Je]=te.tags[Je];Qe.mapbox_clip_start=Me.start/Me.size,Qe.mapbox_clip_end=Me.end/Me.size}const Be={geometry:Ie,type:Re==="Polygon"||Re==="MultiPolygon"?3:Re==="LineString"||Re==="MultiLineString"?2:1,tags:Qe};te.id!==null&&(Be.id=te.id),Ne.features.push(Be)}}function Yl(Ne,te,oe,me,Me,Re){const Ie=me*me;if(me>0&&te.size<(Me?Ie:me))return void(oe.numPoints+=te.length/3);const Qe=[];for(let Be=0;Be<te.length;Be+=3)(me===0||te[Be+2]>Ie)&&(oe.numSimplified++,Qe.push(te[Be],te[Be+1])),oe.numPoints++;Me&&(function(Be,Je){let Pt=0;for(let _t=0,lr=Be.length,yr=lr-2;_t<lr;yr=_t,_t+=2)Pt+=(Be[_t]-Be[yr])*(Be[_t+1]+Be[yr+1]);if(Pt>0===Je)for(let _t=0,lr=Be.length;_t<lr/2;_t+=2){const yr=Be[_t],gr=Be[_t+1];Be[_t]=Be[lr-2-_t],Be[_t+1]=Be[lr-1-_t],Be[lr-2-_t]=yr,Be[lr-1-_t]=gr}})(Qe,Re),Ne.push(Qe)}const ya={maxZoom:14,indexMaxZoom:5,indexMaxPoints:1e5,tolerance:3,extent:4096,buffer:64,lineMetrics:!1,promoteId:null,generateId:!1,debug:0};class Of{constructor(te,oe){const me=(oe=this.options=(function(Re,Ie){for(const Qe in Ie)Re[Qe]=Ie[Qe];return Re})(Object.create(ya),oe)).debug;if(me&&console.time("preprocess data"),oe.maxZoom<0||oe.maxZoom>24)throw new Error("maxZoom should be in the 0-24 range");if(oe.promoteId&&oe.generateId)throw new Error("promoteId and generateId cannot be used together.");let Me=(function(Re,Ie){const Qe=[];if(Re.type==="FeatureCollection")for(let Be=0;Be<Re.features.length;Be++)Wo(Qe,Re.features[Be],Ie,Be);else Wo(Qe,Re.type==="Feature"?Re:{geometry:Re},Ie);return Qe})(te,oe);this.tiles={},this.tileCoords=[],me&&(console.timeEnd("preprocess data"),console.log("index: maxZoom: %d, maxPoints: %d",oe.indexMaxZoom,oe.indexMaxPoints),console.time("generate tiles"),this.stats={},this.total=0),Me=(function(Re,Ie){const Qe=Ie.buffer/Ie.extent;let Be=Re;const Je=$n(Re,1,-1-Qe,Qe,0,-1,2,Ie),Pt=$n(Re,1,1-Qe,2+Qe,0,-1,2,Ie);return(Je||Pt)&&(Be=$n(Re,1,-Qe,1+Qe,0,-1,2,Ie)||[],Je&&(Be=oa(Je,1).concat(Be)),Pt&&(Be=Be.concat(oa(Pt,-1)))),Be})(Me,oe),Me.length&&this.splitTile(Me,0,0,0),me&&(Me.length&&console.log("features: %d, points: %d",this.tiles[0].numFeatures,this.tiles[0].numPoints),console.timeEnd("generate tiles"),console.log("tiles generated:",this.total,JSON.stringify(this.stats)))}splitTile(te,oe,me,Me,Re,Ie,Qe){const Be=[te,oe,me,Me],Je=this.options,Pt=Je.debug;for(;Be.length;){Me=Be.pop(),me=Be.pop(),oe=Be.pop(),te=Be.pop();const _t=1<<oe,lr=Ch(oe,me,Me);let yr=this.tiles[lr];if(!yr&&(Pt>1&&console.time("creation"),yr=this.tiles[lr]=xo(te,oe,me,Me,Je),this.tileCoords.push({z:oe,x:me,y:Me}),Pt)){Pt>1&&(console.log("tile z%d-%d-%d (features: %d, points: %d, simplified: %d)",oe,me,Me,yr.numFeatures,yr.numPoints,yr.numSimplified),console.timeEnd("creation"));const mi=`z${oe}`;this.stats[mi]=(this.stats[mi]||0)+1,this.total++}if(yr.source=te,Re==null){if(oe===Je.indexMaxZoom||yr.numPoints<=Je.indexMaxPoints)continue}else{if(oe===Je.maxZoom||oe===Re)continue;if(Re!=null){const mi=Re-oe;if(me!==Ie>>mi||Me!==Qe>>mi)continue}}if(yr.source=null,te.length===0)continue;Pt>1&&console.time("clipping");const gr=.5*Je.buffer/Je.extent,Jr=.5-gr,qr=.5+gr,Yr=1+gr;let Ri=null,ri=null,An=null,Xn=null,eo=$n(te,_t,me-gr,me+qr,0,yr.minX,yr.maxX,Je),Li=$n(te,_t,me+Jr,me+Yr,0,yr.minX,yr.maxX,Je);te=null,eo&&(Ri=$n(eo,_t,Me-gr,Me+qr,1,yr.minY,yr.maxY,Je),ri=$n(eo,_t,Me+Jr,Me+Yr,1,yr.minY,yr.maxY,Je),eo=null),Li&&(An=$n(Li,_t,Me-gr,Me+qr,1,yr.minY,yr.maxY,Je),Xn=$n(Li,_t,Me+Jr,Me+Yr,1,yr.minY,yr.maxY,Je),Li=null),Pt>1&&console.timeEnd("clipping"),Be.push(Ri||[],oe+1,2*me,2*Me),Be.push(ri||[],oe+1,2*me,2*Me+1),Be.push(An||[],oe+1,2*me+1,2*Me),Be.push(Xn||[],oe+1,2*me+1,2*Me+1)}}getTile(te,oe,me){te=+te,oe=+oe,me=+me;const Me=this.options,{extent:Re,debug:Ie}=Me;if(te<0||te>24)return null;const Qe=1<<te,Be=Ch(te,oe=oe+Qe&Qe-1,me);if(this.tiles[Be])return Zs(this.tiles[Be],Re);Ie>1&&console.log("drilling down to z%d-%d-%d",te,oe,me);let Je,Pt=te,_t=oe,lr=me;for(;!Je&&Pt>0;)Pt--,_t>>=1,lr>>=1,Je=this.tiles[Ch(Pt,_t,lr)];return Je&&Je.source?(Ie>1&&(console.log("found parent tile z%d-%d-%d",Pt,_t,lr),console.time("drilling down")),this.splitTile(Je.source,Pt,_t,lr,te,oe,me),Ie>1&&console.timeEnd("drilling down"),this.tiles[Be]?Zs(this.tiles[Be],Re):null):null}}function Ch(Ne,te,oe){return 32*((1<<Ne)*oe+te)+Ne}function Pf(Ne,te){const oe=Ne.tileID.canonical;if(!this._geoJSONIndex)return void te(null,null);const me=this._geoJSONIndex.getTile(oe.z,oe.x,oe.y);if(!me)return void te(null,null);const Me=Je=>Je.tags&&"3d_elevation_id"in Je.tags&&"source"in Je.tags&&Je.tags.source==="elevation",Re=me.features.filter((Je=>Me(Je)));let Ie={_geojsonTileLayer:me.features};Re.length>0&&(Ie={_geojsonTileLayer:me.features.filter((Je=>!Me(Je))),hd_road_elevation:Re});const Qe=new Ct(Ie),Be=(function(Je){const Pt=new n.bt;for(const _t of Object.keys(Je))Pt.writeMessage(3,Fr,{name:_t,features:Je[_t]});return Pt.finish()})(Ie).buffer;te(null,{vectorTile:Qe,rawData:Be})}class Tt extends be{constructor(te,oe,me,Me,Re,Ie,Qe){super(te,oe,me,Me,Re,Pf,Qe),Ie&&(this.loadGeoJSON=Ie),this._dynamicIndex=new hr}loadData(te,oe){const me=te&&te.request,Me=me&&me.collectResourceTiming;this._geoJSONIndex=null,this.loadGeoJSON(te,((Re,Ie)=>{if(Re||!Ie)return oe(Re);if(typeof Ie!="object")return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));{try{if(te.filter){const Be=n.U(te.filter,{type:"boolean","property-type":"data-driven",overridable:!1,transition:!1});if(Be.result==="error")throw new Error(Be.value.map((Je=>`${Je.key}: ${Je.message}`)).join(", "));Ie.features=Ie.features.filter((Je=>Be.value.evaluate({zoom:0},Je)))}te.dynamic?(Ie.type==="Feature"&&(Ie={type:"FeatureCollection",features:[Ie]}),te.append||(this._dynamicIndex.clear(),this.loaded={}),this._dynamicIndex.load(Ie.features,this.loaded),te.cluster&&(Ie.features=this._dynamicIndex.getFeatures())):this.loaded={},this._geoJSONIndex=te.cluster?new qs((function({superclusterOptions:Be,clusterProperties:Je}){if(!Je||!Be)return Be;const Pt={},_t={},lr={accumulated:null,zoom:0},yr={properties:null},gr=Object.keys(Je);for(const Jr of gr){const[qr,Yr]=Je[Jr],Ri=n.U(Yr),ri=n.U(typeof qr=="string"?[qr,["accumulated"],["get",Jr]]:qr);Pt[Jr]=Ri.value,_t[Jr]=ri.value}return Be.map=Jr=>{yr.properties=Jr;const qr={};for(const Yr of gr)qr[Yr]=Pt[Yr].evaluate(lr,yr);return qr},Be.reduce=(Jr,qr)=>{yr.properties=qr;for(const Yr of gr)lr.accumulated=Jr[Yr],Jr[Yr]=_t[Yr].evaluate(lr,yr)},Be})(te)).load(Ie.features):te.dynamic?this._dynamicIndex:(function(Be,Je){return new Of(Be,Je)})(Ie,te.geojsonVtOptions)}catch(Be){return oe(Be)}const Qe={};if(Me){const Be=C(me);Be&&(Qe.resourceTiming={},Qe.resourceTiming[te.source]=JSON.parse(JSON.stringify(Be)))}oe(null,Qe)}}))}reloadTile(te,oe){const me=this.loaded;return me&&me[te.uid]?te.partial?oe(null,void 0):super.reloadTile(te,oe):this.loadTile(te,oe)}loadGeoJSON(te,oe){if(te.request)n.m(te.request,oe);else{if(typeof te.data!="string")return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`));setTimeout((()=>{try{return oe(null,JSON.parse(te.data))}catch{return oe(new Error(`Input data given to '${te.source}' is not a valid GeoJSON object.`))}}),0)}}getClusterExpansionZoom(te,oe){try{oe(null,this._geoJSONIndex.getClusterExpansionZoom(te.clusterId))}catch(me){oe(me)}}getClusterChildren(te,oe){try{oe(null,this._geoJSONIndex.getChildren(te.clusterId))}catch(me){oe(me)}}getClusterLeaves(te,oe){try{oe(null,this._geoJSONIndex.getLeaves(te.clusterId,te.limit,te.offset))}catch(me){oe(me)}}}class Ws{constructor(te,oe,me){this.tileID=new n.aO(te.tileID.overscaledZ,te.tileID.wrap,te.tileID.canonical.z,te.tileID.canonical.x,te.tileID.canonical.y),this.tileZoom=te.tileZoom,this.uid=te.uid,this.zoom=te.zoom,this.canonical=te.tileID.canonical,this.pixelRatio=te.pixelRatio,this.tileSize=te.tileSize,this.source=te.source,this.overscaling=this.tileID.overscaleFactor(),this.projection=te.projection,this.brightness=oe,this.worldview=me}parse(te,oe,me,Me){this.status="parsing";const Re=new n.aO(me.tileID.overscaledZ,me.tileID.wrap,me.tileID.canonical.z,me.tileID.canonical.x,me.tileID.canonical.y),Ie=[],Qe=oe.familiesBySource[me.source],Be=new n.fe(Re,me.promoteId);Be.bucketLayerIDs=[],Be.is3DTile=!0,n.ft(te).then((Je=>{if(!Je)return Me(new Error("Could not parse tile"));const Pt=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("MAPBOX_mesh_features")||Je.json.asset.extras&&Je.json.asset.extras.MAPBOX_mesh_features,_t=Je.json.extensionsUsed&&Je.json.extensionsUsed.includes("EXT_meshopt_compression"),lr=new n.ac(this.zoom,{brightness:this.brightness,worldview:this.worldview});for(const yr in Qe)for(const gr of Qe[yr]){const Jr=gr[0];Be.bucketLayerIDs.push(gr.map((Ri=>n.B(Ri.id,Ri.scope)))),Jr.recalculate(lr,[]);const qr=n.fu(Je,1/n.d6(me.tileID.canonical)),Yr=new n.fv(gr,qr,Re,Pt,_t,this.brightness,Be,this.worldview);Pt||(Yr.needsUpload=!0),Ie.push(Yr),Yr.evaluate(Jr)}this.status="done",Me(null,{buckets:Ie,featureIndex:Be,collisionBoxArray:null,glyphAtlasImage:null,lineAtlas:null,imageAtlas:null,brightness:null})})).catch((Je=>Me(new Error(Je.message))))}}class Ud{constructor(te,oe,me,Me,Re,Ie,Qe,Be){this.actor=te,this.layerIndex=oe,this.availableImages=me,this.availableModels=Me,this.brightness=Qe,this.loading={},this.loaded={},this.worldview=Be}loadTile(te,oe){const me=te.uid,Me=this.loading[me]=new Ws(te,this.brightness,this.worldview);n.bu(te.request,((Re,Ie)=>{const Qe=!this.loading[me];return delete this.loading[me],Qe||Re?(Me.status="done",Qe||(this.loaded[me]=Me),oe(Re)):Ie&&Ie.byteLength!==0?void Me.parse(Ie,this.layerIndex,te,((Be,Je)=>{Me.status="done",this.loaded=this.loaded||{},this.loaded[me]=Me,Be||!Je?oe(Be):oe(null,Je)})):(Me.status="done",this.loaded[me]=Me,oe())}))}reloadTile(te,oe){const me=this.loaded,Me=te.uid;if(me&&me[Me]){const Re=me[Me];Re.projection=te.projection,Re.brightness=te.brightness;const Ie=(Qe,Be)=>{Re.reloadCallback&&(delete Re.reloadCallback,this.loadTile(te,oe)),oe(Qe,Be)};Re.status==="parsing"?Re.reloadCallback=Ie:Re.status==="done"&&this.loadTile(te,oe)}}abortTile(te,oe){const me=te.uid;this.loading[me]&&delete this.loading[me],oe()}removeTile(te,oe){const me=this.loaded,Me=te.uid;me&&me[Me]&&delete me[Me],oe()}}class Ih{constructor(te){this.self=te,this.actor=new n.fx(te,this),this.layerIndexes={},this.availableImages={},this.availableModels={},this.isSpriteLoaded={},this.imageRasterizer=new n.x,this.rtlPluginParsingListeners=[],this.projections={},this.defaultProjection=n.cl({name:"mercator"}),this.workerSourceTypes={vector:be,geojson:Tt,"raster-dem":ve,"raster-array":Pe,"batched-model":Ud},this.workerSources={},this.self.registerWorkerSource=(oe,me)=>{if(this.workerSourceTypes[oe])throw new Error(`Worker source with name "${oe}" already registered.`);this.workerSourceTypes[oe]=me},this.self.registerRTLTextPlugin=oe=>{if(n.fy.isParsed())throw new Error("RTL text plugin already registered.");n.fy.setState({pluginStatus:n.fz.parsed,pluginURL:n.fy.getPluginURL()}),n.fy.applyArabicShaping=oe.applyArabicShaping,n.fy.processBidirectionalText=oe.processBidirectionalText,n.fy.processStyledBidirectionalText=oe.processStyledBidirectionalText;for(const me of this.rtlPluginParsingListeners)me(null,!0);this.rtlPluginParsingListeners=[]}}clearCaches(te,oe,me){delete this.layerIndexes[te],delete this.availableImages[te],delete this.availableModels[te],delete this.workerSources[te],me()}checkIfReady(te,oe,me){me()}setReferrer(te,oe){this.referrer=oe}spriteLoaded(te,oe){this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={});const{scope:me,isLoaded:Me}=oe;if(this.isSpriteLoaded[te][me]=Me,this.workerSources[te]&&this.workerSources[te][me])for(const Re in this.workerSources[te][me]){const Ie=this.workerSources[te][me][Re];for(const Qe in Ie){const Be=Ie[Qe];Be instanceof be&&(Be.isSpriteLoaded=Me,Be.fire(new n.z("isSpriteLoaded")))}}}setImages(te,oe,me){this.availableImages[te]||(this.availableImages[te]={});const{scope:Me,images:Re}=oe;if(this.availableImages[te][Me]=Re,this.workerSources[te]&&this.workerSources[te][Me]){for(const Ie in this.workerSources[te][Me]){const Qe=this.workerSources[te][Me][Ie];for(const Be in Qe)Qe[Be].availableImages=Re}me()}else me()}setModels(te,{scope:oe,models:me},Me){if(this.availableModels[te]||(this.availableModels[te]={}),this.availableModels[te][oe]=me,this.workerSources[te]&&this.workerSources[te][oe]){for(const Re in this.workerSources[te][oe]){const Ie=this.workerSources[te][oe][Re];for(const Qe in Ie)Ie[Qe].availableModels=me}Me()}else Me()}setProjection(te,oe){this.projections[te]=n.cl(oe)}setBrightness(te,oe,me){this.brightness=oe,me()}setWorldview(te,oe,me){this.worldview=oe,me()}setLayers(te,oe,me){this.getLayerIndex(te,oe.scope).replace(oe.layers,oe.options),me()}updateLayers(te,oe,me){this.getLayerIndex(te,oe.scope).update(oe.layers,oe.removedIds,oe.options),me()}loadTile(te,oe,me){oe.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,oe.type,oe.source,oe.scope).loadTile(oe,me)}decodeRasterArray(te,oe,me){this.getWorkerSource(te,oe.type,oe.source,oe.scope).decodeRasterArray(oe,me)}reloadTile(te,oe,me){oe.projection=this.projections[te]||this.defaultProjection,this.getWorkerSource(te,oe.type,oe.source,oe.scope).reloadTile(oe,me)}abortTile(te,oe,me){this.getWorkerSource(te,oe.type,oe.source,oe.scope).abortTile(oe,me)}removeTile(te,oe,me){this.getWorkerSource(te,oe.type,oe.source,oe.scope).removeTile(oe,me)}removeSource(te,oe,me){if(!(this.workerSources[te]&&this.workerSources[te][oe.scope]&&this.workerSources[te][oe.scope][oe.type]&&this.workerSources[te][oe.scope][oe.type][oe.source]))return;const Me=this.workerSources[te][oe.scope][oe.type][oe.source];delete this.workerSources[te][oe.scope][oe.type][oe.source],Me.removeSource!==void 0?Me.removeSource(oe,me):me()}loadWorkerSource(te,oe,me){try{this.self.importScripts(oe.url),me()}catch(Me){me(Me.toString())}}syncRTLPluginState(te,oe,me){if(n.fy.isParsed())me(null,!0);else if(n.fy.isParsing())this.rtlPluginParsingListeners.push(me);else try{n.fy.setState(oe);const Me=n.fy.getPluginURL();!n.fy.isLoaded()||n.fy.isParsed()||n.fy.isParsing()||Me==null||(n.fy.setState({pluginStatus:n.fz.parsing,pluginURL:n.fy.getPluginURL()}),this.self.importScripts(Me),n.fy.isParsed()?me(null,!0):this.rtlPluginParsingListeners.push(me))}catch(Me){me(Me.toString())}}setDracoUrl(te,oe){this.dracoUrl=oe}getAvailableImages(te,oe){this.availableImages[te]||(this.availableImages[te]={});let me=this.availableImages[te][oe];return me||(me=[]),me}getAvailableModels(te,oe){this.availableModels[te]||(this.availableModels[te]={});let me=this.availableModels[te][oe];return me||(me={}),me}getLayerIndex(te,oe){this.layerIndexes[te]||(this.layerIndexes[te]={});let me=this.layerIndexes[te][oe];return me||(me=this.layerIndexes[te][oe]=new U,me.scope=oe),me}getWorkerSource(te,oe,me,Me){const Re=this.workerSources;return Re[te]||(Re[te]={}),Re[te][Me]||(Re[te][Me]={}),Re[te][Me][oe]||(Re[te][Me][oe]={}),this.isSpriteLoaded[te]||(this.isSpriteLoaded[te]={}),Re[te][Me][oe][me]||(Re[te][Me][oe][me]=new this.workerSourceTypes[oe]({send:(Ie,Qe,Be,Je,Pt,_t)=>this.actor.send(Ie,Qe,Be,te,Pt,_t),scheduler:this.actor.scheduler},this.getLayerIndex(te,Me),this.getAvailableImages(te,Me),this.getAvailableModels(te,Me),this.isSpriteLoaded[te][Me],void 0,this.brightness,this.worldview)),Re[te][Me][oe][me]}rasterizeImagesWorker(te,oe,me){const Me=new Map;for(const[Re,{image:Ie,imageVariant:Qe}]of oe.tasks.entries()){const Be=this.imageRasterizer.rasterize(Qe,Ie,oe.scope,te);Me.set(Re,Be)}me(void 0,Me)}removeRasterizedImages(te,oe,me){this.imageRasterizer.removeImagesFromCacheByIds(oe.imageIds,oe.scope,te),me()}enforceCacheSizeLimit(te,oe){n.fA(oe)}getWorkerPerformanceMetrics(te,oe,me){me(void 0,void 0)}}return n.fw(self)&&(self.worker=new Ih(self)),Ih})),m(["./shared"],(function(n){var C="3.15.0";const D={create:"create",load:"load",fullLoad:"fullLoad"},L={mark(g){performance.mark(g)},measure(g,i,c){performance.measure(g,i,c)}};function U(g){const i=g.name.split("?")[0];return n.a(i)&&i.includes("mapbox-gl.js")?"javascript":n.a(i)&&i.includes("mapbox-gl.css")?"css":n.b(i)?"fontRange":n.c(i)?"sprite":n.i(i)?"style":n.d(i)?"tilejson":"other"}var q,Z={},ie=(function(){if(q)return Z;function g(p){return!i(p)}function i(p){return typeof window>"u"||typeof document>"u"?"not a browser":(function(){if(!("Worker"in window&&"Blob"in window&&"URL"in window))return!1;var w,A,I=new Blob([""],{type:"text/javascript"}),O=URL.createObjectURL(I);try{A=new Worker(O),w=!0}catch{w=!1}return A&&A.terminate(),URL.revokeObjectURL(O),w})()?(function(){var w=document.createElement("canvas");w.width=w.height=1;var A=w.getContext("2d");if(!A)return!1;var I=A.getImageData(0,0,1,1);return I&&I.width===w.width})()?(c[x=p&&p.failIfMajorPerformanceCaveat]===void 0&&(c[x]=(function(w){var A,I=(function(O){var z=document.createElement("canvas"),k=Object.create(g.webGLContextAttributes);return k.failIfMajorPerformanceCaveat=O,z.getContext("webgl2",k)})(w);if(!I)return!1;try{A=I.createShader(I.VERTEX_SHADER)}catch{return!1}return!(!A||I.isContextLost())&&(I.shaderSource(A,"void main() {}"),I.compileShader(A),I.getShaderParameter(A,I.COMPILE_STATUS)===!0)})(x)),c[x]?document.documentMode?"insufficient ECMAScript 6 support":void 0:"insufficient WebGL2 support"):"insufficient Canvas/getImageData support":"insufficient worker support";var x}q=1,Z.supported=g,Z.notSupportedReason=i;var c={};return g.webGLContextAttributes={antialias:!1,alpha:!0,stencil:!0,depth:!0},Z})();function ne(g,i,c){const p=document.createElement(g);return i!=null&&(p.className=i),c&&c.appendChild(p),p}function be(g,i,c){const p=document.createElementNS("http://www.w3.org/2000/svg",g);for(const x of Object.keys(i))p.setAttributeNS(null,x,String(i[x]));return c&&c.appendChild(p),p}const ve=typeof document<"u"?document.documentElement&&document.documentElement.style:null,we=ve&&ve.userSelect!==void 0?"userSelect":"WebkitUserSelect";let Pe;function Ze(){ve&&we&&(Pe=ve[we],ve[we]="none")}function $e(){ve&&we&&(ve[we]=Pe)}function xt(g){g.preventDefault(),g.stopPropagation(),window.removeEventListener("click",xt,!0)}function Ct(){window.addEventListener("click",xt,!0),window.setTimeout((()=>{window.removeEventListener("click",xt,!0)}),0)}function Ft(g,i){const c=g.getBoundingClientRect();return pr(g,c,i)}function Yt(g,i){const c=g.getBoundingClientRect(),p=[];for(let x=0;x<i.length;x++)p.push(pr(g,c,i[x]));return p}function hr(g){return/firefox/i.test(navigator.userAgent)&&/macintosh/i.test(navigator.userAgent)&&g.button===2&&g.ctrlKey?0:g.button}function pr(g,i,c){const p=g.offsetWidth===i.width?1:g.offsetWidth/i.width;return new n.P((c.clientX-i.left)*p,(c.clientY-i.top)*p)}const Kr="01",ui="NO_ACCESS_TOKEN";class zi{constructor(i,c,p){this._transformRequestFn=i,this._customAccessToken=c,this._silenceAuthErrors=!!p,this._createSkuToken()}_createSkuToken(){const i=(function(){let c="";for(let p=0;p<10;p++)c+="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ"[Math.floor(62*Math.random())];return{token:["1",Kr,c].join(""),tokenExpiresAt:Date.now()+432e5}})();this._skuToken=i.token,this._skuTokenExpiresAt=i.tokenExpiresAt}_isSkuTokenExpired(){return Date.now()>this._skuTokenExpiresAt}transformRequest(i,c){return this._transformRequestFn&&this._transformRequestFn(i,c)||{url:i}}normalizeStyleURL(i,c){if(!n.h(i))return i;const p=Ot(i);return p.params.push(`sdk=js-${C}`),p.path=`/styles/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeGlyphsURL(i,c){if(!n.h(i))return i;const p=Ot(i);return p.path=`/fonts/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeModelURL(i,c){if(!n.h(i))return i;const p=Ot(i);return p.path=`/models/v1${p.path}`,this._makeAPIURL(p,this._customAccessToken||c)}normalizeSourceURL(i,c,p,x){if(!n.h(i))return i;const w=Ot(i);return w.path=`/v4/${w.authority}.json`,w.params.push("secure"),p&&w.params.push(`language=${p}`),x&&w.params.push(`worldview=${x}`),this._makeAPIURL(w,this._customAccessToken||c)}normalizeIconsetURL(i,c){const p=Ot(i);return n.h(i)?(p.path=`/styles/v1${p.path}/iconset.pbf`,this._makeAPIURL(p,this._customAccessToken||c)):sr(p)}normalizeSpriteURL(i,c,p,x){const w=Ot(i);return n.h(i)?(w.path=`/styles/v1${w.path}/sprite${c}${p}`,this._makeAPIURL(w,this._customAccessToken||x)):(w.path+=`${c}${p}`,sr(w))}normalizeTileURL(i,c,p){if(this._isSkuTokenExpired()&&this._createSkuToken(),i&&!n.h(i))return i;const x=Ot(i);x.path=x.path.replace(/(\.(png|jpg)\d*)(?=$)/,`${c||p&&x.authority!=="raster"&&p===512?"@2x":""}${n.k.supported?".webp":"$1"}`),x.authority==="raster"?x.path=`/${n.e.RASTER_URL_PREFIX}${x.path}`:x.authority==="rasterarrays"?x.path=`/${n.e.RASTERARRAYS_URL_PREFIX}${x.path}`:x.authority==="3dtiles"?x.path=`/${n.e.TILES3D_URL_PREFIX}${x.path}`:(x.path=x.path.replace(/^.+\/v4\//,"/"),x.path=`/${n.e.TILE_URL_VERSION}${x.path}`);const w=this._customAccessToken||(function(A){for(const I of A){const O=I.match(/^access_token=(.*)$/);if(O)return O[1]}return null})(x.params)||n.e.ACCESS_TOKEN;return n.e.REQUIRE_ACCESS_TOKEN&&w&&this._skuToken&&x.params.push(`sku=${this._skuToken}`),this._makeAPIURL(x,w)}canonicalizeTileURL(i,c){const p=Ot(i);if(!p.path.match(/^(\/v4\/|\/(raster|rasterarrays)\/v1\/)/)||!p.path.match(/\.[\w]+$/))return i;let x="mapbox://";p.path.match(/^\/raster\/v1\//)?x+=`raster/${p.path.replace(`/${n.e.RASTER_URL_PREFIX}/`,"")}`:p.path.match(/^\/rasterarrays\/v1\//)?x+=`rasterarrays/${p.path.replace(`/${n.e.RASTERARRAYS_URL_PREFIX}/`,"")}`:x+=`tiles/${p.path.replace(`/${n.e.TILE_URL_VERSION}/`,"")}`;let w=p.params;return c&&(w=w.filter((A=>!A.match(/^access_token=/)))),w.length&&(x+=`?${w.join("&")}`),x}canonicalizeTileset(i,c){const p=!!c&&n.h(c),x=[];for(const w of i.tiles||[])n.j(w)?x.push(this.canonicalizeTileURL(w,p)):x.push(w);return x}_makeAPIURL(i,c){const p="See https://docs.mapbox.com/api/overview/#access-tokens-and-token-scopes",x=Ot(n.e.API_URL);if(i.protocol=x.protocol,i.authority=x.authority,i.protocol==="http"){const w=i.params.indexOf("secure");w>=0&&i.params.splice(w,1)}if(x.path!=="/"&&(i.path=`${x.path}${i.path}`),!n.e.REQUIRE_ACCESS_TOKEN)return sr(i);if(c=c||n.e.ACCESS_TOKEN,!this._silenceAuthErrors){if(!c)throw new Error(`An API access token is required to use Mapbox GL. ${p}`);if(c[0]==="s")throw new Error(`Use a public access token (pk.*) with Mapbox GL, not a secret access token (sk.*). ${p}`)}return i.params=i.params.filter((w=>w.indexOf("access_token")===-1)),i.params.push(`access_token=${c||""}`),sr(i)}}const Qr=/^(\w+):\/\/([^/?]*)(\/[^?]+)?\??(.+)?/;function Ot(g){const i=g.match(Qr);if(!i)throw new Error("Unable to parse URL object");return{protocol:i[1],authority:i[2],path:i[3]||"/",params:i[4]?i[4].split("&"):[]}}function sr(g){const i=g.params.length?`?${g.params.join("&")}`:"";return`${g.protocol}://${g.authority}${g.path}${i}`}const Fr="mapbox.eventData";function Pi(g){if(!g)return null;const i=g.split(".");if(!i||i.length!==3)return null;try{return JSON.parse(n.l(i[1]))}catch{return null}}class it{constructor(i){this.type=i,this.anonId=null,this.eventData={},this.queue=[],this.pendingRequest=null}getStorageKey(i){const c=Pi(n.e.ACCESS_TOKEN);let p="";return p=c&&c.u?n.f(c.u):n.e.ACCESS_TOKEN||"",i?`${Fr}.${i}:${p}`:`${Fr}:${p}`}fetchEventData(){const i=n.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid");if(i)try{const x=localStorage.getItem(c);x&&(this.eventData=JSON.parse(x));const w=localStorage.getItem(p);w&&(this.anonId=w)}catch{n.w("Unable to read from LocalStorage")}}saveEventData(){const i=n.s("localStorage"),c=this.getStorageKey(),p=this.getStorageKey("uuid"),x=this.anonId;if(i&&x)try{localStorage.setItem(p,x),Object.keys(this.eventData).length>=1&&localStorage.setItem(c,JSON.stringify(this.eventData))}catch{n.w("Unable to write to LocalStorage")}}processRequests(i){}postEvent(i,c,p,x){if(!n.e.EVENTS_URL)return;const w=Ot(n.e.EVENTS_URL);w.params.push(`access_token=${x||n.e.ACCESS_TOKEN||""}`);const A={event:this.type,created:new Date(i).toISOString()},I=c?Object.assign(A,c):A,O={url:sr(w),headers:{"Content-Type":"text/plain"},body:JSON.stringify([I])};this.pendingRequest=n.p(O,(z=>{this.pendingRequest=null,p(z),this.saveEventData(),this.processRequests(x)}))}queueRequest(i,c){this.queue.push(i),this.processRequests(c)}}const Vt=new class extends it{constructor(g){super("appUserTurnstile"),this._customAccessToken=g}postTurnstileEvent(g,i){n.e.EVENTS_URL&&n.e.ACCESS_TOKEN&&Array.isArray(g)&&g.some((c=>n.h(c)||n.j(c)))&&this.queueRequest(Date.now(),i)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;this.anonId&&this.eventData.lastSuccess&&this.eventData.tokenU||this.fetchEventData();const i=Pi(n.e.ACCESS_TOKEN),c=i?i.u:n.e.ACCESS_TOKEN;let p=c!==this.eventData.tokenU;n.v(this.anonId)||(this.anonId=n.u(),p=!0);const x=this.queue.shift();if(this.eventData.lastSuccess){const w=new Date(this.eventData.lastSuccess),A=new Date(x),I=(x-this.eventData.lastSuccess)/864e5;p=p||I>=1||I<-1||w.getDate()!==A.getDate()}else p=!0;p?this.postEvent(x,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Kr,"enabled.telemetry":!1,userId:this.anonId},(w=>{w||(this.eventData.lastSuccess=x,this.eventData.tokenU=c)}),g):this.processRequests()}},Er=Vt.postTurnstileEvent.bind(Vt),Rr=new class extends it{constructor(){super("map.load"),this.success={},this.skuToken=""}postMapLoadEvent(g,i,c,p){this.skuToken=i,this.errorCb=p,n.e.EVENTS_URL&&(c||n.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},c):this.errorCb(new Error(ui)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||(this.anonId||this.fetchEventData(),n.v(this.anonId)||(this.anonId=n.u()),this.postEvent(c,{sdkIdentifier:"mapbox-gl-js",sdkVersion:C,skuId:Kr,skuToken:this.skuToken,userId:this.anonId},(p=>{p?this.errorCb(p):i&&(this.success[i]=!0)}),g))}remove(){this.errorCb=null}},oi=Rr.postMapLoadEvent.bind(Rr),Gi=new class extends it{constructor(){super("style.load"),this.eventIdPerMapInstanceMap=new Map,this.mapInstanceIdMap=new WeakMap}getMapInstanceId(g){let i=this.mapInstanceIdMap.get(g);return i||(i=n.u(),this.mapInstanceIdMap.set(g,i)),i}getEventId(g){const i=this.eventIdPerMapInstanceMap.get(g)||0;return this.eventIdPerMapInstanceMap.set(g,i+1),i}postStyleLoadEvent(g,i){const{map:c,style:p,importedStyles:x}=i;if(!n.e.EVENTS_URL||!g&&!n.e.ACCESS_TOKEN)return;const w=this.getMapInstanceId(c),A={mapInstanceId:w,eventId:this.getEventId(w),style:p};x.length&&(A.importedStyles=x),this.queueRequest({timestamp:Date.now(),payload:A},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,payload:c}=this.queue.shift();this.postEvent(i,c,(()=>{}),g)}},Cr=Gi.postStyleLoadEvent.bind(Gi),Vi=new class extends it{constructor(){super("gljs.performance")}postPerformanceEvent(g,i){n.e.EVENTS_URL&&(g||n.e.ACCESS_TOKEN)&&this.queueRequest({timestamp:Date.now(),performanceData:i},g)}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{timestamp:i,performanceData:c}=this.queue.shift(),p=(function(x){const w=performance.getEntriesByType("resource"),A=performance.getEntriesByType("mark"),I=(function(X){const Y={};if(X){for(const W in X)if(W!=="other")for(const re of X[W]){const K=`${W}ResolveRangeMin`,ae=`${W}ResolveRangeMax`,ue=`${W}RequestCount`,fe=`${W}RequestCachedCount`;Y[K]=Math.min(Y[K]||1/0,re.startTime),Y[ae]=Math.max(Y[ae]||-1/0,re.responseEnd);const xe=ge=>{Y[ge]===void 0&&(Y[ge]=0),++Y[ge]};re.transferSize!==void 0&&re.transferSize===0&&xe(fe),xe(ue)}}return Y})((function(X,Y){const W={};if(X)for(const re of X){const K=Y(re);W[K]===void 0&&(W[K]=[]),W[K].push(re)}return W})(w,U)),O=window.devicePixelRatio,z=navigator.connection||navigator.mozConnection||navigator.webkitConnection,k=z?z.effectiveType:void 0,H={counters:[],metadata:[],attributes:[]},V=(X,Y,W)=>{W!=null&&X.push({name:Y,value:W.toString()})};for(const X in I)V(H.counters,X,I[X]);if(x.interactionRange[0]!==1/0&&x.interactionRange[1]!==-1/0&&(V(H.counters,"interactionRangeMin",x.interactionRange[0]),V(H.counters,"interactionRangeMax",x.interactionRange[1])),A)for(const X of Object.keys(D)){const Y=D[X],W=A.find((re=>re.name===Y));W&&V(H.counters,Y,W.startTime)}return V(H.counters,"visibilityHidden",x.visibilityHidden),V(H.attributes,"style",(function(X){if(X)for(const Y of X){const W=Y.name.split("?")[0];if(n.i(W)){const re=W.split("/").slice(-2);if(re.length===2)return`mapbox://styles/${re[0]}/${re[1]}`}}})(w)),V(H.attributes,"terrainEnabled",x.terrainEnabled?"true":"false"),V(H.attributes,"fogEnabled",x.fogEnabled?"true":"false"),V(H.attributes,"projection",x.projection),V(H.attributes,"zoom",x.zoom),V(H.metadata,"devicePixelRatio",O),V(H.metadata,"connectionEffectiveType",k),V(H.metadata,"navigatorUserAgent",navigator.userAgent),V(H.metadata,"screenWidth",window.screen.width),V(H.metadata,"screenHeight",window.screen.height),V(H.metadata,"windowWidth",window.innerWidth),V(H.metadata,"windowHeight",window.innerHeight),V(H.metadata,"mapWidth",x.width/O),V(H.metadata,"mapHeight",x.height/O),V(H.metadata,"webglRenderer",x.renderer),V(H.metadata,"webglVendor",x.vendor),V(H.metadata,"sdkVersion",C),V(H.metadata,"sdkIdentifier","mapbox-gl-js"),H})(c);for(const x of p.metadata);for(const x of p.counters);for(const x of p.attributes);this.postEvent(i,p,(()=>{}),g)}},vi=Vi.postPerformanceEvent.bind(Vi),ho=new class extends it{constructor(){super("map.auth"),this.success={},this.skuToken=""}getSession(g,i,c,p){if(!n.e.API_URL||!n.e.SESSION_PATH)return;const x=Ot(n.e.API_URL+n.e.SESSION_PATH);x.params.push(`sku=${i||""}`),x.params.push(`access_token=${p||n.e.ACCESS_TOKEN||""}`);const w={url:sr(x),headers:{"Content-Type":"text/plain"}};this.pendingRequest=n.g(w,(A=>{this.pendingRequest=null,c(A),this.saveEventData(),this.processRequests(p)}))}getSessionAPI(g,i,c,p){this.skuToken=i,this.errorCb=p,n.e.SESSION_PATH&&n.e.API_URL&&(c||n.e.ACCESS_TOKEN?this.queueRequest({id:g,timestamp:Date.now()},c):this.errorCb(new Error(ui)))}processRequests(g){if(this.pendingRequest||this.queue.length===0)return;const{id:i,timestamp:c}=this.queue.shift();i&&this.success[i]||this.getSession(c,this.skuToken,(p=>{p?this.errorCb(p):i&&(this.success[i]=!0)}),g)}remove(){this.errorCb=null}},Tn=ho.getSessionAPI.bind(ho),qs=new Set;function gl(g,i){i?qs.add(g):qs.delete(g)}class zu{constructor(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps=new Set,this._updatedImages={}}isDirty(){return this._changed}setDirty(){this._changed=!0}getUpdatedSourceCaches(){return this._updatedSourceCaches}updateSourceCache(i,c){this._updatedSourceCaches[i]=c,this.setDirty()}discardSourceCacheUpdate(i){delete this._updatedSourceCaches[i]}updateLayer(i){const c=i.scope;this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._updatedLayers[c].add(i.id),this.setDirty()}removeLayer(i){const c=i.scope;this._removedLayers[c]=this._removedLayers[c]||{},this._updatedLayers[c]=this._updatedLayers[c]||new Set,this._removedLayers[c][i.id]=i,this._updatedLayers[c].delete(i.id),this._updatedPaintProps.delete(i.fqid),this.setDirty()}getRemovedLayer(i){return this._removedLayers[i.scope]?this._removedLayers[i.scope][i.id]:null}discardLayerRemoval(i){this._removedLayers[i.scope]&&delete this._removedLayers[i.scope][i.id]}getLayerUpdatesByScope(){const i={};for(const c in this._updatedLayers)i[c]=i[c]||{},i[c].updatedIds=Array.from(this._updatedLayers[c].values());for(const c in this._removedLayers)i[c]=i[c]||{},i[c].removedIds=Object.keys(this._removedLayers[c]);return i}getUpdatedPaintProperties(){return this._updatedPaintProps}updatePaintProperties(i){this._updatedPaintProps.add(i.fqid),this.setDirty()}getUpdatedImages(i){return this._updatedImages[i]?Array.from(this._updatedImages[i].values()):[]}updateImage(i,c){this._updatedImages[c]=this._updatedImages[c]||new Set,this._updatedImages[c].add(n.I.toString(i)),this.setDirty()}resetUpdatedImages(i){this._updatedImages[i]&&this._updatedImages[i].clear()}reset(){this._changed=!1,this._updatedLayers={},this._removedLayers={},this._updatedSourceCaches={},this._updatedPaintProps.clear(),this._updatedImages={}}}function Va(g){const{userImage:i}=g;return!!(i&&i.render&&i.render())&&(g.data.replace(new Uint8Array(i.data.buffer)),!0)}class On extends n.E{constructor(i){super(),this.imageProviders=new Map,this.images=new Map,this.updatedImages=new Map,this.callbackDispatchedThisFrame=new Map,this.loaded=new Map,this.requestors=[],this.patterns=new Map,this.patternsInFlight=new Set,this.atlasImage=new Map,this.atlasTexture=new Map,this.dirty=!0,this.spriteFormat=i,i!=="raster"&&n.r()&&(this.imageRasterizerDispatcher=new n.D(n.t(),this,"Image Rasterizer Worker",1))}addScope(i){this.loaded.set(i,!1),this.imageProviders.set(i,new Map),this.images.set(i,new Map),this.updatedImages.set(i,new Set),this.callbackDispatchedThisFrame.set(i,new Set),this.patterns.set(i,new Map),this.atlasImage.set(i,new n.q({width:1,height:1}))}removeScope(i){this.loaded.delete(i),this.imageProviders.delete(i),this.images.delete(i),this.updatedImages.delete(i),this.callbackDispatchedThisFrame.delete(i),this.patterns.delete(i),this.atlasImage.delete(i);const c=this.atlasTexture.get(i);c&&(c.destroy(),this.atlasTexture.delete(i))}addImageProvider(i,c){this.imageProviders.has(c)||this.imageProviders.set(c,new Map),this.imageProviders.get(c).set(i.id,i)}removeImageProvider(i,c){this.imageProviders.has(c)&&this.imageProviders.get(c).delete(i)}getPendingImageProviders(){const i=[];for(const c of this.imageProviders.values())for(const p of c.values())p.hasPendingRequests()&&i.push(p);return i}get imageRasterizer(){return this._imageRasterizer||(this._imageRasterizer=new n.x),this._imageRasterizer}isLoaded(){for(const i of this.loaded.keys())if(!this.loaded.get(i))return!1;return!0}setLoaded(i,c){if(this.loaded.get(c)!==i&&(this.loaded.set(c,i),i)){for(const{ids:p,callback:x}of this.requestors)this._notify(p,c,x);this.requestors=[]}}hasImage(i,c){return!!this.getImage(i,c)}getImage(i,c){return this.images.get(c).get(i.toString())}addImage(i,c,p){this._validate(i,p)&&this.images.get(c).set(i.toString(),p)}_validate(i,c){let p=!0;return this._validateStretch(c.stretchX,c.data&&c.data.width)||(this.fire(new n.y(new Error(`Image "${i.name}" has invalid "stretchX" value`))),p=!1),this._validateStretch(c.stretchY,c.data&&c.data.height)||(this.fire(new n.y(new Error(`Image "${i.name}" has invalid "stretchY" value`))),p=!1),this._validateContent(c.content,c)||(this.fire(new n.y(new Error(`Image "${i.name}" has invalid "content" value`))),p=!1),p}_validateStretch(i,c){if(!i)return!0;let p=0;for(const x of i){if(x[0]<p||x[1]<x[0]||c<x[1])return!1;p=x[1]}return!0}_validateContent(i,c){return i?i.length!==4||!c.usvg&&(i[0]<0||c.data.width<i[0]||i[1]<0||c.data.height<i[1]||i[2]<0||c.data.width<i[2]||i[3]<0||c.data.height<i[3])?!1:!(i[2]<i[0]||i[3]<i[1]):!0}updateImage(i,c,p){const x=this.images.get(c).get(i.toString());p.version=x.version+1,this.images.get(c).set(i.toString(),p),this.updatedImages.get(c).add(i),this.removeFromImageRasterizerCache(i,c)}clearUpdatedImages(i){this.updatedImages.get(i).clear()}removeFromImageRasterizerCache(i,c){this.spriteFormat!=="raster"&&(n.r()?this.imageRasterizerDispatcher.getActor().send("removeRasterizedImages",{imageIds:[i],scope:c}):this.imageRasterizer.removeImagesFromCacheByIds([i],c))}removeImage(i,c){const p=this.images.get(c),x=p.get(i.toString());p.delete(i.toString()),this.patterns.get(c).delete(i.toString()),this.removeFromImageRasterizerCache(i,c),x.userImage&&x.userImage.onRemove&&x.userImage.onRemove()}listImages(i){return Array.from(this.images.get(i).keys()).map((c=>n.I.from(c)))}getImages(i,c,p){const x=[],w=[],A=this.imageProviders.get(c);for(const k of i){if(!k.iconsetId){x.push(k);continue}const H=A.get(k.iconsetId);H&&(this.getImage(k,c)?w.push(k):H.addPendingRequest(k))}if(x.length===0)return void this._notify(w,c,p);let I=!0;const O=!!this.loaded.get(c),z=this.images.get(c);if(!O)for(const k of x)z.has(k.toString())||(I=!1);O||I?this._notify(x,c,p):this.requestors.push({ids:x,scope:c,callback:p})}rasterizeImages(i,c){const p=new Map,{tasks:x,scope:w}=i;for(const[A,I]of x.entries()){const O=this.getImage(I.id,w);O&&p.set(A,{image:O,imageVariant:I})}this._rasterizeImages(w,p,c)}_rasterizeImages(i,c,p){if(n.r())this.imageRasterizerDispatcher.getActor().send("rasterizeImagesWorker",{tasks:c,scope:i},p);else{const x=new Map;for(const[w,{image:A,imageVariant:I}]of c.entries())x.set(w,this.imageRasterizer.rasterize(I,A,i,0));p(void 0,x)}}getUpdatedImages(i){return this.updatedImages.get(i)||new Set}_notify(i,c,p){const x=this.images.get(c),w=new Map;for(const A of i){if(!x.get(A.toString())){if(A.iconsetId)continue;this.fire(new n.z("styleimagemissing",{id:A.name}))}const I=x.get(A.toString());if(!I){n.w(`Image "${A.name}" could not be loaded. Please make sure you have added the image with map.addImage() or a "sprite" property in your style. You can provide missing images by listening for the "styleimagemissing" map event.`);continue}const O={data:I.usvg?null:I.data.clone(),pixelRatio:I.pixelRatio,sdf:I.sdf,usvg:I.usvg,version:I.version,stretchX:I.stretchX,stretchY:I.stretchY,content:I.content,hasRenderCallback:!!(I.userImage&&I.userImage.render)};I.usvg&&Object.assign(O,{width:I.icon.usvg_tree.width,height:I.icon.usvg_tree.height}),w.set(n.I.toString(A),O)}p(null,w)}getPixelSize(i){const{width:c,height:p}=this.atlasImage.get(i);return{width:c,height:p}}getPattern(i,c,p){const x=i.toString(),w=this.patterns.get(c),A=w.get(x),I=this.getImage(i,c);if(!I)return null;if(A){if(A.position.version===I.version)return A.position;A.position.version=I.version}else{if(I.usvg&&!I.data){const O=this.getPatternInFlightId(x,c);if(this.patternsInFlight.has(O))return null;this.patternsInFlight.add(O);const z=new n.A(i).scaleSelf(n.o.devicePixelRatio),k=new Map([[z.toString(),{image:I,imageVariant:z}]]);return this._rasterizeImages(c,k,((H,V)=>this.storePatternImage(z,c,I,p,V))),null}this.storePattern(i,c,I)}return this._updatePatternAtlas(c,p),w.get(x).position}getPatternInFlightId(i,c){return n.B(i,c)}hasPatternsInFlight(){return this.patternsInFlight.size!==0}storePatternImage(i,c,p,x,w){const A=i.toString(),I=w?w.get(A):void 0;I&&(p.data=I,this.storePattern(i.id,c,p),this._updatePatternAtlas(c,x),this.patternsInFlight.delete(this.getPatternInFlightId(i.id.toString(),c)))}storePattern(i,c,p){const x={w:p.data.width+2*n.C,h:p.data.height+2*n.C,x:0,y:0},w=new n.F(x,p,n.C);this.patterns.get(c).set(i.toString(),{bin:x,position:w})}destroyAtlasTextures(){for(const i of this.atlasTexture.values())i&&i.destroy();this.atlasTexture.clear()}bind(i,c){const p=i.gl;let x=this.atlasTexture.get(c);x?this.dirty&&(x.update(this.atlasImage.get(c)),this.dirty=!1):(x=new n.T(i,this.atlasImage.get(c),p.RGBA8),this.atlasTexture.set(c,x)),x.bind(p.LINEAR,p.CLAMP_TO_EDGE)}_updatePatternAtlas(i,c){const p=this.patterns.get(i),x=Array.from(p.values()).map((({bin:z})=>z)),{w,h:A}=n.G(x),I=this.atlasImage.get(i);I.resize({width:w||1,height:A||1});const O=this.images.get(i);for(const[z,{bin:k,position:H}]of p.entries()){let V=H.padding;const X=k.x+V,Y=k.y+V,W=O.get(z).data,re=W.width,K=W.height;V=V>1?V-1:V,n.q.copy(W,I,{x:0,y:0},{x:X,y:Y},{width:re,height:K},c),n.q.copy(W,I,{x:0,y:K-V},{x:X,y:Y-V},{width:re,height:V},c),n.q.copy(W,I,{x:0,y:0},{x:X,y:Y+K},{width:re,height:V},c),n.q.copy(W,I,{x:re-V,y:0},{x:X-V,y:Y},{width:V,height:K},c),n.q.copy(W,I,{x:0,y:0},{x:X+re,y:Y},{width:V,height:K},c),n.q.copy(W,I,{x:re-V,y:K-V},{x:X-V,y:Y-V},{width:V,height:V},c),n.q.copy(W,I,{x:0,y:K-V},{x:X+re,y:Y-V},{width:V,height:V},c),n.q.copy(W,I,{x:0,y:0},{x:X+re,y:Y+K},{width:V,height:V},c),n.q.copy(W,I,{x:re-V,y:0},{x:X-V,y:Y+K},{width:V,height:V},c)}this.dirty=!0}beginFrame(){for(const i of this.images.keys())this.callbackDispatchedThisFrame.set(i,new Set)}dispatchRenderCallbacks(i,c){const p=this.images.get(c);for(const x of i){if(this.callbackDispatchedThisFrame.get(c).has(x.toString()))continue;this.callbackDispatchedThisFrame.get(c).add(x.toString());const w=p.get(x.toString());Va(w)&&this.updateImage(x,c,w)}}destroy(){this.imageRasterizerDispatcher&&this.imageRasterizerDispatcher.remove()}}function Mf(g){const i=g.value,c=g.valueSpec,p=g.style,x=g.styleSpec,w=g.key,A=g.arrayElementValidator||gn;if(!Array.isArray(i))return[new n.V(w,i,`array expected, ${n.K(i)} found`)];if(c.length&&i.length!==c.length)return[new n.V(w,i,`array length ${c.length} expected, length ${i.length} found`)];if(c["min-length"]&&i.length<c["min-length"])return[new n.V(w,i,`array length at least ${c["min-length"]} expected, length ${i.length} found`)];let I={type:c.value,values:c.values,minimum:c.minimum,maximum:c.maximum,function:void 0};x.$version<7&&(I.function=c.function),n.H(c.value)&&(I=c.value);let O=[];for(let z=0;z<i.length;z++)O=O.concat(A({array:i,arrayIndex:z,value:i[z],valueSpec:I,style:p,styleSpec:x,key:`${w}[${z}]`},!0));return O}function Zo(g){const i=g.key,c=g.value,p=g.valueSpec;if(!n.L(c))return[new n.V(i,c,`number expected, ${n.K(c)} found`)];if(c!=c)return[new n.V(i,c,"number expected, NaN found")];if("minimum"in p){let x=p.minimum;if(Array.isArray(p.minimum)&&(x=p.minimum[g.arrayIndex]),c<x)return[new n.V(i,c,`${c} is less than the minimum value ${x}`)]}if("maximum"in p){let x=p.maximum;if(Array.isArray(p.maximum)&&(x=p.maximum[g.arrayIndex]),c>x)return[new n.V(i,c,`${c} is greater than the maximum value ${x}`)]}return[]}function Df(g){const i=g.key,c=g.value;if(!n.H(c))return[new n.V(i,c,`object expected, ${n.K(c)} found`)];const p=g.valueSpec,x=n.J(c.type);let w,A,I,O={};const z=x!=="categorical"&&c.property===void 0,k=!z,H=(function(W){const re=W.stops;return Array.isArray(re)&&Array.isArray(re[0])&&n.H(re[0][0])})(c),V=xo({key:g.key,value:g.value,valueSpec:g.styleSpec.function,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{stops:function(W){if(x==="identity")return[new n.V(W.key,W.value,'identity function may not have a "stops" property')];let re=[];const K=W.value;return re=re.concat(Mf({key:W.key,value:K,valueSpec:W.valueSpec,style:W.style,styleSpec:W.styleSpec,arrayElementValidator:X})),Array.isArray(K)&&K.length===0&&re.push(new n.V(W.key,K,"array must have at least one stop")),re},default:function(W){return gn({key:W.key,value:W.value,valueSpec:p,style:W.style,styleSpec:W.styleSpec})}}});return x==="identity"&&z&&V.push(new n.V(g.key,g.value,'missing required property "property"')),x==="identity"||c.stops||V.push(new n.V(g.key,g.value,'missing required property "stops"')),x==="exponential"&&p.expression&&!n.M(p)&&V.push(new n.V(g.key,g.value,"exponential functions not supported")),g.styleSpec.$version>=8&&(k&&!n.N(p)?V.push(new n.V(g.key,g.value,"property functions not supported")):z&&!n.O(p)&&V.push(new n.V(g.key,g.value,"zoom functions not supported"))),x!=="categorical"&&!H||c.property!==void 0||V.push(new n.V(g.key,g.value,'"property" property is required')),V;function X(W){let re=[];const K=W.value,ae=W.key;if(!Array.isArray(K))return[new n.V(ae,K,`array expected, ${n.K(K)} found`)];if(K.length!==2)return[new n.V(ae,K,`array length 2 expected, length ${K.length} found`)];if(H){if(!n.H(K[0]))return[new n.V(ae,K,`object expected, ${n.K(K[0])} found`)];const ue=K[0];if(ue.zoom===void 0)return[new n.V(ae,K,"object stop key must have zoom")];if(ue.value===void 0)return[new n.V(ae,K,"object stop key must have value")];const fe=n.J(ue.zoom);if(typeof fe!="number")return[new n.V(ae,ue.zoom,"stop zoom values must be numbers")];if(I&&I>fe)return[new n.V(ae,ue.zoom,"stop zoom values must appear in ascending order")];fe!==I&&(I=fe,A=void 0,O={}),re=re.concat(xo({key:`${ae}[0]`,value:K[0],valueSpec:{zoom:{}},style:W.style,styleSpec:W.styleSpec,objectElementValidators:{zoom:Zo,value:Y}}))}else re=re.concat(Y({key:`${ae}[0]`,value:K[0],style:W.style,styleSpec:W.styleSpec},K));return n.Q(n.S(K[1]))?re.concat([new n.V(`${ae}[1]`,K[1],"expressions are not allowed in function stops.")]):re.concat(gn({key:`${ae}[1]`,value:K[1],valueSpec:p,style:W.style,styleSpec:W.styleSpec}))}function Y(W,re){const K=n.K(W.value),ae=n.J(W.value),ue=W.value!==null?W.value:re;if(w){if(K!==w)return[new n.V(W.key,ue,`${K} stop domain type must match previous stop domain type ${w}`)]}else w=K;if(K!=="number"&&K!=="string"&&K!=="boolean"&&typeof ae!="number"&&typeof ae!="string"&&typeof ae!="boolean")return[new n.V(W.key,ue,"stop domain value must be a number, string, or boolean")];if(K!=="number"&&x!=="categorical"){let fe=`number expected, ${K} found`;return n.N(p)&&x===void 0&&(fe+='\nIf you intended to use a categorical function, specify `"type": "categorical"`.'),[new n.V(W.key,ue,fe)]}return x!=="categorical"||K!=="number"||typeof ae=="number"&&isFinite(ae)&&Math.floor(ae)===ae?x!=="categorical"&&K==="number"&&typeof ae=="number"&&typeof A=="number"&&A!==void 0&&ae<A?[new n.V(W.key,ue,"stop domain values must appear in ascending order")]:(A=ae,x==="categorical"&&ae in O?[new n.V(W.key,ue,"stop domain values must be unique")]:(O[ae]=!0,[])):[new n.V(W.key,ue,`integer expected, found ${String(ae)}`)]}}function na(g){const i=(g.expressionContext==="property"?n.W:n.U)(n.S(g.value),g.valueSpec);if(i.result==="error")return i.value.map((p=>new n.V(`${g.key}${p.key}`,g.value,p.message)));const c=i.value.expression||i.value._styleExpression.expression;if(g.expressionContext==="property"&&g.propertyKey==="text-font"&&!c.outputDefined())return[new n.V(g.key,g.value,`Invalid data expression for "${g.propertyKey}". Output values must be contained as literals within the expression.`)];if(g.expressionContext==="property"&&g.propertyType==="layout"&&!n.Z(c))return[new n.V(g.key,g.value,'"feature-state" data expressions are not supported with layout properties.')];if(g.expressionContext==="filter")return Zl(c,g);if(g.expressionContext==="appearance")return Wo(c,g);if(g.expressionContext&&g.expressionContext.indexOf("cluster")===0){if(!n.X(c,["zoom","feature-state"]))return[new n.V(g.key,g.value,'"zoom" and "feature-state" expressions are not supported with cluster properties.')];if(g.expressionContext==="cluster-initial"&&!n.Y(c))return[new n.V(g.key,g.value,"Feature data expressions are not supported with initial expression part of cluster properties.")]}return[]}function Zl(g,i){const c=new Set(["zoom","feature-state","pitch","distance-from-center"]);if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)c.delete(x);if(c.size===0)return[];const p=[];return g instanceof n._&&c.has(g.name)?[new n.V(i.key,i.value,`["${g.name}"] expression is not supported in a filter for a ${i.object.type} layer with id: ${i.object.id}`)]:(g.eachChild((x=>{p.push(...Zl(x,i))})),p)}function Wo(g,i){const c=new Set;if(i.valueSpec&&i.valueSpec.expression)for(const x of i.valueSpec.expression.parameters)c.add(x);if(c.size===0)return[];const p=[];return g instanceof n._&&!c.has(g.name)?[new n.V(i.key,i.value,`["${g.name}"] is not an allowed parameter`)]:(g.eachChild((x=>{p.push(...Wo(x,i))})),p)}function Wl(g){const i=g.key,c=g.value,p=g.valueSpec,x=[];return Array.isArray(p.values)?p.values.indexOf(n.J(c))===-1&&x.push(new n.V(i,c,`expected one of [${p.values.join(", ")}], ${JSON.stringify(c)} found`)):Object.keys(p.values).indexOf(n.J(c))===-1&&x.push(new n.V(i,c,`expected one of [${Object.keys(p.values).join(", ")}], ${JSON.stringify(c)} found`)),x}function _l(g){return n.a2(n.S(g.value))?na(Object.assign({},g,{expressionContext:"filter",valueSpec:g.styleSpec[`filter_${g.layerType||"fill"}`]})):Fu(g)}function Fu(g){const i=g.value,c=g.key;if(!Array.isArray(i))return[new n.V(c,i,`array expected, ${n.K(i)} found`)];if(i.length<1)return[new n.V(c,i,"filter array must have at least 1 element")];const p=g.styleSpec;let x=Wl({key:`${c}[0]`,value:i[0],valueSpec:p.filter_operator});switch(n.J(i[0])){case"<":case"<=":case">":case">=":i.length>=2&&n.J(i[1])==="$type"&&x.push(new n.V(c,i,`"$type" cannot be use with operator "${i[0]}"`));case"==":case"!=":i.length!==3&&x.push(new n.V(c,i,`filter array for operator "${i[0]}" must have 3 elements`));case"in":case"!in":i.length>=2&&(n.a0(i[1])||x.push(new n.V(`${c}[1]`,i[1],`string expected, ${n.K(i[1])} found`)));for(let w=2;w<i.length;w++)n.J(i[1])==="$type"?x=x.concat(Wl({key:`${c}[${w}]`,value:i[w],valueSpec:p.geometry_type})):n.a0(i[w])||n.L(i[w])||n.$(i[w])||x.push(new n.V(`${c}[${w}]`,i[w],`string, number, or boolean expected, ${n.K(i[w])} found.`));break;case"any":case"all":case"none":for(let w=1;w<i.length;w++)x=x.concat(Fu({key:`${c}[${w}]`,value:i[w],style:g.style,styleSpec:g.styleSpec}));break;case"has":case"!has":i.length!==2?x.push(new n.V(c,i,`filter array for "${i[0]}" operator must have 2 elements`)):n.a0(i[1])||x.push(new n.V(`${c}[1]`,i[1],`string expected, ${n.K(i[1])} found`))}return x}function ku(g,i){const c=g.key,p=g.style,x=g.layer,w=g.styleSpec,A=g.value,I=g.objectKey,O=w[`${i}_${g.layerType}`];if(!O)return[];const z=I.match(/^(.*)-use-theme$/);if(z&&O[z[1]])return n.Q(A)?[].concat(gn({key:g.key,value:A,valueSpec:{type:"string",expression:{interpolated:!1,parameters:["zoom","feature"]},"property-type":"data-driven"},style:p,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:I})):gn({key:c,value:A,valueSpec:{type:"string"},style:p,styleSpec:w});const k=I.match(/^(.*)-transition$/);if(i==="paint"&&k&&O[k[1]]&&O[k[1]].transition)return gn({key:c,value:A,valueSpec:w.transition,style:p,styleSpec:w});const H=g.valueSpec||O[I];if(!H)return[new n.a3(c,A,`unknown property "${I}"`)];let V;if(n.a0(A)&&n.N(H)&&!H.tokens&&(V=/^{([^}]+)}$/.exec(A))){const Y=`\`{ "type": "identity", "property": ${V?JSON.stringify(V[1]):'"_"'} }\``;return[new n.V(c,A,`"${I}" does not support interpolation syntax
Use an identity property function instead: ${Y}.`)]}const X=[];if(g.layerType==="symbol")I!=="text-field"||!p||p.glyphs||p.imports||X.push(new n.V(c,A,'use of "text-field" requires a style "glyphs" property')),I==="text-font"&&n.a4(n.S(A))&&n.J(A.type)==="identity"&&X.push(new n.V(c,A,'"text-font" does not support identity functions'));else if(g.layerType==="model"&&i==="paint"&&x&&x.layout&&x.layout.hasOwnProperty("model-id")&&n.N(H)&&(n.a5(H)||n.O(H))){const Y=n.W(n.S(A),H),W=Y.value.expression||Y.value._styleExpression.expression;W&&!n.X(W,["measure-light"])&&(I==="model-emissive-strength"&&n.Y(W)&&n.Z(W)||X.push(new n.V(c,A,`${I} does not support measure-light expressions when the model layer source is vector tile or GeoJSON.`)))}return X.concat(gn({key:g.key,value:A,valueSpec:H,style:p,styleSpec:w,expressionContext:"property",propertyType:i,propertyKey:I}))}function Ro(g){return ku(g,"paint")}function $n(g){return ku(g,"layout")}function ys(g){let i=[];const c=g.value,p=g.key,x=g.style,w=g.styleSpec;if(!n.H(c))return[new n.V(p,c,"object expected")];c.type||c.ref||i.push(new n.V(p,c,'either "type" or "ref" is required'));let A=n.J(c.type);const I=n.J(c.ref);if(c.id){const O=n.J(c.id);for(let z=0;z<g.arrayIndex;z++){const k=x.layers[z];n.J(k.id)===O&&i.push(new n.V(p,c.id,`duplicate layer id "${O}", previously used at line ${k.id.__line__}`))}}if("ref"in c){let O;["type","source","source-layer","filter","layout"].forEach((z=>{z in c&&i.push(new n.V(p,c[z],`"${z}" is prohibited for ref layers`))})),x.layers.forEach((z=>{n.J(z.id)===I&&(O=z)})),O?O.ref?i.push(new n.V(p,c.ref,"ref cannot reference another ref layer")):A=n.J(O.type):typeof I=="string"&&i.push(new n.V(p,c.ref,`ref layer "${I}" not found`))}else if(A!=="background"&&A!=="sky"&&A!=="slot")if(c.source)if(n.a0(c.source)){const O=x.sources&&x.sources[c.source],z=O&&n.J(O.type);O?z==="vector"&&A==="raster"?i.push(new n.V(p,c.source,`layer "${c.id}" requires a raster source`)):z==="raster"&&A!=="raster"?i.push(new n.V(p,c.source,`layer "${c.id}" requires a vector source`)):z!=="vector"||c["source-layer"]?z==="raster-dem"&&A!=="hillshade"?i.push(new n.V(p,c.source,"raster-dem source can only be used with layer type 'hillshade'.")):z!=="raster-array"||["raster","raster-particle"].includes(A)?A==="line"&&c.paint&&(c.paint["line-gradient"]||c.paint["line-trim-offset"])&&z==="geojson"&&!O.lineMetrics?i.push(new n.V(p,c,`layer "${c.id}" specifies a line-gradient, which requires the GeoJSON source to have \`lineMetrics\` enabled.`)):A==="raster-particle"&&z!=="raster-array"&&i.push(new n.V(p,c.source,`layer "${c.id}" requires a 'raster-array' source.`)):i.push(new n.V(p,c.source,"raster-array source can only be used with layer type 'raster'.")):i.push(new n.V(p,c,`layer "${c.id}" must specify a "source-layer"`)):i.push(new n.V(p,c.source,`source "${c.source}" not found`))}else i.push(new n.V(`${p}.source`,c.source,'"source" must be a string'));else i.push(new n.V(p,c,'missing required property "source"'));return i=i.concat(xo({key:p,value:c,valueSpec:w.layer,style:g.style,styleSpec:g.styleSpec,objectElementValidators:{"*":()=>[],type:()=>gn({key:`${p}.type`,value:c.type,valueSpec:w.layer.type,style:g.style,styleSpec:g.styleSpec,object:c,objectKey:"type"}),filter:O=>_l(Object.assign({layerType:A},O)),layout:O=>xo({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>$n(Object.assign({layerType:A},z))}}),paint:O=>xo({layer:c,key:O.key,value:O.value,valueSpec:{},style:O.style,styleSpec:O.styleSpec,objectElementValidators:{"*":z=>Ro(Object.assign({layerType:A,layer:c},z))}}),appearances(O){const z=Mf({key:O.key,value:O.value,valueSpec:O.valueSpec,style:O.style,styleSpec:O.styleSpec,arrayElementValidator:V=>(function(X){const{key:Y,layer:W,layerType:re}=X,K=n.J(X.value),ae=n.J(K.name),ue=n.J(K.condition),fe=xo({key:Y,value:K,valueSpec:X.styleSpec.appearance,style:X.style,styleSpec:X.styleSpec,objectElementValidators:{condition:xe=>(function(ge){const Te=[];return Te.push(...na({key:ge.key,value:ge.object.condition,valueSpec:n.a6.appearance.condition,expressionContext:"appearance"})),Te})(Object.assign({layer:W,layerType:re},xe)),properties:xe=>(function(ge){const Te=[],{styleSpec:ye,layer:_e,layerType:Se}=ge,He=ye[`paint_${Se}`],ze=ye[`layout_${Se}`],nt=ge.object[ge.objectKey];for(const Ge in nt){const tt=Ge in He?"paint":Ge in ze?"layout":void 0;if(!tt){Te.push(new n.V(ge.key,Ge,`unknown property "${Ge}" for layer type "${Se}"`));continue}const It=Object.assign({},ge,{key:`${ge.key}.${Ge}`,object:nt,objectKey:Ge,layer:_e,layerType:Se,value:nt[Ge],valueSpec:tt==="paint"?He[Ge]:ze[Ge]});Te.push(...ku(It,tt))}return Te})(Object.assign({layer:W,layerType:re},xe))}});return ae==="hidden"||ue||fe.push(new n.V(X.key,"name",'Appearance with name different than "hidden" must have a condition')),fe})(Object.assign({layerType:A,layer:c},V))}),k=Array.isArray(O.value)?O.value:[],H=new Set;return k.forEach(((V,X)=>{const Y=n.J(V.name);if(Y)if(H.has(Y)){const W=n.J(c.id);z.push(new n.V(O.key,Y,`Duplicated appearance name "${Y}" for layer "${W}"`))}else H.add(Y)})),z}}})),i}function vo({key:g,value:i}){return n.a0(i)?[]:[new n.V(g,i,`string expected, ${n.K(i)} found`)]}const Ah={promoteId:function g({key:i,value:c}){if(n.a0(c))return vo({key:i,value:c});if(Array.isArray(c)){const x=[],w=n.S(c),A=n.U(w);return A.result==="error"&&A.value.forEach((I=>{x.push(new n.V(`${i}${I.key}`,null,`${I.message}`))})),n.X(A.value.expression,["zoom","heatmap-density","line-progress","raster-value","sky-radial-progress","accumulated","is-supported-script","pitch","distance-from-center","measure-light","raster-particle-speed"])||x.push(new n.V(`${i}`,null,"promoteId expression should be only feature dependent")),x}if(!n.H(c))return[new n.V(i,c,`string, expression or object expected, "${n.K(c)}" found`)];const p=[];for(const x in c)p.push(...g({key:`${i}.${x}`,value:c[x]}));return p}};function Mo(g){const i=g.value,c=g.key,p=g.styleSpec,x=g.style;if(!n.H(i))return[new n.V(c,i,`object expected, ${n.K(i)} found`)];if(!("type"in i))return[new n.V(c,i,'"type" is required')];const w=n.J(i.type);let A=[];switch(["vector","raster","raster-dem","raster-array"].includes(w)&&("url"in i||"tiles"in i||A.push(new n.a3(c,i,'Either "url" or "tiles" is required.'))),w){case"vector":case"raster":case"raster-dem":case"raster-array":return A=A.concat(xo({key:c,value:i,valueSpec:p[`source_${w.replace("-","_")}`],style:g.style,styleSpec:p,objectElementValidators:Ah})),A;case"geojson":if(A=xo({key:c,value:i,valueSpec:p.source_geojson,style:x,styleSpec:p,objectElementValidators:Ah}),"cluster"in i&&"clusterProperties"in i){if(!n.H(i.clusterProperties))return[new n.V(`${c}.clusterProperties`,i,`object expected, ${n.K(i)} found`)];for(const I in i.clusterProperties){const O=i.clusterProperties[I];if(!Array.isArray(O))return[new n.V(`${c}.clusterProperties.${I}`,O,"array expected")];const[z,k]=O,H=typeof z=="string"?[z,["accumulated"],["get",I]]:z;A.push(...na({key:`${c}.${I}.map`,value:k,expressionContext:"cluster-map"})),A.push(...na({key:`${c}.${I}.reduce`,value:H,expressionContext:"cluster-reduce"}))}}return A;case"video":return xo({key:c,value:i,valueSpec:p.source_video,style:x,styleSpec:p});case"image":return xo({key:c,value:i,valueSpec:p.source_image,style:x,styleSpec:p});case"canvas":return[new n.V(c,null,"Please use runtime APIs to add canvas sources, rather than including them in stylesheets.","source.canvas")];default:return Wl({key:`${c}.type`,value:i.type,valueSpec:{values:$s(p)}})}}function $s(g){return g.source.reduce(((i,c)=>{const p=g[c];return p.type.type==="enum"&&(i=i.concat(Object.keys(p.type.values))),i}),[])}function Nc(g){const i=g.value,c=g.styleSpec,p=c.light,x=g.style;if(i===void 0)return[];if(!n.H(i))return[new n.V("light",i,`object expected, ${n.K(i)} found`)];let w=[];for(const A in i){const I=A.match(/^(.*)-transition$/),O=A.match(/^(.*)-use-theme$/);w=w.concat(O&&p[O[1]]?gn({key:A,value:i[A],valueSpec:{type:"string"},style:x,styleSpec:c}):I&&p[I[1]]&&p[I[1]].transition?gn({key:A,value:i[A],valueSpec:c.transition,style:x,styleSpec:c}):p[A]?gn({key:A,value:i[A],valueSpec:p[A],style:x,styleSpec:c}):[new n.V(A,i[A],`unknown property "${A}"`)])}return w}function Xs(g){const i=g.value;if(!i)return[];const c=g.key;if(!n.H(i))return[new n.V(c,i,`object expected, ${n.K(i)} found`)];let p=[];const x=g.styleSpec,w=x["light-3d"],A=g.style,I=g.style.lights;for(const k of["type","id"])if(!(k in i))return p=p.concat([new n.V(c,i,`missing property "${k}"`)]),p;if(!n.a0(i.type))return p=p.concat([new n.V(`${c}.type`,i.type,"string expected")]),p;if(I)for(let k=0;k<g.arrayIndex;k++){const H=n.J(i.type),V=I[k];n.J(V.type)===H&&p.push(new n.V(c,i.id,`duplicate light type "${i.type}", previously defined at line ${V.id.__line__}`))}const O=`properties_light_${i.type}`;if(!(O in x))return p=p.concat([new n.V(`${c}.type`,i,`Invalid light type ${i.type}`)]),p;const z=x[O];for(const k in i)if(k==="properties"){const H=i[k];if(!n.H(H))return p=p.concat([new n.V("properties",H,`object expected, ${n.K(H)} found`)]),p;for(const V in H){const X=V.match(/^(.*)-transition$/),Y=V.match(/^(.*)-use-theme$/);p=p.concat(Y&&z[Y[1]]?gn({key:k,value:H[V],valueSpec:{type:"string"},style:A,styleSpec:x}):X&&z[X[1]]&&z[X[1]].transition?gn({key:k,value:i[k],valueSpec:x.transition,style:A,styleSpec:x}):z[V]?gn({key:V,value:H[V],valueSpec:z[V],style:A,styleSpec:x}):[new n.a3(g.key,H[V],`unknown property "${V}"`)])}}else p=p.concat(w[k]?gn({key:k,value:i[k],valueSpec:w[k],style:A,styleSpec:x}):[new n.a3(k,i[k],`unknown property "${k}"`)]);return p}function oa(g){const i=g.value,c=g.key,p=g.style,x=g.styleSpec,w=x.terrain;if(i==null)return[];if(!n.H(i))return[new n.V("terrain",i,`object expected, ${n.K(i)} found`)];let A=[];for(const I in i){const O=I.match(/^(.*)-transition$/),z=I.match(/^(.*)-use-theme$/);A=A.concat(z&&w[z[1]]?gn({key:I,value:i[I],valueSpec:{type:"string"},style:p,styleSpec:x}):O&&w[O[1]]&&w[O[1]].transition?gn({key:I,value:i[I],valueSpec:x.transition,style:p,styleSpec:x}):w[I]?gn({key:I,value:i[I],valueSpec:w[I],style:p,styleSpec:x}):[new n.a3(I,i[I],`unknown property "${I}"`)])}if(i.source)if(n.a0(i.source)){const I=p.sources&&p.sources[i.source],O=I&&n.J(I.type);I?O!=="raster-dem"&&A.push(new n.V(`${c}.source`,i.source,`terrain cannot be used with a source of type ${O}, it only be used with a "raster-dem" source type`)):A.push(new n.V(`${c}.source`,i.source,`source "${i.source}" not found`))}else A.push(new n.V(`${c}.source`,i.source,"source must be a string"));else A.push(new n.V(c,i,'terrain is missing required property "source"'));return A}function vs(g){const i=g.value,c=g.style,p=g.styleSpec,x=p.fog;if(i===void 0)return[];if(!n.H(i))return[new n.V("fog",i,`object expected, ${n.K(i)} found`)];let w=[];for(const A in i){const I=A.match(/^(.*)-transition$/),O=A.match(/^(.*)-use-theme$/);w=w.concat(O&&x[O[1]]?gn({key:A,value:i[A],valueSpec:{type:"string"},style:c,styleSpec:p}):I&&x[I[1]]&&x[I[1]].transition?gn({key:A,value:i[A],valueSpec:p.transition,style:c,styleSpec:p}):x[A]?gn({key:A,value:i[A],valueSpec:x[A],style:c,styleSpec:p}):[new n.a3(A,i[A],`unknown property "${A}"`)])}return w}const Zs={"*":()=>[],array:Mf,boolean:function(g){const i=g.value,c=g.key;return n.$(i)?[]:[new n.V(c,i,`boolean expected, ${n.K(i)} found`)]},number:Zo,color:function({key:g,value:i}){return n.a0(i)?n.a1.parseCSSColor(i)===null?[new n.V(g,i,`color expected, "${i}" found`)]:[]:[new n.V(g,i,`color expected, ${n.K(i)} found`)]},enum:Wl,filter:_l,function:Df,layer:ys,object:xo,source:Mo,model:n.a7,light:Nc,"light-3d":Xs,terrain:oa,fog:vs,string:vo,formatted:function(g){return vo(g).length===0?[]:na(g)},resolvedImage:function(g){return vo(g).length===0?[]:na(g)},projection:function(g){const i=g.value,c=g.styleSpec,p=c.projection,x=g.style;if(n.H(i)){let w=[];for(const A in i)w=w.concat(gn({key:A,value:i[A],valueSpec:p[A],style:x,styleSpec:c}));return w}return n.a0(i)?[]:[new n.V("projection",i,`object or string expected, ${n.K(i)} found`)]},import:function(g){const i=g.key,{value:c,styleSpec:p}=g;if(!n.H(c))return[new n.V(i,c,"import must be an object")];const{data:x,...w}=c;Object.defineProperty(w,"__line__",{value:c.__line__,enumerable:!1});let A=xo(Object.assign({},g,{value:w,valueSpec:p.import}));return n.J(w.id)===""&&A.push(new n.V(`${g.key}.id`,w,"import id can't be an empty string")),x&&(A=A.concat(Yl(x,p,{key:`${g.key}.data`}))),A},iconset:function(g){const i=g.value,c=g.key,p=g.styleSpec,x=g.style;if(!n.H(i))return[new n.V(c,i,"object expected")];if(!i.type)return[new n.V(c,i,'"type" is required')];const w=n.J(i.type);let A=[];if(A=A.concat(xo({key:c,value:i,valueSpec:p[`iconset_${w}`],style:x,styleSpec:p})),(function(I,O){return!(I!=="source"||!O.source)})(w,i)){const I=x.sources&&x.sources[i.source],O=I&&n.J(I.type);I?O!=="raster-array"&&A.push(new n.V(c,i.source,`iconset cannot be used with a source of type ${String(O)}, it only be used with a "raster-array" source type`)):A.push(new n.V(c,i.source,`source "${i.source}" not found`))}return A}};function gn(g,i=!1){const c=g.value,p=g.valueSpec,x=g.styleSpec;if(p.expression){if(n.a4(n.J(c)))return Df(g);if(n.Q(n.S(c)))return na(g)}if(p.type&&Zs[p.type]){const w=Zs[p.type](g);return i===!0&&w.length>0&&Array.isArray(g.value)?na(g):w}return xo(Object.assign({},g,{valueSpec:p.type?x[p.type]:p}))}function xo(g){const i=g.key,c=g.value,p=g.valueSpec||{},x=g.objectElementValidators||{},w=g.style,A=g.styleSpec;if(!n.H(c))return[new n.V(i,c,`object expected, ${n.K(c)} found`)];let I=[];for(const O in c){const z=O.split(".")[0];let k;x[z]?k=x[z]:p[z]?k=gn:x["*"]?k=x["*"]:p["*"]&&(k=gn),k?I=I.concat(k({key:(i&&`${i}.`)+O,value:c[O],valueSpec:p[z]||p["*"],style:w,styleSpec:A,object:c,objectKey:O},c)):I.push(new n.a3(i,c[O],`unknown property "${O}"`))}for(const O in p)x[O]||p[O].required&&p[O].default===void 0&&c[O]===void 0&&I.push(new n.V(i,c,`missing required property "${O}"`));return I}function Eh({key:g,value:i}){const c=vo({key:g,value:i});if(c.length)return c;const p=i;return p.indexOf("{fontstack}")===-1&&c.push(new n.V(g,i,'"glyphs" url must include a "{fontstack}" token')),p.indexOf("{range}")===-1&&c.push(new n.V(g,i,'"glyphs" url must include a "{range}" token')),c}function Yl(g,i=n.a6,c={}){return xo({key:c.key||"",value:g,valueSpec:Object.assign(i.$root,{"*":{type:"*"}}),styleSpec:i,style:g,objectElementValidators:{glyphs:Eh}})}function ya(g,i=n.a6){return Re(Yl(g,i))}const Of=g=>Re(Mo(g)),Ch=g=>Re(Nc(g)),Pf=g=>Re(Xs(g)),Tt=g=>Re(oa(g)),Ws=g=>Re(vs(g)),Ud=g=>Re((function(i){const c=i.value,p=i.style,x=i.styleSpec,w=x.snow;if(c===void 0)return[];if(!n.H(c))return[new n.V("snow",c,`object expected, ${n.K(c)} found`)];let A=[];for(const I in c){const O=I.match(/^(.*)-transition$/);A=A.concat(O&&w[O[1]]&&w[O[1]].transition?gn({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):w[I]?gn({key:I,value:c[I],valueSpec:w[I],style:p,styleSpec:x}):[new n.a3(I,c[I],`unknown property "${I}"`)])}return A})(g)),Ih=g=>Re((function(i){const c=i.value,p=i.style,x=i.styleSpec,w=x.rain;if(c===void 0)return[];if(!n.H(c))return[new n.V("rain",c,`object expected, ${n.K(c)} found`)];let A=[];for(const I in c){const O=I.match(/^(.*)-transition$/);A=A.concat(O&&w[O[1]]&&w[O[1]].transition?gn({key:I,value:c[I],valueSpec:x.transition,style:p,styleSpec:x}):w[I]?gn({key:I,value:c[I],valueSpec:w[I],style:p,styleSpec:x}):[new n.a3(I,c[I],`unknown property "${I}"`)])}return A})(g)),Ne=g=>Re(ys(g)),te=g=>Re(_l(g)),oe=g=>Re(Ro(g)),me=g=>Re($n(g)),Me=g=>Re(n.a7(g));function Re(g){return g.slice().sort(((i,c)=>i.line&&c.line?i.line-c.line:0))}function Ie(g,i){let c=!1;if(i&&i.length)for(const p of i)p instanceof n.a3?n.w(p.message):(g.fire(new n.y(new Error(p.message))),c=!0);return c}let Qe;class Be extends n.E{constructor(i,c="flat"){super(),this._transitionable=new n.a8(Qe||(Qe=new n.a9({anchor:new n.aa(n.a6.light.anchor),position:new n.ab(n.a6.light.position),color:new n.aa(n.a6.light.color),intensity:new n.aa(n.a6.light.intensity)}))),this.setLight(i,c),this._transitioning=this._transitionable.untransitioned()}getLight(){return this._transitionable.serialize()}setLight(i,c,p={}){this._validate(Ch,i,p)||(this._transitionable.setTransitionOrValue(i),this.id=c)}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,p){return(!p||p.validate!==!1)&&Ie(this,i.call(ya,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}let Je=class extends n.E{constructor(g,i,c,p,x){super(),this.scope=c,this._transitionable=new n.a8(new n.a9({source:new n.aa(n.a6.terrain.source),exaggeration:new n.aa(n.a6.terrain.exaggeration)}),c,p),this._transitionable.setTransitionOrValue(g,p),this._transitioning=this._transitionable.untransitioned(),this.drapeRenderMode=i,this.worldview=x}get(){return this._transitionable.serialize()}set(g,i){this._transitionable.setTransitionOrValue(g,i)}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}getExaggeration(g){return this._transitioning.possiblyEvaluate(new n.ac(g,{worldview:this.worldview})).get("exaggeration")}getAttenuationRange(){if(!this.isZoomDependent())return null;const g=this._transitionable._values.exaggeration;if(!g)return null;const i=g.value.expression;if(!i)return null;let c=-1,p=-1,x=1;for(const w of i.zoomStops)x=i.evaluate(new n.ac(w,{worldview:this.worldview})),x>.01?(c=w,p=-1):p=w;return x<.01&&c>0&&p>c?[c,p]:null}isZoomDependent(){const g=this._transitionable._values.exaggeration;return g!=null&&g.value!=null&&g.value.expression!=null&&g.value.expression instanceof n.ad}};const Pt=45,_t=65,lr=.05;function yr(g,i,c,p){const x=n.ah(Pt,_t,c),[w,A]=gr(g,p);let I=1-Math.min(1,Math.exp((i-w)/(A-w)*-6));return I*=I*I,I=Math.min(1,1.00747*I),I*x*g.alpha}function gr(g,i){const c=.5/Math.tan(.5*i);return[g.range[0]+c,g.range[1]+c]}function Jr(g,i,c,p,x){const w=n.af([],[i,c,p],x.mercatorFogMatrix);return yr(g,n.ag(w),x.pitch,x._fov)}function qr(g,i,c,p,x,w,A){const I=[[c,p,0],[x,p,0],[x,w,0],[c,w,0]];let O=Number.MAX_VALUE,z=-Number.MAX_VALUE;for(const k of I){const H=n.af([],k,i),V=n.ag(H);O=Math.min(O,V),z=Math.max(z,V)}return[yr(g,O,A.pitch,A._fov),yr(g,z,A.pitch,A._fov)]}class Yr extends n.E{constructor(i,c,p,x){super();const w=new n.a9({range:new n.aa(n.a6.fog.range),color:new n.aa(n.a6.fog.color),"color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"high-color":new n.aa(n.a6.fog["high-color"]),"high-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"space-color":new n.aa(n.a6.fog["space-color"]),"space-color-use-theme":new n.aa({type:"string","property-type":"data-constant",default:"default"}),"horizon-blend":new n.aa(n.a6.fog["horizon-blend"]),"star-intensity":new n.aa(n.a6.fog["star-intensity"]),"vertical-range":new n.aa(n.a6.fog["vertical-range"])});this._transitionable=new n.a8(w,p,new Map(x)),this.set(i,x),this._transitioning=this._transitionable.untransitioned(),this._transform=c,this.properties=new n.ai(w),this.scope=p}get state(){const i=this._transform,c=i.projection.name==="globe",p=n.aj(i.zoom),x=this.properties.get("range"),w=[.5,3];return{range:c?[n.ak(w[0],x[0],p),n.ak(w[1],x[1],p)]:x,horizonBlend:this.properties.get("horizon-blend"),alpha:this.properties.get("color").a}}get(){return this._transitionable.serialize()}set(i,c,p={}){if(this._validate(Ws,i,p))return;const x=Object.assign({},i);for(const w of Object.keys(n.a6.fog))x[w]===void 0&&(x[w]=n.a6.fog[w].default);this._options=x,this._transitionable.setTransitionOrValue(this._options,c)}getOpacity(i){if(!this._transform.projection.supportsFog)return 0;const c=this.properties&&this.properties.get("color")||1;return(this._transform.projection.name==="globe"?1:n.ah(Pt,_t,i))*c.a}getOpacityAtLatLng(i,c){return this._transform.projection.supportsFog?(function(p,x,w){const A=n.ae.fromLngLat(x),I=w.elevation?w.elevation.getAtPointOrZero(A):0;return Jr(p,A.x,A.y,I,w)})(this.state,i,c):0}getOpacityForTile(i){if(!this._transform.projection.supportsFog)return[1,1];const c=this._transform.calculateFogTileMatrix(i.toUnwrapped());return qr(this.state,c,0,0,n.al,n.al,this._transform)}getOpacityForBounds(i,c,p,x,w){return this._transform.projection.supportsFog?qr(this.state,i,c,p,x,w,this._transform):[1,1]}getFovAdjustedRange(i){return this._transform.projection.supportsFog?gr(this.state,i):[0,1]}isVisibleOnFrustum(i){if(!this._transform.projection.supportsFog)return!1;const c=[4,5,6,7];for(const p of c){const x=i.points[p];let w;if(x[2]>=0)w=x;else{const A=i.points[p-4];w=n.am(A,x,A[2]/(A[2]-x[2]))}if(Jr(this.state,w[0],w[1],0,this._transform)>=lr)return!0}return!1}updateConfig(i){this._transitionable.setTransitionOrValue(this._options,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}_validate(i,c,p){return(!p||p.validate!==!1)&&Ie(this,i.call(ya,Object.assign({value:c,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}}let Ri,ri,An,Xn,eo=class extends n.E{constructor(g,i,c,p){super();const x=Ri||(Ri=new n.a9({density:new n.aa(n.a6.snow.density),intensity:new n.aa(n.a6.snow.intensity),color:new n.aa(n.a6.snow.color),opacity:new n.aa(n.a6.snow.opacity),vignette:new n.aa(n.a6.snow.vignette),"vignette-color":new n.aa(n.a6.snow["vignette-color"]),"center-thinning":new n.aa(n.a6.snow["center-thinning"]),direction:new n.aa(n.a6.snow.direction),"flake-size":new n.aa(n.a6.snow["flake-size"])}));this._transitionable=new n.a8(x,c,new Map(p)),this.set(g,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(x),this.scope=c}get state(){const g=this.properties.get("opacity"),i=this.properties.get("color"),c=this.properties.get("direction"),p=n.an(c[0]),x=-Math.max(n.an(c[1]),.01),w=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],A=this.properties.get("vignette"),I=this.properties.get("vignette-color");return I.a=A,{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(i.r,i.g,i.b,i.a*g),direction:w,centerThinning:this.properties.get("center-thinning"),flakeSize:this.properties.get("flake-size"),vignetteColor:I}}get(){return this._transitionable.serialize()}set(g,i,c={}){if(this._validate(Ud,g,c))return;const p=Object.assign({},g);for(const x of Object.keys(n.a6.snow))p[x]===void 0&&(p[x]=n.a6.snow[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,i,c){return(!c||c.validate!==!1)&&Ie(this,g.call(ya,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}},Li=class extends n.E{constructor(g,i,c,p){super();const x=ri||(ri=new n.a9({density:new n.aa(n.a6.rain.density),intensity:new n.aa(n.a6.rain.intensity),color:new n.aa(n.a6.rain.color),opacity:new n.aa(n.a6.rain.opacity),vignette:new n.aa(n.a6.rain.vignette),"vignette-color":new n.aa(n.a6.rain["vignette-color"]),"center-thinning":new n.aa(n.a6.rain["center-thinning"]),direction:new n.aa(n.a6.rain.direction),"droplet-size":new n.aa(n.a6.rain["droplet-size"]),"distortion-strength":new n.aa(n.a6.rain["distortion-strength"])}));this._transitionable=new n.a8(x,c,new Map(p)),this.set(g,p),this._transitioning=this._transitionable.untransitioned(),this.properties=new n.ai(x),this.scope=c}get state(){const g=this.properties.get("opacity"),i=this.properties.get("color"),c=this.properties.get("direction"),p=n.an(c[0]),x=-Math.max(n.an(c[1]),.01),w=[Math.cos(p)*Math.cos(x),Math.sin(p)*Math.cos(x),Math.sin(x)],A=this.properties.get("vignette-color");return A.a=this.properties.get("vignette"),{density:this.properties.get("density"),intensity:this.properties.get("intensity"),color:new n.ao(i.r,i.g,i.b,i.a*g),direction:w,centerThinning:this.properties.get("center-thinning"),dropletSize:this.properties.get("droplet-size"),distortionStrength:this.properties.get("distortion-strength"),vignetteColor:A}}get(){return this._transitionable.serialize()}set(g,i,c={}){if(this._validate(Ih,g,c))return;const p=Object.assign({},g);for(const x of Object.keys(n.a6.rain))p[x]===void 0&&(p[x]=n.a6.rain[x].default);this._options=p,this._transitionable.setTransitionOrValue(this._options,i)}updateConfig(g){this._transitionable.setTransitionOrValue(this._options,new Map(g))}updateTransitions(g){this._transitioning=this._transitionable.transitioned(g,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(g){this.properties=this._transitioning.possiblyEvaluate(g)}_validate(g,i,c){return(!c||c.validate!==!1)&&Ie(this,g.call(ya,Object.assign({value:i,style:{glyphs:!0,sprite:!0},styleSpec:n.a6})))}};class mi extends n.E{constructor(i,c,p,x){super(),this.scope=p,this._options=i,this.properties=new n.ai(c),this._transitionable=new n.a8(c,p,new Map(x)),this._transitionable.setTransitionOrValue(i.properties),this._transitioning=this._transitionable.untransitioned()}updateConfig(i){this._transitionable.setTransitionOrValue(this._options.properties,new Map(i))}updateTransitions(i){this._transitioning=this._transitionable.transitioned(i,this._transitioning)}hasTransition(){return this._transitioning.hasTransition()}recalculate(i){this.properties=this._transitioning.possiblyEvaluate(i)}get(){return this._options.properties=this._transitionable.serialize(),this._options}set(i,c){this._options=i,this._transitionable.setTransitionOrValue(i.properties,c)}shadowsEnabled(){return!!this.properties&&this.properties.get("cast-shadows")===!0}}class $i{constructor(i,c,p){this.screenBounds=i,this.cameraPoint=p.getCameraPoint(),this._screenRaycastCache={},this._cameraRaycastCache={},this.isAboveHorizon=c,this.screenGeometry=this.bufferedScreenGeometry(0),this.screenGeometryMercator=this._bufferedScreenMercator(0,p)}static createFromScreenPoints(i,c){let p,x;if(i instanceof n.P||typeof i[0]=="number"){const w=n.P.convert(i);p=[w],x=c.isPointAboveHorizon(w)}else{const w=n.P.convert(i[0]),A=n.P.convert(i[1]),I=w.add(A)._div(2);p=[w,A],x=n.aq(w,A).every((O=>c.isPointAboveHorizon(O)))&&c.isPointAboveHorizon(I)}return new $i(p,x,c)}isPointQuery(){return this.screenBounds.length===1}bufferedScreenGeometry(i){return n.aq(this.screenBounds[0],this.screenBounds.length===1?this.screenBounds[0]:this.screenBounds[1],i)}bufferedCameraGeometry(i){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],x=n.aq(c,p,0,!1);return this.cameraPoint.y>p.y&&(this.cameraPoint.x>c.x&&this.cameraPoint.x<p.x?x.splice(3,0,this.cameraPoint):this.cameraPoint.x>=p.x?x[2]=this.cameraPoint:this.cameraPoint.x<=c.x&&(x[3]=this.cameraPoint)),n.ar(x,i)}bufferedCameraGeometryGlobe(i){const c=this.screenBounds[0],p=this.screenBounds.length===1?this.screenBounds[0].add(new n.P(1,1)):this.screenBounds[1],x=n.aq(c,p,i),w=this.cameraPoint.clone();switch(3*((w.y>c.y)+(w.y>p.y))+((w.x>c.x)+(w.x>p.x))){case 0:x[0]=w,x[4]=w.clone();break;case 1:x.splice(1,0,w);break;case 2:x[1]=w;break;case 3:x.splice(4,0,w);break;case 5:x.splice(2,0,w);break;case 6:x[3]=w;break;case 7:x.splice(3,0,w);break;case 8:x[2]=w}return x}containsTile(i,c,p,x=0){const w=i.queryPadding/c._pixelsPerMercatorPixel+1,A=p?this._bufferedCameraMercator(w,c):this._bufferedScreenMercator(w,c);let I=i.tileID.wrap+(A.unwrapped?x:0);const O=A.polygon.map((re=>n.as(i.tileTransform,re,I)));if(!n.at(O,0,0,n.al,n.al))return;I=i.tileID.wrap+(this.screenGeometryMercator.unwrapped?x:0);const z=this.screenGeometryMercator.polygon.map((re=>n.au(i.tileTransform,re,I))),k=z.map((re=>new n.P(re[0],re[1]))),H=c.getFreeCameraOptions().position||new n.ae(0,0,0),V=n.au(i.tileTransform,H,I),X=z.map((re=>{const K=n.av(re,re,V);return n.aw(K,K),new n.ax(V,K)})),Y=n.ay(i,1,c.zoom)*c._pixelsPerMercatorPixel;return{queryGeometry:this,tilespaceGeometry:k,tilespaceRays:X,bufferedTilespaceGeometry:O,bufferedTilespaceBounds:(W=n.az(O),W.min.x=n.aA(W.min.x,0,n.al),W.min.y=n.aA(W.min.y,0,n.al),W.max.x=n.aA(W.max.x,0,n.al),W.max.y=n.aA(W.max.y,0,n.al),W),tile:i,tileID:i.tileID,pixelToTileUnitsFactor:Y};var W}_bufferedScreenMercator(i,c){const p=to(i);if(this._screenRaycastCache[p])return this._screenRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedScreenGeometry(i),c):{polygon:this.bufferedScreenGeometry(i).map((w=>c.pointCoordinate3D(w))),unwrapped:!0},this._screenRaycastCache[p]=x,x}}_bufferedCameraMercator(i,c){const p=to(i);if(this._cameraRaycastCache[p])return this._cameraRaycastCache[p];{let x;return x=c.projection.name==="globe"?this._projectAndResample(this.bufferedCameraGeometryGlobe(i),c):{polygon:this.bufferedCameraGeometry(i).map((w=>c.pointCoordinate3D(w))),unwrapped:!0},this._cameraRaycastCache[p]=x,x}}_projectAndResample(i,c){const p=(function(w,A){const I=n.aB([],A.pixelMatrix,A.globeMatrix),O=[0,-n.aD,0,1],z=[0,n.aD,0,1],k=[0,0,0,1];n.aC(O,O,I),n.aC(z,z,I),n.aC(k,k,I);const H=new n.P(O[0]/O[3],O[1]/O[3]),V=new n.P(z[0]/z[3],z[1]/z[3]),X=n.aE(w,H)&&O[3]<k[3],Y=n.aE(w,V)&&z[3]<k[3];if(!X&&!Y)return null;const W=(function(Te,ye,_e){for(let Se=1;Se<Te.length;Se++){const He=Wi(ye.pointCoordinate3D(Te[Se-1]).x),ze=Wi(ye.pointCoordinate3D(Te[Se]).x);if(_e<0){if(He<ze)return{idx:Se,t:-He/(ze-1-He)}}else if(ze<He)return{idx:Se,t:(1-He)/(ze+1-He)}}return null})(w,A,X?-1:1);if(!W)return null;const{idx:re,t:K}=W;let ae=re>1?_n(w.slice(0,re),A):[],ue=re<w.length?_n(w.slice(re),A):[];ae=ae.map((Te=>new n.P(Wi(Te.x),Te.y))),ue=ue.map((Te=>new n.P(Wi(Te.x),Te.y)));const fe=[...ae];fe.length===0&&fe.push(ue[ue.length-1]);const xe=n.ak(fe[fe.length-1].y,(ue.length===0?ae[0]:ue[0]).y,K);let ge;return ge=X?[new n.P(0,xe),new n.P(0,0),new n.P(1,0),new n.P(1,xe)]:[new n.P(1,xe),new n.P(1,1),new n.P(0,1),new n.P(0,xe)],fe.push(...ge),ue.length===0?fe.push(ae[0]):fe.push(...ue),{polygon:fe.map((Te=>new n.ae(Te.x,Te.y))),unwrapped:!1}})(i,c);if(p)return p;const x=(function(w,A){let I=!1,O=-1/0,z=0;for(let H=0;H<w.length-1;H++)w[H].x>O&&(O=w[H].x,z=H);for(let H=0;H<w.length-1;H++){const V=(z+H)%(w.length-1),X=w[V],Y=w[V+1];Math.abs(X.x-Y.x)>.5&&(X.x<Y.x?(X.x+=1,V===0&&(w[w.length-1].x+=1)):(Y.x+=1,V+1===w.length-1&&(w[0].x+=1)),I=!0)}const k=n.aF(A.center.lng);return I&&k<Math.abs(k-1)&&w.forEach((H=>{H.x-=1})),{polygon:w,unwrapped:I}})(_n(i,c).map((w=>new n.P(Wi(w.x),w.y))),c);return{polygon:x.polygon.map((w=>new n.ae(w.x,w.y))),unwrapped:x.unwrapped}}}function _n(g,i){return n.aG(g,(c=>{const p=i.pointCoordinate3D(c);c.x=p.x,c.y=p.y}),1/256)}function Wi(g){return g<0?1+g%1:g%1}function to(g){return 100*g|0}function No(g,i,c,p,x){const w=function(I,O){if(I)return x(I);if(O){if(g.url&&O.tiles&&g.tiles&&delete g.tiles,O.variants){if(!Array.isArray(O.variants))return x(new Error("variants must be an array"));for(const k of O.variants){if(k==null||typeof k!="object"||k.constructor!==Object)return x(new Error("variant must be an object"));if(!Array.isArray(k.capabilities))return x(new Error("capabilities must be an array"));if(k.capabilities.length===1&&k.capabilities[0]==="meshopt"){O=Object.assign(O,k);break}}}const z=n.aH(Object.assign({},O,g),["tilejson","tiles","minzoom","maxzoom","attribution","mapbox_logo","bounds","extra_bounds","scheme","tileSize","encoding","vector_layers","raster_layers","worldview_options","worldview_default","worldview"]);z.tiles=i.canonicalizeTileset(z,g.url),x(null,z)}},A=(function(I,O,z){if(!I)return null;if(!O&&!z)return I;z=z||I.worldview_default;const k=Object.values(I.language||{});if(k.length===0)return null;const H=Object.values(I.worldview||{});if(H.length===0)return null;const V=k.every((Y=>Y===O)),X=H.every((Y=>Y===z));return V&&X?I:O in(I.language_options||{})||z in(I.worldview_options||{})?null:I.language_options&&I.worldview_options?I:null})(g.data,c,p);return A?n.o.frame((()=>w(null,A))):g.url?n.m(i.transformRequest(i.normalizeSourceURL(g.url,null,c,p),n.R.Source),w):n.o.frame((()=>{const{data:I,...O}=g;w(null,O)}))}function va(g,i){const c=Math.pow(2,i.z),p=Math.floor(n.aF(g.getWest())*c),x=Math.floor(n.aJ(g.getNorth())*c),w=Math.ceil(n.aF(g.getEast())*c),A=Math.ceil(n.aJ(g.getSouth())*c);return i.x>=p&&i.x<w&&i.y>=x&&i.y<A}class Ql{constructor(i,c,p){this.bounds=i?n.aI.convert(this.validateBounds(i)):null,this.minzoom=c||0,this.maxzoom=p||24}validateBounds(i){return Array.isArray(i)&&i.length===4?[Math.max(-180,i[0]),Math.max(-90,i[1]),Math.min(180,i[2]),Math.min(90,i[3])]:[-180,-90,180,90]}addExtraBounds(i){if(i){this.extraBounds||(this.extraBounds=[]);for(const c of i)this.extraBounds.push(n.aI.convert(this.validateBounds(c)))}}contains(i){if(i.z>this.maxzoom||i.z<this.minzoom||this.bounds&&!va(this.bounds,i))return!1;if(!this.extraBounds)return!0;for(const c of this.extraBounds)if(va(c,i))return!0;return!1}static fromTileJSON(i){if(!i.bounds&&!i.extra_bounds)return null;const c=new Ql(i.bounds,i.minzoom,i.maxzoom);return c.addExtraBounds(i.extra_bounds),c}}class Vo extends n.E{constructor(i,c,p,x){if(super(),this.id=i,this.dispatcher=p,this.type="vector",this.minzoom=0,this.maxzoom=22,this.scheme="xyz",this.tileSize=512,this.reparseOverscaled=!0,this.isTileClipped=!0,this._loaded=!1,Object.assign(this,n.aH(c,["url","scheme","tileSize","promoteId"])),this._options=Object.assign({type:"vector"},c),this._collectResourceTiming=!!c.collectResourceTiming,this.tileSize!==512)throw new Error("vector tile sources must have a tileSize of 512");this.setEventedParent(x),this._tileWorkers={},this._deduped=new n.aK}load(i){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const c=Array.isArray(this.map._language)?this.map._language.join():this.map._language,p=this.map.getWorldview();this._tileJSONRequest=No(this._options,this.map._requestManager,c,p,((x,w)=>{if(this._tileJSONRequest=null,this._loaded=!0,x)c&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${c}`),p&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${p}`),this.fire(new n.y(x));else if(w){if(Object.assign(this,w),this.hasWorldviews=!!w.worldview_options,w.worldview_default&&(this.worldviewDefault=w.worldview_default),w.vector_layers){this.vectorLayers=w.vector_layers,this.vectorLayerIds=[],this.localizableLayerIds=new Set;for(const A of w.vector_layers)this.vectorLayerIds.push(A.id),w.worldview&&w.worldview[A.source]&&this.localizableLayerIds.add(A.id)}this.tileBounds=Ql.fromTileJSON(w),Er(w.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}i&&i(x)}))}loaded(){return this._loaded}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(i)))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}loadTile(i,c){const p=i.tileID.canonical.url(this.tiles,this.scheme),x=this.map._requestManager.normalizeTileURL(p),w=this.map._requestManager.transformRequest(x,n.R.Tile),A=this.map.style?this.map.style.getLut(this.scope):null,I=A?{image:A.image.clone()}:null,O={request:w,data:void 0,uid:i.uid,tileID:i.tileID,tileZoom:i.tileZoom,zoom:i.tileID.overscaledZ,maxZoom:this.maxzoom,lut:I,tileSize:this.tileSize*i.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,isSymbolTile:i.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:i.isExtraShadowCaster,tessellationStep:this.map._tessellationStep,scaleFactor:this.map.getScaleFactor(),worldview:this.map.getWorldview()||this.worldviewDefault};if(this.hasWorldviews&&n.h(p)&&(O.localizableLayerIds=this.localizableLayerIds),O.request.collectResourceTiming=this._collectResourceTiming,i.actor&&i.state!=="expired")i.state==="loading"?i.reloadCallback=c:i.request=i.actor.send("reloadTile",O,z.bind(this));else if(i.actor=this._tileWorkers[x]=this._tileWorkers[x]||this.dispatcher.getActor(),this.dispatcher.ready)i.request=i.actor.send("loadTile",O,z.bind(this),void 0,!0);else{const k=n.aL.call({deduped:this._deduped},O,((H,V)=>{H||!V?z.call(this,H):(O.data={cacheControl:V.cacheControl,expires:V.expires,rawData:V.rawData.slice(0)},i.actor&&i.actor.send("loadTile",O,z.bind(this),void 0,!0))}),!0);i.request={cancel:k}}function z(k,H){return delete i.request,i.aborted?c(null):k&&k.status!==404?c(k):(H&&H.resourceTiming&&(i.resourceTiming=H.resourceTiming),this.map._refreshExpiredTiles&&H&&i.setExpiryData(H),i.loadVectorData(H,this.map.painter),n.aM(this.dispatcher),c(null),void(i.reloadCallback&&(this.loadTile(i,i.reloadCallback),i.reloadCallback=null)))}}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,c){i.actor&&i.actor.send("removeTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope}),i.destroy()}hasTransition(){return!1}afterUpdate(){this._tileWorkers={}}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}class Yo extends n.E{constructor(i,c,p,x){super(),this.id=i,this.dispatcher=p,this.setEventedParent(x),this.type="raster",this.minzoom=0,this.maxzoom=22,this.roundZoom=!0,this.scheme="xyz",this.tileSize=512,this._loaded=!1,this._options=Object.assign({type:"raster"},c),Object.assign(this,n.aH(c,["url","scheme","tileSize"]))}load(i){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const c=this.map.getWorldview();this._tileJSONRequest=No(this._options,this.map._requestManager,null,c,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?this.fire(new n.y(p)):x&&(Object.assign(this,x),x.raster_layers&&(this.rasterLayers=x.raster_layers,this.rasterLayerIds=this.rasterLayers.map((w=>w.id))),this.tileBounds=Ql.fromTileJSON(x),Er(x.tiles),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),i&&i(p)}))}loaded(){return this._loaded}onAdd(i){this.map=i,this.load()}reload(){this.cancelTileJSONRequest();const i=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(i)))}setTiles(i){return this._options.tiles=i,this.reload(),this}setUrl(i){return this.url=i,this._options.url=i,this.reload(),this}onRemove(i){this.cancelTileJSONRequest()}serialize(){return Object.assign({},this._options)}hasTile(i){return!this.tileBounds||this.tileBounds.contains(i.canonical)}loadTile(i,c){const p=n.o.devicePixelRatio>=2,x=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),p,this.tileSize);i.request=n.n(this.map._requestManager.transformRequest(x,n.R.Tile),((w,A,I,O)=>(delete i.request,i.aborted?(i.state="unloaded",c(null)):w?(i.state="errored",c(w)):A?(this.map._refreshExpiredTiles&&i.setExpiryData({cacheControl:I,expires:O}),i.setTexture(A,this.map.painter),i.state="loaded",n.aM(this.dispatcher),void c(null)):c(null))))}abortTile(i,c){i.request&&(i.request.cancel(),delete i.request),c&&c()}unloadTile(i,c){i.texture&&i.texture instanceof n.T?(i.destroy(!0),i.texture&&i.texture instanceof n.T&&this.map.painter.saveTileTexture(i.texture)):i.destroy(),c&&c()}hasTransition(){return!1}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}}function pm([g,i],c,p,{scaled:x=!0}={}){const{tileSize:w,buffer:A}=p,{x:I,y:O,z}=c;if(!isFinite(I)||!isFinite(O)||!isFinite(z))throw new Error("Invalid MRT header");const k=2**z,H=k*n.aF(g),V=k*n.aJ(i);return(function([X,Y],W,{scaled:re=!0}={}){if(!W)throw new Error("bandView is undefined");const{data:K,tileSize:ae,buffer:ue,offset:fe,scale:xe,dimension:ge}=W;if(X<-ue||X>ae+ue||Y<-ue||Y>ae+ue)throw new Error(`Point (${X}, ${Y}) out of bounds for tileSize=${ae}, buffer=${ue}`);const Te=(Y+ue)*(ae+2*ue)+(X+ue);if(new Uint32Array(K.buffer)[Te]===4294967295)return null;let ye=[];ye=re?[]:new W.data.constructor(ge);for(let _e=0;_e<ge;_e++)ye[_e]=Math.round(1e12*(K[ge*Te+_e]*xe+fe))/1e12;return ye})([Math.min(Math.max(-A,Math.floor((H-I)*w)),w-1+A),Math.min(Math.max(-A,Math.floor((V-O)*w)),w-1+A)],p,{scaled:x})}class Vc extends Yo{constructor(i,c,p,x){super(i,c,p,x),this.type="raster-array",this.maxzoom=22,this.partial=!0,this._loadTilePending={},this._loadTileLoaded={},this._options=Object.assign({type:"raster-array"},c)}triggerRepaint(i){const c=this.map.painter._terrain,p=this.map.style.getSourceCache(this.id);c&&c.enabled&&p&&c._clearRenderCacheForTile(p.id,i.tileID),this.map.triggerRepaint()}loadTile(i,c){const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,n.R.Tile),w={request:x,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:this.partial};i.source=this.id,i.scope=this.scope,i.requestParams=x,i.actor||(i.actor=this.dispatcher.getActor());const A=(I,O,z,k)=>{if(delete i.request,i.aborted)return i.state="unloaded",c(null);if(I)return I.name==="AbortError"?void 0:(i.state="errored",c(I));if(this.map._refreshExpiredTiles&&O&&i.setExpiryData({cacheControl:z,expires:k}),this.partial&&i.state!=="expired")i.state="empty";else if(!this.partial){if(!O)return c(null);i.state="loaded",i._isHeaderLoaded=!0,i._mrt=O}c(null)};i.request=this.partial?i.fetchHeader(void 0,A.bind(this)):i.actor.send("loadTile",w,A.bind(this),void 0,!0)}abortTile(i){i.request&&(i.request.cancel(),delete i.request),i.actor&&i.actor.send("abortTile",{uid:i.uid,type:this.type,source:this.id,scope:this.scope})}unloadTile(i,c){const p=i.texturePerLayer;if(i.flushAllQueues(),p.size){i.destroy(!0);for(const x of p.values())this.map.painter.saveTileTexture(x)}else i.destroy()}prepareTile(i,c,p,x){i._isHeaderLoaded&&(i.state!=="empty"&&(i.state="reloading"),i.fetchBandForRender(c,p,x,((w,A)=>{if(w)return i.state="errored",this.fire(new n.y(w)),void this.triggerRepaint(i);A&&(i._isHeaderLoaded=!0,i.setTexturePerLayer(p,A,this.map.painter),i.state="loaded",this.triggerRepaint(i))})))}getInitialBand(i){if(!this.rasterLayers)return 0;const c=this.rasterLayers.find((({id:w})=>w===i)),p=c&&c.fields,x=p&&p.bands&&p.bands;return x?x[0]:0}getTextureDescriptor(i,c,p){if(!i)return;const x=c.sourceLayer||this.rasterLayerIds&&this.rasterLayerIds[0];if(!x)return;let w=null;c instanceof n.aP?w=c.paint.get("raster-array-band"):c instanceof n.aQ&&(w=c.paint.get("raster-particle-array-band"));const A=w||this.getInitialBand(x);if(A==null)return;if(!i.textureDescriptorPerLayer.get(c.id))return void this.prepareTile(i,x,c.id,A);if(i.updateNeeded(c.id,A)&&!p)return;const I=i.textureDescriptorPerLayer.get(c.id);return Object.assign({},I,{texture:i.texturePerLayer.get(c.id)})}getImages(i,c){const p=new Map;for(const x of i)for(const w of c){const[A,I]=w.split("/"),O=x.getLayer(A);if(!O||!O.hasBand(I)||!O.hasDataForBand(I))continue;const{bytes:z,tileSize:k,buffer:H}=O.getBandView(I),V=k+2*H,X={data:new n.q({width:V,height:V},z),pixelRatio:2,sdf:!1,usvg:!1,version:0};p.set(w,X)}return p}queryRasterArrayValueByBandId(i,c,p){const x=c._mrt;return new Promise((w=>{const A={},I=new Set;for(const[O,z]of Object.entries(x.layers)){if(p.layerName&&O!==p.layerName)continue;const k={};A[O]=k;for(const{bands:H}of z.dataIndex)for(const V of H)p.bands&&!p.bands.includes(V)||(I.add(n.B(O,V)),c.fetchBand(O,null,V,(X=>{n.o.frame((()=>{k[V]=X?null:pm([i.lng,i.lat],x,z.getBandView(V)),I.delete(n.B(O,V)),I.size===0&&w(A)}))}),!1))}I.size===0&&w(A)}))}_loadTileForQuery(i,c){if(this._loadTileLoaded[i.uid])return void c(null,i._mrt);if(this._loadTilePending[i.uid])return void this._loadTilePending[i.uid].push(c);this._loadTilePending[i.uid]=[c];const p=this.map._requestManager.normalizeTileURL(i.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize),x=this.map._requestManager.transformRequest(p,n.R.Tile);i.actor.send("loadTile",{request:x,uid:i.uid,tileID:i.tileID,type:this.type,source:this.id,scope:this.scope,partial:!1},((w,A,I,O)=>w?(this._loadTilePending[i.uid].forEach((z=>z(w,null))),void delete this._loadTilePending[i.uid]):A?(this.map._refreshExpiredTiles&&A&&i.setExpiryData({cacheControl:I,expires:O}),i._mrt=A,i._isHeaderLoaded=!0,i.state="loaded",this._loadTilePending[i.uid].forEach((z=>z(null,A))),this._loadTileLoaded[i.uid]=!0,void delete this._loadTilePending[i.uid]):(this._loadTilePending[i.uid].forEach((z=>z(null,null))),void delete this._loadTilePending[i.uid])),void 0,!0)}queryRasterArrayValueByAllBands(i,c,p){return new Promise(((x,w)=>{this._loadTileForQuery(c,((A,I)=>{A?w(A):x(I?this.queryRasterArrayValueByBandId(i,c,p):null)}))}))}queryRasterArrayValue(i,c){const p=n.aR.convert(i),x=this.findLoadedParent(p);return x&&x._mrt?c.bands||!this.partial?this.queryRasterArrayValueByBandId(p,x,c):this.queryRasterArrayValueByAllBands(p,x,c):Promise.resolve(null)}findLoadedParent(i){const c=n.ae.fromLngLat(i,this.map.transform.tileSize),p=this.maxzoom+1,x=1<<p,w=Math.floor(c.x),A=Math.floor((c.x-w)*x),I=Math.floor(c.y*x),O=this.map.style.getSourceCache(this.id),z=new n.aO(p,w,p,A,I);return O.findLoadedParent(z,this.minzoom)}}const Kl={vector:Vo,raster:Yo,"raster-dem":class extends Yo{constructor(g,i,c,p){super(g,i,c,p),this.type="raster-dem",this.maxzoom=22,this._options=Object.assign({type:"raster-dem"},i),this.encoding=i.encoding||"mapbox"}loadTile(g,i){const c=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme),!1,this.tileSize);function p(x,w){x&&(g.state="errored",i(x)),w&&(g.dem=w,g.dem.onDeserialize(),g.needsHillshadePrepare=!0,g.needsDEMTextureUpload=!0,g.state="loaded",i(null))}g.request=n.n(this.map._requestManager.transformRequest(c,n.R.Tile),(function(x,w,A,I){if(delete g.request,g.aborted)g.state="unloaded",i(null);else if(x)g.state="errored",i(x);else if(w){this.map._refreshExpiredTiles&&g.setExpiryData({cacheControl:A,expires:I});const O=ImageBitmap&&w instanceof ImageBitmap&&n.r(),z=1-(w.width-n.aN(w.width))/2;z<1||g.neighboringTiles||(g.neighboringTiles=this._getNeighboringTiles(g.tileID));const k=O?w:n.o.getImageData(w,z),H={uid:g.uid,tileID:g.tileID,source:this.id,type:this.type,scope:this.scope,rawImageData:k,encoding:this.encoding,padding:z};g.actor&&g.state!=="expired"||(g.actor=this.dispatcher.getActor(),g.actor.send("loadTile",H,p.bind(this),void 0,!0))}}).bind(this))}_getNeighboringTiles(g){const i=g.canonical,c=Math.pow(2,i.z),p=(i.x-1+c)%c,x=i.x===0?g.wrap-1:g.wrap,w=(i.x+1+c)%c,A=i.x+1===c?g.wrap+1:g.wrap,I={};return I[new n.aO(g.overscaledZ,x,i.z,p,i.y).key]={backfilled:!1},I[new n.aO(g.overscaledZ,A,i.z,w,i.y).key]={backfilled:!1},i.y>0&&(I[new n.aO(g.overscaledZ,x,i.z,p,i.y-1).key]={backfilled:!1},I[new n.aO(g.overscaledZ,g.wrap,i.z,i.x,i.y-1).key]={backfilled:!1},I[new n.aO(g.overscaledZ,A,i.z,w,i.y-1).key]={backfilled:!1}),i.y+1<c&&(I[new n.aO(g.overscaledZ,x,i.z,p,i.y+1).key]={backfilled:!1},I[new n.aO(g.overscaledZ,g.wrap,i.z,i.x,i.y+1).key]={backfilled:!1},I[new n.aO(g.overscaledZ,A,i.z,w,i.y+1).key]={backfilled:!1}),I}},"raster-array":Vc,geojson:class extends n.E{constructor(g,i,c,p){super(),this.id=g,this.type="geojson",this.minzoom=0,this.maxzoom=18,this.tileSize=512,this.isTileClipped=!0,this.reparseOverscaled=!0,this._loaded=!1,this.actor=c.getActor(),this.setEventedParent(p),this._data=i.data,this._options=Object.assign({},i),this._collectResourceTiming=i.collectResourceTiming,i.maxzoom!==void 0&&(this.maxzoom=i.maxzoom),i.minzoom!==void 0&&(this.minzoom=i.minzoom),i.type&&(this.type=i.type),i.attribution&&(this.attribution=i.attribution),this.promoteId=i.promoteId;const x=n.al/this.tileSize;this.workerOptions=Object.assign({source:this.id,scope:this.scope,cluster:i.cluster||!1,geojsonVtOptions:{buffer:(i.buffer!==void 0?i.buffer:128)*x,tolerance:(i.tolerance!==void 0?i.tolerance:.375)*x,extent:n.al,maxZoom:this.maxzoom,lineMetrics:i.lineMetrics||!1,generateId:i.generateId||!1},superclusterOptions:{maxZoom:i.clusterMaxZoom!==void 0?i.clusterMaxZoom:this.maxzoom-1,minPoints:Math.max(2,i.clusterMinPoints||2),extent:n.al,radius:(i.clusterRadius!==void 0?i.clusterRadius:50)*x,log:!1,generateId:i.generateId||!1},clusterProperties:i.clusterProperties,filter:i.filter,dynamic:i.dynamic},i.workerOptions)}onAdd(g){this.map=g,this.setData(this._data)}setData(g){return this._data=g,this._updateWorkerData(),this}updateData(g){if(!this._options.dynamic)return this.fire(new n.y(new Error("Can't call updateData on a GeoJSON source with dynamic set to false.")));if(typeof g!="string"&&(g.type==="Feature"&&(g={type:"FeatureCollection",features:[g]}),g.type!=="FeatureCollection"))return this.fire(new n.y(new Error("Data to update should be a feature or a feature collection.")));if(this._coalesce&&typeof g!="string"&&typeof this._data!="string"&&this._data.type==="FeatureCollection"){const i=new Map;for(const c of this._data.features)i.set(c.id,c);for(const c of g.features)i.set(c.id,c);this._data.features=[...i.values()]}else this._data=g;return this._updateWorkerData(!0),this}getClusterExpansionZoom(g,i){return this.actor.send("geojson.getClusterExpansionZoom",{clusterId:g,source:this.id,scope:this.scope},i),this}getClusterChildren(g,i){return this.actor.send("geojson.getClusterChildren",{clusterId:g,source:this.id,scope:this.scope},i),this}getClusterLeaves(g,i,c,p){return this.actor.send("geojson.getClusterLeaves",{source:this.id,scope:this.scope,clusterId:g,limit:i,offset:c},p),this}_updateWorkerData(g=!1){if(this._pendingLoad)return void(this._coalesce=!0);this.fire(new n.z("dataloading",{dataType:"source"})),this._loaded=!1;const i=Object.assign({append:g},this.workerOptions);i.scope=this.scope;const c=this._data;typeof c=="string"?(i.request=this.map._requestManager.transformRequest(n.o.resolveURL(c),n.R.Source),i.request.collectResourceTiming=this._collectResourceTiming):i.data=JSON.stringify(c),this._pendingLoad=this.actor.send(`${this.type}.loadData`,i,((p,x)=>{if(this._loaded=!0,this._pendingLoad=null,p)this.fire(new n.y(p));else{const w={dataType:"source",sourceDataType:this._metadataFired?"content":"metadata"};this._collectResourceTiming&&x&&x.resourceTiming&&x.resourceTiming[this.id]&&(w.resourceTiming=x.resourceTiming[this.id]),g&&(this._partialReload=!0),this.fire(new n.z("data",w)),this._partialReload=!1,this._metadataFired=!0}this._coalesce&&(this._updateWorkerData(g),this._coalesce=!1)}))}loaded(){return this._loaded}reload(){const g=n.B(this.id,this.scope);this.map.style.clearSource(g),this._updateWorkerData()}loadTile(g,i){const c=g.actor?"reloadTile":"loadTile";g.actor=this.actor;const p=this.map.style?this.map.style.getLut(this.scope):null,x=p?{image:p.image.clone()}:null,w=this._partialReload,A={type:this.type,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,maxZoom:this.maxzoom,tileSize:this.tileSize,source:this.id,lut:x,scope:this.scope,pixelRatio:n.o.devicePixelRatio,showCollisionBoxes:this.map.showCollisionBoxes,promoteId:this.promoteId,brightness:this.map.style&&this.map.style.getBrightness()||0,extraShadowCaster:g.isExtraShadowCaster,scaleFactor:this.map.getScaleFactor(),partial:w,worldview:this.map.getWorldview()};g.request=this.actor.send(c,A,((I,O)=>w&&!O?(g.state="loaded",i(null)):(delete g.request,g.destroy(),g.aborted?i(null):I?i(I):(g.loadVectorData(O,this.map.painter,c==="reloadTile"),i(null)))),void 0,c==="loadTile")}abortTile(g){g.request&&(g.request.cancel(),delete g.request),g.aborted=!0}unloadTile(g,i){this.actor.send("removeTile",{uid:g.uid,type:this.type,source:this.id,scope:this.scope}),g.destroy()}onRemove(g){this._pendingLoad&&this._pendingLoad.cancel()}serialize(){return Object.assign({},this._options,{type:this.type,data:this._data})}hasTransition(){return!1}},video:class extends n.aS{constructor(g,i,c,p){super(g,i,c,p),this.roundZoom=!0,this.type="video",this.options=i}load(){this._loaded=!1;const g=this.options;this.urls=[];for(const i of g.urls)this.urls.push(this.map._requestManager.transformRequest(i,n.R.Source).url);n.aT(this.urls,((i,c)=>{this._loaded=!0,i?this.fire(new n.y(i)):c&&(this.video=c,this.video.loop=!0,this.video.setAttribute("playsinline",""),this.video.addEventListener("playing",(()=>{this.map.triggerRepaint()})),this.map&&this.video.play(),this._finishLoading())}))}pause(){this.video&&this.video.pause()}play(){this.video&&this.video.play()}seek(g){if(this.video){const i=this.video.seekable;g<i.start(0)||g>i.end(0)?this.fire(new n.y(new n.V(`sources.${this.id}`,null,`Playback for this video can be set only between the ${i.start(0)} and ${i.end(0)}-second mark.`))):this.video.currentTime=g}}getVideo(){return this.video}onAdd(g){this.map||(this.map=g,this.load(),this.video&&(this.video.play(),this.setCoordinates(this.coordinates)))}prepare(){if(Object.keys(this.tiles).length===0||this.video.readyState<2)return;const g=this.map.painter.context,i=g.gl;this.texture?this.video.paused||(this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),i.texSubImage2D(i.TEXTURE_2D,0,0,0,i.RGBA,i.UNSIGNED_BYTE,this.video)):(this.texture=new n.T(g,this.video,i.RGBA8),this.texture.bind(i.LINEAR,i.CLAMP_TO_EDGE),this.width=this.video.videoWidth,this.height=this.video.videoHeight),this._prepareData(g)}serialize(){return{type:"video",urls:this.urls,coordinates:this.coordinates}}hasTransition(){return this.video&&!this.video.paused}},image:n.aS,model:class extends n.E{constructor(g,i,c,p){super(),this.id=g,this.type="model",this.models=[],this._loaded=!1,this._options=i}load(){const g=[];for(const i in this._options.models){const c=this._options.models[i],p=n.aV(this.map._requestManager.transformRequest(c.uri,n.R.Model).url).then((x=>{if(!x)return;const w=n.aW(x),A=new n.aX(i,c.position,c.orientation,w);A.computeBoundsAndApplyParent(),this.models.push(A)})).catch((x=>{this.fire(new n.y(new Error(`Could not load model ${i} from ${c.uri}: ${x.message}`)))}));g.push(p)}Promise.allSettled(g).then((()=>{this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"}))})).catch((i=>{this._loaded=!0,this.fire(new n.y(new Error(`Could not load models: ${i.message}`)))}))}onAdd(g){this.map=g,this.load()}hasTransition(){return!1}loaded(){return this._loaded}getModels(){return this.models}loadTile(g,i){}serialize(){return this._options}},"batched-model":class extends n.E{constructor(g,i,c,p){super(),this.type="batched-model",this.id=g,this.tileSize=512,this._options=i,this.tiles=this._options.tiles,this.maxzoom=i.maxzoom||19,this.minzoom=i.minzoom||0,this.roundZoom=!0,this.usedInConflation=!0,this.dispatcher=c,this.reparseOverscaled=!1,this.scheme="xyz",this._loaded=!1,this.setEventedParent(p)}onAdd(g){this.map=g,this.load()}reload(){this.cancelTileJSONRequest();const g=n.B(this.id,this.scope);this.load((()=>this.map.style.clearSource(g)))}cancelTileJSONRequest(){this._tileJSONRequest&&(this._tileJSONRequest.cancel(),this._tileJSONRequest=null)}load(g){this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"}));const i=Array.isArray(this.map._language)?this.map._language.join():this.map._language,c=this.map.getWorldview();this._tileJSONRequest=No(this._options,this.map._requestManager,i,c,((p,x)=>{this._tileJSONRequest=null,this._loaded=!0,p?(i&&console.warn(`Ensure that your requested language string is a valid BCP-47 code or list of codes. Found: ${i}`),c&&c.length!==2&&console.warn(`Requested worldview strings must be a valid ISO alpha-2 code. Found: ${c}`),this.fire(new n.y(p))):x&&(Object.assign(this,x),x.bounds&&(this.tileBounds=new Ql(x.bounds,this.minzoom,this.maxzoom)),Er(x.tiles,this.map._requestManager._customAccessToken),this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))),g&&g(p)}))}hasTransition(){return!1}hasTile(g){return!this.tileBounds||this.tileBounds.contains(g.canonical)}loaded(){return this._loaded}loadTile(g,i){const c=this.map._requestManager.normalizeTileURL(g.tileID.canonical.url(this.tiles,this.scheme)),p={request:this.map._requestManager.transformRequest(c,n.R.Tile),data:void 0,uid:g.uid,tileID:g.tileID,tileZoom:g.tileZoom,zoom:g.tileID.overscaledZ,tileSize:this.tileSize*g.tileID.overscaleFactor(),type:this.type,source:this.id,scope:this.scope,showCollisionBoxes:this.map.showCollisionBoxes,isSymbolTile:g.isSymbolTile,brightness:this.map.style&&this.map.style.getBrightness()||0,pixelRatio:n.o.devicePixelRatio,promoteId:this.promoteId};if(g.actor&&g.state!=="expired")if(g.state==="loading")g.reloadCallback=i;else{if(g.buckets){const w=Object.values(g.buckets);for(const A of w)A.dirty=!0;return void(g.state="loaded")}g.request=g.actor.send("reloadTile",p,x.bind(this))}else g.actor=this.dispatcher.getActor(),g.request=g.actor.send("loadTile",p,x.bind(this),void 0,!0);function x(w,A){return g.aborted?i(null):w&&w.status!==404?i(w):(this.map._refreshExpiredTiles&&A&&g.setExpiryData(A),g.loadModelData(A,this.map.painter),g.state="loaded",void i(null))}}serialize(){return Object.assign({},this._options)}},canvas:class extends n.aS{constructor(g,i,c,p){super(g,i,c,p),i.coordinates?Array.isArray(i.coordinates)&&i.coordinates.length===4&&!i.coordinates.some((x=>!Array.isArray(x)||x.length!==2||x.some((w=>typeof w!="number"))))||this.fire(new n.y(new n.V(`sources.${g}`,null,'"coordinates" property must be an array of 4 longitude/latitude array pairs'))):this.fire(new n.y(new n.V(`sources.${g}`,null,'missing required property "coordinates"'))),i.animate&&typeof i.animate!="boolean"&&this.fire(new n.y(new n.V(`sources.${g}`,null,'optional "animate" property must be a boolean value'))),i.canvas?typeof i.canvas=="string"||i.canvas instanceof HTMLCanvasElement||this.fire(new n.y(new n.V(`sources.${g}`,null,'"canvas" must be either a string representing the ID of the canvas element from which to read, or an HTMLCanvasElement instance'))):this.fire(new n.y(new n.V(`sources.${g}`,null,'missing required property "canvas"'))),this.options=i,this.animate=i.animate===void 0||i.animate}load(){this._loaded=!0,this.canvas||(this.canvas=this.options.canvas instanceof HTMLCanvasElement?this.options.canvas:document.getElementById(this.options.canvas)),this.width=this.canvas.width,this.height=this.canvas.height,this._hasInvalidDimensions()?this.fire(new n.y(new Error("Canvas dimensions cannot be less than or equal to zero."))):(this.play=function(){this._playing=!0,this.map.triggerRepaint()},this.pause=function(){this._playing&&(this.prepare(),this._playing=!1)},this._finishLoading())}getCanvas(){return this.canvas}onAdd(g){this.map=g,this.load(),this.canvas&&this.animate&&this.play()}onRemove(g){this.pause()}prepare(){let g=!1;if(this.canvas.width!==this.width&&(this.width=this.canvas.width,g=!0),this.canvas.height!==this.height&&(this.height=this.canvas.height,g=!0),this._hasInvalidDimensions()||Object.keys(this.tiles).length===0)return;const i=this.map.painter.context;this.texture?!g&&!this._playing||this.texture instanceof n.aU||this.texture.update(this.canvas,{premultiply:!0}):this.texture=new n.T(i,this.canvas,i.gl.RGBA8,{premultiply:!0}),this._prepareData(i)}serialize(){return{type:"canvas",coordinates:this.coordinates}}hasTransition(){return this._playing}_hasInvalidDimensions(){for(const g of[this.canvas.width,this.canvas.height])if(isNaN(g)||g<=0)return!0;return!1}},custom:class extends n.E{constructor(g,i,c,p){super(),this.id=g,this.type="custom",this._dataType="raster",this._dispatcher=c,this._implementation=i,this.setEventedParent(p),this.scheme="xyz",this.minzoom=0,this.maxzoom=22,this.tileSize=512,this._loaded=!1,this.roundZoom=!0,this._implementation||this.fire(new n.y(new Error(`Missing implementation for ${this.id} custom source`))),this._implementation.loadTile||this.fire(new n.y(new Error(`Missing loadTile implementation for ${this.id} custom source`))),this._implementation.bounds&&(this.tileBounds=new Ql(this._implementation.bounds,this.minzoom,this.maxzoom)),i.update=this._update.bind(this),i.clearTiles=this._clearTiles.bind(this),i.coveringTiles=this._coveringTiles.bind(this),Object.assign(this,n.aH(i,["dataType","scheme","minzoom","maxzoom","tileSize","attribution","minTileCacheSize","maxTileCacheSize"]))}serialize(){return n.aH(this,["type","scheme","minzoom","maxzoom","tileSize","attribution"])}load(){this._loaded=!0,this.fire(new n.z("data",{dataType:"source",sourceDataType:"metadata"})),this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}loaded(){return this._loaded}onAdd(g){this.map=g,this._loaded=!1,this.fire(new n.z("dataloading",{dataType:"source"})),this._implementation.onAdd&&this._implementation.onAdd(g),this.load()}onRemove(g){this._implementation.onRemove&&this._implementation.onRemove(g)}hasTile(g){if(this._implementation.hasTile){const{x:i,y:c,z:p}=g.canonical;return this._implementation.hasTile({x:i,y:c,z:p})}return!this.tileBounds||this.tileBounds.contains(g.canonical)}loadTile(g,i){const{x:c,y:p,z:x}=g.tileID.canonical,w=new AbortController;g.request=Promise.resolve(this._implementation.loadTile({x:c,y:p,z:x},{signal:w.signal})).then((function(A){return delete g.request,g.aborted?(g.state="unloaded",i(null)):A===void 0?(g.state="errored",i(null)):A===null?(this.loadTileData(g,{width:this.tileSize,height:this.tileSize,data:null}),g.state="loaded",i(null)):(function(I){return I instanceof ImageData||I instanceof HTMLCanvasElement||I instanceof ImageBitmap||I instanceof HTMLImageElement})(A)?(this.loadTileData(g,A),g.state="loaded",void i(null)):(g.state="errored",i(new Error(`Can't infer data type for ${this.id}, only raster data supported at the moment`)))}).bind(this)).catch((A=>{A.name!=="AbortError"&&(g.state="errored",i(A))})),g.request.cancel=()=>w.abort()}loadTileData(g,i){g.setTexture(i,this.map.painter)}unloadTile(g,i){if(g.texture&&g.texture instanceof n.T?(g.destroy(!0),g.texture&&g.texture instanceof n.T&&this.map.painter.saveTileTexture(g.texture)):g.destroy(),this._implementation.unloadTile){const{x:c,y:p,z:x}=g.tileID.canonical;this._implementation.unloadTile({x:c,y:p,z:x})}i&&i()}abortTile(g,i){g.request&&g.request.cancel&&(g.request.cancel(),delete g.request),i&&i()}hasTransition(){return!1}_coveringTiles(){return this.map.transform.coveringTiles({tileSize:this.tileSize,minzoom:this.minzoom,maxzoom:this.maxzoom,roundZoom:this.roundZoom}).map((g=>({x:g.canonical.x,y:g.canonical.y,z:g.canonical.z})))}_clearTiles(){const g=n.B(this.id,this.scope);this.map.style.clearSource(g)}_update(){this.fire(new n.z("data",{dataType:"source",sourceDataType:"content"}))}}},Rh=function(g,i,c,p){const x=new Kl[i.type](g,i,c,p);if(x.id!==g)throw new Error(`Expected Source id to be ${g} instead of ${x.id}`);return n.aY(["load","abort","unload","serialize","prepare"],x),x};function Uc(g,i,c=""){return`${c}:${i.id||""}:${i.layer.id}:${(function(p){if("layerId"in p)return`layer:${p.layerId}`;{const{featuresetId:x,importId:w}=p;return`featureset:${x}${w?`:import:${w}`:""}`}})(g.target)}`}function jc(g,i,c,p=""){if(g.uniqueFeatureID){const x=Uc(g,i,p);if(c.has(x))return!0;c.add(x)}return!1}function aa(g,i,c,p,x=!1){const w=i.sourceCache.transform,A=i.sourceCache.tilesIn(g,i.has3DLayers,x);A.sort(Bf);const I=[];for(const O of A){const z=O.tile.queryRenderedFeatures(i,O,c,p,w,x);Object.keys(z).length&&I.push({wrappedTileID:O.tile.tileID.wrapped().key,queryResults:z})}return I.length===0?{}:(function(O){const z={},k={};for(const H of O){const V=H.queryResults,X=H.wrappedTileID,Y=k[X]=k[X]||{};for(const W in V){const re=V[W],K=Y[W]=Y[W]||{},ae=z[W]=z[W]||[];for(const ue of re)K[ue.featureIndex]||(K[ue.featureIndex]=!0,ae.push(ue))}}return z})(I)}function Lf(g,i,c,p,x,w){const A={},I=p.queryRenderedSymbols(g),O=[];for(const z of Object.keys(I).map(Number))O.push(x[z]);O.sort(Bf);for(const z of O){const k=z.featureIndex.lookupSymbolFeatures(I[z.bucketInstanceId],z.bucketIndex,z.sourceLayerIndex,i,c,w);for(const H in k){const V=A[H]=A[H]||[],X=k[H];X.sort(((Y,W)=>{const re=z.featureSortOrder;if(re){const K=re.indexOf(Y.featureIndex);return re.indexOf(W.featureIndex)-K}return W.featureIndex-Y.featureIndex}));for(const Y of X)V.push(Y)}}return A}function Ys(g,i){const c=g.getRenderableIds().map((w=>g.getTileByID(w))),p=[],x={};for(let w=0;w<c.length;w++){const A=c[w],I=A.tileID.canonical.key;x[I]||(x[I]=!0,A.querySourceFeatures(p,i))}return p}function Bf(g,i){const c=g.tileID,p=i.tileID;return c.overscaledZ-p.overscaledZ||c.canonical.y-p.canonical.y||c.wrap-p.wrap||c.canonical.x-p.canonical.x}function Jl(g,i){const c={};if(!i)return c;for(const p of g){const x=p.layerIds.map((w=>i.getLayer(w))).filter(Boolean);if(x.length!==0){p.layers=x,p.stateDependentLayerIds&&(p.stateDependentLayers=p.stateDependentLayerIds.map((w=>x.filter((A=>A.id===w))[0])));for(const w of x)c[w.fqid]=p}}return c}const Ua=32,xs=33,ja=new Uint16Array(8184);for(let g=0;g<2046;g++){let i=g+2,c=0,p=0,x=0,w=0,A=0,I=0;for(1&i?x=w=A=Ua:c=p=I=Ua;(i>>=1)>1;){const z=c+x>>1,k=p+w>>1;1&i?(x=c,w=p,c=A,p=I):(c=x,p=w,x=A,w=I),A=z,I=k}const O=4*g;ja[O+0]=c,ja[O+1]=p,ja[O+2]=x,ja[O+3]=w}const Qs=new Uint16Array(2178),Qo=new Uint8Array(1089),Gc=new Uint16Array(1089);function zf(g){return g===0?-.03125:g===32?.03125:0}const Ff={type:2,extent:n.al,loadGeometry:()=>[[new n.P(0,0),new n.P(n.al+1,0),new n.P(n.al+1,n.al+1),new n.P(0,n.al+1),new n.P(0,0)]]};class Hc{constructor(i,c,p,x,w,A){this.tileID=i,this.uid=n.b2(),this.uses=0,this.tileSize=c,this.tileZoom=p,this.buckets={},this.expirationTime=null,this.queryPadding=0,this.hasSymbolBuckets=!1,this.hasRTLText=!1,this.dependencies={},this.isRaster=w,x&&x.style&&(this._lastUpdatedBrightness=x.style.getBrightness()),this.expiredRequestCount=0,this.state="loading",x&&x.transform&&(this.projection=x.transform.projection),this.worldview=A}registerFadeDuration(i){const c=i+this.timeAdded;c<n.o.now()||this.fadeEndTime&&c<this.fadeEndTime||(this.fadeEndTime=c)}wasRequested(){return this.state==="errored"||this.state==="loaded"||this.state==="reloading"}get tileTransform(){return this._tileTransform||(this._tileTransform=n.aZ(this.tileID.canonical,this.projection)),this._tileTransform}loadVectorData(i,c,p){if(this.unloadVectorData(),this.state="loaded",i){i.featureIndex&&(this.latestFeatureIndex=i.featureIndex,i.rawTileData?(this.latestRawTileData=i.rawTileData,this.latestFeatureIndex.rawTileData=i.rawTileData):this.latestRawTileData&&(this.latestFeatureIndex.rawTileData=this.latestRawTileData)),this.collisionBoxArray=i.collisionBoxArray,this.buckets=Jl(i.buckets,c.style),this.hasSymbolBuckets=!1;for(const x in this.buckets){const w=this.buckets[x];if(w instanceof n.b4){if(this.hasSymbolBuckets=!0,!p)break;w.justReloaded=!0}}if(this.hasRTLText=!1,this.hasSymbolBuckets)for(const x in this.buckets){const w=this.buckets[x];if(w instanceof n.b4&&w.hasRTLText){this.hasRTLText=!0,n.b5();break}}this.queryPadding=0;for(const x in this.buckets){const w=this.buckets[x],A=c.style.getOwnLayer(x);if(!A)continue;const I=A.queryRadius(w);this.queryPadding=Math.max(this.queryPadding,I)}i.imageAtlas&&(this.imageAtlas=i.imageAtlas),i.glyphAtlasImage&&(this.glyphAtlasImage=i.glyphAtlasImage),i.lineAtlas&&(this.lineAtlas=i.lineAtlas),this._lastUpdatedBrightness=i.brightness}else this.collisionBoxArray=new n.b3}unloadVectorData(){if(this.hasData()){for(const i in this.buckets)this.buckets[i].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&this.imageAtlasTexture.destroy(),this.glyphAtlasTexture&&this.glyphAtlasTexture.destroy(),this.lineAtlasTexture&&this.lineAtlasTexture.destroy(),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),this.latestFeatureIndex=null,this.state="unloaded"}}loadModelData(i,c,p){i&&(i.resourceTiming&&(this.resourceTiming=i.resourceTiming),this.buckets=Object.assign({},this.buckets,Jl(i.buckets,c.style)),i.featureIndex&&(this.latestFeatureIndex=i.featureIndex))}getBucket(i){return this.buckets[i.fqid]}upload(i){for(const x in this.buckets){const w=this.buckets[x];w.uploadPending()&&w.upload(i)}const c=i.gl,p=this.imageAtlas;p&&!p.uploaded&&(this.imageAtlasTexture=new n.T(i,p.image,c.RGBA8,{useMipmap:!!p.patternPositions.size}),this.imageAtlas.uploaded=!0),this.glyphAtlasImage&&(this.glyphAtlasTexture=new n.T(i,this.glyphAtlasImage,c.R8),this.glyphAtlasImage=null),this.lineAtlas&&!this.lineAtlas.uploaded&&(this.lineAtlasTexture=new n.T(i,this.lineAtlas.image,c.R8),this.lineAtlas.uploaded=!0)}prepare(i,c,p){if(this.imageAtlas&&this.imageAtlasTexture&&this.imageAtlas.patchUpdatedImages(i,this.imageAtlasTexture,p),!c||!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData)return;const x=c.style.getBrightness();(this._lastUpdatedBrightness||x)&&(this._lastUpdatedBrightness&&x&&Math.abs(this._lastUpdatedBrightness-x)<.001||(this.updateBuckets(c,this._lastUpdatedBrightness!==x),this._lastUpdatedBrightness=x))}queryRenderedFeatures(i,c,p,x,w,A){if(!this.latestFeatureIndex||!this.latestFeatureIndex.rawTileData&&!this.latestFeatureIndex.is3DTile)return{};const I=(function(O,z){const k=n.bq([],[.5*O.width,.5*-O.height,1]);return n.br(k,k,[1,-1,0]),n.aB(k,k,O.calculateProjMatrix(z.toUnwrapped())),Float32Array.from(k)})(w,this.tileID);return this.latestFeatureIndex.query(i,{tilespaceGeometry:c,pixelPosMatrix:I,transform:x,availableImages:p,tileTransform:this.tileTransform,worldview:this.worldview})}querySourceFeatures(i,c){const p=this.latestFeatureIndex;if(!p||!p.rawTileData)return;const x=p.loadVTLayers(),w=c?c.sourceLayer:"",A=x._geojsonTileLayer||x[w];if(!A)return;const I=n.b6(c&&c.filter),{z:O,x:z,y:k}=this.tileID.canonical,H={z:O,x:z,y:k};for(let V=0;V<A.length;V++){const X=A.feature(V);if(I.needGeometry){const re=n.b7(X,!0);if(!I.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),re,this.tileID.canonical))continue}else if(!I.filter(new n.ac(this.tileID.overscaledZ,{worldview:this.worldview}),X))continue;const Y=p.getId(X,w),W=new n.b8(X,O,z,k,Y);W.tile=H,i.push(W)}}loaded(){return this.state==="loaded"||this.state==="errored"}hasData(){return this.state==="loaded"||this.state==="reloading"||this.state==="expired"}patternsLoaded(){return!!this.imageAtlas&&!!this.imageAtlas.patternPositions.size}setExpiryData(i){const c=this.expirationTime;if(i.cacheControl){const p=n.b9(i.cacheControl);p["max-age"]&&(this.expirationTime=Date.now()+1e3*p["max-age"])}else i.expires&&(this.expirationTime=new Date(i.expires).getTime());if(this.expirationTime){const p=Date.now();let x=!1;if(this.expirationTime>p)x=!1;else if(c)if(this.expirationTime<c)x=!0;else{const w=this.expirationTime-c;w?this.expirationTime=p+Math.max(w,3e4):x=!0}else x=!0;x?(this.expiredRequestCount++,this.state="expired"):this.expiredRequestCount=0}}getExpiryTimeout(){if(this.expirationTime)return this.expiredRequestCount?1e3*(1<<Math.min(this.expiredRequestCount-1,31)):Math.min(this.expirationTime-new Date().getTime(),Math.pow(2,31)-1)}refreshFeatureState(i){this.latestFeatureIndex&&(this.latestFeatureIndex.rawTileData||this.latestFeatureIndex.is3DTile)&&i&&this.updateBuckets(i)}updateBuckets(i,c){if(!this.latestFeatureIndex||!i.style)return;const p=this.latestFeatureIndex.loadVTLayers(),x=i.style.listImages(),w=i.style.getBrightness();for(const A in this.buckets){if(!i.style.hasLayer(A))continue;const I=this.buckets[A],O=I.layers[0],z=O.sourceLayer||"_geojsonTileLayer",k=p[z],H=i.style.getLayerSourceCache(O);let V={};H&&(V=H._state.getState(z,void 0));const X=this.imageAtlas?Object.fromEntries(this.imageAtlas.patternPositions):{},Y=Object.keys(V).length>0&&!c;(Y&&I.stateDependentLayers.length!==0||c)&&I.update(V,k,x,X,Y?I.stateDependentLayers:I.layers,c,w),(I instanceof n.ba||I instanceof n.bb)&&i._terrain&&i._terrain.enabled&&H&&I.uploadPending()&&i._terrain._clearRenderCacheForTile(H.id,this.tileID);const W=i&&i.style&&i.style.getOwnLayer(A);W&&(this.queryPadding=Math.max(this.queryPadding,W.queryRadius(I)))}}holdingForFade(){return this.symbolFadeHoldUntil!==void 0}symbolFadeFinished(){return!this.symbolFadeHoldUntil||this.symbolFadeHoldUntil<n.o.now()}clearFadeHold(){this.symbolFadeHoldUntil=void 0}setHoldDuration(i){this.symbolFadeHoldUntil=n.o.now()+i}setTexture(i,c){const p=c.context,x=p.gl;this.texture=this.texture||c.getTileTexture(i.width),this.texture&&this.texture instanceof n.T?this.texture.update(i):(this.texture=new n.T(p,i,x.RGBA8,{useMipmap:!0}),this.texture.bind(x.LINEAR,x.CLAMP_TO_EDGE))}setDependencies(i,c){const p={};for(const x of c)p[x]=!0;this.dependencies[i]=p}hasDependency(i,c){for(const p of i){const x=this.dependencies[p];if(x){for(const w of c)if(x[w])return!0}}return!1}clearQueryDebugViz(){}_makeDebugTileBoundsBuffers(i,c){if(!c||c.name==="mercator"||this._tileDebugBuffer)return;const p=n.bc(Ff,this.tileID.canonical,this.tileTransform)[0],x=new n.bd,w=new n.be;for(let A=0;A<p.length;A++){const{x:I,y:O}=p[A];x.emplaceBack(I,O),w.emplaceBack(A)}w.emplaceBack(0),this._tileDebugIndexBuffer=i.createIndexBuffer(w),this._tileDebugBuffer=i.createVertexBuffer(x,n.bf.members),this._tileDebugSegments=n.bg.simpleSegment(0,0,x.length,w.length)}_makeTileBoundsBuffers(i,c){if(this._tileBoundsBuffer||!c||c.name==="mercator")return;const p=n.bc(Ff,this.tileID.canonical,this.tileTransform)[0];let x,w;if(this.isRaster){const A=(function(I,O){const z=n.aZ(I,O),k=Math.pow(2,I.z);for(let re=0;re<xs;re++)for(let K=0;K<xs;K++){const ae=n.a_((I.x+(K+zf(K))/Ua)/k),ue=n.a$((I.y+(re+zf(re))/Ua)/k),fe=O.project(ae,ue),xe=re*xs+K;Qs[2*xe+0]=Math.round((fe.x*z.scale-z.x)*n.al),Qs[2*xe+1]=Math.round((fe.y*z.scale-z.y)*n.al)}Qo.fill(0),Gc.fill(0);for(let re=2045;re>=0;re--){const K=4*re,ae=ja[K+0],ue=ja[K+1],fe=ja[K+2],xe=ja[K+3],ge=ae+fe>>1,Te=ue+xe>>1,ye=ge+Te-ue,_e=Te+ae-ge,Se=ue*xs+ae,He=xe*xs+fe,ze=Te*xs+ge,nt=Math.hypot((Qs[2*Se+0]+Qs[2*He+0])/2-Qs[2*ze+0],(Qs[2*Se+1]+Qs[2*He+1])/2-Qs[2*ze+1])>=16;Qo[ze]=Qo[ze]||(nt?1:0),re<1022&&(Qo[ze]=Qo[ze]||Qo[(ue+_e>>1)*xs+(ae+ye>>1)]||Qo[(xe+_e>>1)*xs+(fe+ye>>1)])}const H=new n.b0,V=new n.b1;let X=0;function Y(re,K){const ae=K*xs+re;return Gc[ae]===0&&(H.emplaceBack(Qs[2*ae+0],Qs[2*ae+1],re*n.al/Ua,K*n.al/Ua),Gc[ae]=++X),Gc[ae]-1}function W(re,K,ae,ue,fe,xe){const ge=re+ae>>1,Te=K+ue>>1;if(Math.abs(re-fe)+Math.abs(K-xe)>1&&Qo[Te*xs+ge])W(fe,xe,re,K,ge,Te),W(ae,ue,fe,xe,ge,Te);else{const ye=Y(re,K),_e=Y(ae,ue),Se=Y(fe,xe);V.emplaceBack(ye,_e,Se)}}return W(0,0,Ua,Ua,Ua,0),W(Ua,Ua,0,0,0,Ua),{vertices:H,indices:V}})(this.tileID.canonical,c);x=A.vertices,w=A.indices}else{x=new n.b0,w=new n.b1;for(const{x:I,y:O}of p)x.emplaceBack(I,O,0,0);const A=n.bh(x.int16.subarray(0,4*x.length),void 0,4);for(let I=0;I<A.length;I+=3)w.emplaceBack(A[I],A[I+1],A[I+2])}this._tileBoundsBuffer=i.createVertexBuffer(x,n.bi.members),this._tileBoundsIndexBuffer=i.createIndexBuffer(w),this._tileBoundsSegments=n.bg.simpleSegment(0,0,x.length,w.length)}_makeGlobeTileDebugBuffers(i,c){const p=c.projection;if(!p||p.name!=="globe"||c.freezeTileCoverage)return;const x=this.tileID.canonical,w=n.bj(x,c),A=n.bk(w),I=n.aj(c.zoom);let O;I>0&&(O=n.bl(new Float64Array(16),c.globeMatrix)),this._makeGlobeTileDebugBorderBuffer(i,x,c,A,O,I),this._makeGlobeTileDebugTextBuffer(i,x,c,A,O,I)}_globePoint(i,c,p,x,w,A,I){let O=n.bm(i,c,p);if(A){const z=1<<p.z,k=n.aF(x.center.lng),H=n.aJ(x.center.lat),V=(p.x+.5)/z-k;let X=0;V>.5?X=-1:V<-.5&&(X=1);let Y=(i/n.al+p.x)/z+X,W=(c/n.al+p.y)/z;Y=(Y-k)*x._pixelsPerMercatorPixel+k,W=(W-H)*x._pixelsPerMercatorPixel+H;const re=[Y*x.worldSize,W*x.worldSize,0];n.af(re,re,A),O=n.bn(O,re,I)}return n.af(O,O,w)}_makeGlobeTileDebugBorderBuffer(i,c,p,x,w,A){const I=new n.bd,O=new n.be,z=new n.bo,k=(V,X,Y,W,re)=>{const K=(Y-V)/(re-1),ae=(W-X)/(re-1),ue=I.length;for(let fe=0;fe<re;fe++){const xe=V+fe*K,ge=X+fe*ae;I.emplaceBack(xe,ge);const Te=this._globePoint(xe,ge,c,p,x,w,A);z.emplaceBack(Te[0],Te[1],Te[2]),O.emplaceBack(ue+fe)}},H=n.al;k(0,0,H,0,16),k(H,0,H,H,16),k(H,H,0,H,16),k(0,H,0,0,16),this._tileDebugIndexBuffer=i.createIndexBuffer(O),this._tileDebugBuffer=i.createVertexBuffer(I,n.bf.members),this._globeTileDebugBorderBuffer=i.createVertexBuffer(z,n.bp.members),this._tileDebugSegments=n.bg.simpleSegment(0,0,I.length,O.length)}_makeGlobeTileDebugTextBuffer(i,c,p,x,w,A){const I=n.al/4,O=new n.bd,z=new n.b1,k=new n.bo,H=25;z.reserve(32),O.reserve(H),k.reserve(H);const V=(X,Y)=>H*X+Y;for(let X=0;X<H;X++){const Y=X*I;for(let W=0;W<H;W++){const re=W*I;O.emplaceBack(re,Y);const K=this._globePoint(re,Y,c,p,x,w,A);k.emplaceBack(K[0],K[1],K[2])}}for(let X=0;X<4;X++)for(let Y=0;Y<4;Y++){const W=V(X,Y),re=V(X,Y+1),K=V(X+1,Y),ae=V(X+1,Y+1);z.emplaceBack(W,re,K),z.emplaceBack(K,re,ae)}this._tileDebugTextIndexBuffer=i.createIndexBuffer(z),this._tileDebugTextBuffer=i.createVertexBuffer(O,n.bf.members),this._globeTileDebugTextBuffer=i.createVertexBuffer(k,n.bp.members),this._tileDebugTextSegments=n.bg.simpleSegment(0,0,H,32)}destroy(i=!1){for(const c in this.buckets)this.buckets[c].destroy();this.buckets={},this.imageAtlas&&(this.imageAtlas=null),this.lineAtlas&&(this.lineAtlas=null),this.imageAtlasTexture&&(this.imageAtlasTexture.destroy(),delete this.imageAtlasTexture),this.glyphAtlasTexture&&(this.glyphAtlasTexture.destroy(),delete this.glyphAtlasTexture),this.lineAtlasTexture&&(this.lineAtlasTexture.destroy(),delete this.lineAtlasTexture),this._tileBoundsBuffer&&(this._tileBoundsBuffer.destroy(),this._tileBoundsIndexBuffer.destroy(),this._tileBoundsSegments.destroy(),this._tileBoundsBuffer=null),this._tileDebugBuffer&&(this._tileDebugBuffer.destroy(),this._tileDebugSegments.destroy(),this._tileDebugBuffer=null),this._tileDebugIndexBuffer&&(this._tileDebugIndexBuffer.destroy(),this._tileDebugIndexBuffer=null),this._globeTileDebugBorderBuffer&&(this._globeTileDebugBorderBuffer.destroy(),this._globeTileDebugBorderBuffer=null),this._tileDebugTextBuffer&&(this._tileDebugTextBuffer.destroy(),this._tileDebugTextSegments.destroy(),this._tileDebugTextIndexBuffer.destroy(),this._tileDebugTextBuffer=null),this._globeTileDebugTextBuffer&&(this._globeTileDebugTextBuffer.destroy(),this._globeTileDebugTextBuffer=null),!i&&this.texture&&this.texture instanceof n.T&&(this.texture.destroy(),delete this.texture),this.hillshadeFBO&&(this.hillshadeFBO.destroy(),delete this.hillshadeFBO),this.dem&&delete this.dem,this.neighboringTiles&&delete this.neighboringTiles,this.demTexture&&(this.demTexture.destroy(),delete this.demTexture),this.rasterParticleState&&(this.rasterParticleState.destroy(),delete this.rasterParticleState),this.latestFeatureIndex=null,this.state="unloaded"}}n.bs.setPbf(n.bt);class qc extends Hc{constructor(i,c,p,x,w){super(i,c,p,x,w),this._workQueuePerLayer=new Map,this._fetchQueuePerLayer=new Map,this._taskQueue=new Map,this._isHeaderLoaded=!1,this.textureDescriptorPerLayer=new Map,this.texturePerLayer=new Map}getLayers(){return this._mrt?Object.values(this._mrt.layers):[]}getLayer(i){return this._mrt&&this._mrt.getLayer(i)}setTexturePerLayer(i,c,p){const x=p.context,w=x.gl;let A=this.texturePerLayer.get(i)||p.getTileTexture(c.width);A&&A instanceof n.T?A.update(c,{premultiply:!1}):A=new n.T(x,c,w.RGBA8,{premultiply:!1}),this.texturePerLayer.has(i)||this.texturePerLayer.set(i,A)}flushQueues(i){const c=this._workQueuePerLayer.get(i)||[],p=this._fetchQueuePerLayer.get(i)||[];for(;c.length;)c.pop()();for(;p.length;)p.pop()()}flushAllQueues(){for(const i of this._workQueuePerLayer.keys()){const c=this._workQueuePerLayer.get(i)||[];for(;c.length;)c.pop()()}for(const i of this._fetchQueuePerLayer.keys()){const c=this._fetchQueuePerLayer.get(i)||[];for(;c.length;)c.pop()()}}fetchHeader(i=16384,c){const p=this._mrt=new n.bs(30),x=Object.assign({},this.requestParams,{headers:{Range:"bytes=0-"+(i-1)}});return this.entireBuffer=null,this.request=n.bu(x,((w,A,I,O)=>{if(w)c(w);else try{const z=p.getHeaderLength(A);if(z>i)return void(this.request=this.fetchHeader(z,c));p.parseHeader(A),this._isHeaderLoaded=!0;let k=0;for(const H of Object.values(p.layers))k=Math.max(k,H.dataIndex[H.dataIndex.length-1].lastByte);A.byteLength>=k&&(this.entireBuffer=A),c(null,this.entireBuffer||A,I,O)}catch(z){c(z)}})),this.request}fetchBandForRender(i,c,p,x){this.fetchBand(i,c,p,(w=>{if(w)return void x(w);this.updateTextureDescriptor(i,c,p);const A=this.textureDescriptorPerLayer.get(c);x(null,A?A.img:null)}))}fetchBand(i,c,p,x,w=!0){const A=this._mrt;if(!this._isHeaderLoaded||!A)return void x(new Error("Tile header is not ready"));const I=this.actor;if(!I)return void x(new Error("Can't fetch tile band without an actor"));let O;const z=n.B(String(p),n.B(this.tileID.key,i));let k=this._taskQueue.get(z);k?k.add(x):(k=new Set,k.add(x),this._taskQueue.set(z,k));const H=(W,re)=>{O.complete(W,re),W?x(W):(k.values().forEach((K=>K(null,re))),this._taskQueue.delete(z))},V=(W,re)=>{if(W)return x(W);const K=I.send("decodeRasterArray",{type:"raster-array",source:this.source,scope:this.scope,tileID:this.tileID,uid:this.uid,buffer:re,task:O},H,void 0,!0);if(c!==null){const ae=this._workQueuePerLayer.get(c)||[];ae.push((()=>{K&&K.cancel(),O.cancel()})),this._workQueuePerLayer.has(c)||this._workQueuePerLayer.set(c,ae)}};let X;try{X=A.getLayer(i)}catch(W){if(this.state==="reloading")return;throw W}if(!X)return void x(new Error(`Unknown sourceLayer "${i}"`));if(X.hasDataForBand(p))return k.values().forEach((W=>W(null,null))),void this._taskQueue.delete(z);const Y=X.getDataRange([p]);if(O=A.createDecodingTask(Y),!O||O.tasks.length)if(c!==null&&this.flushQueues(c),this.entireBuffer)V(null,this.entireBuffer.slice(Y.firstByte,Y.lastByte+1));else{const W=Object.assign({},this.requestParams,{headers:{Range:`bytes=${Y.firstByte}-${Y.lastByte}`}}),re=n.bu(W,V);if(c!==null){const K=this._fetchQueuePerLayer.get(c)||[];K.push((()=>{re.cancel(),O.cancel()})),this._fetchQueuePerLayer.has(c)||this._fetchQueuePerLayer.set(c,K)}}}updateNeeded(i,c){return(!this.textureDescriptorPerLayer.get(i)||this.textureDescriptorPerLayer.get(i).band!==c||this.refreshedUponExpiration)&&this.state!=="errored"}updateTextureDescriptor(i,c,p){if(!this._mrt)return;const x=this._mrt.getLayer(i);if(!x||!x.hasBand(p)||!x.hasDataForBand(p))return;const{bytes:w,tileSize:A,buffer:I,offset:O,scale:z}=x.getBandView(p),k=A+2*I,H=new n.q({width:k,height:k},w),V=this.texturePerLayer.get(c);V&&V instanceof n.T&&V.update(H,{premultiply:!1}),this.textureDescriptorPerLayer.set(c,{layer:i,band:p,img:H,buffer:I,offset:O,tileSize:A,format:x.pixelFormat,mix:[z,256*z,65536*z,16777216*z]})}destroy(i=!1){if(super.destroy(i),delete this._mrt,!i)for(const c of this.texturePerLayer.values())c&&c instanceof n.T&&c.destroy();this.texturePerLayer.clear(),this.textureDescriptorPerLayer.clear(),this.fbo&&(this.fbo.destroy(),delete this.fbo),delete this.request,delete this.requestParams,this._isHeaderLoaded=!1}}class Nu{constructor(i,c){this.max=i,this.onRemove=c,this.reset()}reset(){for(const i in this.data)for(const c of this.data[i])c.timeout&&clearTimeout(c.timeout),this.onRemove(c.value);return this.data={},this.order=[],this}add(i,c,p){const x=i.wrapped().key;this.data[x]===void 0&&(this.data[x]=[]);const w={value:c,timeout:void 0};if(p!==void 0&&(w.timeout=setTimeout((()=>{this.remove(i,w)}),p)),this.data[x].push(w),this.order.push(x),this.order.length>this.max){const A=this._getAndRemoveByKey(this.order[0]);A&&this.onRemove(A)}return this}has(i){return i.wrapped().key in this.data}getAndRemove(i){return this.has(i)?this._getAndRemoveByKey(i.wrapped().key):null}_getAndRemoveByKey(i){const c=this.data[i].shift();return c.timeout&&clearTimeout(c.timeout),this.data[i].length===0&&delete this.data[i],this.order.splice(this.order.indexOf(i),1),c.value}getByKey(i){const c=this.data[i];return c?c[0].value:null}get(i){return this.has(i)?this.data[i.wrapped().key][0].value:null}remove(i,c){if(!this.has(i))return this;const p=i.wrapped().key,x=c===void 0?0:this.data[p].indexOf(c),w=this.data[p][x];return this.data[p].splice(x,1),w.timeout&&clearTimeout(w.timeout),this.data[p].length===0&&delete this.data[p],this.onRemove(w.value),this.order.splice(this.order.indexOf(p),1),this}setMaxSize(i){for(this.max=i;this.order.length>this.max;){const c=this._getAndRemoveByKey(this.order[0]);c&&this.onRemove(c)}return this}filter(i){const c=[];for(const p in this.data)for(const x of this.data[p])i(x.value)||c.push(x);for(const p of c)this.remove(p.value.tileID,p)}}class $c{constructor(){this.state={},this.stateChanges={},this.deletedStates={}}updateState(i,c,p){const x=String(c);if(this.stateChanges[i]=this.stateChanges[i]||{},this.stateChanges[i][x]=this.stateChanges[i][x]||{},Object.assign(this.stateChanges[i][x],p),this.deletedStates[i]===null){this.deletedStates[i]={};for(const w in this.state[i])w!==x&&(this.deletedStates[i][w]=null)}else if(this.deletedStates[i]&&this.deletedStates[i][x]===null){this.deletedStates[i][x]={};for(const w in this.state[i][x])p[w]||(this.deletedStates[i][x][w]=null)}else for(const w in p)this.deletedStates[i]&&this.deletedStates[i][x]&&this.deletedStates[i][x][w]===null&&delete this.deletedStates[i][x][w]}removeFeatureState(i,c,p){if(this.deletedStates[i]===null)return;const x=String(c);if(this.deletedStates[i]=this.deletedStates[i]||{},p&&c!==void 0)this.deletedStates[i][x]!==null&&(this.deletedStates[i][x]=this.deletedStates[i][x]||{},this.deletedStates[i][x][p]=null);else if(c!==void 0)if(this.stateChanges[i]&&this.stateChanges[i][x])for(p in this.deletedStates[i][x]={},this.stateChanges[i][x])this.deletedStates[i][x][p]=null;else this.deletedStates[i][x]=null;else this.deletedStates[i]=null}getState(i,c){const p=this.state[i]||{},x=this.stateChanges[i]||{},w=this.deletedStates[i];if(w===null)return{};if(c!==void 0){const I=String(c),O=Object.assign({},p[I],x[I]);if(w){const z=w[c];if(z===null)return{};for(const k in z)delete O[k]}return O}const A=Object.assign({},p,x);if(w)for(const I in w)delete A[I];return A}initializeTileState(i,c){i.refreshFeatureState(c)}coalesceChanges(i,c){const p={};for(const x in this.stateChanges){this.state[x]=this.state[x]||{};const w={};for(const A in this.stateChanges[x])this.state[x][A]||(this.state[x][A]={}),Object.assign(this.state[x][A],this.stateChanges[x][A]),w[A]=this.state[x][A];p[x]=w}for(const x in this.deletedStates){this.state[x]=this.state[x]||{};const w={};if(this.deletedStates[x]===null)for(const A in this.state[x])w[A]={},this.state[x][A]={};else for(const A in this.deletedStates[x]){if(this.deletedStates[x][A]===null)this.state[x][A]={};else if(this.state[x][A])for(const I of Object.keys(this.deletedStates[x][A]))delete this.state[x][A][I];w[A]=this.state[x][A]}p[x]=p[x]||{},Object.assign(p[x],w)}if(this.stateChanges={},this.deletedStates={},Object.keys(p).length!==0)for(const x in i)i[x].refreshFeatureState(c)}}class Uo extends n.E{constructor(i,c,p){super(),this.id=i,this._onlySymbols=p,c.on("data",(x=>{x.dataType==="source"&&x.sourceDataType==="metadata"&&(this._sourceLoaded=!0),this._sourceLoaded&&!this._paused&&x.dataType==="source"&&x.sourceDataType==="content"&&(this.reload(),this.transform&&this.update(this.transform))})),c.on("error",(()=>{this._sourceErrored=!0})),this._source=c,this._tiles={},this._cache=new Nu(0,this._unloadTile.bind(this)),this._timers={},this._cacheTimers={},this._minTileCacheSize=c.minTileCacheSize,this._maxTileCacheSize=c.maxTileCacheSize,this._loadedParentTiles={},this.castsShadows=!1,this.tileCoverLift=0,this._coveredTiles={},this._shadowCasterTiles={},this._state=new $c,this._isRaster=this._source.type==="raster"||this._source.type==="raster-dem"||this._source.type==="raster-array"||this._source.type==="custom"&&this._source._dataType==="raster"}onAdd(i){this.map=i,this._minTileCacheSize=this._minTileCacheSize===void 0&&i?i._minTileCacheSize:this._minTileCacheSize,this._maxTileCacheSize=this._maxTileCacheSize===void 0&&i?i._maxTileCacheSize:this._maxTileCacheSize}loaded(){if(this._sourceErrored)return!0;if(!this._sourceLoaded||!this._source.loaded())return!1;for(const i in this._tiles)if(!this._tiles[i].loaded())return!1;return!0}getSource(){return this._source}pause(){this._paused=!0}resume(){if(!this._paused)return;const i=this._shouldReloadOnResume;this._paused=!1,this._shouldReloadOnResume=!1,i&&this.reload(),this.transform&&this.update(this.transform)}_loadTile(i,c){return i.isSymbolTile=this._onlySymbols,i.isExtraShadowCaster=this._shadowCasterTiles[i.tileID.key],this._source.loadTile(i,c)}_unloadTile(i){if(this._source.unloadTile)return this._source.unloadTile(i)}_abortTile(i){if(this._source.abortTile)return this._source.abortTile(i)}serialize(){return this._source.serialize()}prepare(i){this._source.prepare&&this._source.prepare(),this._state.coalesceChanges(this._tiles,this.map?this.map.painter:null);for(const c in this._tiles){const p=this._tiles[c];p.upload(i),p.prepare(this.map.style.imageManager,this.map?this.map.painter:null,this._source.scope)}}getIds(){return Object.values(this._tiles).map((i=>i.tileID)).sort(Xc).map((i=>i.key))}getRenderableIds(i,c){const p=[];for(const x in this._tiles)this._isIdRenderable(+x,i,c)&&p.push(this._tiles[x]);return i?p.sort(((x,w)=>{const A=x.tileID,I=w.tileID,O=new n.P(A.canonical.x,A.canonical.y)._rotate(this.transform.angle),z=new n.P(I.canonical.x,I.canonical.y)._rotate(this.transform.angle);return A.overscaledZ-I.overscaledZ||z.y-O.y||z.x-O.x})).map((x=>x.tileID.key)):p.map((x=>x.tileID)).sort(Xc).map((x=>x.key))}hasRenderableParent(i){const c=this.findLoadedParent(i,0);return!!c&&this._isIdRenderable(c.tileID.key)}_isIdRenderable(i,c,p){return this._tiles[i]&&this._tiles[i].hasData()&&!this._coveredTiles[i]&&(c||!this._tiles[i].holdingForFade())&&(p||!this._shadowCasterTiles[i])}reload(){if(this._paused)this._shouldReloadOnResume=!0;else{this._cache.reset();for(const i in this._tiles)this._tiles[i].state!=="errored"&&this._reloadTile(+i,"reloading")}}_reloadTile(i,c){const p=this._tiles[i];p&&(p.state!=="loading"&&(p.state=c),this._loadTile(p,this._tileLoaded.bind(this,p,i,c)))}_tileLoaded(i,c,p,x){if(x)if(i.state="errored",x.status!==404)this._source.fire(new n.y(x,{tile:i}));else{if(this._source.fire(new n.z("data",{dataType:"source",sourceDataType:"error",sourceId:this._source.id,tile:i})),!(i.tileID.key in this._loadedParentTiles))return;if(this._source.type==="raster-dem"&&this.usedForTerrain&&this.map.painter.terrain){const w=this.map.painter.terrain;this.update(this.transform,w.getScaledDemTileSize(),!0),w.resetTileLookupCache(this.id)}else this.update(this.transform)}else i.timeAdded=n.o.now(),p==="expired"&&(i.refreshedUponExpiration=!0),this._setTileReloadTimer(c,i),this._source.type==="raster-dem"&&i.dem&&this._backfillDEM(i),this._state.initializeTileState(i,this.map?this.map.painter:null),this._source.fire(new n.z("data",{dataType:"source",tile:i,coord:i.tileID,sourceCacheId:this.id}))}_backfillDEM(i){const c=this.getRenderableIds();for(let x=0;x<c.length;x++){const w=c[x];if(i.neighboringTiles&&i.neighboringTiles[w]){const A=this.getTileByID(w);p(i,A),p(A,i)}}function p(x,w){if(!x.dem||x.dem.borderReady)return;x.needsHillshadePrepare=!0,x.needsDEMTextureUpload=!0;let A=w.tileID.canonical.x-x.tileID.canonical.x;const I=w.tileID.canonical.y-x.tileID.canonical.y,O=Math.pow(2,x.tileID.canonical.z),z=w.tileID.key;A===0&&I===0||Math.abs(I)>1||(Math.abs(A)>1&&(Math.abs(A+O)===1?A+=O:Math.abs(A-O)===1&&(A-=O)),w.dem&&x.dem&&(x.dem.backfillBorder(w.dem,A,I),x.neighboringTiles&&x.neighboringTiles[z]&&(x.neighboringTiles[z].backfilled=!0)))}}getTile(i){return this.getTileByID(i.key)}getTileByID(i){return this._tiles[i]}_retainLoadedChildren(i,c,p,x){for(const w in this._tiles){let A=this._tiles[w];if(x[w]||!A.hasData()||A.tileID.overscaledZ<=c||A.tileID.overscaledZ>p)continue;let I=A.tileID;for(;A&&A.tileID.overscaledZ>c+1;){const z=A.tileID.scaledTo(A.tileID.overscaledZ-1);A=this._tiles[z.key],A&&A.hasData()&&(I=z)}let O=I;for(;O.overscaledZ>c;)if(O=O.scaledTo(O.overscaledZ-1),i[O.key]){x[I.key]=I;break}}}findLoadedParent(i,c){if(i.key in this._loadedParentTiles){const p=this._loadedParentTiles[i.key];return p&&p.tileID.overscaledZ>=c?p:null}for(let p=i.overscaledZ-1;p>=c;p--){const x=i.scaledTo(p),w=this._getLoadedTile(x);if(w)return w}}_getLoadedTile(i){const c=this._tiles[i.key];return c&&c.hasData()?c:this._cache.getByKey(this._source.reparseOverscaled?i.wrapped().key:i.canonical.key)}updateCacheSize(i,c){c=c||this._source.tileSize;const p=Math.ceil(i.width/c)+1,x=Math.ceil(i.height/c)+1,w=Math.floor(p*x*5),A=typeof this._minTileCacheSize=="number"?Math.max(this._minTileCacheSize,w):w,I=typeof this._maxTileCacheSize=="number"?Math.min(this._maxTileCacheSize,A):A;this._cache.setMaxSize(I)}handleWrapJump(i){const c=Math.round((i-(this._prevLng===void 0?i:this._prevLng))/360);if(this._prevLng=i,c){const p={};for(const x in this._tiles){const w=this._tiles[x];w.tileID=w.tileID.unwrapTo(w.tileID.wrap+c),p[w.tileID.key]=w}this._tiles=p;for(const x in this._timers)clearTimeout(this._timers[x]),delete this._timers[x];for(const x in this._tiles)this._setTileReloadTimer(+x,this._tiles[x])}}update(i,c,p,x,w){if(this.transform=i,!this._sourceLoaded||this._paused||this.transform.freezeTileCoverage||this.usedForTerrain&&!p)return;this.updateCacheSize(i,c),this.transform.projection.name!=="globe"&&this.handleWrapJump(this.transform.center.lng),this._shadowCasterTiles={},this._coveredTiles={};const A=this._source.type==="batched-model";let I,O=this._source.maxzoom;const z=this.map&&this.map.painter?this.map.painter._terrain:null;if(z&&z.sourceCache===this&&z.attenuationRange()){const V=z.attenuationRange()[0],X=Math.floor(V)-Math.log2(z.getDemUpscale());O>X&&(O=X)}if(this.used||this.usedForTerrain){if(this._source.tileID)I=i.getVisibleUnwrappedCoordinates(this._source.tileID).map((V=>new n.aO(V.canonical.z,V.wrap,V.canonical.z,V.canonical.x,V.canonical.y)));else if(this.tileCoverLift!==0){const V=i.clone();V.tileCoverLift=this.tileCoverLift,I=V.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:A}),this._source.minzoom<=1&&i.projection.name==="globe"&&(I.push(new n.aO(1,0,1,0,0)),I.push(new n.aO(1,0,1,1,0)),I.push(new n.aO(1,0,1,0,1)),I.push(new n.aO(1,0,1,1,1)))}else if(I=i.coveringTiles({tileSize:c||this._source.tileSize,minzoom:this._source.minzoom,maxzoom:O,roundZoom:this._source.roundZoom&&!p,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain,calculateQuadrantVisibility:A}),this._source.hasTile){const V=this._source.hasTile.bind(this._source);I=I.filter((X=>V(X)))}}else I=[];if(I.length>0&&this.transform.projection.name!=="globe"&&!this.usedForTerrain&&!kf(this._source.type)){const V=i.coveringZoomLevel({tileSize:c||this._source.tileSize,roundZoom:this._source.roundZoom&&!p}),X=Math.min(V,this._source.maxzoom);if(A){const Y=i.extendTileCover(I,X);for(const W of Y)I.push(W)}else if(w){const Y=i.extendTileCoverToNearPlane(I,this.transform.getFrustum(X),X);for(const W of Y)I.push(W)}else if(this.castsShadows&&x){const Y=i.extendTileCover(I,X,x);for(const W of Y)this._shadowCasterTiles[W.key]=!0,I.push(W)}}const k=this._updateRetainedTiles(I);if(kf(this._source.type)&&I.length!==0){const V={},X={},Y=Object.keys(k);for(const re of Y){const K=k[re],ae=this._tiles[re];if(!ae||ae.fadeEndTime&&ae.fadeEndTime<=n.o.now())continue;const ue=this.findLoadedParent(K,Math.max(K.overscaledZ-Uo.maxOverzooming,this._source.minzoom));ue&&(this._addTile(ue.tileID),V[ue.tileID.key]=ue.tileID),X[re]=K}const W=I[I.length-1].overscaledZ;for(const re in this._tiles){const K=this._tiles[re];if(k[re]||!K.hasData())continue;let ae=K.tileID;for(;ae.overscaledZ>W;){ae=ae.scaledTo(ae.overscaledZ-1);const ue=this._tiles[ae.key];if(ue&&ue.hasData()&&X[ae.key]){k[re]=K.tileID;break}}}for(const re in V)k[re]||(this._coveredTiles[re]=!0,k[re]=V[re])}for(const V in k)this._tiles[V].clearFadeHold();const H=n.bv(this._tiles,k);for(const V of H){const X=this._tiles[V];X.hasSymbolBuckets&&!X.holdingForFade()?X.setHoldDuration(this.map._fadeDuration):X.hasSymbolBuckets&&!X.symbolFadeFinished()||this._removeTile(+V)}this._updateLoadedParentTileCache(),this._onlySymbols&&this._source.afterUpdate&&this._source.afterUpdate()}releaseSymbolFadeTiles(){for(const i in this._tiles)this._tiles[i].holdingForFade()&&this._removeTile(+i)}_updateRetainedTiles(i){const c={};if(i.length===0)return c;const p={},x=i.reduce(((z,k)=>Math.min(z,k.overscaledZ)),1/0),w=i[0].overscaledZ,A=Math.max(w-Uo.maxOverzooming,this._source.minzoom),I=Math.max(w+Uo.maxUnderzooming,this._source.minzoom),O={};for(const z of i){const k=this._addTile(z);c[z.key]=z,k.hasData()||x<this._source.maxzoom&&(O[z.key]=z)}this._retainLoadedChildren(O,x,I,c);for(const z of i){let k=this._tiles[z.key];if(k.hasData())continue;if(z.canonical.z>=this._source.maxzoom){const V=z.children(this._source.maxzoom)[0],X=this.getTile(V);if(X&&X.hasData()){c[V.key]=V;continue}}else{const V=z.children(this._source.maxzoom);if(c[V[0].key]&&c[V[1].key]&&c[V[2].key]&&c[V[3].key])continue}let H=k.wasRequested();for(let V=z.overscaledZ-1;V>=A;--V){const X=z.scaledTo(V);if(p[X.key]||(p[X.key]=!0,k=this.getTile(X),!k&&H&&(k=this._addTile(X)),k&&(c[X.key]=X,H=k.wasRequested(),k.hasData())))break}}return c}_updateLoadedParentTileCache(){this._loadedParentTiles={};for(const i in this._tiles){const c=[];let p,x=this._tiles[i].tileID;for(;x.overscaledZ>0;){if(x.key in this._loadedParentTiles){p=this._loadedParentTiles[x.key];break}c.push(x.key);const w=x.scaledTo(x.overscaledZ-1);if(p=this._getLoadedTile(w),p)break;x=w}for(const w of c)this._loadedParentTiles[w]=p}}_addTile(i){let c=this._tiles[i.key];if(c)return c.isExtraShadowCaster!==!0||this._shadowCasterTiles[i.key]||this._reloadTile(i.key,"reloading"),c;c=this._cache.getAndRemove(i),c&&(this._setTileReloadTimer(i.key,c),c.tileID=i,this._state.initializeTileState(c,this.map?this.map.painter:null),this._cacheTimers[i.key]&&(clearTimeout(this._cacheTimers[i.key]),delete this._cacheTimers[i.key],this._setTileReloadTimer(i.key,c)));const p=!!c;if(!p){const x=this.map?this.map.painter:null,w=this._source.tileSize*i.overscaleFactor();c=this._source.type==="raster-array"?new qc(i,w,this.transform.tileZoom,x,this._isRaster):new Hc(i,w,this.transform.tileZoom,x,this._isRaster,this._source.worldview),this._loadTile(c,this._tileLoaded.bind(this,c,i.key,c.state))}return c.uses++,this._tiles[i.key]=c,p||this._source.fire(new n.z("dataloading",{tile:c,coord:c.tileID,dataType:"source"})),c}_setTileReloadTimer(i,c){i in this._timers&&(clearTimeout(this._timers[i]),delete this._timers[i]);const p=c.getExpiryTimeout();p&&(this._timers[i]=setTimeout((()=>{this._reloadTile(i,"expired"),delete this._timers[i]}),p))}_removeTile(i){const c=this._tiles[i];c&&(c.uses--,delete this._tiles[i],this._timers[i]&&(clearTimeout(this._timers[i]),delete this._timers[i]),c.uses>0||(c.hasData()&&c.state!=="reloading"||c.state==="empty"?this._cache.add(c.tileID,c,c.getExpiryTimeout()):(c.aborted=!0,this._abortTile(c),this._unloadTile(c))))}clearTiles(){this._shouldReloadOnResume=!1,this._paused=!1;for(const i in this._tiles)this._removeTile(+i);this._source._clear&&this._source._clear(),this._cache.reset(),this.map&&this.usedForTerrain&&this.map.painter.terrain&&this.map.painter.terrain.resetTileLookupCache(this.id)}tilesIn(i,c,p){const x=[],w=this.transform;if(!w)return x;const A=w.projection.name==="globe",I=n.aF(w.center.lng);for(const O in this._tiles){const z=this._tiles[O];if(p&&z.clearQueryDebugViz(),z.holdingForFade())continue;let k;if(A){const H=z.tileID.canonical;if(H.z===0){const V=[Math.abs(n.aA(I,...Zc(H,-1))-I),Math.abs(n.aA(I,...Zc(H,1))-I)];k=[0,2*V.indexOf(Math.min(...V))-1]}else{const V=[Math.abs(n.aA(I,...Zc(H,-1))-I),Math.abs(n.aA(I,...Zc(H,0))-I),Math.abs(n.aA(I,...Zc(H,1))-I)];k=[V.indexOf(Math.min(...V))-1]}}else k=[0];for(const H of k){const V=i.containsTile(z,w,c,H);V&&x.push(V)}}return x}getShadowCasterCoordinates(){return this._getRenderableCoordinates(!1,!0)}getVisibleCoordinates(i){return this._getRenderableCoordinates(i)}_getRenderableCoordinates(i,c){const p=this.getRenderableIds(i,c).map((w=>this._tiles[w].tileID)),x=this.transform.projection.name==="globe";for(const w of p)w.projMatrix=this.transform.calculateProjMatrix(w.toUnwrapped()),w.expandedProjMatrix=x?this.transform.calculateProjMatrix(w.toUnwrapped(),!1,!0):w.projMatrix;return p}sortCoordinatesByDistance(i){const c=i.slice(),p=this.transform._camera.position,x=this.transform._camera.forward(),w={};for(const A of c){const I=1/(1<<A.canonical.z);w[A.key]=((A.canonical.x+.5)*I+A.wrap-p[0])*x[0]+((A.canonical.y+.5)*I-p[1])*x[1]-p[2]*x[2]}return c.sort(((A,I)=>w[A.key]-w[I.key])),c}hasTransition(){if(this._source.hasTransition())return!0;if(kf(this._source.type))for(const i in this._tiles){const c=this._tiles[i];if(c.fadeEndTime!==void 0&&c.fadeEndTime>=n.o.now())return!0}return!1}setFeatureState(i,c,p){this._state.updateState(i=i||"_geojsonTileLayer",c,p)}removeFeatureState(i,c,p){this._state.removeFeatureState(i=i||"_geojsonTileLayer",c,p)}getFeatureState(i,c){return this._state.getState(i=i||"_geojsonTileLayer",c)}setDependencies(i,c,p){const x=this._tiles[i];x&&x.setDependencies(c,p)}reloadTilesForDependencies(i,c){for(const p in this._tiles)this._tiles[p].hasDependency(i,c)&&this._reloadTile(+p,"reloading");this._cache.filter((p=>!p.hasDependency(i,c)))}_preloadTiles(i,c){if(!this._sourceLoaded){const O=()=>{this._sourceLoaded&&(this._source.off("data",O),this._preloadTiles(i,c))};return void this._source.on("data",O)}const p=new Map,x=Array.isArray(i)?i:[i],w=this.map.painter.terrain,A=this.usedForTerrain&&w?w.getScaledDemTileSize():this._source.tileSize;for(const O of x){const z=O.coveringTiles({tileSize:A,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom&&!this.usedForTerrain,reparseOverscaled:this._source.reparseOverscaled,isTerrainDEM:this.usedForTerrain});for(const k of z)p.set(k.key,k);this.usedForTerrain&&O.updateElevation(!1)}const I=Array.from(p.values());n.bw(I,((O,z)=>{const k=new Hc(O,this._source.tileSize*O.overscaleFactor(),this.transform.tileZoom,this.map.painter,this._isRaster,this._source.worldview);this._loadTile(k,(H=>{this._source.type==="raster-dem"&&k.dem&&this._backfillDEM(k),z(H,k)}))}),c)}}function Xc(g,i){const c=Math.abs(2*g.wrap)-+(g.wrap<0),p=Math.abs(2*i.wrap)-+(i.wrap<0);return g.overscaledZ-i.overscaledZ||p-c||i.canonical.y-g.canonical.y||i.canonical.x-g.canonical.x}function kf(g){return g==="raster"||g==="image"||g==="video"||g==="custom"}function Zc(g,i){const c=1<<g.z;return[g.x/c+i,(g.x+1)/c+i]}Uo.maxOverzooming=10,Uo.maxUnderzooming=3;class Nf{constructor(i){this.style=i,this.layersGotHidden=!1,this.layers=[]}processLayersChanged(){this.layers=[];const i=!1,c=!1;for(const p in this.style._mergedLayers){const x=this.style._mergedLayers[p];if(x.type==="fill-extrusion"||x.type==="building")this.layers.push({layer:x,visible:i,visibilityChanged:c});else if(x.type==="model"){const w=this.style.getLayerSource(x);w&&w.type==="batched-model"&&this.layers.push({layer:x,visible:i,visibilityChanged:c})}}}onNewFrame(i){this.layersGotHidden=!1;for(const c of this.layers){const p=c.layer;let x=!1;p.type==="fill-extrusion"?x=!p.isHidden(i)&&p.paint.get("fill-extrusion-opacity")>0:p.type==="building"?x=!p.isHidden(i)&&p.paint.get("building-opacity")>0:p.type==="model"&&(x=!p.isHidden(i)&&p.paint.get("model-opacity").constantOr(1)>0),this.layersGotHidden=this.layersGotHidden||!x&&c.visible,c.visible=x}}updateZOffset(i,c){this.currentBuildingBuckets=[];for(const x of this.layers){const w=x.layer,A=this.style.getLayerSourceCache(w);let I=1;w.type==="fill-extrusion"?I=x.visible?w.paint.get("fill-extrusion-vertical-scale"):0:w.type==="building"&&(I=x.visible?w.paint.get("building-vertical-scale"):0);let O=A?A.getTile(c):null;if(!O&&A)for(const z in A._tiles){const k=A._tiles[z];if(c.canonical.isChildOf(k.tileID.canonical)){O=k;break}}this.currentBuildingBuckets.push({bucket:O?O.getBucket(w):null,tileID:O?O.tileID:c,verticalScale:I})}i.hasAnyZOffset=!1;let p=!1;for(let x=0;x<i.symbolInstances.length;x++){const w=i.symbolInstances.get(x),A=w.zOffset,I=this._getHeightAtTileOffset(c,w.tileAnchorX,w.tileAnchorY);w.zOffset=I!==Number.NEGATIVE_INFINITY?I:A,p||A===w.zOffset||(p=!0),i.hasAnyZOffset||w.zOffset===0||(i.hasAnyZOffset=!0)}p&&(i.zOffsetBuffersNeedUpload=!0,i.zOffsetSortDirty=!0)}_mapCoordToOverlappingTile(i,c,p,x){let w=c,A=p;if(i.canonical.z!==x.canonical.z){const I=x.canonical,O=1/(1<<i.canonical.z-I.z);w=(c+i.canonical.x*n.al)*O-I.x*n.al|0,A=(p+i.canonical.y*n.al)*O-I.y*n.al|0}return{tileX:w,tileY:A}}_getHeightAtTileOffset(i,c,p){let x,w;for(let A=0;A<this.layers.length;++A){const I=this.layers[A].layer;if(I.type!=="fill-extrusion"&&I.type!=="building")continue;const{bucket:O,tileID:z,verticalScale:k}=this.currentBuildingBuckets[A];if(!O)continue;const{tileX:H,tileY:V}=this._mapCoordToOverlappingTile(i,c,p,z),X=O.getHeightAtTileCoord(H,V);X&&X.height!==void 0&&(X.hidden?x=X.height:w=Math.max(X.height*k,w||0))}if(w!==void 0)return w;for(let A=0;A<this.layers.length;++A){const I=this.layers[A];if(I.layer.type!=="model"||!I.visible)continue;const{bucket:O,tileID:z}=this.currentBuildingBuckets[A];if(!O)continue;const{tileX:k,tileY:H}=this._mapCoordToOverlappingTile(i,c,p,z),V=O.getHeightAtTileCoord(k,H);if(V&&!V.hidden)return V.height===void 0&&x!==void 0?Math.min(V.maxHeight,x)*V.verticalScale:V.height?V.height*V.verticalScale:Number.NEGATIVE_INFINITY}return this.layersGotHidden?0:Number.NEGATIVE_INFINITY}}function Vu(g,i){const c={};for(const p in g)p!=="ref"&&(c[p]=g[p]);return n.bx.forEach((p=>{p in i&&(c[p]=i[p])})),c}function bs(g){g=g.slice();const i=Object.create(null);for(let c=0;c<g.length;c++)i[g[c].id]=g[c];for(let c=0;c<g.length;c++)"ref"in g[c]&&(g[c]=Vu(g[c],i[g[c].ref]));return g}const ai={setStyle:"setStyle",addLayer:"addLayer",removeLayer:"removeLayer",setPaintProperty:"setPaintProperty",setLayoutProperty:"setLayoutProperty",setSlot:"setSlot",setFilter:"setFilter",addSource:"addSource",removeSource:"removeSource",setGeoJSONSourceData:"setGeoJSONSourceData",setLayerZoomRange:"setLayerZoomRange",setLayerProperty:"setLayerProperty",setCenter:"setCenter",setZoom:"setZoom",setBearing:"setBearing",setPitch:"setPitch",setSprite:"setSprite",setGlyphs:"setGlyphs",setTransition:"setTransition",setLight:"setLight",setTerrain:"setTerrain",setFog:"setFog",setSnow:"setSnow",setRain:"setRain",setCamera:"setCamera",setLights:"setLights",setProjection:"setProjection",addImport:"addImport",removeImport:"removeImport",updateImport:"updateImport",addIconset:"addIconset",removeIconset:"removeIconset"};function yl(g,i,c){c.push({command:ai.addSource,args:[g,i[g]]})}function ec(g,i,c){i.push({command:ai.removeSource,args:[g]}),c[g]=!0}function jd(g,i,c,p){ec(g,c,p),yl(g,i,c)}function Uu(g,i,c){let p;for(p in g[c])if(g[c].hasOwnProperty(p)&&p!=="data"&&!n.by(g[c][p],i[c][p]))return!1;for(p in i[c])if(i[c].hasOwnProperty(p)&&p!=="data"&&!n.by(g[c][p],i[c][p]))return!1;return!0}function tc(g,i,c,p,x,w){let A;for(A in i=i||{},g=g||{})g.hasOwnProperty(A)&&(n.by(g[A],i[A])||c.push({command:w,args:[p,A,i[A],x]}));for(A in i)i.hasOwnProperty(A)&&!g.hasOwnProperty(A)&&(n.by(g[A],i[A])||c.push({command:w,args:[p,A,i[A],x]}))}function rc(g){return g.id}function Wc(g,i){return g[i.id]=i,g}function Vf(g,i,c){const p=i.createTileMatrix(g,g.worldSize,c.toUnwrapped());return n.aB(new Float32Array(16),g.projMatrix,p)}function xa(g,i,c){if(i.projection.name===c.projection.name)return g.projMatrix;const p=c.clone();return p.setProjection(i.projection),Vf(p,i.getProjection(),g)}function es(g,i,c){return i.name===c.projection.name?g.projMatrix:Vf(c,i,g)}class Uf{constructor(i,c){this.reset(i,c)}reset(i,c){this.points=i||[],this._distances=[0];for(let p=1;p<this.points.length;p++)this._distances[p]=this._distances[p-1]+this.points[p].dist(this.points[p-1]);this.length=this._distances[this._distances.length-1],this.padding=Math.min(c||0,.5*this.length),this.paddedLength=this.length-2*this.padding}lerp(i){if(this.points.length===1)return this.points[0];i=n.aA(i,0,1);let c=1,p=this._distances[c];const x=i*this.paddedLength+this.padding;for(;p<x&&c<this._distances.length;)p=this._distances[++c];const w=c-1,A=this._distances[w],I=p-A,O=I>0?(x-A)/I:0;return this.points[w].mult(1-O).add(this.points[c].mult(O))}}class ju{constructor(i,c,p){const x=this.boxCells=[],w=this.circleCells=[];this.xCellCount=Math.ceil(i/p),this.yCellCount=Math.ceil(c/p);for(let A=0;A<this.xCellCount*this.yCellCount;A++)x.push([]),w.push([]);this.circleKeys=[],this.boxKeys=[],this.bboxes=[],this.circles=[],this.width=i,this.height=c,this.xScale=this.xCellCount/i,this.yScale=this.yCellCount/c,this.boxUid=0,this.circleUid=0}keysLength(){return this.boxKeys.length+this.circleKeys.length}insert(i,c,p,x,w){this._forEachCell(c,p,x,w,this._insertBoxCell,this.boxUid++),this.boxKeys.push(i),this.bboxes.push(c),this.bboxes.push(p),this.bboxes.push(x),this.bboxes.push(w)}insertCircle(i,c,p,x){this._forEachCell(c-x,p-x,c+x,p+x,this._insertCircleCell,this.circleUid++),this.circleKeys.push(i),this.circles.push(c),this.circles.push(p),this.circles.push(x)}_insertBoxCell(i,c,p,x,w,A){this.boxCells[w].push(A)}_insertCircleCell(i,c,p,x,w,A){this.circleCells[w].push(A)}_query(i,c,p,x,w,A){if(p<0||i>this.width||x<0||c>this.height)return!w&&[];const I=[];if(i<=0&&c<=0&&this.width<=p&&this.height<=x){if(w)return!0;for(let O=0;O<this.boxKeys.length;O++)I.push({key:this.boxKeys[O],x1:this.bboxes[4*O],y1:this.bboxes[4*O+1],x2:this.bboxes[4*O+2],y2:this.bboxes[4*O+3]});for(let O=0;O<this.circleKeys.length;O++){const z=this.circles[3*O],k=this.circles[3*O+1],H=this.circles[3*O+2];I.push({key:this.circleKeys[O],x1:z-H,y1:k-H,x2:z+H,y2:k+H})}return A?I.filter(A):I}return this._forEachCell(i,c,p,x,this._queryCell,I,{hitTest:w,seenUids:{box:{},circle:{}}},A),w?I.length>0:I}_queryCircle(i,c,p,x,w){const A=i-p,I=i+p,O=c-p,z=c+p;if(I<0||A>this.width||z<0||O>this.height)return!x&&[];const k=[];return this._forEachCell(A,O,I,z,this._queryCellCircle,k,{hitTest:x,circle:{x:i,y:c,radius:p},seenUids:{box:{},circle:{}}},w),x?k.length>0:k}query(i,c,p,x,w){return this._query(i,c,p,x,!1,w)}hitTest(i,c,p,x,w){return this._query(i,c,p,x,!0,w)}hitTestCircle(i,c,p,x){return this._queryCircle(i,c,p,!0,x)}_queryCell(i,c,p,x,w,A,I,O){const z=I.seenUids,k=this.boxCells[w];if(k!==null){const V=this.bboxes;for(const X of k)if(!z.box[X]){z.box[X]=!0;const Y=4*X;if(i<=V[Y+2]&&c<=V[Y+3]&&p>=V[Y+0]&&x>=V[Y+1]&&(!O||O(this.boxKeys[X]))){if(I.hitTest)return A.push(!0),!0;A.push({key:this.boxKeys[X],x1:V[Y],y1:V[Y+1],x2:V[Y+2],y2:V[Y+3]})}}}const H=this.circleCells[w];if(H!==null){const V=this.circles;for(const X of H)if(!z.circle[X]){z.circle[X]=!0;const Y=3*X;if(this._circleAndRectCollide(V[Y],V[Y+1],V[Y+2],i,c,p,x)&&(!O||O(this.circleKeys[X]))){if(I.hitTest)return A.push(!0),!0;{const W=V[Y],re=V[Y+1],K=V[Y+2];A.push({key:this.circleKeys[X],x1:W-K,y1:re-K,x2:W+K,y2:re+K})}}}}}_queryCellCircle(i,c,p,x,w,A,I,O){const z=I.circle,k=I.seenUids,H=this.boxCells[w];if(H!==null){const X=this.bboxes;for(const Y of H)if(!k.box[Y]){k.box[Y]=!0;const W=4*Y;if(this._circleAndRectCollide(z.x,z.y,z.radius,X[W+0],X[W+1],X[W+2],X[W+3])&&(!O||O(this.boxKeys[Y])))return A.push(!0),!0}}const V=this.circleCells[w];if(V!==null){const X=this.circles;for(const Y of V)if(!k.circle[Y]){k.circle[Y]=!0;const W=3*Y;if(this._circlesCollide(X[W],X[W+1],X[W+2],z.x,z.y,z.radius)&&(!O||O(this.circleKeys[Y])))return A.push(!0),!0}}}_forEachCell(i,c,p,x,w,A,I,O){const z=this._convertToXCellCoord(i),k=this._convertToYCellCoord(c),H=this._convertToXCellCoord(p),V=this._convertToYCellCoord(x);for(let X=z;X<=H;X++)for(let Y=k;Y<=V;Y++)if(w.call(this,i,c,p,x,this.xCellCount*Y+X,A,I,O))return}_convertToXCellCoord(i){return Math.max(0,Math.min(this.xCellCount-1,Math.floor(i*this.xScale)))}_convertToYCellCoord(i){return Math.max(0,Math.min(this.yCellCount-1,Math.floor(i*this.yScale)))}_circlesCollide(i,c,p,x,w,A){const I=x-i,O=w-c,z=p+A;return z*z>I*I+O*O}_circleAndRectCollide(i,c,p,x,w,A,I){const O=(A-x)/2,z=Math.abs(i-(x+O));if(z>O+p)return!1;const k=(I-w)/2,H=Math.abs(c-(w+k));if(H>k+p)return!1;if(z<=O||H<=k)return!0;const V=z-O,X=H-k;return V*V+X*X<=p*p}}const Mh={unknown:0,flipRequired:1,flipNotRequired:2},Dh=Math.tan(85*Math.PI/180);function ts(g,i,c,p,x,w,A){const I=n.bC();if(c)if(w.name==="globe"){const O=n.bD(x,i);n.aB(I,I,O)}else{const O=n.bE([],A);I[0]=O[0],I[1]=O[1],I[4]=O[2],I[5]=O[3],p||n.bB(I,I,x.angle)}else n.aB(I,x.labelPlaneMatrix,g);return I}function ic(g,i,c,p,x,w,A){const I=ts(g,i,c,p,x,w,A);return w.name==="globe"&&c||(I[2]=I[6]=I[10]=I[14]=0),I}function Gu(g,i,c,p,x,w,A){if(c){if(w.name==="globe"){const I=ts(g,i,c,p,x,w,A);return n.bl(I,I),n.aB(I,g,I),I}{const I=n.bz(g),O=n.bA([]);return O[0]=A[0],O[1]=A[1],O[4]=A[2],O[5]=A[3],n.aB(I,I,O),p||n.bB(I,I,-x.angle),I}}return x.glCoordMatrix}function Ga(g,i,c,p){const x=[g,i,c,1];c?n.aC(x,x,p):ym(x,x,p);const w=x[3];return x[0]/=w,x[1]/=w,x[2]/=w,x}function Hu(g,i){return Math.min(.5+g/i*.5,1.5)}function rs(g,i){const c=g[0]/g[3],p=g[1]/g[3];return c>=-i[0]&&c<=i[0]&&p>=-i[1]&&p<=i[1]}function mm(g,i,c,p,x,w,A,I,O,z){const k=c.transform,H=p?g.textSizeData:g.iconSizeData,V=n.bK(H,c.transform.zoom),X=k.projection.name==="globe",Y=[256/c.width*2+1,256/c.height*2+1],W=p?g.text.dynamicLayoutVertexArray:g.icon.dynamicLayoutVertexArray;W.clear();let re=null;X&&(re=p?g.text.globeExtVertexArray:g.icon.globeExtVertexArray);const K=g.lineVertexArray,ae=p?g.text.placedSymbolArray:g.icon.placedSymbolArray,ue=c.transform.width/c.transform.height;let fe,xe=!1;for(let ge=0;ge<ae.length;ge++){const Te=ae.get(ge),{numGlyphs:ye,writingMode:_e}=Te;if(_e!==n.bL.vertical||xe||fe===n.bL.horizontal||(xe=!0),fe=_e,(Te.hidden||_e===n.bL.vertical)&&!xe){xr(ye,W);continue}xe=!1;const Se=new n.P(Te.tileAnchorX,Te.tileAnchorY);let{x:He,y:ze,z:nt}=k.projection.projectTilePoint(Se.x,Se.y,z.canonical);if(O){const[pt,rr,tr]=O(Se);He+=pt,ze+=rr,nt+=tr}const Ge=[He,ze,nt,1];if(n.aC(Ge,Ge,i),!rs(Ge,Y)){xr(ye,W);continue}const tt=Ge[3],It=Hu(c.transform.getCameraToCenterDistance(k.projection),tt),qe=n.bM(H,V,Te),Oe=A?qe/It:qe*It,ot=Ga(He,ze,nt,x);if(ot[3]<=0){xr(ye,W);continue}let je={};const at=n.an(g.layers[0].layout.get("text-max-angle")),ht=Math.cos(at),wt=A?null:O,ft=Ei(Te,Oe,!1,I,i,x,w,g.glyphOffsetArray,K,W,re,ot,Se,je,ue,wt,k.projection,z,A,ht);xe=ft.useVertical,wt&&ft.needsFlipping&&(je={}),(ft.notEnoughRoom||xe||ft.needsFlipping&&Ei(Te,Oe,!0,I,i,x,w,g.glyphOffsetArray,K,W,re,ot,Se,je,ue,wt,k.projection,z,A,ht).notEnoughRoom)&&xr(ye,W)}p?(g.text.dynamicLayoutVertexBuffer.updateData(W),re&&g.text.globeExtVertexBuffer&&g.text.globeExtVertexBuffer.updateData(re)):(g.icon.dynamicLayoutVertexBuffer.updateData(W),re&&g.icon.globeExtVertexBuffer&&g.icon.globeExtVertexBuffer.updateData(re))}function Oh(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re){const{lineStartIndex:K,glyphStartIndex:ae,segment:ue}=I,fe=ae+I.numGlyphs,xe=K+I.lineLength,ge=i.getoffsetX(ae),Te=i.getoffsetX(fe-1),ye=Gd(g*ge,c,p,x,w,A,ue,K,xe,O,z,k,H,V,!0,X,Y,W,re);if(!ye)return null;const _e=Gd(g*Te,c,p,x,w,A,ue,K,xe,O,z,k,H,V,!0,X,Y,W,re);return _e?{first:ye,last:_e}:null}function gm(g,i,c,p){return g===n.bL.horizontal&&Math.abs(p)>Math.abs(c)?{useVertical:!0}:g===n.bL.vertical?p>0?{needsFlipping:!0}:null:i!==Mh.unknown&&(function(x,w){return x===0||Math.abs(w/x)>Dh})(c,p)?i===Mh.flipRequired?{needsFlipping:!0}:null:c<0?{needsFlipping:!0}:null}function Ei(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K,ae,ue){const fe=i/24,xe=g.lineOffsetX*fe,ge=g.lineOffsetY*fe,{lineStartIndex:Te,glyphStartIndex:ye,numGlyphs:_e,segment:Se,writingMode:He,flipState:ze}=g,nt=Te+g.lineLength,Ge=tt=>{if(k){const[ot,je,at]=tt.up,ht=z.length;n.bN(k,ht+0,ot,je,at),n.bN(k,ht+1,ot,je,at),n.bN(k,ht+2,ot,je,at),n.bN(k,ht+3,ot,je,at)}const[It,qe,Oe]=tt.point;n.bO(z,It,qe,Oe,tt.angle)};if(_e>1){const tt=Oh(fe,I,xe,ge,c,H,V,g,O,w,X,W,!1,re,K,ae,ue);if(!tt)return{notEnoughRoom:!0};if(p&&!c){let[It,qe,Oe]=tt.first.point,[ot,je,at]=tt.last.point;[It,qe]=Ga(It,qe,Oe,A),[ot,je]=Ga(ot,je,at,A);const ht=gm(He,ze,(ot-It)*Y,je-qe);if(g.flipState=ht&&ht.needsFlipping?Mh.flipRequired:Mh.flipNotRequired,ht)return ht}Ge(tt.first);for(let It=ye+1;It<ye+_e-1;It++){const qe=Gd(fe*I.getoffsetX(It),xe,ge,c,H,V,Se,Te,nt,O,w,X,W,!1,!1,re,K,ae,ue);if(!qe)return z.length-=4*(It-ye),{notEnoughRoom:!0};Ge(qe)}Ge(tt.last)}else{if(p&&!c){const It=Ga(V.x,V.y,0,x),qe=Te+Se+1,Oe=new n.P(O.getx(qe),O.gety(qe)),ot=Ga(Oe.x,Oe.y,0,x),je=ot[3]>0?ot:Eg(V,Oe,It,1,x,void 0,re,K.canonical),at=gm(He,ze,(je[0]-It[0])*Y,je[1]-It[1]);if(g.flipState=at&&at.needsFlipping?Mh.flipRequired:Mh.flipNotRequired,at)return at}const tt=Gd(fe*I.getoffsetX(ye),xe,ge,c,H,V,Se,Te,nt,O,w,X,W,!1,!1,re,K,ae,ue);if(!tt)return{notEnoughRoom:!0};Ge(tt)}return{}}function _m(g,i,c,p,x){const{x:w,y:A,z:I}=p.projectTilePoint(g.x,g.y,i);if(!x)return Ga(w,A,I,c);const[O,z,k]=x(g);return Ga(w+O,A+z,I+k,c)}function Eg(g,i,c,p,x,w,A,I){const O=_m(g.sub(i)._unit()._add(g),I,x,A,w);return n.av(O,c,O),n.aw(O,O),n.bH(O,c,O,p)}function Gd(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K,ae){const ue=p?g-i:g+i;let fe=ue>0?1:-1,xe=0;p&&(fe*=-1,xe=Math.PI),fe<0&&(xe+=Math.PI);let ge=I+A+(fe>0?0:1)|0,Te=x,ye=x,_e=0,Se=0;const He=Math.abs(ue),ze=[],nt=[];let Ge=w,tt=Ge,It=n.bF([]);const qe=()=>Eg(tt,Ge,ye,He-_e+1,k,V,W,re.canonical);for(;_e+Se<=He;){if(ge+=fe,ge<I||ge>=O)return null;if(ye=Te,tt=Ge,ze.push(ye),X&&nt.push(tt),Ge=new n.P(z.getx(ge),z.gety(ge)),Te=H[ge],!Te){const tr=_m(Ge,re.canonical,k,W,V);Te=tr[3]>0?H[ge]=tr:qe()}_e+=Se;const pt=n.av([],Te,ye),rr=n.bG(ye,Te);if(c&&rr>0&&Se>0&&n.bJ(It,pt)/(Se*rr)<ae)return null;Se=rr,It=pt}Y&&V&&(H[ge]&&(Te=qe(),Se=n.bG(ye,Te),It=n.av([],Te,ye)),H[ge]=Te);const Oe=(He-_e)/Se,ot=Ge.sub(tt)._mult(Oe)._add(tt),je=n.bH([],ye,It,Oe);let at=[0,0,1],ht=It[0],wt=It[1];if(K&&(at=W.upVector(re.canonical,ot.x,ot.y),at[0]!==0||at[1]!==0||at[2]!==1)){const pt=[at[2],0,-at[0]],rr=n.bI([],at,pt);n.aw(pt,pt),n.aw(rr,rr),ht=n.bJ(It,pt),wt=n.bJ(It,rr)}if(c){const pt=n.bI([],at,It);n.aw(pt,pt),n.bH(je,je,pt,c*fe)}const ft=xe+Math.atan2(wt,ht);return ze.push(je),X&&nt.push(ot),{point:je,angle:ft,path:ze,tilePath:nt,up:at}}function xr(g,i){const c=i.length,p=c+4*g;i.resize(p),i.float32.fill(-1/0,4*c,4*p)}function ym(g,i,c){const p=i[0],x=i[1];return g[0]=c[0]*p+c[4]*x+c[12],g[1]=c[1]*p+c[5]*x+c[13],g[3]=c[3]*p+c[7]*x+c[15],g}const is=100;class Ks{constructor(i,c,p=new ju(i.width+200,i.height+200,25),x=new ju(i.width+200,i.height+200,25)){this.transform=i,this.grid=p,this.ignoredGrid=x,this.pitchfactor=Math.cos(i._pitch)*i.cameraToCenterDistance,this.screenRightBoundary=i.width+is,this.screenBottomBoundary=i.height+is,this.gridRightBoundary=i.width+200,this.gridBottomBoundary=i.height+200,this.fogState=c}placeCollisionBox(i,c,p,x,w,A,I,O,z,k,H){let V=p.projectedAnchorX,X=p.projectedAnchorY,Y=p.projectedAnchorZ;const W=p.tileAnchorX,re=p.tileAnchorY,K=p.elevation,ae=p.tileID,ue=i.getProjection();if(K&&ae){const[nt,Ge,tt]=ue.upVector(ae.canonical,p.tileAnchorX,p.tileAnchorY),It=ue.upVectorScale(ae.canonical,this.transform.center.lat,this.transform.worldSize).metersToTile;V+=nt*K*It,X+=Ge*K*It,Y+=tt*K*It}const fe=i.projection.name==="globe",xe=i.projection.name==="globe"?n.aj(this.transform.zoom):0;if(ae&&fe&&xe<1&&!A){const nt=1<<ae.canonical.z,Ge=n.bP(W,re);n.bQ(Ge,Ge,1/n.al),n.bR(Ge,Ge,n.bP(ae.canonical.x,ae.canonical.y)),n.bQ(Ge,Ge,1/nt),n.bS(Ge,Ge,n.bP(x[0],x[1])),Ge[0]=n.bT(Ge[0],-.5,.5),n.bQ(Ge,Ge,n.al);const tt=n.bU(Ge[0],Ge[1],n.al/(2*Math.PI),1);n.aC(tt,tt,w),V=n.ak(V,tt[0],xe),X=n.ak(X,tt[1],xe),Y=n.ak(Y,tt[2],xe)}const ge=this.projectAndGetPerspectiveRatio(k,V,X,Y,p.tileID,ue.name==="globe"||!!K||this.transform.pitch>0,ue),Te=z*ge.perspectiveRatio,ye=(p.x1*c+I.x-p.padding)*Te+ge.point.x,_e=(p.y1*c+I.y-p.padding)*Te+ge.point.y,Se=(p.x2*c+I.x+p.padding)*Te+ge.point.x,He=(p.y2*c+I.y+p.padding)*Te+ge.point.y,ze=ge.perspectiveRatio<=.55||ge.occluded;return!this.isInsideGrid(ye,_e,Se,He)||!O&&this.grid.hitTest(ye,_e,Se,He,H)||ze?{box:[],offscreen:!1,occluded:ge.occluded}:{box:[ye,_e,Se,He],offscreen:this.isOffscreen(ye,_e,Se,He),occluded:!1}}placeCollisionCircles(i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W){const re=[],K=this.transform.elevation,ae=i.getProjection(),ue=K?K.getAtTileOffsetFunc(W,this.transform.center.lat,this.transform.worldSize,ae):null,fe=new n.P(p.tileAnchorX,p.tileAnchorY);let{x:xe,y:ge,z:Te}=ae.projectTilePoint(fe.x,fe.y,W.canonical);if(ue){const[at,ht,wt]=ue(fe);xe+=at,ge+=ht,Te+=wt}const ye=ae.name==="globe",_e=this.projectAndGetPerspectiveRatio(I,xe,ge,Te,W,ye||!!K||this.transform.pitch>0,ae),{perspectiveRatio:Se}=_e,He=(H?A/Se:A*Se)/n.bX,ze=Ga(xe,ge,Te,O),nt=p.lineOffsetX*He,Ge=p.lineOffsetY*He,tt=n.an(i.layers[0].layout.get("text-max-angle")),It=Math.cos(tt),qe=_e.signedDistanceFromCamera>0?Oh(He,w,nt,Ge,!1,ze,fe,p,x,O,{},K&&!H?ue:null,H&&!!K,ae,W,H,It):null;let Oe=!1,ot=!1,je=!0;if(qe&&!_e.occluded){const at=.5*X*Se+Y,ht=new n.P(-100,-100),wt=new n.P(this.screenRightBoundary,this.screenBottomBoundary),ft=new Uf,{first:pt,last:rr}=qe,tr=pt.path.length;let or=[];for(let Mr=tr-1;Mr>=1;Mr--)or.push(pt.path[Mr]);for(let Mr=1;Mr<rr.path.length;Mr++)or.push(rr.path[Mr]);const Qt=2.5*at;z&&(or=or.map((([Mr,Or,Si],wr)=>(ue&&!ye&&(Si=ue(wr<tr-1?pt.tilePath[tr-1-wr]:rr.tilePath[wr-tr+2])[2]),Ga(Mr,Or,Si,z)))),or.some((Mr=>Mr[3]<=0))&&(or=[]));let fr=[];if(or.length>0){let Mr=1/0,Or=-1/0,Si=1/0,wr=-1/0;for(const ii of or)Mr=Math.min(Mr,ii[0]),Si=Math.min(Si,ii[1]),Or=Math.max(Or,ii[0]),wr=Math.max(wr,ii[1]);Or>=ht.x&&Mr<=wt.x&&wr>=ht.y&&Si<=wt.y&&(fr=[or.map((ii=>new n.P(ii[0],ii[1])))],(Mr<ht.x||Or>wt.x||Si<ht.y||wr>wt.y)&&(fr=n.bV(fr,ht.x,ht.y,wt.x,wt.y)))}for(const Mr of fr){ft.reset(Mr,.25*at);let Or=0;Or=ft.length<=.5*at?1:Math.ceil(ft.paddedLength/Qt)+1;for(let Si=0;Si<Or;Si++){const wr=Si/Math.max(Or-1,1),ii=ft.lerp(wr),hi=ii.x+is,_i=ii.y+is;re.push(hi,_i,at,0);const Lr=hi-at,fi=_i-at,li=hi+at,di=_i+at;if(je=je&&this.isOffscreen(Lr,fi,li,di),ot=ot||this.isInsideGrid(Lr,fi,li,di),!c&&this.grid.hitTestCircle(hi,_i,at,V)&&(Oe=!0,!k))return{circles:[],offscreen:!1,collisionDetected:Oe,occluded:!1}}}}return{circles:!k&&Oe||!ot?[]:re,offscreen:je,collisionDetected:Oe,occluded:_e.occluded}}queryRenderedSymbols(i){if(i.length===0||this.grid.keysLength()===0&&this.ignoredGrid.keysLength()===0)return{};const c=[];let p=1/0,x=1/0,w=-1/0,A=-1/0;for(const k of i){const H=new n.P(k.x+is,k.y+is);p=Math.min(p,H.x),x=Math.min(x,H.y),w=Math.max(w,H.x),A=Math.max(A,H.y),c.push(H)}const I=this.grid.query(p,x,w,A).concat(this.ignoredGrid.query(p,x,w,A)),O={},z={};for(const k of I){const H=k.key;if(O[H.bucketInstanceId]===void 0&&(O[H.bucketInstanceId]={}),O[H.bucketInstanceId][H.featureIndex])continue;const V=[new n.P(k.x1,k.y1),new n.P(k.x2,k.y1),new n.P(k.x2,k.y2),new n.P(k.x1,k.y2)];n.bW(c,V)&&(O[H.bucketInstanceId][H.featureIndex]=!0,z[H.bucketInstanceId]===void 0&&(z[H.bucketInstanceId]=[]),z[H.bucketInstanceId].push(H.featureIndex))}return z}insertCollisionBox(i,c,p,x,w){(c?this.ignoredGrid:this.grid).insert({bucketInstanceId:p,featureIndex:x,collisionGroupID:w},i[0],i[1],i[2],i[3])}insertCollisionCircles(i,c,p,x,w){const A=c?this.ignoredGrid:this.grid,I={bucketInstanceId:p,featureIndex:x,collisionGroupID:w};for(let O=0;O<i.length;O+=4)A.insertCircle(I,i[O],i[O+1],i[O+2])}projectAndGetPerspectiveRatio(i,c,p,x,w,A,I){const O=[c,p,x,1];let z=!1;x||this.transform.pitch>0?(n.aC(O,O,i),this.fogState&&w&&I.name!=="globe"&&(z=(function(V,X,Y,W,re,K){const ae=K.calculateFogTileMatrix(re),ue=[X,Y,W];return n.af(ue,ue,ae),yr(V,n.ag(ue),K.pitch,K._fov)})(this.fogState,c,p,x,w.toUnwrapped(),this.transform)>.9)):ym(O,O,i);const k=O[3];return{point:new n.P((O[0]/k+1)/2*this.transform.width+is,(-O[1]/k+1)/2*this.transform.height+is),perspectiveRatio:Math.min(.5+this.transform.getCameraToCenterDistance(I)/k*.5,1.5),signedDistanceFromCamera:k,occluded:A&&O[2]>k||z}}isOffscreen(i,c,p,x){return p<is||i>=this.screenRightBoundary||x<is||c>this.screenBottomBoundary}isInsideGrid(i,c,p,x){return p>=0&&i<this.gridRightBoundary&&x>=0&&c<this.gridBottomBoundary}getViewportMatrix(){const i=n.bA([]);return n.br(i,i,[-100,-100,0]),i}}class Hd{constructor(i,c,p,x){this.opacity=i?Math.max(0,Math.min(1,i.opacity+(i.placed?c:-c))):x&&p?1:0,this.placed=p}isHidden(){return this.opacity===0&&!this.placed}}class ws{constructor(i,c,p,x,w,A=!1){this.text=new Hd(i?i.text:null,c,p,w),this.icon=new Hd(i?i.icon:null,c,x,w),this.clipped=A}isHidden(){return this.text.isHidden()&&this.icon.isHidden()}}class cr{constructor(i,c,p,x=!1){this.text=i,this.icon=c,this.skipFade=p,this.clipped=x}}class Ci{constructor(){this.invProjMatrix=n.bC(),this.viewportMatrix=n.bC(),this.circles=[]}}class Mi{constructor(i,c,p,x,w){this.bucketInstanceId=i,this.featureIndex=c,this.sourceLayerIndex=p,this.bucketIndex=x,this.tileID=w}}class ba{constructor(i){this.crossSourceCollisions=i,this.maxGroupID=0,this.collisionGroups={}}get(i){if(this.crossSourceCollisions)return{ID:0,predicate:null};if(!this.collisionGroups[i]){const c=++this.maxGroupID;this.collisionGroups[i]={ID:c,predicate:p=>p.collisionGroupID===c}}return this.collisionGroups[i]}}function qu(g,i,c,p,x){const{horizontalAlign:w,verticalAlign:A}=n.c0(g),I=-(w-.5)*i,O=-(A-.5)*c,z=n.c1(g,p);return new n.P(I+z[0]*x,O+z[1]*x)}function wi(g,i,c,p,x){const w=new n.P(g,i);return c&&w._rotate(p?x:-x),w}class qd{constructor(i,c,p,x,w,A){this.transform=i.clone(),this.projection=i.projection.name,this.collisionIndex=new Ks(this.transform,w),this.buildingIndex=A,this.placements={},this.opacities={},this.variableOffsets={},this.stale=!1,this.commitTime=0,this.fadeDuration=c,this.retainedQueryData={},this.collisionGroups=new ba(p),this.collisionCircleArrays={},this.prevPlacement=x,x&&(x.prevPlacement=void 0),this.placedOrientations={}}getBucketParts(i,c,p,x,w=1){const A=p.getBucket(c),I=p.latestFeatureIndex;if(!A||!I||c.fqid!==A.layerIds[0])return;const O=A.layers[0].layout,z=A.layers[0].paint,k=p.collisionBoxArray,H=Math.pow(2,this.transform.zoom-p.tileID.overscaledZ),V=p.tileSize/n.al,X=p.tileID.toUnwrapped();this.transform.setProjection(A.projection);const Y=(W=p.tileID,re=A.getProjection(),K=this.transform,re.name===this.projection?K.calculateProjMatrix(W.toUnwrapped()):Vf(K,re,W));var W,re,K;const ae=O.get("text-pitch-alignment")==="map",ue=O.get("text-rotation-alignment")==="map";c.compileFilter(c.options);const fe=c.dynamicFilter(),xe=c.dynamicFilterNeedsFeature(),ge=this.transform.calculatePixelsToTileUnitsMatrix(p),Te=ic(Y,p.tileID.canonical,ae,ue,this.transform,A.getProjection(),ge);let ye=null;const _e=A.getProjection().createInversionMatrix(this.transform,p.tileID.canonical);if(ae){const Oe=Gu(Y,p.tileID.canonical,ae,ue,this.transform,A.getProjection(),ge);ye=n.aB([],this.transform.labelPlaneMatrix,Oe)}let Se=null;fe&&p.latestFeatureIndex&&(Se={unwrappedTileID:X,dynamicFilter:fe,dynamicFilterNeedsFeature:xe}),this.retainedQueryData[A.bucketInstanceId]=new Mi(A.bucketInstanceId,I,A.sourceLayerIndex,A.index,p.tileID);const[He,ze]=A.layers[0].layout.get("text-size-scale-range"),nt=n.aA(w,He,ze),[Ge,tt]=O.get("icon-size-scale-range"),It=n.aA(w,Ge,tt),qe={bucket:A,layout:O,paint:z,posMatrix:Y,invMatrix:_e,mercatorCenter:[n.aF(this.transform.center.lng),n.aJ(this.transform.center.lat)],textLabelPlaneMatrix:Te,labelToScreenMatrix:ye,clippingData:Se,scale:H,textPixelRatio:V,holdingForFade:p.holdingForFade(),collisionBoxArray:k,partiallyEvaluatedTextSize:n.bK(A.textSizeData,this.transform.zoom,nt),partiallyEvaluatedIconSize:n.bK(A.iconSizeData,this.transform.zoom,It),collisionGroup:this.collisionGroups.get(A.sourceID),latestFeatureIndex:p.latestFeatureIndex};if(x)for(const Oe of A.sortKeyRanges){const{sortKey:ot,symbolInstanceStart:je,symbolInstanceEnd:at}=Oe;i.push({sortKey:ot,symbolInstanceStart:je,symbolInstanceEnd:at,parameters:qe})}else i.push({symbolInstanceStart:0,symbolInstanceEnd:A.symbolInstances.length,parameters:qe})}attemptAnchorPlacement(i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K,ae,ue,fe,xe){const{textOffset0:ge,textOffset1:Te,crossTileID:ye}=W,_e=[ge,Te],Se=qu(i,A,I,_e,O),He=this.collisionIndex.placeCollisionBox(K,O,c,p,x,w,wi(Se.x,Se.y,z,k,this.transform.angle),Y,H,V,X.predicate);if(ue){const ze=K.getSymbolInstanceIconSize(xe,this.transform.zoom,W.placedIconSymbolIndex);if(this.collisionIndex.placeCollisionBox(K,ze,ue,p,x,w,wi(Se.x,Se.y,z,k,this.transform.angle),Y,H,V,X.predicate).box.length===0)return}if(He.box.length>0){let ze;return this.prevPlacement&&this.prevPlacement.variableOffsets[ye]&&this.prevPlacement.placements[ye]&&this.prevPlacement.placements[ye].text&&(ze=this.prevPlacement.variableOffsets[ye].anchor),this.variableOffsets[ye]={textOffset:_e,width:A,height:I,anchor:i,textScale:O,prevAnchor:ze},this.markUsedJustification(K,i,W,ae),K.allowVerticalPlacement&&(this.markUsedOrientation(K,ae,W),this.placedOrientations[ye]=ae),{shift:Se,placedGlyphBoxes:He}}}placeLayerBucketPart(i,c,p,x,w=1){const{bucket:A,layout:I,paint:O,posMatrix:z,textLabelPlaneMatrix:k,labelToScreenMatrix:H,clippingData:V,textPixelRatio:X,mercatorCenter:Y,invMatrix:W,holdingForFade:re,collisionBoxArray:K,partiallyEvaluatedTextSize:ae,partiallyEvaluatedIconSize:ue,collisionGroup:fe,latestFeatureIndex:xe}=i.parameters,ge=I.get("text-optional"),Te=I.get("icon-optional"),ye=I.get("text-allow-overlap"),_e=I.get("icon-allow-overlap"),Se=I.get("text-rotation-alignment")==="map",He=I.get("icon-rotation-alignment")==="map",ze=I.get("text-pitch-alignment")==="map",nt=O.get("symbol-z-offset"),Ge=I.get("symbol-elevation-reference")==="sea",tt=I.get("symbol-placement"),[It,qe]=I.get("text-size-scale-range"),[Oe,ot]=I.get("icon-size-scale-range"),je=n.aA(w,It,qe),at=n.aA(w,Oe,ot),ht=I.get("text-variable-anchor"),wt=Se&&tt!=="point",ft=He&&tt!=="point",pt=ht&&A.hasTextData(),rr=A.hasIconTextFit()&&pt&&A.hasIconData();this.transform.setProjection(A.projection);const tr=pt||wt,or=ft||rr;let Qt=ye&&(_e||!A.hasIconData()||Te),fr=_e&&(ye||!A.hasTextData()||ge);const Mr=!nt.isConstant();!A.collisionArrays&&K&&A.deserializeCollisionBoxes(K),p&&x&&A.updateCollisionDebugBuffers(this.transform.zoom,K,je,at);const Or=(wr,ii,hi)=>{const{crossTileID:_i,numVerticalGlyphVertices:Lr}=wr;let fi=null;if(V&&V.dynamicFilterNeedsFeature||Mr){const bn=this.retainedQueryData[A.bucketInstanceId];fi=xe.loadFeature({featureIndex:wr.featureIndex,bucketIndex:bn.bucketIndex,sourceLayerIndex:bn.sourceLayerIndex,layoutVertexArrayOffset:0})}if(V&&!(0,V.dynamicFilter)({zoom:this.transform.zoom,pitch:this.transform.pitch},fi,this.retainedQueryData[A.bucketInstanceId].tileID.canonical,new n.P(wr.tileAnchorX,wr.tileAnchorY),this.transform.calculateDistanceTileData(V.unwrappedTileID)))return this.placements[_i]=new cr(!1,!1,!1,!0),void c.add(_i);const li=nt.evaluate(fi,{});if(c.has(_i))return;if(re)return void(this.placements[_i]=new cr(!1,!1,!1));let di=!1,Fi=!1,Ii=!0,In=!1,Ui=!1,Pr=null,br={box:null,offscreen:null,occluded:null},Ti={box:null},vn=null,Xi=null,Bn=null,xn=0,$a=0,Wn=0;hi.textFeatureIndex?xn=hi.textFeatureIndex:wr.useRuntimeCollisionCircles&&(xn=wr.featureIndex),hi.verticalTextFeatureIndex&&($a=hi.verticalTextFeatureIndex);const Ia=bn=>{bn.tileID=this.retainedQueryData[A.bucketInstanceId].tileID;const fn=this.transform.elevation;bn.elevation=Ge?li:li+(fn?fn.getAtTileOffset(bn.tileID,bn.tileAnchorX,bn.tileAnchorY):0),bn.elevation+=wr.zOffset},Ra=hi.textBox;if(Ra){Ia(Ra);const bn=rn=>{let Yn=n.bL.horizontal;if(A.allowVerticalPlacement&&!rn&&this.prevPlacement){const lo=this.prevPlacement.placedOrientations[_i];lo&&(this.placedOrientations[_i]=lo,Yn=lo,this.markUsedOrientation(A,Yn,wr))}return Yn},fn=(rn,Yn)=>{if(A.allowVerticalPlacement&&Lr>0&&hi.verticalTextBox){for(const lo of A.writingModes)if(lo===n.bL.vertical?(br=Yn(),Ti=br):br=rn(),br&&br.box&&br.box.length)break}else br=rn()};if(ht){let rn=ht;if(this.prevPlacement&&this.prevPlacement.variableOffsets[_i]){const Rn=this.prevPlacement.variableOffsets[_i];rn.indexOf(Rn.anchor)>0&&(rn=rn.filter((Ao=>Ao!==Rn.anchor)),rn.unshift(Rn.anchor))}const Yn=(Rn,Ao,Fl)=>{const Oc=A.getSymbolInstanceTextSize(ae,wr,this.transform.zoom,ii),al=(Rn.x2-Rn.x1)*Oc+2*Rn.padding,Pc=(Rn.y2-Rn.y1)*Oc+2*Rn.padding,Lc=wr.hasIconTextFit&&!_e?Ao:null;Lc&&Ia(Lc);let Ma={box:[],offscreen:!1,occluded:!1};const Bc=ye?2*rn.length:rn.length;for(let kl=0;kl<Bc;++kl){const sl=this.attemptAnchorPlacement(rn[kl%rn.length],Rn,Y,W,tr,al,Pc,Oc,Se,ze,X,z,fe,kl>=rn.length,wr,ii,A,Fl,Lc,ae,ue);if(sl&&(Ma=sl.placedGlyphBoxes,Ma&&Ma.box&&Ma.box.length)){di=!0,Pr=sl.shift;break}}return Ma};fn((()=>Yn(Ra,hi.iconBox,n.bL.horizontal)),(()=>{const Rn=hi.verticalTextBox;return Rn&&Ia(Rn),A.allowVerticalPlacement&&!(br&&br.box&&br.box.length)&&Lr>0&&Rn?Yn(Rn,hi.verticalIconBox,n.bL.vertical):{box:null,offscreen:null,occluded:null}})),br&&(di=br.box,Ii=br.offscreen,In=br.occluded);const lo=bn(!(!br||!br.box));if(!di&&this.prevPlacement){const Rn=this.prevPlacement.variableOffsets[_i];Rn&&(this.variableOffsets[_i]=Rn,this.markUsedJustification(A,Rn.anchor,wr,lo))}}else{const rn=(Yn,lo)=>{const Rn=A.getSymbolInstanceTextSize(ae,wr,this.transform.zoom,ii),Ao=this.collisionIndex.placeCollisionBox(A,Rn,Yn,Y,W,tr,new n.P(0,0),ye,X,z,fe.predicate);return Ao&&Ao.box&&Ao.box.length&&(this.markUsedOrientation(A,lo,wr),this.placedOrientations[_i]=lo),Ao};fn((()=>rn(Ra,n.bL.horizontal)),(()=>{const Yn=hi.verticalTextBox;return A.allowVerticalPlacement&&Lr>0&&Yn?(Ia(Yn),rn(Yn,n.bL.vertical)):{box:null,offscreen:null,occluded:null}})),bn(!!(br&&br.box&&br.box.length))}}if(vn=br,di=vn&&vn.box&&vn.box.length>0,Ii=vn&&vn.offscreen,In=vn&&vn.occluded,wr.useRuntimeCollisionCircles){const bn=A.text.placedSymbolArray.get(wr.centerJustifiedTextSymbolIndex>=0?wr.centerJustifiedTextSymbolIndex:wr.verticalPlacedTextSymbolIndex),fn=n.bM(A.textSizeData,ae,bn),rn=I.get("text-padding");Xi=this.collisionIndex.placeCollisionCircles(A,ye,bn,A.lineVertexArray,A.glyphOffsetArray,fn,z,k,H,p,ze,fe.predicate,wr.collisionCircleDiameter*fn/n.bX,rn,this.retainedQueryData[A.bucketInstanceId].tileID),di=ye||Xi.circles.length>0&&!Xi.collisionDetected,Ii=Ii&&Xi.offscreen,In=Xi.occluded}if(hi.iconFeatureIndex&&(Wn=hi.iconFeatureIndex),hi.iconBox){const bn=fn=>{Ia(fn);const rn=wr.hasIconTextFit&&Pr?wi(Pr.x,Pr.y,Se,ze,this.transform.angle):new n.P(0,0),Yn=A.getSymbolInstanceIconSize(ue,this.transform.zoom,wr.placedIconSymbolIndex);return this.collisionIndex.placeCollisionBox(A,Yn,fn,Y,W,or,rn,_e,X,z,fe.predicate)};Ti&&Ti.box&&Ti.box.length&&hi.verticalIconBox?(Bn=bn(hi.verticalIconBox),Fi=Bn.box.length>0):(Bn=bn(hi.iconBox),Fi=Bn.box.length>0),Ii=Ii&&Bn.offscreen,Ui=Bn.occluded}const da=ge||wr.numHorizontalGlyphVertices===0&&Lr===0,zo=Te||wr.numIconVertices===0;if(da||zo?zo?da||(Fi=Fi&&di):di=Fi&&di:Fi=di=Fi&&di,di&&vn&&vn.box&&this.collisionIndex.insertCollisionBox(vn.box,I.get("text-ignore-placement"),A.bucketInstanceId,Ti&&Ti.box&&$a?$a:xn,fe.ID),Fi&&Bn&&this.collisionIndex.insertCollisionBox(Bn.box,I.get("icon-ignore-placement"),A.bucketInstanceId,Wn,fe.ID),Xi&&(di&&this.collisionIndex.insertCollisionCircles(Xi.circles,I.get("text-ignore-placement"),A.bucketInstanceId,xn,fe.ID),p)){const bn=A.bucketInstanceId;let fn=this.collisionCircleArrays[bn];fn===void 0&&(fn=this.collisionCircleArrays[bn]=new Ci);for(let rn=0;rn<Xi.circles.length;rn+=4)fn.circles.push(Xi.circles[rn+0]),fn.circles.push(Xi.circles[rn+1]),fn.circles.push(Xi.circles[rn+2]),fn.circles.push(Xi.collisionDetected?1:0)}const Xa=A.projection.name!=="globe";Qt=Qt&&(Xa||!In),fr=fr&&(Xa||!Ui),this.placements[_i]=new cr(di||Qt,Fi||fr,Ii||A.justReloaded),c.add(_i)},Si=this.retainedQueryData[A.bucketInstanceId].tileID;if(A.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(A,Si),A.elevationType==="road"&&A.updateRoadElevation(Si.canonical),A.updateZOffset(),A.sortFeaturesByY){const wr=A.getSortedSymbolIndexes(this.transform.angle);for(let ii=wr.length-1;ii>=0;--ii){const hi=wr[ii];Or(A.symbolInstances.get(hi),hi,A.collisionArrays[hi])}A.hasAnyZOffset&&n.w(`${A.layerIds[0]} layer symbol-z-elevate: symbols are not sorted by elevation if symbol-z-order is evaluated to viewport-y`)}else if(A.hasAnyZOffset){const wr=A.getSortedIndexesByZOffset();for(let ii=0;ii<wr.length;++ii){const hi=wr[ii];Or(A.symbolInstances.get(hi),hi,A.collisionArrays[hi])}}else for(let wr=i.symbolInstanceStart;wr<i.symbolInstanceEnd;wr++)Or(A.symbolInstances.get(wr),wr,A.collisionArrays[wr]);if(p&&A.bucketInstanceId in this.collisionCircleArrays){const wr=this.collisionCircleArrays[A.bucketInstanceId];n.bl(wr.invProjMatrix,z),wr.viewportMatrix=this.collisionIndex.getViewportMatrix()}A.justReloaded=!1}markUsedJustification(i,c,p,x){const{leftJustifiedTextSymbolIndex:w,centerJustifiedTextSymbolIndex:A,rightJustifiedTextSymbolIndex:I,verticalPlacedTextSymbolIndex:O,crossTileID:z}=p,k=n.c2(c),H=x===n.bL.vertical?O:k==="left"?w:k==="center"?A:k==="right"?I:-1;w>=0&&(i.text.placedSymbolArray.get(w).crossTileID=H>=0&&w!==H?0:z),A>=0&&(i.text.placedSymbolArray.get(A).crossTileID=H>=0&&A!==H?0:z),I>=0&&(i.text.placedSymbolArray.get(I).crossTileID=H>=0&&I!==H?0:z),O>=0&&(i.text.placedSymbolArray.get(O).crossTileID=H>=0&&O!==H?0:z)}markUsedOrientation(i,c,p){const x=c===n.bL.horizontal||c===n.bL.horizontalOnly?c:0,w=c===n.bL.vertical?c:0,{leftJustifiedTextSymbolIndex:A,centerJustifiedTextSymbolIndex:I,rightJustifiedTextSymbolIndex:O,verticalPlacedTextSymbolIndex:z}=p,k=i.text.placedSymbolArray;A>=0&&(k.get(A).placedOrientation=x),I>=0&&(k.get(I).placedOrientation=x),O>=0&&(k.get(O).placedOrientation=x),z>=0&&(k.get(z).placedOrientation=w)}commit(i){this.commitTime=i,this.zoomAtLastRecencyCheck=this.transform.zoom;const c=this.prevPlacement;let p=!1;this.prevZoomAdjustment=c?c.zoomAdjustment(this.transform.zoom):0;const x=c?c.symbolFadeChange(i):1,w=c?c.opacities:{},A=c?c.variableOffsets:{},I=c?c.placedOrientations:{};for(const O in this.placements){const z=this.placements[O],k=w[O];k?(this.opacities[O]=new ws(k,x,z.text,z.icon,null,z.clipped),p=p||z.text!==k.text.placed||z.icon!==k.icon.placed):(this.opacities[O]=new ws(null,x,z.text,z.icon,z.skipFade,z.clipped),p=p||z.text||z.icon)}for(const O in w){const z=w[O];if(!this.opacities[O]){const k=new ws(z,x,!1,!1);k.isHidden()||(this.opacities[O]=k,p=p||z.text.placed||z.icon.placed)}}for(const O in A)this.variableOffsets[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.variableOffsets[O]=A[O]);for(const O in I)this.placedOrientations[O]||!this.opacities[O]||this.opacities[O].isHidden()||(this.placedOrientations[O]=I[O]);p?this.lastPlacementChangeTime=i:typeof this.lastPlacementChangeTime!="number"&&(this.lastPlacementChangeTime=c?c.lastPlacementChangeTime:i)}updateLayerOpacities(i,c,p,x){const w=new Set;for(const A of c){const I=A.getBucket(i);I&&A.latestFeatureIndex&&i.fqid===I.layerIds[0]&&(this.updateBucketOpacities(I,w,A,A.collisionBoxArray,p,x,A.tileID,i.scope),I.elevationType==="offset"&&this.buildingIndex&&this.buildingIndex.updateZOffset(I,A.tileID),I.elevationType==="road"&&I.updateRoadElevation(A.tileID.canonical),I.updateZOffset())}}updateBucketOpacities(i,c,p,x,w,A,I,O){i.hasTextData()&&i.text.opacityVertexArray.clear(),i.hasIconData()&&i.icon.opacityVertexArray.clear(),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexArray.clear(),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexArray.clear();const z=i.layers[0].layout,k=i.layers[0].paint,H=!!i.layers[0].dynamicFilter(),V=new ws(null,0,!1,!1,!0),X=z.get("text-allow-overlap"),Y=z.get("icon-allow-overlap"),W=z.get("text-variable-anchor"),re=z.get("text-rotation-alignment")==="map",K=z.get("text-pitch-alignment")==="map",ae=k.get("symbol-z-offset"),ue=z.get("symbol-elevation-reference")==="sea",fe=!ae.isConstant(),xe=new ws(null,0,X&&(Y||!i.hasIconData()||z.get("icon-optional")),Y&&(X||!i.hasTextData()||z.get("text-optional")),!0);!i.collisionArrays&&x&&(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData())&&i.deserializeCollisionBoxes(x);const ge=(ye,_e,Se)=>{for(let He=0;He<_e/4;He++)ye.opacityVertexArray.emplaceBack(Se)};let Te=0;A&&i.updateReplacement(I,A);for(let ye=0;ye<i.symbolInstances.length;ye++){const _e=i.symbolInstances.get(ye),{numHorizontalGlyphVertices:Se,numVerticalGlyphVertices:He,crossTileID:ze,numIconVertices:nt,tileAnchorX:Ge,tileAnchorY:tt}=_e;let It=null;const qe=this.retainedQueryData[i.bucketInstanceId];fe&&_e&&qe&&(It=p.latestFeatureIndex.loadFeature({featureIndex:_e.featureIndex,bucketIndex:qe.bucketIndex,sourceLayerIndex:qe.sourceLayerIndex,layoutVertexArrayOffset:0}));const Oe=ae.evaluate(It,{}),ot=c.has(ze);let je=this.opacities[ze];ot?je=V:je||(je=xe,this.opacities[ze]=je),c.add(ze);const at=Se>0||He>0,ht=nt>0,wt=this.placedOrientations[ze],ft=wt===n.bL.vertical,pt=wt===n.bL.horizontal||wt===n.bL.horizontalOnly;!at&&!ht||je.isHidden()||Te++;let rr=!1;if((at||ht)&&A)for(const tr of i.activeReplacements){if(n.bY(tr,w,n.bZ.Symbol,O)||tr.min.x>Ge||Ge>tr.max.x||tr.min.y>tt||tt>tr.max.y)continue;const or=n.b_(Ge,tt,I.canonical,tr.footprintTileId.canonical);if(rr=n.b$(or,tr.footprint),rr)break}if(at){const tr=rr?oc:qf(je.text);ge(i.text,Se,ft?oc:tr),ge(i.text,He,pt?oc:tr);const or=je.text.isHidden(),{leftJustifiedTextSymbolIndex:Qt,centerJustifiedTextSymbolIndex:fr,rightJustifiedTextSymbolIndex:Mr,verticalPlacedTextSymbolIndex:Or}=_e,Si=i.text.placedSymbolArray,wr=or||ft?1:0;Qt>=0&&(Si.get(Qt).hidden=wr),fr>=0&&(Si.get(fr).hidden=wr),Mr>=0&&(Si.get(Mr).hidden=wr),Or>=0&&(Si.get(Or).hidden=or||pt?1:0);const ii=this.variableOffsets[ze];ii&&this.markUsedJustification(i,ii.anchor,_e,wt);const hi=this.placedOrientations[ze];hi&&(this.markUsedJustification(i,"left",_e,hi),this.markUsedOrientation(i,hi,_e))}if(ht){const tr=rr?oc:qf(je.icon),{placedIconSymbolIndex:or,verticalPlacedIconSymbolIndex:Qt}=_e,fr=i.icon.placedSymbolArray,Mr=je.icon.isHidden()?1:0;or>=0&&(ge(i.icon,nt,ft?oc:tr),fr.get(or).hidden=Mr),Qt>=0&&(ge(i.icon,_e.numVerticalIconVertices,pt?oc:tr),fr.get(Qt).hidden=Mr)}if(i.hasIconCollisionBoxData()||i.hasTextCollisionBoxData()){const tr=i.collisionArrays[ye];if(tr){let or=new n.P(0,0),Qt=!0;if(tr.textBox||tr.verticalTextBox){if(W){const Mr=this.variableOffsets[ze];Mr?(or=qu(Mr.anchor,Mr.width,Mr.height,Mr.textOffset,Mr.textScale),re&&or._rotate(K?this.transform.angle:-this.transform.angle)):Qt=!1}H&&(Qt=!je.clipped),tr.textBox&&Yc(i.textCollisionBox.collisionVertexArray,je.text.placed,!Qt||ft,Oe,ue,or.x,or.y),tr.verticalTextBox&&Yc(i.textCollisionBox.collisionVertexArray,je.text.placed,!Qt||pt,Oe,ue,or.x,or.y)}const fr=Qt&&!!(!pt&&tr.verticalIconBox);tr.iconBox&&Yc(i.iconCollisionBox.collisionVertexArray,je.icon.placed,fr,Oe,ue,_e.hasIconTextFit?or.x:0,_e.hasIconTextFit?or.y:0),tr.verticalIconBox&&Yc(i.iconCollisionBox.collisionVertexArray,je.icon.placed,!fr,Oe,ue,_e.hasIconTextFit?or.x:0,_e.hasIconTextFit?or.y:0)}}}if(i.fullyClipped=Te===0,i.sortFeatures(this.transform.angle),this.retainedQueryData[i.bucketInstanceId]&&(this.retainedQueryData[i.bucketInstanceId].featureSortOrder=i.featureSortOrder),i.hasTextData()&&i.text.opacityVertexBuffer&&i.text.opacityVertexBuffer.updateData(i.text.opacityVertexArray),i.hasIconData()&&i.icon.opacityVertexBuffer&&i.icon.opacityVertexBuffer.updateData(i.icon.opacityVertexArray),i.hasIconCollisionBoxData()&&i.iconCollisionBox.collisionVertexBuffer&&i.iconCollisionBox.collisionVertexBuffer.updateData(i.iconCollisionBox.collisionVertexArray),i.hasTextCollisionBoxData()&&i.textCollisionBox.collisionVertexBuffer&&i.textCollisionBox.collisionVertexBuffer.updateData(i.textCollisionBox.collisionVertexArray),i.bucketInstanceId in this.collisionCircleArrays){const ye=this.collisionCircleArrays[i.bucketInstanceId];i.placementInvProjMatrix=ye.invProjMatrix,i.placementViewportMatrix=ye.viewportMatrix,i.collisionCircleArray=ye.circles,delete this.collisionCircleArrays[i.bucketInstanceId]}}symbolFadeChange(i){return this.fadeDuration===0?1:(i-this.commitTime)/this.fadeDuration+this.prevZoomAdjustment}zoomAdjustment(i){return Math.max(0,(this.transform.zoom-i)/1.5)}hasTransitions(i){return this.stale||i-this.lastPlacementChangeTime<this.fadeDuration}stillRecent(i,c){const p=this.zoomAtLastRecencyCheck===c?1-this.zoomAdjustment(c):1;return this.zoomAtLastRecencyCheck=c,this.commitTime+this.fadeDuration*p>i}setStale(){this.stale=!0}}function Yc(g,i,c,p,x,w,A){g.emplaceBack(i?1:0,c?1:0,w||0,A||0,p,x?1:0),g.emplaceBack(i?1:0,c?1:0,w||0,A||0,p,x?1:0),g.emplaceBack(i?1:0,c?1:0,w||0,A||0,p,x?1:0),g.emplaceBack(i?1:0,c?1:0,w||0,A||0,p,x?1:0)}const jf=Math.pow(2,25),Ko=Math.pow(2,24),ro=Math.pow(2,17),e0=Math.pow(2,16),Gf=Math.pow(2,9),Hf=Math.pow(2,8),nc=Math.pow(2,1);function qf(g){if(g.opacity===0&&!g.placed)return 0;if(g.opacity===1&&g.placed)return 4294967295;const i=g.placed?1:0,c=Math.floor(127*g.opacity);return c*jf+i*Ko+c*ro+i*e0+c*Gf+i*Hf+c*nc+i}const oc=0;class $f{constructor(i){this._sortAcrossTiles=i.layout.get("symbol-z-order")!=="viewport-y"&&i.layout.get("symbol-sort-key").constantOr(1)!==void 0,this._currentTileIndex=0,this._currentPartIndex=0,this._seenCrossTileIDs=new Set,this._bucketParts=[]}continuePlacement(i,c,p,x,w,A){const I=this._bucketParts;for(;this._currentTileIndex<i.length;)if(c.getBucketParts(I,x,i[this._currentTileIndex],this._sortAcrossTiles,A),this._currentTileIndex++,w())return!0;for(this._sortAcrossTiles&&(this._sortAcrossTiles=!1,I.sort(((O,z)=>O.sortKey-z.sortKey)));this._currentPartIndex<I.length;){const O=I[this._currentPartIndex];if(c.placeLayerBucketPart(O,this._seenCrossTileIDs,p,O.symbolInstanceStart===0,A),this._currentPartIndex++,w())return!0}return!1}}class Jo{constructor(i,c,p,x,w,A,I,O,z){this.placement=new qd(i,w,A,I,O,z),this._currentPlacementIndex=c.length-1,this._forceFullPlacement=p,this._showCollisionBoxes=x,this._done=!1}isDone(){return this._done}continuePlacement(i,c,p,x,w){const A=n.o.now(),I=()=>{const O=n.o.now()-A;return!this._forceFullPlacement&&O>2};for(;this._currentPlacementIndex>=0;){const O=c[i[this._currentPlacementIndex]],z=this.placement.collisionIndex.transform.zoom;if(O.type==="symbol"&&(!O.minzoom||O.minzoom<=z)&&(!O.maxzoom||O.maxzoom>z)){const k=O,H=k.layout.get("symbol-z-elevate"),V=k.layout.get("symbol-sort-key").constantOr(1)!==void 0,X=k.layout.get("symbol-z-order"),Y=X==="viewport-y"||X==="auto"&&!(X!=="viewport-y"&&V),W=k.layout.get("text-allow-overlap")||k.layout.get("icon-allow-overlap")||k.layout.get("text-ignore-placement")||k.layout.get("icon-ignore-placement"),re=Y&&W,K=this._inProgressLayer=this._inProgressLayer||new $f(k),ae=n.B(O.source,O.scope);if(K.continuePlacement(H||re?x[ae]:p[ae],this.placement,this._showCollisionBoxes,O,I,w))return;delete this._inProgressLayer}this._currentPlacementIndex--}this._done=!0}commit(i){return this.placement.commit(i),this.placement}}const Ss=512/n.al/2;class sa{constructor(i,c,p){this.tileID=i,this.bucketInstanceId=p,this.index=new n.c3(c.length,16,Int32Array),this.keys=[],this.crossTileIDs=[];const x=i.canonical.x*n.al,w=i.canonical.y*n.al;for(let A=0;A<c.length;A++){const{key:I,crossTileID:O,tileAnchorX:z,tileAnchorY:k}=c.get(A),H=Math.floor((x+z)*Ss),V=Math.floor((w+k)*Ss);this.index.add(H,V),this.keys.push(I),this.crossTileIDs.push(O)}this.index.finish()}findMatches(i,c,p){const x=this.tileID.canonical.z<c.canonical.z?1:Math.pow(2,this.tileID.canonical.z-c.canonical.z),w=Ss/Math.pow(2,c.canonical.z-this.tileID.canonical.z),A=c.canonical.x*n.al,I=c.canonical.y*n.al;for(let O=0;O<i.length;O++){const z=i.get(O);if(z.crossTileID)continue;const{key:k,tileAnchorX:H,tileAnchorY:V}=z,X=Math.floor((A+H)*w),Y=Math.floor((I+V)*w),W=this.index.range(X-x,Y-x,X+x,Y+x).sort(((re,K)=>re-K));for(const re of W){const K=this.crossTileIDs[re];if(this.keys[re]===k&&!p.has(K)){p.add(K),z.crossTileID=K;break}}}}}class $u{constructor(){this.maxCrossTileID=0}generate(){return++this.maxCrossTileID}}class Ph{constructor(){this.indexes={},this.usedCrossTileIDs={},this.lng=0}handleWrapJump(i){const c=Math.round((i-this.lng)/360);if(c!==0)for(const p in this.indexes){const x=this.indexes[p],w={};for(const A in x){const I=x[A];I.tileID=I.tileID.unwrapTo(I.tileID.wrap+c),w[I.tileID.key]=I}this.indexes[p]=w}this.lng=i}addBucket(i,c,p){if(this.indexes[i.overscaledZ]&&this.indexes[i.overscaledZ][i.key]){if(this.indexes[i.overscaledZ][i.key].bucketInstanceId===c.bucketInstanceId)return!1;this.removeBucketCrossTileIDs(i.overscaledZ,this.indexes[i.overscaledZ][i.key])}for(let w=0;w<c.symbolInstances.length;w++)c.symbolInstances.get(w).crossTileID=0;this.usedCrossTileIDs[i.overscaledZ]||(this.usedCrossTileIDs[i.overscaledZ]=new Set);const x=this.usedCrossTileIDs[i.overscaledZ];for(const w in this.indexes){const A=this.indexes[w];if(Number(w)>i.overscaledZ)for(const I in A){const O=A[I];O.tileID.isChildOf(i)&&O.findMatches(c.symbolInstances,i,x)}else{const I=A[i.scaledTo(Number(w)).key];I&&I.findMatches(c.symbolInstances,i,x)}}for(let w=0;w<c.symbolInstances.length;w++){const A=c.symbolInstances.get(w);A.crossTileID||(A.crossTileID=p.generate(),x.add(A.crossTileID))}return this.indexes[i.overscaledZ]===void 0&&(this.indexes[i.overscaledZ]={}),this.indexes[i.overscaledZ][i.key]=new sa(i,c.symbolInstances,c.bucketInstanceId),!0}removeBucketCrossTileIDs(i,c){for(const p of c.crossTileIDs)this.usedCrossTileIDs[i].delete(p)}removeStaleBuckets(i){let c=!1;for(const p in this.indexes){const x=this.indexes[p];for(const w in x)i[x[w].bucketInstanceId]||(this.removeBucketCrossTileIDs(p,x[w]),delete x[w],c=!0)}return c}}class fo{constructor(){this.layerIndexes={},this.crossTileIDs=new $u,this.maxBucketInstanceId=0,this.bucketsInCurrentPlacement={}}addLayer(i,c,p,x){let w=this.layerIndexes[i.fqid];w===void 0&&(w=this.layerIndexes[i.fqid]=new Ph);let A=!1;const I={};x.name!=="globe"&&w.handleWrapJump(p);for(const O of c){const z=O.getBucket(i);z&&i.fqid===z.layerIds[0]&&(z.bucketInstanceId||(z.bucketInstanceId=++this.maxBucketInstanceId),w.addBucket(O.tileID,z,this.crossTileIDs)&&(A=!0),I[z.bucketInstanceId]=!0)}return w.removeStaleBuckets(I)&&(A=!0),A}pruneUnusedLayers(i){const c={};i.forEach((p=>{c[p]=!0}));for(const p in this.layerIndexes)c[p]||delete this.layerIndexes[p]}}const wa=771;class kr{constructor(i,c,p,x){this.blendFunction=i,this.blendColor=c.toNonPremultipliedRenderColor(null),this.mask=p,this.blendEquation=x}}kr.Replace=[1,0,1,0],kr.disabled=new kr(kr.Replace,n.ao.transparent,[!1,!1,!1,!1]),kr.unblended=new kr(kr.Replace,n.ao.transparent,[!0,!0,!0,!0]),kr.alphaBlended=new kr([1,wa,1,wa],n.ao.transparent,[!0,!0,!0,!0]),kr.alphaBlendedNonPremultiplied=new kr([770,wa,770,wa],n.ao.transparent,[!0,!0,!0,!0]),kr.multiply=new kr([774,0,774,0],n.ao.transparent,[!0,!0,!0,!0]);class qt{constructor(i,c,p){this.func=i,this.mask=c,this.range=p}}qt.ReadOnly=!1,qt.ReadWrite=!0,qt.disabled=new qt(519,qt.ReadOnly,[0,1]);const ac=7680;class vr{constructor(i,c,p,x,w,A){this.test=i,this.ref=c,this.mask=p,this.fail=x,this.depthFail=w,this.pass=A}}vr.disabled=new vr({func:519,mask:0},0,0,ac,ac,ac);const Xu=1029,sc=2305;class Tr{constructor(i,c,p){this.enable=i,this.mode=c,this.frontFace=p}}function $d(g,i){const c=n.c9(g,3);n.cb(g,i),n.cf(g,3,c)}function Zu(g,i){const c=n.c6([]);return n.c7(c,c,-i),n.c8(c,c,-g),c}function Wu(g,i){const c=[g[0],g[1],0],p=[i[0],i[1],0];if(n.ag(c)>=1e-15){const A=n.aw([],c);n.c4(p,A,n.bJ(p,A)),i[0]=p[0],i[1]=p[1]}const x=n.bI([],i,g);if(n.c5(x)<1e-15)return null;const w=Math.atan2(-x[1],x[0]);return Zu(Math.atan2(Math.sqrt(g[0]*g[0]+g[1]*g[1]),-g[2]),w)}Tr.disabled=new Tr(!1,Xu,sc),Tr.backCCW=new Tr(!0,Xu,sc),Tr.backCW=new Tr(!0,Xu,2304),Tr.frontCW=new Tr(!0,1028,2304),Tr.frontCCW=new Tr(!0,1028,sc);class Xd{constructor(i,c){this.position=i,this.orientation=c}get position(){return this._position}set position(i){if(i){const c=i instanceof n.ae?i:new n.ae(i[0],i[1],i[2]);this._renderWorldCopies&&(c.x=n.bT(c.x,0,1)),this._position=c}else this._position=null}lookAtPoint(i,c){if(this.orientation=null,!this.position)return;const p=this.position,x=this._elevation?this._elevation.getAtPointOrZero(n.ae.fromLngLat(i)):0,w=n.ae.fromLngLat(i,x),A=[w.x-p.x,w.y-p.y,w.z-p.z];c||(c=[0,0,1]),c[2]=Math.abs(c[2]),this.orientation=Wu(A,c)}setPitchBearing(i,c){this.orientation=Zu(n.an(i),n.an(-c))}}class Xf{constructor(i,c){this._transform=n.bA([]),this.orientation=c,this.position=i}get mercatorPosition(){const i=this.position;return new n.ae(i[0],i[1],i[2])}get position(){const i=n.c9(this._transform,3);return[i[0],i[1],i[2]]}set position(i){var c;i&&n.cf(this._transform,3,[(c=i)[0],c[1],c[2],1])}get orientation(){return this._orientation}set orientation(i){this._orientation=i||n.c6([]),i&&$d(this._transform,this._orientation)}getPitchBearing(){const i=this.forward(),c=this.right();return{bearing:Math.atan2(-c[1],c[0]),pitch:Math.atan2(Math.sqrt(i[0]*i[0]+i[1]*i[1]),-i[2])}}setPitchBearing(i,c){this._orientation=Zu(i,c),$d(this._transform,this._orientation)}forward(){const i=n.c9(this._transform,2);return[-i[0],-i[1],-i[2]]}up(){const i=n.c9(this._transform,1);return[-i[0],-i[1],-i[2]]}right(){const i=n.c9(this._transform,0);return[i[0],i[1],i[2]]}getCameraToWorld(i,c){const p=new Float64Array(16);return n.bl(p,this.getWorldToCamera(i,c)),p}getCameraToWorldMercator(){return this._transform}getWorldToCameraPosition(i,c,p){const x=this.position;n.c4(x,x,-i);const w=new Float64Array(16);return n.bq(w,[p,p,p]),n.br(w,w,x),w[10]*=c,w}getWorldToCamera(i,c){const p=new Float64Array(16),x=new Float64Array(4),w=this.position;return n.ca(x,this._orientation),n.c4(w,w,-i),n.cb(p,x),n.br(p,p,w),p[1]*=-1,p[5]*=-1,p[9]*=-1,p[13]*=-1,p[8]*=c,p[9]*=c,p[10]*=c,p[11]*=c,p}getCameraToClipPerspective(i,c,p,x){const w=new Float64Array(16);return n.cc(w,i,c,p,x),w}getCameraToClipOrthographic(i,c,p,x,w,A){const I=new Float64Array(16);return n.cd(I,i,c,p,x,w,A),I}getDistanceToElevation(i,c=!1){const p=i===0?0:n.ce(i,c?n.a$(this.position[1]):this.position[1]),x=this.forward();return(p-this.position[2])/x[2]}clone(){return new Xf([...this.position],[...this.orientation])}}const kn={BaseColor:5,MetallicRoughness:6,Normal:7,Occlusion:8,Emission:9,LUT:10,ShadowMap0:11};class vm{constructor(i=0,c=0,p=0,x=0){if(isNaN(i)||i<0||isNaN(c)||c<0||isNaN(p)||p<0||isNaN(x)||x<0)throw new Error("Invalid value for edge-insets, top, bottom, left and right must all be numbers");this.top=i,this.bottom=c,this.left=p,this.right=x}interpolate(i,c,p){return c.top!=null&&i.top!=null&&(this.top=n.ak(i.top,c.top,p)),c.bottom!=null&&i.bottom!=null&&(this.bottom=n.ak(i.bottom,c.bottom,p)),c.left!=null&&i.left!=null&&(this.left=n.ak(i.left,c.left,p)),c.right!=null&&i.right!=null&&(this.right=n.ak(i.right,c.right,p)),this}getCenter(i,c){const p=n.aA((this.left+i-this.right)/2,0,i),x=n.aA((this.top+c-this.bottom)/2,0,c);return new n.P(p,x)}equals(i){return this.top===i.top&&this.bottom===i.bottom&&this.left===i.left&&this.right===i.right}clone(){return new vm(this.top,this.bottom,this.left,this.right)}toJSON(){return{top:this.top,bottom:this.bottom,left:this.left,right:this.right}}}const lc=15;class la{constructor(i,c,p,x,w,A,I){this.tileSize=512,this._renderWorldCopies=w===void 0||w,this._minZoom=i||0,this._maxZoom=c||22,this._minPitch=p??0,this._maxPitch=x??60,this.setProjection(A),this.setMaxBounds(I),this.width=0,this.height=0,this._center=new n.aR(0,0),this.zoom=0,this.angle=0,this._fov=.6435011087932844,this._pitch=0,this._nearZ=0,this._farZ=0,this._unmodified=!0,this._edgeInsets=new vm,this._projMatrixCache={},this._alignedProjMatrixCache={},this._fogTileMatrixCache={},this._expandedProjMatrixCache={},this._distanceTileDataCache={},this._camera=new Xf,this._centerAltitude=0,this._averageElevation=0,this.cameraElevationReference="ground",this._pixelsPerMercatorPixel=1,this.globeRadius=0,this.globeCenterInViewSpace=[0,0,0],this._tileCoverLift=0,this.freezeTileCoverage=!1,this._horizonShift=.1,this._orthographicProjectionAtLowPitch=!1,this._allowWorldUnderZoom=!1}clone(){const i=new la(this._minZoom,this._maxZoom,this._minPitch,this.maxPitch,this._renderWorldCopies,this.getProjection(),this.maxBounds);return i._elevation=this._elevation,i._centerAltitude=this._centerAltitude,i._centerAltitudeValidForExaggeration=this._centerAltitudeValidForExaggeration,i.tileSize=this.tileSize,i.mercatorFromTransition=this.mercatorFromTransition,i.width=this.width,i.height=this.height,i.cameraElevationReference=this.cameraElevationReference,i._center=this._center,i._setZoom(this.zoom),i._seaLevelZoom=this._seaLevelZoom,i.angle=this.angle,i._fov=this._fov,i._pitch=this._pitch,i._nearZ=this._nearZ,i._farZ=this._farZ,i._averageElevation=this._averageElevation,i._orthographicProjectionAtLowPitch=this._orthographicProjectionAtLowPitch,i._unmodified=this._unmodified,i._edgeInsets=this._edgeInsets.clone(),i._camera=this._camera.clone(),i._calcMatrices(),i.freezeTileCoverage=this.freezeTileCoverage,i.frustumCorners=this.frustumCorners,i._allowWorldUnderZoom=this._allowWorldUnderZoom,i}get isOrthographic(){return this.projection.name!=="globe"&&this._orthographicProjectionAtLowPitch&&this.pitch<lc}get elevation(){return this._elevation}set elevation(i){this._elevation!==i&&(this._elevation=i,this._updateCameraOnTerrain(),this._calcMatrices())}get depthOcclusionForSymbolsAndCircles(){return this.projection.name!=="globe"&&!this.isOrthographic}updateElevation(i,c=!1){const p=this._elevation&&this._elevation.exaggeration()!==this._centerAltitudeValidForExaggeration;(this._seaLevelZoom==null||p)&&this._updateCameraOnTerrain(),(i||p)&&this._constrainCamera(c),this._calcMatrices()}getProjection(){return n.aH(this.projection,["name","center","parallels"])}setProjection(i){this.projectionOptions=i||{name:"mercator"};const c=this.projection?this.getProjection():void 0;this.projection=n.cl(this.projectionOptions);const p=this.getProjection(),x=!n.by(c,p);return x&&this._calcMatrices(),this.mercatorFromTransition=!1,x}setOrthographicProjectionAtLowPitch(i){return this._orthographicProjectionAtLowPitch!==i&&(this._orthographicProjectionAtLowPitch=i,this._calcMatrices(),!0)}setMercatorFromTransition(){const i=this.projection.name;this.mercatorFromTransition=!0,this.projectionOptions={name:"mercator"},this.projection=n.cl({name:"mercator"});const c=i!==this.projection.name;return c&&this._calcMatrices(),c}get minZoom(){return this._minZoom}set minZoom(i){this._minZoom!==i&&(this._minZoom=i,this.zoom=Math.max(this.zoom,i))}get maxZoom(){return this._maxZoom}set maxZoom(i){this._maxZoom!==i&&(this._maxZoom=i,this.zoom=Math.min(this.zoom,i))}get minPitch(){return this._minPitch}set minPitch(i){this._minPitch!==i&&(this._minPitch=i,this.pitch=Math.max(this.pitch,i))}get maxPitch(){return this._maxPitch}set maxPitch(i){this._maxPitch!==i&&(this._maxPitch=i,this.pitch=Math.min(this.pitch,i))}get renderWorldCopies(){return this._renderWorldCopies&&this.projection.supportsWorldCopies===!0}set renderWorldCopies(i){i===void 0?i=!0:i===null&&(i=!1),this._renderWorldCopies=i}get worldSize(){return this.tileSize*this.scale}get cameraWorldSizeForFog(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get cameraWorldSize(){const i=Math.max(this._camera.getDistanceToElevation(this._averageElevation,!0),Number.EPSILON);return this._worldSizeFromZoom(this._zoomFromMercatorZ(i))}get pixelsPerMeter(){return this.projection.pixelsPerMeter(this.center.lat,this.worldSize)}get cameraPixelsPerMeter(){return n.ce(1,this.center.lat)*this.cameraWorldSizeForFog}get centerOffset(){return this.centerPoint._sub(this.size._div(2))}get size(){return new n.P(this.width,this.height)}get bearing(){return n.bT(this.rotation,-180,180)}set bearing(i){this.rotation=i}get rotation(){return-this.angle/Math.PI*180}set rotation(i){const c=-i*Math.PI/180;this.angle!==c&&(this._unmodified=!1,this.angle=c,this._calcMatrices(),this.rotationMatrix=n.cm(),n.cn(this.rotationMatrix,this.rotationMatrix,this.angle))}get pitch(){return this._pitch/Math.PI*180}set pitch(i){const c=n.aA(i,this.minPitch,this.maxPitch)/180*Math.PI;this._pitch!==c&&(this._unmodified=!1,this._pitch=c,this._calcMatrices())}get aspect(){return this.width/this.height}get fov(){return this._fov/Math.PI*180}set fov(i){i=Math.max(.01,Math.min(60,i)),this._fov!==i&&(this._unmodified=!1,this._fov=n.an(i),this._calcMatrices())}get fovX(){return this._fov}get fovY(){const i=1/Math.tan(.5*this.fovX);return 2*Math.atan(1/this.aspect/i)}get averageElevation(){return this._averageElevation}set averageElevation(i){this._averageElevation=i,this._calcFogMatrices(),this._distanceTileDataCache={}}get zoom(){return this._zoom}set zoom(i){const c=Math.min(Math.max(i,this.minZoom),this.maxZoom);this._zoom!==c&&(this._unmodified=!1,this._setZoom(c),this._updateSeaLevelZoom(),this._constrain(),this._calcMatrices())}_setZoom(i){this._zoom=i,this.scale=this.zoomScale(i),this.tileZoom=Math.floor(i),this.zoomFraction=i-this.tileZoom}get tileCoverLift(){return this._tileCoverLift}set tileCoverLift(i){this._tileCoverLift!==i&&(this._tileCoverLift=i)}_updateCameraOnTerrain(){const i=this.elevation?this.elevation.getAtPoint(this.locationCoordinate(this.center),Number.NEGATIVE_INFINITY):Number.NEGATIVE_INFINITY,c=this.elevation&&i===Number.NEGATIVE_INFINITY&&this.elevation.visibleDemTiles.length>0&&this.elevation.exaggeration()>0&&this._centerAltitudeValidForExaggeration;if(!this._elevation||i===Number.NEGATIVE_INFINITY&&(!c||!this._centerAltitude))return this._centerAltitude=0,this._seaLevelZoom=null,void(this._centerAltitudeValidForExaggeration=void 0);const p=this._elevation;c||this._centerAltitude&&this._centerAltitudeValidForExaggeration&&p.exaggeration()&&this._centerAltitudeValidForExaggeration!==p.exaggeration()?(this._centerAltitude=this._centerAltitude/this._centerAltitudeValidForExaggeration*p.exaggeration(),this._centerAltitudeValidForExaggeration=p.exaggeration()):(this._centerAltitude=i||0,this._centerAltitudeValidForExaggeration=p.exaggeration()),this._updateSeaLevelZoom()}_updateSeaLevelZoom(){if(this._centerAltitudeValidForExaggeration===void 0)return;const i=Math.max(0,(this.pixelsPerMeter*this._centerAltitude+this.cameraToCenterDistance)/this.worldSize);this._seaLevelZoom=this._zoomFromMercatorZ(i)}sampleAverageElevation(){if(!this._elevation)return 0;const i=this._elevation,c=[[.5,.2],[.3,.5],[.5,.5],[.7,.5],[.5,.8]],p=this.horizonLineFromTop();let x=0,w=0;for(let A=0;A<c.length;A++){const I=new n.P(c[A][0]*this.width,p+c[A][1]*(this.height-p)),O=i.pointCoordinate(I);if(!O)continue;const z=1/Math.hypot(O[0]-this._camera.position[0],O[1]-this._camera.position[1]);x+=O[3]*z,w+=z}return w===0?NaN:x/w}get center(){return this._center}set center(i){i.lat===this._center.lat&&i.lng===this._center.lng||(this._unmodified=!1,this._center=i,this._terrainEnabled()&&(this.cameraElevationReference==="ground"?this._updateCameraOnTerrain():this._updateZoomFromElevation()),this._constrain(),this._calcMatrices())}_updateZoomFromElevation(){if(this._seaLevelZoom==null||!this._elevation)return;const i=this._seaLevelZoom,c=this._elevation.getAtPointOrZero(this.locationCoordinate(this.center)),p=this.pixelsPerMeter/this.worldSize*c,x=this._mercatorZfromZoom(i),w=this._mercatorZfromZoom(this._maxZoom),A=Math.max(x-p,w);this._setZoom(this._zoomFromMercatorZ(A))}get padding(){return this._edgeInsets.toJSON()}set padding(i){this._edgeInsets.equals(i)||(this._unmodified=!1,this._edgeInsets.interpolate(this._edgeInsets,i,1),this._calcMatrices())}computeZoomRelativeTo(i){const c=this.rayIntersectionCoordinate(this.pointRayIntersection(this.centerPoint,i.toAltitude()));let p;p=i.z<this._camera.position[2]?[c.x,c.y,c.z]:[i.x,i.y,i.z];const x=n.ag(n.av([],this._camera.position,p));return n.aA(this._zoomFromMercatorZ(x),this._minZoom,this._maxZoom)}setFreeCameraOptions(i){if(!this.height||!i.position&&!i.orientation)return;this._updateCameraState();let c=!1;if(i.orientation&&!n.co(i.orientation,this._camera.orientation)&&(c=this._setCameraOrientation(i.orientation)),i.position){const p=[i.position.x,i.position.y,i.position.z];n.cp(p,this._camera.position)||(this._setCameraPosition(p),c=!0)}c&&(this._updateStateFromCamera(),this.recenterOnTerrain())}getFreeCameraOptions(){this._updateCameraState();const i=this._camera.position,c=new Xd;return c.position=new n.ae(i[0],i[1],i[2]),c.orientation=this._camera.orientation,c._elevation=this.elevation,c._renderWorldCopies=this.renderWorldCopies,c}_setCameraOrientation(i){if(!n.cq(i))return!1;n.cr(i,i);const c=n.cs([],[0,0,-1],i),p=n.cs([],[0,-1,0],i);if(p[2]<0)return!1;const x=Wu(c,p);return!!x&&(this._camera.orientation=x,!0)}_setCameraPosition(i){const c=this.zoomScale(this.minZoom)*this.tileSize,p=this.zoomScale(this.maxZoom)*this.tileSize,x=this.cameraToCenterDistance;i[2]=n.aA(i[2],x/p,x/c),this._camera.position=i}get centerPoint(){return this._edgeInsets.getCenter(this.width,this.height)}get fovAboveCenter(){return this._fov*(.5+this.centerOffset.y/this.height)}isPaddingEqual(i){return this._edgeInsets.equals(i)}interpolatePadding(i,c,p){this._unmodified=!1,this._edgeInsets.interpolate(i,c,p),this._constrain(),this._calcMatrices()}coveringZoomLevel(i){const c=(i.roundZoom?Math.round:Math.floor)(this.zoom+this.scaleZoom(this.tileSize/i.tileSize));return Math.max(0,c)}getVisibleUnwrappedCoordinates(i){const c=[new n.ct(0,i)];if(this.renderWorldCopies){const p=this.pointCoordinate(new n.P(0,0)),x=this.pointCoordinate(new n.P(this.width,0)),w=this.pointCoordinate(new n.P(this.width,this.height)),A=this.pointCoordinate(new n.P(0,this.height)),I=Math.floor(Math.min(p.x,x.x,w.x,A.x)),O=Math.floor(Math.max(p.x,x.x,w.x,A.x)),z=1;for(let k=I-z;k<=O+z;k++)k!==0&&c.push(new n.ct(k,i))}return c}isLODDisabled(i){return(!i||this.pitch<=60)&&this._edgeInsets.top<=this._edgeInsets.bottom&&!this._elevation&&!this.projection.isReprojectedInTileSpace}extendTileCover(i,c,p){let x=[];const w=p!=null,A=!w;if(A&&this.zoom<c||w&&p[0]===0&&p[1]===0)return x;const I=new Set,O=(k,H,V,X,Y)=>{const W=n.cX(H,k,V,X,Y);I.has(W)||(x.push(new n.aO(k,H,V,X,Y)),I.add(W))};for(let k=0;k<i.length;k++){const H=i[k];if(A&&H.canonical.z!==c)continue;const V=H.canonical,X=H.overscaledZ,Y=H.wrap,W=1<<V.z,re=V.x+1<W,K=V.x>0,ae=V.y+1<W,ue=V.y>0,fe=H.wrap-(K?0:1),xe=H.wrap+(re?0:1),ge=K?V.x-1:W-1,Te=re?V.x+1:0;if(w)p[0]<0?(O(X,xe,V.z,Te,V.y),p[1]<0&&ae&&(O(X,Y,V.z,V.x,V.y+1),O(X,xe,V.z,Te,V.y+1)),p[1]>0&&ue&&(O(X,Y,V.z,V.x,V.y-1),O(X,xe,V.z,Te,V.y-1))):p[0]>0?(O(X,fe,V.z,ge,V.y),p[1]<0&&ae&&(O(X,Y,V.z,V.x,V.y+1),O(X,fe,V.z,ge,V.y+1)),p[1]>0&&ue&&(O(X,Y,V.z,V.x,V.y-1),O(X,fe,V.z,ge,V.y-1))):p[1]<0&&ae?O(X,Y,V.z,V.x,V.y+1):ue&&O(X,Y,V.z,V.x,V.y-1);else{const ye=H.visibleQuadrants;1&ye&&(O(X,fe,V.z,ge,V.y),ue&&(O(X,Y,V.z,V.x,V.y-1),O(X,fe,V.z,ge,V.y-1))),2&ye&&(O(X,xe,V.z,Te,V.y),ue&&(O(X,Y,V.z,V.x,V.y-1),O(X,xe,V.z,Te,V.y-1))),4&ye&&(O(X,fe,V.z,ge,V.y),ae&&(O(X,Y,V.z,V.x,V.y+1),O(X,fe,V.z,ge,V.y+1))),8&ye&&(O(X,xe,V.z,Te,V.y),ae&&(O(X,Y,V.z,V.x,V.y+1),O(X,xe,V.z,Te,V.y+1)))}}const z=[];for(const k of x)x.some((H=>k.isChildOf(H)))||z.push(k);if(x=z.filter((k=>!i.some((H=>!!(k.overscaledZ<c&&H.isChildOf(k))||k.equals(H)||k.isChildOf(H))))),A){const k=1<<c,H=this.projection.name==="globe"?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),V=[k*H.x,k*H.y],X=4,Y=X*X;x=x.filter((W=>{const re=W.canonical.x+.5-V[0],K=W.canonical.y+.5-V[1];return re*re+K*K<Y}))}return x}extendTileCoverToNearPlane(i,c,p){const x=[],w=new Set;for(const ae of i)w.add(ae.key);const A=(ae,ue,fe,xe,ge)=>{const Te=n.cX(ue,ae,fe,xe,ge);w.has(Te)||(x.push(new n.aO(ae,ue,fe,xe,ge)),w.add(Te))},I=i.reduce(((ae,ue)=>Math.max(ae,ue.overscaledZ)),p),O=1<<p,z=[new n.P(0,0),new n.P(n.al,0),new n.P(n.al,n.al),new n.P(0,n.al)],k=new n.P(0,0),H=new n.P(0,0),V=(ae,ue)=>{const fe=Math.floor(ae[0]),xe=Math.floor(ae[1]),ge=(ae[0]-fe)*n.al,Te=(ae[1]-xe)*n.al,ye=Math.floor(ue[0]),_e=Math.floor(ue[1]),Se=(ue[0]-ye)*n.al,He=(ue[1]-_e)*n.al;for(let ze=-1;ze<=1;ze++){const nt=fe+ze;if(!(nt<0||nt>=O)){k.x=ge-ze*n.al,H.x=Se-(nt-ye)*n.al;for(let Ge=-1;Ge<=1;Ge++){const tt=xe+Ge;k.y=Te-Ge*n.al,H.y=He-(tt-_e)*n.al,n.cY(k,H,z)&&A(I,0,p,nt,tt)}}}},X=c.points,Y=X[n.cu],W=X[n.cv],re=this._projectToGround(Y,X[n.cw]),K=this._projectToGround(W,X[n.cx]);return V(Y,re),V(W,K),x}_projectToGround(i,c){return n.cy(n.cz(),i,c,i[2]/(i[2]-c[2]))}coveringTiles(i){let c=this.coveringZoomLevel(i);const p=c,x=this.elevation&&this.elevation.exaggeration(),w=x&&!i.isTerrainDEM,A=this.projection.name==="mercator";if(i.minzoom!==void 0&&c<i.minzoom)return[];i.maxzoom!==void 0&&c>i.maxzoom&&(c=i.maxzoom);const I=this.locationCoordinate(this.center),O=this.center.lat,z=1<<c,k=[z*I.x,z*I.y,0],H=this.projection.name==="globe",V=!H,X=n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,c,V),Y=H?this._camera.mercatorPosition:this.pointCoordinate(this.getCameraPoint()),W=z*n.ce(1,this.center.lat),re=this._camera.position[2]/n.ce(1,this.center.lat),K=[z*Y.x,z*Y.y,re*(V?1:W)],ae=H||x,ue=this.cameraToCenterDistance/i.tileSize*(i.roundZoom?1:.502),fe=this.isLODDisabled(!0)?c:0;let xe;if(this._elevation&&i.isTerrainDEM)xe=1e4*this._elevation.exaggeration();else if(this._elevation){const Oe=this._elevation.getMinMaxForVisibleTiles();xe=Oe?Oe.max:this._centerAltitude}else xe=this._centerAltitude;const ge=i.isTerrainDEM?-xe:this._elevation?this._elevation.getMinElevationBelowMSL():0,Te=this.projection.isReprojectedInTileSpace?n.cB(this):1,ye=Oe=>{const je=new n.ae(Oe.x+25e-6,Oe.y,Oe.z),at=new n.ae(Oe.x,Oe.y+25e-6,Oe.z),ht=Oe.toLngLat(),wt=je.toLngLat(),ft=at.toLngLat(),pt=this.locationCoordinate(ht),rr=this.locationCoordinate(wt),tr=this.locationCoordinate(ft),or=Math.hypot(rr.x-pt.x,rr.y-pt.y),Qt=Math.hypot(tr.x-pt.x,tr.y-pt.y);return Math.sqrt(or*Qt)*Te/25e-6},_e=Oe=>{const ot=xe,je=ge;return{aabb:n.cE(this,z,0,0,0,Oe,je,ot,this.projection),zoom:0,x:0,y:0,minZ:je,maxZ:ot,wrap:Oe,fullyVisible:!1}},Se=[];let He=[];const ze=c,nt=i.reparseOverscaled?p:c,Ge=(re-this._centerAltitude)*W,tt=Oe=>{if(!this._elevation||!Oe.tileID||!A)return;const ot=this._elevation.getMinMaxForTile(Oe.tileID),je=Oe.aabb;ot?(je.min[2]=ot.min,je.max[2]=ot.max,je.center[2]=(je.min[2]+je.max[2])/2):(Oe.shouldSplit=qe(Oe),Oe.shouldSplit||(je.min[2]=je.max[2]=je.center[2]=this._centerAltitude))},It=(Oe,ot)=>{if(.707*ot<Oe)return 1;const je=ot/Oe;return je/(1.4144271570014144+(Math.pow(1.1,je-1.4144271570014144+1)-1)/(1.1-1)-1)},qe=Oe=>{if(Oe.zoom<fe)return!0;if(Oe.zoom===ze)return!1;if(Oe.shouldSplit!=null)return Oe.shouldSplit;const ot=Oe.aabb.distanceX(K),je=Oe.aabb.distanceY(K);let at=Ge,ht=1;if(H){at=Oe.aabb.distanceZ(K);const Qt=Math.pow(2,Oe.zoom),fr=n.a$((Oe.y+1)/Qt),Mr=n.a$(Oe.y/Qt),Or=Math.min(Math.max(O,fr),Mr),Si=n.d0(Or)/n.d0(O);if(ht=Or===O?1/Math.max(1,this._mercatorScaleRatio-.3):Math.min(1,Si/this._mercatorScaleRatio),this.zoom<=n.cZ&&Oe.zoom===ze-1&&Si>=.9)return!0}else if(w&&(at=Oe.aabb.distanceZ(K)*W),this.projection.isReprojectedInTileSpace&&p<=5){const Qt=Math.pow(2,Oe.zoom),fr=ye(new n.ae((Oe.x+.5)/Qt,(Oe.y+.5)/Qt));ht=fr>.85?1:fr}if(!A){const Qt=Math.sqrt(ot*ot+je*je+at*at);let fr=(1<<ze-Oe.zoom)*ue*ht;return fr*=It(Math.max(at,Ge),Qt),Qt<fr}let wt=Number.MAX_VALUE,ft=0;const pt=Oe.aabb.getCorners(),rr=[];for(const Qt of pt){n.av(rr,Qt,K),H||(w?rr[2]*=W:rr[2]=Ge);const fr=n.bJ(rr,this._camera.forward());fr<wt&&(wt=fr,ft=Math.abs(rr[2]))}let tr=(1<<ze-Oe.zoom)*ue*ht;if(tr*=It(Math.max(ft,Ge),wt),wt<tr)return!0;const or=Oe.aabb.closestPoint(k);return or[0]===k[0]&&or[1]===k[1]};if(this.renderWorldCopies)for(let Oe=1;Oe<=3;Oe++)Se.push(_e(-Oe)),Se.push(_e(Oe));for(Se.push(_e(0));Se.length>0;){const Oe=Se.pop(),ot=Oe.x,je=Oe.y;let at=Oe.fullyVisible;const ht=()=>this.projection.name==="globe"&&(Oe.y===0||Oe.y===(1<<Oe.zoom)-1);if(!at){let wt=ae?Oe.aabb.intersects(X):Oe.aabb.intersectsFlat(X);if(wt===0&&ht()){const ft=new n.cC(Oe.zoom,ot,je);wt=n.cD(this,z,ft,!0).intersects(X)}if(wt===0)continue;at=wt===2}if(Oe.zoom!==ze&&qe(Oe))for(let wt=0;wt<4;wt++){const ft=(ot<<1)+wt%2,pt=(je<<1)+(wt>>1),rr={aabb:A?Oe.aabb.quadrant(wt):n.cE(this,z,Oe.zoom+1,ft,pt,Oe.wrap,Oe.minZ,Oe.maxZ,this.projection),zoom:Oe.zoom+1,x:ft,y:pt,wrap:Oe.wrap,fullyVisible:at,tileID:void 0,shouldSplit:void 0,minZ:Oe.minZ,maxZ:Oe.maxZ};w&&!H&&(rr.tileID=new n.aO(Oe.zoom+1===ze?nt:Oe.zoom+1,Oe.wrap,Oe.zoom+1,ft,pt),tt(rr)),Se.push(rr)}else{const wt=Oe.zoom===ze?nt:Oe.zoom;if(i.minzoom&&i.minzoom>wt)continue;let ft=0;if(!at){let or=ae?Oe.aabb.intersectsPrecise(X):Oe.aabb.intersectsPreciseFlat(X);if(or===0&&ht()){const Qt=new n.cC(Oe.zoom,ot,je);or=n.cD(this,z,Qt,!0).intersectsPrecise(X)}if(or===0)continue;if(i.calculateQuadrantVisibility)if(X.containsPoint(Oe.aabb.center))ft=15;else for(let Qt=0;Qt<4;Qt++)Oe.aabb.quadrant(Qt).intersects(X)!==0&&(ft|=1<<Qt)}const pt=k[0]-(.5+ot+(Oe.wrap<<Oe.zoom))*(1<<c-Oe.zoom),rr=k[1]-.5-je,tr=Oe.tileID?Oe.tileID:new n.aO(wt,Oe.wrap,Oe.zoom,ot,je);i.calculateQuadrantVisibility&&(tr.visibleQuadrants=ft),He.push({tileID:tr,distanceSq:pt*pt+rr*rr})}}if(this.fogCullDistSq){const Oe=this.fogCullDistSq,ot=this.horizonLineFromTop();He=He.filter((je=>{const at=[0,0,0,1],ht=[n.al,n.al,0,1],wt=this.calculateFogTileMatrix(je.tileID.toUnwrapped());n.aC(at,at,wt),n.aC(ht,ht,wt);const ft=n.cF([],at,ht),pt=n.cG([],at,ht),rr=n.c_(ft,pt);if(rr===0)return!0;let tr=!1;const or=this._elevation;if(or&&rr>Oe&&ot!==0){const Qt=this.calculateProjMatrix(je.tileID.toUnwrapped());let fr;i.isTerrainDEM||(fr=or.getMinMaxForTile(je.tileID)),fr||(fr={min:ge,max:xe});const Mr=n.cH(this.rotation),Or=[Mr[0]*n.al,Mr[1]*n.al,fr.max];n.af(Or,Or,Qt),tr=(1-Or[1])*this.height*.5<ot}return rr<Oe||tr}))}return He.sort(((Oe,ot)=>Oe.distanceSq-ot.distanceSq)).map((Oe=>Oe.tileID))}resize(i,c){this.width=i,this.height=c,this.pixelsToGLUnits=[2/i,-2/c],this._constrain(),this._calcMatrices()}get unmodified(){return this._unmodified}zoomScale(i){return Math.pow(2,i)}scaleZoom(i){return Math.log2(i)}project(i){const c=n.aA(i.lat,-n.cI,n.cI),p=this.projection.project(i.lng,c);return new n.P(p.x*this.worldSize,p.y*this.worldSize)}unproject(i){return this.projection.unproject(i.x/this.worldSize,i.y/this.worldSize)}get point(){return this.project(this.center)}get pointMerc(){return this.point._div(this.worldSize)}get pixelsPerMeterRatio(){return this.pixelsPerMeter/n.ce(1,this.center.lat)/this.worldSize}setLocationAtPoint(i,c){let p,x;const w=this.centerPoint;if(this.projection.name==="globe"){const I=this.worldSize;p=(c.x-w.x)/I,x=(c.y-w.y)/I}else{const I=this.pointCoordinate(c),O=this.pointCoordinate(w);p=I.x-O.x,x=I.y-O.y}const A=this.locationCoordinate(i);this.setLocation(new n.ae(A.x-p,A.y-x))}setLocation(i){this.center=this.coordinateLocation(i),this.projection.wrap&&(this.center=this.center.wrap())}locationPoint(i,c){return this.projection.locationPoint(this,i,c)}locationPoint3D(i,c){return this.projection.locationPoint(this,i,c,!0)}pointLocation(i){return this.coordinateLocation(this.pointCoordinate(i))}pointLocation3D(i,c){return this.coordinateLocation(this.pointCoordinate3D(i,c))}locationCoordinate(i,c){const p=c?n.ce(c,i.lat):void 0,x=this.projection.project(i.lng,i.lat);return new n.ae(x.x,x.y,p)}coordinateLocation(i){return this.projection.unproject(i.x,i.y)}pointRayIntersection(i,c){const p=c??this._centerAltitude,x=[i.x,i.y,0,1],w=[i.x,i.y,1,1];n.aC(x,x,this.pixelMatrixInverse),n.aC(w,w,this.pixelMatrixInverse);const A=w[3];n.cJ(x,x,1/x[3]),n.cJ(w,w,1/A);const I=x[2],O=w[2];return{p0:x,p1:w,t:I===O?0:(p-I)/(O-I)}}screenPointToMercatorRay(i){const c=[i.x,i.y,0,1],p=[i.x,i.y,1,1];return n.aC(c,c,this.pixelMatrixInverse),n.aC(p,p,this.pixelMatrixInverse),n.cJ(c,c,1/c[3]),n.cJ(p,p,1/p[3]),c[2]=n.ce(c[2],this._center.lat)*this.worldSize,p[2]=n.ce(p[2],this._center.lat)*this.worldSize,n.cJ(c,c,1/this.worldSize),n.cJ(p,p,1/this.worldSize),new n.ax([c[0],c[1],c[2]],n.aw([],n.av([],p,c)))}rayIntersectionCoordinate(i){const{p0:c,p1:p,t:x}=i,w=n.ce(c[2],this._center.lat),A=n.ce(p[2],this._center.lat);return new n.ae(n.ak(c[0],p[0],x)/this.worldSize,n.ak(c[1],p[1],x)/this.worldSize,n.ak(w,A,x))}pointCoordinate(i,c=this._centerAltitude){return this.projection.pointCoordinate(this,i.x,i.y,c)}pointCoordinate3D(i,c){if(!this.elevation)return this.pointCoordinate(i,c);let p=this.projection.pointCoordinate3D(this,i.x,i.y);if(p)return new n.ae(p[0],p[1],p[2]);let x=0,w=this.horizonLineFromTop();if(i.y>w)return this.pointCoordinate(i,c);const A=.02*w,I=i.clone();for(let O=0;O<10&&w-x>A;O++){I.y=n.ak(x,w,.66);const z=this.projection.pointCoordinate3D(this,I.x,I.y);z?(w=I.y,p=z):x=I.y}return p?new n.ae(p[0],p[1],p[2]):this.pointCoordinate(i)}isPointAboveHorizon(i){return this.projection.isPointAboveHorizon(this,i)}isPointOnSurface(i){if(i.y<0||i.y>this.height||i.x<0||i.x>this.width)return!1;if(this.elevation||this.zoom>=n.cK)return!this.isPointAboveHorizon(i);const c=this.pointCoordinate(i);return c.y>=0&&c.y<=1}_coordinatePoint(i,c){const p=c&&this.elevation?this.elevation.getAtPointOrZero(i,this._centerAltitude):this._centerAltitude,x=[i.x*this.worldSize,i.y*this.worldSize,p+i.toAltitude(),1];return n.aC(x,x,this.pixelMatrix),x[3]>0?new n.P(x[0]/x[3],x[1]/x[3]):new n.P(Number.MAX_VALUE,Number.MAX_VALUE)}_getBoundsNonRectangular(){const{top:i,left:c}=this._edgeInsets,p=this.height-this._edgeInsets.bottom,x=this.width-this._edgeInsets.right,w=this.pointLocation3D(new n.P(c,i)),A=this.pointLocation3D(new n.P(x,i)),I=this.pointLocation3D(new n.P(x,p)),O=this.pointLocation3D(new n.P(c,p));let z=Math.min(w.lng,A.lng,I.lng,O.lng),k=Math.max(w.lng,A.lng,I.lng,O.lng),H=Math.min(w.lat,A.lat,I.lat,O.lat),V=Math.max(w.lat,A.lat,I.lat,O.lat);const X=Math.pow(2,-this.zoom)/16*270,Y=this.projection.name==="globe"?1:4,W=(re,K,ae,ue,fe)=>{const xe=(re+ae)/2,ge=(K+ue)/2,Te=new n.P(xe,ge),{lng:ye,lat:_e}=this.pointLocation3D(Te),Se=Math.max(0,z-ye,H-_e,ye-k,_e-V);z=Math.min(z,ye),k=Math.max(k,ye),H=Math.min(H,_e),V=Math.max(V,_e),(fe<Y||Se>X)&&(W(re,K,xe,ge,fe+1),W(xe,ge,ae,ue,fe+1))};if(W(c,i,x,i,1),W(x,i,x,p,1),W(x,p,c,p,1),W(c,p,c,i,1),this.projection.name==="globe"){const[re,K]=n.cL(this);re?(V=90,k=180,z=-180):K&&(H=-90,k=180,z=-180)}return new n.aI(new n.aR(z,H),new n.aR(k,V))}_getBoundsRectangular(i,c){const{top:p,left:x}=this._edgeInsets,w=this.height-this._edgeInsets.bottom,A=this.width-this._edgeInsets.right,I=new n.P(x,p),O=new n.P(A,p),z=new n.P(A,w),k=new n.P(x,w);let H=this.pointCoordinate(I,i),V=this.pointCoordinate(O,i);const X=this.pointCoordinate(z,c),Y=this.pointCoordinate(k,c),W=(re,K)=>(K.y-re.y)/(K.x-re.x);return H.y>1&&V.y>=0?H=new n.ae((1-Y.y)/W(Y,H)+Y.x,1):H.y<0&&V.y<=1&&(H=new n.ae(-Y.y/W(Y,H)+Y.x,0)),V.y>1&&H.y>=0?V=new n.ae((1-X.y)/W(X,V)+X.x,1):V.y<0&&H.y<=1&&(V=new n.ae(-X.y/W(X,V)+X.x,0)),new n.aI().extend(this.coordinateLocation(H)).extend(this.coordinateLocation(V)).extend(this.coordinateLocation(Y)).extend(this.coordinateLocation(X))}_getBoundsRectangularTerrain(){const i=this.elevation;if(!i.visibleDemTiles.length||i.isUsingMockSource())return this._getBoundsRectangular(0,0);const c=i.visibleDemTiles.reduce(((p,x)=>{if(x.dem){const w=x.dem.tree;p.min=Math.min(p.min,w.minimums[0]),p.max=Math.max(p.max,w.maximums[0])}return p}),{min:Number.MAX_VALUE,max:0});return this._getBoundsRectangular(c.min*i.exaggeration(),c.max*i.exaggeration())}getBounds(){return this.projection.name==="mercator"||this.projection.name==="equirectangular"?this._terrainEnabled()?this._getBoundsRectangularTerrain():this._getBoundsRectangular(0,0):this._getBoundsNonRectangular()}horizonLineFromTop(i=!0){const c=this.height/2/Math.tan(this._fov/2)/Math.tan(Math.max(this._pitch,.1))-this.centerOffset.y,p=this.height/2-c*(1-this._horizonShift);return i?Math.max(0,p):p}getMaxBounds(){return this.maxBounds}setMaxBounds(i){this.maxBounds=i,this.minLat=-n.cI,this.maxLat=n.cI,this.minLng=-180,this.maxLng=180,i&&(this.minLat=i.getSouth(),this.maxLat=i.getNorth(),this.minLng=i.getWest(),this.maxLng=i.getEast(),this.maxLng<this.minLng&&(this.maxLng+=360)),this.worldMinX=n.aF(this.minLng)*this.tileSize,this.worldMaxX=n.aF(this.maxLng)*this.tileSize,this.worldMinY=n.aJ(this.maxLat)*this.tileSize,this.worldMaxY=n.aJ(this.minLat)*this.tileSize,this._constrain()}calculatePosMatrix(i,c){return this.projection.createTileMatrix(this,c,i)}calculateDistanceTileData(i){const c=i.key,p=this._distanceTileDataCache;if(p[c])return p[c];const x=i.canonical,w=1/this.height,A=this.cameraWorldSize,I=A/this.zoomScale(x.z),O=(x.x+Math.pow(2,x.z)*i.wrap)*I,z=x.y*I,k=this.point;k.x*=A/this.worldSize,k.y*=A/this.worldSize;const H=this.angle,V=Math.sin(-H),X=-Math.cos(-H);return p[c]={bearing:[V,X],center:[(k.x-O)*w,(k.y-z)*w],scale:I/n.al*w},p[c]}calculateFogTileMatrix(i){const c=i.key,p=this._fogTileMatrixCache;if(p[c])return p[c];const x=this.projection.createTileMatrix(this,this.cameraWorldSizeForFog,i);return n.aB(x,this.worldToFogMatrix,x),p[c]=new Float32Array(x),p[c]}calculateProjMatrix(i,c=!1,p=!1){const x=i.key;let w;if(w=p?this._expandedProjMatrixCache:c?this._alignedProjMatrixCache:this._projMatrixCache,w[x])return w[x];const A=this.calculatePosMatrix(i,this.worldSize);let I;return I=this.projection.isReprojectedInTileSpace?this.mercatorMatrix:p?this.expandedFarZProjMatrix:c?this.alignedProjMatrix:this.projMatrix,n.aB(A,I,A),w[x]=new Float32Array(A),w[x]}calculatePixelsToTileUnitsMatrix(i){const c=i.tileID.key,p=this._pixelsToTileUnitsCache;if(p[c])return p[c];const x=n.cM(i,this);return p[c]=x,p[c]}customLayerMatrix(){return this.mercatorMatrix.slice()}globeToMercatorMatrix(){if(this.projection.name==="globe"){const i=1/this.worldSize,c=n.bq([],[i,i,i]);return n.aB(c,c,this.globeMatrix),c}}recenterOnTerrain(){if(!this._elevation||this.projection.name==="globe")return;const i=this._elevation;this._updateCameraState();const c=n.ce(1,this._center.lat)*this.worldSize,p=this._computeCameraPosition(c),x=this._camera.forward(),w=n.ce(1,this._center.lat);p[2]/=w,x[2]/=w,n.aw(x,x);const A=i.raycast(p,x,i.exaggeration());if(A){const I=n.bH([],p,x,A),O=new n.ae(I[0],I[1],n.ce(I[2],n.a$(I[1]))),z=(O.z+n.ag([O.x-p[0],O.y-p[1],O.z-p[2]*w]))*this._pixelsPerMercatorPixel;this._seaLevelZoom=this._zoomFromMercatorZ(z),this._centerAltitude=O.toAltitude(),this._center=this.coordinateLocation(O),this._updateZoomFromElevation(),this._constrain(),this._calcMatrices()}}_constrainCamera(i=!1){if(!this._elevation)return;const c=this._elevation,p=n.ce(1,this._center.lat)*this.worldSize,x=this._computeCameraPosition(p),w=c.getAtPointOrZero(new n.ae(...x)),A=this.pixelsPerMeter/this.worldSize*w,I=this._minimumHeightOverTerrain(),O=x[2]-A;if(O<=I)if(O<0||i){const z=this.locationCoordinate(this._center,this._centerAltitude),k=[x[0],x[1],z.z-x[2]],H=n.ag(k);k[2]-=(I-O)/this._pixelsPerMercatorPixel;const V=n.ag(k);if(V===0)return;n.c4(k,k,H/V*this._pixelsPerMercatorPixel),this._camera.position=[x[0],x[1],z.z*this._pixelsPerMercatorPixel-k[2]],this._updateStateFromCamera()}else this._isCameraConstrained=!0}_constrain(){if(!this.center||!this.width||!this.height||this._constraining)return;this._constraining=!0;const i=this.projection.name==="globe"||this.mercatorFromTransition;if(this.projection.isReprojectedInTileSpace||i){const V=this.center;return V.lat=n.aA(V.lat,this.minLat,this.maxLat),(this.maxBounds||!this.renderWorldCopies&&!i)&&(V.lng=n.aA(V.lng,this.minLng,this.maxLng)),this.center=V,void(this._constraining=!1)}const c=this._unmodified,{x:p,y:x}=this.point;let w=0,A=p,I=x;const O=this.width/2,z=this.height/2,k=this.worldMinY*this.scale,H=this.worldMaxY*this.scale;if(x-z<k&&(I=k+z),x+z>H&&(I=H-z),H-k<this.height&&(w=Math.max(w,this.height/(H-k)),I=(H+k)/2),this.maxBounds||!this._renderWorldCopies||!this.projection.wrap){const V=this.worldMinX*this.scale,X=this.worldMaxX*this.scale,Y=this.worldSize/2-(V+X)/2;A=(p+Y+this.worldSize)%this.worldSize-Y,A-O<V&&(A=V+O),A+O>X&&(A=X-O),X-V<this.width&&(w=Math.max(w,this.width/(X-V)),A=(X+V)/2)}A===p&&I===x||this._allowWorldUnderZoom||(this.center=this.unproject(new n.P(A,I))),w&&!this._allowWorldUnderZoom&&(this.zoom+=this.scaleZoom(w)),this._constrainCamera(),this._unmodified=c,this._constraining=!1}_minZoomForBounds(){let i=Math.max(0,this.scaleZoom(Math.max(0,this.height)/(this.worldMaxY-this.worldMinY)));return this.maxBounds&&(i=Math.max(i,this.scaleZoom(this.width/(this.worldMaxX-this.worldMinX)))),i}_maxCameraBoundsDistance(){return this._mercatorZfromZoom(this._minZoomForBounds())}_calcMatrices(){if(!this.height)return;const i=this.centerOffset,c=this.projection.name==="globe",p=this.pixelsPerMeter;this.projection.name==="globe"&&(this._mercatorScaleRatio=n.ce(1,this.center.lat)/n.ce(1,n.d1));const x=n.cN(this.projection,this.zoom,this.width,this.height,1024);this._pixelsPerMercatorPixel=this.projection.pixelSpaceConversion(this.center.lat,this.worldSize,x),this.cameraToCenterDistance=.5/Math.tan(.5*this._fov)*this.height*this._pixelsPerMercatorPixel,this._updateCameraState(),this._farZ=this.projection.farthestPixelDistance(this),this._nearZ=this.height/50;const w=this.projection.zAxisUnit==="meters"?p:1,A=this._camera.getWorldToCamera(this.worldSize,w);let I;const O=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,this._farZ);if(O[8]=2*-i.x/this.width,O[9]=2*i.y/this.height,this.isOrthographic){let _e=.5*this.height/Math.tan(this._fov/2)*1*Math.tan(.5*this._fov),Se=_e*this.aspect,He=-Se,ze=-_e;Se-=i.x,He-=i.x,_e+=i.y,ze+=i.y,I=this._camera.getCameraToClipOrthographic(He,Se,ze,_e,this._nearZ,this._farZ),((nt,Ge,tt,It)=>{for(let qe=0;qe<16;qe++)nt[qe]=n.ak(Ge[qe],tt[qe],It)})(I,I,O,n.c$(this.pitch>=lc?1:this.pitch/lc))}else I=O;const z=n.cO([],O,A);let k=n.cO([],I,A);if(this.projection.isReprojectedInTileSpace){const _e=this.locationCoordinate(this.center),Se=n.bA([]);n.br(Se,Se,[_e.x*this.worldSize,_e.y*this.worldSize,0]),n.aB(Se,Se,n.cP(this)),n.br(Se,Se,[-_e.x*this.worldSize,-_e.y*this.worldSize,0]),n.aB(k,k,Se),n.aB(z,z,Se),this.inverseAdjustmentMatrix=n.cQ(this)}else this.inverseAdjustmentMatrix=[1,0,0,1];if(this.mercatorMatrix=n.cR([],k,[this.worldSize,this.worldSize,this.worldSize/w,1]),this.projMatrix=k,this.invProjMatrix=n.bl(new Float64Array(16),this.projMatrix),c){const _e=this._camera.getCameraToClipPerspective(this._fov,this.width/this.height,this._nearZ,1/0);_e[8]=2*-i.x/this.width,_e[9]=2*i.y/this.height,this.expandedFarZProjMatrix=n.cO([],_e,A)}else this.expandedFarZProjMatrix=this.projMatrix;const H=n.bl([],I);this.frustumCorners=n.cS.fromInvProjectionMatrix(H,this.horizonLineFromTop(),this.height),this.cameraFrustum=n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,0,!c);const V=new Float32Array(16);n.bA(V),n.cR(V,V,[1,-1,1]),n.cT(V,V,this._pitch),n.bB(V,V,this.angle);const X=n.cc(new Float32Array(16),this._fov,this.width/this.height,this._nearZ,this._farZ);this.starsProjMatrix=n.bz(X);const Y=(Math.PI/2-this._pitch)*(this.height/this._fov)*this._horizonShift;X[8]=2*-i.x/this.width,X[9]=2*(i.y+Y)/this.height,this.skyboxMatrix=n.aB(V,X,V);const W=this.point,re=W.x,K=W.y,ae=this.width%2/2,ue=this.height%2/2,fe=Math.cos(this.angle),xe=Math.sin(this.angle),ge=re-Math.round(re)+fe*ae+xe*ue,Te=K-Math.round(K)+fe*ue+xe*ae,ye=new Float64Array(k);if(n.br(ye,ye,[ge>.5?ge-1:ge,Te>.5?Te-1:Te,0]),this.alignedProjMatrix=ye,k=n.bC(),n.cR(k,k,[this.width/2,-this.height/2,1]),n.br(k,k,[1,-1,0]),this.labelPlaneMatrix=k,k=n.bC(),n.cR(k,k,[1,-1,1]),n.br(k,k,[-1,-1,0]),n.cR(k,k,[2/this.width,2/this.height,1]),this.glCoordMatrix=k,this.pixelMatrix=n.aB(new Float64Array(16),this.labelPlaneMatrix,z),this._calcFogMatrices(),this._distanceTileDataCache={},k=n.bl(new Float64Array(16),this.pixelMatrix),!k)throw new Error("failed to invert matrix");if(this.pixelMatrixInverse=k,this.projection.name==="globe"||this.mercatorFromTransition){this.globeMatrix=n.cU(this);const _e=[this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]];this.globeCenterInViewSpace=n.af(_e,_e,A),this.globeRadius=this.worldSize/2/Math.PI-1}else this.globeMatrix=k;this._projMatrixCache={},this._alignedProjMatrixCache={},this._pixelsToTileUnitsCache={},this._expandedProjMatrixCache={}}_calcFogMatrices(){this._fogTileMatrixCache={};const i=this.cameraWorldSizeForFog,c=this.cameraPixelsPerMeter,p=this._camera.position,x=1/this.height/this._pixelsPerMercatorPixel,w=[i,i,c];n.c4(w,w,x),n.c4(p,p,-1),n.cV(p,p,w);const A=n.bC();n.br(A,A,p),n.cR(A,A,w),this.mercatorFogMatrix=A,this.worldToFogMatrix=this._camera.getWorldToCameraPosition(i,c,x)}_computeCameraPosition(i){const c=(i=i||this.pixelsPerMeter)/this.pixelsPerMeter,p=this._camera.forward(),x=this.point,w=this._mercatorZfromZoom(this._seaLevelZoom?this._seaLevelZoom:this._zoom)*c-i/this.worldSize*this._centerAltitude;return[x.x/this.worldSize-p[0]*w,x.y/this.worldSize-p[1]*w,i/this.worldSize*this._centerAltitude-p[2]*w]}_updateCameraState(){this.height&&(this._camera.setPitchBearing(this._pitch,this.angle),this._camera.position=this._computeCameraPosition())}_translateCameraConstrained(i){const c=this._maxCameraBoundsDistance()*Math.cos(this._pitch),p=this._camera.position[2],x=i[2];let w=1;this.projection.wrap&&(this.center=this.center.wrap()),x>0&&(w=Math.min((c-p)/x,1)),this._camera.position=n.bH([],this._camera.position,i,w),this._updateStateFromCamera()}_updateStateFromCamera(){const i=this._camera.position,c=this._camera.forward(),{pitch:p,bearing:x}=this._camera.getPitchBearing(),w=n.ce(this._centerAltitude,this.center.lat)*this._pixelsPerMercatorPixel,A=this._mercatorZfromZoom(this._maxZoom)*Math.cos(n.an(this._maxPitch)),I=Math.max((i[2]-w)/Math.cos(p),A),O=this._zoomFromMercatorZ(I);n.bH(i,i,c,I),this._pitch=n.aA(p,n.an(this.minPitch),n.an(this.maxPitch)),this.angle=n.bT(x,-Math.PI,Math.PI),this._setZoom(n.aA(O,this._minZoom,this._maxZoom)),this._updateSeaLevelZoom(),this._center=this.coordinateLocation(new n.ae(i[0],i[1],i[2])),this._unmodified=!1,this._constrain(),this._calcMatrices()}_worldSizeFromZoom(i){return Math.pow(2,i)*this.tileSize}_mercatorZfromZoom(i){return this.cameraToCenterDistance/this._worldSizeFromZoom(i)}_minimumHeightOverTerrain(){const i=Math.min(this._seaLevelZoom!=null?this._seaLevelZoom:this._zoom,this._maxZoom)+4;return this._mercatorZfromZoom(i)}_zoomFromMercatorZ(i){return this.scaleZoom(this.cameraToCenterDistance/(Math.max(0,i)*this.tileSize))}zoomFromMercatorZAdjusted(i){let c=0,p=n.cK,x=0,w=1/0;for(;p-c>1e-6&&p>c;){const A=c+.5*(p-c),I=this.tileSize*Math.pow(2,A),O=this.getCameraToCenterDistance(this.projection,A,I),z=this.scaleZoom(O/(Math.max(0,i)*this.tileSize)),k=Math.abs(A-z);k<w&&(w=k,x=A),A<z?c=A:p=A}return x}_terrainEnabled(){return!(!this._elevation||!this.projection.supportsTerrain&&(n.w("Terrain is not yet supported with alternate projections. Use mercator or globe to enable terrain."),1))}anyCornerOffEdge(i,c){const p=Math.min(i.x,c.x),x=Math.max(i.x,c.x),w=Math.min(i.y,c.y),A=Math.max(i.y,c.y);if(w<this.horizonLineFromTop(!1))return!0;if(this.projection.name!=="mercator")return!1;const I=[new n.P(p,w),new n.P(x,A),new n.P(p,A),new n.P(x,w)],O=this.renderWorldCopies?-3:0,z=this.renderWorldCopies?4:1;for(const k of I){const H=this.pointRayIntersection(k);if(H.t<0)return!0;const V=this.rayIntersectionCoordinate(H);if(V.x<O||V.y<0||V.x>z||V.y>1)return!0}return!1}isHorizonVisible(){return this.pitch+n.cW(this.fovAboveCenter)>88||this.anyCornerOffEdge(new n.P(0,0),new n.P(this.width,this.height))}zoomDeltaToMovement(i,c){const p=n.ag(n.av([],this._camera.position,i)),x=this._zoomFromMercatorZ(p)+c;return p-this._mercatorZfromZoom(x)}getCameraPoint(){if(this.projection.name==="globe"){const i=(function([c,p,x],w){const A=[c,p,x,1];n.aC(A,A,w);const I=A[3]=Math.max(A[3],1e-6);return A[0]/=I,A[1]/=I,A[2]/=I,A})([this.globeMatrix[12],this.globeMatrix[13],this.globeMatrix[14]],this.pixelMatrix);return new n.P(i[0],i[1])}{const i=Math.tan(this._pitch)*(this.cameraToCenterDistance||1);return this.centerPoint.add(new n.P(0,i))}}getCameraToCenterDistance(i,c=this.zoom,p=this.worldSize){const x=n.cN(i,c,this.width,this.height,1024),w=i.pixelSpaceConversion(this.center.lat,p,x);let A=.5/Math.tan(.5*this._fov)*this.height*w;return this.isOrthographic&&(A=n.ak(1,A,n.c$(this.pitch>=lc?1:this.pitch/lc))),A}getWorldToCameraMatrix(){const i=this._camera.getWorldToCamera(this.worldSize,this.projection.zAxisUnit==="meters"?this.pixelsPerMeter:1);return this.projection.name==="globe"&&n.aB(i,i,this.globeMatrix),i}getFrustum(i){return n.cA.fromInvProjectionMatrix(this.invProjMatrix,this.worldSize,i,this.projection.zAxisUnit==="meters")}}const Qc=(g,i)=>{if(i>0&&g.terrain&&n.w("Cutoff is currently disabled on terrain"),i<=0||g.terrain)return{shouldRenderCutoff:!1,uniformValues:{u_cutoff_params:[0,0,0,1]}};const c=g.transform,p=Math.max(Math.abs(c._zoom-(g.minCutoffZoom-1)),1),x=c.isLODDisabled(!1)?n.ah(60,45,c.pitch):n.ah(30,15,c.pitch),w=c._farZ-c._nearZ,A=i*c.height,I=((1-(O=x))*c.cameraToCenterDistance+O*(c._farZ+A))*p;var O;return{shouldRenderCutoff:x<1,uniformValues:{u_cutoff_params:[c._nearZ,c._farZ,(I-c._nearZ)/w,(I-A-c._nearZ)/w]}}},Do={cascadeCount:2,normalOffset:3,shadowMapResolution:2048};class Ha{constructor(i,c){this.aabb=i,this.lastCascade=c}}class cc{add(i,c){const p=this.receivers[i.key];p!==void 0?(p.aabb.min[0]=Math.min(p.aabb.min[0],c.min[0]),p.aabb.min[1]=Math.min(p.aabb.min[1],c.min[1]),p.aabb.min[2]=Math.min(p.aabb.min[2],c.min[2]),p.aabb.max[0]=Math.max(p.aabb.max[0],c.max[0]),p.aabb.max[1]=Math.max(p.aabb.max[1],c.max[1]),p.aabb.max[2]=Math.max(p.aabb.max[2],c.max[2])):this.receivers[i.key]=new Ha(c,null)}clear(){this.receivers={}}get(i){return this.receivers[i.key]}computeRequiredCascades(i,c,p){const x=n.d8.fromPoints(i.points);let w=0;for(const A in this.receivers){const I=this.receivers[A];if(!I||!x.intersectsAabb(I.aabb))continue;I.aabb.min=x.closestPoint(I.aabb.min),I.aabb.max=x.closestPoint(I.aabb.max);const O=I.aabb.getCorners();for(let z=0;z<p.length;z++){let k=!0;for(const H of O){const V=[H[0]*c,H[1]*c,H[2]];if(n.af(V,V,p[z].matrix),V[0]<-1||V[0]>1||V[1]<-1||V[1]>1){k=!1;break}}if(I.lastCascade=z,w=Math.max(w,z),k)break}}return w+1}}class Cg{constructor(i){this.painter=i,this._enabled=!1,this._shadowLayerCount=0,this._numCascadesToRender=0,this._cascades=[],this._groundShadowTiles=[],this._receivers=new cc,this._depthMode=new qt(i.context.gl.LEQUAL,qt.ReadWrite,[0,1]),this._uniformValues={u_light_matrix_0:new Float32Array(16),u_light_matrix_1:new Float32Array(16),u_shadow_intensity:0,u_fade_range:[0,0],u_shadow_normal_offset:[1,1,1],u_shadow_texel_size:1,u_shadow_map_resolution:1,u_shadow_direction:[0,0,1],u_shadow_bias:[36e-5,.0012,.012],u_shadowmap_0:0,u_shadowmap_1:0},this._forceDisable=!1,this.useNormalOffset=!1,i.tp.registerParameter(this,["Shadows"],"_forceDisable",{label:"forceDisable"},(()=>{this.painter.style.map.triggerRepaint()})),i.tp.registerParameter(Do,["Shadows"],"cascadeCount",{min:1,max:2,step:1}),i.tp.registerParameter(Do,["Shadows"],"normalOffset",{min:0,max:10,step:.05}),i.tp.registerParameter(Do,["Shadows"],"shadowMapResolution",{min:32,max:2048,step:32}),i.tp.registerBinding(this,["Shadows"],"_numCascadesToRender",{readonly:!0,label:"numCascadesToRender"})}destroy(){for(const i of this._cascades)i.texture.destroy(),i.framebuffer.destroy();this._cascades=[]}updateShadowParameters(i,c){const p=this.painter;if(this._enabled=!1,this._shadowLayerCount=0,this._receivers.clear(),!c||!c.properties)return;const x=c.properties.get("shadow-intensity");if(!c.shadowsEnabled()||x<=0||(this._shadowLayerCount=p.style.order.reduce(((Y,W)=>{const re=p.style._mergedLayers[W];return Y+(re.hasShadowPass()&&!re.isHidden(i.zoom)?1:0)}),0),this._enabled=this._shadowLayerCount>0,!this.enabled))return;const w=p.context,A=Do.shadowMapResolution,I=Do.shadowMapResolution;if(this._cascades.length===0||Do.shadowMapResolution!==this._cascades[0].texture.size[0]){this._cascades=[];for(let Y=0;Y<Do.cascadeCount;++Y){const W=p._shadowMapDebug,re=w.gl,K=w.createFramebuffer(A,I,W,"texture"),ae=new n.T(w,{width:A,height:I,data:null},re.DEPTH_COMPONENT16);if(K.depthAttachment.set(ae.texture),W){const ue=new n.T(w,{width:A,height:I,data:null},re.RGBA8);K.colorAttachment.set(ue.texture)}this._cascades.push({framebuffer:K,texture:ae,matrix:[],far:0,boundingSphereRadius:0,frustum:new n.cA,scale:0})}}this.shadowDirection=Yu(c);let O=0;if(i.elevation){const Y=i.elevation,W=[1e4,-1e4];Y.visibleDemTiles.filter((re=>re.dem)).forEach((re=>{const K=re.dem.tree;W[0]=Math.min(W[0],K.minimums[0]),W[1]=Math.max(W[1],K.maximums[0])})),W[0]!==1e4&&(O=(W[1]-W[0])*Y.exaggeration())}const z=1.5*i.cameraToCenterDistance,k=3*z,H=new Float64Array(16);for(let Y=0;Y<this._cascades.length;++Y){const W=this._cascades[Y];let re=i.height/50,K=1;Do.cascadeCount===1?K=k:Y===0?K=z:(re=z,K=k);const[ae,ue]=xm(i,this.shadowDirection,re,K,Do.shadowMapResolution,O);W.scale=i.scale,W.matrix=ae,W.boundingSphereRadius=ue,n.bl(H,W.matrix),W.frustum=n.cA.fromInvProjectionMatrix(H,1,0,!0),W.far=K}const V=this._cascades.length-1;this._uniformValues.u_fade_range=[.75*this._cascades[V].far,this._cascades[V].far],this._uniformValues.u_shadow_intensity=x,this._uniformValues.u_shadow_direction=[this.shadowDirection[0],this.shadowDirection[1],this.shadowDirection[2]],this._uniformValues.u_shadow_texel_size=1/Do.shadowMapResolution,this._uniformValues.u_shadow_map_resolution=Do.shadowMapResolution,this._uniformValues.u_shadowmap_0=kn.ShadowMap0,this._uniformValues.u_shadowmap_1=kn.ShadowMap0+1,this._groundShadowTiles=p.transform.coveringTiles({tileSize:512,renderWorldCopies:!0});const X=p.transform.elevation;for(const Y of this._groundShadowTiles){let W={min:0,max:0};if(X){const re=X.getMinMaxForTile(Y);re&&(W=re)}this.addShadowReceiver(Y.toUnwrapped(),W.min,W.max)}}get enabled(){return this._enabled&&!this._forceDisable}set enabled(i){this._enabled=i}drawShadowPass(i,c){if(!this.enabled)return;const p=this.painter,x=p.context;this._numCascadesToRender=this._receivers.computeRequiredCascades(p.transform.getFrustum(0),p.transform.worldSize,this._cascades),x.viewport.set([0,0,Do.shadowMapResolution,Do.shadowMapResolution]);for(let w=0;w<this._numCascadesToRender;++w){p.currentShadowCascade=w,x.bindFramebuffer.set(this._cascades[w].framebuffer.framebuffer),x.clear({color:n.ao.white,depth:1});for(const A of i.order){const I=i._mergedLayers[A];if(!I.hasShadowPass()||I.isHidden(p.transform.zoom))continue;const O=i.getLayerSourceCache(I),z=O?c[O.id]:void 0;(I.type==="model"||z&&z.length)&&p.renderLayer(p,O,I,z)}}p.currentShadowCascade=0}drawGroundShadows(){if(!this.enabled)return;const i=this.painter,c=i.style,p=i.context,x=p.gl,w=c.directionalLight,A=c.ambientLight;if(!w||!A)return;const I=[],O=Qc(i,i.longestCutoffRange);O.shouldRenderCutoff&&I.push("RENDER_CUTOFF"),I.push("RENDER_SHADOWS","DEPTH_TEXTURE"),this.useNormalOffset&&I.push("NORMAL_OFFSET");const z=Ts(c,w,A),k=new qt(x.LEQUAL,qt.ReadOnly,i.depthRangeFor3D),H=new vr({func:x.EQUAL,mask:255},0,255,x.KEEP,x.KEEP,x.KEEP);for(const V of this._groundShadowTiles){const X=V.toUnwrapped(),Y=i.isTileAffectedByFog(V),W=i.getOrCreateProgram("groundShadow",{defines:I,overrideFog:Y});this.setupShadows(X,W),i.uploadCommonUniforms(p,W,X,null,O);const re={u_matrix:i.transform.calculateProjMatrix(X),u_ground_shadow_factor:z};W.draw(i,x.TRIANGLES,k,H,kr.multiply,Tr.disabled,re,"ground_shadow",i.tileExtentBuffer,i.quadTriangleIndexBuffer,i.tileExtentSegments,null,i.transform.zoom,null,null)}}getShadowPassColorMode(){return this.painter._shadowMapDebug?kr.unblended:kr.disabled}getShadowPassDepthMode(){return this._depthMode}getShadowCastingLayerCount(){return this._shadowLayerCount}calculateShadowPassMatrixFromTile(i){const c=this.painter.transform,p=c.calculatePosMatrix(i,c.worldSize);return n.aB(p,this._cascades[this.painter.currentShadowCascade].matrix,p),Float32Array.from(p)}calculateShadowPassMatrixFromMatrix(i){return n.aB(i,this._cascades[this.painter.currentShadowCascade].matrix,i),Float32Array.from(i)}setupShadows(i,c,p){if(!this.enabled)return;const x=this.painter.transform,w=this.painter.context,A=w.gl,I=this._uniformValues,O=new Float64Array(16),z=x.calculatePosMatrix(i,x.worldSize);for(let k=0;k<this._cascades.length;k++)n.aB(O,this._cascades[k].matrix,z),I[k===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(O),w.activeTexture.set(A.TEXTURE0+kn.ShadowMap0+k),this._cascades[k].texture.bindExtraParam(A.LINEAR,A.LINEAR,A.CLAMP_TO_EDGE,A.CLAMP_TO_EDGE,A.GREATER);if(this.useNormalOffset=!!p,this.useNormalOffset){const k=n.d6(i.canonical),H=2/x.tileSize*n.al/Do.shadowMapResolution,V=H*this._cascades[0].boundingSphereRadius,X=H*this._cascades[this._cascades.length-1].boundingSphereRadius,Y=(p==="vector-tile"?1:3)*(function(W,re,K,ae,ue){const fe=n.aA((W-22)/-22,0,1);return .125*(1-fe)+4*fe})(x.zoom);I.u_shadow_normal_offset=[k,V*Y,X*Y],I.u_shadow_bias=[1e-4,.0012,.012]}else I.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(w,I)}setupShadowsFromMatrix(i,c,p=!1){if(!this.enabled)return;const x=this.painter.context,w=x.gl,A=this._uniformValues,I=new Float64Array(16);for(let O=0;O<Do.cascadeCount;O++)n.aB(I,this._cascades[O].matrix,i),A[O===0?"u_light_matrix_0":"u_light_matrix_1"]=Float32Array.from(I),x.activeTexture.set(w.TEXTURE0+kn.ShadowMap0+O),this._cascades[O].texture.bindExtraParam(w.LINEAR,w.LINEAR,w.CLAMP_TO_EDGE,w.CLAMP_TO_EDGE,w.GREATER);if(this.useNormalOffset=p,p){const O=Do.normalOffset;A.u_shadow_normal_offset=[1,O,O],A.u_shadow_bias=[6e-5,.0012,.012]}else A.u_shadow_bias=[36e-5,.0012,.012];c.setShadowUniformValues(x,A)}getShadowUniformValues(){return this._uniformValues}getCurrentCascadeFrustum(){return this._cascades[this.painter.currentShadowCascade].frustum}computeSimplifiedTileShadowVolume(i,c,p,x){if(x[2]>=0)return{};const w=(function(O,z,k){const H=k/(1<<O.canonical.z);return new n.d8([O.canonical.x*H+O.wrap*k,O.canonical.y*H+O.wrap*k,0],[(O.canonical.x+1)*H+O.wrap*k,(O.canonical.y+1)*H+O.wrap*k,z])})(i,c,p).getCorners(),A=c/-x[2];x[0]<0?(n.d7(w[0],w[0],[x[0]*A,0,0]),n.d7(w[3],w[3],[x[0]*A,0,0])):x[0]>0&&(n.d7(w[1],w[1],[x[0]*A,0,0]),n.d7(w[2],w[2],[x[0]*A,0,0])),x[1]<0?(n.d7(w[0],w[0],[0,x[1]*A,0]),n.d7(w[1],w[1],[0,x[1]*A,0])):x[1]>0&&(n.d7(w[2],w[2],[0,x[1]*A,0]),n.d7(w[3],w[3],[0,x[1]*A,0]));const I={};return I.vertices=w,I.planes=[Zf(w[1],w[0],w[4]),Zf(w[2],w[1],w[5]),Zf(w[3],w[2],w[6]),Zf(w[0],w[3],w[7])],I}addShadowReceiver(i,c,p){this._receivers.add(i,n.d8.fromTileIdAndHeight(i,c,p))}getMaxCascadeForTile(i){const c=this._receivers.get(i);return c&&c.lastCascade?c.lastCascade:0}}function Zf(g,i,c){const p=n.av([],c,i),x=n.av([],g,i),w=n.bI([],p,x),A=n.ag(w);return A===0?[0,0,1,0]:(n.c4(w,w,1/A),[w[0],w[1],w[2],-n.bJ(w,i)])}function Yu(g){const i=g.properties.get("direction"),c=n.d3(i.x,i.y,i.z);c[2]=n.aA(c[2],0,75);const p=n.d5([c[0],c[1],c[2]]);return n.d4(p.x,p.y,p.z)}function Ts(g,i,c){const p=i.properties.get("color-use-theme")==="none",x=i.properties.get("color"),w=i.properties.get("intensity"),A=i.properties.get("direction"),I=[A.x,A.y,A.z],O=c.properties.get("color-use-theme")==="none",z=c.properties.get("color"),k=c.properties.get("intensity"),H=Math.max(n.bJ([0,0,1],I),0),V=[0,0,0];n.c4(V,z.toPremultipliedRenderColor(O?null:g.getLut(i.scope)).toArray01Linear().slice(0,3),k);const X=[0,0,0];return n.c4(X,x.toPremultipliedRenderColor(p?null:g.getLut(c.scope)).toArray01Linear().slice(0,3),H*w),n.da([V[0]>0?V[0]/(V[0]+X[0]):0,V[1]>0?V[1]/(V[1]+X[1]):0,V[2]>0?V[2]/(V[2]+X[2]):0])}function xm(g,i,c,p,x,w){const A=g.zoom,I=g.scale,O=g.worldSize,z=1/O,k=g.aspect,H=Math.sqrt(1+k*k)*Math.tan(.5*g.fovX),V=H*H,X=p-c,Y=p+c;let W,re;V>X/Y?(W=p,re=p*H):(W=.5*Y*(1+V),re=.5*Math.sqrt(X*X+2*(p*p+c*c)*V+Y*Y*V*V));const K=g.projection.pixelsPerMeter(g.center.lat,O),ae=g._camera.getCameraToWorldMercator(),ue=[0,0,-W*z];n.af(ue,ue,ae);let fe=re*z;const xe=g._edgeInsets;if(!(xe.left===0&&xe.top===0&&xe.right===0&&xe.bottom===0||xe.left===xe.right&&xe.top===xe.bottom)){const at=g._camera.getWorldToCamera(g.worldSize,g.projection.zAxisUnit==="meters"?K:1),ht=g._camera.getCameraToClipPerspective(g._fov,g.width/g.height,c,p);ht[8]=2*-g.centerOffset.x/g.width,ht[9]=2*g.centerOffset.y/g.height;const wt=new Float64Array(16);n.cO(wt,ht,at);const ft=new Float64Array(16);n.bl(ft,wt);const pt=n.cA.fromInvProjectionMatrix(ft,O,A,!0);for(const rr of pt.points){const tr=((ge=rr)[0]/=I,ge[1]/=I,ge[2]=n.ce(ge[2],g._center.lat),ge);fe=Math.max(fe,n.c5(n.d9([],ue,tr)))}}var ge;fe*=x/(x-1);const Te=Math.acos(i[2]),ye=Math.atan2(-i[0],-i[1]),_e=new Xf;_e.position=ue,_e.setPitchBearing(Te,ye);const Se=_e.getWorldToCamera(O,K),He=fe*O,ze=Math.min(g._mercatorZfromZoom(17)*O*-2,-2*He),nt=_e.getCameraToClipOrthographic(-He,He,-He,He,ze,(He+w*K)/i[2]),Ge=new Float64Array(16);n.aB(Ge,nt,Se);const tt=n.d4(Math.floor(1e6*ue[0])/1e6*O,Math.floor(1e6*ue[1])/1e6*O,0),It=.5*x,qe=[0,0,0];n.af(qe,tt,Ge),n.c4(qe,qe,It);const Oe=[Math.floor(qe[0]),Math.floor(qe[1]),Math.floor(qe[2])],ot=[0,0,0];n.av(ot,qe,Oe),n.c4(ot,ot,-1/It);const je=new Float64Array(16);return n.bA(je),n.br(je,je,ot),n.aB(Ge,je,Ge),[Ge,He]}class Lh extends n.E{constructor(i){super(),this.requestManager=i,this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}loadModel(i,c){return n.aV(this.requestManager.transformRequest(c,n.R.Model).url).then((p=>{if(!p)return;const x=n.aW(p),w=new n.aX(i,void 0,void 0,x);return w.computeBoundsAndApplyParent(),w})).catch((p=>{if(p&&p.status===404)return null;this.fire(new n.y(new Error(`Could not load model ${i} from ${c}: ${p.message}`)))}))}load(i,c,p={forceReload:!1}){this.models[c]||(this.models[c]={});const x=Object.keys(i),w=[],A=[];for(const I of x){const O=i[I];this.hasURLBeenRequested(O)&&!p.forceReload||(this.modelByURL[O]={modelId:I,scope:c},w.push(this.loadModel(I,O)),A.push(I)),this.models[c][I]||(this.models[c][I]={model:null,numReferences:1})}this.numModelsLoading[c]=(this.numModelsLoading[c]||0)+A.length,Promise.allSettled(w).then((I=>{for(let O=0;O<I.length;O++){const{status:z}=I[O];if(z==="rejected")continue;const{value:k}=I[O];this.models[c][A[O]]||(this.models[c][A[O]]={model:null,numReferences:1}),this.models[c][A[O]].model=k}this.numModelsLoading[c]-=A.length,this.fire(new n.z("data",{dataType:"style"}))})).catch((I=>{this.fire(new n.y(new Error(`Could not load models: ${I.message}`)))}))}isLoaded(){for(const i in this.numModelsLoading)if(this.numModelsLoading[i]>0)return!1;return!0}hasModel(i,c,p={exactIdMatch:!1}){return!!(p.exactIdMatch?this.getModel(i,c):this.getModelByURL(this.modelUris[c][i]))}getModel(i,c){return this.models[c]||(this.models[c]={}),this.models[c][i]?this.models[c][i].model:void 0}getModelByURL(i){if(!i)return null;const c=this.modelByURL[i];return c?this.models[c.scope][c.modelId].model:null}hasModelBeenAdded(i,c){return this.models[c]&&this.models[c][i]!==void 0}getModelURIs(i){return this.modelUris[i]||{}}addModel(i,c,p){this.models[p]||(this.models[p]={}),this.modelUris[p]||(this.modelUris[p]={});const x=this.requestManager.normalizeModelURL(c);if((this.hasModel(i,p,{exactIdMatch:!0})||this.hasModelBeenAdded(i,p))&&this.modelUris[p][i]===x)this.models[p][i].numReferences++;else if(this.hasURLBeenRequested(x)){const{scope:w,modelId:A}=this.modelByURL[x];this.models[w][A].numReferences++}else this.modelUris[p][i]=x,this.load({[i]:this.modelUris[p][i]},p)}addModelURLs(i,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p=this.modelUris[c];for(const x in i)p[x]=this.requestManager.normalizeModelURL(i[x])}reloadModels(i){this.load(this.modelUris[i],i,{forceReload:!0})}addModelsFromBucket(i,c){this.models[c]||(this.models[c]={}),this.modelUris[c]||(this.modelUris[c]={});const p={};for(const x of i)this.hasModel(x,c,{exactIdMatch:!0})||this.hasURLBeenRequested(x)?this.models[c][x].numReferences++:this.modelUris[c][x]&&!this.hasURLBeenRequested(x)?p[x]=this.modelUris[c][x]:!this.hasURLBeenRequested(x)&&n.db(x,!1)&&(this.modelUris[c][x]=this.requestManager.normalizeModelURL(x),p[x]=this.modelUris[c][x]);this.load(p,c)}hasURLBeenRequested(i){return this.modelByURL[i]!==void 0}removeModel(i,c,p=!1,x=!1){if(this.models[c]&&this.models[c][i]&&(this.models[c][i].numReferences--,this.models[c][i].numReferences===0||x)){const w=this.modelUris[c][i];p||delete this.modelUris[c][i],delete this.modelByURL[w];const A=this.models[c][i].model;if(!A)return;delete this.models[c][i],A.destroy()}}destroy(){for(const i of Object.keys(this.models))for(const c of Object.keys(this.models[i])){const p=this.models[i][c].model;delete this.models[i][c],p&&p.destroy()}this.models={"":{}},this.modelUris={"":{}},this.modelByURL={},this.numModelsLoading={}}listModels(i){return this.models[i]||(this.models[i]={}),Object.keys(this.models[i])}upload(i,c){this.models[c]||(this.models[c]={});for(const p in this.models[c])this.models[c][p].model&&this.models[c][p].model.upload(i.context)}}const Qu=new n.a9({data:new n.aa(n.a6.colorTheme.data)});function Bh(g){if(!g.metadata||!g.metadata.content_area)return;const i=n.o.devicePixelRatio,{left:c,top:p,width:x,height:w}=g.metadata.content_area,A=c*i,I=p*i;return[A,I,A+x*i,I+w*i]}function Kc(g){if(g)return g.map((([i,c])=>[i*n.o.devicePixelRatio,c*n.o.devicePixelRatio]))}class vl{constructor(i,c,p){this.id=i,this.scope=c,this.sourceCache=p,this.pendingRequests=new Set,this.missingRequests=new Set}addPendingRequest(i){this.missingRequests.has(i.name)||this.pendingRequests.has(i.name)||this.pendingRequests.add(i.name)}hasPendingRequests(){return this.pendingRequests.size>0}resolvePendingRequests(){const i=new Map;if(!this.sourceCache.loaded())return i;const c=this.sourceCache.getVisibleCoordinates();if(c.length===0)return i;const p=this.sourceCache.getSource();if(!(p instanceof Vc))return i;const x=c.map((A=>this.sourceCache.getTile(A))),w=p.getImages(x,Array.from(this.pendingRequests));for(const[A,I]of w)i.set(n.I.from({name:A,iconsetId:this.id}),I),this.pendingRequests.delete(A);for(const A of this.pendingRequests)this.missingRequests.add(A);return this.pendingRequests.clear(),i}}const Jc=(g,i)=>Ie(g,i&&i.filter((c=>c.identifier!=="source.canvas"))),Ku=n.aH(ai,["addLayer","removeLayer","setLights","setPaintProperty","setLayoutProperty","setSlot","setFilter","addSource","removeSource","setLayerZoomRange","setLight","setTransition","setGeoJSONSourceData","setTerrain","setFog","setSnow","setRain","setProjection","setCamera","addImport","removeImport","updateImport","addIconset","removeIconset"]),zh=n.aH(ai,["setCenter","setZoom","setBearing","setPitch"]),Fh=new Set(["background","sky","slot","custom"]),bm={version:8,layers:[],sources:{}},xl={duration:300,delay:0};class ns extends n.E{constructor(i,c={}){super(),this.map=i,this.scope=c.scope||"",this.globalId=null,this.fragments=[],this.importDepth=c.importDepth||0,this.importsCache=c.importsCache||new Map,this.resolvedImports=c.resolvedImports||new Set,this.transition=Object.assign({},xl),this._buildingIndex=new Nf(this),this.crossTileSymbolIndex=new fo,this._mergedOrder=[],this._drapedFirstOrder=[],this._mergedLayers={},this._mergedSourceCaches={},this._mergedOtherSourceCaches={},this._mergedSymbolSourceCaches={},this._clipLayerPresent=!1,this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this._changes=c.styleChanges||new zu,this.dispatcher=c.dispatcher?c.dispatcher:new n.D(n.dd(),this),c.imageManager?this.imageManager=c.imageManager:(this.imageManager=new On(this.map._spriteFormat),this.imageManager.setEventedParent(this)),this.imageManager.addScope(this.scope),this.glyphManager=c.glyphManager?c.glyphManager:new n.de(i._requestManager,c.localFontFamily?n.df.all:c.localIdeographFontFamily?n.df.ideographs:n.df.none,c.localFontFamily||c.localIdeographFontFamily),c.modelManager?this.modelManager=c.modelManager:(this.modelManager=new Lh(i._requestManager),this.modelManager.setEventedParent(this)),this._layers={},this._sourceCaches={},this._otherSourceCaches={},this._symbolSourceCaches={},this._loaded=!1,this._precompileDone=!1,this._shouldPrecompile=!1,this._availableImages=[],this._availableModels={},this._order=[],this._markersNeedUpdate=!1,this.options=c.configOptions?c.configOptions:new Map,this._configDependentLayers=c.configDependentLayers?c.configDependentLayers:new Set,this._config=c.config,this._styleColorTheme={lut:null,lutLoading:!1,lutLoadingCorrelationID:0,colorTheme:null,colorThemeOverride:c.colorThemeOverride},this._styleColorThemeForScope={},this._initialConfig=c.initialConfig,this.dispatcher.broadcast("setReferrer",n.dg());const p=this;this._rtlTextPluginCallback=ns.registerForPluginStateChange((x=>{p.dispatcher.broadcast("syncRTLPluginState",{pluginStatus:x.pluginStatus,pluginURL:x.pluginURL},((w,A)=>{if(n.dh(w),A&&A.every((I=>I)))for(const I in p._sourceCaches){const O=p._sourceCaches[I],z=O.getSource().type;z!=="vector"&&z!=="geojson"||O.reload()}}))})),this.on("data",(x=>{if(x.dataType!=="source"||x.sourceDataType!=="metadata")return;const w=this.getOwnSource(x.sourceId);if(w&&w.vectorLayerIds)for(const A in this._layers){const I=this._layers[A];I.source===w.id&&this._validateLayer(I)}}))}load(i){return i?(typeof i=="string"?this.loadURL(i):this.loadJSON(i),this):this}_getGlobalId(i){if(!i)return null;if(typeof i=="string"){if(n.h(i))return i;const c=n.di(i);if(!c.startsWith("http"))try{return new URL(c,location.href).toString()}catch{return c}return c}return`json://${n.dj(JSON.stringify(i))}`}_diffStyle(i,c,p){this.globalId=this._getGlobalId(i);const x=(w,A)=>{try{A(null,this.setState(w,p))}catch(I){A(I,!1)}};if(typeof i=="string"){const w=this.map._requestManager.normalizeStyleURL(i),A=this.map._requestManager.transformRequest(w,n.R.Style);n.m(A,((I,O)=>{I?this.fire(new n.y(I)):O&&x(O,c)}))}else typeof i=="object"&&x(i,c)}loadURL(i,c={}){this.fire(new n.z("dataloading",{dataType:"style"}));const p=typeof c.validate=="boolean"?c.validate:!n.h(i);this.globalId=this._getGlobalId(i),i=this.map._requestManager.normalizeStyleURL(i,c.accessToken),this.resolvedImports.add(i);const x=this.importsCache.get(i);if(x)return this._load(x,p);const w=this.map._requestManager.transformRequest(i,n.R.Style);this._request=n.m(w,((A,I)=>{if(this._request=null,A)this.fire(new n.y(A));else if(I)return this.importsCache.set(i,I),this._load(I,p)}))}loadJSON(i,c={}){this.fire(new n.z("dataloading",{dataType:"style"})),this.globalId=this._getGlobalId(i),this._request=n.o.frame((()=>{this._request=null,this._load(i,c.validate!==!1)}))}loadEmpty(){this.fire(new n.z("dataloading",{dataType:"style"})),this._load(bm,!1)}_loadImports(i,c,p){if(this.importDepth>=4)return n.w("Style doesn't support nesting deeper than 5"),Promise.resolve();const x=[];for(const w of i){const A=this._createFragmentStyle(w),I=new Promise((k=>{A.once("style.import.load",k),A.once("error",k)})).then((()=>this.mergeAll()));if(x.push(I),this.resolvedImports.has(w.url)){A.loadEmpty();continue}const O=w.data||this.importsCache.get(w.url);O?(A.loadJSON(O,{validate:c}),this._isInternalStyle(O)&&(A.globalId=null)):w.url?A.loadURL(w.url,{validate:c}):A.loadEmpty();const z={style:A,id:w.id,config:w.config};if(p){const k=this.fragments.findIndex((({id:H})=>H===p));this.fragments=this.fragments.slice(0,k).concat(z).concat(this.fragments.slice(k))}else this.fragments.push(z)}return Promise.allSettled(x)}getImportGlobalIds(i=this,c=new Set){for(const p of i.fragments)p.style.globalId&&c.add(p.style.globalId),this.getImportGlobalIds(p.style,c);return[...c.values()]}_createFragmentStyle(i){const c=this.scope?n.B(i.id,this.scope):i.id;let p;const x=this._initialConfig&&this._initialConfig[c];(i.config||x)&&(p=Object.assign({},i.config,x));const w=new ns(this.map,{scope:c,styleChanges:this._changes,importDepth:this.importDepth+1,importsCache:this.importsCache,resolvedImports:new Set(this.resolvedImports),dispatcher:this.dispatcher,imageManager:this.imageManager,glyphManager:this.glyphManager,modelManager:this.modelManager,config:p,configOptions:this.options,colorThemeOverride:i["color-theme"],configDependentLayers:this._configDependentLayers});return w.setEventedParent(this.map,{style:w}),w}_reloadImports(){this.mergeAll(),this._updateMapProjection(),this.updateConfigDependencies(),this.map._triggerCameraUpdate(this.camera),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),this._shouldPrecompile=this.map._precompilePrograms&&this.isRootStyle()}_isInternalStyle(i){return this.isRootStyle()&&(i.fragment||!!i.schema&&i.fragment!==!1)}_load(i,c){if(this._isInternalStyle(i)){const w=Object.assign({},bm,{imports:[{id:"basemap",data:i,url:""}]});return void this._load(w,c)}if(this.updateConfig(this._config,i.schema),c&&Jc(this,ya(i)))return;this._loaded=!0,this.stylesheet=n.dk(i);const p=()=>{for(const O in i.sources)this.addSource(O,i.sources[O],{validate:!1,isInitialLoad:!0});if(i.iconsets)for(const O in i.iconsets)this.addIconset(O,i.iconsets[O]);i.sprite?this._loadIconset(i.sprite):(this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0})),!this.glyphManager.url&&i.glyphs&&this.glyphManager.setURL(i.glyphs);const w=bs(this.stylesheet.layers);if(this._order=w.map((O=>O.id)),this.stylesheet.light&&n.w("The `light` root property is deprecated, prefer using `lights` with `flat` light type instead."),this.stylesheet.lights)if(this.stylesheet.lights.length===1&&this.stylesheet.lights[0].type==="flat"){const O=this.stylesheet.lights[0];this.light=new Be(O.properties,O.id)}else this.setLights(this.stylesheet.lights);this.light||(this.light=new Be(this.stylesheet.light)),this._layers={};for(const O of w){const z=n.dq(O,this.scope,this._styleColorTheme.lut,this.options);z.configDependencies.size!==0&&this._configDependentLayers.add(z.fqid),z.setEventedParent(this,{layer:{id:z.id}}),this._layers[z.id]=z;const k=this.getOwnLayerSourceCache(z),H=!!this.directionalLight&&this.directionalLight.shadowsEnabled();k&&z.canCastShadows()&&H&&(k.castsShadows=!0)}this.stylesheet.featuresets&&this.setFeaturesetSelectors(this.stylesheet.featuresets),this.stylesheet.models&&this.addModelURLs(this.stylesheet.models);const A=this.stylesheet.terrain;A&&(this.checkCanvasFingerprintNoise(),this.disableElevatedTerrain||this.terrainSetForDrapingOnly()||this._createTerrain(A,1)),this.stylesheet.fog&&this._createFog(this.stylesheet.fog),this.stylesheet.snow&&this._createSnow(this.stylesheet.snow),this.stylesheet.rain&&this._createRain(this.stylesheet.rain),this.stylesheet.transition&&this.setTransition(this.stylesheet.transition),this.fire(new n.z("data",{dataType:"style"}));const I=this.isRootStyle();i.imports?this._loadImports(i.imports,c).then((()=>{this._reloadImports(),this.fire(new n.z(I?"style.load":"style.import.load"))})).catch((O=>{this.fire(new n.y(new Error("Failed to load imports",O))),this.fire(new n.z(I?"style.load":"style.import.load"))})):(this._reloadImports(),this.fire(new n.z(I?"style.load":"style.import.load")))};this._styleColorTheme.colorTheme=this.stylesheet["color-theme"];const x=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(x){const w=this._evaluateColorThemeData(x);this._loadColorTheme(w).then((()=>{p()})).catch((A=>{n.w(`Couldn't load color theme from the stylesheet: ${A}`),p()}))}else this._styleColorTheme.lut=null,p()}isRootStyle(){return this.importDepth===0}mergeAll(){let i,c,p,x,w,A,I,O,z,k;const H={};this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((V=>{if(V.stylesheet){if(V.light!=null&&(i=V.light),V.stylesheet.lights)for(const X of V.stylesheet.lights)X.type==="ambient"&&V.ambientLight!=null&&(c=V.ambientLight),X.type==="directional"&&V.directionalLight!=null&&(p=V.directionalLight);x=this._prioritizeTerrain(x,V.terrain,V.stylesheet.terrain),V.stylesheet.fog&&V.fog!=null&&(w=V.fog),V.stylesheet.snow&&V.snow!=null&&(A=V.snow),V.stylesheet.rain&&V.rain!=null&&(I=V.rain),V.stylesheet.camera!=null&&(k=V.stylesheet.camera),V.stylesheet.projection!=null&&(O=V.stylesheet.projection),V.stylesheet.transition!=null&&(z=V.stylesheet.transition),H[V.scope]=V._styleColorTheme}})),this.light=i,this.ambientLight=c,this.directionalLight=p,this.fog=w,this.snow=A,this.rain=I,this._styleColorThemeForScope=H,x===null?delete this.terrain:this.terrain=x,this.camera=k||{"camera-projection":"perspective"},this.projection=O||{name:"mercator"},this.transition=Object.assign({},xl,z),this.mergeSources(),this.mergeLayers()}forEachFragmentStyle(i){const c=p=>{for(const x of p.fragments)c(x.style);i(p)};c(this)}_prioritizeTerrain(i,c,p){const x=i&&i.drapeRenderMode===0;return p===null?c&&c.drapeRenderMode===0?c:x?i:null:c!=null&&(!i||x||c&&c.drapeRenderMode===1)?c:i}mergeTerrain(){let i;this.terrain&&this.terrain.scope!==this.scope&&delete this.terrain,this.forEachFragmentStyle((c=>{i=this._prioritizeTerrain(i,c.terrain,c.stylesheet.terrain)})),i===null?delete this.terrain:this.terrain=i}mergeProjection(){let i;this.forEachFragmentStyle((c=>{c.stylesheet.projection!=null&&(i=c.stylesheet.projection)})),this.projection=i||{name:"mercator"}}mergeSources(){const i={},c={},p={};this.forEachFragmentStyle((x=>{for(const w in x._sourceCaches){const A=n.B(w,x.scope);i[A]=x._sourceCaches[w]}for(const w in x._otherSourceCaches){const A=n.B(w,x.scope);c[A]=x._otherSourceCaches[w]}for(const w in x._symbolSourceCaches){const A=n.B(w,x.scope);p[A]=x._symbolSourceCaches[w]}})),this._mergedSourceCaches=i,this._mergedOtherSourceCaches=c,this._mergedSymbolSourceCaches=p}mergeLayers(){const i={},c=[],p={};this._mergedSlots=[],this._has3DLayers=!1,this._hasCircleLayers=!1,this._hasSymbolLayers=!1,this.forEachFragmentStyle((A=>{for(const I of A._order){const O=A._layers[I];if(O.type==="slot"){const z=n.dl(I);if(i[z])continue;i[z]=[]}O.slot&&i[O.slot]?i[O.slot].push(O):c.push(O)}})),this._mergedOrder=[];let x=-1;const w=(A=[])=>{for(const I of A)if(I.type==="slot"){const O=n.dl(I.id);i[O]&&w(i[O]),this._mergedSlots.push(O)}else{const O=n.B(I.id,I.scope);this._mergedOrder.push(O),p[O]=I,I.is3D(!!this.terrain)&&(this._has3DLayers=!0,x=this._mergedOrder.length-1),I.type==="circle"&&(this._hasCircleLayers=!0),I.type==="symbol"&&(this._hasSymbolLayers=!0),I.type==="clip"&&(this._clipLayerPresent=!0)}};if(w(c),this._has3DLayers){const A={};for(let I=0;I<this._mergedOrder.length;++I){const O=this._mergedOrder[I];A[O]=I===x?1:I<x?p[O].hasOcclusionOpacityProperties?2:0:4}this._mergedOrder.sort(((I,O)=>A[I]-A[O]))}this._mergedLayers=p,this.updateDrapeFirstLayers(),this._buildingIndex.processLayersChanged()}terrainSetForDrapingOnly(){return!!this.terrain&&this.terrain.drapeRenderMode===0}getCamera(){return this.stylesheet.camera}setCamera(i){return this.stylesheet.camera=Object.assign({},this.stylesheet.camera,i),this.camera=this.stylesheet.camera,this}_evaluateColorThemeData(i){return i.data?(function(c,p,x,w){const A=Object.assign({},p);for(const O of Object.keys(n.a6.colorTheme))A[O]===void 0&&(A[O]=n.a6.colorTheme[O].default);const I=new n.a8(Qu,c,new Map(x));return I.setTransitionOrValue(A,x),I.untransitioned().possiblyEvaluate(new n.ac(0,{worldview:void 0}))})(this.scope,i,this.options).get("data"):null}_loadColorTheme(i){this._styleColorTheme.lutLoading=!0,this._styleColorTheme.lutLoadingCorrelationID+=1;const c=this._styleColorTheme.lutLoadingCorrelationID;return new Promise(((p,x)=>{const w="data:image/png;base64,";if(!i||i.length===0)return this._styleColorTheme.lut=null,this._styleColorTheme.lutLoading=!1,void p();let A=i;A.startsWith(w)||(A=w+A);const I=n.I.from("mapbox-reserved-lut"),O=new Image;O.src=A,O.onerror=()=>{this._styleColorTheme.lutLoading=!1,x(new Error("Failed to load image data"))},O.onload=()=>{if(this._styleColorTheme.lutLoadingCorrelationID!==c)return void p();this._styleColorTheme.lutLoading=!1;const{width:z,height:k,data:H}=n.o.getImageData(O);if(k>32)return void x(new Error("The height of the image must be less than or equal to 32 pixels."));if(z!==k*k)return void x(new Error("The width of the image must be equal to the height squared."));this.getImage(I)&&this.removeImage(I),this.addImage(I,{data:new n.q({width:z,height:k},H),pixelRatio:1,sdf:!1,usvg:!1,version:0});const V=this.imageManager.getImage(I,this.scope);V?(this._styleColorTheme.lut={image:V.data,data:i},p()):x(new Error("Missing LUT image."))}}))}getLut(i){const c=this._styleColorThemeForScope[i];return c?c.lut:null}setProjection(i){i?this.stylesheet.projection=i:delete this.stylesheet.projection,this.mergeProjection(),this._updateMapProjection()}applyProjectionUpdate(){this._loaded&&(this.dispatcher.broadcast("setProjection",this.map.transform.projectionOptions),this.map.transform.projection.requiresDraping?(this.getTerrain()||this.stylesheet.terrain)&&!this.disableElevatedTerrain||this.setTerrainForDraping():this.terrainSetForDrapingOnly()&&this.setTerrain(null,0))}_updateMapProjection(){this.isRootStyle()&&(this.map._useExplicitProjection?this.applyProjectionUpdate():this.map._prioritizeAndUpdateProjection(null,this.projection))}_loadSprite(i){this._spriteRequest=(function(c,p,x){let w,A,I;const O=n.o.devicePixelRatio>1?"@2x":"";let z=n.m(p.transformRequest(p.normalizeSpriteURL(c,O,".json"),n.R.SpriteJSON),((V,X)=>{z=null,I||(I=V,w=X,H())})),k=n.n(p.transformRequest(p.normalizeSpriteURL(c,O,".png"),n.R.SpriteImage),((V,X)=>{k=null,I||(I=V,A=X,H())}));function H(){if(I)x(I);else if(w&&A){const V=n.o.getImageData(A),X={};for(const Y in w){const{width:W,height:re,x:K,y:ae,sdf:ue,pixelRatio:fe,stretchX:xe,stretchY:ge,content:Te}=w[Y],ye=new n.q({width:W,height:re});n.q.copy(V,ye,{x:K,y:ae},{x:0,y:0},{width:W,height:re},null),X[Y]={data:ye,pixelRatio:fe!==void 0?fe:1,sdf:ue!==void 0&&ue,stretchX:xe,stretchY:ge,content:Te,usvg:!1,version:0}}x(null,X)}}return{cancel(){z&&(z.cancel(),z=null),k&&(k.cancel(),k=null)}}})(i,this.map._requestManager,((c,p)=>{if(this._spriteRequest=null,c)this.fire(new n.y(c));else if(p){const x=new Map;for(const w in p)x.set(n.I.from(w),p[w]);this.addImages(x)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))}))}addIconset(i,c){if(c.type==="sprite")return void this._loadSprite(c.url);const p=this.getOwnSourceCache(c.source);if(!p)return void this.fire(new n.y(new Error(`Source "${c.source}" as specified by iconset "${i}" does not exist and cannot be used as an iconset source`)));const x=p.getSource();if(x.type!=="raster-array")return void this.fire(new n.y(new Error(`Source "${c.source}" as specified by iconset "${i}" is not a "raster-array" source and cannot be used as an iconset source`)));x.partial=!1;const w=new vl(i,this.scope,p);this.imageManager.addImageProvider(w,this.scope)}removeIconset(i){this.imageManager.removeImageProvider(i,this.scope)}_loadIconset(i){if(!n.h(i)&&this.map._spriteFormat!=="icon_set"||this.map._spriteFormat==="raster")return void this._loadSprite(i);const c=this.map._spriteFormat==="auto";var p,x;this._spriteRequest=(x=(w,A)=>{if(this._spriteRequest=null,w)c?this._loadSprite(i):this.fire(new n.y(w));else if(A){const I=new Map;for(const O in A)I.set(n.I.from(O),A[O]);this.addImages(I)}this.imageManager.setLoaded(!0,this.scope),this.dispatcher.broadcast("spriteLoaded",{scope:this.scope,isLoaded:!0}),this.fire(new n.z("data",{dataType:"style"}))},n.bu((p=this.map._requestManager).transformRequest(p.normalizeIconsetURL(i),n.R.Iconset),((w,A)=>{if(w)return void x(w);const I={},O=n.dc(new n.bt(A));for(const z of O.icons){const k={version:1,pixelRatio:n.o.devicePixelRatio,content:Bh(z),stretchX:z.metadata?Kc(z.metadata.stretch_x_areas):void 0,stretchY:z.metadata?Kc(z.metadata.stretch_y_areas):void 0,sdf:!1,usvg:!0,icon:z};I[z.name]=k}x(null,I)})))}_validateLayer(i){const c=this.getOwnSource(i.source);if(!c)return;const p=i.sourceLayer;p&&(c.type==="geojson"||c.vectorLayerIds&&c.vectorLayerIds.indexOf(p)===-1)&&this.fire(new n.y(new Error(`Source layer "${p}" does not exist on source "${c.id}" as specified by style layer "${i.id}"`)))}loaded(){if(!this._loaded||Object.keys(this._changes.getUpdatedSourceCaches()).length)return!1;for(const i in this._sourceCaches)if(!this._sourceCaches[i].loaded())return!1;if(!this.imageManager.isLoaded()||this.imageManager.hasPatternsInFlight()||!this.modelManager.isLoaded()||this._styleColorTheme.lutLoading)return!1;for(const{style:i}of this.fragments)if(!i.loaded())return!1;return!0}_serializeImports(){if(this.stylesheet.imports)return this.stylesheet.imports.map(((i,c)=>{const p=this.fragments[c];return p&&p.style&&(i.data=p.style.serialize()),i}))}_serializeSources(){const i={};for(const c in this._sourceCaches){const p=this._sourceCaches[c].getSource();i[p.id]||(i[p.id]=p.serialize())}return i}_serializeLayers(i){const c=[];for(const p of i){const x=this._layers[p];x&&x.type!=="custom"&&c.push(x.serialize())}return c}hasLightTransitions(){return!(!this.light||!this.light.hasTransition())||!(!this.ambientLight||!this.ambientLight.hasTransition())||!(!this.directionalLight||!this.directionalLight.hasTransition())}hasFogTransition(){return!!this.fog&&this.fog.hasTransition()}hasSnowTransition(){return!!this.snow&&this.snow.hasTransition()}hasRainTransition(){return!!this.rain&&this.rain.hasTransition()}hasTransitions(){if(this.hasLightTransitions()||this.hasFogTransition()||this.hasSnowTransition()||this.hasRainTransition())return!0;for(const i in this._sourceCaches)if(this._sourceCaches[i].hasTransition())return!0;for(const i in this._layers)if(this._layers[i].hasTransition())return!0;return!1}get order(){return this.terrain?this._drapedFirstOrder:this._mergedOrder}_getOrder(i){return i?this.order:this._mergedOrder}isLayerDraped(i){return!!this.terrain&&i.isDraped(this.getLayerSourceCache(i))}_checkLoaded(){if(!this._loaded)throw new Error("Style is not done loading")}_checkLayer(i){const c=this.getOwnLayer(i);if(c)return c;this.fire(new n.y(new Error(`The layer '${i}' does not exist in the map's style.`)))}_checkSource(i){const c=this.getOwnSource(i);if(c)return c;this.fire(new n.y(new Error(`The source '${i}' does not exist in the map's style.`)))}precompilePrograms(i,c){const p=this.map.painter;if(p)for(let x=i.minzoom||0;x<(i.maxzoom||25.5);x++){const w=i.getProgramIds();if(w)for(const A of w){const I=i.getDefaultProgramParams(A,c.zoom,this._styleColorTheme.lut);I&&(p.style=this,this.fog&&(p._fogVisible=!0,I.overrideFog=!0,p.getOrCreateProgram(A,I)),p._fogVisible=!1,I.overrideFog=!1,p.getOrCreateProgram(A,I),(this.stylesheet.terrain||this.stylesheet.projection&&this.stylesheet.projection.name==="globe")&&(I.overrideRtt=!0,p.getOrCreateProgram(A,I)))}}}update(i){if(!this._loaded)return;this.ambientLight&&this.ambientLight.recalculate(i),this.directionalLight&&this.directionalLight.recalculate(i);const c=this.calculateLightsBrightness();i.brightness=c||0,c!==this._brightness&&(this._brightness=c,this.dispatcher.broadcast("setBrightness",c)),i.worldview!==this._worldview&&(this._worldview=i.worldview,this.dispatcher.broadcast("setWorldview",this._worldview));const p=this._changes.isDirty();let x=!1;if(this._changes.isDirty()){const I=this._changes.getLayerUpdatesByScope();for(const O in I){const{updatedIds:z,removedIds:k}=I[O];(z||k)&&(this._updateWorkerLayers(O,z,k),x=!0)}this.updateSourceCaches(),this._updateTilesForChangedImages(),this.updateLayers(i),this.light&&this.light.updateTransitions(i),this.ambientLight&&this.ambientLight.updateTransitions(i),this.directionalLight&&this.directionalLight.updateTransitions(i),this.fog&&this.fog.updateTransitions(i),this.snow&&this.snow.updateTransitions(i),this.rain&&this.rain.updateTransitions(i),this._changes.reset()}const w={};for(const I in this._mergedSourceCaches){const O=this._mergedSourceCaches[I];w[I]=O.used,O.used=!1,O.tileCoverLift=0}for(const I of this._mergedOrder){const O=this._mergedLayers[I];if(O.recalculate(i,this._availableImages),!O.isHidden(i.zoom)){const z=this.getLayerSourceCache(O);z&&(z.used=!0,z.tileCoverLift=Math.max(z.tileCoverLift,O.tileCoverLift()))}!this._precompileDone&&this._shouldPrecompile&&("requestIdleCallback"in window?requestIdleCallback((()=>{this.precompilePrograms(O,i)})):this.precompilePrograms(O,i))}this._shouldPrecompile&&(this._precompileDone=!0),this.terrain&&x&&this.mergeLayers();const A=this.imageManager.getPendingImageProviders();for(const I of A)I.sourceCache.used=!0;for(const I in w){const O=this._mergedSourceCaches[I];w[I]!==O.used&&O.getSource().fire(new n.z("data",{sourceDataType:"visibility",dataType:"source",sourceId:O.getSource().id}))}this.light&&this.light.recalculate(i),this.terrain&&this.terrain.recalculate(i),this.fog&&this.fog.recalculate(i),this.snow&&this.snow.recalculate(i),this.rain&&this.rain.recalculate(i),this.z=i.zoom,this._markersNeedUpdate&&(this._updateMarkersOpacity(),this._markersNeedUpdate=!1),this.imageManager.clearUpdatedImages(this.scope),p&&this.fire(new n.z("data",{dataType:"style"}))}updateImageProviders(){const i=this.imageManager.getPendingImageProviders();for(const c of i){const p=c.resolvePendingRequests(),x=this.getFragmentStyle(c.scope);x&&x.addImages(p)}}_updateTilesForChangedImages(){const i={};for(const c in this._mergedSourceCaches){const p=this._mergedSourceCaches[c].getSource().scope;i[p]=i[p]||this._changes.getUpdatedImages(p),i[p].length!==0&&this._mergedSourceCaches[c].reloadTilesForDependencies(["icons","patterns"],i[p])}for(const c in i)this._changes.resetUpdatedImages(c)}_updateWorkerLayers(i,c,p){const x=this.getFragmentStyle(i);x&&this.dispatcher.broadcast("updateLayers",{layers:c?x._serializeLayers(c):[],scope:i,removedIds:p||[],options:x.options})}setState(i,c){if(this._checkLoaded(),Jc(this,ya(i)))return!1;(i=n.dk(i)).layers=bs(i.layers);const p=(function(A,I){if(!A)return[{command:ai.setStyle,args:[I]}];let O=[];try{if(!n.by(A.version,I.version))return[{command:ai.setStyle,args:[I]}];if(n.by(A.center,I.center)||O.push({command:ai.setCenter,args:[I.center]}),n.by(A.zoom,I.zoom)||O.push({command:ai.setZoom,args:[I.zoom]}),n.by(A.bearing,I.bearing)||O.push({command:ai.setBearing,args:[I.bearing]}),n.by(A.pitch,I.pitch)||O.push({command:ai.setPitch,args:[I.pitch]}),n.by(A.sprite,I.sprite)||O.push({command:ai.setSprite,args:[I.sprite]}),n.by(A.glyphs,I.glyphs)||O.push({command:ai.setGlyphs,args:[I.glyphs]}),n.by(A.imports,I.imports)||(function(X=[],Y=[],W){Y=Y||[];const re=(X=X||[]).map(rc),K=Y.map(rc),ae=X.reduce(Wc,{}),ue=Y.reduce(Wc,{}),fe=re.slice();let xe,ge,Te,ye;for(xe=0,ge=0;xe<re.length;xe++)Te=re[xe],ue.hasOwnProperty(Te)?ge++:(W.push({command:ai.removeImport,args:[Te]}),fe.splice(fe.indexOf(Te,ge),1));for(xe=0,ge=0;xe<K.length;xe++)Te=K[K.length-1-xe],fe[fe.length-1-xe]!==Te&&(ae.hasOwnProperty(Te)?(W.push({command:ai.removeImport,args:[Te]}),fe.splice(fe.lastIndexOf(Te,fe.length-ge),1)):ge++,ye=fe[fe.length-xe],W.push({command:ai.addImport,args:[ue[Te],ye]}),fe.splice(fe.length-xe,0,Te));for(const _e of Y){const Se=ae[_e.id];Se&&(delete Se.data,n.by(Se,_e)||W.push({command:ai.updateImport,args:[_e.id,_e]}))}})(A.imports,I.imports,O),n.by(A.transition,I.transition)||O.push({command:ai.setTransition,args:[I.transition]}),n.by(A.light,I.light)||O.push({command:ai.setLight,args:[I.light]}),n.by(A.fog,I.fog)||O.push({command:ai.setFog,args:[I.fog]}),n.by(A.snow,I.snow)||O.push({command:ai.setSnow,args:[I.snow]}),n.by(A.rain,I.rain)||O.push({command:ai.setRain,args:[I.rain]}),n.by(A.projection,I.projection)||O.push({command:ai.setProjection,args:[I.projection]}),n.by(A.lights,I.lights)||O.push({command:ai.setLights,args:[I.lights]}),n.by(A.camera,I.camera)||O.push({command:ai.setCamera,args:[I.camera]}),n.by(A.iconsets,I.iconsets)||(function(X,Y,W){let re;for(re in Y=Y||{},X=X||{})X.hasOwnProperty(re)&&(Y.hasOwnProperty(re)||W.push({command:ai.removeIconset,args:[re]}));for(re in Y){if(!Y.hasOwnProperty(re))continue;const K=Y[re];X.hasOwnProperty(re)?n.by(X[re],K)||(W.push({command:ai.removeIconset,args:[re]}),W.push({command:ai.addIconset,args:[re,K]})):W.push({command:ai.addIconset,args:[re,K]})}})(A.iconsets,I.iconsets,O),!n.by(A["color-theme"],I["color-theme"]))return[{command:ai.setStyle,args:[I]}];const z={},k=[];(function(X,Y,W,re){let K;for(K in Y=Y||{},X=X||{})X.hasOwnProperty(K)&&(Y.hasOwnProperty(K)||ec(K,W,re));for(K in Y){if(!Y.hasOwnProperty(K))continue;const ae=Y[K];X.hasOwnProperty(K)?n.by(X[K],ae)||(X[K].type==="geojson"&&ae.type==="geojson"&&Uu(X,Y,K)?W.push({command:ai.setGeoJSONSourceData,args:[K,ae.data]}):jd(K,Y,W,re)):yl(K,Y,W)}})(A.sources,I.sources,k,z);const H=[];A.layers&&A.layers.forEach((X=>{X.source&&z[X.source]?O.push({command:ai.removeLayer,args:[X.id]}):H.push(X)}));let V=A.terrain;V&&z[V.source]&&(O.push({command:ai.setTerrain,args:[void 0]}),V=void 0),O=O.concat(k),n.by(V,I.terrain)||O.push({command:ai.setTerrain,args:[I.terrain]}),(function(X,Y,W){Y=Y||[];const re=(X=X||[]).map(rc),K=Y.map(rc),ae=X.reduce(Wc,{}),ue=Y.reduce(Wc,{}),fe=re.slice(),xe=Object.create(null);let ge,Te,ye,_e,Se,He,ze;for(ge=0,Te=0;ge<re.length;ge++)ye=re[ge],ue.hasOwnProperty(ye)?Te++:(W.push({command:ai.removeLayer,args:[ye]}),fe.splice(fe.indexOf(ye,Te),1));for(ge=0,Te=0;ge<K.length;ge++)ye=K[K.length-1-ge],fe[fe.length-1-ge]!==ye&&(ae.hasOwnProperty(ye)?(W.push({command:ai.removeLayer,args:[ye]}),fe.splice(fe.lastIndexOf(ye,fe.length-Te),1)):Te++,He=fe[fe.length-ge],W.push({command:ai.addLayer,args:[ue[ye],He]}),fe.splice(fe.length-ge,0,ye),xe[ye]=!0);for(ge=0;ge<K.length;ge++)if(ye=K[ge],_e=ae[ye],Se=ue[ye],!xe[ye]&&!n.by(_e,Se))if(n.by(_e.source,Se.source)&&n.by(_e["source-layer"],Se["source-layer"])&&n.by(_e.type,Se.type)){for(ze in tc(_e.layout,Se.layout,W,ye,null,ai.setLayoutProperty),tc(_e.paint,Se.paint,W,ye,null,ai.setPaintProperty),n.by(_e.slot,Se.slot)||W.push({command:ai.setSlot,args:[ye,Se.slot]}),n.by(_e.filter,Se.filter)||W.push({command:ai.setFilter,args:[ye,Se.filter]}),n.by(_e.minzoom,Se.minzoom)&&n.by(_e.maxzoom,Se.maxzoom)||W.push({command:ai.setLayerZoomRange,args:[ye,Se.minzoom,Se.maxzoom]}),_e)_e.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?tc(_e[ze],Se[ze],W,ye,ze.slice(6),ai.setPaintProperty):n.by(_e[ze],Se[ze])||W.push({command:ai.setLayerProperty,args:[ye,ze,Se[ze]]}));for(ze in Se)Se.hasOwnProperty(ze)&&!_e.hasOwnProperty(ze)&&ze!=="layout"&&ze!=="paint"&&ze!=="filter"&&ze!=="metadata"&&ze!=="minzoom"&&ze!=="maxzoom"&&ze!=="slot"&&(ze.indexOf("paint.")===0?tc(_e[ze],Se[ze],W,ye,ze.slice(6),ai.setPaintProperty):n.by(_e[ze],Se[ze])||W.push({command:ai.setLayerProperty,args:[ye,ze,Se[ze]]}))}else W.push({command:ai.removeLayer,args:[ye]}),He=fe[fe.lastIndexOf(ye)+1],W.push({command:ai.addLayer,args:[Se,He]})})(H,I.layers,O)}catch(z){console.warn("Unable to compute style diff:",z),O=[{command:ai.setStyle,args:[I]}]}return O})(this.serialize(),i).filter((A=>!(A.command in zh)));if(p.length===0)return!1;const x=p.filter((A=>!(A.command in Ku)));if(x.length>0)throw new Error(`Unimplemented: ${x.map((A=>A.command)).join(", ")}.`);const w=[];return p.forEach((A=>{w.push(this[A.command](...A.args))})),c&&Promise.all(w).then(c).catch(c),this.stylesheet=i,this.mergeAll(),this.dispatcher.broadcast("setLayers",{layers:this._serializeLayers(this._order),scope:this.scope,options:this.options}),!0}_updateWorkerImages(){this._availableImages=this.imageManager.listImages(this.scope),this.dispatcher.broadcast("setImages",{scope:this.scope,images:this._availableImages})}_updateWorkerModels(){this._availableModels=this.modelManager.getModelURIs(this.scope),this.dispatcher.broadcast("setModels",{scope:this.scope,models:this._availableModels})}addImages(i){if(i.size===0)return this;for(const[c,p]of i.entries()){if(this.getImage(c))return this.fire(new n.y(new Error(`An image with the name "${c.name}" already exists.`)));this.imageManager.addImage(c,this.scope,p),this._changes.updateImage(c,this.scope)}return this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this}addImage(i,c){return this.getImage(i)?this.fire(new n.y(new Error(`An image with the name "${i.name}" already exists.`))):(this.imageManager.addImage(i,this.scope,c),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this)}updateImage(i,c,p=!1){this.imageManager.updateImage(i,this.scope,c),p&&(this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})))}getImage(i){return this.imageManager.getImage(i,this.scope)}removeImage(i){return this.getImage(i)?(this.imageManager.removeImage(i,this.scope),this._changes.updateImage(i,this.scope),this._updateWorkerImages(),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No image with this name exists.")))}listImages(){return this._checkLoaded(),this._availableImages.slice()}addModelURLs(i){return this.modelManager.addModelURLs(i,this.scope),this._updateWorkerModels(),this.fire(new n.z("data",{dataType:"style"})),this}addModel(i,c,p={}){return this._checkLoaded(),this._validate(Me,`models.${i}`,c,null,p)||(this.modelManager.addModel(i,c,this.scope),this.fire(new n.z("data",{dataType:"style"}))),this}hasModel(i){return this.modelManager.hasModel(i,this.scope)}removeModel(i){return this.hasModel(i)?(this.modelManager.removeModel(i,this.scope,!1,!0),this.fire(new n.z("data",{dataType:"style"})),this):this.fire(new n.y(new Error("No model with this ID exists.")))}listModels(){return this._checkLoaded(),this.modelManager.listModels(this.scope)}addSource(i,c,p={}){if(this._checkLoaded(),this.getOwnSource(i)!==void 0)throw new Error(`There is already a source with ID "${i}".`);if(!c.type)throw new Error(`The type property must be defined, but only the following properties were given: ${Object.keys(c).join(", ")}.`);if(["vector","raster","geojson","video","image"].indexOf(c.type)>=0&&this._validate(Of,`sources.${i}`,c,null,p))return;this.map&&this.map._collectResourceTiming&&(c.collectResourceTiming=!0);const x=Rh(i,c,this.dispatcher,this);x.scope=this.scope,x.setEventedParent(this,(()=>({isSourceLoaded:this._isSourceCacheLoaded(x.id),source:x.serialize(),sourceId:x.id})));const w=A=>{const I=(A?"symbol:":"other:")+x.id,O=n.B(I,this.scope),z=this._sourceCaches[I]=new Uo(O,x,A);(A?this._symbolSourceCaches:this._otherSourceCaches)[x.id]=z,z.onAdd(this.map)};w(!1),c.type!=="vector"&&c.type!=="geojson"||w(!0),x.onAdd&&x.onAdd(this.map),p.isInitialLoad||(this.mergeSources(),this._changes.setDirty())}removeSource(i){this._checkLoaded();const c=this.getOwnSource(i);if(!c)throw new Error("There is no source with this ID");for(const x in this._layers)if(this._layers[x].source===i)return this.fire(new n.y(new Error(`Source "${i}" cannot be removed while layer "${x}" is using it.`)));if(this.terrain&&this.terrain.scope===this.scope&&this.terrain.get().source===i)return this.fire(new n.y(new Error(`Source "${i}" cannot be removed while terrain is using it.`)));if(this.stylesheet.iconsets){const x=Object.entries(this.stylesheet.iconsets).find((([w,A])=>A.type==="source"&&A.source===i));if(x)return this.fire(new n.y(new Error(`Source "${i}" cannot be removed while iconset "${x[0]}" is using it.`)))}const p=this.getOwnSourceCaches(i);for(const x of p){const w=n.dl(x.id);delete this._sourceCaches[w],this._changes.discardSourceCacheUpdate(x.id),x.fire(new n.z("data",{sourceDataType:"metadata",dataType:"source",sourceId:x.getSource().id})),x.setEventedParent(null),x.clearTiles()}return delete this._otherSourceCaches[i],delete this._symbolSourceCaches[i],this.mergeSources(),c.setEventedParent(null),c.onRemove&&c.onRemove(this.map),this._changes.setDirty(),this}setGeoJSONSourceData(i,c){this._checkLoaded(),this.getOwnSource(i).setData(c),this._changes.setDirty()}getOwnSource(i){const c=this.getOwnSourceCache(i);return c&&c.getSource()}getOwnSources(){const i=[];for(const c in this._otherSourceCaches){const p=this.getOwnSourceCache(c);p&&i.push(p.getSource())}return i}areTilesLoaded(){const i=this._mergedSourceCaches;for(const c in i){const p=i[c]._tiles;for(const x in p){const w=p[x];if(w.state!=="loaded"&&w.state!=="errored")return!1}}return!0}setLights(i){if(this._checkLoaded(),!i)return delete this.ambientLight,void delete this.directionalLight;const c=this._getTransitionParameters();for(const w of i){if(this._validate(Pf,"lights",w))return;switch(w.type){case"ambient":if(this.ambientLight){const A=this.ambientLight;A.set(w),A.updateTransitions(c)}else this.ambientLight=new mi(w,An||(An=new n.a9({color:new n.aa(n.a6.properties_light_ambient.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_ambient.intensity)})),this.scope,this.options);break;case"directional":if(this.directionalLight){const A=this.directionalLight;A.set(w),A.updateTransitions(c)}else this.directionalLight=new mi(w,Xn||(Xn=new n.a9({direction:new n.ap(n.a6.properties_light_directional.direction),color:new n.aa(n.a6.properties_light_directional.color),"color-use-theme":new n.aa({type:"string",default:"default","property-type":"data-constant"}),intensity:new n.aa(n.a6.properties_light_directional.intensity),"cast-shadows":new n.aa(n.a6.properties_light_directional["cast-shadows"]),"shadow-quality":new n.aa(n.a6.properties_light_directional["shadow-quality"]),"shadow-intensity":new n.aa(n.a6.properties_light_directional["shadow-intensity"])})),this.scope,this.options)}}const p=Object.assign(c,{worldview:this.map.getWorldview()}),x=new n.ac(this.z||0,p);this.ambientLight&&this.ambientLight.recalculate(x),this.directionalLight&&this.directionalLight.recalculate(x),this._brightness=this.calculateLightsBrightness(),this.dispatcher.broadcast("setBrightness",this._brightness)}calculateLightsBrightness(){const i=this.directionalLight,c=this.ambientLight;if(!i||!c)return;const p=V=>.2126*(V[0]<=.03928?V[0]/12.92:Math.pow((V[0]+.055)/1.055,2.4))+.7152*(V[1]<=.03928?V[1]/12.92:Math.pow((V[1]+.055)/1.055,2.4))+.0722*(V[2]<=.03928?V[2]/12.92:Math.pow((V[2]+.055)/1.055,2.4)),x=i.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),w=i.properties.get("intensity"),A=i.properties.get("direction"),I=1-n.d3(A.x,A.y,A.z)[2]/90,O=p(x)*w*I,z=c.properties.get("color").toNonPremultipliedRenderColor(null).toArray01(),k=c.properties.get("intensity"),H=p(z)*k;return Number(((O+H)/2).toFixed(6))}getBrightness(){return this._brightness}getLights(){if(!this.enable3dLights())return null;const i=[];return this.directionalLight&&i.push(this.directionalLight.get()),this.ambientLight&&i.push(this.ambientLight.get()),i}enable3dLights(){return!!this.ambientLight&&!!this.directionalLight}getFragmentStyle(i){if(i==null||i===""&&this.isRootStyle())return this;if(n.dm(i)){const c=n.dn(i),p=this.fragments.find((({id:w})=>w===c));if(!p)return;const x=n.dl(i);return p.style.getFragmentStyle(x)}{const c=this.fragments.find((({id:p})=>p===i));return c?c.style:void 0}}setFeaturesetSelectors(i){if(!i)return;const c={},p=(x,w="")=>`${x}::${w}`;this._featuresetSelectors={};for(const x in i){const w=this._featuresetSelectors[x]=[];for(const A of i[x].selectors){if(A.featureNamespace){const O=this.getOwnLayer(A.layer);if(!O){n.w(`Layer is undefined for selector: ${A.layer}`);continue}const z=p(O.source,O.sourceLayer);if(z in c&&c[z]!==A.featureNamespace){n.w(`"featureNamespace ${A.featureNamespace} of featureset ${x}'s selector is not associated to the same source, skip this selector`);continue}c[z]=A.featureNamespace}let I;if(A.properties)for(const O in A.properties){const z=n.U(A.properties[O]);z.result==="success"&&(I=I||{},I[O]=z.value)}w.push({layerId:A.layer,namespace:A.featureNamespace,properties:I,uniqueFeatureID:A._uniqueFeatureID})}}}getFeaturesetDescriptors(i){const c=this.getFragmentStyle(i);if(!c||!c.stylesheet.featuresets)return[];const p=[];for(const x in c.stylesheet.featuresets)p.push({featuresetId:x,importId:c.scope?c.scope:void 0});return p}getFeaturesetLayers(i,c){const p=this.getFragmentStyle(c),x=p.stylesheet.featuresets;if(!x||!x[i])return this.fire(new n.y(new Error(`The featureset '${i}' does not exist in the map's style and cannot be queried.`))),[];const w=[];for(const A of x[i].selectors){const I=p.getOwnLayer(A.layer);I&&w.push(I)}return w}getConfigProperty(i,c){const p=this.getFragmentStyle(i);if(!p)return null;const x=n.B(c,p.scope),w=p.options.get(x),A=w?w.value||w.default:null;return A?A.serialize():null}setConfigProperty(i,c,p){const x=this.getFragmentStyle(i);if(!x)return;const w=x.stylesheet.schema;if(!w||!w[c])return;const A=n.U(p);if(A.result!=="success")return void Jc(this,A.value);const I=A.value.expression,O=n.B(c,x.scope),z=x.options.get(O);if(!z)return;let k;const{minValue:H,maxValue:V,stepValue:X,type:Y,values:W}=w[c],re=n.U(w[c].default);re.result==="success"&&(k=re.value.expression),k?(this.options.set(O,Object.assign({},z,{value:I,default:k,minValue:H,maxValue:V,stepValue:X,type:Y,values:W})),this.updateConfigDependencies(c)):this.fire(new n.y(new Error(`No schema defined for the config option "${c}" in the "${i}" fragment.`)))}getConfig(i){const c=this.getFragmentStyle(i);if(!c)return null;const p=c.stylesheet.schema;if(!p)return null;const x={};for(const w in p){const A=n.B(w,c.scope),I=c.options.get(A),O=I?I.value||I.default:null;x[w]=O?O.serialize():null}return x}setConfig(i,c){const p=this.getFragmentStyle(i);p&&(p.updateConfig(c,p.stylesheet.schema),this.updateConfigDependencies())}getSchema(i){const c=this.getFragmentStyle(i);return c?c.stylesheet.schema:null}setSchema(i,c){const p=this.getFragmentStyle(i);p&&(p.stylesheet.schema=c,p.updateConfig(p._config,c),this.updateConfigDependencies())}updateConfig(i,c){if(this._config=i,i||c)if(c)for(const p in c){let x,w;const A=n.U(c[p].default);if(A.result==="success"&&(x=A.value.expression),i&&i[p]!==void 0){const V=n.U(i[p]);V.result==="success"&&(w=V.value.expression)}const{minValue:I,maxValue:O,stepValue:z,type:k,values:H}=c[p];if(x){const V=n.B(p,this.scope);this.options.set(V,{default:x,value:w,minValue:I,maxValue:O,stepValue:z,type:k,values:H})}else this.fire(new n.y(new Error(`No schema defined for config option "${p}".`)))}else this.fire(new n.y(new Error("Attempting to set config for a style without schema.")))}updateConfigDependencies(i){for(const c of this._configDependentLayers){const p=this.getLayer(c);if(p){if(i&&!p.configDependencies.has(i))continue;p.possiblyEvaluateVisibility(),this._updateLayer(p)}}this.ambientLight&&this.ambientLight.updateConfig(this.options),this.directionalLight&&this.directionalLight.updateConfig(this.options),this.fog&&this.fog.updateConfig(this.options),this.snow&&this.snow.updateConfig(this.options),this.rain&&this.rain.updateConfig(this.options),this.forEachFragmentStyle((c=>{const p=c._styleColorTheme.colorThemeOverride?c._styleColorTheme.colorThemeOverride:c._styleColorTheme.colorTheme;if(p){const x=c._evaluateColorThemeData(p);(!c._styleColorTheme.lut&&x!==""||c._styleColorTheme.lut&&x!==c._styleColorTheme.lut.data)&&c.setColorTheme(p)}})),this._changes.setDirty()}addLayer(i,c,p={}){this._checkLoaded();const x=i.id;if(this._layers[x])return void this.fire(new n.y(new Error(`Layer with id "${x}" already exists on this map`)));let w;if(i.type==="custom"){if(Jc(this,n.dp(i)))return;w=n.dq(i,this.scope,this._styleColorTheme.lut,this.options)}else{if(typeof i.source=="object"&&(this.addSource(x,i.source),i=n.dk(i),i=Object.assign(i,{source:x})),this._validate(Ne,`layers.${x}`,i,{arrayIndex:-1},p))return;w=n.dq(i,this.scope,this._styleColorTheme.lut,this.options),this._validateLayer(w),w.setEventedParent(this,{layer:{id:x}})}w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid);let A=this._order.length;if(c){const k=this._order.indexOf(c);if(k===-1)return void this.fire(new n.y(new Error(`Layer with id "${c}" does not exist on this map.`)));w.slot===this._layers[c].slot?A=k:n.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(A,0,x),this._layerOrderChanged=!0,this._layers[x]=w;const I=this.getOwnLayerSourceCache(w),O=!!this.directionalLight&&this.directionalLight.shadowsEnabled();I&&w.canCastShadows()&&O&&(I.castsShadows=!0);const z=this._changes.getRemovedLayer(w);if(z&&w.source&&I&&w.type!=="custom"){this._changes.discardLayerRemoval(w);const k=n.B(w.source,w.scope);z.type!==w.type?this._changes.updateSourceCache(k,"clear"):(this._changes.updateSourceCache(k,"reload"),I.pause())}this._updateLayer(w),w.onAdd&&w.onAdd(this.map),w.scope=this.scope,this.mergeLayers()}moveLayer(i,c){this._checkLoaded();const p=this._checkLayer(i);if(!p||i===c)return;const x=this._order.indexOf(i);this._order.splice(x,1);let w=this._order.length;if(c){const A=this._order.indexOf(c);if(A===-1)return void this.fire(new n.y(new Error(`Layer with id "${c}" does not exist on this map.`)));p.slot===this._layers[c].slot?w=A:n.w(`Layer with id "${c}" has a different slot. Layers can only be rearranged within the same slot.`)}this._order.splice(w,0,i),this._changes.setDirty(),this._layerOrderChanged=!0,this.mergeLayers()}removeLayer(i){this._checkLoaded();const c=this._checkLayer(i);if(!c)return;c.setEventedParent(null);const p=this._order.indexOf(i);this._order.splice(p,1),delete this._layers[i],this._changes.setDirty(),this._layerOrderChanged=!0,this._configDependentLayers.delete(c.fqid),this._changes.removeLayer(c);const x=this.getOwnLayerSourceCache(c);if(x&&x.castsShadows){let w=!1;for(const A in this._layers)if(this._layers[A].source===c.source&&this._layers[A].canCastShadows()){w=!0;break}x.castsShadows=w}c.onRemove&&c.onRemove(this.map),this.mergeLayers()}getOwnLayer(i){return this._layers[i]}hasLayer(i){return i in this._mergedLayers}hasLayerType(i){for(const c in this._layers)if(this._layers[c].type===i)return!0;return!1}setLayerZoomRange(i,c,p){this._checkLoaded();const x=this._checkLayer(i);x&&(x.minzoom===c&&x.maxzoom===p||(c!=null&&(x.minzoom=c),p!=null&&(x.maxzoom=p),this._updateLayer(x)))}getSlots(){return this._checkLoaded(),this._mergedSlots}setSlot(i,c){this._checkLoaded();const p=this._checkLayer(i);p&&p.slot!==c&&(p.slot=c,this._updateLayer(p))}setFilter(i,c,p={}){this._checkLoaded();const x=this._checkLayer(i);if(x&&!n.by(x.filter,c))return c==null?(x.filter=void 0,void this._updateLayer(x)):void(this._validate(te,`layers.${x.id}.filter`,c,{layerType:x.type},p)||(x.filter=n.dk(c),this._updateLayer(x)))}getFilter(i){const c=this._checkLayer(i);if(c)return n.dk(c.filter)}setLayoutProperty(i,c,p,x={}){this._checkLoaded();const w=this._checkLayer(i);if(w&&!n.by(w.getLayoutProperty(c),p)){if(p!=null&&(!x||x.validate!==!1)&&Jc(w,me.call(ya,{key:`layers.${i}.layout.${c}`,layerType:w.type,objectKey:c,value:p,styleSpec:n.a6,style:{glyphs:!0,sprite:!0}})))return;w.setLayoutProperty(c,p),w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),this._updateLayer(w)}}getLayoutProperty(i,c){const p=this._checkLayer(i);if(p)return p.getLayoutProperty(c)}setPaintProperty(i,c,p,x={}){this._checkLoaded();const w=this._checkLayer(i);if(!w||n.by(w.getPaintProperty(c),p)||p!=null&&(!x||x.validate!==!1)&&Jc(w,oe.call(ya,{key:`layers.${i}.paint.${c}`,layerType:w.type,objectKey:c,value:p,styleSpec:n.a6})))return;const A=w.setPaintProperty(c,p);w.configDependencies.size!==0&&this._configDependentLayers.add(w.fqid),A&&this._updateLayer(w),this._changes.updatePaintProperties(w)}getPaintProperty(i,c){const p=this._checkLayer(i);if(p)return p.getPaintProperty(c)}setFeatureState(i,c){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:O,importId:z}=i.target,k=this.getFragmentStyle(z),H=k.getFeaturesetLayers(O);for(const{source:V,sourceLayer:X}of H)k.setFeatureState({id:i.id,source:V,sourceLayer:X},c)}else if("layerId"in i.target){const{layerId:O}=i.target,z=this.getLayer(O);this.setFeatureState({id:i.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=i.source,x=i.sourceLayer,w=this._checkSource(p);if(!w)return;const A=w.type;if(A==="geojson"&&x)return void this.fire(new n.y(new Error("GeoJSON sources cannot have a sourceLayer parameter.")));if(A==="vector"&&!x)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));i.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided.")));const I=this.getOwnSourceCaches(p);for(const O of I)O.setFeatureState(x,i.id,c)}removeFeatureState(i,c){if(this._checkLoaded(),"target"in i){if("featuresetId"in i.target){const{featuresetId:O,importId:z}=i.target,k=this.getFragmentStyle(z),H=k.getFeaturesetLayers(O);for(const{source:V,sourceLayer:X}of H)k.removeFeatureState({id:i.id,source:V,sourceLayer:X},c)}else if("layerId"in i.target){const{layerId:O}=i.target,z=this.getLayer(O);this.removeFeatureState({id:i.id,source:z.source,sourceLayer:z.sourceLayer},c)}return}const p=i.source,x=this._checkSource(p);if(!x)return;const w=x.type,A=w==="vector"?i.sourceLayer:void 0;if(w==="vector"&&!A)return void this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")));if(c&&typeof i.id!="string"&&typeof i.id!="number")return void this.fire(new n.y(new Error("A feature id is required to remove its specific state property.")));const I=this.getOwnSourceCaches(p);for(const O of I)O.removeFeatureState(A,i.id,c)}getFeatureState(i){if(this._checkLoaded(),"target"in i){let w;if("featuresetId"in i.target){const{featuresetId:A,importId:I}=i.target,O=this.getFragmentStyle(I),z=O.getFeaturesetLayers(A);for(const{source:k,sourceLayer:H}of z){const V=O.getFeatureState({id:i.id,source:k,sourceLayer:H});if(V&&!w)w=V;else if(!n.by(w,V))return void this.fire(new n.y(new Error("The same feature id exists in multiple sources in the featureset, but their feature states are not consistent through the sources.")))}}else if("layerId"in i.target){const{layerId:A}=i.target,I=this.getLayer(A);w=this.getFeatureState({id:i.id,source:I.source,sourceLayer:I.sourceLayer})}return w}const c=i.source,p=i.sourceLayer,x=this._checkSource(c);if(x){if(x.type!=="vector"||p)return i.id===void 0&&this.fire(new n.y(new Error("The feature id parameter must be provided."))),this.getOwnSourceCaches(c)[0].getFeatureState(p,i.id);this.fire(new n.y(new Error("The sourceLayer parameter must be provided for vector source types.")))}}setTransition(i){return this.stylesheet.transition=Object.assign({},this.stylesheet.transition,i),this.transition=this.stylesheet.transition,this}getTransition(){return Object.assign({},this.stylesheet.transition)}serialize(){this._checkLoaded();const i=this.getTerrain(),c=i&&this.terrain&&this.terrain.scope===this.scope?i:this.stylesheet.terrain;return n.dr({version:this.stylesheet.version,name:this.stylesheet.name,metadata:this.stylesheet.metadata,fragment:this.stylesheet.fragment,iconsets:this.stylesheet.iconsets,imports:this._serializeImports(),schema:this.stylesheet.schema,camera:this.stylesheet.camera,light:this.stylesheet.light,lights:this.stylesheet.lights,terrain:c,fog:this.stylesheet.fog,snow:this.stylesheet.snow,rain:this.stylesheet.rain,center:this.stylesheet.center,"color-theme":this.stylesheet["color-theme"],zoom:this.stylesheet.zoom,bearing:this.stylesheet.bearing,pitch:this.stylesheet.pitch,sprite:this.stylesheet.sprite,glyphs:this.stylesheet.glyphs,transition:this.stylesheet.transition,projection:this.stylesheet.projection,sources:this._serializeSources(),layers:this._serializeLayers(this._order)},(p=>p!==void 0))}_updateFilteredLayers(i){for(const c of Object.values(this._mergedLayers))i(c)&&this._updateLayer(c)}_updateLayer(i){this._changes.updateLayer(i);const c=this.getLayerSourceCache(i),p=n.B(i.source,i.scope),x=this._changes.getUpdatedSourceCaches();i.source&&!x[p]&&c&&c.getSource().type!=="raster"&&(this._changes.updateSourceCache(p,"reload"),c.pause()),i.invalidateCompiledFilter()}_flattenAndSortRenderedFeatures(i){const c=I=>this._mergedLayers[I].is3D(!!this.terrain),p=this.order,x={},w=[];for(let I=p.length-1;I>=0;I--){const O=p[I];if(c(O)){x[O]=I;for(const z of i){const k=z[O];if(k)for(const H of k)w.push(H)}}}w.sort(((I,O)=>O.intersectionZ-I.intersectionZ));const A=[];for(let I=p.length-1;I>=0;I--){const O=p[I];if(c(O))for(let z=w.length-1;z>=0;z--){const k=w[z].feature;if(k.layer&&x[k.layer.id]<I)break;A.push(k),w.pop()}else for(const z of i){const k=z[O];if(k)for(const H of k)A.push(H.feature)}}return A}queryRasterValue(i,c,p){const x=this.getOwnSource(i);return x?x.type!=="raster-array"?(this.fire(new n.y(new Error('queryRasterValue support only "raster-array" sources.'))),Promise.resolve(null)):x.queryRasterArrayValue(c,p):(this.fire(new n.y(new Error(`Source with id "${i}" does not exist in the style.`))),Promise.resolve(null))}queryRenderedFeatures(i,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(te,"queryRenderedFeatures.filter",c.filter,null,c),x=n.b6(c.filter));const w={},A=k=>{if(Fh.has(k.type))return;const H=this.getOwnLayerSourceCache(k),V=w[H.id]=w[H.id]||{sourceCache:H,layers:{},has3DLayers:!1};k.is3D(!!this.terrain)&&(V.has3DLayers=!0),V.layers[k.fqid]=V.layers[k.fqid]||{styleLayer:k,targets:[]},V.layers[k.fqid].targets.push({filter:x})};if(c&&c.layers){if(!Array.isArray(c.layers))return this.fire(new n.y(new Error("parameters.layers must be an Array."))),[];for(const k of c.layers){const H=this._layers[k];if(!H)return this.fire(new n.y(new Error(`The layer '${k}' does not exist in the map's style and cannot be queried for features.`))),[];A(H)}}else for(const k in this._layers)A(this._layers[k]);const I=this._queryRenderedFeatures(i,w,p),O=this._flattenAndSortRenderedFeatures(I),z=[];for(const k of O)n.ds(k.layer.id)===this.scope&&z.push(k);return z}queryRenderedFeatureset(i,c,p){let x;c&&!Array.isArray(c)&&c.filter&&(this._validate(te,"queryRenderedFeatures.filter",c.filter,null,c),x=n.b6(c.filter));const w="mock",A=[];if(c&&c.target)A.push(Object.assign({},c,{targetId:w,filter:x}));else{const k=this.getFeaturesetDescriptors();for(const H of k)A.push({targetId:w,filter:x,target:H});for(const{style:H}of this.fragments){const V=H.getFeaturesetDescriptors();for(const X of V)A.push({targetId:w,filter:x,target:X})}}const I=this.queryRenderedTargets(i,A,p),O=[],z=new Set;for(const k of I)for(const H of k.variants[w])jc(H,k,z)||O.push(new n.dt(k,H));return O}queryRenderedTargets(i,c,p){const x={},w=(I,O,z,k)=>{const H=x[O.id]=x[O.id]||{sourceCache:O,layers:{},has3DLayers:!1};if(H.layers[I.fqid]=H.layers[I.fqid]||{styleLayer:I,targets:[]},I.is3D(!!this.terrain)&&(H.has3DLayers=!0),!k)return z.uniqueFeatureID=!1,void H.layers[I.fqid].targets.push(z);H.layers[I.fqid].targets.push(Object.assign({},z,{namespace:k.namespace,properties:k.properties,uniqueFeatureID:k.uniqueFeatureID}))};for(const I of c)if("featuresetId"in I.target){const{featuresetId:O,importId:z}=I.target,k=this.getFragmentStyle(z);if(!k||!k._featuresetSelectors)continue;const H=k._featuresetSelectors[O];if(!H){this.fire(new n.y(new Error(`The featureset '${O}' does not exist in the map's style and cannot be queried for features.`)));continue}for(const V of H){const X=k.getOwnLayer(V.layerId);X&&!Fh.has(X.type)&&w(X,k.getOwnLayerSourceCache(X),I,V)}}else if("layerId"in I.target){const{layerId:O}=I.target,z=this.getLayer(O);if(!z||Fh.has(z.type))continue;w(z,this.getLayerSourceCache(z),I)}const A=this._queryRenderedFeatures(i,x,p);return this._flattenAndSortRenderedFeatures(A)}_queryRenderedFeatures(i,c,p){const x=[],w=!!this.map._showQueryGeometry,A=$i.createFromScreenPoints(i,p);for(const I in c){const O=aa(A,c[I],this._availableImages,p,w);Object.keys(O).length&&x.push(O)}if(this.placement)for(const I in c){if(!c[I].sourceCache._onlySymbols)continue;const O=Lf(A.screenGeometry,c[I],this._availableImages,this.placement.collisionIndex,this.placement.retainedQueryData,this.map.getWorldview());Object.keys(O).length&&x.push(O)}return x}querySourceFeatures(i,c){const p=c&&c.filter;p&&this._validate(te,"querySourceFeatures.filter",p,null,c);let x=[];const w=this.getOwnSourceCaches(i);for(const A of w)x=x.concat(Ys(A,c));return x}addSourceType(i,c,p){return ns.getSourceType(i)?p(new Error(`A source type called "${i}" already exists.`)):(ns.setSourceType(i,c),c.workerSourceURL?void this.dispatcher.broadcast("loadWorkerSource",{name:i,url:c.workerSourceURL},p):p(null,null))}getFlatLight(){return this.light.getLight()}setFlatLight(i,c,p={}){this._checkLoaded();const x=this.light.getLight();let w=!1;for(const I in i)if(!n.by(i[I],x[I])){w=!0;break}if(!w)return;const A=this._getTransitionParameters();this.light.setLight(i,c,p),this.light.updateTransitions(A)}getTerrain(){return this.terrain&&this.terrain.drapeRenderMode===1?this.terrain.get():null}setTerrainForDraping(){this.setTerrain({source:"",exaggeration:0},0)}checkCanvasFingerprintNoise(){this.disableElevatedTerrain===void 0&&(this.disableElevatedTerrain=n.o.hasCanvasFingerprintNoise(),this.disableElevatedTerrain&&n.w("Terrain and hillshade are disabled because of Canvas2D limitations when fingerprinting protection is enabled (e.g. in private browsing mode)."))}setTerrain(i,c=1){if(this._checkLoaded(),!i)return this.terrainSetForDrapingOnly()||(delete this.terrain,this.map.transform.projection.requiresDraping&&this.setTerrainForDraping()),c===0&&delete this.terrain,i===null?this.stylesheet.terrain=null:delete this.stylesheet.terrain,this._force3DLayerUpdate(),void(this._markersNeedUpdate=!0);this.checkCanvasFingerprintNoise();let p=i;const x=i.source==null;if(c===1){if(this.disableElevatedTerrain)return;if(typeof p.source=="object"){const I="terrain-dem-src";this.addSource(I,p.source),p=n.dk(p),p=Object.assign(p,{source:I})}const w=Object.assign({},p),A={};if(this.terrain&&x){w.source=this.terrain.get().source;const I=this.terrain?this.getFragmentStyle(this.terrain.scope):null;I&&(A.style=I.serialize())}if(this._validate(Tt,"terrain",w,A))return}if(!this.terrain||this.terrain.scope!==this.scope&&!x||this.terrain&&c!==this.terrain.drapeRenderMode){if(!p)return;this._createTerrain(p,c),this.fire(new n.z("data",{dataType:"style"}))}else{const w=this.terrain,A=w.get();for(const I of Object.keys(n.a6.terrain))!p.hasOwnProperty(I)&&n.a6.terrain[I].default&&(p[I]=n.a6.terrain[I].default);for(const I in i)if(!n.by(i[I],A[I])){w.set(i,this.options),this.stylesheet.terrain=i;const O=this._getTransitionParameters({duration:0});w.updateTransitions(O),this.fire(new n.z("data",{dataType:"style"}));break}}this.mergeTerrain(),this.updateDrapeFirstLayers(),this._markersNeedUpdate=!0}_createFog(i){const c=this.fog=new Yr(i,this.map.transform,this.scope,this.options);this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createSnow(i){const c=this.snow=new eo(i,this.map.transform,this.scope,this.options);this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_createRain(i){const c=this.rain=new Li(i,this.map.transform,this.scope,this.options);this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}_updateMarkersOpacity(){this.map._markers.length!==0&&this.map._requestDomTask((()=>{for(const i of this.map._markers)i._evaluateOpacity()}))}getFog(){return this.fog?this.fog.get():null}setFog(i){if(this._checkLoaded(),!i)return delete this.fog,delete this.stylesheet.fog,void(this._markersNeedUpdate=!0);if(this.fog){const c=this.fog;if(!n.by(c.get(),i)){c.set(i,this.options),this.stylesheet.fog=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createFog(i);this._markersNeedUpdate=!0}getSnow(){return this.snow?this.snow.get():null}setSnow(i){if(this._checkLoaded(),!i)return delete this.snow,void delete this.stylesheet.snow;if(this.snow){const c=this.snow;if(!n.by(c.get(),i)){c.set(i,this.options),this.stylesheet.snow=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createSnow(i);this._markersNeedUpdate=!0}getRain(){return this.rain?this.rain.get():null}setRain(i){if(this._checkLoaded(),!i)return delete this.rain,void delete this.stylesheet.rain;if(this.rain){const c=this.rain;if(!n.by(c.get(),i)){c.set(i,this.options),this.stylesheet.rain=c.get();const p=this._getTransitionParameters({duration:0});c.updateTransitions(p)}}else this._createRain(i);this._markersNeedUpdate=!0}_reloadColorTheme(){const i=()=>{for(const x in this._layers)this._layers[x].lut=this._styleColorTheme.lut;for(const x in this._sourceCaches)this._sourceCaches[x].clearTiles()},c=this._styleColorTheme.colorThemeOverride?this._styleColorTheme.colorThemeOverride:this._styleColorTheme.colorTheme;if(!c)return this._styleColorTheme.lut=null,void i();const p=this._evaluateColorThemeData(c);this._loadColorTheme(p).then((()=>{this.fire(new n.z("colorthemeset")),i()})).catch((x=>{n.w(`Couldn't set color theme: ${x}`)}))}setColorTheme(i){this._checkLoaded(),this._styleColorTheme.colorThemeOverride&&n.w("Note: setColorTheme is called on a style with a color-theme override, the passed color-theme won't be visible."),this._styleColorTheme.colorTheme=i,this._reloadColorTheme()}setImportColorTheme(i,c){const p=this.getFragmentStyle(i);p&&(p._styleColorTheme.colorThemeOverride=c,p._reloadColorTheme())}_getTransitionParameters(i){return{now:n.o.now(),transition:Object.assign(this.transition,i)}}updateDrapeFirstLayers(){if(!this.terrain)return;const i=[],c=[];for(const p of this._mergedOrder)this.isLayerDraped(this._mergedLayers[p])?i.push(p):c.push(p);this._drapedFirstOrder=[],this._drapedFirstOrder.push(...i),this._drapedFirstOrder.push(...c)}_createTerrain(i,c){const p=this.terrain=new Je(i,c,this.scope,this.options,this.map.getWorldview());c===1&&(this.stylesheet.terrain=i),this.mergeTerrain(),this.updateDrapeFirstLayers(),this._force3DLayerUpdate();const x=this._getTransitionParameters({duration:0});p.updateTransitions(x)}_force3DLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="fill-extrusion"&&this._updateLayer(c)}}_forceSymbolLayerUpdate(){for(const i in this._layers){const c=this._layers[i];c.type==="symbol"&&this._updateLayer(c)}}_validate(i,c,p,x,w={}){if(w&&w.validate===!1)return!1;const A=Object.assign({},this.serialize());return Jc(this,i.call(ya,Object.assign({key:c,style:A,value:p,styleSpec:n.a6},x)))}_remove(){this._request&&(this._request.cancel(),this._request=null),this._spriteRequest&&(this._spriteRequest.cancel(),this._spriteRequest=null),n.du.off("pluginStateChange",this._rtlTextPluginCallback);for(const i in this._mergedLayers)this._mergedLayers[i].setEventedParent(null);for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles(),this._mergedSourceCaches[i].setEventedParent(null);this.imageManager.removeScope(this.scope),this.setEventedParent(null),delete this.fog,delete this.snow,delete this.rain,delete this.terrain,delete this.ambientLight,delete this.directionalLight,this.isRootStyle()&&(this.imageManager.setEventedParent(null),this.imageManager.destroy(),this.modelManager.setEventedParent(null),this.modelManager.destroy(),this.dispatcher.remove())}clearSource(i){const c=this.getSourceCaches(i);for(const p of c)p.clearTiles()}clearSources(){for(const i in this._mergedSourceCaches)this._mergedSourceCaches[i].clearTiles()}clearLayers(){for(const i in this._mergedLayers){const c=this._mergedLayers[i];c._clear&&c._clear()}}reloadSource(i){const c=this.getSourceCaches(i);for(const p of c)p.resume(),p.reload()}reloadSources(){for(const i of this.getSources())i.reload&&i.reload()}reloadModels(){this.modelManager.reloadModels(""),this.forEachFragmentStyle((i=>{i.modelManager.reloadModels(i.scope)}))}updateSources(i){let c;this.directionalLight&&(c=Yu(this.directionalLight));const p=new Set;for(const x in this._mergedLayers){const w=this._mergedLayers[x];w.hasElevation()&&!p.has(w.source)&&p.add(w.source)}for(const x in this._mergedSourceCaches){const w=this._mergedSourceCaches[x],A=p.has(w._source.id);w.update(i,void 0,void 0,c,A)}}_generateCollisionBoxes(){for(const i in this._sourceCaches){const c=this._sourceCaches[i];c.resume(),c.reload()}}_updatePlacement(i,c,p,x,w,A,I=!1){let O=!1,z=!1;const k={},H={};for(const V of this._mergedOrder){const X=this._mergedLayers[V];if(X.type!=="symbol")continue;const Y=n.B(X.source,X.scope);let W=k[Y];if(!W){const K=this.getLayerSourceCache(X);if(!K)continue;const ae=K.getRenderableIds(!0).map((ue=>K.getTileByID(ue)));H[Y]=ae.slice(),W=k[Y]=ae.sort(((ue,fe)=>fe.tileID.overscaledZ-ue.tileID.overscaledZ||(ue.tileID.isLessThan(fe.tileID)?-1:1)))}const re=this.crossTileSymbolIndex.addLayer(X,W,c.center.lng,c.projection);O=O||re}if(this.crossTileSymbolIndex.pruneUnusedLayers(this._mergedOrder),I=I||this._layerOrderChanged||x===0,this._layerOrderChanged&&this.fire(new n.z("neworder")),(I||!this.pauseablePlacement||this.pauseablePlacement.isDone()&&!this.placement.stillRecent(n.o.now(),c.zoom))&&(this.pauseablePlacement=new Jo(c,this._mergedOrder,I,p,x,w,this.placement,this.fog&&c.projection.supportsFog?this.fog.state:null,this._buildingIndex),this._layerOrderChanged=!1),this.pauseablePlacement.isDone()?this.placement.setStale():(this.pauseablePlacement.continuePlacement(this._mergedOrder,this._mergedLayers,k,H,this.map.painter.scaleFactor),this.pauseablePlacement.isDone()&&(this.placement=this.pauseablePlacement.commit(n.o.now()),z=!0),O&&this.pauseablePlacement.placement.setStale()),z||O){this._buildingIndex.onNewFrame(c.zoom);for(let V=0;V<this._mergedOrder.length;V++){const X=this._mergedLayers[this._mergedOrder[V]];if(X.type!=="symbol")continue;const Y=this.isLayerClipped(X);this.placement.updateLayerOpacities(X,k[n.B(X.source,X.scope)],V,Y?A:null)}}return{needsRerender:!this.pauseablePlacement.isDone()||this.placement.hasTransitions(n.o.now())}}_releaseSymbolFadeTiles(){for(const i in this._sourceCaches)this._sourceCaches[i].releaseSymbolFadeTiles()}addImport(i,c){this._checkLoaded();const p=this.stylesheet.imports=this.stylesheet.imports||[];if(p.findIndex((({id:w})=>w===i.id))!==-1)return void this.fire(new n.y(new Error(`Import with id '${i.id}' already exists in the map's style.`)));if(!c)return p.push(i),this._loadImports([i],!0);const x=p.findIndex((({id:w})=>w===c));return x===-1&&this.fire(new n.y(new Error(`Import with id "${c}" does not exist on this map.`))),this.stylesheet.imports=p.slice(0,x).concat(i).concat(p.slice(x)),this._loadImports([i],!0,c)}updateImport(i,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(i);return x===-1?this:typeof c=="string"?(this.setImportUrl(i,c),this):(c.url&&c.url!==p[x].url&&this.setImportUrl(i,c.url),n.by(c.config,p[x].config)||this.setImportConfig(i,c.config,c.data.schema),n.by(c.data,p[x].data)||this.setImportData(i,c.data),this)}moveImport(i,c){this._checkLoaded();let p=this.stylesheet.imports||[];const x=this.getImportIndex(i);if(x===-1)return this;const w=this.getImportIndex(c);if(w===-1)return this;const A=p[x],I=this.fragments[x];return p=p.filter((({id:O})=>O!==i)),this.fragments=this.fragments.filter((({id:O})=>O!==i)),this.stylesheet.imports=p.slice(0,w).concat(A).concat(p.slice(w)),this.fragments=this.fragments.slice(0,w).concat(I).concat(this.fragments.slice(w)),this.mergeLayers(),this}setImportUrl(i,c){this._checkLoaded();const p=this.stylesheet.imports||[],x=this.getImportIndex(i);if(x===-1)return this;p[x].url=c;const w=this.fragments[x];return w.style=this._createFragmentStyle(p[x]),w.style.on("style.import.load",(()=>this.mergeAll())),w.style.loadURL(c),this}setImportData(i,c){this._checkLoaded();const p=this.getImportIndex(i),x=this.stylesheet.imports||[];return p===-1?this:c?(this.fragments[p].style.setState(c),this._reloadImports(),this):(delete x[p].data,this.setImportUrl(i,x[p].url))}setImportConfig(i,c,p){this._checkLoaded();const x=this.getImportIndex(i),w=this.stylesheet.imports||[];if(x===-1)return this;c?w[x].config=c:delete w[x].config;const A=this.fragments[x];p&&A.style.stylesheet&&(A.style.stylesheet.schema=p);const I=A.style.stylesheet&&A.style.stylesheet.schema;return A.config=c,A.style.updateConfig(c,I),this.updateConfigDependencies(),this}removeImport(i){this._checkLoaded();const c=this.stylesheet.imports||[],p=this.getImportIndex(i);p!==-1&&(c.splice(p,1),this.fragments[p].style._remove(),this.fragments.splice(p,1),this._reloadImports())}getImportIndex(i){const c=(this.stylesheet.imports||[]).findIndex((p=>p.id===i));return c===-1&&this.fire(new n.y(new Error(`Import '${i}' does not exist in the map's style and cannot be updated.`))),c}getLayer(i){return this._mergedLayers[i]}getSources(){const i=[];for(const c in this._mergedOtherSourceCaches){const p=this._mergedOtherSourceCaches[c];p&&i.push(p.getSource())}return i}getSource(i,c){const p=this.getSourceCache(i,c);return p&&p.getSource()}getLayerSource(i){const c=this.getLayerSourceCache(i);return c&&c.getSource()}getSourceCache(i,c){const p=n.B(i,c);return this._mergedOtherSourceCaches[p]}getLayerSourceCache(i){const c=n.B(i.source,i.scope);return i.type==="symbol"?this._mergedSymbolSourceCaches[c]:this._mergedOtherSourceCaches[c]}getSourceCaches(i){if(i==null)return Object.values(this._mergedSourceCaches);const c=[];return this._mergedOtherSourceCaches[i]&&c.push(this._mergedOtherSourceCaches[i]),this._mergedSymbolSourceCaches[i]&&c.push(this._mergedSymbolSourceCaches[i]),c}updateSourceCaches(){const i=this._changes.getUpdatedSourceCaches();for(const c in i){const p=i[c];p==="reload"?this.reloadSource(c):p==="clear"&&this.clearSource(c)}}updateLayers(i){const c=this._changes.getUpdatedPaintProperties();for(const p of c){const x=this.getLayer(p);x&&x.updateTransitions(i)}}getGlyphsUrl(){return this.stylesheet.glyphs}setGlyphsUrl(i){this.stylesheet.glyphs=i,this.glyphManager.setURL(i)}getImages(i,c,p){this.imageManager.getImages(c.images,c.scope,p),this._updateTilesForChangedImages();const x=A=>{if(A){const I=c.images.map((O=>n.I.toString(O)));A.setDependencies(c.tileID.key,c.type,I)}},w=n.B(c.source,c.scope);x(this._mergedOtherSourceCaches[w]),x(this._mergedSymbolSourceCaches[w]),c.images.some((A=>A.iconsetId))&&this.fire(new n.z("data",{dataType:"style"}))}rasterizeImages(i,c,p){this.imageManager.rasterizeImages(c,p)}getGlyphs(i,c,p){this.glyphManager.getGlyphs(c.stacks,p)}getResource(i,c,p){return n.dv(c,p)}getOwnSourceCache(i){return this._otherSourceCaches[i]}getOwnLayerSourceCache(i){return i.type==="symbol"?this._symbolSourceCaches[i.source]:this._otherSourceCaches[i.source]}getOwnSourceCaches(i){const c=[];return this._otherSourceCaches[i]&&c.push(this._otherSourceCaches[i]),this._symbolSourceCaches[i]&&c.push(this._symbolSourceCaches[i]),c}_isSourceCacheLoaded(i){const c=this.getOwnSourceCaches(i);return c.length===0?(this.fire(new n.y(new Error(`There is no source with ID '${i}'`))),!1):c.every((p=>p.loaded()))}has3DLayers(){return this._has3DLayers}hasSymbolLayers(){return this._hasSymbolLayers}hasCircleLayers(){return this._hasCircleLayers}isLayerClipped(i,c){if(!this._clipLayerPresent&&i.type!=="fill-extrusion"&&i.type!=="building")return!1;const p=i.type==="fill-extrusion"&&(i.sourceLayer==="building"||i.sourceLayer==="procedural_buildings"),x=i.type==="building";if(i.is3D(!!this.terrain)){if(p||x||c&&c.type==="batched-model"||i.type==="model")return!0}else if(i.type==="symbol")return!0;return!1}_clearWorkerCaches(){this.dispatcher.broadcast("clearCaches")}destroy(){this._clearWorkerCaches(),this.fragments.forEach((i=>{i.style._remove()})),this.terrainSetForDrapingOnly()&&(delete this.terrain,delete this.stylesheet.terrain)}}ns.getSourceType=function(g){return Kl[g]},ns.setSourceType=function(g,i){Kl[g]=i},ns.registerForPluginStateChange=n.dw;class wm{execute(i){const c=this._makeBuildingsQueryArea(i),p=this._makeFloorsQueryArea(i),x=i.queryRenderedFeatures(c).reduce(((z,k)=>{const H=k.properties.id;return k.properties.type!=="building"||z.some((V=>V.properties.id===H))||z.push(k),z}),[]),w=i.queryRenderedFeatures(p).reduce(((z,k)=>{const H=k.properties.id;return k.properties.type!=="floor"||z.some((V=>V.properties.id===H))||z.push(k),z}),[]),A=[i.getCenter().lng,i.getCenter().lat],I=this._findBuildingAtCenter(A,x),O=x.length>0?x[0]:null;return{floors:w.map((z=>({id:z.properties.id,name:z.properties.name,isDefault:z.properties.is_default,zIndex:z.properties.z_index,connectedFloorIds:z.properties.connected_floor_ids,conflictedFloorIds:z.properties.conflicted_floor_ids,buildingIds:z.properties.building_ids}))),building:I?{id:I.properties.id,name:I.properties.name}:{id:O.properties.id,name:O.properties.name}}}_makeBuildingsQueryArea(i){const c=i.transform.width,p=i.transform.height,x=Math.min(c,p)*(1/8),w=.5*(c-x),A=.5*(p-x);return[new n.P(w,A),new n.P(w+x,A+x)]}_makeFloorsQueryArea(i){const c=i.transform.width,p=i.transform.height;return[new n.P(0,0),new n.P(c,p)]}_findBuildingAtCenter(i,c){for(const p of c)if(p.geometry.type==="Polygon"&&this._pointInPolygon(i,p.geometry.coordinates[0]))return p;return null}_pointInPolygon(i,c){let p=!1;for(let x=0,w=c.length-1;x<c.length;w=x++){const A=c[x][0],I=c[x][1],O=c[w][1];I>i[1]!=O>i[1]&&i[0]<(c[w][0]-A)*(i[1]-I)/(O-I)+A&&(p=!p)}return p}}class Sm{constructor(){this._floors=new Map,this._buildings=new Map}append(i){const c=i.building;let p=!1;if(c){const x=c.id;x&&(this._buildings.set(x,c),p||this._buildings.has(x)||(p=!0))}return i.floors.forEach((x=>{const w=x.id;p||this._floors.has(w)||(p=!0),this._floors.set(w,x)})),p}clear(){this._floors.clear(),this._buildings.clear()}getFloors(i=null){const c=Array.from(this._floors.values());return i?c.filter((p=>{const x=p.buildingIds;return!!x&&x.split(";").includes(i)})):c}}class Ig{constructor(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage=new Sm}setIndoorData(i){const c=this._featuresStorage.append(i);return this._selectedBuildingId=i.building?i.building.id:null,c}setFloorId(i){const c=this._selectedFloorId!==i;return c&&(this._selectedFloorId=i),c}getCurrentBuildingSelection(){if(!this._selectedBuildingId)return{selectedFloorId:null,floors:[]};const i=this._featuresStorage.getFloors(this._selectedBuildingId),c=this.getActiveFloors().find((p=>{const x=p.buildingIds;if(!x)return!1;const w=x.split(";");return!!this._selectedBuildingId&&w.includes(this._selectedBuildingId)}));return{selectedFloorId:c?c.id:null,floors:i}}getActiveFloors(i=!1){const c=this._featuresStorage.getFloors(),p=c.find((O=>O.id===this._selectedFloorId)),x=c.filter((O=>O.isDefault===!0));let w=[];if(p)return w=this._calculateCurrentActiveFloors(c,p,x,i),w;if(x.length===0){const O=this._featuresStorage.getFloors(this._selectedBuildingId);w=O.length>0?[O[0]]:[]}else w=x;const A=this._getNonConflictingLastActiveFloors(w),I=[...w,...A];return this._lastActiveFloors=I,I}hasBuildingChanged(i){return this._selectedBuildingId!==(i.building?i.building.id:null)}hasActiveBuilding(){return this._selectedBuildingId!==null}isEmpty(){return this._selectedFloorId===null&&this._selectedBuildingId===null&&this._lastActiveFloors.length===0}_calculateCurrentActiveFloors(i,c,p,x){if(!c)return this._getNonConflictingDefaultFloors(this._lastActiveFloors,p);const w=this._getConnectedFloors(c,i);return x?this._buildExplicitSelectionFloors(c,w,p):this._buildImplicitSelectionFloors(w,p)}_getConnectedFloors(i,c){const p=i.connectedFloorIds;if(!p)return[];const x=new Set(p.split(";"));return c.filter((w=>x.has(w.id)))}_buildExplicitSelectionFloors(i,c,p){const x=[i,...c],w=this._getNonConflictingLastActiveFloors(x),A=[...x,...w],I=this._deduplicateFloors(A),O=this._getConflictingFloorIdsFrom(I),z=p.filter((H=>!O.has(H.id))),k=[...I,...z];return this._lastActiveFloors=k,k}_buildImplicitSelectionFloors(i,c){const p=this._getConflictingFloorIdsFrom(this._lastActiveFloors),x=c.filter((A=>!p.has(A.id))),w=this._deduplicateFloors([...this._lastActiveFloors,...x]);return this._lastActiveFloors=w,w}_getNonConflictingDefaultFloors(i,c){const p=this._getConflictingFloorIdsFrom(i),x=c.filter((A=>!p.has(A.id))),w=this._deduplicateFloors([...i,...x]);return this._lastActiveFloors=w,w}_deduplicateFloors(i){const c=new Set;return i.filter((p=>{const x=p.id;return!c.has(x)&&(c.add(x),!0)}))}_getConflictingFloorIdsFrom(i){const c=new Set;return i.forEach((p=>{const x=p.conflictedFloorIds;x&&x.split(";").forEach((w=>c.add(w)))})),c}_getNonConflictingLastActiveFloors(i){if(!this._lastActiveFloors||this._lastActiveFloors.length===0)return[];const c=new Set(i.map((x=>x.id))),p=this._getConflictingFloorIdsFrom(i);return this._lastActiveFloors.filter((x=>{const w=x.id;return!c.has(w)&&!p.has(w)}))}_isFloorConflicted(i,c){const p=i.id;return c.some((x=>{const w=x.conflictedFloorIds;return!!w&&w.split(";").includes(p)}))}reset(){this._selectedFloorId=null,this._selectedBuildingId=null,this._lastActiveFloors=[],this._featuresStorage.clear()}}class Ju extends n.E{constructor(i){super(),n.aY(["_onLoad","_onMove"],this),this._map=i,this._floorSelectionState=new Ig,this._queryIndoor(),this._map.on("load",this._onLoad),this._map.on("move",this._onMove)}destroy(){this._map.off("load",this._onLoad),this._map.off("move",this._onMove),this._map=null,this._floorSelectionState=null}selectFloor(i){this._floorSelectionState.setFloorId(i)&&this._updateIndoorConfig(!0)}_onLoad(){this._map.style.forEachFragmentStyle((i=>{i.stylesheet.indoor&&(this._indoorDataQuery?this.fire(new n.y(new Error("Multiple indoor map styles detected, simultaneous usage is not allowed currently."))):(this._scope=i.scope,this._indoorDataQuery=new wm))})),this._map._addIndoorControl(),this._queryIndoor()}_onMove(){this._queryIndoor()}_queryIndoor(){if(!this._indoorDataQuery||!this._map.isStyleLoaded())return;if(this._map.transform.zoom<15)return void this._clearIndoorData();const i=this._indoorDataQuery.execute(this._map);if(!i||i.floors.length===0||this._map.transform.zoom<16)this._clearIndoorData();else if(this._floorSelectionState.hasBuildingChanged(i)){if(!i.building&&this._floorSelectionState.getActiveFloors().length<=0)return void this._clearIndoorData();this._setIndoorData(i),i.building&&this._updateIndoorSelector()}else this._setIndoorData(i)}_setIndoorData(i){this._floorSelectionState.setIndoorData(i)&&this._updateIndoorConfig()}_clearIndoorData(){this._floorSelectionState.isEmpty()||(this._floorSelectionState.reset(),this._updateIndoorSelector(),this._map.setConfigProperty(this._scope,"activeFloors",["literal",[]]))}_updateIndoorSelector(){const i=this._floorSelectionState.getCurrentBuildingSelection(),c=i.floors.map((p=>({id:p.id,name:p.name,shortName:p.zIndex.toString(),levelOrder:p.zIndex})));this.fire(new n.z("indoorupdate",{selectedFloorId:i.selectedFloorId,floors:c}))}_updateIndoorConfig(i=!1){const c=this._floorSelectionState.getActiveFloors(i).map((p=>p.id))||[];this._map.setConfigProperty(this._scope,"activeFloors",["literal",c])}}var Wf=`
#define EPSILON 0.0000001
#define PI 3.141592653589793
#ifdef RENDER_CUTOFF
float cutoff_opacity(vec4 cutoff_params,float depth) {float near=cutoff_params.x;float far=cutoff_params.y;float cutoffStart=cutoff_params.z;float cutoffEnd=cutoff_params.w;float linearDepth=(depth-near)/(far-near);return clamp((linearDepth-cutoffStart)/(cutoffEnd-cutoffStart),0.0,1.0);}
#endif`,Zd=`
out vec4 glFragColor;highp float unpack_depth(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}highp vec4 pack_depth(highp float ndc_z) {highp float depth=ndc_z*0.5+0.5;const highp vec4 bit_shift=vec4(255.0*255.0*255.0,255.0*255.0,255.0,1.0);const highp vec4 bit_mask =vec4(0.0,1.0/255.0,1.0/255.0,1.0/255.0);highp vec4 res=fract(depth*bit_shift);res-=res.xxyz*bit_mask;return res;}
#ifdef INDICATOR_CUTOUT
uniform vec3 u_indicator_cutout_centers;uniform vec4 u_indicator_cutout_params;
#endif
vec4 applyCutout(vec4 color,float height) {
#ifdef INDICATOR_CUTOUT
float verticalFadeRange=u_indicator_cutout_centers.z*0.25;float holeMinOpacity=mix(1.0,u_indicator_cutout_params.x,smoothstep(u_indicator_cutout_centers.z,u_indicator_cutout_centers.z+verticalFadeRange,height));float holeRadius=max(u_indicator_cutout_params.y,0.0);float holeAspectRatio=u_indicator_cutout_params.z;float fadeStart=u_indicator_cutout_params.w;float distA=distance(vec2(gl_FragCoord.x,gl_FragCoord.y*holeAspectRatio),vec2(u_indicator_cutout_centers[0],u_indicator_cutout_centers[1]*holeAspectRatio));return color*min(smoothstep(fadeStart,holeRadius,distA)+holeMinOpacity,1.0);
#else
return color;
#endif
}
#ifdef DEBUG_WIREFRAME
#define HANDLE_WIREFRAME_DEBUG \\
glFragColor=vec4(0.7,0.0,0.0,0.7); \\
gl_FragDepth=gl_FragCoord.z-0.0001;
#else
#define HANDLE_WIREFRAME_DEBUG
#endif
#ifdef RENDER_CUTOFF
uniform highp vec4 u_cutoff_params;in float v_cutoff_opacity;
#endif
vec4 textureLodCustom(sampler2D image,highp vec2 pos,highp vec2 lod_coord) {highp vec2 size=vec2(textureSize(image,0));highp vec2 dx=dFdx(lod_coord.xy*size);highp vec2 dy=dFdy(lod_coord.xy*size);highp float delta_max_sqr=max(dot(dx,dx),dot(dy,dy));highp float lod=0.5*log2(delta_max_sqr);return textureLod(image,pos,lod);}vec4 applyLUT(highp sampler3D lut,vec4 col) {vec3 size=vec3(textureSize(lut,0));vec3 uvw=(col.rbg*float(size-1.0)+0.5)/size;return vec4(texture(lut,uvw).rgb*col.a,col.a);}vec3 applyLUT(highp sampler3D lut,vec3 col) {return applyLUT(lut,vec4(col,1.0)).rgb;}`,Wd=`
#define EXTENT 8192.0
#define RAD_TO_DEG 180.0/PI
#define DEG_TO_RAD PI/180.0
#define GLOBE_RADIUS EXTENT/PI/2.0
float wrap(float n,float min,float max) {float d=max-min;float w=mod(mod(n-min,d)+d,d)+min;return (w==min) ? max : w;}
#ifdef PROJECTION_GLOBE_VIEW
vec3 mercator_tile_position(mat4 matrix,vec2 tile_anchor,vec3 tile_id,vec2 mercator_center) {
#ifndef PROJECTED_POS_ON_VIEWPORT
float tiles=tile_id.z;vec2 mercator=(tile_anchor/EXTENT+tile_id.xy)/tiles;mercator-=mercator_center;mercator.x=wrap(mercator.x,-0.5,0.5);vec4 mercator_tile=vec4(mercator.xy*EXTENT,EXTENT/(2.0*PI),1.0);mercator_tile=matrix*mercator_tile;return mercator_tile.xyz;
#else
return vec3(0.0);
#endif
}vec3 mix_globe_mercator(vec3 globe,vec3 mercator,float t) {return mix(globe,mercator,t);}mat3 globe_mercator_surface_vectors(vec3 pos_normal,vec3 up_dir,float zoom_transition) {vec3 normal=zoom_transition==0.0 ? pos_normal : normalize(mix(pos_normal,up_dir,zoom_transition));vec3 xAxis=normalize(vec3(normal.z,0.0,-normal.x));vec3 yAxis=normalize(cross(normal,xAxis));return mat3(xAxis,yAxis,normal);}
#endif
vec2 unpack_float(const float packedValue) {int packedIntValue=int(packedValue);int v0=packedIntValue/256;return vec2(v0,packedIntValue-v0*256);}vec2 unpack_opacity(const float packedOpacity) {int intOpacity=int(packedOpacity)/2;return vec2(float(intOpacity)/127.0,mod(packedOpacity,2.0));}vec4 decode_color(const vec2 encodedColor) {return vec4(
unpack_float(encodedColor[0])/255.0,unpack_float(encodedColor[1])/255.0
);}float unpack_mix_vec2(const vec2 packedValue,const float t) {return mix(packedValue[0],packedValue[1],t);}vec4 unpack_mix_color(const vec4 packedColors,const float t) {vec4 minColor=decode_color(vec2(packedColors[0],packedColors[1]));vec4 maxColor=decode_color(vec2(packedColors[2],packedColors[3]));return mix(minColor,maxColor,t);}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const vec2 units_to_pixels,const vec2 pos) {vec2 offset=mod(mod(mod(pixel_coord_upper,pattern_size)*256.0,pattern_size)*256.0+pixel_coord_lower,pattern_size);return (units_to_pixels*pos+offset)/pattern_size;}vec2 get_pattern_pos(const vec2 pixel_coord_upper,const vec2 pixel_coord_lower,const vec2 pattern_size,const float tile_units_to_pixels,const vec2 pos) {return get_pattern_pos(pixel_coord_upper,pixel_coord_lower,pattern_size,vec2(tile_units_to_pixels),pos);}float mercatorXfromLng(float lng) {return (180.0+lng)/360.0;}float mercatorYfromLat(float lat) {return (180.0-(RAD_TO_DEG*log(tan(PI/4.0+lat/2.0*DEG_TO_RAD))))/360.0;}vec3 latLngToECEF(vec2 latLng) {latLng=DEG_TO_RAD*latLng;float cosLat=cos(latLng[0]);float sinLat=sin(latLng[0]);float cosLng=cos(latLng[1]);float sinLng=sin(latLng[1]);float sx=cosLat*sinLng*GLOBE_RADIUS;float sy=-sinLat*GLOBE_RADIUS;float sz=cosLat*cosLng*GLOBE_RADIUS;return vec3(sx,sy,sz);}
#ifdef RENDER_CUTOFF
uniform vec4 u_cutoff_params;out float v_cutoff_opacity;
#endif
const vec4 AWAY=vec4(-1000.0,-1000.0,-1000.0,1);const float skirtOffset=24575.0;vec3 decomposeToPosAndSkirt(vec2 posWithComposedSkirt)
{float skirt=float(posWithComposedSkirt.x >=skirtOffset);vec2 pos=posWithComposedSkirt-vec2(skirt*skirtOffset,0.0);return vec3(pos,skirt);}`,eu="in highp vec3 a_pos_3f;uniform lowp mat4 u_matrix;out highp vec3 v_uv;void main() {const mat3 half_neg_pi_around_x=mat3(1.0,0.0, 0.0,0.0,0.0,-1.0,0.0,1.0, 0.0);v_uv=half_neg_pi_around_x*a_pos_3f;vec4 pos=u_matrix*vec4(a_pos_3f,1.0);gl_Position=pos.xyww;}",ca=`
#define ELEVATION_SCALE 7.0
#define ELEVATION_OFFSET 450.0
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_tl_up;uniform vec3 u_tile_tr_up;uniform vec3 u_tile_br_up;uniform vec3 u_tile_bl_up;uniform float u_tile_up_scale;vec3 elevationVector(vec2 pos) {vec2 uv=pos/EXTENT;vec3 up=normalize(mix(
mix(u_tile_tl_up,u_tile_tr_up,uv.xxx),mix(u_tile_bl_up,u_tile_br_up,uv.xxx),uv.yyy));return up*u_tile_up_scale;}
#else
vec3 elevationVector(vec2 pos) { return vec3(0,0,1); }
#endif
#ifdef TERRAIN
uniform highp sampler2D u_dem;uniform highp sampler2D u_dem_prev;uniform vec2 u_dem_tl;uniform vec2 u_dem_tl_prev;uniform float u_dem_scale;uniform float u_dem_scale_prev;uniform float u_dem_size;uniform float u_dem_lerp;uniform float u_exaggeration;uniform float u_meter_to_dem;uniform mat4 u_label_plane_matrix_inv;vec4 tileUvToDemSample(vec2 uv,float dem_size,float dem_scale,vec2 dem_tl) {vec2 pos=dem_size*(uv*dem_scale+dem_tl)+1.0;vec2 f=fract(pos);return vec4((pos-f+0.5)/(dem_size+2.0),f);}float currentElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale+u_dem_tl)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale,u_dem_tl);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(dd,0)).r;float bl=texture(u_dem,pos+vec2(0,dd)).r;float br=texture(u_dem,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}float prevElevation(vec2 apos) {
#ifdef TERRAIN_DEM_FLOAT_FORMAT
vec2 pos=(u_dem_size*(apos/8192.0*u_dem_scale_prev+u_dem_tl_prev)+1.5)/(u_dem_size+2.0);return u_exaggeration*texture(u_dem_prev,pos).r;
#else
float dd=1.0/(u_dem_size+2.0);vec4 r=tileUvToDemSample(apos/8192.0,u_dem_size,u_dem_scale_prev,u_dem_tl_prev);vec2 pos=r.xy;vec2 f=r.zw;float tl=texture(u_dem_prev,pos).r;float tr=texture(u_dem_prev,pos+vec2(dd,0)).r;float bl=texture(u_dem_prev,pos+vec2(0,dd)).r;float br=texture(u_dem_prev,pos+vec2(dd,dd)).r;return u_exaggeration*mix(mix(tl,tr,f.x),mix(bl,br,f.x),f.y);
#endif
}
#ifdef TERRAIN_VERTEX_MORPHING
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
float nextElevation=currentElevation(apos);float prevElevation=prevElevation(apos);return mix(prevElevation,nextElevation,u_dem_lerp);}
#else
float elevation(vec2 apos) {
#ifdef ZERO_EXAGGERATION
return 0.0;
#endif
return currentElevation(apos);}
#endif
vec4 fourSample(vec2 pos,vec2 off) {float tl=texture(u_dem,pos).r;float tr=texture(u_dem,pos+vec2(off.x,0.0)).r;float bl=texture(u_dem,pos+vec2(0.0,off.y)).r;float br=texture(u_dem,pos+off).r;return vec4(tl,tr,bl,br);}float flatElevation(vec2 pack) {vec2 apos=floor(pack/8.0);vec2 span=10.0*(pack-apos*8.0);vec2 uvTex=(apos-vec2(1.0,1.0))/8190.0;float size=u_dem_size+2.0;float dd=1.0/size;vec2 pos=u_dem_size*(uvTex*u_dem_scale+u_dem_tl)+1.0;vec2 f=fract(pos);pos=(pos-f+0.5)*dd;vec4 h=fourSample(pos,vec2(dd));float z=mix(mix(h.x,h.y,f.x),mix(h.z,h.w,f.x),f.y);vec2 w=floor(0.5*(span*u_meter_to_dem-1.0));vec2 d=dd*w;h=fourSample(pos-d,2.0*d+vec2(dd));vec4 diff=abs(h.xzxy-h.ywzw);vec2 slope=min(vec2(0.25),u_meter_to_dem*0.5*(diff.xz+diff.yw)/(2.0*w+vec2(1.0)));vec2 fix=slope*span;float base=z+max(fix.x,fix.y);return u_exaggeration*base;}float elevationFromUint16(float word) {return u_exaggeration*(word/ELEVATION_SCALE-ELEVATION_OFFSET);}
#else
float elevation(vec2 pos) { return 0.0; }
#endif
#ifdef DEPTH_OCCLUSION
uniform highp sampler2D u_depth;uniform highp vec2 u_depth_size_inv;uniform highp vec2 u_depth_range_unpack;uniform highp float u_occluder_half_size;uniform highp float u_occlusion_depth_offset;
#ifdef DEPTH_D24
float unpack_depth(float depth) {return depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}vec4 unpack_depth4(vec4 depth) {return depth*u_depth_range_unpack.x+vec4(u_depth_range_unpack.y);}
#else
highp float unpack_depth_rgba(vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded(vec4 frag) {vec3 coord=frag.xyz/frag.w;
#ifdef DEPTH_D24
float depth=unpack_depth(texture(u_depth,(coord.xy+1.0)*0.5).r);
#else
float depth=unpack_depth_rgba(texture(u_depth,(coord.xy+1.0)*0.5));
#endif
return coord.z+u_occlusion_depth_offset > depth;}highp vec4 getCornerDepths(vec2 coord) {highp vec3 df=vec3(u_occluder_half_size*u_depth_size_inv,0.0);highp vec2 uv=0.5*coord.xy+0.5;
#ifdef DEPTH_D24
highp vec4 depth=vec4(
texture(u_depth,uv-df.xz).r,texture(u_depth,uv+df.xz).r,texture(u_depth,uv-df.zy).r,texture(u_depth,uv+df.zy).r
);depth=unpack_depth4(depth);
#else
highp vec4 depth=vec4(
unpack_depth_rgba(texture(u_depth,uv-df.xz)),unpack_depth_rgba(texture(u_depth,uv+df.xz)),unpack_depth_rgba(texture(u_depth,uv-df.zy)),unpack_depth_rgba(texture(u_depth,uv+df.zy))
);
#endif
return depth;}highp float occlusionFadeMultiSample(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec2 uv=0.5*coord.xy+0.5;int NX=3;int NY=4;highp vec2 df=u_occluder_half_size*u_depth_size_inv;highp vec2 oneStep=2.0*u_occluder_half_size*u_depth_size_inv/vec2(NX-1,NY-1);highp float res=0.0;for (int y=0; y < NY;++y) {for (int x=0; x < NX;++x) {
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depth,uv-df+vec2(float(x)*oneStep.x,float(y)*oneStep.y)));
#endif
res+=1.0-clamp(300.0*(coord.z+u_occlusion_depth_offset-depth),0.0,1.0);}}res=clamp(2.0*res/float(NX*NY)-0.5,0.0,1.0);return res;}highp float occlusionFade(vec4 frag) {highp vec3 coord=frag.xyz/frag.w;highp vec4 depth=getCornerDepths(coord.xy);return dot(vec4(0.25),vec4(1.0)-clamp(300.0*(vec4(coord.z+u_occlusion_depth_offset)-depth),0.0,1.0));}
#else
bool isOccluded(vec4 frag) { return false; }highp float occlusionFade(vec4 frag) { return 1.0; }highp float occlusionFadeMultiSample(vec4 frag) { return 1.0; }
#endif//DEPTH_OCCLUSION`,Yd=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump mat4 u_fog_matrix;out vec3 v_fog_pos;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}vec3 fog_position(vec3 pos) {return (u_fog_matrix*vec4(pos,1.0)).xyz;}vec3 fog_position(vec2 pos) {return fog_position(vec3(pos,0.0));}float fog(vec3 pos) {float depth=length(pos);float opacity=fog_opacity(fog_range(depth));return opacity*fog_horizon_blending(pos/depth);}
#endif`,Sa=`#ifdef FOG
uniform mediump vec4 u_fog_color;uniform mediump vec2 u_fog_range;uniform mediump float u_fog_horizon_blend;uniform mediump vec2 u_fog_vertical_limit;uniform mediump float u_fog_temporal_offset;in vec3 v_fog_pos;uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform highp vec2 u_viewport;uniform float u_globe_transition;uniform int u_is_globe;float fog_range(float depth) {return (depth-u_fog_range[0])/(u_fog_range[1]-u_fog_range[0]);}float fog_horizon_blending(vec3 camera_dir) {float t=max(0.0,camera_dir.z/u_fog_horizon_blend);return u_fog_color.a*exp(-3.0*t*t);}float fog_opacity(float t) {const float decay=6.0;float falloff=1.0-min(1.0,exp(-decay*t));falloff*=falloff*falloff;return u_fog_color.a*min(1.0,1.00747*falloff);}float globe_glow_progress() {highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float sdf=length(closest_point-u_globe_pos)/u_globe_radius;return sdf+PI*0.5;}float fog_opacity(vec3 pos) {float depth=length(pos);return fog_opacity(fog_range(depth));}vec3 fog_apply(vec3 color,vec3 pos,float opacity_limit) {float depth=length(pos);float opacity;if (u_is_globe==1) {float glow_progress=globe_glow_progress();float t=mix(glow_progress,depth,u_globe_transition);opacity=fog_opacity(fog_range(t));} else {opacity=fog_opacity(fog_range(depth));opacity*=fog_horizon_blending(pos/depth);}return mix(color,u_fog_color.rgb,min(opacity,opacity_limit));}vec3 fog_apply(vec3 color,vec3 pos) {return fog_apply(color,pos,1.0);}vec4 fog_apply_from_vert(vec4 color,float fog_opac) {float alpha=EPSILON+color.a;color.rgb=mix(color.rgb/alpha,u_fog_color.rgb,fog_opac)*alpha;return color;}vec3 fog_apply_sky_gradient(vec3 camera_ray,vec3 sky_color) {float horizon_blend=fog_horizon_blending(normalize(camera_ray));return mix(sky_color,u_fog_color.rgb,horizon_blend);}vec4 fog_apply_premultiplied(vec4 color,vec3 pos) {float alpha=EPSILON+color.a;color.rgb=fog_apply(color.rgb/alpha,pos)*alpha;return color;}vec4 fog_apply_premultiplied(vec4 color,vec3 pos,float heightMeters) {float verticalProgress=(u_fog_vertical_limit.x > 0.0 || u_fog_vertical_limit.y > 0.0) ? smoothstep(u_fog_vertical_limit.x,u_fog_vertical_limit.y,heightMeters) : 0.0;float opacityLimit=1.0-smoothstep(0.9,1.0,fog_opacity(pos));return mix(fog_apply_premultiplied(color,pos),color,min(verticalProgress,opacityLimit));}vec3 fog_dither(vec3 color) {return color;}vec4 fog_dither(vec4 color) {return vec4(fog_dither(color.rgb),color.a);}
#endif`,io=`#ifdef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;const vec4 NODATA=vec4(1);ivec4 _raTexLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}vec2 _raTexLinearMix(highp vec2 fxy,highp vec4 colorMix,highp float colorOffset,highp vec4 t00,highp vec4 t10,highp vec4 t01,highp vec4 t11) {vec2 c00=t00==NODATA ? vec2(0) : vec2(colorOffset+dot(t00,colorMix),1);vec2 c10=t10==NODATA ? vec2(0) : vec2(colorOffset+dot(t10,colorMix),1);vec2 c01=t01==NODATA ? vec2(0) : vec2(colorOffset+dot(t01,colorMix),1);vec2 c11=t11==NODATA ? vec2(0) : vec2(colorOffset+dot(t11,colorMix),1);return mix(mix(c01,c11,fxy.x),mix(c00,c10,fxy.x),fxy.y);}vec2 raTexture2D_image0_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image0,c.yz,0),texelFetch(u_image0,c.xz,0),texelFetch(u_image0,c.yw,0),texelFetch(u_image0,c.xw,0)
);}vec2 raTexture2D_image1_linear(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec2 fxy;ivec4 c=_raTexLinearCoord(texCoord,texResolution,fxy);return _raTexLinearMix(fxy,colorMix,colorOffset,texelFetch(u_image1,c.yz,0),texelFetch(u_image1,c.xz,0),texelFetch(u_image1,c.yw,0),texelFetch(u_image1,c.xw,0)
);}vec2 raTexture2D_image0_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image0,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}vec2 raTexture2D_image1_nearest(highp vec2 texCoord,highp vec2 texResolution,highp vec4 colorMix,highp float colorOffset) {vec4 t=texelFetch(u_image1,ivec2(texCoord*texResolution),0);return t==NODATA ? vec2(0) : vec2(colorOffset+dot(t,colorMix),1);}
#endif`,uc=`#ifdef RASTER_ARRAY
uniform sampler2D u_velocity;uniform mediump vec2 u_velocity_res;uniform mediump float u_max_speed;const vec4 NO_DATA=vec4(1);const vec2 INVALID_VELOCITY=vec2(-1);uniform highp vec2 u_uv_offset;uniform highp float u_data_offset;uniform highp vec2 u_data_scale;ivec4 rasterArrayLinearCoord(highp vec2 texCoord,highp vec2 texResolution,out highp vec2 fxy) {texCoord=texCoord*texResolution-0.5;fxy=fract(texCoord);texCoord-=fxy;return ivec4(texCoord.xxyy+vec2(1.5,0.5).xyxy);}highp vec2 lookup_velocity(highp vec2 uv) {uv=u_uv_offset.x+u_uv_offset.y*uv;highp vec2 fxy;ivec4 c=rasterArrayLinearCoord(uv,u_velocity_res,fxy);highp vec4 tl=texelFetch(u_velocity,c.yz,0);highp vec4 tr=texelFetch(u_velocity,c.xz,0);highp vec4 bl=texelFetch(u_velocity,c.yw,0);highp vec4 br=texelFetch(u_velocity,c.xw,0);if (tl==NO_DATA) {return INVALID_VELOCITY;}if (tr==NO_DATA) {return INVALID_VELOCITY;}if (bl==NO_DATA) {return INVALID_VELOCITY;}if (br==NO_DATA) {return INVALID_VELOCITY;}highp vec4 t=mix(mix(bl,br,fxy.x),mix(tl,tr,fxy.x),fxy.y);highp vec2 velocity=u_data_offset+vec2(dot(t.rg,u_data_scale),dot(t.ba,u_data_scale));velocity.y=-velocity.y;velocity/=max(u_max_speed,length(velocity));return velocity;}
#endif
uniform highp float u_particle_pos_scale;uniform highp vec2 u_particle_pos_offset;highp vec4 pack_pos_to_rgba(highp vec2 p) {highp vec2 v=(p+u_particle_pos_offset)/u_particle_pos_scale;highp vec4 r=vec4(v.x,fract(v.x*255.0),v.y,fract(v.y*255.0));return vec4(r.x-r.y/255.0,r.y,r.z-r.w/255.0,r.w);}highp vec2 unpack_pos_from_rgba(highp vec4 v) {v=floor(v*255.0+0.5)/255.0;highp vec2 p=vec2(v.x+(v.y/255.0),v.z+(v.w/255.0));return u_particle_pos_scale*p-u_particle_pos_offset;}`,Bt=`#ifdef RENDER_SHADOWS
uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_normal_offset;vec3 shadow_normal_offset(vec3 normal) {float tileInMeters=u_shadow_normal_offset[0];vec3 n=vec3(-normal.xy,tileInMeters*normal.z);float dotScale=min(1.0-dot(normal,u_shadow_direction),1.0)*0.5+0.5;return n*dotScale;}vec3 shadow_normal_offset_model(vec3 normal) {vec3 transformed_normal=vec3(-normal.xy,normal.z);float NDotL=dot(normalize(transformed_normal),u_shadow_direction);float dotScale=min(1.0-NDotL,1.0)*0.5+0.5;return normal*dotScale;}float shadow_normal_offset_multiplier0() {return u_shadow_normal_offset[1];}float shadow_normal_offset_multiplier1() {return u_shadow_normal_offset[2];}
#endif//RENDER_SHADOWS`,kh=`#ifdef RENDER_SHADOWS
precision highp sampler2DShadow;uniform sampler2DShadow u_shadowmap_0;uniform sampler2DShadow u_shadowmap_1;uniform float u_shadow_intensity;uniform float u_shadow_map_resolution;uniform float u_shadow_texel_size;uniform highp vec3 u_shadow_normal_offset;uniform vec2 u_fade_range;uniform mediump vec3 u_shadow_direction;uniform highp vec3 u_shadow_bias;float shadow_sample(sampler2DShadow shadowmap,highp vec3 pos,highp float bias) {
#ifdef CLIP_ZERO_TO_ONE
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z-bias);
#else
highp vec3 coord=vec3(pos.xy*0.5+0.5,pos.z*0.5+0.5-bias);
#endif
return texture(shadowmap,coord);}float shadow_occlusion(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,highp float bias) {light_view_pos0.xyz/=light_view_pos0.w;
#ifdef SHADOWS_SINGLE_CASCADE
vec2 abs_bounds=abs(light_view_pos0.xy);if (abs_bounds.x >=1.0 || abs_bounds.y >=1.0) {return 0.0;}return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);
#else
light_view_pos1.xyz/=light_view_pos1.w;vec4 abs_bounds=abs(vec4(light_view_pos0.xy,light_view_pos1.xy));if (abs_bounds.x < 1.0 && abs_bounds.y < 1.0) {return shadow_sample(u_shadowmap_0,light_view_pos0.xyz,bias);}if (abs_bounds.z >=1.0 || abs_bounds.w >=1.0) {return 0.0;}float occlusion1=shadow_sample(u_shadowmap_1,light_view_pos1.xyz,bias);return clamp(mix(occlusion1,0.0,smoothstep(u_fade_range.x,u_fade_range.y,view_depth)),0.0,1.0);
#endif
}highp float calculate_shadow_bias(float NDotL) {
#ifdef NORMAL_OFFSET
return 0.5*u_shadow_bias.x;
#else
return 0.5*(u_shadow_bias.x+clamp(u_shadow_bias.y*tan(acos(NDotL)),0.0,u_shadow_bias.z));
#endif
}float shadowed_light_factor_normal(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_opacity(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth,float shadow_opacity) {float NDotL=dot(N,u_shadow_direction);float bias=calculate_shadow_bias(NDotL);float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias)*shadow_opacity;return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}float shadowed_light_factor_normal_unbiased(vec3 N,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float NDotL=dot(N,u_shadow_direction);float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return mix(0.0,(1.0-(u_shadow_intensity*occlusion))*NDotL,step(0.0,NDotL));}highp vec2 compute_receiver_plane_depth_bias(highp vec3 pos_dx,highp vec3 pos_dy)
{highp vec2 biasUV=vec2(
pos_dy.y*pos_dx.z-pos_dx.y*pos_dy.z,pos_dx.x*pos_dy.z-pos_dy.x*pos_dx.z);biasUV*=1.0/((pos_dx.x*pos_dy.y)-(pos_dx.y*pos_dy.x));return biasUV;}float shadowed_light_factor_plane_bias(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {highp vec3 light_view_pos0_xyz=light_view_pos0.xyz/light_view_pos0.w*0.5+0.5;highp vec3 light_view_pos0_ddx=dFdx(light_view_pos0_xyz);highp vec3 light_view_pos0_ddy=dFdy(light_view_pos0_xyz);highp vec2 plane_depth_bias=compute_receiver_plane_depth_bias(light_view_pos0_ddx,light_view_pos0_ddy);highp float bias=dot(vec2(u_shadow_texel_size,u_shadow_texel_size),plane_depth_bias)+0.0001;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadowed_light_factor(highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=0.0;float occlusion=shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);return 1.0-(u_shadow_intensity*occlusion);}float shadow_occlusion(float ndotl,highp vec4 light_view_pos0,highp vec4 light_view_pos1,float view_depth) {float bias=calculate_shadow_bias(ndotl);return shadow_occlusion(light_view_pos0,light_view_pos1,view_depth,bias);}
#endif`;const hc=[];As(Wf,hc),As(Wd,hc),As(Zd,hc);const tu={"_prelude_fog.vertex.glsl":Yd,"_prelude_terrain.vertex.glsl":ca,"_prelude_shadow.vertex.glsl":Bt,"_prelude_fog.fragment.glsl":Sa,"_prelude_shadow.fragment.glsl":kh,"_prelude_lighting.glsl":`
#ifdef LIGHTING_3D_MODE
uniform mediump vec3 u_lighting_ambient_color;uniform mediump vec3 u_lighting_directional_dir;uniform mediump vec3 u_lighting_directional_color;uniform mediump vec3 u_ground_radiance;float calculate_ambient_directional_factor(vec3 normal) {float NdotL=dot(normal,u_lighting_directional_dir);const float factor_reduction_max=0.3;float dir_luminance=dot(u_lighting_directional_color,vec3(0.2126,0.7152,0.0722));float directional_factor_min=1.0-factor_reduction_max*min(dir_luminance,1.0);float ambient_directional_factor=mix(directional_factor_min,1.0,min((NdotL+1.0),1.0));const float vertical_factor_min=0.92;float vertical_factor=mix(vertical_factor_min,1.0,normal.z*0.5+0.5);return vertical_factor*ambient_directional_factor;}vec3 linearProduct(vec3 srgbIn,vec3 k) {return srgbIn*pow(k,vec3(1./2.2));}vec3 apply_lighting(vec3 color,vec3 normal,float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return linearProduct(color,ambient_contrib+directional_contrib);}vec4 apply_lighting(vec4 color,vec3 normal,float dir_factor) {return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting(vec3 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return apply_lighting(color.rgb,normal,dir_factor);}vec4 apply_lighting(vec4 color,vec3 normal) {float dir_factor=max(dot(normal,u_lighting_directional_dir),0.0);return vec4(apply_lighting(color.rgb,normal,dir_factor),color.a);}vec3 apply_lighting_ground(vec3 color) {return color*u_ground_radiance;}vec4 apply_lighting_ground(vec4 color) {return vec4(apply_lighting_ground(color.rgb),color.a);}float calculate_NdotL(vec3 normal) {const float ext=0.70710678118;return (clamp(dot(normal,u_lighting_directional_dir),-ext,1.0)+ext)/(1.0+ext);}vec4 apply_lighting_with_emission_ground(vec4 color,float emissive_strength) {return mix(apply_lighting_ground(color),color,emissive_strength);}vec3 compute_flood_lighting(vec3 flood_light_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=flood_light_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);float occlusion_ramp=smoothstep(0.0,0.2,1.0-occlusion);return mix(fully_occluded_color,flood_light_color,occlusion_ramp);}vec3 compute_emissive_draped(vec3 unlit_color,float fully_occluded_factor,float occlusion,vec3 ground_shadow_factor) {vec3 fully_occluded_color=unlit_color*mix(ground_shadow_factor,vec3(1.0),fully_occluded_factor);return mix(fully_occluded_color,unlit_color,1.0-occlusion);}
#endif//LIGHTING_3D_MODE`,"_prelude_raster_array.glsl":io,"_prelude_raster_particle.glsl":uc},bl={};Nr("",ca),Nr(Sa,Yd),Nr(kh,Bt),Nr(io,""),Nr(uc,"");const Nh=Nr(Zd,Wd),os=Wf;var fc={background:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec4 u_color;uniform float u_opacity;
#ifdef LIGHTING_3D_MODE
in vec4 v_color;
#endif
void main() {vec4 out_color;
#ifdef LIGHTING_3D_MODE
out_color=v_color;
#else
out_color=u_color;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_lighting.glsl"
in vec2 a_pos;uniform mat4 u_matrix;
#ifdef LIGHTING_3D_MODE
uniform mediump vec4 u_color;out vec4 v_color;uniform float u_emissive_strength;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0,1);
#ifdef LIGHTING_3D_MODE
v_color=apply_lighting_with_emission_ground(u_color,u_emissive_strength);
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),backgroundPattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_pattern_tl;uniform vec2 u_pattern_br;uniform vec2 u_texsize;uniform float u_opacity;uniform float u_emissive_strength;uniform sampler2D u_image;in highp vec2 v_pos;void main() {highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(u_pattern_tl/u_texsize,u_pattern_br/u_texsize,imagecoord);vec4 out_color=textureLodCustom(u_image,pos,v_pos);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pattern_size;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform vec2 u_pattern_units_to_pixels;in vec2 a_pos;out highp vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,u_pattern_size,u_pattern_units_to_pixels,a_pos);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),building:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
const float window_depth=0.5;const float ao_radius=0.2;in vec4 v_color;in highp vec3 v_normal;in highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
in lowp float v_faux_facade;in highp float v_faux_facade_ed;in highp vec2 v_faux_facade_window;in highp vec2 v_faux_facade_floor;in highp vec2 v_faux_facade_range;in highp float v_aspect;in highp vec3 v_tbn_0;in highp vec3 v_tbn_1;in highp vec3 v_tbn_2;in highp vec4 v_faux_color_emissive;uniform float u_faux_facade_ao_intensity;
#endif
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
uniform lowp float u_opacity;uniform vec3 u_camera_pos;uniform highp float u_tile_to_meter;uniform float u_facade_emissive_chance;vec3 linearTosRGB(in vec3 color) {return pow(color,vec3(1./2.2));}
#ifdef BUILDING_FAUX_FACADE
float hash12(in vec2 p) {vec3 p3 =fract(vec3(p.xyx)*0.1031);p3+=dot(p3,p3.yzx+33.33);return fract((p3.x+p3.y)*p3.z);}float min3(in vec3 v) {return min(min(v.x,v.y),v.z);}vec2 get_uv_mask_id(in vec2 q,out float mask,out vec2 id) {vec2 p=q;mask=step(v_faux_facade_range.x,p.y)*step(p.y,v_faux_facade_range.y);p.y=p.y-v_faux_facade_range.x;vec2 uv=modf(p/v_faux_facade_floor,id);vec4 d=(v_faux_facade_floor.xyxy+vec4(-v_faux_facade_window,v_faux_facade_window))*0.5;vec4 edge=d/v_faux_facade_floor.xyxy;vec2 m=step(edge.xy,uv)*step(uv,edge.zw);mask*=m.x*m.y;uv-=vec2(0.5);uv*=vec2(0.5)/(vec2(0.5)-edge.xy);uv+=vec2(0.5);return uv;}float ray_unit_box(in vec3 ray_o,in vec3 ray_d,in vec3 bmin,in vec3 bmax) {vec3 planes=mix(bmin,bmax,step(0.0,ray_d));vec3 t=(planes-ray_o)/ray_d;return min3(t);}float get_emissive(in vec2 id) {if (u_facade_emissive_chance > 0.0) {return (step(hash12(id),u_facade_emissive_chance)+0.05)*v_faux_color_emissive.a;}return 0.0;}vec3 get_shade_info(in vec3 v,in vec3 v_normalized,in vec3 color,in vec2 id,in mat3 tbn,inout vec3 out_normal,inout float out_emissive) {vec3 out_color=color;vec3 abs_v=abs(v_normalized);bool x_major=abs_v.x >=abs_v.y && abs_v.x >=abs_v.z;bool y_major=abs_v.y >=abs_v.x && abs_v.y >=abs_v.z;bool z_major=abs_v.z >=abs_v.x && abs_v.z >=abs_v.y;
#if 0
if (x_major) {out_color=v.x > 0.0 ? vec3(1.0,0.0,0.0) : vec3(0.0,1.0,1.0);} else if (y_major) {out_color=v.y > 0.0 ? vec3(0.0,1.0,0.0) : vec3(1.0,0.0,1.0);} else if (z_major) {out_color=v.z > 0.0 ? vec3(0.0,0.0,1.0) : vec3(1.0,1.0,0.0);}out_emissive=1.0;
#else
if (x_major) {out_normal=sign(v.x)*tbn[0];} else if (y_major) {out_normal=vec3(0.0,0.0,-sign(v.y));} else if (z_major) {out_color=v_faux_color_emissive.rgb;out_emissive=v.z <=0.0 ? get_emissive(id) : out_emissive;}float ao=1.0;if (u_faux_facade_ao_intensity > 0.0) {vec4 ao_range=v_faux_facade_window.xxyy*0.5-vec4(0,ao_radius,0,ao_radius);vec2 ao_range_z=vec2(window_depth*0.5)-vec2(0.0,ao_radius);if (x_major || y_major) {ao*=smoothstep(-ao_range_z.x,-ao_range_z.y,v.z);} else if (z_major) {ao*=smoothstep(-ao_range.x,-ao_range.y,v.x)*(1.0-smoothstep(ao_range.y,ao_range.x,v.x));ao*=smoothstep(-ao_range.z,-ao_range.w,v.y)*(1.0-smoothstep(ao_range.w,ao_range.z,v.y));}ao=mix(1.0,min(1.0,ao+0.25),u_faux_facade_ao_intensity);}out_color*=ao;
#endif
return out_color;}
#endif
vec3 apply_lighting_linear(in vec3 color,in vec3 normal,in float dir_factor) {float ambient_directional_factor=calculate_ambient_directional_factor(normal);vec3 ambient_contrib=ambient_directional_factor*u_lighting_ambient_color;vec3 directional_contrib=u_lighting_directional_color*dir_factor;return color*(ambient_contrib+directional_contrib);}void main() {vec3 normal=normalize(v_normal);vec3 base_color=v_color.rgb;float emissive=v_color.a;
#ifdef BUILDING_FAUX_FACADE
if (v_faux_facade > 0.0) {mat3 tbn=mat3(v_tbn_0,v_tbn_1,v_tbn_2);vec3 v=vec3(v_pos.xy,v_pos.z/u_tile_to_meter)-u_camera_pos;vec3 view_tangent=transpose(tbn)*v;vec2 q=vec2(v_faux_facade_ed,v_pos.z);float mask=0.0;vec2 id=vec2(0.0);vec2 uv=get_uv_mask_id(q,mask,id);uv*=v_faux_facade_window;vec3 bmin=vec3(0.0,0.0,-window_depth);vec3 bmax=bmin+vec3(v_faux_facade_window,window_depth);vec3 ray_o=vec3(uv,0.0);vec3 ray_d=normalize(view_tangent);float t_min=ray_unit_box(ray_o,ray_d,bmin,bmax);vec3 hit=ray_o+t_min*ray_d;vec3 r=vec3(v_faux_facade_window,-window_depth);hit-=r*0.5;vec3 normalized=hit/r;vec3 out_normal=normal;float out_emissive=emissive;vec3 room_color=get_shade_info(hit,normalized,base_color,id,tbn,out_normal,out_emissive);base_color=mix(base_color,room_color,mask);normal=mix(normal,out_normal,mask);emissive=mix(emissive,out_emissive,mask);}
#endif
vec4 color=vec4(base_color,1.0);vec3 xy_flipped_normal=vec3(-normal.xy,normal.z);float shadowed_lighting_factor=0.0;
#ifdef RENDER_SHADOWS
shadowed_lighting_factor=shadowed_light_factor_normal(xy_flipped_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
shadowed_lighting_factor=dot(normal,u_lighting_directional_dir);
#endif
color.rgb=apply_lighting_linear(color.rgb,xy_flipped_normal,shadowed_lighting_factor);color.rgb=mix(color.rgb,base_color.rgb,emissive);
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,v_pos.z));
#endif
color.rgb=linearTosRGB(color.rgb);color*=u_opacity;
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_pos.z);
#endif
glFragColor=color; 
#ifdef DEBUG_SHOW_NORMALS
color.rgb=xy_flipped_normal*0.5+vec3(0.5,0.5,0.5);color.a=1.0;glFragColor=color;
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;in vec3 a_normal_3;in vec3 a_centroid_3;in vec4 a_faux_facade_data;in vec2 a_faux_facade_vertical_range;uniform mat4 u_matrix;uniform mat4 u_normal_matrix;uniform highp float u_tile_to_meter;out vec4 v_color;out vec3 v_normal;out highp vec3 v_pos;
#ifdef BUILDING_FAUX_FACADE
out lowp float v_faux_facade;out highp float v_faux_facade_ed;out highp vec2 v_faux_facade_window;out highp vec2 v_faux_facade_floor;out highp vec2 v_faux_facade_range;out highp float v_aspect;out highp vec3 v_tbn_0;out highp vec3 v_tbn_1;out highp vec3 v_tbn_2;out highp vec4 v_faux_color_emissive;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
const float MAX_UINT_16=65535.0;const float MAX_INT_16=32767.0;const float MAX_UINT_8=255.0;const float TWO_POW_8=256.0;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#ifdef BUILDING_FAUX_FACADE
mat3 get_tbn(in vec3 normal) {const vec3 bitangent=vec3(0.0,0.0,1.0);vec3 tangent=normalize(vec3(normal.y,-normal.x,0.0));return mat3(tangent,bitangent,normal);}
#endif
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 faux_facade_color_emissive
void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute-custom highp vec2 faux_facade_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);v_color=vec4(sRGBToLinear(color_emissive.rgb),color_emissive.a);vec3 a_normal_3f=a_normal_3/MAX_INT_16;v_normal=vec3(u_normal_matrix*vec4(a_normal_3f,0.0));float hidden=0.0;
#ifdef BUILDING_FAUX_FACADE
v_faux_facade=a_faux_facade_data.x;if (v_faux_facade > 0.0) {v_faux_facade_ed=a_faux_facade_data.x *u_tile_to_meter;float window_x_perc=floor(a_faux_facade_data.y/TWO_POW_8);float window_y_perc=a_faux_facade_data.y-TWO_POW_8*window_x_perc;vec2 window_perc=vec2(window_x_perc,window_y_perc)/MAX_UINT_8;v_faux_facade_floor=(a_faux_facade_data.zw/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_faux_facade_window=window_perc*v_faux_facade_floor;v_faux_facade_range=(a_faux_facade_vertical_range/MAX_UINT_16*EXTENT)*u_tile_to_meter;v_aspect=v_faux_facade_window.x/v_faux_facade_window.y;mat3 tbn=get_tbn(normalize(v_normal));v_tbn_0=tbn[0];v_tbn_1=tbn[1];v_tbn_2=tbn[2];v_faux_color_emissive=decode_color(faux_facade_color_emissive);v_faux_color_emissive.rgb=sRGBToLinear(v_faux_color_emissive.rgb);}
#endif
v_pos=a_pos_3f;
#ifdef RENDER_CUTOFF
vec4 ground=u_matrix*vec4(a_centroid_3,1.0);v_cutoff_opacity=cutoff_opacity(u_cutoff_params,ground.z);hidden=float(v_cutoff_opacity==0.0);v_pos.z*=v_cutoff_opacity;
#endif
#ifdef RENDER_SHADOWS
vec3 shadow_pos=v_pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset_model(v_normal);shadow_pos+=offset*shadow_normal_offset_multiplier0();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shadow_pos,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(shadow_pos,1.0);v_depth_shadows=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(v_pos);
#endif
gl_Position=mix(u_matrix*vec4(v_pos,1),AWAY,hidden);}`),buildingBloom:Nr(`in vec4 v_color_emissive;
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
float saturate(float val) {return clamp(val,0.0,1.0);}void main() {float emission=v_color_emissive.a;float opacity=1.0;
#ifdef HAS_ATTRIBUTE_a_bloom_attenuation
float distance=length(vec2(1.3*max(0.0,abs(bloom_attenuation.x)-bloom_attenuation.z),bloom_attenuation.y));distance+= mix(0.5,0.0,clamp(emission-1.0,0.0,1.0));opacity*=saturate(1.0-distance*distance);
#endif
glFragColor=vec4(v_color_emissive.rgb,1.0)*opacity;}`,`in vec3 a_pos_3f;
#pragma mapbox: define-attribute-vertex-shader-only highp vec2 part_color_emissive
#pragma mapbox: define-attribute highp vec4 bloom_attenuation
out vec4 v_color_emissive;uniform mat4 u_matrix;vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute-custom highp vec2 part_color_emissive
#pragma mapbox: initialize-attribute highp vec4 bloom_attenuation
#ifdef HAS_ATTRIBUTE_a_part_color_emissive
vec4 color_emissive=decode_color(part_color_emissive);float part_emissive=color_emissive.a*5.0;v_color_emissive=vec4(sRGBToLinear(color_emissive.rgb),part_emissive);
#else
v_color_emissive=vec4(1.0);
#endif
gl_Position=u_matrix*vec4(a_pos_3f,1.0);}`),buildingDepth:Nr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,"in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;void main() {gl_Position=u_matrix*vec4(a_pos_3f,1.0);v_depth=gl_Position.z/gl_Position.w;}"),circle:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec3 v_data;in float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
uniform float u_emissive_strength;void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=v_data.xy;float blur_positive=blur < 0.0 ? 0.0 : 1.0;lowp float antialiasblur=v_data.z;float extrude_length=length(extrude)+antialiasblur*(1.0-blur_positive);float antialiased_blur=-max(abs(blur),antialiasblur);float antialiase_blur_opacity=smoothstep(0.0,antialiasblur,extrude_length-1.0);float opacity_t=blur_positive==1.0 ? 
smoothstep(0.0,-antialiased_blur,1.0-extrude_length) : 
smoothstep(antialiased_blur,0.0,extrude_length-1.0)-antialiase_blur_opacity;float color_t=stroke_width < 0.01 ? 0.0 : smoothstep(
antialiased_blur,0.0,extrude_length-radius/(radius+stroke_width)
);vec4 out_color=mix(color*opacity,stroke_color*stroke_opacity,color_t);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#endif
#ifdef FOG
out_color=fog_apply_premultiplied(out_color,v_fog_pos);
#endif
glFragColor=out_color*(v_visibility*opacity_t);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define NUM_VISIBILITY_RINGS 2
#define INV_SQRT2 0.70710678
#define ELEVATION_BIAS 0.0001
#define NUM_SAMPLES_PER_RING 16
uniform mat4 u_matrix;uniform mat2 u_extrude_scale;uniform lowp float u_device_pixel_ratio;uniform highp float u_camera_to_center_distance;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
#ifdef ELEVATED_ROADS
in float a_circle_z_offset;
#endif
out vec3 v_data;out float v_visibility;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump float radius
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp vec4 stroke_color
#pragma mapbox: define mediump float stroke_width
#pragma mapbox: define lowp float stroke_opacity
vec2 calc_offset(vec2 extrusion,float radius,float stroke_width, float view_scale) {return extrusion*(radius+stroke_width)*u_extrude_scale*view_scale;}float cantilevered_elevation(vec2 pos,float radius,float stroke_width,float view_scale) {vec2 c1=pos+calc_offset(vec2(-1,-1),radius,stroke_width,view_scale);vec2 c2=pos+calc_offset(vec2(1,-1),radius,stroke_width,view_scale);vec2 c3=pos+calc_offset(vec2(1,1),radius,stroke_width,view_scale);vec2 c4=pos+calc_offset(vec2(-1,1),radius,stroke_width,view_scale);float h1=elevation(c1)+ELEVATION_BIAS;float h2=elevation(c2)+ELEVATION_BIAS;float h3=elevation(c3)+ELEVATION_BIAS;float h4=elevation(c4)+ELEVATION_BIAS;return max(h4,max(h3,max(h1,h2)));}float circle_elevation(vec2 pos) {
#if defined(TERRAIN)
return elevation(pos)+ELEVATION_BIAS;
#else
return 0.0;
#endif
}vec4 project_vertex(vec2 extrusion,vec4 world_center,vec4 projected_center,float radius,float stroke_width, float view_scale,mat3 surface_vectors) {vec2 sample_offset=calc_offset(extrusion,radius,stroke_width,view_scale);
#ifdef PITCH_WITH_MAP
#ifdef PROJECTION_GLOBE_VIEW
return u_matrix*( world_center+vec4(sample_offset.x*surface_vectors[0]+sample_offset.y*surface_vectors[1],0) );
#else
return u_matrix*( world_center+vec4(sample_offset,0,0) );
#endif
#else
return projected_center+vec4(sample_offset,0,0);
#endif
}float get_sample_step() {
#ifdef PITCH_WITH_MAP
return 2.0*PI/float(NUM_SAMPLES_PER_RING);
#else
return PI/float(NUM_SAMPLES_PER_RING);
#endif
}void main(void) {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump float radius
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp vec4 stroke_color
#pragma mapbox: initialize mediump float stroke_width
#pragma mapbox: initialize lowp float stroke_opacity
vec2 extrude=vec2(mod(a_pos,2.0)*2.0-1.0);vec2 circle_center=floor(a_pos*0.5);vec4 world_center;mat3 surface_vectors;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(circle_center)*circle_elevation(circle_center);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*circle_elevation(circle_center);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,circle_center,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;vec3 pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);world_center=vec4(pos,1);
#else 
surface_vectors=mat3(1.0);float height=circle_elevation(circle_center);world_center=vec4(circle_center,height,1);
#endif
#ifdef ELEVATED_ROADS
world_center.z+=a_circle_z_offset+ELEVATION_BIAS;
#endif
vec4 projected_center=u_matrix*world_center;float view_scale=0.0;
#ifdef PITCH_WITH_MAP
#ifdef SCALE_WITH_MAP
view_scale=1.0;
#else
view_scale=projected_center.w/u_camera_to_center_distance;
#endif
#else
#ifdef SCALE_WITH_MAP
view_scale=u_camera_to_center_distance;
#else
view_scale=projected_center.w;
#endif
#endif
gl_Position=project_vertex(extrude,world_center,projected_center,radius,stroke_width,view_scale,surface_vectors);float visibility=0.0;
#ifdef TERRAIN
float step=get_sample_step();vec4 occlusion_world_center;vec4 occlusion_projected_center;
#ifdef PITCH_WITH_MAP
float cantilevered_height=cantilevered_elevation(circle_center,radius,stroke_width,view_scale);occlusion_world_center=vec4(circle_center,cantilevered_height,1);occlusion_projected_center=u_matrix*occlusion_world_center;
#else
occlusion_world_center=world_center;occlusion_projected_center=projected_center;
#endif
for(int ring=0; ring < NUM_VISIBILITY_RINGS; ring++) {float scale=(float(ring)+1.0)/float(NUM_VISIBILITY_RINGS);for(int i=0; i < NUM_SAMPLES_PER_RING; i++) {vec2 extrusion=vec2(cos(step*float(i)),-sin(step*float(i)))*scale;vec4 frag_pos=project_vertex(extrusion,occlusion_world_center,occlusion_projected_center,radius,stroke_width,view_scale,surface_vectors);visibility+=float(!isOccluded(frag_pos));}}visibility/=float(NUM_VISIBILITY_RINGS)*float(NUM_SAMPLES_PER_RING);
#else
visibility=1.0;
#endif
#ifdef PROJECTION_GLOBE_VIEW
visibility=1.0;
#endif
v_visibility=visibility;lowp float antialiasblur=1.0/u_device_pixel_ratio/(radius+stroke_width);v_data=vec3(extrude.x,extrude.y,antialiasblur);
#ifdef FOG
v_fog_pos=fog_position(world_center.xyz);
#endif
}`),clippingMask:Nr("void main() {glFragColor=vec4(1.0);}","in vec2 a_pos;uniform mat4 u_matrix;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);}"),heatmap:Nr(`#include "_prelude_fog.fragment.glsl"
uniform highp float u_intensity;in vec2 v_extrude;
#pragma mapbox: define highp float weight
#define GAUSS_COEF 0.3989422804014327
void main() {
#pragma mapbox: initialize highp float weight
float d=-0.5*3.0*3.0*dot(v_extrude,v_extrude);float val=weight*u_intensity*GAUSS_COEF*exp(d);glFragColor=vec4(val,1.0,1.0,1.0);
#ifdef FOG
if (u_is_globe==0) {glFragColor.r*=pow(1.0-fog_opacity(v_fog_pos),2.0);}
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform float u_extrude_scale;uniform float u_opacity;uniform float u_intensity;in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;
#endif
out vec2 v_extrude;
#pragma mapbox: define highp float weight
#pragma mapbox: define mediump float radius
const highp float ZERO=1.0/255.0/16.0;
#define GAUSS_COEF 0.3989422804014327
void main(void) {
#pragma mapbox: initialize highp float weight
#pragma mapbox: initialize mediump float radius
vec2 unscaled_extrude=vec2(mod(a_pos,2.0)*2.0-1.0);float S=sqrt(-2.0*log(ZERO/weight/u_intensity/GAUSS_COEF))/3.0;v_extrude=S*unscaled_extrude;vec2 extrude=v_extrude*radius*u_extrude_scale;vec2 tilePos=floor(a_pos*0.5);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 pos_normal_3=a_pos_normal_3/16384.0;mat3 surface_vectors=globe_mercator_surface_vectors(pos_normal_3,u_up_dir,u_zoom_transition);vec3 surface_extrusion=extrude.x*surface_vectors[0]+extrude.y*surface_vectors[1];vec3 globe_elevation=elevationVector(tilePos)*elevation(tilePos);vec3 globe_pos=a_pos_3+surface_extrusion+globe_elevation;vec3 mercator_elevation=u_up_dir*u_tile_up_scale*elevation(tilePos);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,tilePos,u_tile_id,u_merc_center)+surface_extrusion+mercator_elevation;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#else
pos=vec3(tilePos+extrude,elevation(tilePos));
#endif
gl_Position=u_matrix*vec4(pos,1);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),heatmapTexture:Nr(`uniform sampler2D u_image;uniform sampler2D u_color_ramp;uniform float u_opacity;in vec2 v_pos;void main() {float t=texture(u_image,v_pos).r;vec4 color=texture(u_color_ramp,vec2(t,0.5));glFragColor=color*u_opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(0.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,"in vec2 a_pos;out vec2 v_pos;void main() {gl_Position=vec4(a_pos,0,1);v_pos=a_pos*0.5+0.5;}"),collisionBox:Nr("in float v_placed;in float v_notUsed;void main() {vec4 red =vec4(1.0,0.0,0.0,1.0);vec4 blue=vec4(0.0,0.0,1.0,0.5);glFragColor =mix(red,blue,step(0.5,v_placed))*0.5;glFragColor*=mix(1.0,0.1,step(0.5,v_notUsed));}",`#include "_prelude_terrain.vertex.glsl"
in vec3 a_pos;in vec2 a_anchor_pos;in vec2 a_extrude;in vec2 a_placed;in vec2 a_shift;in vec2 a_elevation_from_sea;in float a_size_scale;in vec2 a_padding;in float a_auto_z_offset;uniform mat4 u_matrix;uniform vec2 u_extrude_scale;uniform float u_camera_to_center_distance;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform float u_zoom_transition;
#endif
out float v_placed;out float v_notUsed;void main() {float feature_elevation=a_elevation_from_sea.x+a_auto_z_offset;float terrain_elevation=(a_elevation_from_sea.y==1.0 ? 0.0 : elevation(a_anchor_pos));vec3 proj_pos=a_pos+elevationVector(a_anchor_pos)*(feature_elevation+terrain_elevation);
#ifdef PROJECTION_GLOBE_VIEW
#ifndef PROJECTED_POS_ON_VIEWPORT
vec3 globe_pos=proj_pos;vec3 mercator_pos=mercator_tile_position(u_inv_rot_matrix,a_anchor_pos,u_tile_id,u_merc_center);proj_pos=mix_globe_mercator(globe_pos,mercator_pos,u_zoom_transition);
#endif
#endif
vec4 projectedPoint=u_matrix*vec4(proj_pos,1);highp float camera_to_anchor_distance=projectedPoint.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,1.5);gl_Position=projectedPoint;gl_Position.xy+=(a_extrude*a_size_scale+a_shift+a_padding)*u_extrude_scale*gl_Position.w*collision_perspective_ratio;v_placed=a_placed.x;v_notUsed=a_placed.y;}`),collisionCircle:Nr("in float v_radius;in vec2 v_extrude;in float v_perspective_ratio;in float v_collision;void main() {float alpha=0.5*min(v_perspective_ratio,1.0);float stroke_radius=0.9*max(v_perspective_ratio,1.0);float distance_to_center=length(v_extrude);float distance_to_edge=abs(distance_to_center-v_radius);float opacity_t=smoothstep(-stroke_radius,0.0,-distance_to_edge);vec4 color=mix(vec4(0.0,0.0,1.0,0.5),vec4(1.0,0.0,0.0,1.0),v_collision);glFragColor=color*alpha*opacity_t;}",`in vec2 a_pos_2f;in float a_radius;in vec2 a_flags;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform vec2 u_viewport_size;uniform float u_camera_to_center_distance;out float v_radius;out vec2 v_extrude;out float v_perspective_ratio;out float v_collision;vec3 toTilePosition(vec2 screenPos) {vec4 rayStart=u_inv_matrix*vec4(screenPos,-1.0,1.0);vec4 rayEnd  =u_inv_matrix*vec4(screenPos, 1.0,1.0);rayStart.xyz/=rayStart.w;rayEnd.xyz  /=rayEnd.w;highp float t=(0.0-rayStart.z)/(rayEnd.z-rayStart.z);return mix(rayStart.xyz,rayEnd.xyz,t);}void main() {vec2 quadCenterPos=a_pos_2f;float radius=a_radius;float collision=a_flags.x;float vertexIdx=a_flags.y;vec2 quadVertexOffset=vec2(
mix(-1.0,1.0,float(vertexIdx >=2.0)),mix(-1.0,1.0,float(vertexIdx >=1.0 && vertexIdx <=2.0)));vec2 quadVertexExtent=quadVertexOffset*radius;vec3 tilePos=toTilePosition(quadCenterPos);vec4 clipPos=u_matrix*vec4(tilePos,1.0);highp float camera_to_anchor_distance=clipPos.w;highp float collision_perspective_ratio=clamp(
0.5+0.5*(u_camera_to_center_distance/camera_to_anchor_distance),0.0,4.0);float padding_factor=1.2;v_radius=radius;v_extrude=quadVertexExtent*padding_factor;v_perspective_ratio=collision_perspective_ratio;v_collision=collision;gl_Position=vec4(clipPos.xyz/clipPos.w,1.0)+vec4(quadVertexExtent*padding_factor/u_viewport_size*2.0,0.0,0.0);}`),debug:Nr("uniform highp vec4 u_color;uniform sampler2D u_overlay;in vec2 v_uv;void main() {vec4 overlay_color=texture(u_overlay,v_uv);glFragColor=mix(u_color,overlay_color,overlay_color.a);}",`#include "_prelude_terrain.vertex.glsl"
in vec2 a_pos;
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;
#endif
out vec2 v_uv;uniform mat4 u_matrix;uniform float u_overlay_scale;void main() {float h=elevation(a_pos);v_uv=a_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
gl_Position=u_matrix*vec4(a_pos_3+elevationVector(a_pos)*h,1);
#else
gl_Position=u_matrix*vec4(a_pos*u_overlay_scale,h,1);
#endif
}`),elevatedStructuresDepth:Nr(`void main() {
#ifndef DEPTH_TEXTURE
glFragColor=vec4(0.);
#endif
}`,"in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform float u_depth_bias;void main() {gl_Position=u_matrix*vec4(a_pos,a_height,1);gl_Position.z=gl_Position.z+u_depth_bias;}"),elevatedStructuresDepthReconstruct:Nr(`#ifdef DEPTH_RECONSTRUCTION
in float v_height;
#endif
void main() {
#ifdef DEPTH_RECONSTRUCTION
if (v_height >=0.0)
discard;
#else
#ifdef FEATURE_CUTOUT
apply_feature_cutout(vec4(0.0,0.0,0.0,1.0),gl_FragCoord);
#endif
#endif
glFragColor=vec4(1.0,0.0,0.0,1.0);}`,`in vec2 a_pos;in float a_height;uniform mat4 u_matrix;uniform vec3 u_camera_pos;uniform highp float u_depth_bias;uniform lowp float u_height_scale;uniform lowp float u_reset_depth;
#ifdef DEPTH_RECONSTRUCTION
out float v_height;
#endif
void main() {vec3 vpos=vec3(a_pos,a_height*u_height_scale);
#ifdef DEPTH_RECONSTRUCTION
if (u_camera_pos.z > vpos.z) {vpos-=(u_camera_pos-vpos)*(vpos.z/(u_camera_pos.z-vpos.z));}v_height=a_height;
#endif
gl_Position=u_matrix*vec4(vpos,1);gl_Position.z=u_reset_depth==1.0 ? gl_Position.w : gl_Position.z+u_depth_bias;}`),elevatedStructures:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in vec3 v_normal;in float v_height;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth;
#endif
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}vec3 compute_view_dependent_emissive_color(float ndotl,float emissive_strength,vec3 color)
{color=sRGBToLinear(color);color=color*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);color=linearTosRGB(color.rgb);return color;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
vec3 color=structure_color.xyz;
#ifdef LIGHTING_3D_MODE
vec3 normal=normalize(v_normal);vec3 transformed_normal=vec3(-normal.xy,normal.z);float ndotl=calculate_NdotL(transformed_normal);float emissive_strength=u_emissive_strength;emissive_strength=0.0;vec3 emissive_color=compute_view_dependent_emissive_color(ndotl,emissive_strength,color.xyz);
#ifdef RENDER_SHADOWS
float shadowed_lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth);color.rgb=apply_lighting(color.rgb,transformed_normal,shadowed_lighting_factor);
#else
color=apply_lighting(color,transformed_normal);
#endif
color=mix(color,emissive_color,emissive_strength);if (v_height < 0.0) {float penetration=max(v_height+7.5,0.0);float occlusion=1.0-1.0/PI*acos(1.0-penetration/4.0);color=color*(1.0-pow(occlusion,2.0)*0.3);}
#endif
#ifdef FOG
color=fog_apply(color,v_fog_pos);
#endif
vec4 out_color=vec4(color,1.0);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_height);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;in float a_height;in vec3 a_pos_normal_3;uniform mat4 u_matrix;out vec3 v_normal;out float v_height;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth;
#endif
#pragma mapbox: define highp vec4 structure_color
void main() {
#pragma mapbox: initialize highp vec4 structure_color
v_normal=a_pos_normal_3/16384.0;v_height=a_height;vec3 pos=vec3(a_pos,a_height);gl_Position=u_matrix*vec4(pos,1);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(-v_normal.xy,v_normal.z));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fill:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
vec4 out_color=color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=opacity;
#ifdef INDICATOR_CUTOUT
if (v_z_offset >=0.0) {out_color=applyCutout(out_color,v_z_offset);}
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=z_offset;
#endif
}`),fillOutline:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
float dist=length(v_pos-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=outline_color;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
uniform mat4 u_matrix;uniform vec2 u_world;out highp vec2 v_pos;
#pragma mapbox: define highp vec4 outline_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 outline_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize highp float z_offset
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);
#ifdef FLIP_Y
v_pos=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillOutlinePattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
uniform float u_emissive_strength;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
in highp vec2 v_pos;in highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);float dist=length(v_pos_world-gl_FragCoord.xy);float alpha=1.0-smoothstep(0.0,1.0,dist);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*(alpha*opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_world;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;out highp vec2 v_pos_world;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef FLIP_Y
v_pos_world=(vec2(gl_Position.x,-gl_Position.y)/gl_Position.w+1.0)/2.0*u_world;
#else
v_pos_world=(gl_Position.xy/gl_Position.w+1.0)/2.0*u_world;
#endif
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillPattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in highp vec2 v_pos;uniform float u_emissive_strength;
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
glFragColor=out_color*opacity;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_tile_units_to_pixels;in vec2 a_pos;
#ifdef ELEVATED_ROADS
in float a_road_z_offset;out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
out highp vec2 v_pos;
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp vec4 pattern
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define lowp float pixel_ratio
#pragma mapbox: define highp float z_offset
void main() {
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump vec4 pattern
#pragma mapbox: initialize lowp float pixel_ratio
#pragma mapbox: initialize highp float z_offset
#ifdef FILL_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;
#ifdef ELEVATED_ROADS
z_offset+=a_road_z_offset;v_road_z_offset=z_offset;
#endif
float hidden=float(opacity==0.0);gl_Position=mix(u_matrix*vec4(a_pos,z_offset,1),AWAY,hidden);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,a_pos);
#ifdef RENDER_SHADOWS
vec3 shd_pos0=vec3(a_pos,z_offset);vec3 shd_pos1=vec3(a_pos,z_offset);
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),fillExtrusion:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
in vec4 v_color;in vec4 v_flat;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;
#endif
uniform lowp float u_opacity;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec2 v_ao;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
in vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
in highp vec3 v_normal;
#endif
uniform vec3 u_flood_light_color;uniform highp float u_vertical_scale;uniform float u_flood_light_intensity;uniform vec3 u_ground_shadow_factor;
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
in float v_flood_radius;in float v_has_floodlight;
#endif
in float v_height;
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float emissive_strength
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
vec3 normal=normalize(v_normal);
#endif
float z;vec4 color=v_color;
#ifdef ZERO_ROOF_RADIUS
z=float(normal.z > 0.00001);
#ifdef LIGHTING_3D_MODE
normal=mix(normal,vec3(0.0,0.0,1.0),z);
#else
color=mix(v_color,v_roof_color,z);
#endif
#endif
float h=max(0.0,v_height);float ao_shade=1.0;
#ifdef FAUX_AO
float intensity=u_ao[0];float h_floors=h/(u_ao[1]*u_vertical_scale);float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);ao_shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;
#ifdef ZERO_ROOF_RADIUS
concave*=(1.0-z);
#endif
float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);ao_shade*=mix(1.0,x_shade*x_shade*x_shade,concave);
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
color.rgb*=mix(ao_shade,1.0,v_has_floodlight);
#else
color.rgb*=ao_shade;
#endif
#else
color.rgb*=ao_shade;
#endif
#endif
#ifdef LIGHTING_3D_MODE
float flood_radiance=0.0;
#ifdef FLOOD_LIGHT
flood_radiance=(1.0-min(h/v_flood_radius,1.0))*u_flood_light_intensity*v_has_floodlight;
#endif
#ifdef RENDER_SHADOWS
#ifdef FLOOD_LIGHT
float ndotl_unclamped=dot(normal,u_shadow_direction);float ndotl=max(0.0,ndotl_unclamped);float occlusion=ndotl_unclamped < 0.0 ? 1.0 : shadow_occlusion(ndotl,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 litColor=apply_lighting(color.rgb,normal,(1.0-u_shadow_intensity*occlusion)*ndotl);vec3 floodLitColor=compute_flood_lighting(u_flood_light_color*u_opacity,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=mix(litColor,floodLitColor,flood_radiance);
#else
float shadowed_lighting_factor;
#ifdef RENDER_CUTOFF
shadowed_lighting_factor=shadowed_light_factor_normal_opacity(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,v_cutoff_opacity);if (v_cutoff_opacity==0.0) {discard;}
#else
shadowed_lighting_factor=shadowed_light_factor_normal(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);
#endif
color.rgb=apply_lighting(color.rgb,normal,shadowed_lighting_factor);
#endif
#else
color.rgb=apply_lighting(color.rgb,normal);
#ifdef FLOOD_LIGHT
color.rgb=mix(color.rgb,u_flood_light_color*u_opacity,flood_radiance);
#endif
#endif
color.rgb=mix(color.rgb,v_flat.rgb,emissive_strength);color*=u_opacity;
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos,h));
#endif
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,h);
#endif
#ifdef FEATURE_CUTOUT
color=apply_feature_cutout(color,gl_FragCoord);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_edge_radius;uniform float u_width_scale;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
uniform highp float u_vertical_scale;out vec4 v_color;out vec4 v_flat;
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
out vec4 v_roof_color;
#endif
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
out highp vec3 v_normal;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec2 v_ao;
#endif
#if defined(LIGHTING_3D_MODE) && defined(FLOOD_LIGHT)
out float v_flood_radius;out float v_has_floodlight;
#endif
out float v_height;vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define highp float flood_light_wall_radius
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp float emissive_strength
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize highp float flood_light_wall_radius
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp float emissive_strength
base*=u_vertical_scale;height*=u_vertical_scale;vec4 pos_nx=floor(a_pos_normal_ed*0.5);vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));
#if defined(ZERO_ROOF_RADIUS) || defined(RENDER_SHADOWS) || defined(LIGHTING_3D_MODE)
v_normal=normal;
#endif
base=max(0.0,base);float attr_height=height;height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=0.0;float c_ele=0.0;vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
h=t > 0.0 ? height : base;pos=vec3(pos_nx.xy,h);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*h);vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,pos.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*pos.z;pos=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
float cutoff=1.0;vec3 scaled_pos=pos;
#ifdef RENDER_CUTOFF
vec3 centroid_random=vec3(centroid_pos.xy,centroid_pos.x+centroid_pos.y+1.0);vec3 ground_pos=centroid_pos.x==0.0 ? pos.xyz : (centroid_random/8.0);vec4 ground=u_matrix*vec4(ground_pos.xy,ele,1.0);
#ifdef CLIP_ZERO_TO_ONE
cutoff=cutoff_opacity(u_cutoff_params,ground.z*2.0-ground.w);
#else
cutoff=cutoff_opacity(u_cutoff_params,ground.z);
#endif
if (centroid_pos.y !=0.0 && centroid_pos.x !=0.0) {vec3 g=floor(ground_pos);vec3 mod_=centroid_random-g*8.0;float seed=min(1.0,0.1*(min(3.5,max(mod_.x+mod_.y,0.2*attr_height))*0.35+mod_.z));if (cutoff < 0.8-seed) {cutoff=0.0;}}float cutoff_scale=cutoff;v_cutoff_opacity=cutoff;scaled_pos.z=mix(c_ele,h,cutoff_scale);
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (cutoff==0.0 && centroid_pos.x !=0.0) || (color.a==0.0));
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);scaled_pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;scaled_pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
gl_Position=mix(u_matrix*vec4(scaled_pos,1),AWAY,hidden);h=h-ele;v_height=h;
#ifdef RENDER_SHADOWS
vec3 shd_pos0=pos;vec3 shd_pos1=pos;
#ifdef NORMAL_OFFSET
vec3 offset=shadow_normal_offset(normal);shd_pos0+=offset*shadow_normal_offset_multiplier0();shd_pos1+=offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);
#endif
float NdotL=0.0;float colorvalue=0.0;
#ifndef LIGHTING_3D_MODE
colorvalue=color.r*0.2126+color.g*0.7152+color.b*0.0722;vec4 ambientlight=vec4(0.03,0.03,0.03,1.0);color+=ambientlight;NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),NdotL);if (normal.y !=0.0) {float r=0.84;r=mix(0.7,0.98,1.0-u_lightintensity);NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#endif
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec2(mix(concave,-concave,start),y_ground);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
#ifdef FLOOD_LIGHT
float is_wall=1.0-float(t > 0.0 && top_up_ny.y > 0.0);v_has_floodlight=float(flood_light_wall_radius > 0.0 && is_wall > 0.0);v_flood_radius=flood_light_wall_radius*u_vertical_scale;
#endif
v_color=vec4(color.rgb,1.0);float ndotl=calculate_NdotL(normal);v_flat.rgb=sRGBToLinear(color.rgb);v_flat.rgb=v_flat.rgb*(ndotl+(1.0-min(ndotl*57.29,1.0))*emissive_strength);v_flat=vec4(linearTosRGB(v_flat.rgb),1.0);
#else
v_color=vec4(0.0,0.0,0.0,1.0);v_color.rgb+=clamp(color.rgb*NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_color*=u_opacity;
#endif
#if defined(ZERO_ROOF_RADIUS) && !defined(LIGHTING_3D_MODE)
float roofNdotL=clamp(u_lightpos.z,0.0,1.0);roofNdotL=mix((1.0-u_lightintensity),max((1.0-colorvalue+u_lightintensity),1.0),roofNdotL);v_roof_color=vec4(0.0,0.0,0.0,1.0);v_roof_color.rgb+=clamp(color.rgb*roofNdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_roof_color*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
}`),fillExtrusionDepth:Nr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_edge_radius;uniform float u_width_scale;uniform float u_vertical_scale;
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp float line_width
#pragma mapbox: define highp vec4 color
out highp float v_depth;void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp float line_width
#pragma mapbox: initialize highp vec4 color
base*=u_vertical_scale;height*=u_vertical_scale;vec3 pos_nx=floor(a_pos_normal_ed.xyz*0.5);mediump vec3 top_up_ny=a_pos_normal_ed.xyz-2.0*pos_nx;base=max(0.0,base);height=max(0.0,top_up_ny.y==0.0 && top_up_ny.x==1.0 ? height-u_edge_radius : height);float t=top_up_ny.x;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
vec3 pos;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;float ele=elevation(pos_nx.xy);float c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);float h=t > 0.0 ? max(h_base,h_height) : h_base;pos=vec3(pos_nx.xy,h);
#else
pos=vec3(pos_nx.xy,t > 0.0 ? height : base);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);pos.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;pos.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(pos,1),AWAY,hidden);v_depth=gl_Position.z/gl_Position.w;}`),fillExtrusionPattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform vec2 u_texsize;uniform sampler2D u_image;
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
#ifdef FAUX_AO
uniform lowp vec2 u_ao;in vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
in vec3 v_normal;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
in highp vec2 v_pos;in vec4 v_lighting;uniform lowp float u_opacity;
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;highp vec2 imagecoord=mod(v_pos,1.0);highp vec2 pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,imagecoord);highp vec2 lod_pos=mix(pattern_tl/u_texsize,pattern_br/u_texsize,v_pos);vec4 out_color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl/u_texsize,pattern_b_br/u_texsize,imagecoord);vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);out_color=out_color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting(out_color,normalize(v_normal))*u_opacity;
#else
out_color=out_color*v_lighting;
#endif
#ifdef FAUX_AO
float intensity=u_ao[0];float h=max(0.0,v_ao.z);float h_floors=h/u_ao[1];float y_shade=1.0-0.9*intensity*min(v_ao.y,1.0);float shade=(1.0-0.08*intensity)*(y_shade+(1.0-y_shade)*(1.0-pow(1.0-min(h_floors/16.0,1.0),16.0)))+0.08*intensity*min(h_floors/160.0,1.0);float concave=v_ao.x*v_ao.x;float x_shade=mix(1.0,mix(0.6,0.75,min(h_floors/30.0,1.0)),intensity)+0.1*intensity*min(h,1.0);shade*=mix(1.0,x_shade*x_shade*x_shade,concave);out_color.rgb=out_color.rgb*shade;
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,height);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#include "_prelude_lighting.glsl"
uniform mat4 u_matrix;uniform vec2 u_pixel_coord_upper;uniform vec2 u_pixel_coord_lower;uniform float u_height_factor;uniform float u_tile_units_to_pixels;uniform float u_vertical_gradient;uniform lowp float u_opacity;uniform float u_width_scale;uniform vec3 u_lightcolor;uniform lowp vec3 u_lightpos;uniform lowp float u_lightintensity;in vec4 a_pos_normal_ed;in vec2 a_centroid_pos;
#ifdef RENDER_WALL_MODE
in vec3 a_join_normal_inside;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_pos_3;in vec3 a_pos_normal_3;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_tile_id;uniform float u_zoom_transition;uniform vec3 u_up_dir;uniform float u_height_lift;
#endif
#ifdef TERRAIN
uniform int u_height_type;uniform int u_base_type;
#endif
out highp vec2 v_pos;out vec4 v_lighting;
#ifdef FAUX_AO
uniform lowp vec2 u_ao;out vec3 v_ao;
#endif
#ifdef LIGHTING_3D_MODE
out vec3 v_normal;
#endif
#pragma mapbox: define highp float base
#pragma mapbox: define highp float height
#pragma mapbox: define highp vec4 color
#pragma mapbox: define mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define highp float pixel_ratio
#pragma mapbox: define highp float line_width
void main() {
#pragma mapbox: initialize highp float base
#pragma mapbox: initialize highp float height
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize mediump vec4 pattern
#ifdef FILL_EXTRUSION_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize highp float pixel_ratio
#pragma mapbox: initialize highp float line_width
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec4 pos_nx=floor(a_pos_normal_ed*0.5);mediump vec4 top_up_ny_start=a_pos_normal_ed-2.0*pos_nx;mediump vec3 top_up_ny=top_up_ny_start.xyz;float x_normal=pos_nx.z/8192.0;vec3 normal=top_up_ny.y==1.0 ? vec3(0.0,0.0,1.0) : normalize(vec3(x_normal,(2.0*top_up_ny.z-1.0)*(1.0-abs(x_normal)),0.0));float edgedistance=a_pos_normal_ed.w;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;base=max(0.0,base);height=max(0.0,height);float t=top_up_ny.x;float z=t > 0.0 ? height : base;vec2 centroid_pos=vec2(0.0);
#if defined(HAS_CENTROID) || defined(TERRAIN)
centroid_pos=a_centroid_pos;
#endif
float ele=0.0;float h=z;vec3 p;float c_ele;
#ifdef TERRAIN
bool is_flat_height=centroid_pos.x !=0.0 && u_height_type==1;bool is_flat_base=centroid_pos.x !=0.0 && u_base_type==1;ele=elevation(pos_nx.xy);c_ele=is_flat_height || is_flat_base ? (centroid_pos.y==0.0 ? elevationFromUint16(centroid_pos.x) : flatElevation(centroid_pos)) : ele;float h_height=is_flat_height ? max(c_ele+height,ele+base+2.0) : ele+height;float h_base=is_flat_base ? max(c_ele+base,ele+base) : ele+(base==0.0 ?-5.0 : base);h=t > 0.0 ? max(h_base,h_height) : h_base;p=vec3(pos_nx.xy,h);
#else
p=vec3(pos_nx.xy,z);
#endif
#ifdef PROJECTION_GLOBE_VIEW
float lift=float((t+base) > 0.0)*u_height_lift;h+=lift;vec3 globe_normal=normalize(mix(a_pos_normal_3/16384.0,u_up_dir,u_zoom_transition));vec3 globe_pos=a_pos_3+globe_normal*(u_tile_up_scale*(p.z+lift));vec3 merc_pos=mercator_tile_position(u_inv_rot_matrix,p.xy,u_tile_id,u_merc_center)+u_up_dir*u_tile_up_scale*p.z;p=mix_globe_mercator(globe_pos,merc_pos,u_zoom_transition);
#endif
#ifdef RENDER_WALL_MODE
vec2 wall_offset=u_width_scale*line_width*(a_join_normal_inside.xy/EXTENT);p.xy+=(1.0-a_join_normal_inside.z)*wall_offset*0.5;p.xy-=a_join_normal_inside.z*wall_offset*0.5;
#endif
float hidden=float((centroid_pos.x==0.0 && centroid_pos.y==1.0) || (color.a==0.0));gl_Position=mix(u_matrix*vec4(p,1),AWAY,hidden);vec2 pos=normal.z==1.0
? pos_nx.xy
: vec2(edgedistance,z*u_height_factor);v_pos=get_pattern_pos(u_pixel_coord_upper,u_pixel_coord_lower,display_size,u_tile_units_to_pixels,pos);v_lighting=vec4(0.0,0.0,0.0,1.0);float NdotL=0.0;
#ifdef LIGHTING_3D_MODE
NdotL=calculate_NdotL(normal);
#else
NdotL=clamp(dot(normal,u_lightpos),0.0,1.0);NdotL=mix((1.0-u_lightintensity),max((0.5+u_lightintensity),1.0),NdotL);
#endif
if (normal.y !=0.0) {float r=0.84;
#ifndef LIGHTING_3D_MODE
r=mix(0.7,0.98,1.0-u_lightintensity);
#endif
NdotL*=(
(1.0-u_vertical_gradient)+(u_vertical_gradient*clamp((t+base)*pow(height/150.0,0.5),r,1.0)));}
#ifdef FAUX_AO
float concave=pos_nx.w-floor(pos_nx.w*0.5)*2.0;float start=top_up_ny_start.w;float y_ground=1.0-clamp(t+base,0.0,1.0);float top_height=height;
#ifdef TERRAIN
top_height=mix(max(c_ele+height,ele+base+2.0),ele+height,float(centroid_pos.x==0.0))-ele;y_ground+=y_ground*5.0/max(3.0,top_height);
#endif
v_ao=vec3(mix(concave,-concave,start),y_ground,h-ele);NdotL*=(1.0+0.05*(1.0-top_up_ny.y)*u_ao[0]);
#ifdef PROJECTION_GLOBE_VIEW
top_height+=u_height_lift;
#endif
gl_Position.z-=(0.0000006*(min(top_height,500.)+2.0*min(base,500.0)+60.0*concave+3.0*start))*gl_Position.w;
#endif
#ifdef LIGHTING_3D_MODE
v_normal=normal;
#else
v_lighting.rgb+=clamp(NdotL*u_lightcolor,mix(vec3(0.0),vec3(0.3),1.0-u_lightcolor),vec3(1.0));v_lighting*=u_opacity;
#endif
#ifdef FOG
v_fog_pos=fog_position(p);
#endif
}`),groundShadow:Nr(`#include "_prelude_shadow.fragment.glsl"
precision highp float;uniform vec3 u_ground_shadow_factor;in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#ifdef FOG
in float v_fog_opacity;
#endif
void main() {float light=shadowed_light_factor_plane_bias(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);vec3 shadow=mix(u_ground_shadow_factor,vec3(1.0),light);
#ifdef RENDER_CUTOFF
shadow=mix(vec3(1.0),shadow,cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w));
#endif
#ifdef FOG
shadow=mix(shadow,vec3(1.0),v_fog_opacity);
#endif
#ifdef INDICATOR_CUTOUT
shadow=mix(shadow,vec3(1.0),1.0-applyCutout(vec4(1.0),0.0).r);
#endif
glFragColor=vec4(shadow,1.0);}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;in vec2 a_pos;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#ifdef FOG
out float v_fog_opacity;
#endif
void main() {gl_Position=u_matrix*vec4(a_pos,0.0,1.0);v_pos_light_view_0=u_light_matrix_0*vec4(a_pos,0.0,1.0);v_pos_light_view_1=u_light_matrix_1*vec4(a_pos,0.0,1.0);
#ifdef FOG
v_fog_pos=fog_position(a_pos);v_fog_opacity=fog(v_fog_pos);
#endif
}`),fillExtrusionGroundEffect:Nr(`uniform highp float u_ao_pass;uniform highp float u_opacity;uniform highp float u_flood_light_intensity;uniform highp vec3 u_flood_light_color;uniform highp float u_attenuation;uniform sampler2D u_fb;uniform float u_fb_size;
#ifdef SDF_SUBPASS
in highp vec2 v_pos;in highp vec4 v_line_segment;in highp float v_flood_light_radius_tile;in highp vec2 v_ao;float line_df(highp vec2 a,highp vec2 b,highp vec2 p) {highp vec2 ba=b-a;highp vec2 pa=p-a;highp float r=clamp(dot(pa,ba)/dot(ba,ba),0.0,1.0);return length(pa-r*ba);}
#ifdef FOG
in highp float v_fog;
#endif
#endif
void main() {
#ifdef CLEAR_SUBPASS
vec4 color=vec4(1.0);
#ifdef CLEAR_FROM_TEXTURE
color=texture(u_fb,gl_FragCoord.xy/vec2(u_fb_size));
#endif
glFragColor=color;
#else
#ifdef SDF_SUBPASS
highp float d=line_df(v_line_segment.xy,v_line_segment.zw,v_pos);highp float effect_radius=mix(v_flood_light_radius_tile,v_ao.y,u_ao_pass);d/=effect_radius;d=min(d,1.0);d=1.0-pow(1.0-d,u_attenuation);highp float effect_intensity=mix(u_flood_light_intensity,v_ao.x,u_ao_pass);highp float fog=1.0;
#ifdef FOG
fog=v_fog;
#endif
#ifdef RENDER_CUTOFF
fog*=v_cutoff_opacity;
#endif
glFragColor=vec4(vec3(0.0),mix(1.0,d,effect_intensity*u_opacity*fog));
#else
vec4 color=mix(vec4(u_flood_light_color,1.0),vec4(vec3(0.0),1.0),u_ao_pass);
#ifdef OVERDRAW_INSPECTOR
color=vec4(1.0);
#endif
glFragColor=color;
#endif
HANDLE_WIREFRAME_DEBUG;
#endif
}`,`#include "_prelude_fog.vertex.glsl"
in highp vec4 a_pos_end;in highp float a_angular_offset_factor;in highp float a_hidden_by_landmark;
#ifdef SDF_SUBPASS
out highp vec2 v_pos;out highp vec4 v_line_segment;out highp float v_flood_light_radius_tile;out highp vec2 v_ao;
#ifdef FOG
out highp float v_fog;
#endif
#endif
uniform highp float u_flood_light_intensity;uniform highp mat4 u_matrix;uniform highp float u_ao_pass;uniform highp float u_meter_to_tile;uniform highp float u_edge_radius;uniform highp float u_dynamic_offset;uniform highp vec2 u_ao;
#pragma mapbox: define highp float flood_light_ground_radius
const float TANGENT_CUTOFF=4.0;const float NORM=32767.0;void main() {
#pragma mapbox: initialize highp float flood_light_ground_radius
vec2 p=a_pos_end.xy;vec2 q=floor(a_pos_end.zw*0.5);vec2 start_bottom=a_pos_end.zw-q*2.0;float fl_ground_radius=flood_light_ground_radius;fl_ground_radius=abs(flood_light_ground_radius);float direction=flood_light_ground_radius < 0.0 ?-1.0 : 1.0;float flood_radius_tile=fl_ground_radius*u_meter_to_tile;vec2 v=normalize(q-p);float ao_radius=u_ao.y/3.5;float effect_radius=mix(flood_radius_tile,ao_radius,u_ao_pass)+u_edge_radius;float angular_offset_factor=a_angular_offset_factor/NORM*TANGENT_CUTOFF;float angular_offset=direction*angular_offset_factor*effect_radius;float top=1.0-start_bottom.y;float side=(0.5-start_bottom.x)*2.0;vec2 extrusion_parallel=v*side*mix(u_dynamic_offset,angular_offset,top);vec2 perp=vec2(v.y,-v.x);vec2 extrusion_perp=direction*perp*effect_radius*top;vec3 pos=vec3(mix(q,p,start_bottom.x),0.0);pos.xy+=extrusion_parallel+extrusion_perp;
#ifdef SDF_SUBPASS
v_pos=pos.xy;v_line_segment=vec4(p,q)+perp.xyxy*u_edge_radius;v_flood_light_radius_tile=flood_radius_tile;v_ao=vec2(u_ao.x,ao_radius);
#ifdef FOG
v_fog_pos=fog_position(pos);v_fog=1.0-fog(v_fog_pos);
#endif
#endif
float hidden_by_landmark=0.0;
#ifdef HAS_CENTROID
hidden_by_landmark=a_hidden_by_landmark;
#endif
float isFloodlit=float(fl_ground_radius > 0.0 && u_flood_light_intensity > 0.0);float hidden=mix(1.0-isFloodlit,isFloodlit,u_ao_pass);hidden+=hidden_by_landmark;gl_Position=mix(u_matrix*vec4(pos,1.0),AWAY,float(hidden > 0.0));
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
}`),hillshadePrepare:Nr(`precision highp float;uniform highp sampler2D u_image;in vec2 v_pos;uniform vec2 u_dimension;uniform float u_zoom;float getElevation(vec2 coord) {return texture(u_image,coord).r/4.0;}void main() {vec2 epsilon=1.0/u_dimension;float a=getElevation(v_pos+vec2(-epsilon.x,-epsilon.y));float b=getElevation(v_pos+vec2(0,-epsilon.y));float c=getElevation(v_pos+vec2(epsilon.x,-epsilon.y));float d=getElevation(v_pos+vec2(-epsilon.x,0));float e=getElevation(v_pos+vec2(epsilon.x,0));float f=getElevation(v_pos+vec2(-epsilon.x,epsilon.y));float g=getElevation(v_pos+vec2(0,epsilon.y));float h=getElevation(v_pos+vec2(epsilon.x,epsilon.y));float exaggerationFactor=u_zoom < 2.0 ? 0.4 : u_zoom < 4.5 ? 0.35 : 0.3;float exaggeration=u_zoom < 15.0 ? (u_zoom-15.0)*exaggerationFactor : 0.0;vec2 deriv=vec2(
(c+e+e+h)-(a+d+d+f),(f+g+g+h)-(a+b+b+c)
)/pow(2.0,exaggeration+(19.2562-u_zoom));glFragColor=clamp(vec4(
deriv.x/2.0+0.5,deriv.y/2.0+0.5,1.0,1.0),0.0,1.0);}`,"uniform mat4 u_matrix;uniform vec2 u_dimension;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);highp vec2 epsilon=1.0/u_dimension;float scale=(u_dimension.x-2.0)/u_dimension.x;v_pos=(a_texture_pos/8192.0)*scale+epsilon;}"),hillshade:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image;in vec2 v_pos;uniform vec2 u_latrange;uniform vec2 u_light;uniform vec4 u_shadow;uniform vec4 u_highlight;uniform vec4 u_accent;uniform float u_emissive_strength;void main() {vec4 pixel=texture(u_image,v_pos);vec2 deriv=((pixel.rg*2.0)-1.0);float scaleFactor=cos(radians((u_latrange[0]-u_latrange[1])*(1.0-v_pos.y)+u_latrange[1]));float slope=atan(1.25*length(deriv)/scaleFactor);float aspect=deriv.x !=0.0 ? atan(deriv.y,-deriv.x) : PI/2.0*(deriv.y > 0.0 ? 1.0 :-1.0);float intensity=u_light.x;float azimuth=u_light.y+PI;float base=1.875-intensity*1.75;float maxValue=0.5*PI;float scaledSlope=intensity !=0.5 ? ((pow(base,slope)-1.0)/(pow(base,maxValue)-1.0))*maxValue : slope;float accent=cos(scaledSlope);vec4 accent_color=(1.0-accent)*u_accent*clamp(intensity*2.0,0.0,1.0);float shade=abs(mod((aspect+azimuth)/PI+0.5,2.0)-1.0);vec4 shade_color=mix(u_shadow,u_highlight,shade)*sin(scaledSlope)*clamp(intensity*2.0,0.0,1.0);glFragColor=accent_color*(1.0-shade_color.a)+shade_color;
#ifdef LIGHTING_3D_MODE
glFragColor=apply_lighting_with_emission_ground(glFragColor,u_emissive_strength);
#endif
#ifdef FOG
glFragColor=fog_dither(fog_apply_premultiplied(glFragColor,v_fog_pos));
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos;void main() {gl_Position=u_matrix*vec4(a_pos,0,1);v_pos=a_texture_pos/8192.0;
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
}`),line:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform lowp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_floor_width_scale;uniform float u_alpha_discard_threshold;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;in vec2 v_width2;in vec2 v_normal;in float v_gamma_scale;in highp vec3 v_uv;
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform sampler2D u_dash_image;in vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform sampler2D u_gradient_image;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
float luminance(vec3 c) {return (c.r+c.r+c.b+c.g+c.g+c.g)*0.1667;}uniform float u_emissive_strength;
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
float linearstep(float edge0,float edge1,float x) {return  clamp((x-edge0)/(edge1-edge0),0.0,1.0);}void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);
#ifdef RENDER_LINE_DASH
float sdfdist=texture(u_dash_image,v_tex).r;float sdfgamma=1.0/(2.0*u_device_pixel_ratio)/dash.z;float scaled_floorwidth=(floorwidth*u_floor_width_scale);alpha*=linearstep(0.5-sdfgamma/scaled_floorwidth,0.5+sdfgamma/scaled_floorwidth,sdfdist);
#endif
highp vec4 out_color;
#ifdef RENDER_LINE_GRADIENT
out_color=texture(u_gradient_image,v_uv.xy);
#else
out_color=color;
#endif
float trim_alpha=1.0;
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);out_color=mix(out_color,u_trim_color,transition_factor);trim_alpha=1.0-transition_factor;}
#endif
if (u_alpha_discard_threshold !=0.0) {if (alpha < u_alpha_discard_threshold) {discard;}}
#ifdef RENDER_LINE_BORDER
float edgeBlur=((border_width*u_width_scale)+1.0/u_device_pixel_ratio);float alpha2=clamp(min(dist-(v_width2.t-edgeBlur),v_width2.s-dist)/edgeBlur,0.0,1.0);if (alpha2 < 1.) {float smoothAlpha=smoothstep(0.6,1.0,alpha2);if (border_color.a==0.0) {float Y=(out_color.a > 0.01) ? luminance(out_color.rgb/out_color.a) : 1.;float adjustment=(Y > 0.) ? 0.5/Y : 0.45;if (out_color.a > 0.25 && Y < 0.25) {vec3 borderColor=(Y > 0.) ? out_color.rgb : vec3(1,1,1)*out_color.a;out_color.rgb=out_color.rgb+borderColor*(adjustment*(1.0-smoothAlpha));} else {out_color.rgb*=(0.6 +0.4*smoothAlpha);}} else {out_color=mix(border_color*trim_alpha,out_color,smoothAlpha);}}
#endif
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
out_color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
out_color=fog_dither(fog_apply_premultiplied(out_color,v_fog_pos));
#endif
out_color*=(alpha*opacity);
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define EXTRUDE_SCALE 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS) || defined(VARIABLE_LINE_WIDTH)
in vec3 a_z_offset_width;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
in highp vec3 a_packed;
#endif
#ifdef RENDER_LINE_DASH
in float a_linesofar;
#endif
uniform mat4 u_matrix;uniform mat2 u_pixels_to_tile_units;uniform vec2 u_units_to_pixels;uniform lowp float u_device_pixel_ratio;uniform float u_width_scale;uniform highp float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out float v_gamma_scale;out highp vec3 v_uv;
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_LINE_DASH
uniform vec2 u_texsize;uniform float u_tile_units_to_pixels;out vec2 v_tex;
#endif
#ifdef RENDER_LINE_GRADIENT
uniform float u_image_height;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 color
#pragma mapbox: define lowp float floorwidth
#pragma mapbox: define lowp vec4 dash
#pragma mapbox: define lowp float blur
#pragma mapbox: define lowp float opacity
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define lowp float offset
#pragma mapbox: define mediump float width
#pragma mapbox: define lowp float border_width
#pragma mapbox: define lowp vec4 border_color
void main() {
#pragma mapbox: initialize highp vec4 color
#pragma mapbox: initialize lowp float floorwidth
#pragma mapbox: initialize lowp vec4 dash
#pragma mapbox: initialize lowp float blur
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize lowp float offset
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize lowp float border_width
#pragma mapbox: initialize lowp vec4 border_color
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);mediump vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth;
#ifdef VARIABLE_LINE_WIDTH
float left=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);halfwidth=(u_width_scale*(left==1.0 ? a_z_offset_width.y : a_z_offset_width.z))/2.0;
#else
halfwidth=(u_width_scale*width)/2.0;
#endif
offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);mediump vec2 dist=outset*a_extrude*EXTRUDE_SCALE;mediump float u=0.5*a_direction;mediump float t=1.0-abs(u);mediump vec2 offset2=offset*a_extrude*EXTRUDE_SCALE*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float epsilon=0.0001;float extrude_length_without_perspective=max(length(dist),epsilon);float extrude_length_with_perspective=max(length(projected_extrude_xy/gl_Position.w*u_units_to_pixels),epsilon);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#if defined(RENDER_LINE_GRADIENT) || defined(RENDER_LINE_TRIM_OFFSET)
highp float a_uv_x=a_packed[0];float a_split_index=a_packed[1];highp float line_progress=a_packed[2];
#ifdef RENDER_LINE_GRADIENT
highp float texel_height=1.0/u_image_height;highp float half_texel_height=0.5*texel_height;v_uv=vec3(a_uv_x,a_split_index*texel_height-half_texel_height,line_progress);
#else
v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
#endif
#ifdef RENDER_LINE_DASH
float scale=dash.z==0.0 ? 0.0 : u_tile_units_to_pixels/dash.z;float height=dash.y;v_tex=vec2(a_linesofar*scale/(floorwidth*u_floor_width_scale),(-normal.y*height+dash.x+0.5)/u_texsize.y);
#endif
v_width2=vec2(outset,inset);
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),linePattern:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
uniform highp float u_device_pixel_ratio;uniform highp float u_width_scale;uniform highp float u_alpha_discard_threshold;uniform highp vec2 u_texsize;uniform highp float u_tile_units_to_pixels;uniform highp vec2 u_trim_offset;uniform highp vec2 u_trim_fade_range;uniform lowp vec4 u_trim_color;uniform sampler2D u_image;
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef LINE_PATTERN_TRANSITION
uniform float u_pattern_transition;
#endif
in vec2 v_normal;in vec2 v_width2;in highp float v_linesofar;in float v_gamma_scale;in float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
in highp float v_road_z_offset;
#endif
#ifdef LINE_JOIN_NONE
in vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
uniform float u_emissive_strength;
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
void main() {
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
vec2 pattern_tl=pattern.xy;vec2 pattern_br=pattern.zw;vec2 display_size=(pattern_br-pattern_tl)/pixel_ratio;highp float pattern_size=display_size.x/u_tile_units_to_pixels;float aspect=display_size.y/v_width;float dist=length(v_normal)*v_width2.s;float blur2=(u_width_scale*blur+1.0/u_device_pixel_ratio)*v_gamma_scale;float alpha=clamp(min(dist-(v_width2.t-blur2),v_width2.s-dist)/blur2,0.0,1.0);highp float pattern_x=v_linesofar/pattern_size*aspect;highp float x=mod(pattern_x,1.0);highp float y=0.5*v_normal.y+0.5;vec2 texel_size=1.0/u_texsize;highp vec2 pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(x,y));highp vec2 lod_pos=mix(pattern_tl*texel_size-texel_size,pattern_br*texel_size+texel_size,vec2(pattern_x,y));vec4 color=textureLodCustom(u_image,pos,lod_pos);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
#ifdef LINE_PATTERN_TRANSITION
vec2 pattern_b_tl=pattern_b.xy;vec2 pattern_b_br=pattern_b.zw;highp vec2 pos_b=mix(pattern_b_tl*texel_size-texel_size,pattern_b_br*texel_size+texel_size,vec2(x,y));vec4 color_b=textureLodCustom(u_image,pos_b,lod_pos);color=color*(1.0-u_pattern_transition)+color_b*u_pattern_transition;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float trim_start=u_trim_offset[0];highp float trim_end=u_trim_offset[1];highp float line_progress=v_uv[2];if (trim_end > trim_start) {highp float start_transition=max(0.0,min(1.0,(line_progress-trim_start)/max(u_trim_fade_range[0],1.0e-9)));highp float end_transition=max(0.0,min(1.0,(trim_end-line_progress)/max(u_trim_fade_range[1],1.0e-9)));highp float transition_factor=min(start_transition,end_transition);color=mix(color,color.a*u_trim_color,transition_factor);}
#endif
#ifdef LINE_JOIN_NONE
highp float pattern_len=pattern_size/aspect;highp float segment_phase=pattern_len-mod(v_linesofar-v_pattern_data.x+pattern_len,pattern_len);highp float visible_start=segment_phase-step(pattern_len*0.5,segment_phase)*pattern_len;highp float visible_end=floor((v_pattern_data.y-segment_phase)/pattern_len)*pattern_len+segment_phase;visible_end+=step(pattern_len*0.5,v_pattern_data.y-visible_end)*pattern_len;if (v_pattern_data.x < visible_start || v_pattern_data.x >=visible_end) {color=vec4(0.0);}
#endif
#ifdef LIGHTING_3D_MODE
color=apply_lighting_with_emission_ground(color,u_emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef ELEVATED_ROADS
color.rgb*=mix(v_road_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#else
color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=(alpha*opacity);if (u_alpha_discard_threshold !=0.0) {if (color.a < u_alpha_discard_threshold) {discard;}}
#ifdef INDICATOR_CUTOUT
color=applyCutout(color,v_z_offset);
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
#define scale 0.015873016
in vec2 a_pos_normal;in vec4 a_data;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
in vec3 a_z_offset_width;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
in highp vec3 a_packed;
#endif
in highp float a_linesofar;
#ifdef LINE_JOIN_NONE
in highp vec3 a_pattern_data;out vec2 v_pattern_data;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#endif
uniform mat4 u_matrix;uniform float u_tile_units_to_pixels;uniform vec2 u_units_to_pixels;uniform mat2 u_pixels_to_tile_units;uniform float u_device_pixel_ratio;uniform float u_width_scale;uniform float u_floor_width_scale;
#ifdef ELEVATED
uniform lowp float u_zbias_factor;uniform lowp float u_tile_to_meter;float sample_elevation(vec2 apos) {
#ifdef ELEVATION_REFERENCE_SEA
return 0.0;
#else
return elevation(apos);
#endif
}
#endif
out vec2 v_normal;out vec2 v_width2;out highp float v_linesofar;out float v_gamma_scale;out float v_width;
#ifdef RENDER_LINE_TRIM_OFFSET
out highp vec3 v_uv;
#endif
#ifdef ELEVATED_ROADS
out highp float v_road_z_offset;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define mediump float blur
#pragma mapbox: define mediump float opacity
#pragma mapbox: define mediump float offset
#pragma mapbox: define mediump float gapwidth
#pragma mapbox: define mediump float width
#pragma mapbox: define mediump float floorwidth
#pragma mapbox: define mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: define mediump vec4 pattern_b
#endif
#pragma mapbox: define mediump float pixel_ratio
void main() {
#pragma mapbox: initialize mediump float blur
#pragma mapbox: initialize mediump float opacity
#pragma mapbox: initialize mediump float offset
#pragma mapbox: initialize mediump float gapwidth
#pragma mapbox: initialize mediump float width
#pragma mapbox: initialize mediump float floorwidth
#pragma mapbox: initialize mediump vec4 pattern
#ifdef LINE_PATTERN_TRANSITION
#pragma mapbox: initialize mediump vec4 pattern_b
#endif
#pragma mapbox: initialize mediump float pixel_ratio
float a_z_offset;
#if defined(ELEVATED) || defined(ELEVATED_ROADS)
a_z_offset=a_z_offset_width.x;
#endif
float ANTIALIASING=1.0/u_device_pixel_ratio/2.0;vec2 a_extrude=a_data.xy-128.0;float a_direction=mod(a_data.z,4.0)-1.0;vec2 pos=floor(a_pos_normal*0.5);vec2 normal=a_pos_normal-2.0*pos;normal.y=normal.y*2.0-1.0;v_normal=normal;gapwidth=gapwidth/2.0;float halfwidth=(u_width_scale*width)/2.0;offset=-1.0*offset*u_width_scale;float inset=gapwidth+(gapwidth > 0.0 ? ANTIALIASING : 0.0);float outset=gapwidth+halfwidth*(gapwidth > 0.0 ? 2.0 : 1.0)+(halfwidth==0.0 ? 0.0 : ANTIALIASING);vec2 dist=outset*a_extrude*scale;float u=0.5*a_direction;float t=1.0-abs(u);vec2 offset2=offset*a_extrude*scale*normal.y*mat2(t,-u,u,t);float hidden=float(opacity==0.0);vec2 extrude=dist*u_pixels_to_tile_units;vec4 projected_extrude=u_matrix*vec4(extrude,0.0,0.0);vec2 projected_extrude_xy=projected_extrude.xy;
#ifdef ELEVATED_ROADS
v_road_z_offset=a_z_offset;gl_Position=u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,a_z_offset,1.0)+projected_extrude;
#else
#ifdef ELEVATED
vec2 offsetTile=offset2*u_pixels_to_tile_units;vec2 offset_pos=pos+offsetTile;float ele=0.0;
#ifdef CROSS_SLOPE_VERTICAL
float top=a_pos_normal.y-2.0*floor(a_pos_normal.y*0.5);float line_height=2.0*u_tile_to_meter*outset*top*u_pixels_to_tile_units[1][1]+a_z_offset;ele=sample_elevation(offset_pos)+line_height;projected_extrude=vec4(0);
#else
#ifdef CROSS_SLOPE_HORIZONTAL
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,max(ele1,ele2));ele=ele_max+a_z_offset;
#else
float ele0=sample_elevation(offset_pos);float ele1=max(sample_elevation(offset_pos+extrude),sample_elevation(offset_pos+extrude/2.0));float ele2=max(sample_elevation(offset_pos-extrude),sample_elevation(offset_pos-extrude/2.0));float ele_max=max(ele0,0.5*(ele1+ele2));ele=ele_max-ele0+ele1+a_z_offset;
#endif
#endif
gl_Position=u_matrix*vec4(offset_pos,ele,1.0)+projected_extrude;float z=clamp(gl_Position.z/gl_Position.w,0.5,1.0);float zbias=max(0.00005,(pow(z,0.8)-z)*u_zbias_factor*u_exaggeration);gl_Position.z-=(gl_Position.w*zbias);gl_Position=mix(gl_Position,AWAY,hidden);
#else
gl_Position=mix(u_matrix*vec4(pos+offset2*u_pixels_to_tile_units,0.0,1.0)+projected_extrude,AWAY,hidden);
#endif
#endif
#ifdef ELEVATED_ROADS
#ifdef RENDER_SHADOWS
vec3 shd_pos=vec3(pos+(offset2+dist)*u_pixels_to_tile_units,a_z_offset);vec3 shd_pos0=shd_pos;vec3 shd_pos1=shd_pos;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#endif
#ifndef RENDER_TO_TEXTURE
float extrude_length_without_perspective=length(dist);float extrude_length_with_perspective=length(projected_extrude_xy/gl_Position.w*u_units_to_pixels);v_gamma_scale=mix(extrude_length_without_perspective/extrude_length_with_perspective,1.0,step(0.01,blur));
#else
v_gamma_scale=1.0;
#endif
#ifdef RENDER_LINE_TRIM_OFFSET
highp float a_uv_x=a_packed[0];highp float line_progress=a_packed[2];v_uv=vec3(a_uv_x,0.0,line_progress);
#endif
v_linesofar=a_linesofar;v_width2=vec2(outset,inset);v_width=(floorwidth*u_floor_width_scale);
#ifdef LINE_JOIN_NONE
v_width=(floorwidth*u_floor_width_scale)+ANTIALIASING;mediump float pixels_to_tile_units=1.0/u_tile_units_to_pixels;mediump float pixel_ratio_inverse=1.0/pixel_ratio;mediump float aspect=v_width/((pattern.w-pattern.y)*pixel_ratio_inverse);highp float subt_multiple=(pattern.z-pattern.x)*pixel_ratio_inverse*pixels_to_tile_units*aspect*32.0;highp float subt=floor(a_pattern_data.z/subt_multiple)*subt_multiple;float offset_sign=(fract(a_pattern_data.x)-0.5)*4.0;float line_progress_offset=offset_sign*v_width*0.5*pixels_to_tile_units;v_linesofar=(a_pattern_data.z-subt)+a_linesofar+line_progress_offset;v_pattern_data=vec2(a_pattern_data.x+line_progress_offset,a_pattern_data.y);
#endif
#ifdef FOG
v_fog_pos=fog_position(pos);
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=a_z_offset;
#endif
}`),raster:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
#include "_prelude_raster_array.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;uniform highp float u_zoom_transition;in vec2 v_pos0;in vec2 v_pos1;in float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
in float v_split_fade;
#endif
uniform float u_brightness_low;uniform float u_brightness_high;uniform float u_saturation_factor;uniform float u_contrast_factor;uniform vec3 u_spin_weights;uniform float u_emissive_strength;
#ifndef RASTER_ARRAY
uniform highp sampler2D u_image0;uniform sampler2D u_image1;
#endif
#ifdef RASTER_COLOR
uniform sampler2D u_color_ramp;uniform highp vec4 u_colorization_mix;uniform highp float u_colorization_offset;uniform vec2 u_texture_res;
#endif
void main() {vec4 color0,color1,color;vec2 value;
#ifdef RASTER_COLOR
#ifdef RASTER_ARRAY
#ifdef RASTER_ARRAY_LINEAR
value=mix(
raTexture2D_image0_linear(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_linear(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#else
value=mix(
raTexture2D_image0_nearest(v_pos0,u_texture_res,u_colorization_mix,u_colorization_offset),raTexture2D_image1_nearest(v_pos1,u_texture_res,u_colorization_mix,u_colorization_offset),u_fade_t
);
#endif
if (value.y > 0.0) value.x/=value.y;
#else
color=mix(texture(u_image0,v_pos0),texture(u_image1,v_pos1),u_fade_t);value=vec2(u_colorization_offset+dot(color.rgb,u_colorization_mix.rgb),color.a);
#endif
color=texture(u_color_ramp,vec2(value.x,0.5));if (color.a > 0.0) color.rgb/=color.a;color.a*=value.y;
#else
color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);
#endif
color.a*=u_opacity;
#ifdef GLOBE_POLES
color.a*=1.0-smoothstep(0.0,0.05,u_zoom_transition);
#endif
vec3 rgb=color.rgb;rgb=vec3(
dot(rgb,u_spin_weights.xyz),dot(rgb,u_spin_weights.zxy),dot(rgb,u_spin_weights.yzx));float average=(color.r+color.g+color.b)/3.0;rgb+=(average-rgb)*u_saturation_factor;rgb=(rgb-0.5)*u_contrast_factor+0.5;vec3 u_high_vec=vec3(u_brightness_low,u_brightness_low,u_brightness_low);vec3 u_low_vec=vec3(u_brightness_high,u_brightness_high,u_brightness_high);vec3 out_color=mix(u_high_vec,u_low_vec,rgb);
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),u_emissive_strength).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef PROJECTION_GLOBE_VIEW
glFragColor*=mix(1.0,1.0-smoothstep(0.0,0.05,u_zoom_transition),smoothstep(0.8,0.9,v_split_fade));
#endif
#ifdef RENDER_CUTOFF
glFragColor=glFragColor*cutoff_opacity(u_cutoff_params,v_depth);
#endif
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform vec2 u_perspective_transform;uniform vec2 u_texture_offset;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;in vec2 a_texture_pos;
#endif
out vec2 v_pos0;out vec2 v_pos1;out float v_depth;
#ifdef PROJECTION_GLOBE_VIEW
out float v_split_fade;
#endif
void main() {vec2 uv;
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;gl_Position=u_matrix*u_globe_matrix*vec4(globe_pos   ,1.0);uv=a_uv;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(a_globe_pos,1.0)).xyz);
#endif
#else
float w=1.0+dot(a_texture_pos,u_perspective_transform);uv=a_texture_pos/8192.0;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);    
v_split_fade=0.0;if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;float opposite_merc_center=mod(u_merc_center.x+0.5,1.0);float dist_from_poles=(abs(mercatorY-0.5)*2.0);float range=0.1;v_split_fade=abs(opposite_merc_center-mercatorX);v_split_fade=clamp(1.0-v_split_fade,0.0,1.0);v_split_fade=max(smoothstep(1.0-range,1.0,dist_from_poles),max(smoothstep(1.0-range,1.0,v_split_fade),smoothstep(1.0-range,1.0,1.0-v_split_fade)));}float tiles=u_grid_matrix[0][2];if (tiles > 0.0) {float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvY=mercatorY*tiles-idy;float uvX=mercatorX*tiles-idx;uv=vec2(uvX,uvY);}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;v_pos0=u_texture_offset.x+u_texture_offset.y*v_pos0;v_pos1=u_texture_offset.x+u_texture_offset.y*v_pos1;
#ifdef RENDER_CUTOFF
v_depth=gl_Position.z;
#endif
}`),rasterParticle:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_fade_t;uniform float u_opacity;uniform highp float u_raster_elevation;in vec2 v_pos0;in vec2 v_pos1;uniform sampler2D u_image0;uniform sampler2D u_image1;void main() {vec4 color0,color1,color;color0=texture(u_image0,v_pos0);color1=texture(u_image1,v_pos1);if (color0.a > 0.0) color0.rgb/=color0.a;if (color1.a > 0.0) color1.rgb/=color1.a;color=mix(color0,color1,u_fade_t);color.a*=u_opacity;vec3 out_color=color.rgb;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(vec4(out_color,1.0),0.0).rgb;
#endif
#ifdef FOG
highp float fog_limit_high_meters=1000000.0;highp float fog_limit_low_meters=600000.0;float fog_limit=1.0-smoothstep(fog_limit_low_meters,fog_limit_high_meters,u_raster_elevation);out_color=fog_dither(fog_apply(out_color,v_fog_pos,fog_limit));
#endif
glFragColor=vec4(out_color*color.a,color.a);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
uniform mat4 u_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform mat3 u_grid_matrix;uniform vec2 u_tl_parent;uniform float u_scale_parent;uniform float u_raster_elevation;uniform float u_zoom_transition;uniform vec2 u_merc_center;
#define GLOBE_UPSCALE GLOBE_RADIUS/6371008.8
in vec2 a_pos;in vec2 a_texture_pos;out vec2 v_pos0;out vec2 v_pos1;void main() {float w=1.0;vec2 uv;
#ifdef PROJECTION_GLOBE_VIEW
vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float mercatorX=mercatorXfromLng(latLng[1]);float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];float uvX=mercatorX*tiles-idx;float uvY=mercatorY*tiles-idy;uv=vec2(uvX,uvY);vec3 globe_pos=latLngToECEF(latLng.xy);globe_pos+=normalize(globe_pos)*u_raster_elevation*GLOBE_UPSCALE;vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {vec2 merc_pos=vec2(mercatorX,mercatorY);merc_world_pos=vec4(merc_pos,u_raster_elevation,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition)*w,w);gl_Position=u_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
#else
uv=a_texture_pos/8192.0;gl_Position=u_matrix*vec4(a_pos*w,u_raster_elevation*w,w);
#ifdef FOG
v_fog_pos=fog_position(a_pos);
#endif
#endif
v_pos0=uv;v_pos1=(v_pos0*u_scale_parent)+u_tl_parent;}`),rasterParticleDraw:Nr("uniform sampler2D u_color_ramp;in float v_particle_speed;void main() {glFragColor=texture(u_color_ramp,vec2(v_particle_speed,0.5));}",`#include "_prelude_raster_particle.glsl"
in float a_index;uniform sampler2D u_particle_texture;uniform float u_particle_texture_side_len;uniform vec2 u_tile_offset;out float v_particle_speed;void main() {ivec2 pixel_coord=ivec2(
mod(a_index,u_particle_texture_side_len),a_index/u_particle_texture_side_len);vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);vec2 pos=unpack_pos_from_rgba(pixel)+u_tile_offset;vec2 tex_coord=fract(pos);vec2 velocity=lookup_velocity(tex_coord);if (velocity==INVALID_VELOCITY) {gl_Position=AWAY;v_particle_speed=0.0;} else {gl_Position=vec4(2.0*pos-1.0,0,1);v_particle_speed=length(velocity);}gl_PointSize=1.0;}`),rasterParticleTexture:Nr("uniform sampler2D u_texture;uniform float u_opacity;in vec2 v_tex_pos;void main() {vec4 color=texture(u_texture,v_tex_pos);glFragColor=vec4(floor(255.0*color*u_opacity)/255.0);}","in vec2 a_pos;out vec2 v_tex_pos;void main() {vec2 uv=0.5*a_pos+vec2(0.5);v_tex_pos=uv;gl_Position=vec4(a_pos,0.0,1.0);}"),rasterParticleUpdate:Nr(`#include "_prelude_raster_particle.glsl"
uniform sampler2D u_particle_texture;uniform mediump float u_particle_texture_side_len;uniform mediump float u_speed_factor;uniform highp float u_reset_rate;uniform highp float u_rand_seed;in highp vec2 v_tex_coord;vec2 linearstep(vec2 edge0,vec2 edge1,vec2 x) {return  clamp((x-edge0)/(edge1-edge0),vec2(0),vec2(1));}const highp vec3 rand_constants=vec3(12.9898,78.233,4375.85453);highp float rand(const highp vec2 co) {highp float t=dot(rand_constants.xy,co);return fract(sin(t)*(rand_constants.z+t));}void main() {ivec2 pixel_coord=ivec2(v_tex_coord*u_particle_texture_side_len);highp vec4 pixel=texelFetch(u_particle_texture,pixel_coord,0);highp vec2 pos=unpack_pos_from_rgba(pixel);highp vec2 velocity=lookup_velocity(clamp(pos,0.0,1.0));highp vec2 dp=velocity==INVALID_VELOCITY ? vec2(0) : velocity*u_speed_factor;pos=pos+dp;highp vec2 seed=(pos+v_tex_coord)*u_rand_seed;highp vec2 random_pos=vec2(rand(seed+1.3),rand(seed+2.1));highp vec2 persist_rate=pow(
linearstep(vec2(-u_particle_pos_offset),vec2(0),pos)*linearstep(vec2(1.0+u_particle_pos_offset),vec2(1),pos),vec2(4)
);highp vec2 per_frame_persist=pow(persist_rate,abs(dp)/u_particle_pos_offset);highp float drop_rate=1.0-per_frame_persist.x*per_frame_persist.y;drop_rate=any(greaterThanEqual(abs(pos-0.5),vec2(0.5+u_particle_pos_offset))) ? 1.0 : drop_rate;highp float drop=step(1.0-drop_rate-u_reset_rate,rand(seed));highp vec2 next_pos=mix(pos,random_pos,drop);glFragColor=pack_pos_to_rgba(next_pos);}`,"in vec2 a_pos;out vec2 v_tex_coord;void main() {v_tex_coord=0.5*(a_pos+vec2(1.0));gl_Position=vec4(a_pos,0.0,1.0);}"),symbol:Nr(`#include "_prelude_lighting.glsl"
#include "_prelude_shadow.fragment.glsl"
#define SDF_PX 8.0
#define SDF 1.0
#define ICON 0.0
uniform sampler2D u_texture;uniform sampler2D u_texture_icon;uniform highp float u_gamma_scale;uniform lowp float u_device_pixel_ratio;uniform bool u_is_text;uniform bool u_is_halo;uniform lowp float u_scale_factor;
#ifdef ICON_TRANSITION
uniform float u_icon_transition;
#endif
#ifdef COLOR_ADJUSTMENT
uniform mat4 u_color_adj_mat;
#endif
#ifdef INDICATOR_CUTOUT
in highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
in highp float v_z_offset;
#endif
#endif
in vec2 v_tex_a;
#ifdef ICON_TRANSITION
in vec2 v_tex_b;
#endif
in float v_draw_halo;in vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
in float is_sdf;in vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform vec3 u_ground_shadow_factor;in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in highp float v_depth;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
vec4 out_color;float fade_opacity=v_gamma_scale_size_fade_opacity[2];
#ifdef RENDER_TEXT_AND_SYMBOL
if (is_sdf==ICON) {vec2 tex_icon=v_tex_a_icon;lowp float alpha=opacity*fade_opacity;glFragColor=texture(u_texture_icon,tex_icon)*alpha;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
return;}
#endif
#ifdef RENDER_SDF
float EDGE_GAMMA=0.105/u_device_pixel_ratio;float gamma_scale=v_gamma_scale_size_fade_opacity.x;float size=v_gamma_scale_size_fade_opacity.y;float fontScale=u_is_text ? size/24.0 : size;out_color=fill_color;highp float gamma=EDGE_GAMMA/(fontScale*u_gamma_scale);lowp float buff=(256.0-64.0)/256.0;bool draw_halo=v_draw_halo > 0.0;if (draw_halo) {out_color=halo_color;gamma=(halo_blur*u_scale_factor*1.19/SDF_PX+EDGE_GAMMA)/(fontScale*u_gamma_scale);buff=(6.0-halo_width*u_scale_factor/fontScale)/SDF_PX;}lowp float dist=texture(u_texture,v_tex_a).r;highp float gamma_scaled=gamma*gamma_scale;highp float alpha=smoothstep(buff-gamma_scaled,buff+gamma_scaled,dist);out_color*=alpha;
#else
#ifdef ICON_TRANSITION
vec4 a=texture(u_texture,v_tex_a)*(1.0-u_icon_transition);vec4 b=texture(u_texture,v_tex_b)*u_icon_transition;out_color=(a+b);
#else
out_color=texture(u_texture,v_tex_a);
#endif
#ifdef APPLY_LUT_ON_GPU
out_color=applyLUT(u_lutTexture,out_color);
#endif
#ifdef COLOR_ADJUSTMENT
out_color=u_color_adj_mat*out_color;
#endif
#endif
out_color*=opacity*fade_opacity;
#ifdef LIGHTING_3D_MODE
out_color=apply_lighting_with_emission_ground(out_color,emissive_strength);
#ifdef RENDER_SHADOWS
float light=shadowed_light_factor(v_pos_light_view_0,v_pos_light_view_1,v_depth);
#ifdef TERRAIN
out_color.rgb*=mix(u_ground_shadow_factor,vec3(1.0),light);
#else
out_color.rgb*=mix(v_z_offset !=0.0 ? u_ground_shadow_factor : vec3(1.0),vec3(1.0),light);
#endif
#endif
#endif
#ifdef INDICATOR_CUTOUT
out_color=applyCutout(out_color,v_z_offset);
#endif
#ifdef FEATURE_CUTOUT
out_color=apply_feature_cutout(out_color,gl_FragCoord);
#endif
glFragColor=out_color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_terrain.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec4 a_pos_offset;in vec4 a_tex_size;in vec4 a_pixeloffset;in vec4 a_projected_pos;in float a_fade_opacity;
#ifdef Z_OFFSET
in float a_auto_z_offset;
#endif
#ifdef PROJECTION_GLOBE_VIEW
in vec3 a_globe_anchor;in vec3 a_globe_normal;
#endif
#ifdef ICON_TRANSITION
in vec2 a_texb;
#endif
#ifdef OCCLUSION_QUERIES
in float a_occlusion_query_opacity;
#endif
#ifdef ELEVATED_ROADS
in vec3 a_x_axis;in vec3 a_y_axis;uniform float u_normal_scale;
#endif
#ifdef INDICATOR_CUTOUT
out highp float v_z_offset;
#else
#ifdef RENDER_SHADOWS
out highp float v_z_offset;
#endif
#endif
uniform bool u_is_size_zoom_constant;uniform bool u_is_size_feature_constant;uniform highp float u_size_t;uniform highp float u_size;uniform mat4 u_matrix;uniform mat4 u_inv_matrix;uniform mat4 u_label_plane_matrix;uniform mat4 u_coord_matrix;uniform bool u_is_text;uniform bool u_elevation_from_sea;uniform bool u_pitch_with_map;uniform bool u_rotate_symbol;uniform highp float u_aspect_ratio;uniform highp float u_camera_to_center_distance;uniform float u_fade_change;uniform vec2 u_texsize;uniform vec3 u_up_vector;uniform vec2 u_texsize_icon;uniform bool u_is_halo;
#ifdef PROJECTION_GLOBE_VIEW
uniform vec3 u_tile_id;uniform mat4 u_inv_rot_matrix;uniform vec2 u_merc_center;uniform vec3 u_camera_forward;uniform float u_zoom_transition;uniform vec3 u_ecef_origin;uniform mat4 u_tile_matrix;
#endif
out vec2 v_tex_a;
#ifdef ICON_TRANSITION
out vec2 v_tex_b;
#endif
out float v_draw_halo;out vec3 v_gamma_scale_size_fade_opacity;
#ifdef RENDER_TEXT_AND_SYMBOL
out float is_sdf;out vec2 v_tex_a_icon;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out highp float v_depth;
#endif
#pragma mapbox: define highp vec4 fill_color
#pragma mapbox: define highp vec4 halo_color
#pragma mapbox: define lowp float opacity
#pragma mapbox: define lowp float halo_width
#pragma mapbox: define lowp float halo_blur
#pragma mapbox: define lowp float emissive_strength
#pragma mapbox: define lowp float occlusion_opacity
#pragma mapbox: define lowp float z_offset
void main() {
#pragma mapbox: initialize highp vec4 fill_color
#pragma mapbox: initialize highp vec4 halo_color
#pragma mapbox: initialize lowp float opacity
#pragma mapbox: initialize lowp float halo_width
#pragma mapbox: initialize lowp float halo_blur
#pragma mapbox: initialize lowp float emissive_strength
#pragma mapbox: initialize lowp float occlusion_opacity
#pragma mapbox: initialize lowp float z_offset
vec2 a_pos=a_pos_offset.xy;vec2 a_offset=a_pos_offset.zw;vec2 a_tex=a_tex_size.xy;vec2 a_size=a_tex_size.zw;float a_size_min=floor(a_size[0]*0.5);vec2 a_pxoffset=a_pixeloffset.xy;vec2 a_min_font_scale=a_pixeloffset.zw/256.0;highp float segment_angle=-a_projected_pos[3];float size;if (!u_is_size_zoom_constant && !u_is_size_feature_constant) {size=mix(a_size_min,a_size[1],u_size_t)/128.0;} else if (u_is_size_zoom_constant && !u_is_size_feature_constant) {size=a_size_min/128.0;} else {size=u_size;}vec2 tile_anchor=a_pos;float e=u_elevation_from_sea ? z_offset : z_offset+elevation(tile_anchor);
#ifdef Z_OFFSET
e+=a_auto_z_offset;
#endif
vec3 h=elevationVector(tile_anchor)*e;float globe_occlusion_fade;vec3 world_pos;vec3 mercator_pos;vec3 world_pos_globe;
#ifdef PROJECTION_GLOBE_VIEW
mercator_pos=mercator_tile_position(u_inv_rot_matrix,tile_anchor,u_tile_id,u_merc_center);world_pos_globe=a_globe_anchor+h;world_pos=mix_globe_mercator(world_pos_globe,mercator_pos,u_zoom_transition);vec4 ecef_point=u_tile_matrix*vec4(world_pos,1.0);vec3 origin_to_point=ecef_point.xyz-u_ecef_origin;globe_occlusion_fade=dot(origin_to_point,u_camera_forward) >=0.0 ? 0.0 : 1.0;
#else
world_pos=vec3(tile_anchor,0)+h;globe_occlusion_fade=1.0;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1);highp float camera_to_anchor_distance=projected_point.w;highp float distance_ratio=u_pitch_with_map ?
camera_to_anchor_distance/u_camera_to_center_distance :
u_camera_to_center_distance/camera_to_anchor_distance;highp float perspective_ratio=clamp(
0.5+0.5*distance_ratio,0.0,1.5);size*=perspective_ratio;float font_scale=u_is_text ? size/24.0 : size;highp float symbol_rotation=0.0;if (u_rotate_symbol) {vec4 offsetprojected_point;vec2 a;
#ifdef PROJECTION_GLOBE_VIEW
vec3 displacement=vec3(a_globe_normal.z,0,-a_globe_normal.x);offsetprojected_point=u_matrix*vec4(a_globe_anchor+displacement,1);vec4 projected_point_globe=u_matrix*vec4(world_pos_globe,1);a=projected_point_globe.xy/projected_point_globe.w;
#else
offsetprojected_point=u_matrix*vec4(tile_anchor+vec2(1,0),0,1);a=projected_point.xy/projected_point.w;
#endif
vec2 b=offsetprojected_point.xy/offsetprojected_point.w;symbol_rotation=atan((b.y-a.y)/u_aspect_ratio,b.x-a.x);}vec4 projected_pos;
#ifdef PROJECTION_GLOBE_VIEW
#ifdef PROJECTED_POS_ON_VIEWPORT
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xyz+h,1.0);
#else
vec3 proj_pos=mix_globe_mercator(a_projected_pos.xyz,mercator_pos,u_zoom_transition)+h;projected_pos=u_label_plane_matrix*vec4(proj_pos,1.0);    
#endif
#else
projected_pos=u_label_plane_matrix*vec4(a_projected_pos.xy,h.z,1.0);
#endif
highp float angle_sin=sin(segment_angle+symbol_rotation);highp float angle_cos=cos(segment_angle+symbol_rotation);mat2 rotation_matrix=mat2(angle_cos,-1.0*angle_sin,angle_sin,angle_cos);float z=0.0;vec2 offset=rotation_matrix*(a_offset/32.0*max(a_min_font_scale,font_scale)+a_pxoffset/16.0);
#ifdef TERRAIN
#ifdef PITCH_WITH_MAP_TERRAIN
vec4 tile_pos=u_label_plane_matrix_inv*vec4(a_projected_pos.xy+offset,0.0,1.0);z=elevation(tile_pos.xy);
#endif
#endif
#ifdef Z_OFFSET
z+=u_pitch_with_map ? a_auto_z_offset+z_offset : 0.0;
#else
z+=u_pitch_with_map ? z_offset : 0.0;
#endif
float occlusion_fade=globe_occlusion_fade;vec2 fade_opacity=unpack_opacity(a_fade_opacity);float fade_change=fade_opacity[1] > 0.5 ? u_fade_change :-u_fade_change;float out_fade_opacity=max(0.0,min(occlusion_fade,fade_opacity[0]+fade_change));
#ifdef DEPTH_OCCLUSION
float depth_occlusion=occlusionFadeMultiSample(projected_point);float depth_occlusion_multplier=mix(occlusion_opacity,1.0,depth_occlusion);out_fade_opacity*=depth_occlusion_multplier;
#endif
#ifdef OCCLUSION_QUERIES
float occludedFadeMultiplier=mix(occlusion_opacity,1.0,a_occlusion_query_opacity);out_fade_opacity*=occludedFadeMultiplier;
#endif
float alpha=opacity*out_fade_opacity;float hidden=float(alpha==0.0 || projected_point.w <=0.0 || occlusion_fade==0.0);vec3 pos;
#ifdef PROJECTION_GLOBE_VIEW
vec3 xAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,u_up_vector)) : vec3(1,0,0);vec3 yAxis=u_pitch_with_map ? normalize(cross(a_globe_normal,xAxis)) : vec3(0,1,0);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
#ifdef ELEVATED_ROADS
vec3 xAxis=vec3(a_x_axis.xy,a_x_axis.z*u_normal_scale);vec3 yAxis=vec3(a_y_axis.xy,a_y_axis.z*u_normal_scale);pos=projected_pos.xyz/projected_pos.w+xAxis*offset.x+yAxis*offset.y;
#else
pos=vec3(projected_pos.xy/projected_pos.w+offset,z);
#endif
#endif
gl_Position=mix(u_coord_matrix*vec4(pos,1.0),AWAY,hidden);float gamma_scale=gl_Position.w;v_draw_halo=(u_is_halo && float(gl_InstanceID)==0.0) ? 1.0 : 0.0;v_gamma_scale_size_fade_opacity=vec3(gamma_scale,size,out_fade_opacity);v_tex_a=a_tex/u_texsize;
#ifdef RENDER_TEXT_AND_SYMBOL
is_sdf=a_size[0]-2.0*a_size_min;v_tex_a_icon=a_tex/u_texsize_icon;
#endif
#ifdef ICON_TRANSITION
v_tex_b=a_texb/u_texsize;
#endif
#ifdef RENDER_SHADOWS
vec4 shd_pos=u_inv_matrix*vec4(pos,1.0);vec3 shd_pos0=shd_pos.xyz;vec3 shd_pos1=shd_pos.xyz;
#ifdef NORMAL_OFFSET
vec3 shd_pos_offset=shadow_normal_offset(vec3(0.0,0.0,1.0));shd_pos0+=shd_pos_offset*shadow_normal_offset_multiplier0();shd_pos1+=shd_pos_offset*shadow_normal_offset_multiplier1();
#endif
v_pos_light_view_0=u_light_matrix_0*vec4(shd_pos0,1);v_pos_light_view_1=u_light_matrix_1*vec4(shd_pos1,1);v_depth=gl_Position.w;
#endif
#ifdef INDICATOR_CUTOUT
v_z_offset=e;
#else
#ifdef RENDER_SHADOWS
v_z_offset=e;
#endif
#endif
}`),terrainRaster:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;in vec2 v_pos0;
#ifdef FOG
in float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
in vec4 v_pos_light_view_0;in vec4 v_pos_light_view_1;
#endif
uniform vec3 u_ground_shadow_factor;void main() {vec4 image_color=texture(u_image0,v_pos0);vec4 color;
#ifdef LIGHTING_3D_MODE
const vec3 normal=vec3(0.0,0.0,1.0);
#ifdef RENDER_SHADOWS
float cutoffOpacity=1.0;
#ifdef RENDER_CUTOFF
cutoffOpacity=cutoff_opacity(u_cutoff_params,1.0/gl_FragCoord.w);
#endif
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
vec3 unlit_base=image_color.rgb*(1.0-image_color.a);vec3 emissive_base=image_color.rgb*image_color.a;float ndotl=u_shadow_direction.z;float occlusion=ndotl < 0.0 ? 1.0 : shadow_occlusion(v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w,0.0);ndotl=max(0.0,ndotl);vec3 lit=apply_lighting(unlit_base,normal,mix(1.0,(1.0-(u_shadow_intensity*occlusion))*ndotl,cutoffOpacity));vec3 emissive=compute_emissive_draped(emissive_base,1.0-u_shadow_intensity,occlusion,u_ground_shadow_factor);color.rgb=lit+emissive;color.a=1.0;
#else
float lighting_factor=shadowed_light_factor_normal_unbiased(normal,v_pos_light_view_0,v_pos_light_view_1,1.0/gl_FragCoord.w);color=apply_lighting(image_color,normal,mix(1.0,lighting_factor,cutoffOpacity));
#endif
#else
float lighting_factor=u_lighting_directional_dir.z;color=apply_lighting(image_color,normal,lighting_factor);
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color.rgb=mix(color.rgb,image_color.rgb,image_color.a);color.a=1.0;
#endif
#endif
#else
color=image_color;
#endif
#ifdef FOG
#ifdef ZERO_EXAGGERATION
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#else
color=fog_dither(fog_apply_from_vert(color,v_fog_opacity));
#endif
#endif
glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;uniform float u_skirt_height;in vec2 a_pos;out vec2 v_pos0;
#ifdef FOG
out float v_fog_opacity;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out vec4 v_pos_light_view_0;out vec4 v_pos_light_view_1;
#endif
void main() {vec3 decomposedPosAndSkirt=decomposeToPosAndSkirt(a_pos);float skirt=decomposedPosAndSkirt.z;vec2 decodedPos=decomposedPosAndSkirt.xy;float elevation=elevation(decodedPos)-skirt*u_skirt_height;v_pos0=decodedPos/8192.0;gl_Position=u_matrix*vec4(decodedPos,elevation,1.0);
#ifdef FOG
#ifdef ZERO_EXAGGERATION
v_fog_pos=fog_position(decodedPos);
#else
v_fog_opacity=fog(fog_position(vec3(decodedPos,elevation)));
#endif
#endif
#ifdef RENDER_SHADOWS
vec3 pos=vec3(decodedPos,elevation);v_pos_light_view_0=u_light_matrix_0*vec4(pos,1.);v_pos_light_view_1=u_light_matrix_1*vec4(pos,1.);
#endif
}`),terrainDepth:Nr("precision highp float;in float v_depth;void main() {glFragColor=pack_depth(v_depth);}",`#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_matrix;in vec2 a_pos;out float v_depth;void main() {float elevation=elevation(a_pos);gl_Position=u_matrix*vec4(a_pos,elevation,1.0);v_depth=gl_Position.z/gl_Position.w;}`),skybox:Nr(`#include "_prelude_fog.fragment.glsl"
in lowp vec3 v_uv;uniform lowp samplerCube u_cubemap;uniform lowp float u_opacity;uniform highp float u_temporal_offset;uniform highp vec3 u_sun_direction;float sun_disk(highp vec3 ray_direction,highp vec3 sun_direction) {highp float cos_angle=dot(normalize(ray_direction),sun_direction);const highp float cos_sun_angular_diameter=0.99996192306;const highp float smoothstep_delta=1e-5;return smoothstep(
cos_sun_angular_diameter-smoothstep_delta,cos_sun_angular_diameter+smoothstep_delta,cos_angle);}float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec3 uv=v_uv;const float y_bias=0.015;uv.y+=y_bias;uv.y=pow(abs(uv.y),1.0/5.0);uv.y=map(uv.y,0.0,1.0,-1.0,1.0);vec3 sky_color=texture(u_cubemap,uv).rgb;
#ifdef FOG
sky_color=fog_apply_sky_gradient(v_uv.xzy,sky_color);
#endif
sky_color+=0.1*sun_disk(v_uv,u_sun_direction);glFragColor=vec4(sky_color*u_opacity,u_opacity);
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,eu),skyboxGradient:Nr(`#include "_prelude_fog.fragment.glsl"
in highp vec3 v_uv;uniform lowp sampler2D u_color_ramp;uniform highp vec3 u_center_direction;uniform lowp float u_radius;uniform lowp float u_opacity;uniform highp float u_temporal_offset;void main() {float progress=acos(dot(normalize(v_uv),u_center_direction))/u_radius;vec4 color=texture(u_color_ramp,vec2(progress,0.5));
#ifdef FOG
color.rgb=fog_apply_sky_gradient(v_uv.xzy,color.rgb/color.a)*color.a;
#endif
color*=u_opacity;glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
}`,eu),skyboxCapture:Nr(`
in highp vec3 v_position;uniform highp float u_sun_intensity;uniform highp float u_luminance;uniform lowp vec3 u_sun_direction;uniform highp vec4 u_color_tint_r;uniform highp vec4 u_color_tint_m;precision highp float;
#define BETA_R                  vec3(5.5e-6,13.0e-6,22.4e-6)
#define BETA_M                  vec3(21e-6,21e-6,21e-6)
#define MIE_G                   0.76
#define DENSITY_HEIGHT_SCALE_R  8000.0
#define DENSITY_HEIGHT_SCALE_M  1200.0
#define PLANET_RADIUS           6360e3
#define ATMOSPHERE_RADIUS       6420e3
#define SAMPLE_STEPS            10
#define DENSITY_STEPS           4
float ray_sphere_exit(vec3 orig,vec3 dir,float radius) {float a=dot(dir,dir);float b=2.0*dot(dir,orig);float c=dot(orig,orig)-radius*radius;float d=sqrt(b*b-4.0*a*c);return (-b+d)/(2.0*a);}vec3 extinction(vec2 density) {return exp(-vec3(BETA_R*u_color_tint_r.a*density.x+BETA_M*u_color_tint_m.a*density.y));}vec2 local_density(vec3 point) {float height=max(length(point)-PLANET_RADIUS,0.0);float exp_r=exp(-height/DENSITY_HEIGHT_SCALE_R);float exp_m=exp(-height/DENSITY_HEIGHT_SCALE_M);return vec2(exp_r,exp_m);}float phase_ray(float cos_angle) {return (3.0/(16.0*PI))*(1.0+cos_angle*cos_angle);}float phase_mie(float cos_angle) {return (3.0/(8.0*PI))*((1.0-MIE_G*MIE_G)*(1.0+cos_angle*cos_angle))/((2.0+MIE_G*MIE_G)*pow(1.0+MIE_G*MIE_G-2.0*MIE_G*cos_angle,1.5));}vec2 density_to_atmosphere(vec3 point,vec3 light_dir) {float ray_len=ray_sphere_exit(point,light_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(DENSITY_STEPS);vec2 density_point_to_atmosphere=vec2(0.0);for (int i=0; i < DENSITY_STEPS;++i) {vec3 point_on_ray=point+light_dir*((float(i)+0.5)*step_len);density_point_to_atmosphere+=local_density(point_on_ray)*step_len;;}return density_point_to_atmosphere;}vec3 atmosphere(vec3 ray_dir,vec3 sun_direction,float sun_intensity) {vec2 density_orig_to_point=vec2(0.0);vec3 scatter_r=vec3(0.0);vec3 scatter_m=vec3(0.0);vec3 origin=vec3(0.0,PLANET_RADIUS,0.0);float ray_len=ray_sphere_exit(origin,ray_dir,ATMOSPHERE_RADIUS);float step_len=ray_len/float(SAMPLE_STEPS);for (int i=0; i < SAMPLE_STEPS;++i) {vec3 point_on_ray=origin+ray_dir*((float(i)+0.5)*step_len);vec2 density=local_density(point_on_ray)*step_len;density_orig_to_point+=density;vec2 density_point_to_atmosphere=density_to_atmosphere(point_on_ray,sun_direction);vec2 density_orig_to_atmosphere=density_orig_to_point+density_point_to_atmosphere;vec3 extinction=extinction(density_orig_to_atmosphere);scatter_r+=density.x*extinction;scatter_m+=density.y*extinction;}float cos_angle=dot(ray_dir,sun_direction);float phase_r=phase_ray(cos_angle);float phase_m=phase_mie(cos_angle);vec3 beta_r=BETA_R*u_color_tint_r.rgb*u_color_tint_r.a;vec3 beta_m=BETA_M*u_color_tint_m.rgb*u_color_tint_m.a;return (scatter_r*phase_r*beta_r+scatter_m*phase_m*beta_m)*sun_intensity;}const float A=0.15;const float B=0.50;const float C=0.10;const float D=0.20;const float E=0.02;const float F=0.30;vec3 uncharted2_tonemap(vec3 x) {return ((x*(A*x+C*B)+D*E)/(x*(A*x+B)+D*F))-E/F;}void main() {vec3 ray_direction=v_position;ray_direction.y=pow(ray_direction.y,5.0);const float y_bias=0.015;ray_direction.y+=y_bias;vec3 color=atmosphere(normalize(ray_direction),u_sun_direction,u_sun_intensity);float white_scale=1.0748724675633854;color=uncharted2_tonemap((log2(2.0/pow(u_luminance,4.0)))*color)*white_scale;glFragColor=vec4(color,1.0);}`,"in highp vec3 a_pos_3f;uniform mat3 u_matrix_3f;out highp vec3 v_position;float map(float value,float start,float end,float new_start,float new_end) {return ((value-start)*(new_end-new_start))/(end-start)+new_start;}void main() {vec4 pos=vec4(u_matrix_3f*a_pos_3f,1.0);v_position=pos.xyz;v_position.y*=-1.0;v_position.y=map(v_position.y,-1.0,1.0,0.0,1.0);gl_Position=vec4(a_pos_3f.xy,0.0,1.0);}"),globeRaster:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform sampler2D u_image0;uniform float u_far_z_cutoff;in vec2 v_pos0;
#ifndef FOG
uniform highp vec3 u_frustum_tl;uniform highp vec3 u_frustum_tr;uniform highp vec3 u_frustum_br;uniform highp vec3 u_frustum_bl;uniform highp vec3 u_globe_pos;uniform highp float u_globe_radius;uniform vec2 u_viewport;
#endif
void main() {vec4 color;
#ifdef CUSTOM_ANTIALIASING
highp vec2 uv=gl_FragCoord.xy/u_viewport;
#ifdef FLIP_Y
uv.y=1.0-uv.y;
#endif
highp vec3 ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,uv.x),mix(u_frustum_bl,u_frustum_br,uv.x),1.0-uv.y);highp vec3 dir=normalize(ray_dir);highp vec3 closest_point=dot(u_globe_pos,dir)*dir;highp float norm_dist_from_center=1.0-length(closest_point-u_globe_pos)/u_globe_radius;const float antialias_pixel=2.0;highp float antialias_factor=antialias_pixel*fwidth(norm_dist_from_center);highp float antialias=smoothstep(0.0,antialias_factor,norm_dist_from_center);vec4 raster=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
raster=apply_lighting_with_emission_ground(raster,raster.a);color=vec4(clamp(raster.rgb,vec3(0),vec3(1))*antialias,antialias);
#else
raster=apply_lighting_ground(raster);color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=vec4(raster.rgb*antialias,raster.a*antialias);
#endif
#else
color=texture(u_image0,v_pos0);
#ifdef LIGHTING_3D_MODE
#ifdef LIGHTING_3D_ALPHA_EMISSIVENESS
color=apply_lighting_with_emission_ground(color,color.a);color.a=1.0;
#else
color=apply_lighting_ground(color);
#endif
#endif
#endif
#ifdef FOG
color=fog_dither(fog_apply_premultiplied(color,v_fog_pos));
#endif
color*=1.0-step(u_far_z_cutoff,1.0/gl_FragCoord.w);glFragColor=color;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_terrain.vertex.glsl"
uniform mat4 u_proj_matrix;uniform mat4 u_normalize_matrix;uniform mat4 u_globe_matrix;uniform mat4 u_merc_matrix;uniform float u_zoom_transition;uniform vec2 u_merc_center;uniform mat3 u_grid_matrix;uniform float u_skirt_height;
#ifdef GLOBE_POLES
in vec3 a_globe_pos;in vec2 a_uv;
#else
in vec2 a_pos;
#endif
out vec2 v_pos0;void main() {
#ifdef GLOBE_POLES
vec3 globe_pos=a_globe_pos;vec2 uv=a_uv;
#else
float tiles=u_grid_matrix[0][2];float idx=u_grid_matrix[1][2];float idy=u_grid_matrix[2][2];vec3 decomposed_pos_and_skirt=decomposeToPosAndSkirt(a_pos);vec3 latLng=u_grid_matrix*vec3(decomposed_pos_and_skirt.xy,1.0);float mercatorY=mercatorYfromLat(latLng[0]);float uvY=mercatorY*tiles-idy;float mercatorX=mercatorXfromLng(latLng[1]);float uvX=mercatorX*tiles-idx;vec3 globe_pos=latLngToECEF(latLng.xy);vec2 merc_pos=vec2(mercatorX,mercatorY);vec2 uv=vec2(uvX,uvY);
#endif
v_pos0=uv;vec2 tile_pos=uv*EXTENT;vec3 globe_derived_up_vector=normalize(globe_pos)*u_tile_up_scale;
#ifdef GLOBE_POLES
vec3 up_vector=globe_derived_up_vector;
#else
vec3 up_vector=elevationVector(tile_pos);
#endif
float height=elevation(tile_pos);globe_pos+=up_vector*height;
#ifndef GLOBE_POLES
globe_pos-=globe_derived_up_vector*u_skirt_height*decomposed_pos_and_skirt.z;
#endif
#ifdef GLOBE_POLES
vec4 interpolated_pos=u_globe_matrix*vec4(globe_pos,1.0);
#else
vec4 globe_world_pos=u_globe_matrix*vec4(globe_pos,1.0);vec4 merc_world_pos=vec4(0.0);if (u_zoom_transition > 0.0) {merc_world_pos=vec4(merc_pos,height-u_skirt_height*decomposed_pos_and_skirt.z,1.0);merc_world_pos.xy-=u_merc_center;merc_world_pos.x=wrap(merc_world_pos.x,-0.5,0.5);merc_world_pos=u_merc_matrix*merc_world_pos;}vec4 interpolated_pos=vec4(mix(globe_world_pos.xyz,merc_world_pos.xyz,u_zoom_transition),1.0);
#endif
gl_Position=u_proj_matrix*interpolated_pos;
#ifdef FOG
v_fog_pos=fog_position((u_normalize_matrix*vec4(globe_pos,1.0)).xyz);
#endif
}`),globeAtmosphere:Nr(`#include "_prelude_fog.fragment.glsl"
uniform float u_transition;uniform highp float u_fadeout_range;uniform highp float u_temporal_offset;uniform vec4 u_atmosphere_fog_color;uniform vec4 u_high_color;uniform vec4 u_space_color;uniform float u_horizon_angle;in highp vec3 v_ray_dir;in highp vec3 v_horizon_dir;void main() {highp vec3 dir=normalize(v_ray_dir);float globe_pos_dot_dir;
#ifdef PROJECTION_GLOBE_VIEW
globe_pos_dot_dir=dot(u_globe_pos,dir);highp vec3 closest_point_forward=abs(globe_pos_dot_dir)*dir;float norm_dist_from_center=length(closest_point_forward-u_globe_pos)/u_globe_radius;if (norm_dist_from_center < 0.98) {
#ifdef ALPHA_PASS
glFragColor=vec4(0,0,0,0);return;
#else
#ifdef NATIVE
glFragColor=vec4(1,1,1,1);
#else
glFragColor=vec4(0,0,0,1);
#endif
return;
#endif
}
#endif
highp vec3 horizon_dir=normalize(v_horizon_dir);float horizon_angle_mercator=dir.y < horizon_dir.y ?
0.0 : max(acos(clamp(dot(dir,horizon_dir),-1.0,1.0)),0.0);float horizon_angle;
#ifdef PROJECTION_GLOBE_VIEW
highp vec3 closest_point=globe_pos_dot_dir*dir;highp float closest_point_to_center=length(closest_point-u_globe_pos);highp float theta=asin(clamp(closest_point_to_center/length(u_globe_pos),-1.0,1.0));horizon_angle=globe_pos_dot_dir < 0.0 ?
PI-theta-u_horizon_angle : theta-u_horizon_angle;float angle_t=pow(u_transition,10.0);horizon_angle=mix(horizon_angle,horizon_angle_mercator,angle_t);
#else
horizon_angle=horizon_angle_mercator;
#endif
horizon_angle/=PI;float t=exp(-horizon_angle/u_fadeout_range);float alpha_0=u_atmosphere_fog_color.a;float alpha_1=u_high_color.a;float alpha_2=u_space_color.a;vec3 color_stop_0=u_atmosphere_fog_color.rgb;vec3 color_stop_1=u_high_color.rgb;vec3 color_stop_2=u_space_color.rgb;
#ifdef ALPHA_PASS
float a0=mix(alpha_2,1.0,alpha_1);float a1=mix(a0,1.0,alpha_0);float a2=mix(a0,a1,t);float a =mix(alpha_2,a2,t);glFragColor=vec4(1.0,1.0,1.0,a);
#else
vec3 c0=mix(color_stop_2,color_stop_1,alpha_1);vec3 c1=mix(c0,color_stop_0,alpha_0);vec3 c2=mix(c0,c1,t);vec3 c=c2;glFragColor=vec4(c*t,t);
#endif
}`,`in vec3 a_pos;in vec2 a_uv;uniform vec3 u_frustum_tl;uniform vec3 u_frustum_tr;uniform vec3 u_frustum_br;uniform vec3 u_frustum_bl;uniform float u_horizon;out highp vec3 v_ray_dir;out highp vec3 v_horizon_dir;void main() {v_ray_dir=mix(
mix(u_frustum_tl,u_frustum_tr,a_uv.x),mix(u_frustum_bl,u_frustum_br,a_uv.x),a_uv.y);v_horizon_dir=mix(
mix(u_frustum_tl,u_frustum_bl,u_horizon),mix(u_frustum_tr,u_frustum_br,u_horizon),a_uv.x);gl_Position=vec4(a_pos,1.0);}`),model:Nr(`#include "_prelude_fog.fragment.glsl"
#include "_prelude_shadow.fragment.glsl"
#include "_prelude_lighting.glsl"
uniform float u_opacity;uniform vec3 u_lightcolor;uniform vec3 u_lightpos;uniform float u_lightintensity;uniform vec4 u_baseColorFactor;uniform vec4 u_emissiveFactor;uniform float u_metallicFactor;uniform float u_roughnessFactor;uniform float u_emissive_strength;in highp vec4 v_position_height;in lowp vec4 v_color_mix;
#ifdef RENDER_SHADOWS
in highp vec4 v_pos_light_view_0;in highp vec4 v_pos_light_view_1;in float v_depth_shadows;
#endif
#ifdef OCCLUSION_TEXTURE_TRANSFORM
uniform vec4 u_occlusionTextureTransform;
#endif
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#ifdef HAS_ATTRIBUTE_a_pbr
in lowp vec4 v_roughness_metallic_emissive_alpha;in mediump vec4 v_height_based_emission_params;
#endif
#ifdef HAS_TEXTURE_u_baseColorTexture
uniform sampler2D u_baseColorTexture;uniform bool u_baseTextureIsAlpha;uniform bool u_alphaMask;uniform float u_alphaCutoff;
#endif
#ifdef HAS_TEXTURE_u_metallicRoughnessTexture
uniform sampler2D u_metallicRoughnessTexture;
#endif
#ifdef HAS_TEXTURE_u_occlusionTexture
uniform sampler2D u_occlusionTexture;uniform float u_aoIntensity;
#endif
#ifdef HAS_TEXTURE_u_normalTexture
uniform sampler2D u_normalTexture;
#endif
#ifdef HAS_TEXTURE_u_emissionTexture
uniform sampler2D u_emissionTexture;
#endif
#ifdef APPLY_LUT_ON_GPU
uniform highp sampler3D u_lutTexture;
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
in highp float v_depth;uniform highp sampler2D u_depthTexture;uniform highp vec2 u_inv_depth_size;uniform highp vec2 u_depth_range_unpack;
#ifdef DEPTH_D24
highp float unpack_depth(highp float depth) {return  depth*u_depth_range_unpack.x+u_depth_range_unpack.y;}
#else
highp float unpack_depth_rgba(highp vec4 rgba_depth)
{const highp vec4 bit_shift=vec4(1.0/(255.0*255.0*255.0),1.0/(255.0*255.0),1.0/255.0,1.0);return dot(rgba_depth,bit_shift)*2.0-1.0;}
#endif
bool isOccluded() {highp vec2 coord=gl_FragCoord.xy*u_inv_depth_size;
#ifdef DEPTH_D24
highp float depth=unpack_depth(texture(u_depthTexture,coord).r);
#else
highp float depth=unpack_depth_rgba(texture(u_depthTexture,coord));
#endif
return v_depth > depth+0.0005;}
#endif
#define saturate(_x) clamp(_x,0.,1.)
vec3 linearTosRGB(vec3 color) {return pow(color,vec3(1./2.2));}vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}float calculate_NdotL(vec3 normal,vec3 lightDir) {const float ext=0.70710678118;return (clamp(dot(normal,lightDir),-ext,1.0)+ext)/(1.0+ext);}vec3 getDiffuseShadedColor(vec3 albedo,vec3 normal,vec3 lightDir,vec3 lightColor)
{
#ifdef LIGHTING_3D_MODE
vec3 transformed_normal=vec3(-normal.xy,normal.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=saturate(dot(transformed_normal,u_lighting_directional_dir));
#endif
return apply_lighting(albedo,transformed_normal,lighting_factor);
#else
vec3 n=normal;float colorvalue=((albedo.x*0.2126)+(albedo.y*0.7152))+(albedo.z*0.0722);vec3 c=vec3(0.03,0.03,0.03);float directional=clamp(dot(n,vec3(lightDir)),0.0,1.0);directional=mix(1.0-u_lightintensity,max((1.0-colorvalue)+u_lightintensity,1.0),directional);vec3 c3=c+clamp((albedo*directional)*lightColor,mix(vec3(0.0),vec3(0.3),vec3(1.0)-lightColor),vec3(1.0));return c3;
#endif
}vec4 getBaseColor() {vec4 albedo=u_baseColorFactor;
#ifdef HAS_ATTRIBUTE_a_color_3f
albedo*=vec4(color_3f,1.0);
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#else
#ifdef HAS_ATTRIBUTE_a_color_4f
albedo*=color_4f;
#endif
#endif
#if defined (HAS_TEXTURE_u_baseColorTexture) && defined (HAS_ATTRIBUTE_a_uv_2f)
vec4 texColor=texture(u_baseColorTexture,uv_2f);if(u_alphaMask) {if (texColor.w < u_alphaCutoff) {discard;}}
#ifdef UNPREMULT_TEXTURE_IN_SHADER
if(texColor.w > 0.0) {texColor.rgb/=texColor.w;}texColor.w=1.0;
#endif
if(u_baseTextureIsAlpha) {if (texColor.r < 0.5) {discard;}} else {texColor.rgb=sRGBToLinear(texColor.rgb);albedo*=texColor;}
#endif
vec4 color=vec4(mix(albedo.rgb,v_color_mix.rgb,v_color_mix.a),albedo.a);
#ifdef APPLY_LUT_ON_GPU
color=applyLUT(u_lutTexture,color);
#endif
return color;}highp mat3 cotangentFrame(highp vec3 N,highp vec3 p,highp vec2 uv ) {
#ifdef HAS_TEXTURE_u_normalTexture
highp vec3 dp1=vec3(dFdx(p.x),dFdx(p.y),dFdx(p.z));highp vec3 dp2=vec3(dFdy(p.x),dFdy(p.y),dFdy(p.z));highp vec2 duv1=vec2(dFdx(uv.x),dFdx(uv.y));highp vec2 duv2=vec2(dFdy(uv.x),dFdy(uv.y));highp vec3 dp2perp=cross( dp2,N );highp vec3 dp1perp=cross( N,dp1 );highp vec3 T=dp2perp*duv1.x+dp1perp*duv2.x;highp vec3 B=dp2perp*duv1.y+dp1perp*duv2.y;
#ifdef FLIP_Y
T=-T;B=-B;
#endif
highp float lengthT=dot(T,T);highp float lengthB=dot(B,B);highp float maxLength=max(lengthT,lengthB);highp float invmax=inversesqrt( maxLength );highp mat3 res=mat3( T*invmax,B*invmax,N );return res;
#else
return mat3(1.0);
#endif
}highp vec3 getNormal(){highp vec3 n;
#ifdef HAS_ATTRIBUTE_a_normal_3f
n=normalize(normal_3f);
#else
highp vec3 fdx=vec3(dFdx(v_position_height.x),dFdx(v_position_height.y),dFdx(v_position_height.z));highp vec3 fdy=vec3(dFdy(v_position_height.x),dFdy(v_position_height.y),dFdy(v_position_height.z));
#ifdef FLIP_Y
n=normalize(cross(fdx,fdy));
#else
n=normalize(cross(fdx,fdy))*-1.0;
#endif
#endif
#if defined(HAS_TEXTURE_u_normalTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
vec3 nMap=texture( u_normalTexture,uv_2f).xyz;nMap=normalize(2.0*nMap-vec3(1.0));highp vec3 v=normalize(-v_position_height.xyz);highp mat3 TBN=cotangentFrame(n,v,uv_2f);n=normalize(TBN*nMap);
#endif
return n;}struct Material {float perceptualRoughness;float alphaRoughness;float metallic;vec3 f90;vec4 baseColor;vec3 diffuseColor;vec3 specularColor;highp vec3 normal;};Material getPBRMaterial() {Material mat;mat.baseColor=getBaseColor();mat.perceptualRoughness=u_roughnessFactor;mat.metallic=u_metallicFactor;
#ifdef HAS_ATTRIBUTE_a_pbr
mat.perceptualRoughness=v_roughness_metallic_emissive_alpha.x;mat.metallic=v_roughness_metallic_emissive_alpha.y;mat.baseColor.w*=v_roughness_metallic_emissive_alpha.w;
#endif
#if defined(HAS_TEXTURE_u_metallicRoughnessTexture) && defined(HAS_ATTRIBUTE_a_uv_2f) 
vec4 mrSample=texture(u_metallicRoughnessTexture,uv_2f);mat.perceptualRoughness*=mrSample.g;mat.metallic*=mrSample.b;
#endif
const float c_minRoughness=0.04;mat.perceptualRoughness=clamp(mat.perceptualRoughness,c_minRoughness,1.0);mat.metallic=saturate(mat.metallic);mat.alphaRoughness=mat.perceptualRoughness*mat.perceptualRoughness;const vec3 f0=vec3(0.04);mat.diffuseColor=mat.baseColor.rgb*(vec3(1.0)-f0);mat.diffuseColor*=1.0-mat.metallic;mat.specularColor=mix(f0,mat.baseColor.rgb,mat.metallic);highp float reflectance=max(max(mat.specularColor.r,mat.specularColor.g),mat.specularColor.b);highp float reflectance90=saturate(reflectance*25.0);mat.f90=vec3(reflectance90);mat.normal=getNormal();return mat;}float V_GGX(float NdotL,float NdotV,float roughness)
{float a2=roughness*roughness;float GGXV=NdotL*sqrt(NdotV*NdotV*(1.0-a2)+a2);float GGXL=NdotV*sqrt(NdotL*NdotL*(1.0-a2)+a2);return 0.5/(GGXV+GGXL);}float V_GGXFast(float NdotL,float NdotV,float roughness) {float a=roughness;float GGXV=NdotL*(NdotV*(1.0-a)+a);float GGXL=NdotV*(NdotL*(1.0-a)+a);return 0.5/(GGXV+GGXL);}vec3 F_Schlick(vec3 specularColor,vec3 f90,float VdotH)
{return specularColor+(f90-specularColor)*pow(clamp(1.0-VdotH,0.0,1.0),5.0);}vec3 F_SchlickFast(vec3 specularColor,float VdotH)
{float x=1.0-VdotH;float x4=x*x*x*x;return specularColor+(1.0-specularColor)*x4*x;}float D_GGX(highp float NdotH,float alphaRoughness)
{highp float a4=alphaRoughness*alphaRoughness;highp float f=(NdotH*a4-NdotH)*NdotH+1.0;return a4/(PI*f*f);}vec3 diffuseBurley(Material mat,float LdotH,float NdotL,float NdotV)
{float f90=2.0*LdotH*LdotH*mat.alphaRoughness-0.5;return (mat.diffuseColor/PI)*(1.0+f90*pow((1.0-NdotL),5.0))*(1.0+f90*pow((1.0-NdotV),5.0));}vec3 diffuseLambertian(Material mat)
{
#ifdef LIGHTING_3D_MODE
return mat.diffuseColor;
#else
return mat.diffuseColor/PI;
#endif
}vec3 EnvBRDFApprox(vec3 specularColor,float roughness,highp float NdotV)
{vec4 c0=vec4(-1,-0.0275,-0.572,0.022);vec4 c1=vec4(1,0.0425,1.04,-0.04);highp vec4 r=roughness*c0+c1;highp float a004=min(r.x*r.x,exp2(-9.28*NdotV))*r.x+r.y;vec2 AB=vec2(-1.04,1.04)*a004+r.zw;return specularColor*AB.x+AB.y;}vec3 computeIndirectLightContribution(Material mat,float NdotV,vec3 normal)
{vec3 env_light=vec3(0.65,0.65,0.65);
#ifdef LIGHTING_3D_MODE
float ambient_factor=calculate_ambient_directional_factor(normal);env_light=u_lighting_ambient_color*ambient_factor;
#endif
vec3 envBRDF=EnvBRDFApprox(mat.specularColor,mat.perceptualRoughness,NdotV);vec3 indirectSpecular= envBRDF*env_light;vec3 indirectDiffuse=mat.diffuseColor*env_light;return indirectSpecular+indirectDiffuse;}vec3 computeLightContribution(Material mat,vec3 lightPosition,vec3 lightColor)
{highp vec3 n=mat.normal;highp vec3 v=normalize(-v_position_height.xyz);highp vec3 l=normalize(lightPosition);highp vec3 h=normalize(v+l);float NdotV=clamp(abs(dot(n,v)),0.001,1.0);float NdotL=saturate(dot(n,l));highp float NdotH=saturate(dot(n,h));float VdotH=saturate(dot(v,h));vec3 f=F_SchlickFast(mat.specularColor,VdotH);float g=V_GGXFast(NdotL,NdotV,mat.alphaRoughness);float d=D_GGX(NdotH,mat.alphaRoughness);vec3 diffuseTerm=(1.0-f)*diffuseLambertian(mat);vec3 specularTerm=f*g*d;vec3 transformed_normal=vec3(-n.xy,n.z);float lighting_factor;
#ifdef RENDER_SHADOWS
lighting_factor=shadowed_light_factor_normal(transformed_normal,v_pos_light_view_0,v_pos_light_view_1,v_depth_shadows);
#else
lighting_factor=NdotL;
#endif
vec3 directLightColor=(specularTerm+diffuseTerm)*lighting_factor*lightColor;vec3 indirectLightColor=computeIndirectLightContribution(mat,NdotV,transformed_normal);vec3 color=(saturate(directLightColor)+indirectLightColor);float intensityFactor=1.0;
#if !defined(LIGHTING_3D_MODE)
const vec3 luminosityFactor=vec3(0.2126,0.7152,0.0722);float luminance=dot(diffuseTerm,luminosityFactor);intensityFactor=mix((1.0-u_lightintensity),max((1.0-luminance+u_lightintensity),1.0),NdotL);
#endif
color*=intensityFactor;return color;}void main() {
#ifdef TERRAIN_FRAGMENT_OCCLUSION
if (isOccluded()) {discard;}
#endif
vec3 lightDir=u_lightpos;vec3 lightColor=u_lightcolor;
#ifdef LIGHTING_3D_MODE
lightDir=u_lighting_directional_dir;lightDir.xy=-lightDir.xy;lightColor=u_lighting_directional_color;
#endif
vec4 finalColor;
#ifdef DIFFUSE_SHADED
vec3 N=getNormal();vec3 baseColor=getBaseColor().rgb;vec3 diffuse=getDiffuseShadedColor(baseColor,N,lightDir,lightColor);
#ifdef HAS_TEXTURE_u_occlusionTexture
float ao=(texture(u_occlusionTexture,uv_2f).r-1.0)*u_aoIntensity+1.0;diffuse*=ao;
#endif
finalColor=vec4(mix(diffuse,baseColor,u_emissive_strength),1.0)*u_opacity;
#else
Material mat=getPBRMaterial();vec3 color=computeLightContribution(mat,lightDir,lightColor);float ao=1.0;
#if defined (HAS_TEXTURE_u_occlusionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
#ifdef OCCLUSION_TEXTURE_TRANSFORM
vec2 uv=uv_2f.xy*u_occlusionTextureTransform.zw+u_occlusionTextureTransform.xy;
#else
vec2 uv=uv_2f;
#endif
ao=(texture(u_occlusionTexture,uv).x-1.0)*u_aoIntensity+1.0;color*=ao;
#endif
vec4 emissive=u_emissiveFactor;
#if defined(HAS_TEXTURE_u_emissionTexture) && defined(HAS_ATTRIBUTE_a_uv_2f)
emissive.rgb*=sRGBToLinear(texture(u_emissionTexture,uv_2f).rgb);
#endif
#ifdef APPLY_LUT_ON_GPU
float emissiveFactorLength=max(length(u_emissiveFactor.rgb),0.001);emissive.rgb=sRGBToLinear(applyLUT(u_lutTexture,linearTosRGB(emissive.rgb/emissiveFactorLength).rbg))*emissiveFactorLength;
#endif
color+=emissive.rgb;float opacity=mat.baseColor.w*u_opacity;
#ifdef HAS_ATTRIBUTE_a_pbr
float resEmission=v_roughness_metallic_emissive_alpha.z;resEmission*=v_height_based_emission_params.z+v_height_based_emission_params.w*pow(clamp(v_height_based_emission_params.x,0.0,1.0),v_height_based_emission_params.y);vec3 color_mix=v_color_mix.rgb;
#ifdef APPLY_LUT_ON_GPU
color_mix=applyLUT(u_lutTexture,color_mix);
#endif
color=mix(color,color_mix,min(1.0,resEmission));
#ifdef HAS_ATTRIBUTE_a_color_4f
float distance=length(vec2(1.3*max(0.0,abs(color_4f.x)-color_4f.z),color_4f.y));distance+= mix(0.5,0.0,clamp(resEmission-1.0,0.0,1.0));opacity*=v_roughness_metallic_emissive_alpha.w*saturate(1.0-distance*distance);
#endif
#endif
vec3 unlitColor=mat.baseColor.rgb*ao+emissive.rgb;color=mix(color,unlitColor,u_emissive_strength);color=linearTosRGB(color);color*=opacity;finalColor=vec4(color,opacity);
#endif
#ifdef FOG
finalColor=fog_dither(fog_apply_premultiplied(finalColor,v_fog_pos,v_position_height.w));
#endif
#ifdef RENDER_CUTOFF
finalColor*=v_cutoff_opacity;
#endif
#ifdef INDICATOR_CUTOUT
finalColor=applyCutout(finalColor,v_position_height.w);
#endif
#ifdef FEATURE_CUTOUT
finalColor=apply_feature_cutout(finalColor,gl_FragCoord);
#endif
glFragColor=finalColor;
#ifdef OVERDRAW_INSPECTOR
glFragColor=vec4(1.0);
#endif
HANDLE_WIREFRAME_DEBUG;}`,`#include "_prelude_fog.vertex.glsl"
#include "_prelude_shadow.vertex.glsl"
in vec3 a_pos_3f;
#pragma mapbox: define-attribute highp vec3 normal_3f
#pragma mapbox: define-attribute highp vec2 uv_2f
#pragma mapbox: define-attribute highp vec3 color_3f
#pragma mapbox: define-attribute highp vec4 color_4f
#pragma mapbox: define-attribute-vertex-shader-only highp vec4 pbr
#pragma mapbox: define-attribute-vertex-shader-only highp vec3 heightBasedEmissiveStrength
uniform mat4 u_matrix;uniform mat4 u_node_matrix;uniform mat4 u_lighting_matrix;uniform vec3 u_camera_pos;uniform vec4 u_color_mix;
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_normal_matrix;
#endif
#ifdef RENDER_SHADOWS
uniform mat4 u_light_matrix_0;uniform mat4 u_light_matrix_1;out highp vec4 v_pos_light_view_0;out highp vec4 v_pos_light_view_1;out float v_depth_shadows;
#endif
out vec4 v_position_height;out lowp vec4 v_color_mix;
#ifdef TERRAIN_FRAGMENT_OCCLUSION
out highp float v_depth;
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
out lowp vec4 v_roughness_metallic_emissive_alpha;out mediump vec4 v_height_based_emission_params;
#endif
vec3 sRGBToLinear(vec3 srgbIn) {return pow(srgbIn,vec3(2.2));}void main() {
#pragma mapbox: initialize-attribute highp vec3 normal_3f
#pragma mapbox: initialize-attribute highp vec2 uv_2f
#pragma mapbox: initialize-attribute highp vec3 color_3f
#pragma mapbox: initialize-attribute highp vec4 color_4f
#pragma mapbox: initialize-attribute-custom highp vec4 pbr
#pragma mapbox: initialize-attribute-custom highp vec3 heightBasedEmissiveStrength
highp mat4 normal_matrix;
#ifdef INSTANCED_ARRAYS
normal_matrix=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
normal_matrix=u_normal_matrix;
#endif
vec3 local_pos;mat3 rs;
#ifdef MODEL_POSITION_ON_GPU
vec3 pos_color=normal_matrix[0].xyz;vec4 translate=normal_matrix[1];vec3 pos_a=floor(pos_color);vec3 rgb=1.05*(pos_color-pos_a);float hidden=float(pos_a.x > EXTENT);float color_mix=pos_a.z/100.0;v_color_mix=vec4(sRGBToLinear(rgb),color_mix);float meter_to_tile=normal_matrix[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);rs[0].x=normal_matrix[1].w;rs[0].yz=normal_matrix[2].xy;rs[1].xy=normal_matrix[2].zw;rs[1].z=normal_matrix[3].x;rs[2].xyz=normal_matrix[3].yzw;vec4 pos_node=u_lighting_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;local_pos=pos.xyz;gl_Position=mix(u_matrix*pos,AWAY,hidden);pos.z*=meter_to_tile;v_position_height.xyz=pos.xyz-u_camera_pos;
#else
local_pos=a_pos_3f;gl_Position=u_matrix*vec4(a_pos_3f,1);v_position_height.xyz=vec3(u_lighting_matrix*vec4(a_pos_3f,1));v_color_mix=vec4(sRGBToLinear(u_color_mix.rgb),u_color_mix.a);
#endif
v_position_height.w=a_pos_3f.z;
#ifdef HAS_ATTRIBUTE_a_pbr
vec4 albedo_c=decode_color(pbr.xy);vec2 e_r_m=unpack_float(pbr.z);vec2 r_m= unpack_float(e_r_m.y*16.0);r_m.r=r_m.r*16.0;v_color_mix=vec4(albedo_c.rgb,1.0);v_roughness_metallic_emissive_alpha=vec4(vec3(r_m,e_r_m.x)/255.0,albedo_c.a);v_roughness_metallic_emissive_alpha.z*=2.0;float heightBasedRelativeIntepolation=a_pos_3f.z*heightBasedEmissiveStrength.x+heightBasedEmissiveStrength.y;v_height_based_emission_params.x=heightBasedRelativeIntepolation;v_height_based_emission_params.y=heightBasedEmissiveStrength.z;vec2 emissionMultiplierValues=unpack_float(pbr.w)/256.0;v_height_based_emission_params.z=emissionMultiplierValues.x;v_height_based_emission_params.w=emissionMultiplierValues.y-emissionMultiplierValues.x;
#endif
#ifdef FOG
v_fog_pos=fog_position(local_pos);
#endif
#ifdef RENDER_CUTOFF
v_cutoff_opacity=cutoff_opacity(u_cutoff_params,gl_Position.z);
#endif
#ifdef TERRAIN_FRAGMENT_OCCLUSION
v_depth=gl_Position.z/gl_Position.w;
#endif
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
float x_squared_scale=dot(rs[0],rs[0]);float y_squared_scale=dot(rs[1],rs[1]);float z_squared_scale=dot(rs[2],rs[2]);vec3 squared_scale=vec3(x_squared_scale,y_squared_scale,z_squared_scale);normal_3f=rs*((u_lighting_matrix*vec4(normal_3f,0.0)).xyz/squared_scale);normal_3f=normalize(normal_3f);
#else
normal_3f=vec3(normal_matrix*vec4(normal_3f,0));
#endif
#endif
#ifdef HAS_ATTRIBUTE_a_pbr
#ifdef HAS_ATTRIBUTE_a_color_4f
v_roughness_metallic_emissive_alpha.w=clamp(color_4f.a*v_roughness_metallic_emissive_alpha.w*(v_roughness_metallic_emissive_alpha.z-1.0),0.0,1.0);
#endif
#endif
#ifdef RENDER_SHADOWS
vec4 shadow_pos=u_node_matrix*vec4(local_pos,1.0);
#ifdef NORMAL_OFFSET
#ifdef HAS_ATTRIBUTE_a_normal_3f
#ifdef MODEL_POSITION_ON_GPU
vec3 offset=shadow_normal_offset(vec3(-normal_3f.xy,normal_3f.z));shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#else
vec3 offset=shadow_normal_offset_model(normal_3f);shadow_pos.xyz+=offset*shadow_normal_offset_multiplier0();
#endif
#endif
#endif
v_pos_light_view_0=u_light_matrix_0*shadow_pos;v_pos_light_view_1=u_light_matrix_1*shadow_pos;v_depth_shadows=gl_Position.w;
#endif
}`),modelDepth:Nr(`in highp float v_depth;void main() {
#ifndef DEPTH_TEXTURE
glFragColor=pack_depth(v_depth);
#endif
}`,`in vec3 a_pos_3f;uniform mat4 u_matrix;out highp float v_depth;
#ifdef MODEL_POSITION_ON_GPU
#ifdef INSTANCED_ARRAYS
in vec4 a_normal_matrix0;in vec4 a_normal_matrix1;in vec4 a_normal_matrix2;in vec4 a_normal_matrix3;
#else
uniform highp mat4 u_instance;
#endif
uniform highp mat4 u_node_matrix;
#endif
void main() {
#ifdef MODEL_POSITION_ON_GPU
highp mat4 instance;
#ifdef INSTANCED_ARRAYS
instance=mat4(a_normal_matrix0,a_normal_matrix1,a_normal_matrix2,a_normal_matrix3);
#else
instance=u_instance;
#endif
vec3 pos_color=instance[0].xyz;vec4 translate=instance[1];vec3 pos_a=floor(pos_color);float hidden=float(pos_a.x > EXTENT);float meter_to_tile=instance[0].w;vec4 pos=vec4(pos_a.xy,translate.z,1.0);mat3 rs;rs[0].x=instance[1].w;rs[0].yz=instance[2].xy;rs[1].xy=instance[2].zw;rs[1].z=instance[3].x;rs[2].xyz=instance[3].yzw;vec4 pos_node=u_node_matrix*vec4(a_pos_3f,1.0);vec3 rotated_pos_node=rs*pos_node.xyz;vec3 pos_model_tile=(rotated_pos_node+vec3(translate.xy,0.0))*vec3(meter_to_tile,meter_to_tile,1.0);pos.xyz+=pos_model_tile;gl_Position=mix(u_matrix*pos,AWAY,hidden);
#else
gl_Position=u_matrix*vec4(a_pos_3f,1);
#endif
v_depth=gl_Position.z/gl_Position.w;}`),stars:Nr(`in highp vec2 v_uv;in mediump float v_intensity;float shapeCircle(in vec2 uv)
{float beginFade=0.6;float lengthFromCenter=length(v_uv);return 1.0-clamp((lengthFromCenter-beginFade)/(1.0-beginFade),0.0,1.0);}void main() {float alpha=shapeCircle(v_uv);vec3 color=vec3(1.0,1.0,1.0);alpha*=v_intensity;glFragColor=vec4(color*alpha,alpha);HANDLE_WIREFRAME_DEBUG;}`,`
in vec3 a_pos_3f;in vec2 a_uv;in float a_size_scale;in float a_fade_opacity;uniform mat4 u_matrix;uniform vec3 u_up;uniform vec3 u_right;uniform float u_intensity_multiplier;out highp vec2 v_uv;out mediump float v_intensity;void main() {v_uv=a_uv;v_intensity=a_fade_opacity*u_intensity_multiplier;vec3 pos=a_pos_3f;pos+=a_uv.x*u_right*a_size_scale;pos+=a_uv.y*u_up*a_size_scale;gl_Position=u_matrix*vec4(pos,1.0);}`),snowParticle:Nr("in highp vec2 uv;in highp float alphaMultiplier;uniform vec4 u_particleColor;uniform vec2 u_simpleShapeParameters;void main() {float t=clamp((length(uv)-u_simpleShapeParameters.x)/(1.0-u_simpleShapeParameters.x),0.0,1.0);float alpha=1.0-pow(t,pow(10.0,u_simpleShapeParameters.y));alpha*=alphaMultiplier;alpha*=u_particleColor.a;vec3 color=u_particleColor.rgb*alpha;glFragColor=vec4(color,alpha) ;HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_snowParticleData;in highp vec4 a_snowParticleDataHorizontalOscillation;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform vec2 u_screenSize;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity;uniform vec3 u_direction;uniform float u_horizontalOscillationRadius; 
uniform float u_horizontalOscillationRate; 
uniform float u_billboardSize;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;out highp vec2 uv;out highp float alphaMultiplier;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos.xyz*=halfBoxSize;pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_snowParticleData.z;float coneAngleHeadingRad=a_snowParticleData.w*radians(360.0);vec3 localZ=normalize(u_direction);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 direction;direction.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);direction.z=cos(coneAnglePichRad);direction=normalize(direction);vec3 simPosLocal=vec3(0,0,0);float velocityScale=(1.0+3.0*a_snowParticleData.y)*u_velocity;simPosLocal+=direction*velocityScale*u_time;float horizontalOscillationRadius=u_horizontalOscillationRadius*a_snowParticleDataHorizontalOscillation.x;float horizontalOscillationAngle=u_horizontalOscillationRate*u_time*(-1.0+2.0*a_snowParticleDataHorizontalOscillation.y);simPosLocal.xy+=horizontalOscillationRadius*vec2(cos(horizontalOscillationAngle),sin(horizontalOscillationAngle));vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);float clipZ=-u_cam_pos.z+pos.z;vec4 posView=u_modelview*vec4(pos,1.0);float size=u_billboardSize;alphaMultiplier=1.0;vec4 posScreen=u_projection*posView;posScreen/=posScreen.w;posScreen.xy=vec2(0.5)+posScreen.xy*0.5;posScreen.xy*=u_screenSize;vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=u_screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-posScreen.xy)/(0.5*u_screenSize));screenDist+=a_snowParticleData.x*u_thinningParticleOffset;float scaleFactorMode=0.0;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);if (a_snowParticleData.x < u_thinningAffectedRatio) {scaleFactorMode=1.0-thinningFadeRatio;alphaMultiplier=thinningFadeRatio;}}vec4 posScreen1=u_projection*vec4(posView.x-size,posView.yzw);posScreen1/=posScreen1.w;vec4 posScreen2=u_projection*vec4(posView.x+size,posView.yzw);posScreen2/=posScreen2.w;posScreen1.xy=vec2(0.5)+posScreen1.xy*0.5;posScreen1.xy*=u_screenSize;posScreen2.xy=vec2(0.5)+posScreen2.xy*0.5;posScreen2.xy*=u_screenSize;float screenLength=length(posScreen1.xy-posScreen2.xy);float screenEpsilon=3.0;float scaleFactor=1.0;if (screenLength < screenEpsilon) {scaleFactor=screenEpsilon/max(screenLength,0.01);scaleFactor=mix(scaleFactor,1.0,scaleFactorMode);}float screenEpsilon2=15.0;if (screenLength > screenEpsilon2) {scaleFactor=screenEpsilon2/max(screenLength,0.01);}size*=scaleFactor;vec2 right=size*vec2(1,0);vec2 up=size*vec2(0,1);posView.xy+=right*a_uv.x;posView.xy+=up*a_uv.y;uv=a_uv;gl_Position=u_projection*posView;}`),rainParticle:Nr("in highp vec2 uv;in highp float particleRandomValue;uniform sampler2D u_texScreen;uniform float u_distortionStrength;uniform vec4 u_color;uniform vec2 u_thinningCenterPos;uniform vec3 u_thinningShape;uniform float u_thinningAffectedRatio;uniform float u_thinningParticleOffset;uniform float u_shapeDirectionalPower;uniform float u_mode;void main() {vec2 st=uv*0.5+vec2(0.5);vec2 uvm=uv;uvm.y=-1.0+2.0*pow(st.y,u_shapeDirectionalPower);float shape=clamp(1.0-length(uvm),0.0,1.0);float alpha=abs(shape)*u_color.a;vec2 screenSize=vec2(textureSize(u_texScreen,0));vec2 thinningCenterPos=u_thinningCenterPos.xy;thinningCenterPos.y=screenSize.y-thinningCenterPos.y;float screenDist=length((thinningCenterPos-gl_FragCoord.xy)/(0.5*screenSize));screenDist+=(0.5+0.5*particleRandomValue)*u_thinningParticleOffset;float thinningShapeDist=u_thinningShape.x+u_thinningShape.y;float thinningAlpha=1.0;if (screenDist < thinningShapeDist) {float thinningFadeRatio=clamp((screenDist-u_thinningShape.x)/u_thinningShape.y,0.0,1.0);thinningFadeRatio=pow(thinningFadeRatio,u_thinningShape.z);thinningAlpha*=thinningFadeRatio;}vec2 offsetXY=normalize(uvm)*abs(shape);vec2 stScreen=(gl_FragCoord.xy+offsetXY*u_distortionStrength*thinningAlpha)/screenSize;vec3 colorScreen=texture(u_texScreen,stScreen).rgb;alpha*=thinningAlpha;glFragColor=mix(vec4(colorScreen,1.0),vec4(u_color.rgb*alpha,alpha),u_mode);HANDLE_WIREFRAME_DEBUG;}",`
in highp vec3 a_pos_3f;in highp vec2 a_uv;in highp vec4 a_rainParticleData;uniform mat4 u_modelview;uniform mat4 u_projection;uniform vec3 u_cam_pos;uniform float u_time;uniform float u_boxSize;uniform float u_velocityConeAperture; 
uniform float u_velocity; 
uniform vec2 u_rainDropletSize;uniform vec3 u_rainDirection;out highp vec2 uv;out highp float particleRandomValue;void main() {vec3 pos=a_pos_3f;float halfBoxSize=0.5*u_boxSize;pos*=halfBoxSize; 
pos+=u_cam_pos;float velocityConeApertureRad=radians(u_velocityConeAperture*0.5);float coneAnglePichRad=velocityConeApertureRad*a_rainParticleData.z;float coneAngleHeadingRad=a_rainParticleData.w*radians(360.0);vec3 localZ=normalize(u_rainDirection);vec3 localX=normalize(cross(localZ,vec3(1,0,0)));vec3 localY=normalize(cross(localZ,localX));vec3 directionLocal;directionLocal.x=cos(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.y=sin(coneAngleHeadingRad)*sin(coneAnglePichRad);directionLocal.z=cos(coneAnglePichRad);directionLocal=normalize(directionLocal);vec3 directionWorld=localX*directionLocal.x+localY*directionLocal.y+localZ*directionLocal.z;float velocityScale=(1.0+3.0*a_rainParticleData.y)*u_velocity;vec3 simPosLocal=vec3(0,0,0);simPosLocal+=directionLocal*velocityScale*u_time;vec3 simPos=localX*simPosLocal.x+
localY*simPosLocal.y+localZ*simPosLocal.z;pos+=simPos;pos=fract((pos+vec3(halfBoxSize))/vec3(u_boxSize))*u_boxSize-vec3(halfBoxSize);vec4 posView=u_modelview*vec4(pos,1.0);vec3 directionView=normalize((u_modelview*vec4(directionWorld,0.0)).xyz);vec3 side=cross(directionView,normalize(posView.xyz));posView.xyz+=side*a_uv.x*u_rainDropletSize.x;posView.xyz+=directionView*a_uv.y*u_rainDropletSize.y;uv=a_uv;particleRandomValue=a_rainParticleData.x;gl_Position=u_projection*posView;}`),vignette:Nr("uniform vec3 u_vignetteShape;uniform vec4 u_vignetteColor;in vec2 st;void main() {float screenDist=length(st);float alpha=clamp((screenDist-u_vignetteShape.x)/u_vignetteShape.y,0.0,1.0);alpha=pow(alpha,u_vignetteShape.z)*u_vignetteColor.a;vec3 color=u_vignetteColor.rgb;glFragColor=vec4(color*alpha,alpha) ;}","in vec2 a_pos_2f;out vec2 st;void main() {st=a_pos_2f;gl_Position=vec4(a_pos_2f,0,1);}"),occlusion:Nr("uniform vec4 u_color;void main() {glFragColor=u_color;}",`#include "_prelude_terrain.vertex.glsl"
in highp vec2 a_offset_xy;uniform highp vec3 u_anchorPos;uniform mat4 u_matrix;uniform vec2 u_screenSizePx;uniform vec2 u_occluderSizePx;void main() {vec3 world_pos=u_anchorPos;
#ifdef TERRAIN
float e=elevation(world_pos.xy);world_pos.z+=e;
#endif
vec4 projected_point=u_matrix*vec4(world_pos,1.0);projected_point.xy+=projected_point.w*a_offset_xy*0.5*u_occluderSizePx/u_screenSizePx;gl_Position=projected_point;}`)};function As(g,i){const c=g.replace(/\s*\/\/[^\n]*\n/g,`
`).split(`
`);for(let p of c)if(p=p.trim(),p[0]==="#"&&p.includes("if")&&!p.includes("endif")){p=p.replace("#","").replace(/ifdef|ifndef|elif|if/g,"").replace(/!|defined|\(|\)|\|\||&&/g,"").replace(/\s+/g," ").trim();const x=p.split(" ");for(const w of x)i.includes(w)||i.push(w)}}function Nr(g,i){const c=/#include\s+"([^"]+)"/g,p=/#pragma mapbox: ([\w\-]+) ([\w]+) ([\w]+) ([\w]+)/g,x={},w=[],A=[];if(g=g.replace(c,((O,z)=>(A.push(z),""))),(i=i.replace(c,((O,z)=>(w.push(z),"")))).includes("flat out"))return void console.error('The usage of "flat" qualifier is disallowed, see: https://bugs.webkit.org/show_bug.cgi?id=268071');let I=[...hc];As(g,I),As(i,I);for(const O of[...w,...A])tu[O]||console.error(`Undefined include: ${O}`),bl[O]||(bl[O]=[],As(tu[O],bl[O])),I=[...I,...bl[O]];return{fragmentSource:g=g.replace(p,((O,z,k,H,V)=>(x[V]=!0,z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
in ${k} ${H} ${V};
#else
uniform ${k} ${H} u_${V};
#endif
`:z==="initialize"?`
#ifdef HAS_UNIFORM_u_${V}
    ${k} ${H} ${V} = u_${V};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${k} ${H} ${V};
#endif
`:z==="initialize-attribute"?"":void 0))),vertexSource:i=i.replace(p,((O,z,k,H,V)=>{const X=H==="float"?"vec2":H,Y=V.match(/color/)?"color":X;return z==="define-attribute-vertex-shader-only"?`
#ifdef HAS_ATTRIBUTE_a_${V}
in ${k} ${H} a_${V};
#endif
`:x[V]?z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${k} ${X} a_${V};
out ${k} ${H} ${V};
#else
uniform ${k} ${H} u_${V};
#endif
`:z==="initialize"?Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = a_${V};
#else
    ${k} ${H} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${V} = unpack_mix_${Y}(a_${V}, u_${V}_t);
#else
    ${k} ${H} ${V} = u_${V};
#endif
`:z==="define-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    in ${k} ${H} a_${V};
    out ${k} ${H} ${V};
#endif
`:z==="initialize-attribute"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${V} = a_${V};
#endif
`:void 0:z==="define"?`
#ifndef HAS_UNIFORM_u_${V}
uniform lowp float u_${V}_t;
in ${k} ${X} a_${V};
#else
uniform ${k} ${H} u_${V};
#endif
`:z==="define-instanced"?Y==="mat4"?`
#ifdef INSTANCED_ARRAYS
in vec4 a_${V}0;
in vec4 a_${V}1;
in vec4 a_${V}2;
in vec4 a_${V}3;
#else
uniform ${k} ${H} u_${V};
#endif
`:`
#ifdef INSTANCED_ARRAYS
in ${k} ${X} a_${V};
#else
uniform ${k} ${H} u_${V};
#endif
`:z==="initialize-attribute-custom"?`
#ifdef HAS_ATTRIBUTE_a_${V}
    ${k} ${H} ${V} = a_${V};
#endif
`:Y==="vec4"?`
#ifndef HAS_UNIFORM_u_${V}
    ${k} ${H} ${V} = a_${V};
#else
    ${k} ${H} ${V} = u_${V};
#endif
`:`
#ifndef HAS_UNIFORM_u_${V}
    ${k} ${H} ${V} = unpack_mix_${Y}(a_${V}, u_${V}_t);
#else
    ${k} ${H} ${V} = u_${V};
#endif
`})),usedDefines:I,vertexIncludes:w,fragmentIncludes:A}}class ru{constructor(){this.boundProgram=null,this.boundLayoutVertexBuffer=null,this.boundPaintVertexBuffers=[],this.boundIndexBuffer=null,this.boundVertexOffset=null,this.boundDynamicVertexBuffers=[],this.vao=null}bind(i,c,p,x,w,A,I,O){this.context=i;let z=this.boundPaintVertexBuffers.length!==x.length;for(let H=0;!z&&H<x.length;H++)this.boundPaintVertexBuffers[H]!==x[H]&&(z=!0);let k=this.boundDynamicVertexBuffers.length!==I.length;for(let H=0;!k&&H<I.length;H++)this.boundDynamicVertexBuffers[H]!==I[H]&&(k=!0);if(!this.vao||this.boundProgram!==c||this.boundLayoutVertexBuffer!==p||z||k||this.boundIndexBuffer!==w||this.boundVertexOffset!==A)this.freshBind(c,p,x,w,A,I,O);else{i.bindVertexArrayOES.set(this.vao);for(const H of I)H&&(H.bind(),O&&H.instanceCount&&H.setVertexAttribDivisor(i.gl,c,O));w&&w.dynamicDraw&&w.bind()}}freshBind(i,c,p,x,w,A,I){const O=this.context,z=O.gl;this.vao&&this.destroy(),this.vao=O.gl.createVertexArray(),O.bindVertexArrayOES.set(this.vao),this.boundProgram=i,this.boundLayoutVertexBuffer=c,this.boundPaintVertexBuffers=p,this.boundIndexBuffer=x,this.boundVertexOffset=w,this.boundDynamicVertexBuffers=A,c.enableAttributes(z,i),c.bind(),c.setVertexAttribPointers(z,i,w);for(const k of p)k.enableAttributes(z,i),k.bind(),k.setVertexAttribPointers(z,i,w);for(const k of A)k&&(k.enableAttributes(z,i),k.bind(),k.setVertexAttribPointers(z,i,w),I&&k.instanceCount&&k.setVertexAttribDivisor(z,i,I));x&&x.bind()}destroy(){this.vao&&(this.context.gl.deleteVertexArray(this.vao),this.vao=null)}}function dc(g,i){const c=Math.pow(2,i.canonical.z),p=i.canonical.y;return[new n.ae(0,p/c).toLngLat().lat,new n.ae(0,(p+1)/c).toLngLat().lat]}function Rg(g,i,c,p,x,w,A){const I=g.context,O=I.gl,z=c.hillshadeFBO;if(!z)return;g.prepareDrawTile();const k=g.isTileAffectedByFog(i),H=g.getOrCreateProgram("hillshade",{overrideFog:k});I.activeTexture.set(O.TEXTURE0),O.bindTexture(O.TEXTURE_2D,z.colorAttachment.get());const V=((re,K,ae,ue)=>{const fe=ae.paint.get("hillshade-shadow-color"),xe=ae.paint.get("hillshade-shadow-color-use-theme").constantOr("default")==="none",ge=ae.paint.get("hillshade-highlight-color"),Te=ae.paint.get("hillshade-highlight-color-use-theme").constantOr("default")==="none",ye=ae.paint.get("hillshade-accent-color"),_e=ae.paint.get("hillshade-accent-color-use-theme").constantOr("default")==="none",Se=ae.paint.get("hillshade-emissive-strength");let He=n.an(ae.paint.get("hillshade-illumination-direction"));if(ae.paint.get("hillshade-illumination-anchor")==="viewport")He-=re.transform.angle;else if(re.style&&re.style.enable3dLights()&&re.style.directionalLight){const nt=re.style.directionalLight.properties.get("direction"),Ge=n.d3(nt.x,nt.y,nt.z);He=n.an(Ge[1])}const ze=!re.options.moving;return{u_matrix:ue||re.transform.calculateProjMatrix(K.tileID.toUnwrapped(),ze),u_image:0,u_latrange:dc(0,K.tileID),u_light:[ae.paint.get("hillshade-exaggeration"),He],u_shadow:fe.toPremultipliedRenderColor(xe?null:ae.lut),u_highlight:ge.toPremultipliedRenderColor(Te?null:ae.lut),u_emissive_strength:Se,u_accent:ye.toPremultipliedRenderColor(_e?null:ae.lut)}})(g,c,p,g.terrain?i.projMatrix:null);g.uploadCommonUniforms(I,H,i.toUnwrapped());const{tileBoundsBuffer:X,tileBoundsIndexBuffer:Y,tileBoundsSegments:W}=g.getTileBoundsBuffers(c);H.draw(g,O.TRIANGLES,x,w,A,Tr.disabled,V,p.id,X,Y,W)}function eh(g,i,c){if(!i.needsDEMTextureUpload)return;const p=g.context,x=p.gl;p.pixelStoreUnpackPremultiplyAlpha.set(!1),i.demTexture=i.demTexture||g.getTileTexture(c.stride);const w=c.getPixels();i.demTexture?i.demTexture.update(w,{premultiply:!1}):i.demTexture=new n.T(p,w,x.R32F,{premultiply:!1}),i.needsDEMTextureUpload=!1}function th(g,i,c){const p=g.context,x=p.gl;if(!i.dem)return;const w=i.dem;if(p.activeTexture.set(x.TEXTURE1),eh(g,i,w),!i.demTexture)return;i.demTexture.bind(x.NEAREST,x.CLAMP_TO_EDGE);const A=w.dim;p.activeTexture.set(x.TEXTURE0);let I=i.hillshadeFBO;if(!I){const V=new n.T(p,{width:A,height:A,data:null},x.RGBA8);V.bind(x.LINEAR,x.CLAMP_TO_EDGE),I=i.hillshadeFBO=p.createFramebuffer(A,A,!0,"renderbuffer"),I.colorAttachment.set(V.texture)}p.bindFramebuffer.set(I.framebuffer),p.viewport.set([0,0,A,A]);const{tileBoundsBuffer:O,tileBoundsIndexBuffer:z,tileBoundsSegments:k}=g.getMercatorTileBoundsBuffers(),H=[];g.linearFloatFilteringSupported()&&H.push("TERRAIN_DEM_FLOAT_FORMAT"),g.getOrCreateProgram("hillshadePrepare",{defines:H}).draw(g,x.TRIANGLES,qt.disabled,vr.disabled,kr.unblended,Tr.disabled,((V,X)=>{const Y=X.stride,W=n.bC();return n.cd(W,0,n.al,-n.al,0,0,1),n.br(W,W,[0,-n.al,0]),{u_matrix:W,u_image:1,u_dimension:[Y,Y],u_zoom:V.overscaledZ}})(i.tileID,w),c.id,O,z,k),i.needsHillshadePrepare=!1}class tn{constructor(i){this.gl=i.gl,this.default=this.getDefault(),this.current=this.default,this.dirty=!1}get(){return this.current}set(i){}getDefault(){return this.default}setDefault(){this.set(this.default)}}class Qd extends tn{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.clearColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class iu extends tn{getDefault(){return 1}set(i){(i!==this.current||this.dirty)&&(this.gl.clearDepth(i),this.current=i,this.dirty=!1)}}class Vh extends tn{getDefault(){return 0}set(i){(i!==this.current||this.dirty)&&(this.gl.clearStencil(i),this.current=i,this.dirty=!1)}}class Kd extends tn{getDefault(){return[!0,!0,!0,!0]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.colorMask(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class Jd extends tn{getDefault(){return!0}set(i){(i!==this.current||this.dirty)&&(this.gl.depthMask(i),this.current=i,this.dirty=!1)}}class Es extends tn{getDefault(){return 255}set(i){(i!==this.current||this.dirty)&&(this.gl.stencilMask(i),this.current=i,this.dirty=!1)}}class as extends tn{getDefault(){return{func:this.gl.ALWAYS,ref:0,mask:255}}set(i){const c=this.current;(i.func!==c.func||i.ref!==c.ref||i.mask!==c.mask||this.dirty)&&(this.gl.stencilFunc(i.func,i.ref,i.mask),this.current=i,this.dirty=!1)}}class rh extends tn{getDefault(){const i=this.gl;return[i.KEEP,i.KEEP,i.KEEP]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||this.dirty)&&(this.gl.stencilOp(i[0],i[1],i[2]),this.current=i,this.dirty=!1)}}class Cs extends tn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.STENCIL_TEST):c.disable(c.STENCIL_TEST),this.current=i,this.dirty=!1}}class pc extends tn{getDefault(){return[0,1]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||this.dirty)&&(this.gl.depthRange(i[0],i[1]),this.current=i,this.dirty=!1)}}class nu extends tn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.DEPTH_TEST):c.disable(c.DEPTH_TEST),this.current=i,this.dirty=!1}}class ep extends tn{getDefault(){return this.gl.LESS}set(i){(i!==this.current||this.dirty)&&(this.gl.depthFunc(i),this.current=i,this.dirty=!1)}}class Uh extends tn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.BLEND):c.disable(c.BLEND),this.current=i,this.dirty=!1}}class Yf extends tn{getDefault(){const i=this.gl;return[i.ONE,i.ZERO,i.ONE,i.ZERO]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.blendFuncSeparate(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class bo extends tn{getDefault(){return n.ao.transparent.toNonPremultipliedRenderColor(null)}set(i){const c=this.current;(i.r!==c.r||i.g!==c.g||i.b!==c.b||i.a!==c.a||this.dirty)&&(this.gl.blendColor(i.r,i.g,i.b,i.a),this.current=i,this.dirty=!1)}}class Nn extends tn{getDefault(){return this.gl.FUNC_ADD}set(i){(i!==this.current||this.dirty)&&(this.gl.blendEquationSeparate(i,i),this.current=i,this.dirty=!1)}}class un extends tn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;i?c.enable(c.CULL_FACE):c.disable(c.CULL_FACE),this.current=i,this.dirty=!1}}class wl extends tn{getDefault(){return this.gl.BACK}set(i){(i!==this.current||this.dirty)&&(this.gl.cullFace(i),this.current=i,this.dirty=!1)}}class Ta extends tn{getDefault(){return this.gl.CCW}set(i){(i!==this.current||this.dirty)&&(this.gl.frontFace(i),this.current=i,this.dirty=!1)}}let tp=class extends tn{getDefault(){return null}set(g){(g!==this.current||this.dirty)&&(this.gl.useProgram(g),this.current=g,this.dirty=!1)}};class mc extends tn{getDefault(){return this.gl.TEXTURE0}set(i){(i!==this.current||this.dirty)&&(this.gl.activeTexture(i),this.current=i,this.dirty=!1)}}class Tm extends tn{getDefault(){const i=this.gl;return[0,0,i.drawingBufferWidth,i.drawingBufferHeight]}set(i){const c=this.current;(i[0]!==c[0]||i[1]!==c[1]||i[2]!==c[2]||i[3]!==c[3]||this.dirty)&&(this.gl.viewport(i[0],i[1],i[2],i[3]),this.current=i,this.dirty=!1)}}class ih extends tn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindFramebuffer(c.FRAMEBUFFER,i),this.current=i,this.dirty=!1}}class ou extends tn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindRenderbuffer(c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class au extends tn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindTexture(c.TEXTURE_2D,i),this.current=i,this.dirty=!1}}class rp extends tn{getDefault(){return null}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.bindBuffer(c.ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class su extends tn{getDefault(){return null}set(i){const c=this.gl;c.bindBuffer(c.ELEMENT_ARRAY_BUFFER,i),this.current=i,this.dirty=!1}}class nh extends tn{getDefault(){return null}set(i){this.gl&&(i!==this.current||this.dirty)&&(this.gl.bindVertexArray(i),this.current=i,this.dirty=!1)}}class lu extends tn{getDefault(){return 4}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_ALIGNMENT,i),this.current=i,this.dirty=!1}}class Sl extends tn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_PREMULTIPLY_ALPHA_WEBGL,i),this.current=i,this.dirty=!1}}class gc extends tn{getDefault(){return!1}set(i){if(i===this.current&&!this.dirty)return;const c=this.gl;c.pixelStorei(c.UNPACK_FLIP_Y_WEBGL,i),this.current=i,this.dirty=!1}}class ua extends tn{constructor(i,c){super(i),this.context=i,this.parent=c}getDefault(){return null}}class ip extends ua{setDirty(){this.dirty=!0}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class np extends ua{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferRenderbuffer(c.FRAMEBUFFER,this.attachment(),c.RENDERBUFFER,i),this.current=i,this.dirty=!1}}class Qf extends ua{attachment(){return this.gl.DEPTH_ATTACHMENT}set(i){if(i===this.current&&!this.dirty)return;this.context.bindFramebuffer.set(this.parent);const c=this.gl;c.framebufferTexture2D(c.FRAMEBUFFER,this.attachment(),c.TEXTURE_2D,i,0),this.current=i,this.dirty=!1}}class op extends np{attachment(){return this.gl.DEPTH_STENCIL_ATTACHMENT}}const _c=(g,i,c)=>({u_matrix:g,u_image0:0,u_skirt_height:i,u_ground_shadow_factor:c}),Oo=(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W)=>({u_proj_matrix:Float32Array.from(g),u_globe_matrix:i,u_normalize_matrix:Float32Array.from(p),u_merc_matrix:c,u_zoom_transition:x,u_merc_center:w,u_image0:0,u_frustum_tl:A,u_frustum_tr:I,u_frustum_br:O,u_frustum_bl:z,u_globe_pos:k,u_globe_radius:H,u_viewport:V,u_grid_matrix:W?Float32Array.from(W):new Float32Array(9),u_skirt_height:X,u_far_z_cutoff:Y});function oh(g,i){return g!=null&&i!=null&&!(!g.hasData()||!i.hasData())&&g.demTexture!=null&&i.demTexture!=null&&g.tileID.key!==i.tileID.key}const yc=new class{constructor(){this.operations={}}newMorphing(g,i,c,p,x){if(g in this.operations){const w=this.operations[g];w.to.tileID.key!==c.tileID.key&&(w.queued=c)}else this.operations[g]={startTime:p,phase:0,duration:x,from:i,to:c,queued:null}}getMorphValuesForProxy(g){if(!(g in this.operations))return null;const i=this.operations[g];return{from:i.from,to:i.to,phase:i.phase}}update(g){for(const i in this.operations){const c=this.operations[i];for(c.phase=(g-c.startTime)/c.duration;c.phase>=1||!this._validOp(c);)if(!this._nextOp(c,g)){delete this.operations[i];break}}}_nextOp(g,i){return!!g.queued&&(g.from=g.to,g.to=g.queued,g.queued=null,g.phase=0,g.startTime=i,!0)}_validOp(g){return g.from.hasData()&&g.to.hasData()}},Am={0:null,1:"TERRAIN_VERTEX_MORPHING"};function Em(g,i,c){if(i===0)return 0;const p=i<1&&c===514?.25/i:1;return 6*Math.pow(1.5,22-g)*Math.max(i,1)*p}function t0(g,i){const c=1<<g.z;return!i&&(g.x===0||g.x===c-1)||g.y===0||g.y===c-1}const Zn=g=>({u_matrix:g});function vc(g,i,c,p,x){if(x>0){const w=n.o.now(),A=(w-g.timeAdded)/x,I=i?(w-i.timeAdded)/x:-1,O=c.getSource(),z=p.coveringZoomLevel({tileSize:O.tileSize,roundZoom:O.roundZoom}),k=!i||Math.abs(i.tileID.overscaledZ-z)>Math.abs(g.tileID.overscaledZ-z),H=k&&g.refreshedUponExpiration?1:n.aA(k?A:1-I,0,1);return i?{opacity:1,mix:1-H,isFading:A<1}:{opacity:H,mix:0,isFading:A<1}}return{opacity:1,mix:0,isFading:!1}}class jh extends Uo{constructor(i){const c=Rh("mock-dem",{type:"raster-dem",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("mock-dem",c,!1),c.setEventedParent(this),this._sourceLoaded=!0}_loadTile(i,c){i.state="loaded",c(null)}}class ea extends Uo{constructor(i){const c=Rh("proxy",{type:"geojson",maxzoom:i.transform.maxZoom},i.style.dispatcher,i.style);super("proxy",c,!1),c.setEventedParent(this),this.map=this.getSource().map=i,this.used=this._sourceLoaded=!0,this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}update(i,c,p){if(i.freezeTileCoverage)return;this.transform=i;const x=i.coveringTiles({tileSize:this._source.tileSize,minzoom:this._source.minzoom,maxzoom:this._source.maxzoom,roundZoom:this._source.roundZoom,reparseOverscaled:this._source.reparseOverscaled}).reduce(((w,A)=>{if(w[A.key]="",!this._tiles[A.key]){const I=new Hc(A,this._source.tileSize*A.overscaleFactor(),i.tileZoom,void 0,void 0,this._source.worldview);I.state="loaded",this._tiles[A.key]=I}return w}),{});for(const w in this._tiles)w in x||(this.freeFBO(w),this._tiles[w].unloadVectorData(),delete this._tiles[w])}freeFBO(i){const c=this.proxyCachedFBO[i];if(c!==void 0){const p=Object.values(c);this.renderCachePool.push(...p),delete this.proxyCachedFBO[i]}}deallocRenderCache(){this.renderCache.forEach((i=>i.fb.destroy())),this.renderCache=[],this.renderCachePool=[],this.proxyCachedFBO={}}}class Gh extends n.aO{constructor(i,c,p){super(i.overscaledZ,i.wrap,i.canonical.z,i.canonical.x,i.canonical.y),this.proxyTileKey=c,this.projMatrix=p}}class Tl extends n.dH{constructor(i,c){super(),this._debugParams={sortTilesHiZFirst:!0,disableRenderCache:!1},i.tp.registerParameter(this._debugParams,["Terrain"],"sortTilesHiZFirst",{},(()=>{this._style.map.triggerRepaint()})),i.tp.registerParameter(this._debugParams,["Terrain"],"disableRenderCache",{},(()=>{this._style.map.triggerRepaint()})),i.tp.registerButton(["Terrain"],"Invalidate Render Cache",(()=>{this.invalidateRenderCache=!0,this._style.map.triggerRepaint()})),this.painter=i,this.terrainTileForTile={},this.prevTerrainTileForTile={};const[p,x,w]=(function(O){const z=new n.bd,k=new n.b1,H=131;z.reserve(17161),k.reserve(33800);const V=n.al/128,X=n.al+V/2,Y=X+V;for(let re=-V;re<Y;re+=V)for(let K=-V;K<Y;K+=V){const ae=K<0||K>X||re<0||re>X?24575:0,ue=n.aA(Math.round(K),0,n.al),fe=n.aA(Math.round(re),0,n.al);z.emplaceBack(ue+ae,fe)}const W=(re,K)=>{const ae=K*H+re;k.emplaceBack(ae+1,ae,ae+H),k.emplaceBack(ae+H,ae+H+1,ae+1)};for(let re=1;re<129;re++)for(let K=1;K<129;K++)W(K,re);return[0,129].forEach((re=>{for(let K=0;K<130;K++)W(K,re),W(re,K)})),[z,k,32768]})(),A=i.context;this.gridBuffer=A.createVertexBuffer(p,n.bf.members),this.gridIndexBuffer=A.createIndexBuffer(x),this.gridSegments=n.bg.simpleSegment(0,0,p.length,x.length),this.gridNoSkirtSegments=n.bg.simpleSegment(0,0,p.length,w),this.proxyCoords=[],this.proxiedCoords={},this._visibleDemTiles=[],this._drapedRenderBatches=[],this._sourceTilesOverlap={},this.proxySourceCache=new ea(c.map),this.orthoMatrix=n.bC(),n.cd(this.orthoMatrix,this.painter.transform.projection.name==="globe"?.015:0,n.al,0,n.al,0,1);const I=A.gl;this._overlapStencilMode=new vr({func:I.GEQUAL,mask:255},0,255,I.KEEP,I.KEEP,I.REPLACE),this._previousZoom=i.transform.zoom,this.pool=[],this._findCoveringTileCache={},this._tilesDirty={},this.style=c,this._useVertexMorphing=!0,this._exaggeration=1,this._mockSourceCache=new jh(c.map),this._pendingGroundEffectLayers=[]}set style(i){i.on("data",this._onStyleDataEvent.bind(this)),this._style=i,this._style.map.on("moveend",(()=>{this._clearLineLayersFromRenderCache()}))}update(i,c,p){if(i&&i.terrain){this._style!==i&&(this.style=i,this._evaluationZoom=void 0);const x=i.terrain.properties,w=i.terrain.drapeRenderMode===0,A=i.terrain.isZoomDependent();this._previousUpdateTimestamp=this.enabled?this._updateTimestamp:void 0,this._updateTimestamp=n.o.now();const I=i.terrain&&i.terrain.scope,O=x.get("source"),z=w?this._mockSourceCache:i.getSourceCache(O,I);if(!z)return void n.w(`Couldn't find terrain source "${O}".`);if(this.sourceCache=z,this._attenuationRange=i.terrain.getAttenuationRange(),this._exaggeration=A?this.calculateExaggeration(c):x.get("exaggeration"),!c.projection.requiresDraping&&A&&this._exaggeration===0)return void this._disable();this.enabled=!0;const k=()=>{this.sourceCache.used&&n.w(`Raster DEM source '${this.sourceCache.id}' is used both for terrain and as layer source.
This leads to lower resolution of hillshade. For full hillshade resolution but higher memory consumption, define another raster DEM source.`);const H=this.getScaledDemTileSize();this.sourceCache.update(c,H,!0),this.resetTileLookupCache(this.sourceCache.id)};this.sourceCache.usedForTerrain||(this.resetTileLookupCache(this.sourceCache.id),this.sourceCache.usedForTerrain=!0,k(),this._initializing=!0),k(),c.updateElevation(!0,p),this.resetTileLookupCache(this.proxySourceCache.id),this.proxySourceCache.update(c),this._emptyDEMTextureDirty=!0,this._previousZoom=c.zoom}else this._disable()}calculateExaggeration(i){if(this._attenuationRange&&i.zoom>=Math.ceil(this._attenuationRange[1]))return this._style.terrain.getExaggeration(i.zoom);const c=this._previousCameraAltitude,p=i.getFreeCameraOptions().position.z/i.pixelsPerMeter*i.worldSize;this._previousCameraAltitude=p;const x=c!=null?p-c:Number.MAX_VALUE;if(Math.abs(x)<2)return this._exaggeration;const w=i.zoom,A=this._style.terrain;if(!this._previousUpdateTimestamp)return A.getExaggeration(w);let I=w-this._previousZoom;const O=this._previousUpdateTimestamp;let z=w;this._evaluationZoom!=null&&(z=this._evaluationZoom,Math.abs(w-z)>.5&&(I=.5*(w-z+I)),I*x<0&&(z+=I)),this._evaluationZoom=z;const k=A.getExaggeration(z),H=k===A.getExaggeration(Math.max(0,z-.1));if(H&&Math.abs(k-this._exaggeration)<.01)return k;let V=Math.min(.1,.00375*(this._updateTimestamp-O));return(H||k<.1||Math.abs(I)<1e-4)&&(V=Math.min(.2,4*V)),n.ak(this._exaggeration,k,V)}resetTileLookupCache(i){this._findCoveringTileCache[i]={}}attenuationRange(){return this._attenuationRange}getDemUpscale(){return this.proxySourceCache.getSource().tileSize/128}getScaledDemTileSize(){return this.sourceCache.getSource().tileSize/128*this.proxySourceCache.getSource().tileSize}_onStyleDataEvent(i){i.dataType==="source"&&i.coord?this._clearRenderCacheForTile(i.sourceCacheId,i.coord):i.dataType==="style"&&(this.invalidateRenderCache=!0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this._previousCameraAltitude=void 0)}_disable(){if(this.enabled&&(this.enabled=!1,this._emptyDEMTextureDirty=!0,this._sharedDepthStencil=void 0,this._evaluationZoom=void 0,this._previousUpdateTimestamp=void 0,this.proxySourceCache.deallocRenderCache(),this._style))for(const i in this._style._mergedSourceCaches)this._style._mergedSourceCaches[i].usedForTerrain=!1}destroy(){this._disable(),this._emptyDEMTexture&&this._emptyDEMTexture.destroy(),this.pool.forEach((i=>i.fb.destroy())),this.pool=[],this.framebufferCopyTexture&&this.framebufferCopyTexture.destroy()}_source(){return this.enabled?this.sourceCache:null}isUsingMockSource(){return this.sourceCache===this._mockSourceCache}exaggeration(){return this.enabled?this._exaggeration:0}get visibleDemTiles(){return this._visibleDemTiles}get drapeBufferSize(){const i=2*this.proxySourceCache.getSource().tileSize;return[i,i]}set useVertexMorphing(i){this._useVertexMorphing=i}updateTileBinding(i){if(!this.enabled)return;this.prevTerrainTileForTile=this.terrainTileForTile;const c=this.proxySourceCache,p=this.painter.transform;this._initializing&&(this._initializing=p._centerAltitude===0&&this.getAtPointOrZero(n.ae.fromLngLat(p.center),-1)===-1,this._emptyDEMTextureDirty=!this._initializing);const x=this.proxyCoords=c.getIds().map((O=>{const z=c.getTileByID(O).tileID;return z.projMatrix=p.calculateProjMatrix(z.toUnwrapped()),z}));(function(O,z){const k=z.transform.pointCoordinate(z.transform.getCameraPoint()),H=new n.P(k.x,k.y);O.sort(((V,X)=>{if(X.overscaledZ-V.overscaledZ)return X.overscaledZ-V.overscaledZ;const Y=new n.P(V.canonical.x+(1<<V.canonical.z)*V.wrap,V.canonical.y),W=new n.P(X.canonical.x+(1<<X.canonical.z)*X.wrap,X.canonical.y),re=H.mult(1<<V.canonical.z);return re.x-=.5,re.y-=.5,re.distSqr(Y)-re.distSqr(W)}))})(x,this.painter);const w=this.proxyToSource||{};this.proxyToSource={},x.forEach((O=>{this.proxyToSource[O.key]={}})),this.terrainTileForTile={};const A=this._style._mergedSourceCaches;for(const O in A){const z=A[O];if(!z.used||(z!==this.sourceCache&&this.resetTileLookupCache(z.id),this._setupProxiedCoordsForOrtho(z,i[O],w),z.usedForTerrain))continue;const k=i[O];z.getSource().reparseOverscaled&&this._assignTerrainTiles(k)}this.proxiedCoords[c.id]=x.map((O=>new Gh(O,O.key,this.orthoMatrix))),this._assignTerrainTiles(x),this._prepareDEMTextures(),this._setupDrapedRenderBatches(),this._initFBOPool(),this._setupRenderCache(w),this.renderingToTexture=!1;const I={};this._visibleDemTiles=[];for(const O of this.proxyCoords){const z=this.terrainTileForTile[O.key];if(!z)continue;const k=z.tileID.key;k in I||(this._visibleDemTiles.push(z),I[k]=k)}}_assignTerrainTiles(i){this._initializing||i.forEach((c=>{if(this.terrainTileForTile[c.key])return;const p=this._findTileCoveringTileID(c,this.sourceCache);p&&(this.terrainTileForTile[c.key]=p)}))}_prepareDEMTextures(){const i=this.painter.context,c=i.gl;for(const p in this.terrainTileForTile){const x=this.terrainTileForTile[p],w=x.dem;!w||x.demTexture&&!x.needsDEMTextureUpload||(i.activeTexture.set(c.TEXTURE1),eh(this.painter,x,w))}}_prepareDemTileUniforms(i,c,p,x){if(!c||c.demTexture==null)return!1;const w=i.tileID.canonical,A=Math.pow(2,c.tileID.canonical.z-w.z),I=x||"";return p[`u_dem_tl${I}`]=[w.x*A%1,w.y*A%1],p[`u_dem_scale${I}`]=A,!0}get emptyDEMTexture(){return!this._emptyDEMTextureDirty&&this._emptyDEMTexture?this._emptyDEMTexture:this._updateEmptyDEMTexture()}_getLoadedAreaMinimum(){if(!this.enabled)return 0;let i=0;const c=this._visibleDemTiles.reduce(((p,x)=>{if(!x.dem)return p;const w=x.dem.tree.minimums[0];return w>0&&i++,p+w}),0);return i?c/i:0}_updateEmptyDEMTexture(){const i=this.painter.context,c=i.gl;i.activeTexture.set(c.TEXTURE2);const p=this._getLoadedAreaMinimum(),x=new n.dI({width:1,height:1},new Float32Array([p]));this._emptyDEMTextureDirty=!1;let w=this._emptyDEMTexture;return w?w.update(x,{premultiply:!1}):w=this._emptyDEMTexture=new n.T(i,x,c.R32F,{premultiply:!1}),w}setupElevationDraw(i,c,p){const x=this.painter.context,w=x.gl,A={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0};A.u_exaggeration=this.exaggeration();let I=null,O=null,z=1;if(p&&p.morphing&&this._useVertexMorphing){const X=p.morphing.srcDemTile,Y=p.morphing.dstDemTile;z=p.morphing.phase,X&&Y&&(this._prepareDemTileUniforms(i,X,A,"_prev")&&(O=X),this._prepareDemTileUniforms(i,Y,A)&&(I=Y))}const k=X=>X&&X.demTexture&&this.painter.linearFloatFilteringSupported()?w.LINEAR:w.NEAREST;let H=null;var V;if(this.enabled?O&&I?(H=I.demTexture,x.activeTexture.set(w.TEXTURE4),O.demTexture.bind(k(O),w.CLAMP_TO_EDGE),A.u_dem_lerp=z):(I=this.terrainTileForTile[i.tileID.key],H=this._prepareDemTileUniforms(i,I,A)?I.demTexture:this.emptyDEMTexture):H=this.emptyDEMTexture,x.activeTexture.set(w.TEXTURE2),H&&(A.u_dem_size=(V=H).size[0]===1?1:V.size[0]-2,H.bind(k(I),w.CLAMP_TO_EDGE)),this.painter.setupDepthForOcclusion(p&&p.useDepthForOcclusion,c,A),p&&p.useMeterToDem&&I){const X=(1<<I.tileID.canonical.z)*n.ce(1,this.painter.transform.center.lat)*this.sourceCache.getSource().tileSize;A.u_meter_to_dem=X}if(p&&p.labelPlaneMatrixInv&&(A.u_label_plane_matrix_inv=p.labelPlaneMatrixInv),c.setTerrainUniformValues(x,A),this.painter.transform.projection.name==="globe"){const X=this.globeUniformValues(this.painter.transform,i.tileID.canonical,p&&p.useDenormalizedUpVectorScale);c.setGlobeUniformValues(x,X)}}globeUniformValues(i,c,p){const x=i.projection;return{u_tile_tl_up:x.upVector(c,0,0),u_tile_tr_up:x.upVector(c,n.al,0),u_tile_br_up:x.upVector(c,n.al,n.al),u_tile_bl_up:x.upVector(c,0,n.al),u_tile_up_scale:p?n.dJ(1):x.upVectorScale(c,i.center.lat,i.worldSize).metersToTile}}renderToBackBuffer(i){const c=this.painter,p=this.painter.context;i.length!==0&&(p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),c.gpuTimingDeferredRenderStart(),this.renderingToTexture=!1,(function(x,w,A,I,O){if(x.transform.projection.name==="globe")(function(z,k,H,V,X){const Y=z.context,W=Y.gl;let re,K;const ae=z.transform,ue=n.dA(z,Y,ae),fe=(nt,Ge)=>{if(K===Ge)return;const tt=[Am[Ge],"PROJECTION_GLOBE_VIEW"];ue&&tt.push("CUSTOM_ANTIALIASING");const It=z.isTileAffectedByFog(nt);re=z.getOrCreateProgram("globeRaster",{defines:tt,overrideFog:It}),K=Ge},xe=z.colorModeForRenderPass(),ge=new qt(W.LEQUAL,qt.ReadWrite,z.depthRangeFor3D);yc.update(X);const Te=n.dB(ae),ye=[n.aF(ae.center.lng),n.aJ(ae.center.lat)],_e=z.globeSharedBuffers,Se=[ae.width*n.o.devicePixelRatio,ae.height*n.o.devicePixelRatio],He=Float32Array.from(ae.globeMatrix),ze={useDenormalizedUpVectorScale:!0};{const nt=z.transform,Ge=Em(nt.zoom,k.exaggeration(),k.sourceCache._source.tileSize);K=-1;const tt=W.TRIANGLES;for(const It of V){const qe=H.getTile(It),Oe=vr.disabled,ot=k.prevTerrainTileForTile[It.key],je=k.terrainTileForTile[It.key];oh(ot,je)&&yc.newMorphing(It.key,ot,je,X,250),Y.activeTexture.set(W.TEXTURE0),qe.texture&&qe.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);const at=yc.getMorphValuesForProxy(It.key),ht=at?1:0;at&&Object.assign(ze,{morphing:{srcDemTile:at.from,dstDemTile:at.to,phase:n.dz(at.phase)}});const wt=n.dC(It.canonical),ft=n.dD(wt.getCenter().lat),pt=n.dE(It.canonical,wt,ft,nt.worldSize/nt._pixelsPerMercatorPixel),rr=n.bk(n.dF(It.canonical)),tr=Oo(nt.expandedFarZProjMatrix,He,Te,rr,n.aj(nt.zoom),ye,nt.frustumCorners.TL,nt.frustumCorners.TR,nt.frustumCorners.BR,nt.frustumCorners.BL,nt.globeCenterInViewSpace,nt.globeRadius,Se,Ge,nt._farZ,pt);if(fe(It,ht),re&&(k.setupElevationDraw(qe,re,ze),z.uploadCommonUniforms(Y,re,It.toUnwrapped()),_e)){const[or,Qt,fr]=_e.getGridBuffers(ft,Ge!==0);re.draw(z,tt,ge,Oe,xe,Tr.backCCW,tr,"globe_raster",or,Qt,fr)}}}if(_e&&(z.renderDefaultNorthPole||z.renderDefaultSouthPole)){const nt=["GLOBE_POLES","PROJECTION_GLOBE_VIEW"];ue&&nt.push("CUSTOM_ANTIALIASING"),re=z.getOrCreateProgram("globeRaster",{defines:nt});for(const Ge of V){const{x:tt,y:It,z:qe}=Ge.canonical,Oe=It===0,ot=It===(1<<qe)-1,[je,at,ht,wt]=_e.getPoleBuffers(qe,!1);if(wt&&(Oe||ot)){const ft=H.getTile(Ge);Y.activeTexture.set(W.TEXTURE0),ft.texture&&ft.texture.bind(W.LINEAR,W.CLAMP_TO_EDGE);let pt=n.dG(qe,tt,ae);const rr=n.bk(n.dF(Ge.canonical)),tr=(or,Qt)=>or.draw(z,W.TRIANGLES,ge,vr.disabled,xe,Tr.disabled,Oo(ae.expandedFarZProjMatrix,pt,pt,rr,0,ye,ae.frustumCorners.TL,ae.frustumCorners.TR,ae.frustumCorners.BR,ae.frustumCorners.BL,ae.globeCenterInViewSpace,ae.globeRadius,Se,0,ae._farZ),"globe_pole_raster",Qt,ht,wt);k.setupElevationDraw(ft,re,ze),z.uploadCommonUniforms(Y,re,Ge.toUnwrapped()),Oe&&z.renderDefaultNorthPole&&tr(re,je),ot&&z.renderDefaultSouthPole&&(pt=n.cR(n.bC(),pt,[1,-1,1]),tr(re,at))}}}})(x,w,A,I,O);else{const z=x.context,k=z.gl;let H,V;const X=x.shadowRenderer,Y=Qc(x,x.longestCutoffRange),W=xe=>{if(V===xe)return;const ge=[];ge.push(Am[xe]),Y.shouldRenderCutoff&&ge.push("RENDER_CUTOFF"),X&&(ge.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&ge.push("NORMAL_OFFSET")),H=x.getOrCreateProgram("terrainRaster",{defines:ge}),V=xe},re=x.colorModeForRenderPass(),K=new qt(k.LEQUAL,qt.ReadWrite,x.depthRangeFor3D);yc.update(O);const ae=x.transform,ue=Em(ae.zoom,w.exaggeration(),w.sourceCache._source.tileSize);let fe=[0,0,0];if(X){const xe=x.style.directionalLight,ge=x.style.ambientLight;xe&&ge&&(fe=Ts(x.style,xe,ge))}{V=-1;const xe=k.TRIANGLES,[ge,Te]=[w.gridIndexBuffer,w.gridSegments];for(const ye of I){const _e=A.getTile(ye),Se=vr.disabled,He=w.prevTerrainTileForTile[ye.key],ze=w.terrainTileForTile[ye.key];oh(He,ze)&&yc.newMorphing(ye.key,He,ze,O,250),z.activeTexture.set(k.TEXTURE0),_e.texture&&_e.texture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const nt=yc.getMorphValuesForProxy(ye.key),Ge=nt?1:0;let tt;nt&&(tt={morphing:{srcDemTile:nt.from,dstDemTile:nt.to,phase:n.dz(nt.phase)}});const It=_c(ye.projMatrix,t0(ye.canonical,ae.renderWorldCopies)?ue/10:ue,fe);if(W(Ge),!H)continue;w.setupElevationDraw(_e,H,tt);const qe=ye.toUnwrapped();X&&X.setupShadows(qe,H),x.uploadCommonUniforms(z,H,qe,null,Y),H.draw(x,xe,K,Se,re,Tr.backCCW,It,"terrain_raster",w.gridBuffer,ge,Te)}}}})(c,this,this.proxySourceCache,i,this._updateTimestamp),this.renderingToTexture=!0,c.gpuTimingDeferredRenderEnd(),i.splice(0,i.length))}renderBatch(i){if(this._drapedRenderBatches.length===0)return i+1;this.renderingToTexture=!0;const c=this.painter,p=this.painter.context,x=this.proxySourceCache,w=this.proxiedCoords[x.id],A=this._drapedRenderBatches.shift(),I=c.style.order,O=[];let z=0;for(const k of w){const H=x.getTileByID(k.proxyTileKey),V=x.proxyCachedFBO[k.key]?x.proxyCachedFBO[k.key][i]:void 0,X=V!==void 0?x.renderCache[V]:this.pool[z++],Y=V!==void 0;if(H.texture=X.tex,Y&&!X.dirty){O.push(H.tileID);continue}let W;p.bindFramebuffer.set(X.fb.framebuffer),this.renderedToTile=!1,X.dirty&&(p.clear({color:n.ao.transparent,stencil:0}),X.dirty=!1);for(let re=A.start;re<=A.end;++re){const K=c.style._mergedLayers[I[re]];if(K.isHidden(c.transform.zoom))continue;const ae=c.style.getLayerSourceCache(K),ue=ae?this.proxyToSource[k.key][ae.id]:[k];if(!ue)continue;const fe=ue;p.viewport.set([0,0,X.fb.width,X.fb.height]),W!==(ae?ae.id:null)&&(this._setupStencil(X,ue,K,ae),W=ae?ae.id:null),c.renderLayer(c,ae,K,fe)}if(this._drapedRenderBatches.length===0)for(const re of this._pendingGroundEffectLayers){const K=c.style._mergedLayers[I[re]];if(K.isHidden(c.transform.zoom))continue;const ae=c.style.getLayerSourceCache(K),ue=ae?this.proxyToSource[k.key][ae.id]:[k];if(!ue)continue;const fe=ue;p.viewport.set([0,0,X.fb.width,X.fb.height]),W!==(ae?ae.id:null)&&(this._setupStencil(X,ue,K,ae),W=ae?ae.id:null),c.renderLayer(c,ae,K,fe)}this.renderedToTile?(X.dirty=!0,O.push(H.tileID)):Y||--z,z===5&&(z=0,this.renderToBackBuffer(O))}return this.renderToBackBuffer(O),this.renderingToTexture=!1,p.bindFramebuffer.set(null),p.viewport.set([0,0,c.width,c.height]),A.end+1}postRender(){}isLayerOrderingCorrect(i){const c=i.order.length;let p=-1,x=c;for(let w=0;w<c;++w)this._style.isLayerDraped(i._mergedLayers[i.order[w]])?p=Math.max(p,w):x=Math.min(x,w);return x>p}getMinElevationBelowMSL(){let i=0;return this._visibleDemTiles.filter((c=>c.dem)).forEach((c=>{i=Math.min(i,c.dem.tree.minimums[0])})),i===0?i:(i-30)*this._exaggeration}raycast(i,c,p){if(!this._visibleDemTiles)return null;const x=this._visibleDemTiles.filter((w=>w.dem)).map((w=>{const A=w.tileID,I=1<<A.overscaledZ,{x:O,y:z}=A.canonical,k=O/I,H=(O+1)/I,V=z/I,X=(z+1)/I;return{minx:k,miny:V,maxx:H,maxy:X,t:w.dem.tree.raycastRoot(k,V,H,X,i,c,p),tile:w}}));x.sort(((w,A)=>(w.t!==null?w.t:Number.MAX_VALUE)-(A.t!==null?A.t:Number.MAX_VALUE)));for(const w of x){if(w.t==null)return null;const A=w.tile.dem.tree.raycast(w.minx,w.miny,w.maxx,w.maxy,i,c,p);if(A!=null)return A}return null}_createFBO(){const i=this.painter.context,c=i.gl,p=this.drapeBufferSize;i.activeTexture.set(c.TEXTURE0);const x=new n.T(i,{width:p[0],height:p[1],data:null},c.RGBA8);x.bind(c.LINEAR,c.CLAMP_TO_EDGE);const w=i.createFramebuffer(p[0],p[1],!0,null);return w.colorAttachment.set(x.texture),w.depthAttachment=new op(i,w.framebuffer),this._sharedDepthStencil===void 0?(this._sharedDepthStencil=i.createRenderbuffer(i.gl.DEPTH_STENCIL,p[0],p[1]),this._stencilRef=0,w.depthAttachment.set(this._sharedDepthStencil),i.clear({stencil:0})):w.depthAttachment.set(this._sharedDepthStencil),i.extTextureFilterAnisotropic&&c.texParameterf(c.TEXTURE_2D,i.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,i.extTextureFilterAnisotropicMax),{fb:w,tex:x,dirty:!1}}_initFBOPool(){for(;this.pool.length<Math.min(5,this.proxyCoords.length);)this.pool.push(this._createFBO())}_shouldDisableRenderCache(){if(this._debugParams.disableRenderCache||this._style.hasLightTransitions())return!0;for(const i in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[i].hasTransition())return!0;return this._style.order.some((i=>{const c=this._style._mergedLayers[i],p=c.isHidden(this.painter.transform.zoom);return c.type==="hillshade"||c.type==="custom"?!p&&c.shouldRedrape():!p&&c.hasTransition()}))}_clearLineLayersFromRenderCache(){let i=!1;for(const p of this._style.getSources())if(p instanceof Vo){i=!0;break}if(!i)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(x);if(w&&!c[w.id]&&!x.isHidden(this.painter.transform.zoom)&&x.type==="line"&&x.widthExpression()instanceof n.ad){c[w.id]=!0;for(const A of this.proxyCoords){const I=this.proxyToSource[A.key][w.id];if(I)for(const O of I)this._clearRenderCacheForTile(w.id,O)}}}}_clearRasterLayersFromRenderCache(){let i=!1;for(const p in this._style._mergedSourceCaches)if(this._style._mergedSourceCaches[p]._source instanceof Yo){i=!0;break}if(!i)return;const c={};for(let p=0;p<this._style.order.length;++p){const x=this._style._mergedLayers[this._style.order[p]],w=this._style.getLayerSourceCache(x);if(!w||c[w.id]||x.isHidden(this.painter.transform.zoom)||x.type!=="raster")continue;const A=x.paint.get("raster-fade-duration");for(const I of this.proxyCoords){const O=this.proxyToSource[I.key][w.id];if(O)for(const z of O){const k=vc(w.getTile(z),w.findLoadedParent(z,0),w,this.painter.transform,A);(k.opacity!==1||k.mix!==0)&&this._clearRenderCacheForTile(w.id,z)}}}}_setupDrapedRenderBatches(){this._style.updateDrapeFirstLayers();const i=this._style.order,c=i.length;if(c===0)return;const p=[];this._pendingGroundEffectLayers=[];let x,w=0,A=this._style._mergedLayers[i[w]];for(;!this._style.isLayerDraped(A)&&A.isHidden(this.painter.transform.zoom)&&++w<c;)A=this._style._mergedLayers[i[w]];for(;w<c;++w){const I=this._style._mergedLayers[i[w]];I.isHidden(this.painter.transform.zoom)||(this._style.isLayerDraped(I)?x===void 0&&(x=w):(I.type==="fill-extrusion"&&this._pendingGroundEffectLayers.push(w),x!==void 0&&(p.push({start:x,end:w-1}),x=void 0)))}if(x!==void 0&&p.push({start:x,end:w-1}),p.length!==0){const I=p[p.length-1];this._pendingGroundEffectLayers.every((O=>O>I.end))||n.w("fill-extrusion with flood lighting and/or ground ambient occlusion should be moved to be on top of all draped layers.")}this._drapedRenderBatches=p}_setupRenderCache(i){const c=this.proxySourceCache;if(this._shouldDisableRenderCache()||this.invalidateRenderCache){if(this.invalidateRenderCache=!1,c.renderCache.length>c.renderCachePool.length){const A=Object.values(c.proxyCachedFBO);c.proxyCachedFBO={};for(let I=0;I<A.length;++I){const O=Object.values(A[I]);c.renderCachePool.push(...O)}}return}this._clearRasterLayersFromRenderCache();const p=this.proxyCoords,x=this._tilesDirty;for(let A=p.length-1;A>=0;A--){const I=p[A];if(c.getTileByID(I.key),c.proxyCachedFBO[I.key]!==void 0){const O=i[I.key],z=this.proxyToSource[I.key];let k=0;for(const H in z){const V=z[H],X=O[H];if(!X||X.length!==V.length||V.some(((Y,W)=>Y!==X[W]||x[H]&&x[H].hasOwnProperty(Y.key)))){k=-1;break}++k}for(const H in c.proxyCachedFBO[I.key])c.renderCache[c.proxyCachedFBO[I.key][H]].dirty=k<0||k!==Object.values(O).length}}const w=[...this._drapedRenderBatches];w.sort(((A,I)=>I.end-I.start-(A.end-A.start)));for(const A of w)for(const I of p){if(c.proxyCachedFBO[I.key])continue;let O=c.renderCachePool.pop();O===void 0&&c.renderCache.length<50&&(O=c.renderCache.length,c.renderCache.push(this._createFBO())),O!==void 0&&(c.proxyCachedFBO[I.key]={},c.proxyCachedFBO[I.key][A.start]=O,c.renderCache[O].dirty=!0)}this._tilesDirty={}}_setupStencil(i,c,p,x){if(!x||!this._sourceTilesOverlap[x.id])return void(this._overlapStencilType&&(this._overlapStencilType=!1));const w=this.painter.context,A=w.gl;if(c.length<=1)return void(this._overlapStencilType=!1);let I;if(p.isTileClipped())I=c.length,this._overlapStencilMode.test={func:A.EQUAL,mask:255},this._overlapStencilType="Clip";else{if(!(c[0].overscaledZ>c[c.length-1].overscaledZ))return void(this._overlapStencilType=!1);I=1,this._overlapStencilMode.test={func:A.GREATER,mask:255},this._overlapStencilType="Mask"}this._stencilRef+I>255&&(w.clear({stencil:0}),this._stencilRef=0),this._stencilRef+=I,this._overlapStencilMode.ref=this._stencilRef,p.isTileClipped()&&this._renderTileClippingMasks(c,this._overlapStencilMode.ref)}clipOrMaskOverlapStencilType(){return this._overlapStencilType==="Clip"||this._overlapStencilType==="Mask"}stencilModeForRTTOverlap(i){return this.renderingToTexture&&this._overlapStencilType?(this._overlapStencilType==="Clip"&&(this._overlapStencilMode.ref=this.painter._tileClippingMaskIDs[i.key]),this._overlapStencilMode):vr.disabled}_renderTileClippingMasks(i,c){const p=this.painter,x=this.painter.context,w=x.gl;p._tileClippingMaskIDs={},x.setColorMode(kr.disabled),x.setDepthMode(qt.disabled);const A=p.getOrCreateProgram("clippingMask");for(const I of i){const O=p._tileClippingMaskIDs[I.key]=--c;A.draw(p,w.TRIANGLES,qt.disabled,new vr({func:w.ALWAYS,mask:0},O,255,w.KEEP,w.KEEP,w.REPLACE),kr.disabled,Tr.disabled,Zn(I.projMatrix),"$clipping",p.tileExtentBuffer,p.quadTriangleIndexBuffer,p.tileExtentSegments)}}pointCoordinate(i){const c=this.painter.transform;if(i.x<0||i.x>c.width||i.y<0||i.y>c.height)return null;const p=[i.x,i.y,1,1];n.aC(p,p,c.pixelMatrixInverse),n.cJ(p,p,1/p[3]),p[0]/=c.worldSize,p[1]/=c.worldSize;const x=c._camera.position,w=n.ce(1,c.center.lat),A=[x[0],x[1],x[2]/w,0],I=n.d9([],p.slice(0,3),A);n.aw(I,I);const O=this.raycast(A,I,this._exaggeration);return O!==null&&O?(n.bH(A,A,I,O),A[3]=A[2],A[2]*=w,A):null}_setupProxiedCoordsForOrtho(i,c,p){if(i.getSource()instanceof n.aS)return this._setupProxiedCoordsForImageSource(i,c,p);this._findCoveringTileCache[i.id]=this._findCoveringTileCache[i.id]||{};const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords;for(let O=0;O<w.length;O++){const z=w[O],k=this._findTileCoveringTileID(z,i);if(k){const H=this._createProxiedId(z,k,p[z.key]&&p[z.key][i.id]);x.push(H),this.proxyToSource[z.key][i.id]=[H]}}let A=!1;const I=new Set;for(let O=0;O<c.length;O++){const z=i.getTile(c[O]);if(!z||!z.hasData())continue;const k=this._findTileCoveringTileID(z.tileID,this.proxySourceCache);if(k&&k.tileID.canonical.z!==z.tileID.canonical.z){const H=this.proxyToSource[k.tileID.key][i.id],V=this._createProxiedId(k.tileID,z,p[k.tileID.key]&&p[k.tileID.key][i.id]);H?H.splice(H.length-1,0,V):this.proxyToSource[k.tileID.key][i.id]=[V];const X=this.proxyToSource[k.tileID.key][i.id];I.has(X)||I.add(X),x.push(V),A=!0}}if(this._sourceTilesOverlap[i.id]=A,A&&this._debugParams.sortTilesHiZFirst)for(const O of I)O.sort(((z,k)=>k.overscaledZ-z.overscaledZ))}_setupProxiedCoordsForImageSource(i,c,p){if(!i.getSource().loaded())return;const x=this.proxiedCoords[i.id]=[],w=this.proxyCoords,A=i.getSource(),I=A.tileID;if(!I)return;const O=new n.P(I.x,I.y)._div(1<<I.z),z=A.coordinates.map(n.ae.fromLngLat).reduce(((H,V)=>(H.min.x=Math.min(H.min.x,V.x-O.x),H.min.y=Math.min(H.min.y,V.y-O.y),H.max.x=Math.max(H.max.x,V.x-O.x),H.max.y=Math.max(H.max.y,V.y-O.y),H)),{min:new n.P(Number.MAX_VALUE,Number.MAX_VALUE),max:new n.P(-Number.MAX_VALUE,-Number.MAX_VALUE)}),k=(H,V)=>{const X=H.wrap+H.canonical.x/(1<<H.canonical.z),Y=H.canonical.y/(1<<H.canonical.z),W=n.al/(1<<H.canonical.z),re=V.wrap+V.canonical.x/(1<<V.canonical.z),K=V.canonical.y/(1<<V.canonical.z);return X+W<re+z.min.x||X>re+z.max.x||Y+W<K+z.min.y||Y>K+z.max.y};for(let H=0;H<w.length;H++){const V=w[H];for(let X=0;X<c.length;X++){const Y=i.getTile(c[X]);if(!Y||!Y.hasData()||k(V,Y.tileID))continue;const W=this._createProxiedId(V,Y,p[V.key]&&p[V.key][i.id]),re=this.proxyToSource[V.key][i.id];re?re.push(W):this.proxyToSource[V.key][i.id]=[W],x.push(W)}}}_createProxiedId(i,c,p){let x=this.orthoMatrix;if(p){const w=p.find((A=>A.key===c.tileID.key));if(w)return w}if(c.tileID.key!==i.key){const w=i.canonical.z-c.tileID.canonical.z;let A,I,O;x=n.bC();const z=c.tileID.wrap-i.wrap<<i.overscaledZ;w>0?(A=n.al>>w,I=A*((c.tileID.canonical.x<<w)-i.canonical.x+z),O=A*((c.tileID.canonical.y<<w)-i.canonical.y)):(A=n.al<<-w,I=n.al*(c.tileID.canonical.x-(i.canonical.x+z<<-w)),O=n.al*(c.tileID.canonical.y-(i.canonical.y<<-w))),n.cd(x,0,A,0,A,0,1),n.br(x,x,[I,O,0])}return new Gh(c.tileID,i.key,x)}_findTileCoveringTileID(i,c){let p=c.getTile(i);if(p&&p.hasData())return p;const x=this._findCoveringTileCache[c.id],w=x[i.key];if(p=w?c.getTileByID(w):null,p&&p.hasData()||w===null)return p;let A=p?p.tileID:i,I=A.overscaledZ;const O=c.getSource().minzoom,z=[];if(!w){const H=c.getSource().maxzoom;if(i.canonical.z>=H){const V=i.canonical.z-H;c.getSource().reparseOverscaled?(I=Math.max(i.canonical.z+2,c.transform.tileZoom),A=new n.aO(I,i.wrap,H,i.canonical.x>>V,i.canonical.y>>V)):V!==0&&(I=H,A=new n.aO(I,i.wrap,H,i.canonical.x>>V,i.canonical.y>>V))}A.key!==i.key&&(z.push(A.key),p=c.getTile(A))}const k=H=>{z.forEach((V=>{x[V]=H})),z.length=0};for(I-=1;I>=O&&(!p||!p.hasData());I--){p&&k(p.tileID.key);const H=A.calculateScaledKey(I);if(p=c.getTileByID(H),p&&p.hasData())break;const V=x[H];if(V===null)break;V===void 0?z.push(H):p=c.getTileByID(V)}return k(p?p.tileID.key:null),p&&p.hasData()?p:null}findDEMTileFor(i){return this.enabled?this._findTileCoveringTileID(i,this.sourceCache):null}prepareDrawTile(){this.renderedToTile=!0}_clearRenderCacheForTile(i,c){let p=this._tilesDirty[i];p||(p=this._tilesDirty[i]={}),p[c.key]=!0}}function xc(g,i,c){const p=(function(I,O,z){const k=n.bJ(O,I),H=n.bJ(z,[.2126,.7152,.0722]),V=(Y,W,re)=>(1-re)*Y+re*W,X=V(1-.3*Math.min(H,1),1,Math.min(k+1,1));return V(.92,1,Math.asin(n.aA(O[2],-1,1))/Math.PI+.5)*X})(g,[0,0,1],i),x=[0,0,0];n.c4(x,c.slice(0,3),p);const w=[0,0,0];n.c4(w,i.slice(0,3),g[2]);const A=[0,0,0];return n.d7(A,x,w),n.da(A)}const Cm=["fill","fillOutline","fillPattern","line","linePattern","background","backgroundPattern","hillshade","raster"],ap=["stars","rainParticle","snowParticle","fillExtrusion","fillExtrusionGroundEffect","elevatedStructures","model","symbol"];class sp{static cacheKey(i,c,p,x){let w=`${c}${x?x.cacheKey:""}`;for(const A of p)i.usedDefines.includes(A)&&(w+=`/${A}`);return w}constructor(i,c,p,x,w,A){const I=i.gl;this.program=I.createProgram(),this.configuration=x,this.name=c,this.fixedDefines=[...A];let O=x?x.defines():[];O=O.concat(A.map((Y=>`#define ${Y}`)));const z=`#version 300 es
`;let k=z+O.concat("precision mediump float;",os,Nh.fragmentSource).join(`
`);for(const Y of p.fragmentIncludes)k+=`
${tu[Y]}`;k+=`
${p.fragmentSource}`;let H=z+O.concat("precision highp float;",os,Nh.vertexSource).join(`
`);for(const Y of p.vertexIncludes)H+=`
${tu[Y]}`;this.forceManualRenderingForInstanceIDShaders=i.forceManualRenderingForInstanceIDShaders&&p.vertexSource.indexOf("gl_InstanceID")!==-1,this.forceManualRenderingForInstanceIDShaders&&(H+=`
uniform int u_instanceID;
`),H+=`
${p.vertexSource}`,this.forceManualRenderingForInstanceIDShaders&&(H=H.replaceAll("gl_InstanceID","u_instanceID"));const V=I.createShader(I.FRAGMENT_SHADER);if(I.isContextLost())return void(this.failedToCreate=!0);I.shaderSource(V,k),I.compileShader(V),I.attachShader(this.program,V);const X=I.createShader(I.VERTEX_SHADER);I.isContextLost()?this.failedToCreate=!0:(I.shaderSource(X,H),I.compileShader(X),I.attachShader(this.program,X),this.attributes={},I.linkProgram(this.program),I.deleteShader(X),I.deleteShader(V),this.fixedUniforms=w(i),this.binderUniforms=x?x.getUniforms(i):[],this.forceManualRenderingForInstanceIDShaders&&(this.instancingUniforms=(Y=>({u_instanceID:new n.cg(Y)}))(i)),(A.includes("TERRAIN")||c.indexOf("symbol")!==-1||c.indexOf("circle")!==-1)&&(this.terrainUniforms=(Y=>({u_dem:new n.cg(Y),u_dem_prev:new n.cg(Y),u_dem_tl:new n.cj(Y),u_dem_scale:new n.ci(Y),u_dem_tl_prev:new n.cj(Y),u_dem_scale_prev:new n.ci(Y),u_dem_size:new n.ci(Y),u_dem_lerp:new n.ci(Y),u_exaggeration:new n.ci(Y),u_depth:new n.cg(Y),u_depth_size_inv:new n.cj(Y),u_depth_range_unpack:new n.cj(Y),u_occluder_half_size:new n.ci(Y),u_occlusion_depth_offset:new n.ci(Y),u_meter_to_dem:new n.ci(Y),u_label_plane_matrix_inv:new n.ck(Y)}))(i)),A.includes("GLOBE")&&(this.globeUniforms=(Y=>({u_tile_tl_up:new n.ch(Y),u_tile_tr_up:new n.ch(Y),u_tile_br_up:new n.ch(Y),u_tile_bl_up:new n.ch(Y),u_tile_up_scale:new n.ci(Y)}))(i)),A.includes("FOG")&&(this.fogUniforms=(Y=>({u_fog_matrix:new n.ck(Y),u_fog_range:new n.cj(Y),u_fog_color:new n.d2(Y),u_fog_horizon_blend:new n.ci(Y),u_fog_vertical_limit:new n.cj(Y),u_fog_temporal_offset:new n.ci(Y),u_frustum_tl:new n.ch(Y),u_frustum_tr:new n.ch(Y),u_frustum_br:new n.ch(Y),u_frustum_bl:new n.ch(Y),u_globe_pos:new n.ch(Y),u_globe_radius:new n.ci(Y),u_globe_transition:new n.ci(Y),u_is_globe:new n.cg(Y),u_viewport:new n.cj(Y)}))(i)),A.includes("RENDER_CUTOFF")&&(this.cutoffUniforms=(Y=>({u_cutoff_params:new n.d2(Y)}))(i)),A.includes("LIGHTING_3D_MODE")&&(this.lightsUniforms=(Y=>({u_lighting_ambient_color:new n.ch(Y),u_lighting_directional_dir:new n.ch(Y),u_lighting_directional_color:new n.ch(Y),u_ground_radiance:new n.ch(Y)}))(i)),A.includes("RENDER_SHADOWS")&&(this.shadowUniforms=(Y=>({u_light_matrix_0:new n.ck(Y),u_light_matrix_1:new n.ck(Y),u_fade_range:new n.cj(Y),u_shadow_normal_offset:new n.ch(Y),u_shadow_intensity:new n.ci(Y),u_shadow_texel_size:new n.ci(Y),u_shadow_map_resolution:new n.ci(Y),u_shadow_direction:new n.ch(Y),u_shadow_bias:new n.ch(Y),u_shadowmap_0:new n.cg(Y),u_shadowmap_1:new n.cg(Y)}))(i)))}getAttributeLocation(i,c){let p=this.attributes[c];return p===void 0&&(p=this.attributes[c]=i.getAttribLocation(this.program,c)),p}setTerrainUniformValues(i,c){if(!this.terrainUniforms)return;const p=this.terrainUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setGlobeUniformValues(i,c){if(!this.globeUniforms)return;const p=this.globeUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)p[x]&&p[x].set(this.program,x,c[x])}}setFogUniformValues(i,c){if(!this.fogUniforms)return;const p=this.fogUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setCutoffUniformValues(i,c){if(!this.cutoffUniforms)return;const p=this.cutoffUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setLightsUniformValues(i,c){if(!this.lightsUniforms)return;const p=this.lightsUniforms;if(!this.failedToCreate){i.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}}setShadowUniformValues(i,c){if(this.failedToCreate||!this.shadowUniforms)return;const p=this.shadowUniforms;i.program.set(this.program);for(const x in c)p[x].set(this.program,x,c[x])}_drawDebugWireframe(i,c,p,x,w,A,I,O,z,k){const H=i.options.wireframe;if(H.terrain===!1&&H.layers2D===!1&&H.layers3D===!1)return;const V=i.context;if(!(!(!H.terrain||this.name!=="terrainRaster"&&this.name!=="globeRaster")||!(!H.layers2D||i._terrain&&i._terrain.renderingToTexture||!Cm.includes(this.name))||!(!H.layers3D||!ap.includes(this.name))))return;const X=V.gl,Y=i.wireframeDebugCache.getLinesFromTrianglesBuffer(i.frameCounter,w,V);if(!Y)return;const W=[...this.fixedDefines];W.push("DEBUG_WIREFRAME");const re=i.getOrCreateProgram(this.name,{config:this.configuration,defines:W});V.program.set(re.program);const K=(fe,xe,ge)=>{if(xe[fe]&&ge[fe])for(const Te in xe[fe])ge[fe][Te]&&ge[fe][Te].set(ge.program,Te,xe[fe][Te].current)};z&&z.setUniforms(re.program,V,re.binderUniforms,I,{zoom:O}),K("fixedUniforms",this,re),K("terrainUniforms",this,re),K("globeUniforms",this,re),K("fogUniforms",this,re),K("lightsUniforms",this,re),K("shadowUniforms",this,re),Y.bind(),V.setColorMode(new kr([X.ONE,X.ONE_MINUS_SRC_ALPHA,X.ZERO,X.ONE],n.ao.transparent,[!0,!0,!0,!1])),V.setDepthMode(new qt(c.func===X.LESS?X.LEQUAL:c.func,qt.ReadOnly,c.range)),V.setStencilMode(vr.disabled);const ae=3*A.primitiveLength*2,ue=3*A.primitiveOffset*2*2;if(this.forceManualRenderingForInstanceIDShaders){const fe=k||1;for(let xe=0;xe<fe;++xe)re.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",xe),X.drawElements(X.LINES,ae,X.UNSIGNED_SHORT,ue)}else k&&k>1?X.drawElementsInstanced(X.LINES,ae,X.UNSIGNED_SHORT,ue,k):X.drawElements(X.LINES,ae,X.UNSIGNED_SHORT,ue);w.bind(),V.program.set(this.program),V.setDepthMode(c),V.setStencilMode(p),V.setColorMode(x)}checkUniforms(i,c,p){if(this.fixedDefines.includes(c)){for(const x of Object.keys(p))if(!p[x].initialized)throw new Error(`Program '${this.name}', from draw '${i}': uniform ${x} not set but required by ${c} being defined`)}}draw(i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re){const K=i.context,ae=K.gl;if(this.failedToCreate)return;K.program.set(this.program),K.setDepthMode(p),K.setStencilMode(x),K.setColorMode(w),K.setCullFace(A);for(const xe of Object.keys(this.fixedUniforms))this.fixedUniforms[xe].set(this.program,xe,I[xe]);Y&&Y.setUniforms(this.program,K,this.binderUniforms,V,{zoom:X});const ue={[ae.POINTS]:1,[ae.LINES]:2,[ae.TRIANGLES]:3,[ae.LINE_STRIP]:1}[c];this.checkUniforms(O,"RENDER_SHADOWS",this.shadowUniforms);const fe=re&&re>0?1:void 0;for(const xe of H.get()){const ge=xe.vaos||(xe.vaos={});if((ge[O]||(ge[O]=new ru)).bind(K,this,z,Y?Y.getPaintVertexBuffers():[],k,xe.vertexOffset,W||[],fe),this.forceManualRenderingForInstanceIDShaders){const Te=re||1;for(let ye=0;ye<Te;++ye)this.instancingUniforms.u_instanceID.set(this.program,"u_instanceID",ye),k?ae.drawElements(c,xe.primitiveLength*ue,ae.UNSIGNED_SHORT,xe.primitiveOffset*ue*2):ae.drawArrays(c,xe.vertexOffset,xe.vertexLength)}else re&&re>1?ae.drawElementsInstanced(c,xe.primitiveLength*ue,ae.UNSIGNED_SHORT,xe.primitiveOffset*ue*2,re):k?ae.drawElements(c,xe.primitiveLength*ue,ae.UNSIGNED_SHORT,xe.primitiveOffset*ue*2):ae.drawArrays(c,xe.vertexOffset,xe.vertexLength);c===ae.TRIANGLES&&k&&this._drawDebugWireframe(i,p,x,w,k,xe,V,X,Y,re)}}}function Hh(g,i,c=0){const p=Math.pow(2,i.tileID.overscaledZ),x=i.tileSize*Math.pow(2,g.transform.tileZoom)/p,w=x*(i.tileID.canonical.x+i.tileID.wrap*p),A=x*i.tileID.canonical.y;return{u_image:0,u_texsize:i.imageAtlasTexture?i.imageAtlasTexture.size:[0,0],u_tile_units_to_pixels:1/n.ay(i,1,g.transform.tileZoom),u_pixel_coord_upper:[w>>16,A>>16],u_pixel_coord_lower:[65535&w,65535&A],u_pattern_transition:c}}const Is={terrain:0,flat:1},Kf=n.bC(),cu=(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K)=>{const ae=i.style.light,ue=ae.properties.get("position"),fe=[ue.x,ue.y,ue.z],xe=n.dL();ae.properties.get("anchor")==="viewport"&&(n.dM(xe,-i.transform.angle),n.dN(fe,fe,xe));const ge=ae.properties.get("color").toPremultipliedRenderColor(null),Te=i.transform,ye={u_matrix:g,u_lightpos:fe,u_lightintensity:ae.properties.get("intensity"),u_lightcolor:[ge.r,ge.g,ge.b],u_vertical_gradient:+c,u_opacity:p,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:Kf,u_merc_center:[0,0],u_up_dir:[0,0,0],u_height_lift:0,u_height_type:Is[z],u_base_type:Is[k],u_ao:x,u_edge_radius:w,u_width_scale:A,u_flood_light_color:Y,u_vertical_scale:W,u_flood_light_intensity:re,u_ground_shadow_factor:K};return Te.projection.name==="globe"&&(ye.u_tile_id=[I.canonical.x,I.canonical.y,1<<I.canonical.z],ye.u_zoom_transition=H,ye.u_inv_rot_matrix=X,ye.u_merc_center=V,ye.u_up_dir=Te.projection.upVector(new n.cC(0,0,0),V[0]*n.al,V[1]*n.al),ye.u_height_lift=O),ye},lp=(g,i,c,p,x,w)=>({u_matrix:g,u_edge_radius:i,u_width_scale:c,u_vertical_scale:p,u_height_type:Is[x],u_base_type:Is[w]}),qh=(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K)=>{const ae=cu(g,i,c,p,x,w,A,I,z,k,H,V,X,Y,W,re,1,[0,0,0]),ue={u_height_factor:-Math.pow(2,I.overscaledZ)/O.tileSize/8};return Object.assign(ae,Hh(i,O,K),ue)},cp=(g,i,c)=>({u_matrix:g,u_emissive_strength:i,u_ground_shadow_factor:c}),Al=(g,i,c,p,x,w=0)=>Object.assign(cp(g,i,x),Hh(c,p,w)),Im=(g,i,c,p)=>({u_matrix:g,u_world:c,u_emissive_strength:i,u_ground_shadow_factor:p}),Mg=(g,i,c,p,x,w,A=0)=>Object.assign(Al(g,i,c,p,w,A),{u_world:x}),up=(g,i)=>({u_matrix:g,u_ground_shadow_factor:i}),Jf=(g,i,c,p,x)=>({u_matrix:g,u_camera_pos:[i[0],i[1],i[2]],u_depth_bias:c,u_height_scale:p,u_reset_depth:x}),ed=(g,i,c,p,x,w,A)=>({u_matrix:g,u_normal_matrix:i,u_opacity:c,u_faux_facade_ao_intensity:p,u_camera_pos:x,u_tile_to_meter:w,u_facade_emissive_chance:A}),Dg=g=>({u_matrix:g}),hp=g=>({u_matrix:g}),El=(g,i,c,p,x,w,A,I)=>{const O=n.al/w.tileSize;return{u_matrix:g,u_inv_rot_matrix:i,u_camera_to_center_distance:c.getCameraToCenterDistance(I),u_extrude_scale:[c.pixelsToGLUnits[0]/O,c.pixelsToGLUnits[1]/O],u_zoom_transition:p,u_tile_id:A,u_merc_center:x}},td=(g,i,c=1)=>({u_matrix:g,u_color:i,u_overlay:0,u_overlay_scale:c}),uu=n.bC(),bc=(g,i,c,p,x,w,A)=>{const I=g.transform,O=I.projection.name==="globe",z=O?n.dO(I.zoom,i.canonical)*I._pixelsPerMercatorPixel:n.ay(c,1,w),k={u_matrix:i.projMatrix,u_extrude_scale:z,u_intensity:A,u_inv_rot_matrix:uu,u_merc_center:[0,0],u_tile_id:[0,0,0],u_zoom_transition:0,u_up_dir:[0,0,0]};if(O){k.u_inv_rot_matrix=p,k.u_merc_center=x,k.u_tile_id=[i.canonical.x,i.canonical.y,1<<i.canonical.z],k.u_zoom_transition=n.aj(I.zoom);const H=x[0]*n.al,V=x[1]*n.al;k.u_up_dir=I.projection.upVector(new n.cC(0,0,0),H,V)}return k};function Cl(g,[i,c,p,x],[w,A]){if(w===A)return[0,0,0,0];const I=255*(g-1)/(g*(A-w));return[i*I,c*I,p*I,x*I]}function ah(g,i,[c,p]){return c===p?0:.5/g+(i-c)*(g-1)/(g*(p-c))}const $h=(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K,ae,ue,fe)=>({u_matrix:g,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:z,u_fade_t:k.mix,u_opacity:k.opacity*H.paint.get("raster-opacity"),u_image0:0,u_image1:1,u_brightness_low:H.paint.get("raster-brightness-min"),u_brightness_high:H.paint.get("raster-brightness-max"),u_saturation_factor:n.dQ(H.paint.get("raster-saturation")),u_contrast_factor:n.dP(H.paint.get("raster-contrast")),u_spin_weights:wc(H.paint.get("raster-hue-rotate")),u_perspective_transform:V,u_raster_elevation:X,u_zoom_transition:A,u_merc_center:I,u_cutoff_params:O,u_colorization_mix:Cl(n.dR,W,K),u_colorization_offset:ah(n.dR,re,K),u_color_ramp:Y,u_texture_offset:[ue/(ae+2*ue),ae/(ae+2*ue)],u_texture_res:[ae+2*ue,ae+2*ue],u_emissive_strength:fe});function wc(g){g*=Math.PI/180;const i=Math.sin(g),c=Math.cos(g);return[(2*c+1)/3,(-Math.sqrt(3)*i-c+1)/3,(Math.sqrt(3)*i-c+1)/3]}const Js=.05,Rs=(g,i,c,p,x,w,A,I,O,z,k,H)=>({u_matrix:g,u_normalize_matrix:i,u_globe_matrix:c,u_merc_matrix:p,u_grid_matrix:x,u_tl_parent:w,u_scale_parent:z,u_fade_t:k.mix,u_opacity:k.opacity,u_image0:0,u_image1:1,u_raster_elevation:H,u_zoom_transition:A,u_merc_center:I,u_cutoff_params:O}),fp=(g,i,c,p,x,w,A,I,O,z)=>({u_particle_texture:g,u_particle_texture_side_len:i,u_tile_offset:c,u_velocity:p,u_color_ramp:w,u_velocity_res:x,u_max_speed:A,u_uv_offset:I,u_data_scale:[255*O[0],255*O[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Js,Js]}),rd=(g,i,c,p,x,w,A,I,O,z)=>({u_particle_texture:g,u_particle_texture_side_len:i,u_velocity:c,u_velocity_res:p,u_max_speed:x,u_speed_factor:w,u_reset_rate:A,u_rand_seed:Math.random(),u_uv_offset:I,u_data_scale:[255*O[0],255*O[1]],u_data_offset:z,u_particle_pos_scale:1.1,u_particle_pos_offset:[Js,Js]}),hu=n.bC(),Xh=(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K,ae,ue,fe,xe,ge,Te)=>{const ye=x.transform,_e={u_is_size_zoom_constant:+(g==="constant"||g==="source"),u_is_size_feature_constant:+(g==="constant"||g==="camera"),u_size_t:i?i.uSizeT:0,u_size:i?i.uSize:0,u_camera_to_center_distance:ye.getCameraToCenterDistance(ae),u_rotate_symbol:+c,u_aspect_ratio:ye.width/ye.height,u_fade_change:x.options.fadeDuration?x.symbolFadeChange:1,u_matrix:w,u_label_plane_matrix:A,u_coord_matrix:I,u_is_text:+z,u_elevation_from_sea:O?1:0,u_pitch_with_map:+p,u_texsize:k,u_texsize_icon:H,u_texture:0,u_texture_icon:1,u_tile_id:[0,0,0],u_zoom_transition:0,u_inv_rot_matrix:hu,u_merc_center:[0,0],u_camera_forward:[0,0,0],u_ecef_origin:[0,0,0],u_tile_matrix:hu,u_up_vector:[0,-1,0],u_color_adj_mat:xe,u_icon_transition:ge||0,u_gamma_scale:p?x.transform.getCameraToCenterDistance(ae)*Math.cos(x.terrain?0:x.transform._pitch):1,u_device_pixel_ratio:n.o.devicePixelRatio,u_is_halo:1,u_scale_factor:Te||1,u_ground_shadow_factor:ue,u_inv_matrix:n.bl(n.bC(),A),u_normal_scale:fe,u_lutTexture:kn.LUT};return ae.name==="globe"&&(_e.u_tile_id=[X.canonical.x,X.canonical.y,1<<X.canonical.z],_e.u_zoom_transition=Y,_e.u_inv_rot_matrix=re,_e.u_merc_center=W,_e.u_camera_forward=ye._camera.forward(),_e.u_ecef_origin=n.dS(ye.globeMatrix,X.toUnwrapped()),_e.u_tile_matrix=Float32Array.from(ye.globeMatrix),_e.u_up_vector=K),_e},id=(g,i,c,p)=>({u_matrix:g,u_emissive_strength:i,u_opacity:c,u_color:p}),Zh=(g,i,c,p,x,w,A,I,O)=>Object.assign((function(z,k,H,V,X,Y){const{width:W,height:re}=V.imageManager.getPixelSize(k),K=Math.pow(2,Y.tileID.overscaledZ),ae=Y.tileSize*Math.pow(2,V.transform.tileZoom)/K,ue=ae*(Y.tileID.canonical.x+Y.tileID.wrap*K),fe=ae*Y.tileID.canonical.y;return{u_image:0,u_pattern_tl:H.tl,u_pattern_br:H.br,u_texsize:[W,re],u_pattern_size:H.displaySize,u_pattern_units_to_pixels:X?[V.transform.width,-1*V.transform.height]:[1/n.ay(Y,1,V.transform.tileZoom),1/n.ay(Y,1,V.transform.tileZoom)],u_pixel_coord_upper:[ue>>16,fe>>16],u_pixel_coord_lower:[65535&ue,65535&fe]}})(0,w,A,p,I,O),{u_matrix:g,u_emissive_strength:i,u_opacity:c}),nd=new Float32Array(n.bA([])),el=(g,i,c,p,x,w,A,I,O,z,k,H,V,X=[0,0,0],Y)=>{const W=x.style.light,re=W.properties.get("position"),K=[-re.x,-re.y,re.z],ae=n.dL();W.properties.get("anchor")==="viewport"&&(n.dM(ae,-x.transform.angle),n.dN(K,K,ae));const ue=k.alphaMode==="MASK",fe=W.properties.get("color").toNonPremultipliedRenderColor(null),xe=V.paint.get("model-ambient-occlusion-intensity"),ge=V.paint.get("model-color").constantOr(n.ao.white).toNonPremultipliedRenderColor(null);return ge.a=V.paint.get("model-color-mix-intensity").constantOr(0),{u_matrix:g,u_lighting_matrix:i,u_normal_matrix:c,u_node_matrix:p||nd,u_lightpos:K,u_lightintensity:W.properties.get("intensity"),u_lightcolor:[fe.r,fe.g,fe.b],u_camera_pos:X,u_opacity:w,u_baseTextureIsAlpha:0,u_alphaMask:+ue,u_alphaCutoff:k.alphaCutoff,u_baseColorFactor:A.toNonPremultipliedRenderColor(null).toArray01(),u_emissiveFactor:I.toNonPremultipliedRenderColor(null).toArray01(),u_metallicFactor:O,u_roughnessFactor:z,u_baseColorTexture:kn.BaseColor,u_metallicRoughnessTexture:kn.MetallicRoughness,u_normalTexture:kn.Normal,u_occlusionTexture:kn.Occlusion,u_emissionTexture:kn.Emission,u_lutTexture:kn.LUT,u_color_mix:ge.toArray01(),u_aoIntensity:xe,u_emissive_strength:H,u_occlusionTextureTransform:Y||[0,0,0,0]}},Di=(g,i=nd,c=nd)=>({u_matrix:g,u_instance:i,u_node_matrix:c}),Pn={fillExtrusion:g=>({u_matrix:new n.ck(g),u_lightpos:new n.ch(g),u_lightintensity:new n.ci(g),u_lightcolor:new n.ch(g),u_vertical_gradient:new n.ci(g),u_opacity:new n.ci(g),u_edge_radius:new n.ci(g),u_width_scale:new n.ci(g),u_ao:new n.cj(g),u_height_type:new n.cg(g),u_base_type:new n.cg(g),u_tile_id:new n.ch(g),u_zoom_transition:new n.ci(g),u_inv_rot_matrix:new n.ck(g),u_merc_center:new n.cj(g),u_up_dir:new n.ch(g),u_height_lift:new n.ci(g),u_flood_light_color:new n.ch(g),u_vertical_scale:new n.ci(g),u_flood_light_intensity:new n.ci(g),u_ground_shadow_factor:new n.ch(g)}),fillExtrusionDepth:g=>({u_matrix:new n.ck(g),u_edge_radius:new n.ci(g),u_width_scale:new n.ci(g),u_vertical_scale:new n.ci(g),u_height_type:new n.cg(g),u_base_type:new n.cg(g)}),fillExtrusionPattern:g=>({u_matrix:new n.ck(g),u_lightpos:new n.ch(g),u_lightintensity:new n.ci(g),u_lightcolor:new n.ch(g),u_vertical_gradient:new n.ci(g),u_height_factor:new n.ci(g),u_edge_radius:new n.ci(g),u_width_scale:new n.ci(g),u_ao:new n.cj(g),u_height_type:new n.cg(g),u_base_type:new n.cg(g),u_tile_id:new n.ch(g),u_zoom_transition:new n.ci(g),u_inv_rot_matrix:new n.ck(g),u_merc_center:new n.cj(g),u_up_dir:new n.ch(g),u_height_lift:new n.ci(g),u_image:new n.cg(g),u_texsize:new n.cj(g),u_pixel_coord_upper:new n.cj(g),u_pixel_coord_lower:new n.cj(g),u_tile_units_to_pixels:new n.ci(g),u_opacity:new n.ci(g),u_pattern_transition:new n.ci(g)}),fillExtrusionGroundEffect:g=>({u_matrix:new n.ck(g),u_opacity:new n.ci(g),u_ao_pass:new n.ci(g),u_meter_to_tile:new n.ci(g),u_ao:new n.cj(g),u_flood_light_intensity:new n.ci(g),u_flood_light_color:new n.ch(g),u_attenuation:new n.ci(g),u_edge_radius:new n.ci(g),u_fb:new n.cg(g),u_fb_size:new n.ci(g),u_dynamic_offset:new n.ci(g)}),fill:g=>({u_matrix:new n.ck(g),u_emissive_strength:new n.ci(g),u_ground_shadow_factor:new n.ch(g)}),fillPattern:g=>({u_matrix:new n.ck(g),u_emissive_strength:new n.ci(g),u_image:new n.cg(g),u_texsize:new n.cj(g),u_pixel_coord_upper:new n.cj(g),u_pixel_coord_lower:new n.cj(g),u_tile_units_to_pixels:new n.ci(g),u_ground_shadow_factor:new n.ch(g),u_pattern_transition:new n.ci(g)}),fillOutline:g=>({u_matrix:new n.ck(g),u_emissive_strength:new n.ci(g),u_world:new n.cj(g),u_ground_shadow_factor:new n.ch(g)}),fillOutlinePattern:g=>({u_matrix:new n.ck(g),u_emissive_strength:new n.ci(g),u_world:new n.cj(g),u_image:new n.cg(g),u_texsize:new n.cj(g),u_pixel_coord_upper:new n.cj(g),u_pixel_coord_lower:new n.cj(g),u_tile_units_to_pixels:new n.ci(g),u_ground_shadow_factor:new n.ch(g),u_pattern_transition:new n.ci(g)}),building:g=>({u_matrix:new n.ck(g),u_normal_matrix:new n.ck(g),u_opacity:new n.ci(g),u_faux_facade_ao_intensity:new n.ci(g),u_camera_pos:new n.ch(g),u_tile_to_meter:new n.ci(g),u_facade_emissive_chance:new n.ci(g)}),buildingBloom:g=>({u_matrix:new n.ck(g)}),buildingDepth:g=>({u_matrix:new n.ck(g)}),elevatedStructuresDepth:g=>({u_matrix:new n.ck(g),u_depth_bias:new n.ci(g)}),elevatedStructures:g=>({u_matrix:new n.ck(g),u_ground_shadow_factor:new n.ch(g)}),elevatedStructuresDepthReconstruct:g=>({u_matrix:new n.ck(g),u_camera_pos:new n.ch(g),u_depth_bias:new n.ci(g),u_height_scale:new n.ci(g),u_reset_depth:new n.ci(g)}),circle:n.dV,collisionBox:g=>({u_matrix:new n.ck(g),u_inv_rot_matrix:new n.ck(g),u_camera_to_center_distance:new n.ci(g),u_extrude_scale:new n.cj(g),u_zoom_transition:new n.ci(g),u_merc_center:new n.cj(g),u_tile_id:new n.ch(g)}),collisionCircle:g=>({u_matrix:new n.ck(g),u_inv_matrix:new n.ck(g),u_camera_to_center_distance:new n.ci(g),u_viewport_size:new n.cj(g)}),debug:g=>({u_color:new n.dx(g),u_matrix:new n.ck(g),u_overlay:new n.cg(g),u_overlay_scale:new n.ci(g)}),clippingMask:g=>({u_matrix:new n.ck(g)}),heatmap:g=>({u_extrude_scale:new n.ci(g),u_intensity:new n.ci(g),u_matrix:new n.ck(g),u_inv_rot_matrix:new n.ck(g),u_merc_center:new n.cj(g),u_tile_id:new n.ch(g),u_zoom_transition:new n.ci(g),u_up_dir:new n.ch(g)}),heatmapTexture:g=>({u_image:new n.cg(g),u_color_ramp:new n.cg(g),u_opacity:new n.ci(g)}),hillshade:g=>({u_matrix:new n.ck(g),u_image:new n.cg(g),u_latrange:new n.cj(g),u_light:new n.cj(g),u_shadow:new n.dx(g),u_highlight:new n.dx(g),u_emissive_strength:new n.ci(g),u_accent:new n.dx(g)}),hillshadePrepare:g=>({u_matrix:new n.ck(g),u_image:new n.cg(g),u_dimension:new n.cj(g),u_zoom:new n.ci(g)}),line:n.dU,linePattern:n.dT,raster:g=>({u_matrix:new n.ck(g),u_normalize_matrix:new n.ck(g),u_globe_matrix:new n.ck(g),u_merc_matrix:new n.ck(g),u_grid_matrix:new n.dy(g),u_tl_parent:new n.cj(g),u_scale_parent:new n.ci(g),u_fade_t:new n.ci(g),u_opacity:new n.ci(g),u_image0:new n.cg(g),u_image1:new n.cg(g),u_brightness_low:new n.ci(g),u_brightness_high:new n.ci(g),u_saturation_factor:new n.ci(g),u_contrast_factor:new n.ci(g),u_spin_weights:new n.ch(g),u_perspective_transform:new n.cj(g),u_raster_elevation:new n.ci(g),u_zoom_transition:new n.ci(g),u_merc_center:new n.cj(g),u_cutoff_params:new n.d2(g),u_colorization_mix:new n.d2(g),u_colorization_offset:new n.ci(g),u_color_ramp:new n.cg(g),u_texture_offset:new n.cj(g),u_texture_res:new n.cj(g),u_emissive_strength:new n.ci(g)}),rasterParticle:g=>({u_matrix:new n.ck(g),u_normalize_matrix:new n.ck(g),u_globe_matrix:new n.ck(g),u_merc_matrix:new n.ck(g),u_grid_matrix:new n.dy(g),u_tl_parent:new n.cj(g),u_scale_parent:new n.ci(g),u_fade_t:new n.ci(g),u_opacity:new n.ci(g),u_image0:new n.cg(g),u_image1:new n.cg(g),u_raster_elevation:new n.ci(g),u_zoom_transition:new n.ci(g),u_merc_center:new n.cj(g),u_cutoff_params:new n.d2(g)}),rasterParticleTexture:g=>({u_texture:new n.cg(g),u_opacity:new n.ci(g)}),rasterParticleDraw:g=>({u_particle_texture:new n.cg(g),u_particle_texture_side_len:new n.ci(g),u_tile_offset:new n.cj(g),u_velocity:new n.cg(g),u_color_ramp:new n.cg(g),u_velocity_res:new n.cj(g),u_max_speed:new n.ci(g),u_uv_offset:new n.cj(g),u_data_scale:new n.cj(g),u_data_offset:new n.ci(g),u_particle_pos_scale:new n.ci(g),u_particle_pos_offset:new n.cj(g)}),rasterParticleUpdate:g=>({u_particle_texture:new n.cg(g),u_particle_texture_side_len:new n.ci(g),u_velocity:new n.cg(g),u_velocity_res:new n.cj(g),u_max_speed:new n.ci(g),u_speed_factor:new n.ci(g),u_reset_rate:new n.ci(g),u_rand_seed:new n.ci(g),u_uv_offset:new n.cj(g),u_data_scale:new n.cj(g),u_data_offset:new n.ci(g),u_particle_pos_scale:new n.ci(g),u_particle_pos_offset:new n.cj(g)}),symbol:g=>({u_is_size_zoom_constant:new n.cg(g),u_is_size_feature_constant:new n.cg(g),u_size_t:new n.ci(g),u_size:new n.ci(g),u_camera_to_center_distance:new n.ci(g),u_rotate_symbol:new n.cg(g),u_aspect_ratio:new n.ci(g),u_fade_change:new n.ci(g),u_matrix:new n.ck(g),u_label_plane_matrix:new n.ck(g),u_coord_matrix:new n.ck(g),u_is_text:new n.cg(g),u_elevation_from_sea:new n.cg(g),u_pitch_with_map:new n.cg(g),u_texsize:new n.cj(g),u_texsize_icon:new n.cj(g),u_texture:new n.cg(g),u_texture_icon:new n.cg(g),u_gamma_scale:new n.ci(g),u_device_pixel_ratio:new n.ci(g),u_tile_id:new n.ch(g),u_zoom_transition:new n.ci(g),u_inv_rot_matrix:new n.ck(g),u_merc_center:new n.cj(g),u_camera_forward:new n.ch(g),u_tile_matrix:new n.ck(g),u_up_vector:new n.ch(g),u_ecef_origin:new n.ch(g),u_is_halo:new n.cg(g),u_icon_transition:new n.ci(g),u_color_adj_mat:new n.ck(g),u_scale_factor:new n.ci(g),u_ground_shadow_factor:new n.ch(g),u_inv_matrix:new n.ck(g),u_normal_scale:new n.ci(g),u_lutTexture:new n.cg(g)}),background:g=>({u_matrix:new n.ck(g),u_emissive_strength:new n.ci(g),u_opacity:new n.ci(g),u_color:new n.dx(g)}),backgroundPattern:g=>({u_matrix:new n.ck(g),u_emissive_strength:new n.ci(g),u_opacity:new n.ci(g),u_image:new n.cg(g),u_pattern_tl:new n.cj(g),u_pattern_br:new n.cj(g),u_texsize:new n.cj(g),u_pattern_size:new n.cj(g),u_pixel_coord_upper:new n.cj(g),u_pixel_coord_lower:new n.cj(g),u_pattern_units_to_pixels:new n.cj(g)}),terrainRaster:g=>({u_matrix:new n.ck(g),u_image0:new n.cg(g),u_skirt_height:new n.ci(g),u_ground_shadow_factor:new n.ch(g)}),skybox:g=>({u_matrix:new n.ck(g),u_sun_direction:new n.ch(g),u_cubemap:new n.cg(g),u_opacity:new n.ci(g),u_temporal_offset:new n.ci(g)}),skyboxGradient:g=>({u_matrix:new n.ck(g),u_color_ramp:new n.cg(g),u_center_direction:new n.ch(g),u_radius:new n.ci(g),u_opacity:new n.ci(g),u_temporal_offset:new n.ci(g)}),skyboxCapture:g=>({u_matrix_3f:new n.dy(g),u_sun_direction:new n.ch(g),u_sun_intensity:new n.ci(g),u_color_tint_r:new n.d2(g),u_color_tint_m:new n.d2(g),u_luminance:new n.ci(g)}),globeRaster:g=>({u_proj_matrix:new n.ck(g),u_globe_matrix:new n.ck(g),u_normalize_matrix:new n.ck(g),u_merc_matrix:new n.ck(g),u_zoom_transition:new n.ci(g),u_merc_center:new n.cj(g),u_image0:new n.cg(g),u_grid_matrix:new n.dy(g),u_skirt_height:new n.ci(g),u_far_z_cutoff:new n.ci(g),u_frustum_tl:new n.ch(g),u_frustum_tr:new n.ch(g),u_frustum_br:new n.ch(g),u_frustum_bl:new n.ch(g),u_globe_pos:new n.ch(g),u_globe_radius:new n.ci(g),u_viewport:new n.cj(g)}),globeAtmosphere:g=>({u_frustum_tl:new n.ch(g),u_frustum_tr:new n.ch(g),u_frustum_br:new n.ch(g),u_frustum_bl:new n.ch(g),u_horizon:new n.ci(g),u_transition:new n.ci(g),u_fadeout_range:new n.ci(g),u_atmosphere_fog_color:new n.d2(g),u_high_color:new n.d2(g),u_space_color:new n.d2(g),u_temporal_offset:new n.ci(g),u_horizon_angle:new n.ci(g)}),model:g=>({u_matrix:new n.ck(g),u_lighting_matrix:new n.ck(g),u_normal_matrix:new n.ck(g),u_node_matrix:new n.ck(g),u_lightpos:new n.ch(g),u_lightintensity:new n.ci(g),u_lightcolor:new n.ch(g),u_camera_pos:new n.ch(g),u_opacity:new n.ci(g),u_baseColorFactor:new n.d2(g),u_emissiveFactor:new n.d2(g),u_metallicFactor:new n.ci(g),u_roughnessFactor:new n.ci(g),u_baseTextureIsAlpha:new n.cg(g),u_alphaMask:new n.cg(g),u_alphaCutoff:new n.ci(g),u_baseColorTexture:new n.cg(g),u_metallicRoughnessTexture:new n.cg(g),u_normalTexture:new n.cg(g),u_occlusionTexture:new n.cg(g),u_emissionTexture:new n.cg(g),u_lutTexture:new n.cg(g),u_color_mix:new n.d2(g),u_aoIntensity:new n.ci(g),u_emissive_strength:new n.ci(g),u_occlusionTextureTransform:new n.d2(g)}),modelDepth:g=>({u_matrix:new n.ck(g),u_instance:new n.ck(g),u_node_matrix:new n.ck(g)}),groundShadow:g=>({u_matrix:new n.ck(g),u_ground_shadow_factor:new n.ch(g)}),stars:g=>({u_matrix:new n.ck(g),u_up:new n.ch(g),u_right:new n.ch(g),u_intensity_multiplier:new n.ci(g)}),snowParticle:g=>({u_modelview:new n.ck(g),u_projection:new n.ck(g),u_time:new n.ci(g),u_cam_pos:new n.ch(g),u_velocityConeAperture:new n.ci(g),u_velocity:new n.ci(g),u_horizontalOscillationRadius:new n.ci(g),u_horizontalOscillationRate:new n.ci(g),u_boxSize:new n.ci(g),u_billboardSize:new n.ci(g),u_simpleShapeParameters:new n.cj(g),u_screenSize:new n.cj(g),u_thinningCenterPos:new n.cj(g),u_thinningShape:new n.ch(g),u_thinningAffectedRatio:new n.ci(g),u_thinningParticleOffset:new n.ci(g),u_particleColor:new n.d2(g),u_direction:new n.ch(g)}),rainParticle:g=>({u_modelview:new n.ck(g),u_projection:new n.ck(g),u_time:new n.ci(g),u_cam_pos:new n.ch(g),u_texScreen:new n.cg(g),u_velocityConeAperture:new n.ci(g),u_velocity:new n.ci(g),u_boxSize:new n.ci(g),u_rainDropletSize:new n.cj(g),u_distortionStrength:new n.ci(g),u_rainDirection:new n.ch(g),u_color:new n.d2(g),u_screenSize:new n.cj(g),u_thinningCenterPos:new n.cj(g),u_thinningShape:new n.ch(g),u_thinningAffectedRatio:new n.ci(g),u_thinningParticleOffset:new n.ci(g),u_shapeDirectionalPower:new n.ci(g),u_shapeNormalPower:new n.ci(g),u_mode:new n.ci(g)}),vignette:g=>({u_vignetteShape:new n.ch(g),u_vignetteColor:new n.d2(g)}),occlusion:g=>({u_matrix:new n.ck(g),u_anchorPos:new n.ch(g),u_screenSizePx:new n.cj(g),u_occluderSizePx:new n.cj(g),u_color:new n.d2(g)})};class Vn{constructor(i,c,p,x){this.id=Vn.uniqueIdxCounter,Vn.uniqueIdxCounter++,this.context=i;const w=i.gl;this.buffer=w.createBuffer(),this.dynamicDraw=!!p,this.context.unbindVAO(),i.bindElementBuffer.set(this.buffer),w.bufferData(w.ELEMENT_ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?w.DYNAMIC_DRAW:w.STATIC_DRAW),this.dynamicDraw||x||c.destroy()}bind(){this.context.bindElementBuffer.set(this.buffer)}updateData(i){this.id=Vn.uniqueIdxCounter,Vn.uniqueIdxCounter++;const c=this.context.gl;this.context.unbindVAO(),this.bind(),c.bufferSubData(c.ELEMENT_ARRAY_BUFFER,0,i.arrayBuffer)}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}Vn.uniqueIdxCounter=0;const od={Int8:"BYTE",Uint8:"UNSIGNED_BYTE",Int16:"SHORT",Uint16:"UNSIGNED_SHORT",Int32:"INT",Uint32:"UNSIGNED_INT",Float32:"FLOAT"};class Wh{constructor(i,c,p,x,w,A){this.length=c.length,this.attributes=p,this.itemSize=c.bytesPerElement,this.dynamicDraw=x,this.instanceCount=A,this.context=i;const I=i.gl;this.buffer=I.createBuffer(),i.bindVertexBuffer.set(this.buffer),I.bufferData(I.ARRAY_BUFFER,c.arrayBuffer,this.dynamicDraw?I.DYNAMIC_DRAW:I.STATIC_DRAW),this.dynamicDraw||w||c.destroy()}bind(){this.context.bindVertexBuffer.set(this.buffer)}updateData(i){const c=this.context.gl;this.bind(),c.bufferSubData(c.ARRAY_BUFFER,0,i.arrayBuffer)}enableAttributes(i,c){for(let p=0;p<this.attributes.length;p++){const x=c.getAttributeLocation(i,this.attributes[p].name);x!==-1&&i.enableVertexAttribArray(x)}}setVertexAttribPointers(i,c,p){for(let x=0;x<this.attributes.length;x++){const w=this.attributes[x],A=c.getAttributeLocation(i,w.name);A!==-1&&i.vertexAttribPointer(A,w.components,i[od[w.type]],!1,this.itemSize,w.offset+this.itemSize*(p||0))}}setVertexAttribDivisor(i,c,p){for(let x=0;x<this.attributes.length;x++){const w=c.getAttributeLocation(i,this.attributes[x].name);w!==-1&&this.instanceCount&&this.instanceCount>0&&i.vertexAttribDivisor(w,p)}}destroy(){this.buffer&&(this.context.gl.deleteBuffer(this.buffer),delete this.buffer)}}class Il{constructor(i,c,p,x,w){this.context=i,this.width=c,this.height=p;const A=this.framebuffer=i.gl.createFramebuffer();x&&(this.colorAttachment=new ip(i,A)),w&&(this.depthAttachmentType=w,this.depthAttachment=w==="renderbuffer"?new np(i,A):new Qf(i,A))}destroy(){const i=this.context.gl;if(this.colorAttachment){const c=this.colorAttachment.get();c&&i.deleteTexture(c)}if(this.depthAttachment&&this.depthAttachmentType)if(this.depthAttachmentType==="renderbuffer"){const c=this.depthAttachment.get();c&&i.deleteRenderbuffer(c)}else{const c=this.depthAttachment.get();c&&i.deleteTexture(c)}i.deleteFramebuffer(this.framebuffer)}}class Yh{constructor(i,c){this.gl=i,this.clearColor=new Qd(this),this.clearDepth=new iu(this),this.clearStencil=new Vh(this),this.colorMask=new Kd(this),this.depthMask=new Jd(this),this.stencilMask=new Es(this),this.stencilFunc=new as(this),this.stencilOp=new rh(this),this.stencilTest=new Cs(this),this.depthRange=new pc(this),this.depthTest=new nu(this),this.depthFunc=new ep(this),this.blend=new Uh(this),this.blendFunc=new Yf(this),this.blendColor=new bo(this),this.blendEquation=new Nn(this),this.cullFace=new un(this),this.cullFaceSide=new wl(this),this.frontFace=new Ta(this),this.program=new tp(this),this.activeTexture=new mc(this),this.viewport=new Tm(this),this.bindFramebuffer=new ih(this),this.bindRenderbuffer=new ou(this),this.bindTexture=new au(this),this.bindVertexBuffer=new rp(this),this.bindElementBuffer=new su(this),this.bindVertexArrayOES=new nh(this),this.pixelStoreUnpack=new lu(this),this.pixelStoreUnpackPremultiplyAlpha=new Sl(this),this.pixelStoreUnpackFlipY=new gc(this),this.options=c?Object.assign({},c):{},this.options.extTextureFilterAnisotropicForceOff||(this.extTextureFilterAnisotropic=i.getExtension("EXT_texture_filter_anisotropic")||i.getExtension("MOZ_EXT_texture_filter_anisotropic")||i.getExtension("WEBKIT_EXT_texture_filter_anisotropic"),this.extTextureFilterAnisotropic&&(this.extTextureFilterAnisotropicMax=i.getParameter(this.extTextureFilterAnisotropic.MAX_TEXTURE_MAX_ANISOTROPY_EXT))),this.extDebugRendererInfo=i.getExtension("WEBGL_debug_renderer_info"),this.extDebugRendererInfo&&(this.renderer=i.getParameter(this.extDebugRendererInfo.UNMASKED_RENDERER_WEBGL),this.vendor=i.getParameter(this.extDebugRendererInfo.UNMASKED_VENDOR_WEBGL)),this.forceManualRenderingForInstanceIDShaders=c&&!!c.forceManualRenderingForInstanceIDShaders||this.renderer&&this.renderer.indexOf("PowerVR")!==-1,this.options.extTextureFloatLinearForceOff||(this.extTextureFloatLinear=i.getExtension("OES_texture_float_linear")),this.extRenderToTextureHalfFloat=i.getExtension("EXT_color_buffer_half_float"),this.extTimerQuery=i.getExtension("EXT_disjoint_timer_query_webgl2"),this.maxTextureSize=i.getParameter(i.MAX_TEXTURE_SIZE),this.maxPointSize=i.getParameter(i.ALIASED_POINT_SIZE_RANGE)[1]}setDefault(){this.unbindVAO(),this.clearColor.setDefault(),this.clearDepth.setDefault(),this.clearStencil.setDefault(),this.colorMask.setDefault(),this.depthMask.setDefault(),this.stencilMask.setDefault(),this.stencilFunc.setDefault(),this.stencilOp.setDefault(),this.stencilTest.setDefault(),this.depthRange.setDefault(),this.depthTest.setDefault(),this.depthFunc.setDefault(),this.blend.setDefault(),this.blendFunc.setDefault(),this.blendColor.setDefault(),this.blendEquation.setDefault(),this.cullFace.setDefault(),this.cullFaceSide.setDefault(),this.frontFace.setDefault(),this.program.setDefault(),this.activeTexture.setDefault(),this.bindFramebuffer.setDefault(),this.pixelStoreUnpack.setDefault(),this.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.pixelStoreUnpackFlipY.setDefault()}setDirty(){this.clearColor.dirty=!0,this.clearDepth.dirty=!0,this.clearStencil.dirty=!0,this.colorMask.dirty=!0,this.depthMask.dirty=!0,this.stencilMask.dirty=!0,this.stencilFunc.dirty=!0,this.stencilOp.dirty=!0,this.stencilTest.dirty=!0,this.depthRange.dirty=!0,this.depthTest.dirty=!0,this.depthFunc.dirty=!0,this.blend.dirty=!0,this.blendFunc.dirty=!0,this.blendColor.dirty=!0,this.blendEquation.dirty=!0,this.cullFace.dirty=!0,this.cullFaceSide.dirty=!0,this.frontFace.dirty=!0,this.program.dirty=!0,this.activeTexture.dirty=!0,this.viewport.dirty=!0,this.bindFramebuffer.dirty=!0,this.bindRenderbuffer.dirty=!0,this.bindTexture.dirty=!0,this.bindVertexBuffer.dirty=!0,this.bindElementBuffer.dirty=!0,this.bindVertexArrayOES.dirty=!0,this.pixelStoreUnpack.dirty=!0,this.pixelStoreUnpackPremultiplyAlpha.dirty=!0,this.pixelStoreUnpackFlipY.dirty=!0}createIndexBuffer(i,c,p){return new Vn(this,i,c,p)}createVertexBuffer(i,c,p,x,w){return new Wh(this,i,c,p,x,w)}createRenderbuffer(i,c,p){const x=this.gl,w=x.createRenderbuffer();return this.bindRenderbuffer.set(w),x.renderbufferStorage(x.RENDERBUFFER,i,c,p),this.bindRenderbuffer.set(null),w}createFramebuffer(i,c,p,x){return new Il(this,i,c,p,x)}clear({color:i,depth:c,stencil:p,colorMask:x}){const w=this.gl;let A=0;i&&(A|=w.COLOR_BUFFER_BIT,this.clearColor.set(i.toNonPremultipliedRenderColor(null)),this.colorMask.set(x||[!0,!0,!0,!0])),c!==void 0&&(A|=w.DEPTH_BUFFER_BIT,this.depthRange.set([0,1]),this.clearDepth.set(c),this.depthMask.set(!0)),p!==void 0&&(A|=w.STENCIL_BUFFER_BIT,this.clearStencil.set(p),this.stencilMask.set(255)),w.clear(A)}setCullFace(i){i.enable===!1?this.cullFace.set(!1):(this.cullFace.set(!0),this.cullFaceSide.set(i.mode),this.frontFace.set(i.frontFace))}setDepthMode(i){i.func!==this.gl.ALWAYS||i.mask?(this.depthTest.set(!0),this.depthFunc.set(i.func),this.depthMask.set(i.mask),this.depthRange.set(i.range)):this.depthTest.set(!1)}setStencilMode(i){i.test.func!==this.gl.ALWAYS||i.mask?(this.stencilTest.set(!0),this.stencilMask.set(i.mask),this.stencilOp.set([i.fail,i.depthFail,i.pass]),this.stencilFunc.set({func:i.test.func,ref:i.ref,mask:i.test.mask})):this.stencilTest.set(!1)}setColorMode(i){n.by(i.blendFunction,kr.Replace)?this.blend.set(!1):(this.blend.set(!0),this.blendFunc.set(i.blendFunction),this.blendColor.set(i.blendColor),i.blendEquation?this.blendEquation.set(i.blendEquation):this.blendEquation.setDefault()),this.colorMask.set(i.mask)}unbindVAO(){this.bindVertexArrayOES.set(null)}}let qa;function Rl(g,i,c,p,x,w,A){const I=g.context,O=I.gl,z=g.transform,k=[n.aF(z.center.lng),n.aJ(z.center.lat)],H=c.layout.get("symbol-placement"),V=c.layout.get("text-variable-anchor"),X=c.layout.get("icon-rotation-alignment")==="map",Y=c.layout.get("text-rotation-alignment")==="map",W=H!=="point",re=[];let K=0,ae=0;for(let _e=0;_e<p.length;_e++){const Se=p[_e],He=i.getTile(Se),ze=He.getBucket(c);if(!ze)continue;const nt=ze.getProjection().createInversionMatrix(z,Se.canonical),Ge=[],tt=xa(Se,ze,z),It=!A&&X&&W,qe=A&&Y&&W,Oe=V&&ze.hasTextData(),ot=ze.hasIconTextFit()&&Oe&&ze.hasIconData(),je=It||qe||A&&Oe||ot,at=ze.projection.name==="globe",ht=at?n.aj(z.zoom):0;at&&(Ge.push("PROJECTION_GLOBE_VIEW"),je&&Ge.push("PROJECTED_POS_ON_VIEWPORT"));const wt=g.getOrCreateProgram("collisionBox",{defines:Ge});let ft=tt;x[0]===0&&x[1]===0||(ft=g.translatePosMatrix(tt,He,x,w));const pt=A?ze.textCollisionBox:ze.iconCollisionBox,rr=ze.collisionCircleArray;if(rr.length>0){const or=n.bC(),Qt=ft;n.cO(or,ze.placementInvProjMatrix,z.glCoordMatrix),n.cO(or,or,ze.placementViewportMatrix),re.push({circleArray:rr,circleOffset:ae,transform:Qt,invTransform:or,projection:ze.getProjection()}),K+=rr.length/4,ae=K}if(!pt)continue;g.terrain&&g.terrain.setupElevationDraw(He,wt);const tr=at?[Se.canonical.x,Se.canonical.y,1<<Se.canonical.z]:[0,0,0];wt.draw(g,O.LINES,qt.disabled,vr.disabled,g.colorModeForRenderPass(),Tr.disabled,El(ft,nt,z,ht,k,He,tr,ze.getProjection()),c.id,pt.layoutVertexBuffer,pt.indexBuffer,pt.segments,null,z.zoom,null,[pt.collisionVertexBuffer,pt.collisionVertexBufferExt])}if(!A||!re.length)return;const ue=g.getOrCreateProgram("collisionCircle"),fe=new n.dW;fe.resize(4*K),fe._trim();let xe=0;for(const _e of re)for(let Se=0;Se<_e.circleArray.length/4;Se++){const He=4*Se,ze=_e.circleArray[He+0],nt=_e.circleArray[He+1],Ge=_e.circleArray[He+2],tt=_e.circleArray[He+3];fe.emplace(xe++,ze,nt,Ge,tt,0),fe.emplace(xe++,ze,nt,Ge,tt,1),fe.emplace(xe++,ze,nt,Ge,tt,2),fe.emplace(xe++,ze,nt,Ge,tt,3)}(!qa||qa.length<2*K)&&(qa=(function(_e){const Se=2*_e,He=new n.b1;He.resize(Se),He._trim();for(let ze=0;ze<Se;ze++){const nt=6*ze;He.uint16[nt+0]=4*ze+0,He.uint16[nt+1]=4*ze+1,He.uint16[nt+2]=4*ze+2,He.uint16[nt+3]=4*ze+2,He.uint16[nt+4]=4*ze+3,He.uint16[nt+5]=4*ze+0}return He})(K));const ge=I.createIndexBuffer(qa,!0),Te=I.createVertexBuffer(fe,n.dX.members,!0);for(const _e of re){const Se={u_matrix:_e.transform,u_inv_matrix:_e.invTransform,u_camera_to_center_distance:(ye=z).getCameraToCenterDistance(_e.projection),u_viewport_size:[ye.width,ye.height]};ue.draw(g,O.TRIANGLES,qt.disabled,vr.disabled,g.colorModeForRenderPass(),Tr.disabled,Se,c.id,Te,ge,n.bg.simpleSegment(0,2*_e.circleOffset,_e.circleArray.length,_e.circleArray.length/2),null,z.zoom)}var ye;Te.destroy(),ge.destroy()}const fu=n.bC();function ao(g){const i=g._camera.getWorldToCamera(g.worldSize,1),c=n.aB([],i,g.globeMatrix);n.bl(c,c);const p=[0,0,0],x=[0,1,0,0];return n.aC(x,x,c),p[0]=x[0],p[1]=x[1],p[2]=x[2],n.aw(p,p),p}function Qh({width:g,height:i,anchor:c,textOffset:p,textScale:x},w){const{horizontalAlign:A,verticalAlign:I}=n.c0(c),O=-(A-.5)*g,z=-(I-.5)*i,k=n.c1(c,p);return new n.P((O/x+k[0])*w,(z/x+k[1])*w)}function Kh(g,i,c,p,x,w,A,I,O,z){const k=g.text.placedSymbolArray,H=g.text.dynamicLayoutVertexArray,V=g.icon.dynamicLayoutVertexArray,X={},Y=g.getProjection(),W=es(A,Y,x),re=x.elevation,K=Y.upVectorScale(A.canonical,x.center.lat,x.worldSize).metersToTile;H.clear();for(let ae=0;ae<k.length;ae++){const ue=k.get(ae),{tileAnchorX:fe,tileAnchorY:xe,numGlyphs:ge}=ue,Te=ue.hidden||!ue.crossTileID||g.allowVerticalPlacement&&!ue.placedOrientation?null:p[ue.crossTileID];if(Te){let ye=0,_e=0,Se=0;if(re){const ot=re?re.getAtTileOffset(A,fe,xe):0,[je,at,ht]=Y.upVector(A.canonical,fe,xe);ye=ot*je*K,_e=ot*at*K,Se=ot*ht*K}let[He,ze,nt,Ge]=Ga(ue.projectedAnchorX+ye,ue.projectedAnchorY+_e,ue.projectedAnchorZ+Se,c?W:w);const tt=Hu(x.getCameraToCenterDistance(Y),Ge);let It=n.bM(g.textSizeData,O,ue)*tt/n.bX;c&&(It*=g.tilePixelRatio/I);const qe=Qh(Te,It);c?({x:He,y:ze,z:nt}=Y.projectTilePoint(fe+qe.x,xe+qe.y,A.canonical),[He,ze,nt]=Ga(He+ye,ze+_e,nt+Se,w)):(i&&qe._rotate(-x.angle),He+=qe.x,ze+=qe.y,nt=0);const Oe=g.allowVerticalPlacement&&ue.placedOrientation===n.bL.vertical?Math.PI/2:0;for(let ot=0;ot<ge;ot++)n.bO(H,He,ze,nt,Oe);z&&ue.associatedIconIndex>=0&&(X[ue.associatedIconIndex]={x:He,y:ze,z:nt,angle:Oe})}else xr(ge,H)}if(z){V.clear();const ae=g.icon.placedSymbolArray;for(let ue=0;ue<ae.length;ue++){const fe=ae.get(ue),{numGlyphs:xe}=fe,ge=X[ue];if(fe.hidden||!ge)xr(xe,V);else{const{x:Te,y:ye,z:_e,angle:Se}=ge;for(let He=0;He<xe;He++)n.bO(V,Te,ye,_e,Se)}}g.icon.dynamicLayoutVertexBuffer.updateData(V)}g.text.dynamicLayoutVertexBuffer.updateData(H)}function Jh(g,i,c,p,x,w,A={}){const I=c.paint.get("icon-translate"),O=c.paint.get("text-translate"),z=c.paint.get("icon-translate-anchor"),k=c.paint.get("text-translate-anchor"),H=c.layout.get("icon-rotation-alignment"),V=c.layout.get("text-rotation-alignment"),X=c.layout.get("icon-pitch-alignment"),Y=c.layout.get("text-pitch-alignment"),W=c.layout.get("icon-keep-upright"),re=c.layout.get("text-keep-upright"),K=c.paint.get("icon-color-saturation"),ae=c.paint.get("icon-color-contrast"),ue=c.paint.get("icon-color-brightness-min"),fe=c.paint.get("icon-color-brightness-max"),xe=c.layout.get("symbol-elevation-reference")==="sea",ge=c.layout.get("icon-image-use-theme")==="none",Te=g.context,ye=Te.gl,_e=g.transform,Se=H==="map",He=V==="map",ze=X==="map",nt=Y==="map",Ge=c.layout.get("symbol-sort-key").constantOr(1)!==void 0;let tt=!1;const It=g.depthModeForSublayer(0,qt.ReadOnly),qe=new qt(g.context.gl.LEQUAL,qt.ReadOnly,g.depthRangeFor3D),Oe=[n.aF(_e.center.lng),n.aJ(_e.center.lat)],ot=c.layout.get("text-variable-anchor"),je=_e.projection.name==="globe",at=[],ht=[0,-1,0];for(const wt of p){const ft=i.getTile(wt),pt=ft.getBucket(c);if(!pt||pt.projection.name==="mercator"&&je||pt.fullyClipped)continue;const rr=pt.projection.name==="globe",tr=rr?n.aj(_e.zoom):0,or=es(wt,pt.getProjection(),_e),Qt=_e.calculatePixelsToTileUnitsMatrix(ft),fr=ot&&pt.hasTextData(),Mr=pt.hasIconTextFit()&&fr&&pt.hasIconData(),Or=pt.getProjection().createInversionMatrix(_e,wt.canonical),Si=(1<<ft.tileID.canonical.z)*n.al/g.transform.worldSize,wr=Ui=>{let Pr=[0,0,0];if(Ui){const br=g.style.directionalLight,Ti=g.style.ambientLight;br&&Ti&&(Pr=Ts(g.style,br,Ti))}return Pr},ii=Ui=>{_e.depthOcclusionForSymbolsAndCircles&&(c.hasOcclusionOpacityProperties||g.terrain)&&(Ui.push("DEPTH_D24"),Ui.push("DEPTH_OCCLUSION"))},hi=Ui=>{c.lut&&!ge&&(c.lut.texture||(c.lut.texture=new n.dY(g.context,c.lut.image,[c.lut.image.height,c.lut.image.height,c.lut.image.height],Te.gl.RGBA8)),Te.activeTexture.set(Te.gl.TEXTURE0+kn.LUT),c.lut.texture&&c.lut.texture.bind(Te.gl.LINEAR,Te.gl.CLAMP_TO_EDGE),Ui.push("APPLY_LUT_ON_GPU"))},_i=()=>{const Ui=Se&&c.layout.get("symbol-placement")!=="point",Pr=[];ii(Pr),hi(Pr);const br=Ui||Mr,Ti=pt.elevationType==="road",vn=g.shadowRenderer,Xi=Ti&&ze&&!!vn&&vn.enabled,Bn=wr(Xi),xn=Ti&&ze&&!g.terrain?qe:It,$a=c.paint.get("icon-image-cross-fade");g.terrainRenderModeElevated()&&ze&&Pr.push("PITCH_WITH_MAP_TERRAIN"),rr&&(Pr.push("PROJECTION_GLOBE_VIEW"),br&&Pr.push("PROJECTED_POS_ON_VIEWPORT")),$a>0&&pt.hasAnySecondaryIcon&&Pr.push("ICON_TRANSITION"),!pt.icon.zOffsetVertexBuffer||Ti&&g.terrain||Pr.push("Z_OFFSET"),K===0&&ae===0&&ue===0&&fe===1||Pr.push("COLOR_ADJUSTMENT"),pt.sdfIcons&&Pr.push("RENDER_SDF"),Xi&&Pr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ti&&ze&&!g.terrain&&pt.icon.orientationVertexBuffer&&Pr.push("ELEVATED_ROADS");const Wn=pt.icon.programConfigurations.get(c.id),Ia=g.getOrCreateProgram("symbol",{config:Wn,defines:Pr}),Ra=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],da=pt.iconSizeData,zo=n.bK(da,_e.zoom),Xa=ze||!_e.isOrthographic,bn=ts(or,ft.tileID.canonical,ze,Se,_e,pt.getProjection(),Qt),fn=Gu(or,ft.tileID.canonical,ze,Se,_e,pt.getProjection(),Qt),rn=g.translatePosMatrix(fn,ft,I,z,!0),Yn=g.translatePosMatrix(or,ft,I,z),lo=br?fu:bn,Rn=Se&&!ze&&!Ui;let Ao=ht;!je&&!_e.mercatorFromTransition||Se||(Ao=ao(_e));const Fl=rr?Ao:ht,Oc=c.getColorAdjustmentMatrix(K,ae,ue,fe),al=Xh(da.kind,zo,Rn,ze,g,Yn,lo,rn,xe,!1,Ra,[0,0],0,wt,tr,Oe,Or,Fl,pt.getProjection(),Bn,Si,Oc,$a,null),Pc=ft.imageAtlasTexture?ft.imageAtlasTexture:null,Lc=c.layout.get("icon-size").constantOr(0)!==1||pt.iconsNeedLinear,Ma=pt.sdfIcons||g.options.rotating||g.options.zooming||Lc||Xa?ye.LINEAR:ye.NEAREST,Bc=pt.sdfIcons&&c.paint.get("icon-halo-width").constantOr(1)!==0,kl=g.terrain&&ze&&Ui?n.bl(n.bC(),bn):fu;if(Ui&&pt.icon){const sl=_e.elevation,Nl=sl?sl.getAtTileOffsetFunc(wt,_e.center.lat,_e.worldSize,pt.getProjection()):null,Sd=ic(or,ft.tileID.canonical,ze,Se,_e,pt.getProjection(),Qt);mm(pt,or,g,!1,Sd,fn,ze,W,Nl,wt)}return{program:Ia,buffers:pt.icon,uniformValues:al,atlasTexture:Pc,atlasTextureIcon:null,atlasInterpolation:Ma,atlasInterpolationIcon:null,isSDF:pt.sdfIcons,hasHalo:Bc,depthMode:xn,tile:ft,renderWithShadows:Xi,labelPlaneMatrixInv:kl}},Lr=()=>{const Ui=He&&c.layout.get("symbol-placement")!=="point",Pr=[],br=Ui||ot||Mr,Ti=pt.elevationType==="road",vn=g.shadowRenderer,Xi=Ti&&nt&&!!vn&&vn.enabled,Bn=wr(Xi),xn=Ti&&nt&&!g.terrain?qe:It;g.terrainRenderModeElevated()&&nt&&Pr.push("PITCH_WITH_MAP_TERRAIN"),rr&&(Pr.push("PROJECTION_GLOBE_VIEW"),br&&Pr.push("PROJECTED_POS_ON_VIEWPORT")),!pt.text.zOffsetVertexBuffer||Ti&&g.terrain||Pr.push("Z_OFFSET"),pt.iconsInText&&Pr.push("RENDER_TEXT_AND_SYMBOL"),Pr.push("RENDER_SDF"),Xi&&Pr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),Ti&&nt&&!g.terrain&&pt.text.orientationVertexBuffer&&Pr.push("ELEVATED_ROADS"),ii(Pr);const $a=pt.text.programConfigurations.get(c.id),Wn=g.getOrCreateProgram("symbol",{config:$a,defines:Pr});let Ia,Ra=[0,0],da=null;const zo=pt.textSizeData;pt.iconsInText&&(Ra=ft.imageAtlasTexture?ft.imageAtlasTexture.size:[0,0],da=ft.imageAtlasTexture?ft.imageAtlasTexture:null,Ia=nt||!_e.isOrthographic||g.options.rotating||g.options.zooming||zo.kind==="composite"||zo.kind==="camera"?ye.LINEAR:ye.NEAREST);const Xa=ft.glyphAtlasTexture?ft.glyphAtlasTexture.size:[0,0],bn=c.layout.get("text-size-scale-range"),fn=n.aA(g.scaleFactor,bn[0],bn[1]),rn=n.bK(zo,_e.zoom,fn),Yn=ts(or,ft.tileID.canonical,nt,He,_e,pt.getProjection(),Qt),lo=Gu(or,ft.tileID.canonical,nt,He,_e,pt.getProjection(),Qt),Rn=g.translatePosMatrix(lo,ft,O,k,!0),Ao=g.translatePosMatrix(or,ft,O,k),Fl=br?fu:Yn,Oc=He&&!nt&&!Ui;let al=ht;!je&&!_e.mercatorFromTransition||He||(al=ao(_e));const Pc=Xh(zo.kind,rn,Oc,nt,g,Ao,Fl,Rn,xe,!0,Xa,Ra,0,wt,tr,Oe,Or,rr?al:ht,pt.getProjection(),Bn,Si,null,null,fn),Lc=ft.glyphAtlasTexture?ft.glyphAtlasTexture:null,Ma=ye.LINEAR,Bc=c.paint.get("text-halo-width").constantOr(1)!==0,kl=g.terrain&&nt&&Ui?n.bl(n.bC(),Yn):fu;if(Ui&&pt.text){const sl=_e.elevation,Nl=sl?sl.getAtTileOffsetFunc(wt,_e.center.lat,_e.worldSize,pt.getProjection()):null,Sd=ic(or,ft.tileID.canonical,nt,He,_e,pt.getProjection(),Qt);mm(pt,or,g,!0,Sd,lo,nt,re,Nl,wt)}return{program:Wn,buffers:pt.text,uniformValues:Pc,atlasTexture:Lc,atlasTextureIcon:da,atlasInterpolation:Ma,atlasInterpolationIcon:Ia,isSDF:!0,hasHalo:Bc,depthMode:xn,tile:ft,renderWithShadows:Xi,labelPlaneMatrixInv:kl}},fi=pt.icon.segments.get().length,li=pt.text.segments.get().length,di=fi&&!A.onlyText?_i():null,Fi=li&&!A.onlyIcons?Lr():null,Ii=c.paint.get("icon-opacity").constantOr(1),In=c.paint.get("text-opacity").constantOr(1);if(Ge&&pt.canOverlap){tt=!0;const Ui=Ii&&!A.onlyText?pt.icon.segments.get():[],Pr=In&&!A.onlyIcons?pt.text.segments.get():[];for(const br of Ui)at.push({segments:new n.bg([br]),sortKey:br.sortKey,state:di});for(const br of Pr)at.push({segments:new n.bg([br]),sortKey:br.sortKey,state:Fi})}else A.onlyText||at.push({segments:Ii?pt.icon.segments:new n.bg([]),sortKey:0,state:di}),A.onlyIcons||at.push({segments:In?pt.text.segments:new n.bg([]),sortKey:0,state:Fi})}tt&&at.sort(((wt,ft)=>wt.sortKey-ft.sortKey));for(const wt of at){const ft=wt.state;if(ft)if(g.terrain?g.terrain.setupElevationDraw(ft.tile,ft.program,{useDepthForOcclusion:_e.depthOcclusionForSymbolsAndCircles,labelPlaneMatrixInv:ft.labelPlaneMatrixInv}):g.setupDepthForOcclusion(_e.depthOcclusionForSymbolsAndCircles,ft.program),Te.activeTexture.set(ye.TEXTURE0),ft.atlasTexture&&ft.atlasTexture.bind(ft.atlasInterpolation,ye.CLAMP_TO_EDGE,!0),ft.atlasTextureIcon&&(Te.activeTexture.set(ye.TEXTURE1),ft.atlasTextureIcon&&ft.atlasTextureIcon.bind(ft.atlasInterpolationIcon,ye.CLAMP_TO_EDGE,!0)),ft.renderWithShadows&&g.shadowRenderer.setupShadows(ft.tile.tileID.toUnwrapped(),ft.program,"vector-tile"),g.uploadCommonLightUniforms(g.context,ft.program),ft.hasHalo){const pt=ft.uniformValues;pt.u_is_halo=1,ad(ft.buffers,wt.segments,c,g,ft.program,ft.depthMode,x,w,pt,2),pt.u_is_halo=0}else{if(ft.isSDF){const pt=ft.uniformValues;ft.hasHalo&&(pt.u_is_halo=1,ad(ft.buffers,wt.segments,c,g,ft.program,ft.depthMode,x,w,pt,1)),pt.u_is_halo=0}ad(ft.buffers,wt.segments,c,g,ft.program,ft.depthMode,x,w,ft.uniformValues,1)}}}function ad(g,i,c,p,x,w,A,I,O,z){const k=[g.dynamicLayoutVertexBuffer,g.opacityVertexBuffer,g.iconTransitioningVertexBuffer,g.globeExtVertexBuffer,g.zOffsetVertexBuffer,g.orientationVertexBuffer];x.draw(p,p.context.gl.TRIANGLES,w,A,I,Tr.disabled,O,c.id,g.layoutVertexBuffer,g.indexBuffer,i,c.paint,p.transform.zoom,g.programConfigurations.get(c.id),k,z)}function Og(g,i){const c=1<<g.canonical.z,p=(i.x*c-g.canonical.x-g.wrap*c)*n.al,x=(i.y*c-g.canonical.y)*n.al,w=n.e5(i.z,i.y);return n.d4(p,x,w)}function Sc(g,i,c,p,x){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const w=g.context.gl,A=new qt(g.context.gl.LEQUAL,qt.ReadWrite,g.depthRangeFor3D),I=new qt(g.context.gl.GREATER,qt.ReadWrite,g.depthRangeFor3D),O=(function(X){let Y=.01;return X.isOrthographic&&(Y=n.ak(1e-4,Y,n.c$(X.pitch>=lc?1:X.pitch/lc))),2*Y})(g.transform),z=g.transform.getFreeCameraOptions().position,k="elevatedStructuresDepthReconstruct",H=g.getOrCreateProgram(k,{defines:["DEPTH_RECONSTRUCTION"]}),V=g.getOrCreateProgram(k);for(const X of p){const Y=i.getTile(X),W=Y.getBucket(c);if(!W)continue;const re=W.elevatedStructures;if(!re)continue;const K=W.elevationBufferData.heightRange,ae=Og(X.toUnwrapped(),z),ue=g.translatePosMatrix(X.projMatrix,Y,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor"));let fe,xe,ge,Te;if(x==="initialize"){if(!K||K.min>=1||re.depthSegments.segments[0].primitiveLength===0)continue;fe=Jf(ue,ae,O,1,0),xe=A,ge=re.depthSegments,Te=H}else if(x==="reset"){if(!K||K.min>=0||re.maskSegments.segments[0].primitiveLength===0)continue;fe=Jf(ue,ae,0,0,1),xe=I,ge=re.maskSegments,Te=H}else if(x==="geometry"){if(re.depthSegments.segments[0].primitiveLength===0)continue;fe=Jf(ue,ae,O,1,0),xe=A,ge=re.depthSegments,Te=V}Te.draw(g,w.TRIANGLES,xe,vr.disabled,kr.disabled,Tr.disabled,fe,c.id,re.vertexBuffer,re.indexBuffer,ge,c.paint,g.transform.zoom)}}function du(g,i,c){const{painter:p,sourceCache:x,layer:w,coords:A,colorMode:I,elevationType:O,terrainEnabled:z,pass:k}=g,H=p.context.gl,V=w.paint.get("fill-pattern"),X=w.paint.get("fill-pattern-cross-fade"),Y=V.constantOr(null);let W=O;O!=="road"||i&&!z||(W="none");const re=W==="road",K=g.painter.shadowRenderer,ae=re&&!!K&&K.enabled,ue=new qt(p.context.gl.LEQUAL,qt.ReadOnly,p.depthRangeFor3D);let fe=[0,0,0];if(ae){const Te=p.style.directionalLight,ye=p.style.ambientLight;Te&&ye&&(fe=Ts(p.style,Te,ye))}const xe=V&&V.constantOr(1),ge=(Te,ye)=>{let _e,Se,He,ze,nt;ye?(_e=xe&&!w.getPaintProperty("fill-outline-color")?"fillOutlinePattern":"fillOutline",He=H.LINES):(_e=xe?"fillPattern":"fill",He=H.TRIANGLES);for(const Ge of A){const tt=x.getTile(Ge);if(xe&&!tt.patternsLoaded())continue;const It=tt.getBucket(w);if(!It)continue;const qe=i?It.elevationBufferData:It.bufferData;if(qe.isEmpty())continue;p.prepareDrawTile();const Oe=qe.programConfigurations.get(w.id),ot=p.isTileAffectedByFog(Ge),je=[],at=[];re&&(je.push("ELEVATED_ROADS"),at.push(qe.elevatedLayoutVertexBuffer)),ae&&je.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET"),xe&&(p.context.activeTexture.set(H.TEXTURE0),tt.imageAtlasTexture&&tt.imageAtlasTexture.bind(H.LINEAR,H.CLAMP_TO_EDGE),Oe.updatePaintBuffers());let ht=!1;if(Y&&tt.imageAtlas){const tr=tt.imageAtlas,or=n.e0.from(Y),Qt=or.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),fr=or.getSecondary(),Mr=tr.patternPositions.get(Qt),Or=fr?tr.patternPositions.get(fr.scaleSelf(n.o.devicePixelRatio).toString()):null;ht=!!Mr&&!!Or,Mr&&Oe.setConstantPatternPositions(Mr,Or)}X>0&&(ht||Oe.getPatternTransitionVertexBuffer("fill-pattern"))&&je.push("FILL_PATTERN_TRANSITION");const wt=p.getOrCreateProgram(_e,{config:Oe,overrideFog:ot,defines:je}),ft=p.translatePosMatrix(Ge.projMatrix,tt,w.paint.get("fill-translate"),w.paint.get("fill-translate-anchor"));ae&&K.setupShadows(tt.tileID.toUnwrapped(),wt,"vector-tile");const pt=w.paint.get("fill-emissive-strength");if(ye){ze=qe.lineIndexBuffer,nt=qe.lineSegments;const tr=p.terrain&&p.terrain.renderingToTexture?p.terrain.drapeBufferSize:[H.drawingBufferWidth,H.drawingBufferHeight];Se=_e==="fillOutlinePattern"&&xe?Mg(ft,pt,p,tt,tr,fe,X):Im(ft,pt,tr,fe)}else ze=qe.indexBuffer,nt=qe.triangleSegments,Se=xe?Al(ft,pt,p,tt,fe,X):cp(ft,pt,fe);p.uploadCommonUniforms(p.context,wt,Ge.toUnwrapped());let rr=Te;(O==="road"&&!z||O==="offset")&&(rr=ue),wt.draw(p,He,rr,c||p.stencilModeForClipping(Ge),I,Tr.disabled,Se,w.id,qe.layoutVertexBuffer,ze,nt,w.paint,p.transform.zoom,Oe,at)}};p.renderPass===k&&ge(p.depthModeForSublayer(1,p.renderPass==="opaque"?qt.ReadWrite:qt.ReadOnly),!1),W==="none"&&p.renderPass==="translucent"&&w.paint.get("fill-antialias")&&ge(p.depthModeForSublayer(w.getPaintProperty("fill-outline-color")?2:0,qt.ReadOnly),!0)}function $t(g,i,c,p,x,w,A,I){c.resetLayerRenderingStats(g);const O=g.context,z=O.gl,k=g.transform,H=c.paint.get("fill-extrusion-pattern"),V=c.paint.get("fill-extrusion-pattern-cross-fade"),X=H.constantOr(null),Y=H.constantOr(1),W=c.paint.get("fill-extrusion-opacity"),re=g.style.enable3dLights(),K=c.paint.get(re&&!Y?"fill-extrusion-ambient-occlusion-wall-radius":"fill-extrusion-ambient-occlusion-radius"),ae=[c.paint.get("fill-extrusion-ambient-occlusion-intensity"),K],ue=c.layout.get("fill-extrusion-edge-radius"),fe=ue>0&&!c.paint.get("fill-extrusion-rounded-roof"),xe=fe?0:ue,ge=k.projection.name==="globe"?n.e8():0,Te=k.projection.name==="globe",ye=Te?n.aj(k.zoom):0,_e=[n.aF(k.center.lng),n.aJ(k.center.lat)],Se=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",He=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(Se?null:c.lut).toArray01().slice(0,3),ze=c.paint.get("fill-extrusion-flood-light-intensity"),nt=c.paint.get("fill-extrusion-vertical-scale"),Ge=c.paint.get("fill-extrusion-line-width").constantOr(1)!==0,tt=c.paint.get("fill-extrusion-height-alignment"),It=c.paint.get("fill-extrusion-base-alignment"),qe=Qc(g,c.paint.get("fill-extrusion-cutoff-fade-range")),Oe=[];let ot;Te&&Oe.push("PROJECTION_GLOBE_VIEW"),ae[0]>0&&Oe.push("FAUX_AO"),fe&&Oe.push("ZERO_ROOF_RADIUS"),I&&Oe.push("HAS_CENTROID"),ze>0&&Oe.push("FLOOD_LIGHT"),qe.shouldRenderCutoff&&Oe.push("RENDER_CUTOFF"),Ge&&Oe.push("RENDER_WALL_MODE");const je=g.renderPass==="shadow",at=g.shadowRenderer,ht=je&&!!at,wt=je?Tr.disabled:Tr.backCCW;g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0);let ft=[0,0,0];if(at){const tr=g.style.directionalLight,or=g.style.ambientLight;tr&&or&&(ft=Ts(g.style,tr,or)),je||(Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE"),at.useNormalOffset&&Oe.push("NORMAL_OFFSET")),ot=Oe.concat(["SHADOWS_SINGLE_CASCADE"])}const pt=ht?"fillExtrusionDepth":Y?"fillExtrusionPattern":"fillExtrusion",rr=c.getLayerRenderingStats();for(const tr of p){const or=i.getTile(tr),Qt=or.getBucket(c);if(!Qt||Qt.projection.name!==k.projection.name)continue;let fr=!1;at&&(fr=at.getMaxCascadeForTile(tr.toUnwrapped())===0);const Mr=g.isTileAffectedByFog(tr),Or=Qt.programConfigurations.get(c.id);let Si=!1;if(X&&or.imageAtlas){const li=or.imageAtlas,di=n.e0.from(X),Fi=di.getPrimary().scaleSelf(n.o.devicePixelRatio).toString(),Ii=di.getSecondary(),In=li.patternPositions.get(Fi),Ui=Ii?li.patternPositions.get(Ii.scaleSelf(n.o.devicePixelRatio).toString()):null;Si=!!In&&!!Ui,In&&Or.setConstantPatternPositions(In,Ui)}V>0&&(Si||Or.getPatternTransitionVertexBuffer("fill-extrusion-pattern"))&&Oe.push("FILL_EXTRUSION_PATTERN_TRANSITION");const wr=g.getOrCreateProgram(pt,{config:Or,defines:fr?ot:Oe,overrideFog:Mr});if(g.terrain&&g.terrain.setupElevationDraw(or,wr,{useMeterToDem:!0}),!Qt.centroidVertexBuffer){const li=wr.getAttributeLocation(z,"a_centroid_pos");li!==-1&&z.vertexAttrib2f(li,0,0)}!je&&at&&at.setupShadows(or.tileID.toUnwrapped(),wr,"vector-tile"),Y&&(g.context.activeTexture.set(z.TEXTURE0),or.imageAtlasTexture&&or.imageAtlasTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),Or.updatePaintBuffers());const ii=c.paint.get("fill-extrusion-vertical-gradient"),hi=1/Qt.tileToMeter;let _i;if(je&&at){if(Dl(or.tileID,Qt.maxHeight,g))continue;const li=at.calculateShadowPassMatrixFromTile(or.tileID.toUnwrapped());_i=lp(li,xe,hi,nt,tt,It)}else{const li=g.translatePosMatrix(tr.expandedProjMatrix,or,c.paint.get("fill-extrusion-translate"),c.paint.get("fill-extrusion-translate-anchor")),di=k.projection.createInversionMatrix(k,tr.canonical);_i=Y?qh(li,g,ii,W,ae,xe,hi,tr,or,ge,tt,It,ye,_e,di,He,nt,V):cu(li,g,ii,W,ae,xe,hi,tr,ge,tt,It,ye,_e,di,He,nt,ze,ft)}g.uploadCommonUniforms(O,wr,tr.toUnwrapped(),null,qe);let Lr=Qt.segments;if(k.projection.name==="mercator"&&!je&&(Lr=Qt.getVisibleSegments(or.tileID,g.terrain,g.transform.getFrustum(0)),!Lr.get().length))continue;if(rr)if(je)for(const li of Lr.get())rr.numRenderedVerticesInShadowPass+=li.primitiveLength;else for(const li of Lr.get())rr.numRenderedVerticesInTransparentPass+=li.primitiveLength;const fi=[];(g.terrain||I)&&fi.push(Qt.centroidVertexBuffer),Te&&fi.push(Qt.layoutVertexExtBuffer),Ge&&fi.push(Qt.wallVertexBuffer),wr.draw(g,O.gl.TRIANGLES,x,w,A,wt,_i,c.id,Qt.layoutVertexBuffer,Qt.indexBuffer,Lr,c.paint,g.transform.zoom,Or,fi)}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1)}class ha{constructor(){this.translate=[0,0],this.translateAnchor="map",this.edgeRadius=0,this.cutoffFadeRange=0}}function Ln(g,i,c,p,x,w,A,I,O,z,k,H,V,X,Y,W,re,K,ae,ue){const fe=i.context,xe=fe.gl,ge=i.transform,Te=i.transform.zoom,ye=[],_e=g.translate,Se=g.translateAnchor,He=g.edgeRadius,ze=Qc(i,g.cutoffFadeRange);k==="clear"?(ye.push("CLEAR_SUBPASS"),ue&&(ye.push("CLEAR_FROM_TEXTURE"),fe.activeTexture.set(xe.TEXTURE0),ue.bind(xe.LINEAR,xe.CLAMP_TO_EDGE))):k==="sdf"&&ye.push("SDF_SUBPASS"),K&&ye.push("HAS_CENTROID"),ze.shouldRenderCutoff&&ye.push("RENDER_CUTOFF");const nt=(Ge,tt,It,qe,Oe)=>{const ot=tt.programConfigurations.get(p.id),je=i.isTileAffectedByFog(Ge),at=i.getOrCreateProgram("fillExtrusionGroundEffect",{config:ot,defines:ye,overrideFog:je}),ht=((ft,pt,rr,tr,or,Qt,fr,Mr,Or,Si,wr)=>({u_matrix:pt,u_opacity:rr,u_ao_pass:tr?1:0,u_meter_to_tile:or,u_ao:Qt,u_flood_light_intensity:fr,u_flood_light_color:Mr,u_attenuation:Or,u_edge_radius:Si,u_fb:0,u_fb_size:wr,u_dynamic_offset:1}))(0,qe,H,z,Oe,[V,X*Oe],Y,W,re,Te>=17?0:He*Oe,ue?ue.size[0]:0),wt=[];K&&wt.push(tt.hiddenByLandmarkVertexBuffer),i.uploadCommonUniforms(fe,at,Ge.toUnwrapped(),null,ze),at.draw(i,fe.gl.TRIANGLES,w,A,I,O,ht,p.id,tt.vertexBuffer,tt.indexBuffer,It,p.paint,Te,ot,wt)};for(const Ge of x){const tt=c.getTile(Ge),It=tt.getBucket(p);if(!It||It.projection.name!==ge.projection.name||!It.groundEffect||It.groundEffect&&!It.groundEffect.hasData())continue;const qe=It.groundEffect,Oe=1/It.tileToMeter;{const ot=i.translatePosMatrix(Ge.projMatrix,tt,_e,Se),je=qe.getDefaultSegment();nt(Ge,qe,je,ot,Oe)}if(ae)for(let ot=0;ot<4;ot++){const je=n.e6[ot](Ge),at=c.getTile(je);if(!at)continue;const ht=at.getBucket(p);if(!ht||ht.projection.name!==ge.projection.name||!ht.groundEffect||ht.groundEffect&&!ht.groundEffect.hasData())continue;const wt=ht.groundEffect;let ft,pt;ot===0?(ft=[-n.al,0,0],pt=1):ot===1?(ft=[n.al,0,0],pt=0):ot===2?(ft=[0,-n.al,0],pt=3):(ft=[0,n.al,0],pt=2);const rr=wt.regionSegments[pt];if(!rr)continue;const tr=new Float32Array(16);n.br(tr,Ge.projMatrix,ft),nt(Ge,wt,rr,i.translatePosMatrix(tr,tt,_e,Se),Oe)}}}function Ml(g,i,c,p,x,w,A){p.centroidVertexArray.length===0&&p.createCentroidsBuffer();const I=w?w.findDEMTileFor(c):null;if(!(I&&I.dem||A))return;w&&I&&I.dem&&p.selfDEMTileTimestamp!==I.dem._timestamp&&(p.borderDoneWithNeighborZ=[-1,-1,-1,-1],p.selfDEMTileTimestamp=I.dem._timestamp);const O=K=>new n.P(Math.ceil((K+n.ea)*n.eb),0),z=K=>{const ae=i.getSource().minzoom,ue=xe=>{const ge=i.getTileByID(xe);if(ge&&ge.hasData())return ge.getBucket(x)},fe=[0,-1,1];for(const xe of fe){if(K.overscaledZ+xe<ae)continue;const ge=ue(K.calculateScaledKey(K.overscaledZ+xe));if(ge)return ge}},k=[0,0,0],H=(K,ae)=>(k[0]=Math.min(K.min.y,ae.min.y),k[1]=Math.max(K.max.y,ae.max.y),k[2]=n.al-ae.min.x>K.max.x?ae.min.x-n.al:K.max.x,k),V=(K,ae)=>(k[0]=Math.min(K.min.x,ae.min.x),k[1]=Math.max(K.max.x,ae.max.x),k[2]=n.al-ae.min.y>K.max.y?ae.min.y-n.al:K.max.y,k),X=[(K,ae)=>H(K,ae),(K,ae)=>H(ae,K),(K,ae)=>V(K,ae),(K,ae)=>V(ae,K)],Y=(K,ae,ue,fe,xe,ge,Te)=>{if(!w)return 0;const ye=[[ge?ue:K,ge?K:ue,0],[ge?ue:ae,ge?ae:ue,0]],_e=Te<0?n.al+Te:Te,Se=[ge?_e:(K+ae)/2,ge?(K+ae)/2:_e,0];return ue===0&&Te<0||ue!==0&&Te>0?w.getForTilePoints(xe,[Se],!0,fe):ye.push(Se),w.getForTilePoints(c,ye,!0,I),Math.max(ye[0][2],ye[1][2],Se[2])/w.exaggeration()};for(let K=0;K<4;K++){const ae=p.borderFeatureIndices[K];if(ae.length===0)continue;const ue=n.e6[K](c),fe=z(ue);if(!(fe&&fe instanceof n.e7))continue;const xe=w?w.findDEMTileFor(ue):null;if(!(xe&&xe.dem||A)||(w&&xe&&xe.dem&&p.borderDEMTileTimestamp[K]!==xe.dem._timestamp&&(p.borderDoneWithNeighborZ[K]=-1,p.borderDEMTileTimestamp[K]=xe.dem._timestamp),p.borderDoneWithNeighborZ[K]===fe.canonical.z))continue;fe.centroidVertexArray.length===0&&fe.createCentroidsBuffer();const ge=(K<2?1:5)-K,Te=fe.borderDoneWithNeighborZ[ge]!==p.canonical.z,ye=fe.borderFeatureIndices[ge];let _e=0;if(p.canonical.z!==fe.canonical.z){for(const Se of ae)p.showCentroid(p.featuresOnBorder[Se]);if(Te)for(const Se of ye)fe.showCentroid(fe.featuresOnBorder[Se]);p.borderDoneWithNeighborZ[K]=fe.canonical.z,fe.borderDoneWithNeighborZ[ge]=p.canonical.z}for(const Se of ae){const He=p.featuresOnBorder[Se],ze=p.centroidData[He.centroidDataIndex],nt=He.borders[K];let Ge;for(;_e<ye.length;){Ge=fe.featuresOnBorder[ye[_e]];const tt=Ge.borders[ge];if(tt[1]>nt[0]+3||tt[0]>nt[0]-3)break;fe.showCentroid(Ge),_e++}if(Ge&&_e<ye.length){const tt=_e;let It=0;for(;!(Ge.borders[ge][0]>nt[1]-3)&&(It++,++_e!==ye.length);)Ge=fe.featuresOnBorder[ye[_e]];Ge=fe.featuresOnBorder[ye[tt]];let qe=!1;if(It>=1){const je=Ge.borders[ge];Math.abs(nt[0]-je[0])<3&&Math.abs(nt[1]-je[1])<3&&(It=1,qe=!0,_e=tt+1)}else if(It===0){p.showCentroid(He);continue}const Oe=fe.centroidData[Ge.centroidDataIndex];A&&qe&&(((W=ze).flags|(re=Oe).flags)&n.e9?(W.flags|=n.e9,re.flags|=n.e9):(W.flags&=~n.e9,re.flags&=~n.e9));const ot=He.intersectsCount()>1||Ge.intersectsCount()>1;if(It>1)_e=tt,ze.centroidXY=Oe.centroidXY=new n.P(0,0);else if(xe&&xe.dem&&!ot){const je=X[K](ze,Oe),at=K%2?n.al-1:0,ht=Y(je[0],Math.min(n.al-1,je[1]),at,xe,ue,K<2,je[2]);ze.centroidXY=Oe.centroidXY=O(ht)}else ot?ze.centroidXY=Oe.centroidXY=new n.P(0,0):(ze.centroidXY=p.encodeBorderCentroid(He),Oe.centroidXY=fe.encodeBorderCentroid(Ge));p.writeCentroidToBuffer(ze),fe.writeCentroidToBuffer(Oe)}else p.showCentroid(He)}p.borderDoneWithNeighborZ[K]=fe.canonical.z,fe.borderDoneWithNeighborZ[ge]=p.canonical.z}var W,re;(p.needsCentroidUpdate||!p.centroidVertexBuffer&&p.centroidVertexArray.length!==0)&&p.uploadCentroid(g)}const Ms=[1,0,0],_r=[0,1,0],sd=[0,0,1];function Dl(g,i,c){const p=c.transform,x=c.shadowRenderer;if(!x)return!0;const w=g.toUnwrapped(),A=p.tileSize*x._cascades[c.currentShadowCascade].scale;let I=i;if(p.elevation){const W=p.elevation.getMinMaxForTile(g);W&&(I+=W.max)}const O=[...x.shadowDirection];O[2]=-O[2];const z=x.computeSimplifiedTileShadowVolume(w,I,A,O);if(!z)return!1;const k=[Ms,_r,sd,O,[O[0],0,O[2]],[0,O[1],O[2]]],H=p.projection.name==="globe",V=p.scaleZoom(A),X=n.cA.fromInvProjectionMatrix(p.invProjMatrix,p.worldSize,V,!H),Y=x.getCurrentCascadeFrustum();return X.intersectsPrecise(z.vertices,z.planes,k)===0||Y.intersectsPrecise(z.vertices,z.planes,k)===0}function sh(g){const{painter:i,source:c,layer:p,coords:x}=g;let w=g.defines;const A=i.context,I=i.renderPass==="shadow",O=i.renderPass==="light-beam",z=i.shadowRenderer,k=n.ec(i.transform.center.lat,i.transform.zoom),H=Qc(i,p.paint.get("building-cutoff-fade-range"));H.shouldRenderCutoff&&(w=w.concat("RENDER_CUTOFF"));for(const V of x){const X=c.getTile(V),Y=X.getBucket(p);if(!Y)continue;z&&z.getMaxCascadeForTile(V.toUnwrapped())===0&&(w=w.concat("SHADOWS_SINGLE_CASCADE"));const W=Y.programConfigurations.get(p.id);let re,K,ae,ue=i.translatePosMatrix(V.expandedProjMatrix,X,[0,0],"map");if(ue=n.cR(n.bC(),ue,[1,1,g.verticalScale]),I&&z){if(Dl(X.tileID,Y.maxHeight*k,i))continue;let xe=z.calculateShadowPassMatrixFromTile(X.tileID.toUnwrapped());xe=n.cR(n.bC(),xe,[1,1,g.verticalScale]),ae=hp(xe),re=K=i.getOrCreateProgram("buildingDepth",{config:W,defines:w,overrideFog:!1})}else if(O)re=K=i.getOrCreateProgram("buildingBloom",{config:W,defines:w,overrideFog:!1}),ae=Dg(ue);else{const xe=i.transform.calculatePosMatrix(V.toUnwrapped(),i.transform.worldSize);n.cR(xe,xe,[1,1,g.verticalScale]);const ge=n.bC();n.cR(ge,xe,[1,-1,1/k]),n.bl(ge,ge),n.ed(ge,ge);const Te=i.transform.getFreeCameraOptions().position,ye=1<<V.canonical.z;ae=ed(ue,ge,g.opacity,g.facadeAOIntensity,[((Te.x-V.wrap)*ye-V.canonical.x)*n.al,(Te.y*ye-V.canonical.y)*n.al,Te.z*ye*n.al],Y.tileToMeter,g.facadeEmissiveChance),K=i.getOrCreateProgram("building",{config:W,defines:w,overrideFog:!1});const _e=w.concat(["BUILDING_FAUX_FACADE","HAS_ATTRIBUTE_a_faux_facade_color_emissive"]);re=i.getOrCreateProgram("building",{config:W,defines:_e,overrideFog:!1}),z&&(z.setupShadowsFromMatrix(xe,K,!0),z.setupShadowsFromMatrix(xe,re,!0))}const fe=(xe,ge)=>{if(O){const Te=xe.entranceBloom;ge.draw(i,A.gl.TRIANGLES,g.depthMode,vr.disabled,g.blendMode,Tr.disabled,ae,p.id,Te.layoutVertexBuffer,Te.indexBuffer,Te.segmentsBucket,p.paint,i.transform.zoom,W,[Te.layoutAttenuationBuffer,Te.layoutColorBuffer])}else{const Te=xe.segmentsBucket;let ye=[xe.layoutNormalBuffer,xe.layoutCentroidBuffer,xe.layoutColorBuffer];xe.layoutFacadePaintBuffer&&(ye=ye.concat([xe.layoutFacadeDataBuffer,xe.layoutFacadeVerticalRangeBuffer,xe.layoutFacadePaintBuffer])),ge.draw(i,A.gl.TRIANGLES,g.depthMode,vr.disabled,g.blendMode,I?Tr.disabled:Tr.backCW,ae,p.id,xe.layoutVertexBuffer,xe.indexBuffer,Te,p.paint,i.transform.zoom,W,ye)}};i.uploadCommonUniforms(A,K,V.toUnwrapped(),null,H),Y.buildingWithoutFacade&&fe(Y.buildingWithoutFacade,K),re!==K&&i.uploadCommonUniforms(A,re,V.toUnwrapped(),null,H),Y.buildingWithFacade&&fe(Y.buildingWithFacade,re)}}function ef(g){return[g[0]*n.ee,g[1]*n.ee,g[2]*n.ee,0]}function tf(g,i,c,p,x,w,A,I,O){const z=p.getSource(),k=c.globeSharedBuffers;if(!k)return;let H,V,X;if(i&&(H=p.getTile(i)),z instanceof n.aS?(V=z.texture,X=n.dG(0,0,c.transform)):H&&i&&(V=H.texture,X=n.dG(i.canonical.z,i.canonical.x,c.transform)),!V||!X)return;g||(X=n.cR(n.bC(),X,[1,-1,1]));const Y=c.context,W=Y.gl,re=x.paint.get("raster-resampling")==="nearest"?W.NEAREST:W.LINEAR,K=c.colorModeForDrapableLayerRenderPass(w),ae=A.defines;ae.push("GLOBE_POLES");const ue=new qt(W.LEQUAL,qt.ReadWrite,c.depthRangeFor3D),fe=Float32Array.from(c.transform.expandedFarZProjMatrix),xe=Float32Array.from(n.bk(n.dF(new n.cC(0,0,0))));c.terrain&&c.terrain.prepareDrawTile(),Y.activeTexture.set(W.TEXTURE0),V.bind(re,W.CLAMP_TO_EDGE),Y.activeTexture.set(W.TEXTURE1),V.bind(re,W.CLAMP_TO_EDGE),"useMipmap"in V&&Y.extTextureFilterAnisotropic&&c.transform.pitch>20&&W.texParameterf(W.TEXTURE_2D,Y.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,Y.extTextureFilterAnisotropicMax);const[ge,Te,ye,_e]=i?k.getPoleBuffers(i.canonical.z,!1):k.getPoleBuffers(0,!0),Se=x.paint.get("raster-elevation");let He;g?(He=ge,c.renderDefaultNorthPole=Se!==0):(He=Te,c.renderDefaultSouthPole=Se!==0);const ze=ef(A.mix),nt=((tt,It,qe,Oe,ot,je,at,ht,wt,ft,pt,rr,tr)=>$h(tt,It,qe,new Float32Array(16),new Float32Array(9),[0,0],Oe,[0,0],[0,0,0,0],1,{opacity:1,mix:0},je,[0,0],ht,2,ft,pt,rr,1,0,tr))(fe,xe,X,n.aj(c.transform.zoom),0,x,0,Se,0,ze,A.offset,A.range,w),Ge=c.getOrCreateProgram("raster",{defines:ae});c.uploadCommonUniforms(Y,Ge,null),Ge.draw(c,W.TRIANGLES,ue,O,K,I,nt,x.id,He,ye,_e)}function Pg(g){const i=g._nearZ,c=g.projection.farthestPixelDistance(g),p=c-i,x=.2*g.height,w=i+x;return[i,c,(w-x-i)/p,(w-i)/p]}function Rm(g,i,c,p){if(g)return i instanceof Vc&&g instanceof qc?i.getTextureDescriptor(g,c,!0):{texture:g.texture,mix:ef(p.mix),offset:p.offset,buffer:0,tileSize:1}}var Lg=n.ef([{name:"a_index",type:"Int16",components:1}]);class Bg{constructor(i,c,p,x){const w={width:p[0],height:p[1],data:null},A=i.gl;this.targetColorTexture=new n.T(i,w,A.RGBA8,{useMipmap:!1}),this.backgroundColorTexture=new n.T(i,w,A.RGBA8,{useMipmap:!1}),this.context=i,this.updateParticleTexture(c,x),this.lastInvalidatedAt=0}updateParticleTexture(i,c){if(this.particleTextureDimension===c.width)return;(this.particleTexture0||this.particleTexture1||this.particleIndexBuffer||this.particleSegment)&&(this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleIndexBuffer.destroy(),this.particleSegment.destroy());const p=this.context.gl,x=c.width*c.height;this.particleTexture0=new n.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1}),this.particleTexture1=new n.T(this.context,c,p.RGBA8,{premultiply:!1,useMipmap:!1});const w=new n.eg;w.reserve(x);for(let A=0;A<x;A++)w.emplaceBack(A);this.particleIndexBuffer=this.context.createVertexBuffer(w,Lg.members,!0),this.particleSegment=n.bg.simpleSegment(0,0,this.particleIndexBuffer.length,0),this.particleTextureDimension=c.width}update(i){return!(this.lastInvalidatedAt<i&&(this.lastInvalidatedAt=n.o.now(),1))}destroy(){this.targetColorTexture.destroy(),this.backgroundColorTexture.destroy(),this.particleIndexBuffer.destroy(),this.particleTexture0.destroy(),this.particleTexture1.destroy(),this.particleSegment.destroy()}}function Aa(g,i,c){if(!g)return null;const p=i.getTextureDescriptor(g,c,!0);if(!p)return null;let{texture:x,mix:w,offset:A,tileSize:I,buffer:O,format:z}=p;if(!x||!z)return null;let k=!1;return z==="uint32"&&(k=!0,w[3]=0,w=Cl(n.eh,w,[0,c.paint.get("raster-particle-max-speed")]),A=ah(n.eh,A,[0,c.paint.get("raster-particle-max-speed")])),{texture:x,textureOffset:[O/(I+2*O),I/(I+2*O)],tileSize:I,scalarData:k,scale:w,offset:A,defines:["RASTER_ARRAY",{uint8:"DATA_FORMAT_UINT8",uint16:"DATA_FORMAT_UINT16",uint32:"DATA_FORMAT_UINT32"}[z]]}}function dp(g){const i=g._nearZ,c=g.projection.farthestPixelDistance(g),p=c-i,x=.2*g.height,w=i+x;return[i,c,(w-x-i)/p,(w-i)/p]}const jo=new n.ao(1,0,0,1),Tc=new n.ao(0,1,0,1),zg=new n.ao(0,0,1,1),pp=new n.ao(1,0,1,1),mp=new n.ao(0,1,1,1);function ld(g,i,c,p,x,w){for(let A=0;A<c.length;A++)if(x){const z=new n.ao(p.r*.8,p.g*.8,p.b*.8,1);Ac(g,i,c[A],p,-1,-1,w),Ac(g,i,c[A],p,-1,1,w),Ac(g,i,c[A],p,1,1,w),Ac(g,i,c[A],p,1,-1,w),Ac(g,i,c[A],z,0,0,w)}else Ac(g,i,c[A],p,0,0,w)}function Ac(g,i,c,p,x,w,A){const I=g.context,O=g.transform,z=I.gl,k=O.projection.name==="globe",H=k?["PROJECTION_GLOBE_VIEW"]:[];let V=n.bz(c.projMatrix);if(k&&n.aj(O.zoom)>0){const ze=n.bj(c.canonical,O),nt=n.ei(ze);V=n.aB(new Float32Array(16),O.globeMatrix,nt),n.aB(V,O.projMatrix,V)}const X=n.bC();X[12]+=2*x/(n.o.devicePixelRatio*O.width),X[13]+=2*w/(n.o.devicePixelRatio*O.height),n.aB(V,X,V);const Y=g.getOrCreateProgram("debug",{defines:H}),W=i.getTileByID(c.key);g.terrain&&g.terrain.setupElevationDraw(W,Y);const re=qt.disabled,K=vr.disabled,ae=g.colorModeForRenderPass(),ue="$debug";I.activeTexture.set(z.TEXTURE0),g.emptyTexture.bind(z.LINEAR,z.CLAMP_TO_EDGE),k?W._makeGlobeTileDebugBuffers(g.context,O):W._makeDebugTileBoundsBuffers(g.context,O.projection);const fe=W._tileDebugBuffer||g.debugBuffer,xe=W._tileDebugIndexBuffer||g.debugIndexBuffer,ge=W._tileDebugSegments||g.debugSegments;if(Y.draw(g,z.LINE_STRIP,re,K,ae,Tr.disabled,td(V,p.toPremultipliedRenderColor(null)),ue,fe,xe,ge,null,null,null,[W._globeTileDebugBorderBuffer]),A){const ze=W.latestRawTileData,nt=Math.floor((ze&&ze.byteLength||0)/1024);let Ge=c.canonical.toString();c.overscaledZ!==c.canonical.z&&(Ge+=` => ${c.overscaledZ}`),Ge+=` ${W.state}`,Ge+=` ${nt}kb`,(function(tt,It){tt.initDebugOverlayCanvas();const qe=tt.debugOverlayCanvas,Oe=tt.context.gl,ot=tt.debugOverlayCanvas.getContext("2d");ot.clearRect(0,0,qe.width,qe.height),ot.shadowColor="white",ot.shadowBlur=2,ot.lineWidth=1.5,ot.strokeStyle="white",ot.textBaseline="top",ot.font="bold 36px Open Sans, sans-serif",ot.fillText(It,5,5),ot.strokeText(It,5,5),tt.debugOverlayTexture.update(qe),tt.debugOverlayTexture.bind(Oe.LINEAR,Oe.CLAMP_TO_EDGE)})(g,Ge)}const Te=i.getTile(c).tileSize,ye=512/Math.min(Te,512)*(c.overscaledZ/O.zoom)*.5,_e=W._tileDebugTextBuffer||g.debugBuffer,Se=W._tileDebugTextIndexBuffer||g.quadTriangleIndexBuffer,He=W._tileDebugTextSegments||g.debugSegments;Y.draw(g,z.TRIANGLES,re,K,kr.alphaBlended,Tr.disabled,td(V,n.ao.transparent.toPremultipliedRenderColor(null),ye),ue,_e,Se,He,null,null,null,[W._globeTileDebugTextBuffer])}function tl(g,i,c,p){pu(g,0,i+c/2,g.transform.width,c,p)}function Hi(g,i,c,p){pu(g,i-c/2,0,c,g.transform.height,p)}function pu(g,i,c,p,x,w){const A=g.context,I=A.gl;I.enable(I.SCISSOR_TEST),I.scissor(i*n.o.devicePixelRatio,c*n.o.devicePixelRatio,p*n.o.devicePixelRatio,x*n.o.devicePixelRatio),A.clear({color:w}),I.disable(I.SCISSOR_TEST)}const gp=n.ef([{name:"a_pos_3f",components:3,type:"Float32"}]),{members:Mm}=gp;function Ec(g,i,c,p){g.emplaceBack(i,c,p)}class _p{constructor(i){this.vertexArray=new n.ej,this.indices=new n.b1,Ec(this.vertexArray,-1,-1,1),Ec(this.vertexArray,1,-1,1),Ec(this.vertexArray,-1,1,1),Ec(this.vertexArray,1,1,1),Ec(this.vertexArray,-1,-1,-1),Ec(this.vertexArray,1,-1,-1),Ec(this.vertexArray,-1,1,-1),Ec(this.vertexArray,1,1,-1),this.indices.emplaceBack(5,1,3),this.indices.emplaceBack(3,7,5),this.indices.emplaceBack(6,2,0),this.indices.emplaceBack(0,4,6),this.indices.emplaceBack(2,6,7),this.indices.emplaceBack(7,3,2),this.indices.emplaceBack(5,4,0),this.indices.emplaceBack(0,1,5),this.indices.emplaceBack(0,2,3),this.indices.emplaceBack(3,1,0),this.indices.emplaceBack(7,6,4),this.indices.emplaceBack(4,5,7),this.vertexBuffer=i.createVertexBuffer(this.vertexArray,Mm),this.indexBuffer=i.createIndexBuffer(this.indices),this.segment=n.bg.simpleSegment(0,0,36,12)}}function Ds(g,i,c,p,x,w){const A=g.context.gl,I=i.paint.get("sky-atmosphere-color"),O=i.paint.get("sky-atmosphere-halo-color"),z=i.paint.get("sky-atmosphere-sun-intensity"),k=((H,V,X,Y,W)=>({u_matrix_3f:H,u_sun_direction:V,u_sun_intensity:X,u_color_tint_r:[Y.r,Y.g,Y.b,Y.a],u_color_tint_m:[W.r,W.g,W.b,W.a],u_luminance:5e-5}))(n.el(n.dL(),p),x,z,I.toPremultipliedRenderColor(null),O.toPremultipliedRenderColor(null));A.framebufferTexture2D(A.FRAMEBUFFER,A.COLOR_ATTACHMENT0,A.TEXTURE_CUBE_MAP_POSITIVE_X+w,i.skyboxTexture,0),c.draw(g,A.TRIANGLES,qt.disabled,vr.disabled,kr.unblended,Tr.frontCW,k,"skyboxCapture",i.skyboxGeometry.vertexBuffer,i.skyboxGeometry.indexBuffer,i.skyboxGeometry.segment)}const Ol=n.ef([{type:"Float32",name:"a_pos",components:3},{type:"Float32",name:"a_uv",components:2}]);class mu{constructor(i){const c=new n.em;c.emplaceBack(-1,1,1,0,0),c.emplaceBack(1,1,1,1,0),c.emplaceBack(1,-1,1,1,1),c.emplaceBack(-1,-1,1,0,1);const p=new n.b1;p.emplaceBack(0,1,2),p.emplaceBack(2,3,0),this.vertexBuffer=i.createVertexBuffer(c,Ol.members),this.indexBuffer=i.createIndexBuffer(p),this.segments=n.bg.simpleSegment(0,0,4,2)}destroy(){this.vertexBuffer.destroy(),this.indexBuffer.destroy(),this.segments.destroy()}}const At=n.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_size_scale",components:1},{type:"Float32",name:"a_fade_opacity",components:1}]);class Ut{constructor(){this.starsCount=16e3,this.sizeMultiplier=.15,this.sizeRange=100,this.intensityRange=200}}class lh{constructor(i){this.colorModeAlphaBlendedWriteRGB=new kr([1,wa,1,wa],n.ao.transparent,[!0,!0,!0,!1]),this.colorModeWriteAlpha=new kr([1,0,1,0],n.ao.transparent,[!1,!1,!1,!0]),this.params=new Ut,this.updateNeeded=!0,i.tp.registerParameter(this.params,["Stars"],"starsCount",{min:100,max:16e3,step:1},(()=>{this.updateNeeded=!0})),i.tp.registerParameter(this.params,["Stars"],"sizeMultiplier",{min:.01,max:2,step:.01}),i.tp.registerParameter(this.params,["Stars"],"sizeRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0})),i.tp.registerParameter(this.params,["Stars"],"intensityRange",{min:0,max:200,step:1},(()=>{this.updateNeeded=!0}))}update(i){const c=i.context;if(!this.atmosphereBuffer||this.updateNeeded){this.updateNeeded=!1,this.atmosphereBuffer=new mu(c);const p=this.params.sizeRange,x=this.params.intensityRange,w=(function(k){const H=n.eo(30),V=[];for(let X=0;X<k;++X){const Y=2*Math.PI*H(),W=Math.acos(1-2*H())-.5*Math.PI;V.push(n.d4(Math.cos(W)*Math.cos(Y),Math.cos(W)*Math.sin(Y),Math.sin(W)))}return V})(this.params.starsCount),A=n.eo(300),I=new n.en,O=new n.b1;let z=0;for(let k=0;k<w.length;++k){const H=n.c4([],w[k],200),V=Math.max(0,1+.01*p*(1*A()-.5)),X=Math.max(0,1+.01*x*(1*A()-.5));I.emplaceBack(H[0],H[1],H[2],-1,-1,V,X),I.emplaceBack(H[0],H[1],H[2],1,-1,V,X),I.emplaceBack(H[0],H[1],H[2],1,1,V,X),I.emplaceBack(H[0],H[1],H[2],-1,1,V,X),O.emplaceBack(z+0,z+1,z+2),O.emplaceBack(z+0,z+2,z+3),z+=4}this.starsVx=c.createVertexBuffer(I,At.members),this.starsIdx=c.createIndexBuffer(O),this.starsSegments=n.bg.simpleSegment(0,0,I.length,O.length)}}destroy(){this.atmosphereBuffer&&this.atmosphereBuffer.destroy(),this.starsVx&&this.starsVx.destroy(),this.starsIdx&&this.starsIdx.destroy()}drawAtmosphereGlow(i,c){const p=i.context,x=p.gl,w=i.transform,A=new qt(x.LEQUAL,qt.ReadOnly,[0,1]),I=n.aj(w.zoom),O=i.style.getLut(c.scope),z=c.properties.get("color-use-theme")==="none",k=c.properties.get("color").toNonPremultipliedRenderColor(z?null:O),H=c.properties.get("high-color-use-theme")==="none",V=c.properties.get("high-color").toNonPremultipliedRenderColor(H?null:O),X=c.properties.get("space-color-use-theme")==="none",Y=c.properties.get("space-color").toNonPremultipliedRenderColor(X?null:O),W=5e-4,re=n.ep(c.properties.get("horizon-blend"),0,1,W,.25),K=n.dA(i,p,w)&&re===W?w.worldSize/(2*Math.PI*1.025)-1:w.globeRadius,ae=i.frameCounter/1e3%1,ue=n.ag(w.globeCenterInViewSpace),fe=Math.sqrt(Math.pow(ue,2)-Math.pow(K,2)),xe=Math.acos(fe/ue),ge=Te=>{const ye=w.projection.name==="globe"?["PROJECTION_GLOBE_VIEW","FOG"]:["FOG"];Te&&ye.push("ALPHA_PASS");const _e=i.getOrCreateProgram("globeAtmosphere",{defines:ye}),Se=((ze,nt,Ge,tt,It,qe,Oe,ot,je,at,ht,wt)=>({u_frustum_tl:ze,u_frustum_tr:nt,u_frustum_br:Ge,u_frustum_bl:tt,u_horizon:It,u_transition:qe,u_fadeout_range:Oe,u_atmosphere_fog_color:ot.toArray01(),u_high_color:je.toArray01(),u_space_color:at.toArray01(),u_temporal_offset:ht,u_horizon_angle:wt}))(w.frustumCorners.TL,w.frustumCorners.TR,w.frustumCorners.BR,w.frustumCorners.BL,w.frustumCorners.horizon,I,re,k,V,Y,ae,xe);i.uploadCommonUniforms(p,_e);const He=this.atmosphereBuffer;He&&_e.draw(i,x.TRIANGLES,A,vr.disabled,Te?this.colorModeWriteAlpha:this.colorModeAlphaBlendedWriteRGB,Tr.backCW,Se,Te?"atmosphere_glow_alpha":"atmosphere_glow",He.vertexBuffer,He.indexBuffer,He.segments)};ge(!1),ge(!0)}drawStars(i,c){const p=n.aA(c.properties.get("star-intensity"),0,1);if(p===0)return;const x=i.context,w=x.gl,A=i.transform,I=i.getOrCreateProgram("stars"),O=n.c6([]);n.c8(O,O,-A._pitch),n.c7(O,O,-A.angle),n.c8(O,O,n.an(A._center.lat)),n.eq(O,O,-n.an(A._center.lng));const z=n.cb(new Float32Array(16),O),k=n.aB([],A.starsProjMatrix,z),H=n.el([],z),V=n.er([],H),X=[0,1,0];n.dN(X,X,V),n.c4(X,X,this.params.sizeMultiplier);const Y=[1,0,0];n.dN(Y,Y,V),n.c4(Y,Y,this.params.sizeMultiplier);const W=(re=X,K=Y,ae=p,{u_matrix:Float32Array.from(k),u_up:re,u_right:K,u_intensity_multiplier:ae});var re,K,ae;i.uploadCommonUniforms(x,I),this.starsVx&&this.starsIdx&&I.draw(i,w.TRIANGLES,qt.disabled,vr.disabled,this.colorModeAlphaBlendedWriteRGB,Tr.disabled,W,"atmosphere_stars",this.starsVx,this.starsIdx,this.starsSegments)}}class yn{constructor(){this.visibleTiles=[]}updateBorders(i,c){const p=[],x=[],w=i._getRenderableCoordinates(!1,!0);for(const O of w){const z=i.getTile(O);if(!z.hasData())continue;const k=z.getBucket(c);k&&(k.isEmpty()||(p.push(O.key),x.push({bucket:k,tileID:O.canonical})))}let A=p.length!==this.visibleTiles.length;if(!A){p.sort();for(let O=0;O<p.length;O++)if(p[O]!==this.visibleTiles[O]){A=!0;break}}if(!A)return;const I=new Set;this.visibleTiles=p,x.sort(((O,z)=>O.tileID.z-z.tileID.z||O.tileID.x-z.tileID.x||O.tileID.y-z.tileID.y));for(const O of x){const z=new Array,k=new Array,H=O.bucket;for(const V of H.featuresOnBorder)I.has(V.featureId)?k.push(V.footprintIndex):(I.add(V.featureId),z.push(V.footprintIndex));H.updateFootprintHiddenFlags(z,n.es,!1),H.updateFootprintHiddenFlags(k,n.es,!0)}}}function Ve(g,i){const c=[...g],p=i.cameraWorldSizeForFog/i.worldSize,x=n.bA([]);return n.cR(x,x,[p,p,1]),n.aB(c,x,c),n.aB(c,i.worldToFogMatrix,c),c}function cd(g,i,c,p,x){const w=c.material,A=p.context,{baseColorTexture:I,metallicRoughnessTexture:O}=w.pbrMetallicRoughness,{normalTexture:z,occlusionTexture:k,emissionTexture:H}=w;function V(Y,W,re){if(Y&&(g.push(W),A.activeTexture.set(A.gl.TEXTURE0+re),Y.gfxTexture)){const{minFilter:K,magFilter:ae,wrapS:ue,wrapT:fe}=Y.sampler;Y.gfxTexture.bindExtraParam(K,ae,ue,fe)}}V(I,"HAS_TEXTURE_u_baseColorTexture",kn.BaseColor),V(O,"HAS_TEXTURE_u_metallicRoughnessTexture",kn.MetallicRoughness),V(z,"HAS_TEXTURE_u_normalTexture",kn.Normal),V(k,"HAS_TEXTURE_u_occlusionTexture",kn.Occlusion),V(H,"HAS_TEXTURE_u_emissionTexture",kn.Emission),x&&(x.texture||(x.texture=new n.dY(p.context,x.image,[x.image.height,x.image.height,x.image.height],A.gl.RGBA8)),A.activeTexture.set(A.gl.TEXTURE0+kn.LUT),x.texture&&x.texture.bind(A.gl.LINEAR,A.gl.CLAMP_TO_EDGE),g.push("APPLY_LUT_ON_GPU")),c.texcoordBuffer&&(g.push("HAS_ATTRIBUTE_a_uv_2f"),i.push(c.texcoordBuffer)),c.colorBuffer&&(g.push(c.colorBuffer.itemSize===12?"HAS_ATTRIBUTE_a_color_3f":"HAS_ATTRIBUTE_a_color_4f"),i.push(c.colorBuffer)),c.normalBuffer&&(g.push("HAS_ATTRIBUTE_a_normal_3f"),i.push(c.normalBuffer)),c.pbrBuffer&&(g.push("HAS_ATTRIBUTE_a_pbr"),g.push("HAS_ATTRIBUTE_a_heightBasedEmissiveStrength"),i.push(c.pbrBuffer)),w.alphaMode!=="OPAQUE"&&w.alphaMode!=="MASK"||g.push("UNPREMULT_TEXTURE_IN_SHADER"),w.defined||g.push("DIFFUSE_SHADED");const X=p.shadowRenderer;X&&(g.push("RENDER_SHADOWS","DEPTH_TEXTURE"),X.useNormalOffset&&g.push("NORMAL_OFFSET"))}function gu(g,i,c,p,x,w){const A=c.paint.get("model-opacity").constantOr(1),I=i.context,O=new qt(i.context.gl.LEQUAL,qt.ReadWrite,i.depthRangeFor3D),z=i.transform,k=g.mesh,H=k.material,V=H.pbrMetallicRoughness,X=i.style.fog;let Y;Y=i.transform.projection.zAxisUnit==="pixels"?[...g.nodeModelMatrix]:n.aB([],p.zScaleMatrix,g.nodeModelMatrix),n.aB(Y,p.negCameraPosMatrix,Y);const W=n.bl([],Y);n.ed(W,W);const re=c.paint.get("model-color-use-theme").constantOr("default")==="none",K=c.paint.get("model-emissive-strength").constantOr(0),ae=el(new Float32Array(g.worldViewProjection),new Float32Array(Y),new Float32Array(W),null,i,A,V.baseColorFactor,H.emissiveFactor,V.metallicFactor,V.roughnessFactor,H,K,c),ue={defines:[]},fe=[],xe=i.shadowRenderer;xe&&(xe.useNormalOffset=!1),cd(ue.defines,fe,k,i,re?null:c.lut);let ge=null;if(X){const _e=Ve(g.nodeModelMatrix,i.transform);if(ge=new Float32Array(_e),z.projection.name!=="globe"){const Se=k.aabb.min,He=k.aabb.max,[ze,nt]=X.getOpacityForBounds(_e,Se[0],Se[1],He[0],He[1]);ue.overrideFog=ze>=lr||nt>=lr}}const Te=Qc(i,c.paint.get("model-cutoff-fade-range"));Te.shouldRenderCutoff&&ue.defines.push("RENDER_CUTOFF");const ye=i.getOrCreateProgram("model",ue);i.uploadCommonUniforms(I,ye,null,ge,Te),i.renderPass!=="shadow"&&xe&&xe.setupShadowsFromMatrix(g.nodeModelMatrix,ye),ye.draw(i,I.gl.TRIANGLES,O,x,w,k.material.doubleSided?Tr.disabled:Tr.backCCW,ae,c.id,k.vertexBuffer,k.indexBuffer,k.segments,c.paint,i.transform.zoom,void 0,fe)}function ud(g,i,c,p,x,w,A){let I;I=g.projection.name==="globe"?n.eu(c,g):[...c],n.aB(I,I,i.matrix);const O=n.aB([],p,I);if(i.meshes)for(const z of i.meshes){if(z.material.alphaMode!=="BLEND"){A.push({mesh:z,depth:0,modelIndex:x,worldViewProjection:O,nodeModelMatrix:I});continue}const k=n.af([],z.centroid,O);!g.isOrthographic&&k[2]<=0||w.push({mesh:z,depth:k[2],modelIndex:x,worldViewProjection:O,nodeModelMatrix:I})}if(i.children)for(const z of i.children)ud(g,z,c,p,x,w,A)}function ch(g,i,c,p){const x=c.shadowRenderer;if(!x)return;const w=x.getShadowPassDepthMode(),A=x.getShadowPassColorMode(),I=x.calculateShadowPassMatrixFromMatrix(i),O=Di(I);c.getOrCreateProgram("modelDepth",{defines:c._shadowMapDebug?[]:["DEPTH_TEXTURE"]}).draw(c,c.context.gl.TRIANGLES,w,vr.disabled,A,Tr.backCCW,O,p.id,g.vertexBuffer,g.indexBuffer,g.segments,p.paint,c.transform.zoom,void 0,void 0)}function Dm(g,i,c){const p=i.updateZoomBasedPaintProperties(),x=(function(w,A,I){let O,z,k,H=w.terrain?w.terrain.exaggeration():0;if(w.terrain&&H>0){const V=w.terrain,X=V.findDEMTileFor(I);X&&X.dem?O=n.ew.create(V,I,X):H=0}if(H===0&&(A.terrainElevationMin=0,A.terrainElevationMax=0),H===A.validForExaggeration&&(H===0||O&&O._demTile&&O._demTile.tileID===A.validForDEMTile.id&&O._dem._timestamp===A.validForDEMTile.timestamp))return!1;for(const V in A.instancesPerModel){const X=A.instancesPerModel[V];for(let Y=0;Y<X.instancedDataArray.length;++Y){const W=(O?H*O.getElevationAt(0|X.instancedDataArray.float32[16*Y],0|X.instancedDataArray.float32[16*Y+1],!0,!0):0)+X.instancesEvaluatedElevation[Y];X.instancedDataArray.float32[16*Y+6]=W,z=z?Math.min(A.terrainElevationMin,W):W,k=k?Math.max(A.terrainElevationMax,W):W}}return A.terrainElevationMin=z||0,A.terrainElevationMax=k||0,A.validForExaggeration=H,A.validForDEMTile=O&&O._demTile?{id:O._demTile.tileID,timestamp:O._dem._timestamp}:{id:void 0,timestamp:0},!0})(g,i,c);(p||x)&&(i.uploaded=!1,i.upload(g.context))}const Os={shadowUniformsInitialized:!1,useSingleShadowCascade:!1,tileMatrix:new Float64Array(16),shadowTileMatrix:new Float32Array(16),aabb:new n.d8([0,0,0],[n.al,n.al,0])};function _u(g,i){const c=1<<g.canonical.z,p=i.getFreeCameraOptions().position,x=i.elevation,w=g.canonical.x/c,A=(g.canonical.x+1)/c,I=g.canonical.y/c,O=(g.canonical.y+1)/c;let z=i._centerAltitude;if(x){const X=x.getMinMaxForTile(g);X&&X.max>z&&(z=X.max)}const k=n.aA(p.x,w,A)-p.x,H=n.aA(p.y,I,O)-p.y,V=n.ce(z,i.center.lat)-p.z;return i._zoomFromMercatorZ(Math.sqrt(k*k+H*H+V*V))}function Om(g,i,c,p,x,w,A){const I=g.context,O=g.renderPass==="shadow",z=g.shadowRenderer,k=O&&z?z.getShadowPassDepthMode():new qt(I.gl.LEQUAL,qt.ReadWrite,g.depthRangeFor3D),H=g.isTileAffectedByFog(w);if(c.meshes)for(const V of c.meshes){const X=["MODEL_POSITION_ON_GPU"],Y=[];let W,re,K;p.instancedDataArray.length>20&&X.push("INSTANCED_ARRAYS");const ae=Qc(g,i.paint.get("model-cutoff-fade-range"));if(ae.shouldRenderCutoff&&X.push("RENDER_CUTOFF"),O&&z)W=g.getOrCreateProgram("modelDepth",{defines:X}),re=Di(A.shadowTileMatrix,A.shadowTileMatrix,Float32Array.from(c.matrix)),K=z.getShadowPassColorMode();else{cd(X,Y,V,g,i.paint.get("model-color-use-theme").constantOr("default")==="none"?null:i.lut),W=g.getOrCreateProgram("model",{defines:X,overrideFog:H});const fe=V.material,xe=fe.pbrMetallicRoughness,ge=i.paint.get("model-opacity").constantOr(1),Te=i.paint.get("model-emissive-strength").constantOr(0);re=el(w.expandedProjMatrix,Float32Array.from(c.matrix),new Float32Array(16),null,g,ge,xe.baseColorFactor,fe.emissiveFactor,xe.metallicFactor,xe.roughnessFactor,fe,Te,i,x),z&&(A.shadowUniformsInitialized?W.setShadowUniformValues(I,z.getShadowUniformValues()):(z.setupShadows(w.toUnwrapped(),W,"model-tile"),A.shadowUniformsInitialized=!0)),K=ae.shouldRenderCutoff||ge<1||fe.alphaMode!=="OPAQUE"?kr.alphaBlended:kr.unblended}g.uploadCommonUniforms(I,W,w.toUnwrapped(),null,ae);const ue=V.material.doubleSided?Tr.disabled:Tr.backCCW;if(p.instancedDataArray.length>20)Y.push(p.instancedDataBuffer),W.draw(g,I.gl.TRIANGLES,k,vr.disabled,K,ue,re,i.id,V.vertexBuffer,V.indexBuffer,V.segments,i.paint,g.transform.zoom,void 0,Y,p.instancedDataArray.length);else{const fe=O?"u_instance":"u_normal_matrix";for(let xe=0;xe<p.instancedDataArray.length;++xe)re[fe]=new Float32Array(p.instancedDataArray.arrayBuffer,64*xe,16),W.draw(g,I.gl.TRIANGLES,k,vr.disabled,K,ue,re,i.id,V.vertexBuffer,V.indexBuffer,V.segments,i.paint,g.transform.zoom,void 0,Y)}}if(c.children)for(const V of c.children)Om(g,i,V,p,x,w,A)}const Fg=[1,-1,1];function kg(g,i,c,p){if(!c.modelManager)return!0;const x=c.modelManager;if(!c.shadowRenderer)return!0;const w=c.shadowRenderer,A=i.aabb;let I=!0,O=g.maxHeight;if(O===0){let k=0;for(const H in g.instancesPerModel){const V=x.getModel(H,p);V?k=Math.max(k,Math.max(Math.max(V.aabb.max[0],V.aabb.max[1]),V.aabb.max[2])):I=!1}O=g.maxScale*k*1.41+g.maxVerticalOffset,I&&(g.maxHeight=O)}A.max[2]=O,A.min[2]+=g.terrainElevationMin,A.max[2]+=g.terrainElevationMax,n.af(A.min,A.min,i.tileMatrix),n.af(A.max,A.max,i.tileMatrix);const z=A.intersects(w.getCurrentCascadeFrustum());return c.currentShadowCascade===0&&(g.isInsideFirstShadowMapFrustum=z===2),z===0}function rf(g,i){const c=g.uniformValues.u_cutoff_params[0],p=g.uniformValues.u_cutoff_params[1],x=g.uniformValues.u_cutoff_params[2],w=g.uniformValues.u_cutoff_params[3];return p===c||w===x?1:n.aA(((i-c)/(p-c)-x)/(w-x),0,1)}function yp(g,i,c,p){if(i.pitch<20)return 1;const x=i.getWorldToCameraMatrix();n.aB(x,x,g);const w=n.bU(c.min[0],c.min[1],c.min[2],1);let A=n.aC(n.ex(),w,x),I=A,O=A;w[1]=c.max[1],A=n.aC(n.ex(),w,x),I=A[1]<I[1]?A:I,O=A[1]>O[1]?A:O,w[0]=c.max[0],A=n.aC(n.ex(),w,x),I=A[1]<I[1]?A:I,O=A[1]>O[1]?A:O,w[1]=c.min[1],A=n.aC(n.ex(),w,x),I=A[1]<I[1]?A:I,O=A[1]>O[1]?A:O;const z=n.aA(p[0],0,1),k=100*i.pixelsPerMeter*n.aA(p[1],0,1),H=n.aA(p[2],0,1),V=n.ey(n.ex(),I,O,z),X=Math.tan(.5*i.fovX),Y=-V[2]*X;if(k===0)return V[1]<-Math.abs(Y)?H:1;const W=(-Math.abs(Y)-V[1])/k,re=(ae,ue,fe)=>(1-fe)*ae+fe*ue,K=n.aA(re(1,H,W),H,1);return re(1,K,n.aA((i.pitch-20)/20,0,1))}class Pm{}class vp{constructor(){this._storage=new Map}getLinesFromTrianglesBuffer(i,c,p){{const H=this._storage.get(c.id);if(H)return H.lastUsedFrameIdx=i,H.buf}const x=p.gl,w=x.getBufferParameter(x.ELEMENT_ARRAY_BUFFER,x.BUFFER_SIZE),A=new ArrayBuffer(w),I=new Int16Array(A);x.getBufferSubData(x.ELEMENT_ARRAY_BUFFER,0,new Int16Array(A));const O=new n.eA;for(let H=0;H<w/2;H+=3){const V=I[H],X=I[H+1],Y=I[H+2];O.emplaceBack(V,X),O.emplaceBack(X,Y),O.emplaceBack(Y,V)}const z=p.bindVertexArrayOES.current,k=new Pm;return k.buf=new Vn(p,O),k.lastUsedFrameIdx=i,this._storage.set(c.id,k),p.bindVertexArrayOES.set(z),k.buf}update(i){for(const[c,p]of this._storage)i-p.lastUsedFrameIdx>30&&(p.buf.destroy(),this._storage.delete(c))}destroy(){for(const[i,c]of this._storage)c.buf.destroy(),this._storage.delete(i)}}class hd{constructor(i){this.occluderSize=30,this.depthOffset=-1e-4,i.registerParameter(this,["Occlusion"],"occluderSize",{min:1,max:100,step:1}),i.registerParameter(this,["Occlusion"],"depthOffset",{min:-.05,max:0,step:1e-5})}}const nf=n.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_rainParticleData",components:4}]);class of{registerParameter(){}registerButton(){}registerBinding(){}refreshUI(){}}class Lm{constructor(i,c){this.revealStart=11,this.revealRange=2,i.registerParameter(this,[...c,"Reveal"],"revealStart",{min:0,max:17,step:.05}),i.registerParameter(this,[...c,"Reveal"],"revealRange",{min:.1,max:5.1,step:.05})}}const Bm=n.ef([{type:"Float32",name:"a_pos_2f",components:2}]);class fd{destroy(){this.vignetteVx&&this.vignetteVx.destroy(),this.vignetteIdx&&this.vignetteIdx.destroy()}draw(i,c){const p=i.getOrCreateProgram("vignette");if(!this.vignetteVx||!this.vignetteIdx){const A=new n.eB,I=new n.b1;A.emplaceBack(-1,-1),A.emplaceBack(1,-1),A.emplaceBack(1,1),A.emplaceBack(-1,1),I.emplaceBack(0,1,2),I.emplaceBack(0,2,3),this.vignetteVx=i.context.createVertexBuffer(A,Bm.members),this.vignetteIdx=i.context.createIndexBuffer(I)}const x=n.bg.simpleSegment(0,0,4,6);if(this.vignetteVx&&this.vignetteIdx){i.uploadCommonUniforms(i.context,p);const A={u_vignetteShape:(w={vignetteShape:[c.start,c.range,Math.pow(10,c.fadePower)],vignetteColor:[c.color.r,c.color.g,c.color.b,c.color.a*c.strength]}).vignetteShape,u_vignetteColor:w.vignetteColor};p.draw(i,i.context.gl.TRIANGLES,qt.disabled,vr.disabled,kr.alphaBlended,Tr.disabled,A,"vignette",this.vignetteVx,this.vignetteIdx,x)}var w}}class xp{constructor(){this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0}update(i,c){const p=i.getFreeCameraOptions().position,x=p.toAltitude(),w=p.toLngLat(),A=n.an(w.lng),I=n.an(w.lat),O=i.pixelsPerMeter/c,z=A*n.eD,k=n.eD*Math.log(Math.tan(Math.PI/4+I/2));if(this._offsetXPrev===void 0)this._offsetXPrev=0,this._offsetYPrev=0,this._elevationPrev=0,this._accumulatedOffsetX=0,this._accumulatedOffsetY=0,this._accumulatedElevation=0;else{const H=-this._offsetYPrev+k,V=-this._elevationPrev+x;this._accumulatedOffsetX+=(-this._offsetXPrev+z)*O,this._accumulatedOffsetY+=H*O,this._accumulatedElevation+=V*O,this._offsetXPrev=z,this._offsetYPrev=k,this._elevationPrev=x}}getPosition(){return[this._accumulatedOffsetX,this._accumulatedOffsetY,this._accumulatedElevation]}}function dd(g,i){return[-(g[0]-Math.floor(g[0]/i)*i),-(g[1]-Math.floor(g[1]/i)*i),-(g[2]-Math.floor(g[2]/i)*i)]}function Go(g){const i=n.eo(1323123451230),c=[];for(let p=0;p<g;++p){const x=2*i()-1,w=2*i()-1,A=2*i()-1;c.push(n.d4(x,w,A))}return c}function Cc(g,i,c,p,x){const w=n.aA((x-c)/(p-c),0,1);return(1-w)*g+w*i}class Ic{constructor(i){this._movement=new xp,this._accumulatedTimeFromStart=0,this._prevTime=Date.now()/1e3,this._vignette=new fd,this._ppmScaleFactor=i}destroy(){this.particlesVx&&this.particlesVx.destroy(),this.particlesIdx&&this.particlesIdx.destroy(),this._vignette&&this._vignette.destroy()}updateOnRender(i,c){const p=i.transform;this._movement.update(p,this._ppmScaleFactor);const x=p.starsProjMatrix,w=n.c6([]);n.c8(w,w,n.an(90)-p._pitch),n.c7(w,w,-p.angle);const A=n.cb(new Float32Array(16),w),I=n.eC(1,0,0,0,0,0,1,0,0,-1,0,0,0,0,0,1),O=n.ed([],I),z=n.aB([],O,A),k=Date.now()/1e3;return this._accumulatedTimeFromStart+=(k-this._prevTime)*c,this._prevTime=k,{projectionMatrix:x,modelviewMatrix:z}}}class Yi extends Ic{constructor(i){super(4.25),this._params={overrideStyleParameters:!1,intensity:.5,timeFactor:1,velocityConeAperture:0,velocity:300,boxSize:2500,dropletSizeX:1,dropletSizeYScale:10,distortionStrength:70,screenThinning:{intensity:.57,start:.46,range:1.17,fadePower:.17,affectedRatio:1,particleOffset:-.2},color:{r:.66,g:.68,b:.74,a:.7},direction:{x:-50,y:-35},shapeDirPower:2,shapeNormalPower:1},this._revealParams=new Lm(i.tp,["Precipitation","Rain"]),this._vignetteParams={strength:1,start:.7,range:1,fadePower:.4,color:{r:.27,g:.27,b:.27,a:1}},this.particlesCount=16e3}update(i){const c=i.context;if(!this.particlesVx){const p=Go(this.particlesCount),x=new n.eE,w=new n.b1;let A=0;const I=n.eo(1323123451230);for(let O=0;O<p.length;++O){const z=p[O],k=[2*I()-1,I(),I(),I()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...k),x.emplaceBack(z[0],z[1],z[2],1,-1,...k),x.emplaceBack(z[0],z[1],z[2],1,1,...k),x.emplaceBack(z[0],z[1],z[2],-1,1,...k),w.emplaceBack(A+0,A+1,A+2),w.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=c.createVertexBuffer(x,nf.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.rain)return;const c=this._params.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},p=i.transform.zoom;if(c.revealStart>p)return;const x=Cc(0,1,c.revealStart,c.revealStart+c.revealRange,p);if(!this.particlesVx||!this.particlesIdx)return;const w=structuredClone(this._params);let A=[-w.direction.x,w.direction.y,-100];n.aw(A,A);const I=structuredClone(this._vignetteParams);I.strength*=x,w.overrideStyleParameters||(w.intensity=i.style.rain.state.density,w.timeFactor=i.style.rain.state.intensity,w.color=structuredClone(i.style.rain.state.color),A=structuredClone(i.style.rain.state.direction),w.screenThinning.intensity=i.style.rain.state.centerThinning,w.dropletSizeX=i.style.rain.state.dropletSize[0],w.dropletSizeYScale=i.style.rain.state.dropletSize[1]/i.style.rain.state.dropletSize[0],w.distortionStrength=100*i.style.rain.state.distortionStrength,I.strength=1,I.color=structuredClone(i.style.rain.state.vignetteColor));const O=this.updateOnRender(i,w.timeFactor),z=i.context,k=z.gl,H=i.transform;this.screenTexture&&this.screenTexture.size[0]===i.width&&this.screenTexture.size[1]===i.height||(this.screenTexture=new n.T(z,{width:i.width,height:i.height,data:null},k.RGBA8)),w.distortionStrength>0&&(z.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE),k.copyTexSubImage2D(k.TEXTURE_2D,0,0,0,0,0,i.width,i.height));const V=i.getOrCreateProgram("rainParticle");i.uploadCommonUniforms(z,V),z.activeTexture.set(k.TEXTURE0),this.screenTexture.bind(k.LINEAR,k.CLAMP_TO_EDGE);const X=[w.color.r,w.color.g,w.color.b,w.color.a],Y=(W,re)=>{const K=dd(this._movement.getPosition(),W),ae=w.dropletSizeX,ue=w.dropletSizeX*w.dropletSizeYScale,fe=i.width/2,xe=i.height/2,ge=Cc(0,w.screenThinning.start,0,1,w.screenThinning.intensity),Te=Cc(.001,w.screenThinning.range,0,1,w.screenThinning.intensity),ye=Cc(0,w.screenThinning.particleOffset,0,1,w.screenThinning.intensity),_e=(Se={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:K,velocityConeAperture:w.velocityConeAperture,velocity:w.velocity,boxSize:W,rainDropletSize:[ae,ue],distortionStrength:w.distortionStrength,rainDirection:A,color:X,screenSize:[H.width,H.height],thinningCenterPos:[fe,xe],thinningShape:[ge,Te,Math.pow(10,w.screenThinning.fadePower)],thinningAffectedRatio:w.screenThinning.affectedRatio,thinningParticleOffset:ye,shapeDirectionalPower:w.shapeDirPower,shapeNormalPower:w.shapeNormalPower,mode:re?0:1},{u_modelview:Float32Array.from(Se.modelview),u_projection:Float32Array.from(Se.projection),u_time:Se.time,u_cam_pos:Se.camPos,u_texScreen:0,u_velocityConeAperture:Se.velocityConeAperture,u_velocity:Se.velocity,u_boxSize:Se.boxSize,u_rainDropletSize:Se.rainDropletSize,u_distortionStrength:Se.distortionStrength,u_rainDirection:Se.rainDirection,u_color:Se.color,u_screenSize:Se.screenSize,u_thinningCenterPos:Se.thinningCenterPos,u_thinningShape:Se.thinningShape,u_thinningAffectedRatio:Se.thinningAffectedRatio,u_thinningParticleOffset:Se.thinningParticleOffset,u_shapeDirectionalPower:Se.shapeDirectionalPower,u_shapeNormalPower:Se.shapeNormalPower,u_mode:Se.mode});var Se;const He=Math.round(w.intensity*this.particlesCount),ze=n.bg.simpleSegment(0,0,4*He,2*He);V.draw(i,k.TRIANGLES,qt.disabled,vr.disabled,kr.alphaBlended,Tr.disabled,_e,"rain_particles",this.particlesVx,this.particlesIdx,ze)};w.distortionStrength>0&&Y(w.boxSize,!0),Y(w.boxSize,!1),this._vignette.draw(i,I)}}const ei=n.ef([{type:"Float32",name:"a_pos_3f",components:3},{type:"Float32",name:"a_uv",components:2},{type:"Float32",name:"a_snowParticleData",components:4},{type:"Float32",name:"a_snowParticleDataHorizontalOscillation",components:2}]);class Ng extends Ic{constructor(i){super(2.25),this._params={overrideStyleParameters:!1,intensity:.85,timeFactor:.75,velocityConeAperture:70,velocity:40,horizontalOscillationRadius:4,horizontalOscillationRate:1.5,boxSize:2e3,billboardSize:2,shapeFadeStart:.27,shapeFadePower:.21,screenThinning:{intensity:.4,start:.15,range:1.4,fadePower:.24,affectedRatio:1,particleOffset:-.2},color:{r:1,g:1,b:1,a:1},direction:{x:-50,y:-35}},this._revealParams=new Lm(i.tp,["Precipitation","Snow"]),this._vignetteParams={strength:.3,start:.78,range:.46,fadePower:.2,color:{r:1,g:1,b:1,a:1}},this.particlesCount=16e3}update(i){const c=i.context;if(!this.particlesVx){const p=Go(this.particlesCount),x=new n.eF,w=new n.b1;let A=0;const I=n.eo(1323123451230);for(let O=0;O<p.length;++O){const z=p[O],k=I(),H=I(),V=I(),X=[O/p.length,k,H,V],Y=[I(),I()];x.emplaceBack(z[0],z[1],z[2],-1,-1,...X,...Y),x.emplaceBack(z[0],z[1],z[2],1,-1,...X,...Y),x.emplaceBack(z[0],z[1],z[2],1,1,...X,...Y),x.emplaceBack(z[0],z[1],z[2],-1,1,...X,...Y),w.emplaceBack(A+0,A+1,A+2),w.emplaceBack(A+0,A+2,A+3),A+=4}this.particlesVx=c.createVertexBuffer(x,ei.members),this.particlesIdx=c.createIndexBuffer(w)}}draw(i){if(!this._params.overrideStyleParameters&&!i.style.snow)return;const c=structuredClone(this._params);let p=[-c.direction.x,c.direction.y,-100];n.aw(p,p);const x=structuredClone(this._vignetteParams),w=c.overrideStyleParameters?this._revealParams:{revealStart:0,revealRange:.01},A=i.transform.zoom;if(w.revealStart>A)return;const I=Cc(0,1,w.revealStart,w.revealStart+w.revealRange,A);x.strength*=I,c.overrideStyleParameters||(c.intensity=i.style.snow.state.density,c.timeFactor=i.style.snow.state.intensity,c.color=structuredClone(i.style.snow.state.color),p=structuredClone(i.style.snow.state.direction),c.screenThinning.intensity=i.style.snow.state.centerThinning,c.billboardSize=2.79*i.style.snow.state.flakeSize,x.strength=1,x.color=structuredClone(i.style.snow.state.vignetteColor));const O=this.updateOnRender(i,c.timeFactor);if(!this.particlesVx||!this.particlesIdx)return;const z=i.context,k=z.gl,H=i.transform,V=i.getOrCreateProgram("snowParticle");i.uploadCommonUniforms(z,V),((X,Y,W)=>{const re=dd(this._movement.getPosition(),X),K=H.width/2,ae=H.height/2,ue=Cc(0,W.screenThinning.start,0,1,W.screenThinning.intensity),fe=Cc(.001,W.screenThinning.range,0,1,W.screenThinning.intensity),xe=Cc(0,W.screenThinning.particleOffset,0,1,W.screenThinning.intensity),ge=(Te={modelview:O.modelviewMatrix,projection:O.projectionMatrix,time:this._accumulatedTimeFromStart,camPos:re,velocityConeAperture:W.velocityConeAperture,velocity:W.velocity,horizontalOscillationRadius:W.horizontalOscillationRadius,horizontalOscillationRate:W.horizontalOscillationRate,boxSize:X,billboardSize:1*W.billboardSize,simpleShapeParameters:[W.shapeFadeStart,W.shapeFadePower],screenSize:[H.width,H.height],thinningCenterPos:[K,ae],thinningShape:[ue,fe,Math.pow(10,W.screenThinning.fadePower)],thinningAffectedRatio:W.screenThinning.affectedRatio,thinningParticleOffset:xe,color:[W.color.r,W.color.g,W.color.b,W.color.a],direction:p},{u_modelview:Float32Array.from(Te.modelview),u_projection:Float32Array.from(Te.projection),u_time:Te.time,u_cam_pos:Te.camPos,u_velocityConeAperture:Te.velocityConeAperture,u_velocity:Te.velocity,u_horizontalOscillationRadius:Te.horizontalOscillationRadius,u_horizontalOscillationRate:Te.horizontalOscillationRate,u_boxSize:Te.boxSize,u_billboardSize:Te.billboardSize,u_simpleShapeParameters:Te.simpleShapeParameters,u_screenSize:Te.screenSize,u_thinningCenterPos:Te.thinningCenterPos,u_thinningShape:Te.thinningShape,u_thinningAffectedRatio:Te.thinningAffectedRatio,u_thinningParticleOffset:Te.thinningParticleOffset,u_particleColor:Te.color,u_direction:Te.direction});var Te;const ye=Math.round(W.intensity*this.particlesCount),_e=n.bg.simpleSegment(0,0,4*ye,2*ye);this.particlesVx&&this.particlesIdx&&V.draw(i,k.TRIANGLES,qt.disabled,vr.disabled,kr.alphaBlended,Tr.disabled,ge,"snow_particles",this.particlesVx,this.particlesIdx,_e)})(c.boxSize,0,c),this._vignette.draw(i,x)}}const ss={symbol:function(g,i,c,p,x){if(g.renderPass!=="translucent")return;const w=vr.disabled,A=g.colorModeForRenderPass(),I=c.layout.get("text-variable-anchor"),O=c.layout.get("text-size-scale-range"),z=n.aA(g.scaleFactor,O[0],O[1]);I&&(function(V,X,Y,W,re,K,ae,ue){const fe=X.transform,xe=re==="map",ge=K==="map";for(const Te of V){const ye=W.getTile(Te),_e=ye.getBucket(Y);if(!_e||!_e.text||!_e.text.segments.get().length)continue;const Se=n.bK(_e.textSizeData,fe.zoom,ue),He=es(Te,_e.getProjection(),fe),ze=fe.calculatePixelsToTileUnitsMatrix(ye),nt=ts(He,ye.tileID.canonical,ge,xe,fe,_e.getProjection(),ze),Ge=_e.hasIconTextFit()&&_e.hasIconData();Se&&Kh(_e,xe,ge,ae,fe,nt,Te,Math.pow(2,fe.zoom-ye.tileID.overscaledZ),Se,Ge)}})(p,g,c,i,c.layout.get("text-rotation-alignment"),c.layout.get("text-pitch-alignment"),x,z);const k=c.paint.get("icon-opacity").constantOr(1)!==0,H=c.paint.get("text-opacity").constantOr(1)!==0;c.layout.get("symbol-sort-key").constantOr(1)!==void 0&&(k||H)?Jh(g,i,c,p,w,A):(k&&Jh(g,i,c,p,w,A,{onlyIcons:!0}),H&&Jh(g,i,c,p,w,A,{onlyText:!0})),i.map.showCollisionBoxes&&(Rl(g,i,c,p,c.paint.get("text-translate"),c.paint.get("text-translate-anchor"),!0),Rl(g,i,c,p,c.paint.get("icon-translate"),c.paint.get("icon-translate-anchor"),!1))},circle:function(g,i,c,p){if(g.renderPass!=="translucent")return;const x=c.paint.get("circle-opacity"),w=c.paint.get("circle-stroke-width"),A=c.paint.get("circle-stroke-opacity"),I=c.layout.get("circle-sort-key").constantOr(1)!==void 0,O=c.paint.get("circle-emissive-strength");if(x.constantOr(1)===0&&(w.constantOr(1)===0||A.constantOr(1)===0))return;const z=g.context,k=z.gl,H=g.transform,V=!(!g.terrain||!g.terrain.enabled),X=c.layout.get("circle-elevation-reference"),Y=g.depthModeForSublayer(0,qt.ReadOnly),W=new qt(g.context.gl.LEQUAL,qt.ReadOnly,g.depthRangeFor3D),re=X==="none"||V?Y:W,K=vr.disabled,ae=g.colorModeForDrapableLayerRenderPass(O),ue=H.projection.name==="globe",fe=[n.aF(H.center.lng),n.aJ(H.center.lat)],xe=[];for(let Te=0;Te<p.length;Te++){const ye=p[Te],_e=i.getTile(ye),Se=_e.getBucket(c);if(!Se||Se.projection.name!==H.projection.name)continue;const He=Se.programConfigurations.get(c.id),ze=Se.layoutVertexBuffer,nt=Se.globeExtVertexBuffer,Ge=Se.indexBuffer,tt=n.dZ(c),It=[nt],qe=g.isTileAffectedByFog(ye);ue&&tt.push("PROJECTION_GLOBE_VIEW"),tt.push("DEPTH_D24"),g.terrain&&H.depthOcclusionForSymbolsAndCircles&&tt.push("DEPTH_OCCLUSION"),Se.hasElevation&&!g.terrain&&(tt.push("ELEVATED_ROADS"),It.push(Se.elevatedLayoutVertexBuffer));const Oe=g.getOrCreateProgram("circle",{config:He,defines:tt,overrideFog:qe}),ot=H.projection.createInversionMatrix(H,ye.canonical),je={programConfiguration:He,program:Oe,layoutVertexBuffer:ze,dynamicBuffers:It,indexBuffer:Ge,uniformValues:n.d_(g,ye,_e,ot,fe,c),tile:_e};if(I){const at=Se.segments.get();for(const ht of at)xe.push({segments:new n.bg([ht]),sortKey:ht.sortKey,state:je})}else xe.push({segments:Se.segments,sortKey:0,state:je})}I&&xe.sort(((Te,ye)=>Te.sortKey-ye.sortKey));const ge={useDepthForOcclusion:H.depthOcclusionForSymbolsAndCircles};for(const Te of xe){const{programConfiguration:ye,program:_e,layoutVertexBuffer:Se,dynamicBuffers:He,indexBuffer:ze,uniformValues:nt,tile:Ge}=Te.state,tt=Te.segments;g.terrain&&g.terrain.setupElevationDraw(Ge,_e,ge),g.uploadCommonUniforms(z,_e,Ge.tileID.toUnwrapped()),_e.draw(g,k.TRIANGLES,re,K,ae,Tr.disabled,nt,c.id,Se,ze,tt,c.paint,H.zoom,ye,He)}},heatmap:function(g,i,c,p){if(c.paint.get("heatmap-opacity")!==0)if(g.renderPass==="offscreen"){const x=g.context,w=x.gl,A=vr.disabled,I=new kr([w.ONE,w.ONE,w.ONE,w.ONE],n.ao.transparent,[!0,!0,!0,!0]);(function(X,Y,W,re){const K=X.gl,ae=Y.width*re,ue=Y.height*re;X.activeTexture.set(K.TEXTURE1),X.viewport.set([0,0,ae,ue]);let fe=W.heatmapFbo;if(!fe||fe&&(fe.width!==ae||fe.height!==ue)){fe&&fe.destroy();const xe=K.createTexture();K.bindTexture(K.TEXTURE_2D,xe),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_S,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_WRAP_T,K.CLAMP_TO_EDGE),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MIN_FILTER,K.LINEAR),K.texParameteri(K.TEXTURE_2D,K.TEXTURE_MAG_FILTER,K.LINEAR),fe=W.heatmapFbo=X.createFramebuffer(ae,ue,!0,null),(function(ge,Te,ye,_e,Se,He){const ze=ge.gl;ze.texImage2D(ze.TEXTURE_2D,0,ge.extRenderToTextureHalfFloat?ze.RGBA16F:ze.RGBA,Se,He,0,ze.RGBA,ge.extRenderToTextureHalfFloat?ze.HALF_FLOAT:ze.UNSIGNED_BYTE,null),_e.colorAttachment.set(ye)})(X,0,xe,fe,ae,ue)}else K.bindTexture(K.TEXTURE_2D,fe.colorAttachment.get()),X.bindFramebuffer.set(fe.framebuffer)})(x,g,c,g.transform.projection.name==="globe"?.5:.25),x.clear({color:n.ao.transparent});const O=g.transform,z=O.projection.name==="globe",k=z?["PROJECTION_GLOBE_VIEW"]:[],H=z?Tr.frontCCW:Tr.disabled,V=[n.aF(O.center.lng),n.aJ(O.center.lat)];for(let X=0;X<p.length;X++){const Y=p[X];if(i.hasRenderableParent(Y))continue;const W=i.getTile(Y),re=W.getBucket(c);if(!re||re.projection.name!==O.projection.name)continue;const K=g.isTileAffectedByFog(Y),ae=re.programConfigurations.get(c.id),ue=g.getOrCreateProgram("heatmap",{config:ae,defines:k,overrideFog:K}),{zoom:fe}=g.transform;g.terrain&&g.terrain.setupElevationDraw(W,ue),g.uploadCommonUniforms(x,ue,Y.toUnwrapped());const xe=O.projection.createInversionMatrix(O,Y.canonical);ue.draw(g,w.TRIANGLES,qt.disabled,A,I,H,bc(g,Y,W,xe,V,fe,c.paint.get("heatmap-intensity")),c.id,re.layoutVertexBuffer,re.indexBuffer,re.segments,c.paint,g.transform.zoom,ae,z?[re.globeExtVertexBuffer]:null)}x.viewport.set([0,0,g.width,g.height])}else g.renderPass==="translucent"&&(g.context.setColorMode(g.colorModeForRenderPass()),(function(x,w){const A=x.context,I=A.gl,O=w.heatmapFbo;if(!O)return;A.activeTexture.set(I.TEXTURE0),I.bindTexture(I.TEXTURE_2D,O.colorAttachment.get()),A.activeTexture.set(I.TEXTURE1);let z=w.colorRampTexture;z||(z=w.colorRampTexture=new n.T(A,w.colorRamp,I.RGBA8)),z.bind(I.LINEAR,I.CLAMP_TO_EDGE),x.getOrCreateProgram("heatmapTexture").draw(x,I.TRIANGLES,qt.disabled,vr.disabled,x.colorModeForRenderPass(),Tr.disabled,((k,H,V,X)=>({u_image:0,u_color_ramp:1,u_opacity:H.paint.get("heatmap-opacity")}))(0,w),w.id,x.viewportBuffer,x.quadTriangleIndexBuffer,x.viewportSegments,w.paint,x.transform.zoom)})(g,c))},line:function(g,i,c,p){if(g.renderPass!=="translucent")return;const x=c.paint.get("line-opacity"),w=c.paint.get("line-width");if(x.constantOr(1)===0||w.constantOr(1)===0)return;const A=c.paint.get("line-emissive-strength"),I=c.paint.get("line-occlusion-opacity"),O=c.layout.get("line-elevation-reference"),z=c.layout.get("line-width-unit")==="meters",k=O==="sea",H=!(!g.terrain||!g.terrain.enabled),V=g.context,X=V.gl;if(c.hasElevatedBuckets&&g.transform.projection.name==="globe")return;const Y=c.layout.get("line-cross-slope"),W=Y!==void 0,re=Y<1,K=g.colorModeForDrapableLayerRenderPass(A),ae=g.terrain&&g.terrain.renderingToTexture,ue=ae?1:n.o.devicePixelRatio,fe=c.paint.get("line-dasharray"),xe=fe.constantOr(1),ge=c.layout.get("line-cap"),Te=fe.constantOr(null),ye=ge.constantOr(null),_e=c.paint.get("line-pattern"),Se=_e.constantOr(1),He=c.paint.get("line-pattern-cross-fade"),ze=_e.constantOr(null),nt=c.paint.get("line-opacity").constantOr(1);let Ge=!Se&&nt!==1||g.depthOcclusion&&I>0&&I<1;const tt=c.paint.get("line-gradient"),It=Se?"linePattern":"line",qe=n.d$(c);let Oe;if(ae&&g.terrain&&g.terrain.clipOrMaskOverlapStencilType()&&(Ge=!1),I!==0&&g.depthOcclusion){const ht=c.paint._values["line-opacity"];ht&&ht.value&&ht.value.kind==="constant"?Oe=ht.value:n.w(`Occlusion opacity for layer ${c.id} is supported only when line-opacity isn't data-driven.`)}w.value.kind!=="constant"&&w.value.isLineProgressConstant===!1&&qe.push("VARIABLE_LINE_WIDTH");const ot=(ht,wt,ft,pt,rr,tr)=>{for(const or of ht){const Qt=i.getTile(or);if(Se&&!Qt.patternsLoaded())continue;const fr=Qt.getBucket(c);if(!fr||fr.elevationType!=="none"&&!rr||fr.elevationType==="none"&&rr)continue;g.prepareDrawTile();const Mr=[...wt],Or=g.shadowRenderer,Si=fr.elevationType==="road"&&!!Or&&Or.enabled;let wr=[0,0,0];if(Si){const Pr=g.style.directionalLight,br=g.style.ambientLight;Pr&&br&&(wr=Ts(g.style,Pr,br)),Mr.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET")}const ii=fr.programConfigurations.get(c.id);let hi=!1;if(ze&&Qt.imageAtlas){const Pr=n.e0.from(ze),br=Pr.getPrimary().scaleSelf(ue).toString(),Ti=Qt.imageAtlas.patternPositions.get(br),vn=Pr.getSecondary(),Xi=vn?Qt.imageAtlas.patternPositions.get(vn.scaleSelf(ue).toString()):null;hi=!!Ti&&!!Xi,Ti&&ii.setConstantPatternPositions(Ti,Xi)}He>0&&(hi||ii.getPatternTransitionVertexBuffer("line-pattern"))&&Mr.push("LINE_PATTERN_TRANSITION");const _i=g.isTileAffectedByFog(or),Lr=g.getOrCreateProgram(It,{config:ii,defines:Mr,overrideFog:_i});if(!Se&&Te&&ye&&Qt.lineAtlas){const Pr=Qt.lineAtlas.getDash(Te,ye);Pr&&ii.setConstantPatternPositions(Pr)}Si&&Or.setupShadows(Qt.tileID.toUnwrapped(),Lr,"vector-tile");let[fi,li]=c.paint.get("line-trim-offset");(ye==="round"||ye==="square")&&fi!==li&&(fi===0&&(fi-=1),li===1&&(li+=1));const di=ae?or.projMatrix:null,Fi=z?1/fr.tileToMeter/n.ay(Qt,1,g.transform.zoom):1,Ii=z?1/fr.tileToMeter/n.ay(Qt,1,Math.floor(g.transform.zoom)):1,In=Se?n.e1(g,Qt,c,di,ue,Fi,Ii,[fi,li],wr,He):n.e2(g,Qt,c,di,fr.lineClipsArray.length,ue,Fi,Ii,[fi,li],wr);if(tt){const Pr=fr.gradients[c.id];let br=Pr.texture;if(c.gradientVersion!==Pr.version){let Ti=256;if(c.stepInterpolant){const vn=i.getSource().maxzoom,Xi=or.canonical.z===vn?Math.ceil(1<<g.transform.maxZoom-or.canonical.z):1;Ti=n.aA(n.e3(fr.maxLineLength/n.al*1024*Xi),256,V.maxTextureSize)}Pr.gradient=n.e4({expression:c.gradientExpression(),evaluationKey:"lineProgress",resolution:Ti,image:Pr.gradient||void 0,clips:fr.lineClipsArray}),Pr.texture?Pr.texture.update(Pr.gradient):Pr.texture=new n.T(V,Pr.gradient,X.RGBA8),Pr.version=c.gradientVersion,br=Pr.texture}V.activeTexture.set(X.TEXTURE1),br.bind(c.stepInterpolant?X.NEAREST:X.LINEAR,X.CLAMP_TO_EDGE)}xe&&(V.activeTexture.set(X.TEXTURE0),Qt.lineAtlasTexture&&Qt.lineAtlasTexture.bind(X.LINEAR,X.REPEAT),ii.updatePaintBuffers()),Se&&(V.activeTexture.set(X.TEXTURE0),Qt.imageAtlasTexture&&Qt.imageAtlasTexture.bind(X.LINEAR,X.CLAMP_TO_EDGE),ii.updatePaintBuffers()),rr&&!k&&g.terrain.setupElevationDraw(Qt,Lr),g.uploadCommonUniforms(V,Lr,or.toUnwrapped());const Ui=Pr=>{Oe!=null&&(Oe.value=nt*I),Lr.draw(g,X.TRIANGLES,ft,Pr,K,Tr.disabled,In,c.id,fr.layoutVertexBuffer,fr.indexBuffer,fr.segments,c.paint,g.transform.zoom,ii,[fr.layoutVertexBuffer2,fr.patternVertexBuffer,fr.zOffsetVertexBuffer]),Oe!=null&&(Oe.value=nt)};if(Ge&&!rr){const Pr=g.stencilModeForClipping(or).ref;Pr===0&&ae&&V.clear({stencil:0});const br={func:X.EQUAL,mask:255};In.u_alpha_discard_threshold=.8,Ui(new vr(br,Pr,255,X.KEEP,X.KEEP,X.INVERT)),In.u_alpha_discard_threshold=0,Ui(new vr(br,Pr,255,X.KEEP,X.KEEP,X.KEEP))}else In.u_alpha_discard_threshold=Ge&&rr&&tr?.8:0,Ui(rr?pt:g.stencilModeForClipping(or))}};let je=g.depthModeForSublayer(0,qt.ReadOnly);const at=new qt(g.depthOcclusion?X.GREATER:X.LEQUAL,qt.ReadOnly,g.depthRangeFor3D);if(c.hasNonElevatedBuckets){const ht=!ae&&g.terrain;I!==0&&ht?n.w(`Occlusion opacity for layer ${c.id} is supported on terrain only if the layer has line-z-offset enabled.`):ht?n.w(`Cannot render non-elevated lines in immediate mode when terrain is enabled. Layer: ${c.id}.`):ot(p,qe,je,vr.disabled,!1,!0)}if(c.hasElevatedBuckets){O==="hd-road-markup"?H||(je=at,qe.push("ELEVATED_ROADS")):(qe.push("ELEVATED"),je=at,W&&qe.push(re?"CROSS_SLOPE_HORIZONTAL":"CROSS_SLOPE_VERTICAL"),k&&qe.push("ELEVATION_REFERENCE_SEA"));const ht=Ge?g.stencilModeFor3D():vr.disabled;g.forceTerrainMode=!0,ot(p,qe,je,ht,!0,!0),Ge&&ot(p,qe,je,ht,!0,!1),g.forceTerrainMode=!1}Ge&&(g.resetStencilClippingMasks(),ae&&V.clear({stencil:0})),I===0||g.depthOcclusion||ae||g.layersWithOcclusionOpacity.push(g.currentLayer)},fill:function(g,i,c,p){const x=c.paint.get("fill-color"),w=c.paint.get("fill-opacity");if(w.constantOr(1)===0)return;const A=c.paint.get("fill-emissive-strength"),I=g.colorModeForDrapableLayerRenderPass(A),O=c.paint.get("fill-pattern"),z=g.opaquePassEnabledForLayer()&&!O.constantOr(1)&&x.constantOr(n.ao.transparent).a===1&&w.constantOr(0)===1?"opaque":"translucent";let k="none";c.layout.get("fill-elevation-reference")!=="none"?k="road":c.paint.get("fill-z-offset").constantOr(1)!==0&&(k="offset");const H=!(!g.terrain||!g.terrain.enabled),V={painter:g,sourceCache:i,layer:c,coords:p,colorMode:I,elevationType:k,terrainEnabled:H,pass:z};if(g.renderPass!=="shadow")if(k!=="offset"){if(du(V,!1),k==="road"){const X=!H&&g.renderPass==="translucent";X&&Sc(g,i,c,p,"geometry"),du(V,!0,vr.disabled),X&&(function(Y){const{painter:W,sourceCache:re,layer:K,coords:ae,colorMode:ue}=Y,fe=W.context.gl,xe=Y.painter.shadowRenderer,ge=!!xe&&xe.enabled,Te=new qt(W.context.gl.LEQUAL,qt.ReadOnly,W.depthRangeFor3D);let ye=[0,0,0];if(ge){const Se=W.style.directionalLight,He=W.style.ambientLight;Se&&He&&(ye=Ts(W.style,Se,He))}const _e=Se=>{for(const He of ae){const ze=re.getTile(He),nt=ze.getBucket(K);if(!nt)continue;const Ge=nt.elevatedStructures;if(!Ge)continue;let tt,It;if(Se?(tt=Ge.renderableBridgeSegments,It=Ge.bridgeProgramConfigurations.get(K.id)):(tt=Ge.renderableTunnelSegments,It=Ge.tunnelProgramConfigurations.get(K.id)),!tt||tt.segments[0].primitiveLength===0)continue;It.updatePaintBuffers(),W.prepareDrawTile();const qe=W.isTileAffectedByFog(He),Oe=[];ge&&Oe.push("RENDER_SHADOWS","DEPTH_TEXTURE","NORMAL_OFFSET");const ot=W.getOrCreateProgram("elevatedStructures",{config:It,overrideFog:qe,defines:Oe}),je=W.translatePosMatrix(He.projMatrix,ze,K.paint.get("fill-translate"),K.paint.get("fill-translate-anchor"));ge&&xe.setupShadows(ze.tileID.toUnwrapped(),ot,"vector-tile");const at=up(je,ye);W.uploadCommonUniforms(W.context,ot,He.toUnwrapped()),ot.draw(W,fe.TRIANGLES,Te,vr.disabled,ue,Tr.backCCW,at,K.id,Ge.vertexBuffer,Ge.indexBuffer,tt,K.paint,W.transform.zoom,It,[Ge.vertexBufferNormal])}};_e(!0),_e(!1)})(V)}}else du(V,!1,g.stencilModeFor3D());else g.shadowRenderer&&k==="road"&&!H&&(function(X){const{painter:Y,sourceCache:W,layer:re,coords:K}=X,ae=Y.context.gl,ue=X.painter.shadowRenderer;for(const fe of K){const xe=W.getTile(fe),ge=xe.getBucket(re);if(!ge)continue;const Te=ge.elevatedStructures;if(!Te||!Te.shadowCasterSegments||Te.shadowCasterSegments.segments[0].primitiveLength===0)continue;Y.prepareDrawTile();const ye=ge.bufferData.programConfigurations.get(re.id),_e=Y.isTileAffectedByFog(fe),Se=Y.getOrCreateProgram("elevatedStructuresDepth",{config:ye,overrideFog:_e}),He=ue.calculateShadowPassMatrixFromTile(xe.tileID.toUnwrapped());Y.uploadCommonUniforms(Y.context,Se,fe.toUnwrapped());const ze={u_matrix:He,u_depth_bias:0};Se.draw(Y,ae.TRIANGLES,ue.getShadowPassDepthMode(),vr.disabled,ue.getShadowPassColorMode(),Tr.disabled,ze,re.id,Te.vertexBuffer,Te.indexBuffer,Te.shadowCasterSegments,re.paint,Y.transform.zoom,ye)}})(V)},"fill-extrusion":function(g,i,c,p){const x=c.paint.get("fill-extrusion-opacity"),w=g.context,A=w.gl,I=g.terrain,O=I&&I.renderingToTexture;if(x===0)return;const z=g.conflationActive&&g.style.isLayerClipped(c,i.getSource()),k=g.style.order.indexOf(c.fqid);if(z&&(function(H,V,X,Y,W){for(const re of Y){const K=V.getTile(re).getBucket(X);K&&(K.updateReplacement(re,H.replacementSource,W),K.uploadCentroid(H.context))}})(g,i,c,p,k),I||z)for(const H of p){const V=i.getTile(H).getBucket(c);V&&Ml(g.context,i,H,V,c,I,z)}if(g.renderPass==="shadow"&&g.shadowRenderer){const H=g.shadowRenderer;if(I&&x<.65&&c._transitionablePaint._values["fill-extrusion-opacity"].value.expression instanceof n.ad)return;const V=H.getShadowPassDepthMode(),X=H.getShadowPassColorMode();$t(g,i,c,p,V,vr.disabled,X,z)}else if(g.renderPass==="translucent"){const H=!c.paint.get("fill-extrusion-pattern").constantOr(1),V=c.paint.get("fill-extrusion-color").constantOr(n.ao.white);if(!O&&V.a!==0){const X=new qt(g.context.gl.LEQUAL,qt.ReadWrite,g.depthRangeFor3D);x===1&&H?$t(g,i,c,p,X,vr.disabled,kr.unblended,z):($t(g,i,c,p,X,vr.disabled,kr.disabled,z),$t(g,i,c,p,X,g.stencilModeFor3D(),g.colorModeForRenderPass(),z),g.resetStencilClippingMasks())}if(g.style.enable3dLights()&&H&&(!I&&g.transform.projection.name!=="globe"||O)){const X=c.paint.get("fill-extrusion-opacity"),Y=c.paint.get("fill-extrusion-ambient-occlusion-intensity"),W=c.paint.get("fill-extrusion-ambient-occlusion-ground-radius"),re=c.paint.get("fill-extrusion-flood-light-intensity"),K=c.paint.get("fill-extrusion-flood-light-color-use-theme").constantOr("default")==="none",ae=c.paint.get("fill-extrusion-flood-light-color").toNonPremultipliedRenderColor(K?null:c.lut).toArray01().slice(0,3),ue=Y>0&&W>0,fe=re>0,xe=(ye,_e,Se)=>(1-Se)*ye+Se*_e,ge=new ha;ge.translate=c.paint.get("fill-extrusion-translate"),ge.translateAnchor=c.paint.get("fill-extrusion-translate-anchor"),ge.edgeRadius=c.layout.get("fill-extrusion-edge-radius"),ge.cutoffFadeRange=c.paint.get("fill-extrusion-cutoff-fade-range");const Te=ye=>{const _e=g.depthModeForSublayer(1,qt.ReadOnly,A.LEQUAL,!0),Se=c.paint.get(ye?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),He=xe(.1,3,Se),ze=g._showOverdrawInspector;if(!ze){const nt=new vr({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),Ge=new kr([A.ONE,A.ONE,A.ONE,A.ONE],n.ao.transparent,[!1,!1,!1,!0],A.MIN);Ln(ge,g,i,c,p,_e,nt,Ge,Tr.disabled,ye,"sdf",X,Y,W,re,ae,He,z,!1)}{const nt=ze?vr.disabled:new vr({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),Ge=ze?g.colorModeForRenderPass():new kr([A.ONE_MINUS_DST_ALPHA,A.DST_ALPHA,A.ONE,A.ONE],n.ao.transparent,[!0,!0,!0,!0]);Ln(ge,g,i,c,p,_e,nt,Ge,Tr.disabled,ye,"color",X,Y,W,re,ae,He,z,!1)}};if(O){const ye=(_e,Se,He)=>{const ze=g.depthModeForSublayer(1,qt.ReadOnly,A.LEQUAL,!1),nt=c.paint.get(_e?"fill-extrusion-ambient-occlusion-ground-attenuation":"fill-extrusion-flood-light-ground-attenuation"),Ge=xe(.1,3,nt);{const tt=new kr([A.ONE,A.ONE,A.ONE,A.ONE],n.ao.transparent,[!1,!1,!1,!0]);Ln(ge,g,i,c,p,ze,vr.disabled,tt,Tr.disabled,_e,"clear",X,Y,W,re,ae,Ge,z,Se)}{const tt=new vr({func:A.ALWAYS,mask:255},255,255,A.KEEP,A.KEEP,A.REPLACE),It=new kr([A.ONE,A.ONE,A.ONE,A.ONE],n.ao.transparent,[!1,!1,!1,!0],A.MIN);Ln(ge,g,i,c,p,ze,tt,It,Tr.disabled,_e,"sdf",X,Y,W,re,ae,Ge,z,Se)}{const tt=_e?A.ZERO:A.ONE_MINUS_DST_ALPHA,It=new vr({func:A.EQUAL,mask:255},255,255,A.KEEP,A.DECR,A.DECR),qe=new kr([tt,A.DST_ALPHA,A.ONE_MINUS_DST_ALPHA,A.ZERO],n.ao.transparent,[!0,!0,!0,!0]);Ln(ge,g,i,c,p,ze,It,qe,Tr.disabled,_e,"color",X,Y,W,re,ae,Ge,z,Se)}{const tt=new kr([A.ONE,A.ONE,A.ONE,_e?A.ZERO:A.ONE],n.ao.transparent,[!1,!1,!1,!0],_e?A.FUNC_ADD:A.MAX);Ln(ge,g,i,c,p,ze,vr.disabled,tt,Tr.disabled,_e,"clear",X,Y,W,re,ae,Ge,z,Se,He)}};if(ue||fe){let _e;if(g.prepareDrawTile(),I){const Se=I.drapeBufferSize[0],He=I.drapeBufferSize[1];_e=I.framebufferCopyTexture,_e&&(!_e||_e.size[0]===Se&&_e.size[1]===He)||(_e&&_e.destroy(),_e=I.framebufferCopyTexture=new n.T(w,new n.q({width:Se,height:He}),A.RGBA8)),_e.bind(A.LINEAR,A.CLAMP_TO_EDGE),A.copyTexSubImage2D(A.TEXTURE_2D,0,0,0,0,0,Se,He)}ue&&ye(!0,!1,_e),fe&&ye(!1,!0,_e)}}else ue&&Te(!0),fe&&Te(!1),(ue||fe)&&g.resetStencilClippingMasks()}}},building:function(g,i,c,p){g.currentLayer<g.firstLightBeamLayer&&(g.firstLightBeamLayer=g.currentLayer);const x=c.paint.get("building-ambient-occlusion-ground-intensity"),w=c.paint.get("building-ambient-occlusion-ground-radius"),A=c.paint.get("building-ambient-occlusion-ground-attenuation"),I=c.paint.get("building-opacity");if(I<=0)return;let O=x>0&&w>0,z=!0;const k=c.paint.get("building-vertical-scale");(!g.shadowRenderer||k<1)&&(z=!1);const H=g.conflationActive&&g.style.isLayerClipped(c,i.getSource()),V=g.style.order.indexOf(c.fqid);if((function(X,Y,W,re,K,ae){for(const ue of ae){const fe=Y.getTile(ue).getBucket(W);fe&&(K&&fe.updateReplacement(ue,X.replacementSource,re),fe.uploadUpdatedIndexBuffer(X.context))}})(g,i,c,V,H,p),(function(X,Y,W,re){for(const K of re){const ae=Y.getTile(K).getBucket(W);ae&&ae.needsEvaluation()&&ae.uploadUpdatedColorBuffer(X.context)}})(g,i,c,p),c.resetLayerRenderingStats(g),g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!0),g.renderPass==="shadow"&&g.shadowRenderer){const X=g.shadowRenderer,Y=[],W=X.getShadowPassDepthMode();sh({painter:g,source:i,layer:c,coords:p,defines:Y,blendMode:X.getShadowPassColorMode(),depthMode:W,opacity:I,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0})}else if(g.renderPass==="translucent"){let X=["HAS_ATTRIBUTE_a_part_color_emissive","LIGHTING_3D_MODE"];z&&(X=X.concat("RENDER_SHADOWS","DEPTH_TEXTURE")),g.shadowRenderer&&g.shadowRenderer.useNormalOffset&&(X=X.concat("NORMAL_OFFSET"));const Y=c.paint.get("building-facade-emissive-chance"),W=c.paint.get("building-ambient-occlusion-intensity"),re=new qt(g.context.gl.LEQUAL,qt.ReadWrite,g.depthRangeFor3D);I<1&&sh({painter:g,source:i,layer:c,coords:p,defines:X,blendMode:kr.disabled,depthMode:re,opacity:I,verticalScale:k,facadeEmissiveChance:Y,facadeAOIntensity:W});const K=g.colorModeForRenderPass();sh({painter:g,source:i,layer:c,coords:p,defines:X,blendMode:K,depthMode:re,opacity:I,verticalScale:k,facadeEmissiveChance:Y,facadeAOIntensity:W}),O&&(function(ae,ue,fe,xe,ge,Te,ye,_e,Se,He,ze,nt,Ge){const tt=ae.context.gl,It=ae.depthModeForSublayer(1,qt.ReadOnly,tt.LEQUAL,!0),qe=.1*(1-(Oe=ze))+3*Oe;var Oe;const ot=ae._showOverdrawInspector,je=nt,at=new ha;ot||Ln(at,ae,ue,fe,xe,It,new vr({func:tt.ALWAYS,mask:255},255,255,tt.KEEP,tt.KEEP,tt.REPLACE),new kr([tt.ONE,tt.ONE,tt.ONE,tt.ONE],n.ao.transparent,[!1,!1,!1,!0],tt.MIN),Tr.disabled,ge,"sdf",Te,ye,_e,0,He,qe,je,!1);{const ht=ot?vr.disabled:new vr({func:tt.EQUAL,mask:255},255,255,tt.KEEP,tt.DECR,tt.DECR),wt=ot?ae.colorModeForRenderPass():new kr([tt.ONE_MINUS_DST_ALPHA,tt.DST_ALPHA,tt.ONE,tt.ONE],n.ao.transparent,[!0,!0,!0,!0]);Ln(at,ae,ue,fe,xe,It,ht,wt,Tr.disabled,ge,"color",Te,ye,_e,0,He,qe,je,!1)}})(g,i,c,p,!0,I,x,w,0,[0,0,0],A,H)}else if(g.renderPass==="light-beam"){const X=["HAS_ATTRIBUTE_a_part_color_emissive","HAS_ATTRIBUTE_a_bloom_attenuation"],Y=new qt(g.context.gl.LEQUAL,qt.ReadOnly,g.depthRangeFor3D);sh({painter:g,source:i,layer:c,coords:p,defines:X,blendMode:kr.alphaBlended,depthMode:Y,opacity:I,verticalScale:k,facadeEmissiveChance:0,facadeAOIntensity:0})}g.shadowRenderer&&(g.shadowRenderer.useNormalOffset=!1),g.resetStencilClippingMasks()},hillshade:function(g,i,c,p){if(g.renderPass!=="offscreen"&&g.renderPass!=="translucent"||g.style.disableElevatedTerrain)return;const x=g.context,w=g.terrain&&g.terrain.renderingToTexture,[A,I]=g.renderPass!=="translucent"||w?[{},p]:g.stencilConfigForOverlap(p);for(const O of I){const z=i.getTile(O);if(z.needsHillshadePrepare&&g.renderPass==="offscreen")th(g,z,c);else if(g.renderPass==="translucent"){const k=g.depthModeForSublayer(0,qt.ReadOnly),H=c.paint.get("hillshade-emissive-strength"),V=g.colorModeForDrapableLayerRenderPass(H),X=w&&g.terrain?g.terrain.stencilModeForRTTOverlap(O):A[O.overscaledZ];Rg(g,O,z,c,k,X,V)}}x.viewport.set([0,0,g.width,g.height]),g.resetStencilClippingMasks()},raster:function(g,i,c,p,x,w){if(g.renderPass!=="translucent"||c.paint.get("raster-opacity")===0)return;const A=g.transform.projection.name==="globe",I=c.paint.get("raster-elevation")!==0,O=I&&A;if(g.renderElevatedRasterBackface&&!O)return;const z=g.context,k=z.gl,H=i.getSource(),V=(function(ge,Te,ye,_e){const Se=Te.paint.get("raster-color"),He=ge.type==="raster-array",ze=[],nt=Te.paint.get("raster-resampling"),Ge=Te.paint.get("raster-color-mix");let tt=Te.paint.get("raster-color-range");const It=[Ge[0],Ge[1],Ge[2],0],qe=Ge[3];let Oe=nt==="nearest"?_e.NEAREST:_e.LINEAR;if(He&&(ze.push("RASTER_ARRAY"),Se||ze.push("RASTER_COLOR"),nt==="linear"&&ze.push("RASTER_ARRAY_LINEAR"),Oe=_e.NEAREST,!tt&&ge.rasterLayers)){const ot=ge.rasterLayers.find((({id:je})=>je===Te.sourceLayer));ot&&ot.fields&&ot.fields.range&&(tt=ot.fields.range)}if(tt=tt||[0,1],Se){ze.push("RASTER_COLOR"),ye.activeTexture.set(_e.TEXTURE2),Te.updateColorRamp(tt);let ot=Te.colorRampTexture;ot||(ot=Te.colorRampTexture=new n.T(ye,Te.colorRamp,_e.RGBA8)),ot.bind(_e.LINEAR,_e.CLAMP_TO_EDGE)}return{mix:It,range:tt,offset:qe,defines:ze,resampling:Oe}})(H,c,z,k);if(H instanceof n.aS&&!p.length&&!A)return;const X=c.paint.get("raster-emissive-strength"),Y=g.colorModeForDrapableLayerRenderPass(X),W=g.terrain&&g.terrain.renderingToTexture,re=!g.options.moving,K=c.paint.get("raster-resampling")==="nearest"?k.NEAREST:k.LINEAR;if(H instanceof n.aS&&!p.length&&(H.onNorthPole||H.onSouthPole)){const ge=I?g.stencilModeFor3D():vr.disabled;return void tf(!!H.onNorthPole,null,g,i,c,X,V,Tr.disabled,ge)}if(!p.length)return;const[ae,ue]=H instanceof n.aS||W?[{},p]:g.stencilConfigForOverlap(p),fe=ue[ue.length-1].overscaledZ;O&&V.defines.push("PROJECTION_GLOBE_VIEW"),I&&V.defines.push("RENDER_CUTOFF");const xe=(ge,Te,ye)=>{for(const _e of ge){const Se=_e.toUnwrapped(),He=i.getTile(_e);if(W&&(!He||!He.hasData()))continue;z.activeTexture.set(k.TEXTURE0);const ze=Rm(He,H,c,V);if(!ze||!ze.texture)continue;const{texture:nt,mix:Ge,offset:tt,tileSize:It,buffer:qe}=ze;let Oe,ot;W?(Oe=qt.disabled,ot=_e.projMatrix):I?(Oe=new qt(k.LEQUAL,qt.ReadWrite,g.depthRangeFor3D),ot=A?Float32Array.from(g.transform.expandedFarZProjMatrix):g.transform.calculateProjMatrix(Se,re)):(Oe=g.depthModeForSublayer(_e.overscaledZ-fe,c.paint.get("raster-opacity")===1?qt.ReadWrite:qt.ReadOnly,k.LESS),ot=g.transform.calculateProjMatrix(Se,re));const je=g.terrain&&W?g.terrain.stencilModeForRTTOverlap(_e):ae[_e.overscaledZ],at=w?0:c.paint.get("raster-fade-duration");He.registerFadeDuration(at);const ht=i.findLoadedParent(_e,0),wt=vc(He,ht,i,g.transform,at);let ft,pt;!wt.isFading&&He.refreshedUponExpiration&&(He.refreshedUponExpiration=!1),g.terrain&&g.terrain.prepareDrawTile(),z.activeTexture.set(k.TEXTURE0),nt.bind(K,k.CLAMP_TO_EDGE),z.activeTexture.set(k.TEXTURE1),ht?(ht.texture&&ht.texture.bind(K,k.CLAMP_TO_EDGE),ft=Math.pow(2,ht.tileID.overscaledZ-He.tileID.overscaledZ),pt=[He.tileID.canonical.x*ft%1,He.tileID.canonical.y*ft%1]):nt.bind(K,k.CLAMP_TO_EDGE),"useMipmap"in nt&&z.extTextureFilterAnisotropic&&g.transform.pitch>20&&k.texParameterf(k.TEXTURE_2D,z.extTextureFilterAnisotropic.TEXTURE_MAX_ANISOTROPY_EXT,z.extTextureFilterAnisotropicMax);const rr=g.transform;let tr;const or=I?Pg(rr):[0,0,0,0];let Qt,fr,Mr,Or,Si,wr=0;if(O&&H instanceof n.aS&&H.coordinates.length>3)Qt=Float32Array.from(n.bk(n.dF(new n.cC(0,0,0)))),fr=Float32Array.from(rr.globeMatrix),Mr=Float32Array.from(n.dB(rr)),Or=[n.aF(rr.center.lng),n.aJ(rr.center.lat)],tr=H.elevatedGlobePerspectiveTransform,Si=H.elevatedGlobeGridMatrix||new Float32Array(9);else if(O){const Lr=n.dC(_e.canonical);wr=n.dD(Lr.getCenter().lat),Qt=Float32Array.from(n.bk(n.dF(_e.canonical))),fr=Float32Array.from(rr.globeMatrix),Mr=Float32Array.from(n.dB(rr)),Or=[n.aF(rr.center.lng),n.aJ(rr.center.lat)],tr=[0,0],Si=Float32Array.from(n.dE(_e.canonical,Lr,wr,rr.worldSize/rr._pixelsPerMercatorPixel))}else tr=H instanceof n.aS?H.perspectiveTransform:[0,0],Qt=new Float32Array(16),fr=new Float32Array(9),Mr=new Float32Array(16),Or=[0,0],Si=new Float32Array(9);const ii=$h(ot,Qt,fr,Mr,Si,pt||[0,0],n.aj(g.transform.zoom),Or,or,ft||1,wt,c,tr,I?c.paint.get("raster-elevation"):0,2,Ge,tt,V.range,It,qe,X),hi=g.isTileAffectedByFog(_e),_i=g.getOrCreateProgram("raster",{defines:V.defines,overrideFog:hi});if(g.uploadCommonUniforms(z,_i,Se),H instanceof n.aS){const Lr=H.elevatedGlobeVertexBuffer,fi=H.elevatedGlobeIndexBuffer;if(W||!A)H.boundsBuffer&&H.boundsSegments&&_i.draw(g,k.TRIANGLES,Oe,vr.disabled,Y,Tr.disabled,ii,c.id,H.boundsBuffer,g.quadTriangleIndexBuffer,H.boundsSegments);else if(Lr&&fi){const li=rr.zoom<=n.cZ?H.elevatedGlobeSegments:H.getSegmentsForLongitude(rr.center.lng);li&&_i.draw(g,k.TRIANGLES,Oe,vr.disabled,Y,Te,ii,c.id,Lr,fi,li)}}else if(O){Oe=new qt(k.LEQUAL,qt.ReadOnly,g.depthRangeFor3D);const Lr=g.globeSharedBuffers;if(Lr){const[fi,li,di]=Lr.getGridBuffers(wr,!1);_i.draw(g,k.TRIANGLES,Oe,ye||je,g.colorModeForRenderPass(),Te,ii,c.id,fi,li,di)}}else{const{tileBoundsBuffer:Lr,tileBoundsIndexBuffer:fi,tileBoundsSegments:li}=g.getTileBoundsBuffers(He);_i.draw(g,k.TRIANGLES,Oe,je,Y,Tr.disabled,ii,c.id,Lr,fi,li)}}if(!(H instanceof n.aS)&&O)for(const _e of ge){const Se=_e.canonical.y===(1<<_e.canonical.z)-1;_e.canonical.y===0&&tf(!0,_e,g,i,c,X,V,Te,ye||vr.disabled),Se&&tf(!1,_e,g,i,c,X,V,Te===Tr.frontCW?Tr.backCW:Tr.frontCW,ye||vr.disabled)}};O?xe(ue,g.renderElevatedRasterBackface?Tr.backCW:Tr.frontCW,g.stencilModeFor3D()):xe(ue,Tr.disabled,void 0),g.resetStencilClippingMasks()},"raster-particle":function(g,i,c,p,x,w){g.renderPass==="offscreen"&&(function(A,I,O,z){if(!z.length)return;const k=A.context,H=k.gl,V=I.getSource();if(!(V instanceof Vc))return;const X=Math.ceil(Math.sqrt(O.paint.get("raster-particle-count")));let Y=O.particlePositionRGBAImage;if(!Y||Y.width!==X){const ue=(function(fe){const xe=fe*fe,ge=new Uint8Array(4*xe),Te=function(_e){return _e|=0,_e=Math.imul(2747636419^_e,2654435769),_e=Math.imul(_e^_e>>>16,2654435769),((_e=Math.imul(_e^_e>>>16,2654435769))>>>0)/4294967296},ye=1/1.1;for(let _e=0;_e<xe;_e++){const Se=ye*(Te(2*_e+0)+Js),He=ye*(Te(2*_e+1)+Js),ze=255*Se%1,nt=255*He%1,Ge=ze,tt=He-nt/255,It=nt;ge[4*_e+0]=255*(Se-ze/255),ge[4*_e+1]=255*Ge,ge[4*_e+2]=255*tt,ge[4*_e+3]=255*It}return ge})(X);Y=O.particlePositionRGBAImage=new n.q({width:X,height:X},ue)}let W=O.particleFramebuffer;W?W.width!==X&&(W.destroy(),W=O.particleFramebuffer=k.createFramebuffer(X,X,!0,null)):W=O.particleFramebuffer=k.createFramebuffer(X,X,!0,null);const re=[];for(const ue of z){const fe=I.getTile(ue);if(!(fe instanceof qc))continue;const xe=Aa(fe,V,O);if(!xe)continue;const ge=[fe.tileSize,fe.tileSize];let Te=O.tileFramebuffer;Te||(Te=O.tileFramebuffer=k.createFramebuffer(ge[0],ge[1],!0,null));let ye=fe.rasterParticleState;ye||(ye=fe.rasterParticleState=new Bg(k,ue,ge,Y));const _e=ye.update(O.lastInvalidatedAt);ye.particleTextureDimension!==X&&ye.updateParticleTexture(ue,Y);const Se=ye.targetColorTexture;ye.targetColorTexture=ye.backgroundColorTexture,ye.backgroundColorTexture=Se;const He=ye.particleTexture0;ye.particleTexture0=ye.particleTexture1,ye.particleTexture1=He,re.push([ue,xe,ye,_e])}if(re.length===0)return;const K=n.o.now(),ae=O.previousDrawTimestamp?.001*(K-O.previousDrawTimestamp):.0167;if(O.previousDrawTimestamp=K,O.hasColorMap()){k.activeTexture.set(H.TEXTURE0+2);let ue=O.colorRampTexture;ue||(ue=O.colorRampTexture=new n.T(k,O.colorRamp,H.RGBA8)),ue.bind(H.LINEAR,H.CLAMP_TO_EDGE)}k.bindFramebuffer.set(O.tileFramebuffer.framebuffer),(function(ue,fe,xe){const ge=ue.context,Te=ge.gl,ye=fe.tileFramebuffer;ge.activeTexture.set(Te.TEXTURE0);const _e={u_texture:0,u_opacity:1.05*(He=fe.paint.get("raster-particle-fade-opacity-factor"))/(He+.05)},Se=ue.getOrCreateProgram("rasterParticleTexture",{defines:[],overrideFog:!1});var He;for(const ze of xe){const[,,nt,Ge]=ze;ye.colorAttachment.set(nt.targetColorTexture.texture),ge.viewport.set([0,0,ye.width,ye.height]),ge.clear({color:n.ao.transparent}),Ge&&(nt.backgroundColorTexture.bind(Te.NEAREST,Te.CLAMP_TO_EDGE),Se.draw(ue,Te.TRIANGLES,qt.disabled,vr.disabled,kr.alphaBlended,Tr.disabled,_e,fe.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments))}})(A,O,re),(function(ue,fe,xe,ge){const Te=ue.context,ye=Te.gl,_e=xe.tileFramebuffer,Se=ue.transform.projection.name==="globe",He=xe.paint.get("raster-particle-max-speed");for(const ze of ge){const[nt,Ge,tt]=ze;Te.activeTexture.set(ye.TEXTURE0+0),Ge.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),_e.colorAttachment.set(tt.targetColorTexture.texture);const It=ue.getOrCreateProgram("rasterParticleDraw",{defines:Ge.defines,overrideFog:!1});Te.activeTexture.set(ye.TEXTURE0+1);const qe=Ge.scalarData?[]:[0,1,2,3].map((je=>n.e6[je](nt)));qe.push(nt);const Oe=nt.canonical.x,ot=nt.canonical.y;for(const je of qe){const at=fe.getTile(Se?je.wrapped():je);if(!at)continue;const ht=at.rasterParticleState;if(!ht)continue;const wt=je.canonical.x+(1<<je.canonical.z)*(je.wrap-nt.wrap),ft=je.canonical.y;ht.particleTexture0.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const pt=fp(1,ht.particleTexture0.size[0],[wt-Oe,ft-ot],0,Ge.texture.size,2,He,Ge.textureOffset,Ge.scale,Ge.offset);It.draw(ue,ye.POINTS,qt.disabled,vr.disabled,kr.alphaBlended,Tr.disabled,pt,xe.id,ht.particleIndexBuffer,void 0,ht.particleSegment)}}})(A,I,O,re),k.bindFramebuffer.set(O.particleFramebuffer.framebuffer),(function(ue,fe,xe,ge){const Te=ue.context,ye=Te.gl,_e=fe.paint.get("raster-particle-max-speed"),Se=ge*fe.paint.get("raster-particle-speed-factor")*.15,He=(function(nt){return Math.pow(nt,6)})(.01+1*fe.paint.get("raster-particle-reset-rate-factor")),ze=fe.particleFramebuffer;Te.viewport.set([0,0,ze.width,ze.height]);for(const nt of xe){const[,Ge,tt]=nt;Te.activeTexture.set(ye.TEXTURE0+0),Ge.texture.bind(ye.LINEAR,ye.CLAMP_TO_EDGE),Te.activeTexture.set(ye.TEXTURE0+1);const It=tt.particleTexture0;It.bind(ye.NEAREST,ye.CLAMP_TO_EDGE);const qe=rd(1,It.size[0],0,Ge.texture.size,_e,Se,He,Ge.textureOffset,Ge.scale,Ge.offset);ze.colorAttachment.set(tt.particleTexture1.texture),Te.clear({color:n.ao.transparent}),ue.getOrCreateProgram("rasterParticleUpdate",{defines:Ge.defines}).draw(ue,ye.TRIANGLES,qt.disabled,vr.disabled,kr.unblended,Tr.disabled,qe,fe.id,ue.viewportBuffer,ue.quadTriangleIndexBuffer,ue.viewportSegments)}})(A,O,re,ae)})(g,i,c,p),g.renderPass==="translucent"&&((function(A,I,O,z,k){const H=A.context,V=H.gl,X=I.getSource().tileSize,Y=5*(1-n.ah(n.cK,n.cK+1,A.transform.zoom))*X+O.paint.get("raster-particle-elevation"),W=!A.options.moving,re=A.transform.projection.name==="globe";if(!z.length)return;const[K,ae]=A.stencilConfigForOverlap(z),ue=[];re&&ue.push("PROJECTION_GLOBE_VIEW");const fe=A.stencilModeFor3D();for(const xe of ae){const ge=xe.toUnwrapped(),Te=I.getTile(xe);if(!Te.rasterParticleState)continue;const ye=Te.rasterParticleState,_e=100;Te.registerFadeDuration(_e);const Se=I.findLoadedParent(xe,0),He=vc(Te,Se,I,A.transform,_e);let ze,nt;A.terrain&&A.terrain.prepareDrawTile(),H.activeTexture.set(V.TEXTURE0),ye.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),H.activeTexture.set(V.TEXTURE1),Se&&Se.rasterParticleState?(Se.rasterParticleState.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE),ze=Math.pow(2,Se.tileID.overscaledZ-Te.tileID.overscaledZ),nt=[Te.tileID.canonical.x*ze%1,Te.tileID.canonical.y*ze%1]):ye.targetColorTexture.bind(V.LINEAR,V.CLAMP_TO_EDGE);const Ge=re?Float32Array.from(A.transform.expandedFarZProjMatrix):A.transform.calculateProjMatrix(ge,W),tt=A.transform,It=dp(tt),qe=n.dC(xe.canonical),Oe=n.dD(qe.getCenter().lat);let ot,je,at,ht,wt;re?(ot=Float32Array.from(n.bk(n.dF(xe.canonical))),je=Float32Array.from(tt.globeMatrix),at=Float32Array.from(n.dB(tt)),ht=[n.aF(tt.center.lng),n.aJ(tt.center.lat)],wt=Float32Array.from(n.dE(xe.canonical,qe,Oe,tt.worldSize/tt._pixelsPerMercatorPixel))):(ot=new Float32Array(16),je=new Float32Array(9),at=new Float32Array(16),ht=[0,0],wt=new Float32Array(9));const ft=Rs(Ge,ot,je,at,wt,nt||[0,0],n.aj(A.transform.zoom),ht,It,ze||1,He,Y),pt=A.isTileAffectedByFog(xe),rr=A.getOrCreateProgram("rasterParticle",{defines:ue,overrideFog:pt});if(A.uploadCommonUniforms(H,rr,ge),re){const tr=new qt(V.LEQUAL,qt.ReadOnly,A.depthRangeFor3D),or=0,Qt=A.globeSharedBuffers;if(Qt){const[fr,Mr,Or]=Qt.getGridBuffers(Oe,or!==0);rr.draw(A,V.TRIANGLES,tr,fe,kr.alphaBlended,A.renderElevatedRasterBackface?Tr.frontCCW:Tr.backCCW,ft,O.id,fr,Mr,Or)}}else{const tr=A.depthModeForSublayer(0,qt.ReadOnly),or=K[xe.overscaledZ],{tileBoundsBuffer:Qt,tileBoundsIndexBuffer:fr,tileBoundsSegments:Mr}=A.getTileBoundsBuffers(Te);rr.draw(A,V.TRIANGLES,tr,or,kr.alphaBlended,Tr.disabled,ft,O.id,Qt,fr,Mr)}}A.resetStencilClippingMasks()})(g,i,c,p),g.style.map.triggerRepaint())},background:function(g,i,c,p){const x=c.paint.get("background-color"),w=c.paint.get("background-color-use-theme").constantOr("default")==="none",A=c.paint.get("background-opacity"),I=c.paint.get("background-emissive-strength"),O=c.paint.get("background-pitch-alignment")==="viewport";if(A===0)return;const z=g.context,k=z.gl,H=g.transform,V=H.tileSize,X=c.paint.get("background-pattern");let Y;if(X!==void 0&&(X===null||(Y=g.imageManager.getPattern(n.I.from(X.toString()),c.scope,g.style.getLut(c.scope)),!Y)))return;const W=!X&&x.a===1&&A===1&&g.opaquePassEnabledForLayer()?"opaque":"translucent";if(g.renderPass!==W)return;const re=vr.disabled,K=g.depthModeForSublayer(0,W==="opaque"?qt.ReadWrite:qt.ReadOnly),ae=g.colorModeForDrapableLayerRenderPass(I),ue=X?"backgroundPattern":"background";let fe,xe=p;if(xe||(fe=g.getBackgroundTiles(),xe=Object.values(fe).map((ge=>ge.tileID))),X&&(z.activeTexture.set(k.TEXTURE0),g.imageManager.bind(g.context,c.scope)),O){const ge=g.getOrCreateProgram(ue,{overrideFog:!1,overrideRtt:!0}),Te=new Float32Array(n.bA([])),ye=new n.aO(0,0,0,0,0),_e=X?Zh(Te,I,A,g,0,c.scope,Y,O,{tileID:ye,tileSize:V}):id(Te,I,A,x.toPremultipliedRenderColor(w?null:c.lut));ge.draw(g,k.TRIANGLES,K,re,ae,Tr.disabled,_e,c.id,g.viewportBuffer,g.quadTriangleIndexBuffer,g.viewportSegments)}else for(const ge of xe){const Te=g.isTileAffectedByFog(ge),ye=g.getOrCreateProgram(ue,{overrideFog:Te}),_e=ge.toUnwrapped(),Se=p?ge.projMatrix:g.transform.calculateProjMatrix(_e);g.prepareDrawTile();const He=i?i.getTile(ge):fe?fe[ge.key]:new Hc(ge,V,H.zoom,g),ze=X?Zh(Se,I,A,g,0,c.scope,Y,O,{tileID:ge,tileSize:V}):id(Se,I,A,x.toPremultipliedRenderColor(w?null:c.lut));g.uploadCommonUniforms(z,ye,_e);const{tileBoundsBuffer:nt,tileBoundsIndexBuffer:Ge,tileBoundsSegments:tt}=g.getTileBoundsBuffers(He);ye.draw(g,k.TRIANGLES,K,re,ae,Tr.disabled,ze,c.id,nt,Ge,tt)}},sky:function(g,i,c){const p=g._atmosphere?n.aj(g.transform.zoom):1,x=c.paint.get("sky-opacity")*p;if(x===0)return;const w=g.context,A=c.paint.get("sky-type"),I=new qt(w.gl.LEQUAL,qt.ReadOnly,[0,1]),O=g.frameCounter/1e3%1;A==="atmosphere"?g.renderPass==="offscreen"?c.needsSkyboxCapture(g)&&((function(z,k,H,V){const X=z.context,Y=X.gl;let W=k.skyboxFbo;if(!W){W=k.skyboxFbo=X.createFramebuffer(32,32,!0,null),k.skyboxGeometry=new _p(X),k.skyboxTexture=X.gl.createTexture(),Y.bindTexture(Y.TEXTURE_CUBE_MAP,k.skyboxTexture),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_S,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_WRAP_T,Y.CLAMP_TO_EDGE),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MIN_FILTER,Y.LINEAR),Y.texParameteri(Y.TEXTURE_CUBE_MAP,Y.TEXTURE_MAG_FILTER,Y.LINEAR);for(let ue=0;ue<6;++ue)Y.texImage2D(Y.TEXTURE_CUBE_MAP_POSITIVE_X+ue,0,Y.RGBA,32,32,0,Y.RGBA,Y.UNSIGNED_BYTE,null)}X.bindFramebuffer.set(W.framebuffer),X.viewport.set([0,0,32,32]);const re=k.getCenter(z,!0),K=z.getOrCreateProgram("skyboxCapture"),ae=new Float64Array(16);n.bA(ae),n.ek(ae,ae,.5*-Math.PI),Ds(z,k,K,ae,re,0),n.bA(ae),n.ek(ae,ae,.5*Math.PI),Ds(z,k,K,ae,re,1),n.bA(ae),n.cT(ae,ae,.5*-Math.PI),Ds(z,k,K,ae,re,2),n.bA(ae),n.cT(ae,ae,.5*Math.PI),Ds(z,k,K,ae,re,3),n.bA(ae),Ds(z,k,K,ae,re,4),n.bA(ae),n.ek(ae,ae,Math.PI),Ds(z,k,K,ae,re,5),X.viewport.set([0,0,z.width,z.height])})(g,c),c.markSkyboxValid(g)):g.renderPass==="sky"&&(function(z,k,H,V,X){const Y=z.context,W=Y.gl,re=z.transform,K=z.getOrCreateProgram("skybox");Y.activeTexture.set(W.TEXTURE0),W.bindTexture(W.TEXTURE_CUBE_MAP,k.skyboxTexture);const ae=((ue,fe,xe,ge,Te)=>({u_matrix:ue,u_sun_direction:fe,u_cubemap:0,u_opacity:ge,u_temporal_offset:Te}))(re.skyboxMatrix,k.getCenter(z,!1),0,V,X);z.uploadCommonUniforms(Y,K),K.draw(z,W.TRIANGLES,H,vr.disabled,z.colorModeForRenderPass(),Tr.backCW,ae,"skybox",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)})(g,c,I,x,O):A==="gradient"&&g.renderPass==="sky"&&(function(z,k,H,V,X){const Y=z.context,W=Y.gl,re=z.transform,K=z.getOrCreateProgram("skyboxGradient");k.skyboxGeometry||(k.skyboxGeometry=new _p(Y)),Y.activeTexture.set(W.TEXTURE0);let ae=k.colorRampTexture;ae||(ae=k.colorRampTexture=new n.T(Y,k.colorRamp,W.RGBA8)),ae.bind(W.LINEAR,W.CLAMP_TO_EDGE);const ue=((fe,xe,ge,Te,ye)=>({u_matrix:fe,u_color_ramp:0,u_center_direction:xe,u_radius:n.an(ge),u_opacity:Te,u_temporal_offset:ye}))(re.skyboxMatrix,k.getCenter(z,!1),k.paint.get("sky-gradient-radius"),V,X);z.uploadCommonUniforms(Y,K),K.draw(z,W.TRIANGLES,H,vr.disabled,z.colorModeForRenderPass(),Tr.backCW,ue,"skyboxGradient",k.skyboxGeometry.vertexBuffer,k.skyboxGeometry.indexBuffer,k.skyboxGeometry.segment)})(g,c,I,x,O)},custom:function(g,i,c,p){const x=g.context,w=c.implementation;if(!g.transform.projection.unsupportedLayers||!g.transform.projection.unsupportedLayers.includes("custom")||g.terrain&&(g.terrain.renderingToTexture||g.renderPass==="offscreen")&&c.isDraped(i)){if(g.renderPass==="offscreen"){const A=w.prerender;if(A){if(g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),g.transform.projection.name==="globe"){const I=g.transform.pointMerc;A.call(w,x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),n.aj(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else A.call(w,x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState()}}else if(g.renderPass==="translucent"){if(g.terrain&&g.terrain.renderingToTexture){const I=w.renderToTile;if(I){const O=p[0].canonical,z={x:O.x+p[0].wrap*(w.wrapTileId?0:1<<O.z),y:O.y,z:O.z};x.setDepthMode(qt.disabled),x.setStencilMode(vr.disabled),x.setColorMode(g.colorModeForRenderPass()),g.setCustomLayerDefaults(),I.call(w,x.gl,z),x.setDirty(),g.setBaseState()}return}g.setCustomLayerDefaults(),x.setColorMode(g.colorModeForRenderPass()),x.setStencilMode(vr.disabled);const A=w.renderingMode==="3d"?new qt(g.context.gl.LEQUAL,qt.ReadWrite,g.depthRangeFor3D):g.depthModeForSublayer(0,qt.ReadOnly);if(x.setDepthMode(A),g.transform.projection.name==="globe"){const I=g.transform.pointMerc;w.render(x.gl,g.transform.customLayerMatrix(),g.transform.getProjection(),g.transform.globeToMercatorMatrix(),n.aj(g.transform.zoom),[I.x,I.y],g.transform.pixelsPerMeterRatio)}else w.render(x.gl,g.transform.customLayerMatrix());x.setDirty(),g.setBaseState(),x.bindFramebuffer.set(null)}}else n.w("Custom layers are not yet supported with this projection. Use mercator or globe to enable usage of custom layers.")},model:function(g,i,c,p){if(g.renderPass==="opaque")return;const x=c.paint.get("model-opacity").constantOr(1);if(x===0)return;const w=c.paint.get("model-cast-shadows");if(g.renderPass==="shadow"&&(!w||g.terrain&&x<.65&&c._transitionablePaint._values["model-opacity"].value.expression instanceof n.ad))return;const A=g.shadowRenderer,I=c.paint.get("model-receive-shadows");A&&(A.useNormalOffset=!0,I||(A.enabled=!1));const O=()=>{A&&(A.useNormalOffset=!0,I||(A.enabled=!0))},z=i.getSource();if(g.renderPass==="light-beam"&&z.type!=="batched-model")return;if(z.type==="vector"||z.type==="geojson")return(function(K,ae,ue,fe,xe){const ge=K.transform;if(ge.projection.name!=="mercator")return void n.w(`Drawing 3D models for ${ge.projection.name} projection is not yet implemented`);const Te=ge.getFreeCameraOptions().position;if(!K.modelManager)return;const ye=K.modelManager;ue.modelManager=ye;const _e=K.shadowRenderer;if(!ue._unevaluatedLayout._values.hasOwnProperty("model-id"))return;const Se=ue._unevaluatedLayout._values["model-id"],He=Object.assign({},ue.layout.get("model-id").parameters),ze=K.style.order.indexOf(ue.fqid);for(const nt of fe){const Ge=ae.getTile(nt).getBucket(ue);if(!Ge||Ge.projection.name!==ge.projection.name)continue;const tt=Ge.getModelUris();tt&&!Ge.modelsRequested&&(ye.addModelsFromBucket(tt,xe),Ge.modelsRequested=!0);const It=_u(nt,ge);He.zoom=It;const qe=Se.possiblyEvaluate(He);if(Dm(K,Ge,nt),Os.shadowUniformsInitialized=!1,Os.useSingleShadowCascade=!!_e&&_e.getMaxCascadeForTile(nt.toUnwrapped())===0,K.renderPass==="shadow"&&_e){if(K.currentShadowCascade===1&&Ge.isInsideFirstShadowMapFrustum)continue;const je=ge.calculatePosMatrix(nt.toUnwrapped(),ge.worldSize);if(Os.tileMatrix.set(je),Os.shadowTileMatrix=Float32Array.from(_e.calculateShadowPassMatrixFromMatrix(je)),Os.aabb.min=[0,0,0],Os.aabb.max[0]=Os.aabb.max[1]=n.al,Os.aabb.max[2]=0,kg(Ge,Os,K,ue.scope))continue}const Oe=1<<nt.canonical.z,ot=[((Te.x-nt.wrap)*Oe-nt.canonical.x)*n.al,(Te.y*Oe-nt.canonical.y)*n.al,Te.z*Oe*n.al];K.conflationActive&&Object.keys(Ge.instancesPerModel).length>0&&K.style.isLayerClipped(ue,ae.getSource())&&Ge.updateReplacement(nt,K.replacementSource,ze,xe)&&(Ge.uploaded=!1,Ge.upload(K.context));for(let je in Ge.instancesPerModel){const at=Ge.instancesPerModel[je];at.features.length>0&&(je=qe.evaluate(at.features[0].feature,{}));const ht=ye.getModel(je,xe);if(ht||ye.hasURLBeenRequested(je)||Ge.modelUris.includes(je)||(Ge.modelUris.push(je),Ge.modelsRequested=!1),ht&&ht.uploaded)for(const wt of ht.nodes)Om(K,ue,wt,at,ot,nt,Os)}}})(g,i,c,p,z.type==="vector"?c.scope:""),void O();if(!z.loaded())return;if(z.type==="batched-model")return(function(K,ae,ue,fe){ue.resetLayerRenderingStats(K);const xe=K.context,ge=K.transform,Te=K.style.fog,ye=K.shadowRenderer;if(ge.projection.name!=="mercator")return void n.w(`Drawing 3D landmark models for ${ge.projection.name} projection is not yet implemented`);const _e=K.transform.getFreeCameraOptions().position,Se=n.c4([],[_e.x,_e.y,_e.z],K.transform.worldSize),He=n.et([],Se),ze=n.bA([]),nt=n.ec(ge.center.lat,ge.zoom),Ge=n.bq([],[1,1,1/nt]);n.br(ze,ze,He);const tt=ue.paint.get("model-opacity").constantOr(1),It=new qt(xe.gl.LEQUAL,qt.ReadWrite,K.depthRangeFor3D),qe=new qt(xe.gl.LEQUAL,qt.ReadOnly,K.depthRangeFor3D),Oe=new n.d8([1/0,1/0,1/0],[-1/0,-1/0,-1/0]),ot=K.renderPass==="shadow",je=ot&&ye?ye.getCurrentCascadeFrustum():ge.getFrustum(ge.scaleZoom(ge.worldSize)),at=ue.paint.get("model-front-cutoff"),ht=at[2]<1,wt=Qc(K,ue.paint.get("model-cutoff-fade-range")),ft=ue.getLayerRenderingStats();(function(pt,rr,tr,or){const Qt=pt.terrain?pt.terrain.exaggeration():0,fr=pt.transform.zoom;for(const Mr of or){const Or=rr.getTile(Mr).getBucket(tr);Or&&(Or.setFilter(tr.filter),pt.conflationActive&&Or.updateReplacement(Mr,pt.replacementSource),Or.evaluateTransform(pt,tr),pt.terrain&&Qt>0&&Or.elevationUpdate(pt.terrain,Qt,Mr,tr.source),Or.needsReEvaluation(pt,fr,tr)&&Or.evaluate(tr))}})(K,ae,ue,fe),(function(){let pt,rr,tr;ht?(pt=fe.length-1,rr=-1,tr=-1):(pt=0,rr=fe.length,tr=1);const or=new Float64Array(16),Qt=n.cz(),fr=new n.P(0,0);for(let Mr=pt;Mr!==rr;Mr+=tr){const Or=fe[Mr],Si=ae.getTile(Or).getBucket(ue);if(!Si||!Si.uploaded)continue;let wr=!1;ye&&(wr=ye.getMaxCascadeForTile(Or.toUnwrapped())===0);const ii=ge.calculatePosMatrix(Or.toUnwrapped(),ge.worldSize),hi=Si.modelTraits;!ot&&ht&&(n.bl(or,ii),n.af(Qt,Se,or),fr.x=Qt[0],fr.y=Qt[1]);const _i=[];Si.setFilter(ue.filter);for(const Lr of Si.getNodesInfo()){if(Lr.hiddenByReplacement||!Lr.node.meshes)continue;const fi=Lr.node;let li=0;K.terrain&&fi.elevation&&(li=fi.elevation*K.terrain.exaggeration());const di=(()=>{const xn=Lr.aabb;return Oe.min=[...xn.min],Oe.max=[...xn.max],Oe.min[2]+=li,Oe.max[2]+=li,n.af(Oe.min,Oe.min,ii),n.af(Oe.max,Oe.max,ii),Oe})(),Fi=Lr.evaluatedScale;if(Fi[0]<=1&&Fi[1]<=1&&Fi[2]<=1&&di.intersects(je)===0)continue;if(!ot&&ht){const xn=.16666666666666666;Lr.cameraCollisionOpacity=Se[0]>di.min[0]&&Se[0]<di.max[0]&&Se[1]>di.min[1]&&Se[1]<di.max[1]&&Se[2]*nt<di.max[2]&&fi.footprint&&n.b$(fr,fi.footprint)?Math.max(Lr.cameraCollisionOpacity-xn,0):Math.min(1,Lr.cameraCollisionOpacity+xn)}const Ii=[...ii],In=1/n.d6(Or.canonical),Ui=fi.anchor?fi.anchor[0]:0,Pr=fi.anchor?fi.anchor[1]:0;n.br(Ii,Ii,[Ui*(Fi[0]-1)+Lr.evaluatedTranslation[0]*In,Pr*(Fi[1]-1)+Lr.evaluatedTranslation[1]*In,li+Lr.evaluatedTranslation[2]]),n.cp(Fi,n.ev)||n.cR(Ii,Ii,Fi);const br=n.aB([],Ii,fi.matrix),Ti=n.aB([],ge.expandedFarZProjMatrix,br),vn=n.aB([],ge.expandedFarZProjMatrix,Ii),Xi=n.aC([],[Ui,Pr,li,1],Ti)[2];fi.hidden=!1;let Bn=tt;ot||(ht&&(Bn*=Lr.cameraCollisionOpacity,Bn*=yp(Ii,ge,Lr.aabb,at)),Bn*=rf(wt,Xi)),Bn!==0?_i.push({nodeInfo:Lr,depth:Xi,opacity:Bn,wvpForNode:Ti,wvpForTile:vn,nodeModelMatrix:br,tileModelMatrix:Ii}):fi.hidden=!0}ot||_i.sort(((Lr,fi)=>!ht||Lr.opacity===1&&fi.opacity===1?Lr.depth<fi.depth?-1:1:Lr.opacity===1?-1:fi.opacity===1?1:Lr.depth>fi.depth?-1:1));for(const Lr of _i){const fi=Lr.nodeInfo,li=fi.node;let di=n.aB([],Ge,Lr.tileModelMatrix);n.aB(di,ze,di);const Fi=n.bl([],di);n.ed(Fi,Fi),n.cR(Fi,Fi,Fg),di=n.aB(di,di,li.matrix);const Ii=K.renderPass==="light-beam",In=ue.paint.get("model-color-use-theme").constantOr("default")==="none",Ui=hi&n.ez.HasMapboxMeshFeatures,Pr=Ui?0:fi.evaluatedRMEA[0][2];for(let br=0;br<li.meshes.length;++br){const Ti=li.meshes[br],vn=br===li.lightMeshIndex;let Xi=Lr.wvpForNode;if(vn){if(!Ii&&!K.terrain&&K.shadowRenderer){K.currentLayer<K.firstLightBeamLayer&&(K.firstLightBeamLayer=K.currentLayer);continue}Xi=Lr.wvpForTile}else if(Ii)continue;const Bn={defines:[]},xn=[];if(!ot&&ye&&(ye.useNormalOffset=!!Ti.normalBuffer),cd(Bn.defines,xn,Ti,K,In?null:ue.lut),Ui||Bn.defines.push("DIFFUSE_SHADED"),wr&&Bn.defines.push("SHADOWS_SINGLE_CASCADE"),ft&&(ot?ft.numRenderedVerticesInShadowPass+=Ti.vertexArray.length:ft.numRenderedVerticesInTransparentPass+=Ti.vertexArray.length),ot){ch(Ti,Lr.nodeModelMatrix,K,ue);continue}let $a=null;if(Te){const Xa=Ve(Lr.nodeModelMatrix,K.transform);if($a=new Float32Array(Xa),ge.projection.name!=="globe"){const bn=Ti.aabb.min,fn=Ti.aabb.max,[rn,Yn]=Te.getOpacityForBounds(Xa,bn[0],bn[1],fn[0],fn[1]);Bn.overrideFog=rn>=lr||Yn>=lr}}const Wn=Ti.material;let Ia;Wn.occlusionTexture&&Wn.occlusionTexture.offsetScale&&(Ia=Wn.occlusionTexture.offsetScale,Bn.defines.push("OCCLUSION_TEXTURE_TRANSFORM"));const Ra=K.getOrCreateProgram("model",Bn);!ot&&ye&&ye.setupShadowsFromMatrix(Lr.tileModelMatrix,Ra,ye.useNormalOffset),K.uploadCommonUniforms(xe,Ra,null,$a);const da=Wn.pbrMetallicRoughness;da.metallicFactor=.9,da.roughnessFactor=.5;const zo=el(new Float32Array(Xi),new Float32Array(di),new Float32Array(Fi),new Float32Array(li.matrix),K,Lr.opacity,da.baseColorFactor,Wn.emissiveFactor,da.metallicFactor,da.roughnessFactor,Wn,Pr,ue,[0,0,0],Ia);!vn&&(fi.hasTranslucentParts||Lr.opacity<1)&&Ra.draw(K,xe.gl.TRIANGLES,It,vr.disabled,kr.disabled,Tr.backCCW,zo,ue.id,Ti.vertexBuffer,Ti.indexBuffer,Ti.segments,ue.paint,K.transform.zoom,void 0,xn),Ra.draw(K,xe.gl.TRIANGLES,vn?qe:It,vr.disabled,vn||Lr.opacity<1||fi.hasTranslucentParts?kr.alphaBlended:kr.unblended,Tr.backCCW,zo,ue.id,Ti.vertexBuffer,Ti.indexBuffer,Ti.segments,ue.paint,K.transform.zoom,void 0,xn)}}}})()})(g,i,c,p),void O();if(z.type!=="model")return;const k=z.getModels(),H=[],V=g.transform.getFreeCameraOptions().position,X=n.c4([],[V.x,V.y,V.z],g.transform.worldSize);n.et(X,X);const Y=[],W=[];let re=0;for(const K of k){const ae=c.paint.get("model-rotation").constantOr(null),ue=c.paint.get("model-scale").constantOr(null),fe=c.paint.get("model-translation").constantOr(null);K.computeModelMatrix(g,ae,ue,fe,!0,!0,!1);const xe=n.bA([]),ge=n.ec(K.position.lat,g.transform.zoom),Te=n.bq([],[1,1,1/ge]);n.br(xe,xe,X),H.push({zScaleMatrix:Te,negCameraPosMatrix:xe});for(const ye of K.nodes)ud(g.transform,ye,K.matrix,g.transform.expandedFarZProjMatrix,re,Y,W);re++}if(Y.sort(((K,ae)=>ae.depth-K.depth)),g.renderPass!=="shadow"){if(x===1)for(const K of W)gu(K,g,c,H[K.modelIndex],vr.disabled,g.colorModeForRenderPass());else{for(const K of W)gu(K,g,c,H[K.modelIndex],vr.disabled,kr.disabled);for(const K of W)gu(K,g,c,H[K.modelIndex],g.stencilModeFor3D(),g.colorModeForRenderPass());g.resetStencilClippingMasks()}for(const K of Y)gu(K,g,c,H[K.modelIndex],vr.disabled,g.colorModeForRenderPass());O()}else{for(const K of W)ch(K.mesh,K.nodeModelMatrix,g,c);for(const K of Y)ch(K.mesh,K.nodeModelMatrix,g,c);O()}}},rl={line:function(g,i,c){if(g.hasElevatedBuckets=!1,g.hasNonElevatedBuckets=!1,g._unevaluatedLayout.getValue("line-elevation-reference")!==void 0||g._unevaluatedLayout.getValue("line-z-offset")!==void 0){if(i){const p=i.getVisibleCoordinates();for(const x of p){const w=i.getTile(x).getBucket(g);if(w&&(w.elevationType!=="none"?g.hasElevatedBuckets=!0:g.hasNonElevatedBuckets=!0,g.hasElevatedBuckets&&g.hasNonElevatedBuckets))break}}}else g.hasNonElevatedBuckets=!0},model:function(g,i,c){const p=i.getSource();if(!p.loaded())return;if(p.type==="vector"||p.type==="geojson")return void(c.modelManager&&c.modelManager.upload(c,p.type==="vector"?g.scope:""));if(p.type==="batched-model"||p.type!=="model")return;const x=p.getModels();for(const w of x)w.upload(c.context)},raster:function(g,i,c){const p=i.getSource();if(!(p instanceof Vc&&p.loaded()))return;const x=g.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const w=g.paint.get("raster-array-band")||p.getInitialBand(x);if(w==null)return;const A=i.getIds().map((I=>i.getTileByID(I)));for(const I of A)I.updateNeeded(g.id,w)&&p.prepareTile(I,x,g.id,w)},"raster-particle":function(g,i,c){const p=i.getSource();if(!(p instanceof Vc&&p.loaded()))return;const x=g.sourceLayer||p.rasterLayerIds&&p.rasterLayerIds[0];if(!x)return;const w=g.paint.get("raster-particle-array-band")||p.getInitialBand(x);if(w==null)return;const A=i.getIds().map((I=>i.getTileByID(I)));for(const I of A)I.updateNeeded(g.id,w)&&p.prepareTile(I,x,g.id,w)}},Pl={fill:Sc},Ps={fill:function(g,i,c,p){if(!c.layout||c.layout.get("fill-elevation-reference")==="none")return;const x=g.context.gl,w=new qt(x.LEQUAL,qt.ReadOnly,g.depthRangeFor3D),A=new vr({func:x.ALWAYS,mask:255},255,255,x.KEEP,x.KEEP,x.REPLACE),I=g.transform.getFreeCameraOptions().position,O=g.getOrCreateProgram("elevatedStructuresDepthReconstruct");for(const z of p){const k=i.getTile(z),H=k.getBucket(c);if(!H)continue;const V=H.elevatedStructures;if(!V||V.depthSegments.segments[0].primitiveLength===0)continue;const X=Og(z.toUnwrapped(),I),Y=g.translatePosMatrix(z.projMatrix,k,c.paint.get("fill-translate"),c.paint.get("fill-translate-anchor")),W=Jf(Y,X,0,1,0);O.draw(g,x.TRIANGLES,w,A,kr.disabled,Tr.disabled,W,c.id,V.vertexBuffer,V.indexBuffer,V.depthSegments,c.paint,g.transform.zoom)}}};class af{constructor(i,c,p,x,w,A){this.context=new Yh(i,c),this.transform=p,this._tileTextures={},this.frameCopies=[],this.loadTimeStamps=[],this.tp=w,this._timeStamp=n.o.now(),this._averageFPS=0,this._fpsHistory=[],this._dt=0,this._debugParams={forceEnablePrecipitation:!1,showTerrainProxyTiles:!1,fpsWindow:30,continousRedraw:!1,enabledLayers:{}};const I=["fill","line","symbol","circle","heatmap","fill-extrusion","building","raster","raster-particle","hillshade","model","background","sky"];for(const z of I)this._debugParams.enabledLayers[z]=!0;w.registerParameter(this._debugParams,["Terrain"],"showTerrainProxyTiles",{},(()=>{this.style.map.triggerRepaint()})),w.registerParameter(this._debugParams,["Precipitation"],"forceEnablePrecipitation"),w.registerParameter(this._debugParams,["FPS"],"fpsWindow",{min:1,max:100,step:1}),w.registerBinding(this._debugParams,["FPS"],"continousRedraw",{readonly:!0,label:"continuous redraw"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"value"}),w.registerBinding(this,["FPS"],"_averageFPS",{readonly:!0,label:"graph",view:"graph",min:0,max:200});for(const z of I)w.registerParameter(this._debugParams.enabledLayers,["Debug","Layers"],z);this.occlusionParams=new hd(w),this.setup(),this.numSublayers=Uo.maxUnderzooming+Uo.maxOverzooming+1,this.depthEpsilon=1/Math.pow(2,16),this.deferredRenderGpuTimeQueries=[],this.gpuTimers={},this.frameCounter=0,this._backgroundTiles={},this.conflationActive=!1,this.replacementSource=new n.eG,this.longestCutoffRange=0,this.minCutoffZoom=0,this._fogVisible=!1,this._cachedTileFogOpacities={},this._shadowRenderer=new Cg(this),this._wireframeDebugCache=new vp,this.renderDefaultNorthPole=!0,this.renderDefaultSouthPole=!0,this.layersWithOcclusionOpacity=[];const O=new n.q({width:1,height:1},Uint8Array.of(0,0,0,0));this.emptyDepthTexture=new n.T(this.context,O,i.RGBA8),this._clippingActiveLastFrame=!1,this.scaleFactor=x,this.worldview=A}updateTerrain(i,c){const p=!!i&&!!i.terrain&&this.transform.projection.supportsTerrain;if(!(p||this._terrain&&this._terrain.enabled))return;this._terrain||(this._terrain=new Tl(this,i));const x=this._terrain;this.transform.elevation=p?x:null,x.update(i,this.transform,c),this.transform.elevation&&!x.enabled&&(this.transform.elevation=null)}_updateFog(i){const c=i.fog;if(!c||this.transform.projection.name==="globe"||c.getOpacity(this.transform.pitch)<1||c.properties.get("horizon-blend")<.03)return void(this.transform.fogCullDistSq=null);const[p,x]=c.getFovAdjustedRange(this.transform._fov);if(p>x)return void(this.transform.fogCullDistSq=null);const w=p+.78*(x-p);this.transform.fogCullDistSq=w*w}get terrain(){return this.transform._terrainEnabled()&&this._terrain&&this._terrain.enabled||this._forceTerrainMode?this._terrain:null}get forceTerrainMode(){return this._forceTerrainMode}set forceTerrainMode(i){i&&!this._terrain&&(this._terrain=new Tl(this,this.style)),this._forceTerrainMode=i}get shadowRenderer(){return this._shadowRenderer&&this._shadowRenderer.enabled?this._shadowRenderer:null}get wireframeDebugCache(){return this._wireframeDebugCache}resize(i,c){if(this.width=i*n.o.devicePixelRatio,this.height=c*n.o.devicePixelRatio,this.context.viewport.set([0,0,this.width,this.height]),this.style)for(const p of this.style.order)this.style._mergedLayers[p].resize()}setup(){const i=this.context,c=new n.bd;c.emplaceBack(0,0),c.emplaceBack(n.al,0),c.emplaceBack(0,n.al),c.emplaceBack(n.al,n.al),this.tileExtentBuffer=i.createVertexBuffer(c,n.bf.members),this.tileExtentSegments=n.bg.simpleSegment(0,0,4,2);const p=new n.bd;p.emplaceBack(0,0),p.emplaceBack(n.al,0),p.emplaceBack(0,n.al),p.emplaceBack(n.al,n.al),this.debugBuffer=i.createVertexBuffer(p,n.bf.members),this.debugSegments=n.bg.simpleSegment(0,0,4,5);const x=new n.bd;x.emplaceBack(-1,-1),x.emplaceBack(1,-1),x.emplaceBack(-1,1),x.emplaceBack(1,1),this.viewportBuffer=i.createVertexBuffer(x,n.bf.members),this.viewportSegments=n.bg.simpleSegment(0,0,4,2);const w=new n.b0;w.emplaceBack(0,0,0,0),w.emplaceBack(n.al,0,n.al,0),w.emplaceBack(0,n.al,0,n.al),w.emplaceBack(n.al,n.al,n.al,n.al),this.mercatorBoundsBuffer=i.createVertexBuffer(w,n.bi.members),this.mercatorBoundsSegments=n.bg.simpleSegment(0,0,4,2);const A=new n.b1;A.emplaceBack(0,1,2),A.emplaceBack(2,1,3),this.quadTriangleIndexBuffer=i.createIndexBuffer(A);const I=new n.be;for(const z of[0,1,3,2,0])I.emplaceBack(z);this.debugIndexBuffer=i.createIndexBuffer(I),this.emptyTexture=new n.T(i,new n.q({width:1,height:1},Uint8Array.of(0,0,0,0)),i.gl.RGBA8),this.identityMat=n.bC();const O=this.context.gl;this.stencilClearMode=new vr({func:O.ALWAYS,mask:0},0,255,O.ZERO,O.ZERO,O.ZERO),this.loadTimeStamps.push(performance.now())}getMercatorTileBoundsBuffers(){return{tileBoundsBuffer:this.mercatorBoundsBuffer,tileBoundsIndexBuffer:this.quadTriangleIndexBuffer,tileBoundsSegments:this.mercatorBoundsSegments}}getTileBoundsBuffers(i){return i._makeTileBoundsBuffers(this.context,this.transform.projection),i._tileBoundsBuffer?{tileBoundsBuffer:i._tileBoundsBuffer,tileBoundsIndexBuffer:i._tileBoundsIndexBuffer,tileBoundsSegments:i._tileBoundsSegments}:this.getMercatorTileBoundsBuffers()}clearStencil(){const i=this.context.gl;this.nextStencilID=1,this.currentStencilSource=void 0,this._tileClippingMaskIDs={},this.getOrCreateProgram("clippingMask").draw(this,i.TRIANGLES,qt.disabled,this.stencilClearMode,kr.disabled,Tr.disabled,Zn(this.identityMat),"$clipping",this.viewportBuffer,this.quadTriangleIndexBuffer,this.viewportSegments)}resetStencilClippingMasks(){this.terrain||(this.currentStencilSource=void 0,this._tileClippingMaskIDs={})}_renderTileClippingMasks(i,c,p){if(!c||this.currentStencilSource===c.id||!i.isTileClipped()||!p||p.length===0)return;if(this._tileClippingMaskIDs&&!this.terrain){let I=!1;for(const O of p)if(this._tileClippingMaskIDs[O.key]===void 0){I=!0;break}if(!I)return}this.currentStencilSource=c.id;const x=this.context,w=x.gl;this.nextStencilID+p.length>256&&this.clearStencil(),x.setColorMode(kr.disabled),x.setDepthMode(qt.disabled);const A=this.getOrCreateProgram("clippingMask");this._tileClippingMaskIDs={};for(const I of p){const O=c.getTile(I),z=this._tileClippingMaskIDs[I.key]=this.nextStencilID++,{tileBoundsBuffer:k,tileBoundsIndexBuffer:H,tileBoundsSegments:V}=this.getTileBoundsBuffers(O);A.draw(this,w.TRIANGLES,qt.disabled,new vr({func:w.ALWAYS,mask:0},z,255,w.KEEP,w.KEEP,w.REPLACE),kr.disabled,Tr.disabled,Zn(I.projMatrix),"$clipping",k,H,V)}}stencilModeFor3D(){this.currentStencilSource=void 0,this.nextStencilID+1>256&&this.clearStencil();const i=this.nextStencilID++,c=this.context.gl;return new vr({func:c.NOTEQUAL,mask:255},i,255,c.KEEP,c.KEEP,c.REPLACE)}stencilModeForClipping(i){if(this.terrain)return this.terrain.stencilModeForRTTOverlap(i);const c=this.context.gl;return new vr({func:c.EQUAL,mask:255},this._tileClippingMaskIDs[i.key],0,c.KEEP,c.KEEP,c.REPLACE)}stencilConfigForOverlap(i){const c=this.context.gl,p=i.sort(((A,I)=>I.overscaledZ-A.overscaledZ)),x=p[p.length-1].overscaledZ,w=p[0].overscaledZ-x+1;if(w>1){this.currentStencilSource=void 0,this.nextStencilID+w>256&&this.clearStencil();const A={};for(let I=0;I<w;I++)A[I+x]=new vr({func:c.GEQUAL,mask:255},I+this.nextStencilID,255,c.KEEP,c.KEEP,c.REPLACE);return this.nextStencilID+=w,[A,p]}return[{[x]:vr.disabled},p]}colorModeForRenderPass(){const i=this.context.gl;return this._showOverdrawInspector?new kr([i.CONSTANT_COLOR,i.ONE,i.CONSTANT_COLOR,i.ONE],new n.ao(.125,.125,.125,0),[!0,!0,!0,!0]):this.renderPass==="opaque"?kr.unblended:kr.alphaBlended}colorModeForDrapableLayerRenderPass(i){const c=this.context.gl;return this.style&&this.style.enable3dLights()&&this.terrain&&this.terrain.renderingToTexture&&this.renderPass==="translucent"?new kr([c.ONE,c.ONE_MINUS_SRC_ALPHA,c.CONSTANT_ALPHA,c.ONE_MINUS_SRC_ALPHA],new n.ao(0,0,0,i===void 0?0:i),[!0,!0,!0,!0]):this.colorModeForRenderPass()}depthModeForSublayer(i,c,p,x=!1){if(this.depthOcclusion)return new qt(this.context.gl.GREATER,qt.ReadOnly,this.depthRangeFor3D);if(!this.opaquePassEnabledForLayer()&&!x)return qt.disabled;const w=1-((1+this.currentLayer)*this.numSublayers+i)*this.depthEpsilon;return new qt(p||this.context.gl.LEQUAL,c,[w,w])}opaquePassEnabledForLayer(){return this.currentLayer<this.opaquePassCutoff}blitDepth(){const i=this.context.gl,c=Math.ceil(this.width),p=Math.ceil(this.height),x=this.context.bindFramebuffer.get(),w=i.getParameter(i.TEXTURE_BINDING_2D);this.depthFBO&&this.depthFBO.width===c&&this.depthFBO.height===p||(this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),c!==0&&p!==0&&(this.depthFBO=new Il(this.context,c,p,!1,"texture"),this.depthTexture=new n.T(this.context,{width:c,height:p,data:null},i.DEPTH24_STENCIL8),this.depthFBO.depthAttachment.set(this.depthTexture.texture))),this.context.bindFramebuffer.set(x),i.bindTexture(i.TEXTURE_2D,w),this.depthFBO&&(i.bindFramebuffer(i.READ_FRAMEBUFFER,null),i.bindFramebuffer(i.DRAW_FRAMEBUFFER,this.depthFBO.framebuffer),i.blitFramebuffer(0,0,c,p,0,0,c,p,i.DEPTH_BUFFER_BIT,i.NEAREST),i.bindFramebuffer(i.FRAMEBUFFER,this.context.bindFramebuffer.current))}updateAverageFPS(){this._fpsHistory.push(this._dt===0?0:1e3/this._dt),this._fpsHistory.length>this._debugParams.fpsWindow&&this._fpsHistory.splice(0,this._fpsHistory.length-this._debugParams.fpsWindow),this._averageFPS=Math.round(this._fpsHistory.reduce(((i,c)=>i+c/this._fpsHistory.length),0))}render(i,c){const p=n.o.now();this._dt=p-this._timeStamp,this._timeStamp=p,this._wireframeDebugCache.update(this.frameCounter),this._debugParams.continousRedraw=i.map.repaint,this.style=i,this.options=c;const x=this.style._mergedLayers,w=!(!this.terrain||!this.terrain.enabled),A=()=>this.style._getOrder(w).filter((qe=>{const Oe=x[qe];return!(Oe.type in this._debugParams.enabledLayers)||this._debugParams.enabledLayers[Oe.type]}));let I=A(),O=!1,z=!1,k=null;for(const qe of I){const Oe=x[qe];Oe.type==="circle"?O=!0:Oe.type==="building"?k=Oe:Oe.type==="symbol"&&(Oe.hasOcclusionOpacityProperties?z=!0:O=!0)}let H=I.map((qe=>x[qe]));const V=this.style._mergedSourceCaches;this.imageManager=i.imageManager,this.modelManager=i.modelManager,this.symbolFadeChange=i.placement.symbolFadeChange(n.o.now()),this.imageManager.beginFrame();let X=0,Y=!1;for(const qe in V){const Oe=V[qe];Oe.used&&(Oe.prepare(this.context),Oe.getSource().usedInConflation&&++X)}let W=!1;for(const qe of H)qe.isHidden(this.transform.zoom)||(qe.type==="clip"&&(W=!0),this.prepareLayer(qe));const re={},K={},ae={},ue={},fe={};for(const qe in V){const Oe=V[qe];re[qe]=Oe.getVisibleCoordinates(),K[qe]=re[qe].slice().reverse(),ae[qe]=Oe.getVisibleCoordinates(!0).reverse(),ue[qe]=Oe.getShadowCasterCoordinates(),fe[qe]=Oe.sortCoordinatesByDistance(re[qe])}const xe=qe=>{const Oe=this.style.getLayerSourceCache(qe);return Oe&&Oe.used?Oe.getSource():null};if(X||W||this._clippingActiveLastFrame){const qe=[],Oe=[];let ot=0;for(const je of H)this.isSourceForClippingOrConflation(je,xe(je))&&(qe.push(je),Oe.push(ot)),ot++;if(qe&&(W||qe.length>1)||this._clippingActiveLastFrame){W=!1;const je=[];for(let at=0;at<qe.length;at++){const ht=qe[at],wt=Oe[at],ft=this.style.getLayerSourceCache(ht);if(!ft||!ft.used||!ft.getSource().usedInConflation&&ht.type!=="clip"&&ht.type!=="building")continue;let pt=n.eH,rr=n.bZ.None;const tr=[];let or=!0;if(ht.type==="building")pt=n.eJ;else if(ht.type==="clip"){pt=wt;for(const Qt of ht.layout.get("clip-layer-types"))rr|=Qt==="model"?n.bZ.Model:Qt==="symbol"?n.bZ.Symbol:n.bZ.FillExtrusion;for(const Qt of ht.layout.get("clip-layer-scope"))tr.push(Qt);ht.isHidden(this.transform.zoom)?or=!1:W=!0}or&&je.push({layer:ht.fqid,cache:ft,order:pt,clipMask:rr,clipScope:tr})}this.replacementSource.setSources(je),Y=!0}}this._clippingActiveLastFrame=W,Y||this.replacementSource.clear(),this.conflationActive=Y,this.minCutoffZoom=0,this.longestCutoffRange=0,this.opaquePassCutoff=1/0,this._lastOcclusionLayer=-1,this.layersWithOcclusionOpacity=[];for(let qe=0;qe<H.length;qe++){const Oe=H[qe],ot=Oe.cutoffRange();if(this.longestCutoffRange=Math.max(ot,this.longestCutoffRange),ot>0){const je=xe(Oe);je&&(this.minCutoffZoom=Math.max(je.minzoom,this.minCutoffZoom)),Oe.minzoom&&(this.minCutoffZoom=Math.max(Oe.minzoom,this.minCutoffZoom))}Oe.is3D(w)&&(this.opaquePassCutoff===1/0&&(this.opaquePassCutoff=qe),this._lastOcclusionLayer=qe)}const ge=this.style&&this.style.fog;ge?(this._fogVisible=ge.getOpacity(this.transform.pitch)!==0,this._fogVisible&&this.transform.projection.name!=="globe"&&(this._fogVisible=ge.isVisibleOnFrustum(this.transform.cameraFrustum))):this._fogVisible=!1,this._cachedTileFogOpacities={},this.terrain&&(this.terrain.updateTileBinding(ae),this.opaquePassCutoff=0,I=A(),H=I.map((qe=>x[qe])));const Te=this._shadowRenderer;if(Te){Te.updateShadowParameters(this.transform,this.style.directionalLight);for(const qe in V)for(const Oe of re[qe]){let ot={min:0,max:0};this.terrain&&(ot=this.terrain.getMinMaxForTile(Oe)||ot),Te.addShadowReceiver(Oe.toUnwrapped(),ot.min,ot.max)}}this.transform.projection.name!=="globe"||this.globeSharedBuffers||(this.globeSharedBuffers=new n.eI(this.context)),this.style.fog&&this.transform.projection.supportsFog?(this._atmosphere||(this._atmosphere=new lh(this)),this._atmosphere.update(this)):this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0);const ye=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.snow),_e=this._debugParams.forceEnablePrecipitation||!(!this.style||!this.style.rain);if(ye&&!this._snow&&(this._snow=new Ng(this)),!ye&&this._snow&&(this._snow.destroy(),delete this._snow),_e&&!this._rain&&(this._rain=new Yi(this)),!_e&&this._rain&&(this._rain.destroy(),delete this._rain),this._snow&&this._snow.update(this),this._rain&&this._rain.update(this),k){this.buildingTileBorderManager||(this.buildingTileBorderManager=new yn);const qe=this.style.getLayerSourceCache(k);this.buildingTileBorderManager.updateBorders(qe,k)}if(!qs.has(this.context.gl))return;this.renderPass="offscreen";for(const qe of H){const Oe=i.getLayerSourceCache(qe);if(!qe.hasOffscreenPass()||qe.isHidden(this.transform.zoom))continue;const ot=Oe?K[Oe.id]:void 0;(qe.type==="custom"||qe.type==="raster"||qe.type==="raster-particle"||qe.isSky()||ot&&ot.length)&&this.renderLayer(this,Oe,qe,ot)}this.depthRangeFor3D=[0,1-(H.length+2)*this.numSublayers*this.depthEpsilon],this._shadowRenderer&&(this.renderPass="shadow",this._shadowRenderer.drawShadowPass(this.style,ue)),this.context.bindFramebuffer.set(null),this.context.viewport.set([0,0,this.width,this.height]);const Se=this.transform.projection.name==="globe"||this.transform.isHorizonVisible(),He=(()=>{if(c.showOverdrawInspector)return n.ao.black;const qe=this.style.fog;if(qe&&this.transform.projection.supportsFog){const Oe=this.style.getLut(qe.scope);if(!Se){const ot=qe.properties.get("color-use-theme")==="none",je=qe.properties.get("color").toNonPremultipliedRenderColor(ot?null:Oe).toArray01();return new n.ao(...je)}if(Se){const ot=qe.properties.get("space-color-use-theme")==="none",je=qe.properties.get("space-color").toNonPremultipliedRenderColor(ot?null:Oe).toArray01();return new n.ao(...je)}}return n.ao.transparent})();if(this.context.clear({color:He,depth:1}),this.clearStencil(),this._showOverdrawInspector=c.showOverdrawInspector,this.renderPass="opaque",this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawStars(this,this.style.fog),!this.terrain)for(this.currentLayer=I.length-1;this.currentLayer>=0;this.currentLayer--){const qe=H[this.currentLayer],Oe=i.getLayerSourceCache(qe);if(qe.isSky())continue;const ot=Oe?(qe.is3D(w)?fe:K)[Oe.id]:void 0;this._renderTileClippingMasks(qe,Oe,ot),this.renderLayer(this,Oe,qe,ot)}if(this.style.fog&&this.transform.projection.supportsFog&&this._atmosphere&&!this._showOverdrawInspector&&Se&&this._atmosphere.drawAtmosphereGlow(this,this.style.fog),this.renderPass="sky",(!this._atmosphere||n.aj(this.transform.zoom)>0)&&(this.transform.projection.name==="globe"||this.transform.isHorizonVisible()))for(this.currentLayer=0;this.currentLayer<I.length;this.currentLayer++){const qe=H[this.currentLayer],Oe=i.getLayerSourceCache(qe);qe.isSky()&&this.renderLayer(this,Oe,qe,Oe?K[Oe.id]:void 0)}function ze(qe,Oe){let ot;return Oe&&(ot=(qe.type==="symbol"?ae:qe.is3D(w)?fe:K)[Oe.id]),ot}if(this.renderPass="translucent",this.transform.projection.name==="globe"){for(this.renderElevatedRasterBackface=!0,this.currentLayer=0;this.currentLayer<I.length;){const qe=H[this.currentLayer];if(qe.type==="raster"||qe.type==="raster-particle"){const Oe=i.getLayerSourceCache(qe);this.renderLayer(this,Oe,qe,ze(qe,Oe))}++this.currentLayer}this.renderElevatedRasterBackface=!1}this.currentLayer=0,this.firstLightBeamLayer=Number.MAX_SAFE_INTEGER;let nt=0;Te&&(nt=Te.getShadowCastingLayerCount());let Ge=!1,tt=-1;for(let qe=0;qe<I.length;++qe){const Oe=H[qe];Oe.isHidden(this.transform.zoom)||Oe.is3D(w)&&(tt=qe)}z&&tt===-1&&(O=!0);let It=!1;for(;this.currentLayer<I.length;){const qe=H[this.currentLayer],Oe=i.getLayerSourceCache(qe);if(qe.isSky())++this.currentLayer;else if(this.terrain&&this.style.isLayerDraped(qe)){if(qe.isHidden(this.transform.zoom)){++this.currentLayer;continue}this.currentLayer=this.terrain.renderBatch(this.currentLayer),this._lastOcclusionLayer=Math.max(this.currentLayer,this._lastOcclusionLayer)}else{if(!It&&qe.is3D(w)&&!w){const ot=this.currentLayer,je=at=>{for(this.currentLayer=0;this.currentLayer<H.length;this.currentLayer++){const ht=H[this.currentLayer];if(Pl[ht.type]){const wt=this.style.getLayerSourceCache(ht);Pl[ht.type](this,wt,ht,ze(ht,wt),at)}}};je("initialize"),je("reset"),this.currentLayer=ot,It=!0}if(O&&!Ge&&this.terrain&&!this.transform.isOrthographic&&(Ge=!0,this.blitDepth()),z&&tt!==-1&&this.currentLayer===tt+1&&!this.transform.isOrthographic&&this.blitDepth(),this.terrain||this._renderTileClippingMasks(qe,Oe,Oe?re[Oe.id]:void 0),this.renderLayer(this,Oe,qe,ze(qe,Oe)),!this.terrain&&Te&&nt>0&&qe.hasShadowPass()&&--nt==0){{this.clearStencil(),this.resetStencilClippingMasks();const ot=this.currentLayer;for(this.currentLayer=0;this.currentLayer<H.length;this.currentLayer++){const je=H[this.currentLayer];if(Ps[je.type]){const at=this.style.getLayerSourceCache(je);Ps[je.type](this,at,je,ze(je,at))}}this.currentLayer=ot}if(Te.drawGroundShadows(),this.firstLightBeamLayer<=this.currentLayer){const ot=this.currentLayer;for(this.renderPass="light-beam",this.currentLayer=this.firstLightBeamLayer;this.currentLayer<=ot;this.currentLayer++){const je=H[this.currentLayer];if(!je.hasLightBeamPass())continue;const at=i.getLayerSourceCache(je);this.renderLayer(this,at,je,at?K[at.id]:void 0)}this.currentLayer=ot,this.renderPass="translucent"}}if(this.currentLayer>=this._lastOcclusionLayer&&this.layersWithOcclusionOpacity.length>0){const ot=this.currentLayer;this.depthOcclusion=!0;for(const je of this.layersWithOcclusionOpacity){this.currentLayer=je;const at=H[this.currentLayer],ht=i.getLayerSourceCache(at),wt=ht?K[ht.id]:void 0;this.terrain||this._renderTileClippingMasks(at,ht,ht?re[ht.id]:void 0),this.renderLayer(this,ht,at,wt)}this.depthOcclusion=!1,this.currentLayer=ot,this.renderPass="translucent",this.layersWithOcclusionOpacity=[]}++this.currentLayer}}if(this.terrain&&this.terrain.postRender(),this._snow&&this._snow.draw(this),this._rain&&this._rain.draw(this),this.options.showTileBoundaries||this.options.showQueryGeometry||this.options.showTileAABBs){let qe=null;H.forEach((Oe=>{const ot=i.getLayerSourceCache(Oe);ot&&!Oe.isHidden(this.transform.zoom)&&ot.getVisibleCoordinates().length&&(!qe||qe.getSource().maxzoom<ot.getSource().maxzoom)&&(qe=ot)})),qe&&this.options.showTileBoundaries&&ld(this,qe,qe.getVisibleCoordinates(),n.ao.red,!1,this.options.showParseStatus)}this.terrain&&this._debugParams.showTerrainProxyTiles&&ld(this,this.terrain.proxySourceCache,this.terrain.proxyCoords,new n.ao(1,.8,.1,1),!0,this.options.showParseStatus),this.options.showPadding&&(function(qe){const Oe=qe.transform.padding;tl(qe,qe.transform.height-(Oe.top||0),3,jo),tl(qe,Oe.bottom||0,3,Tc),Hi(qe,Oe.left||0,3,zg),Hi(qe,qe.transform.width-(Oe.right||0),3,pp);const ot=qe.transform.centerPoint;(function(je,at,ht,wt){pu(je,at-1,ht-10,2,20,wt),pu(je,at-10,ht-1,20,2,wt)})(qe,ot.x,qe.transform.height-ot.y,mp)})(this),this.context.setDefault(),this.frameCounter=(this.frameCounter+1)%Number.MAX_SAFE_INTEGER,this.tileLoaded&&this.options.speedIndexTiming&&(this.loadTimeStamps.push(performance.now()),this.saveCanvasCopy()),Y||(this.conflationActive=!1)}prepareLayer(i){this.gpuTimingStart(i);const{unsupportedLayers:c}=this.transform.projection,p=!c||!c.includes(i.type);if(rl[i.type]&&(p||this.terrain&&i.type==="custom")){const x=this.style.getLayerSourceCache(i);rl[i.type](i,x,this)}this.gpuTimingEnd()}renderLayer(i,c,p,x){p.isHidden(this.transform.zoom)||(p.type==="background"||p.type==="sky"||p.type==="custom"||p.type==="model"||p.type==="raster"||p.type==="raster-particle"||x&&x.length)&&(this.id=p.id,this.gpuTimingStart(p),i.transform.projection.unsupportedLayers&&i.transform.projection.unsupportedLayers.includes(p.type)&&(!i.terrain||p.type!=="custom")||p.type==="clip"||ss[p.type](i,c,p,x,this.style.placement.variableOffsets,this.options.isInitialLoad),this.gpuTimingEnd())}gpuTimingStart(i){if(!this.options.gpuTiming)return;const c=this.context.extTimerQuery,p=this.context.gl;let x=this.gpuTimers[i.id];x||(x=this.gpuTimers[i.id]={calls:0,cpuTime:0,query:p.createQuery()}),x.calls++,p.beginQuery(c.TIME_ELAPSED_EXT,x.query)}gpuTimingDeferredRenderStart(){if(this.options.gpuTimingDeferredRender){const i=this.context.extTimerQuery,c=this.context.gl,p=c.createQuery();this.deferredRenderGpuTimeQueries.push(p),c.beginQuery(i.TIME_ELAPSED_EXT,p)}}gpuTimingDeferredRenderEnd(){this.options.gpuTimingDeferredRender&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}gpuTimingEnd(){this.options.gpuTiming&&this.context.gl.endQuery(this.context.extTimerQuery.TIME_ELAPSED_EXT)}collectGpuTimers(){const i=this.gpuTimers;return this.gpuTimers={},i}collectDeferredRenderGpuQueries(){const i=this.deferredRenderGpuTimeQueries;return this.deferredRenderGpuTimeQueries=[],i}queryGpuTimers(i){const c={};for(const p in i){const x=i[p],w=this.context.extTimerQuery,A=w.getQueryParameter(x.query,this.context.gl.QUERY_RESULT)/1e6;w.deleteQueryEXT(x.query),c[p]=A}return c}queryGpuTimeDeferredRender(i){if(!this.options.gpuTimingDeferredRender)return 0;const c=this.context.gl;let p=0;for(const x of i)p+=c.getQueryParameter(x,c.QUERY_RESULT)/1e6,c.deleteQuery(x);return p}translatePosMatrix(i,c,p,x,w){if(!p[0]&&!p[1])return i;const A=w?x==="map"?this.transform.angle:0:x==="viewport"?-this.transform.angle:0;if(A){const z=Math.sin(A),k=Math.cos(A);p=[p[0]*k-p[1]*z,p[0]*z+p[1]*k]}const I=[w?p[0]:n.ay(c,p[0],this.transform.zoom),w?p[1]:n.ay(c,p[1],this.transform.zoom),0],O=new Float32Array(16);return n.br(O,i,I),O}saveTileTexture(i){if(i.context!==this.context)return;const c=i.size[0],p=this._tileTextures[c];p?p.push(i):this._tileTextures[c]=[i]}getTileTexture(i){const c=this._tileTextures[i];return c&&c.length>0?c.pop():null}terrainRenderModeElevated(){return this.style&&!!this.style.getTerrain()&&!!this.terrain&&!this.terrain.renderingToTexture||this.forceTerrainMode}linearFloatFilteringSupported(){return this.context.extTextureFloatLinear!=null}currentGlobalDefines(i,c,p){const x=p===void 0?this.terrain&&this.terrain.renderingToTexture:p,w=[];return this.style&&this.style.enable3dLights()&&(i==="globeRaster"||i==="terrainRaster"?(w.push("LIGHTING_3D_MODE"),w.push("LIGHTING_3D_ALPHA_EMISSIVENESS")):x||w.push("LIGHTING_3D_MODE")),this.renderPass==="shadow"&&(this._shadowMapDebug||w.push("DEPTH_TEXTURE")),this.terrainRenderModeElevated()&&(w.push("TERRAIN"),this.linearFloatFilteringSupported()&&w.push("TERRAIN_DEM_FLOAT_FORMAT")),this.transform.projection.name==="globe"&&w.push("GLOBE"),!this._fogVisible||x||c!==void 0&&!c||w.push("FOG","FOG_DITHERING"),x&&w.push("RENDER_TO_TEXTURE"),this._showOverdrawInspector&&w.push("OVERDRAW_INSPECTOR"),w}getOrCreateProgram(i,c){this.cache=this.cache||{};const p=c&&c.defines||[],x=c&&c.config,w=this.currentGlobalDefines(i,c&&c.overrideFog,c&&c.overrideRtt).concat(p),A=sp.cacheKey(fc[i],i,w,x);return this.cache[A]||(this.cache[A]=new sp(this.context,i,fc[i],x,Pn[i],w)),this.cache[A]}setCustomLayerDefaults(){this.context.unbindVAO(),this.context.cullFace.setDefault(),this.context.frontFace.setDefault(),this.context.cullFaceSide.setDefault(),this.context.activeTexture.setDefault(),this.context.pixelStoreUnpack.setDefault(),this.context.pixelStoreUnpackPremultiplyAlpha.setDefault(),this.context.pixelStoreUnpackFlipY.setDefault()}setBaseState(){const i=this.context.gl;this.context.cullFace.set(!1),this.context.viewport.set([0,0,this.width,this.height]),this.context.blendEquation.set(i.FUNC_ADD)}initDebugOverlayCanvas(){this.debugOverlayCanvas==null&&(this.debugOverlayCanvas=document.createElement("canvas"),this.debugOverlayCanvas.width=512,this.debugOverlayCanvas.height=512,this.debugOverlayTexture=new n.T(this.context,this.debugOverlayCanvas,this.context.gl.RGBA8))}destroy(){this._terrain&&this._terrain.destroy(),this._atmosphere&&(this._atmosphere.destroy(),this._atmosphere=void 0),this.globeSharedBuffers&&this.globeSharedBuffers.destroy(),this.emptyTexture.destroy(),this.debugOverlayTexture&&this.debugOverlayTexture.destroy(),this._wireframeDebugCache.destroy(),this.depthFBO&&(this.depthFBO.destroy(),this.depthFBO=void 0,this.depthTexture=void 0),this.emptyDepthTexture&&this.emptyDepthTexture.destroy()}prepareDrawTile(){this.terrain&&this.terrain.prepareDrawTile()}uploadCommonLightUniforms(i,c){if(this.style.enable3dLights()){const p=this.style.directionalLight,x=this.style.ambientLight;if(p&&x){const w=((A,I,O)=>{const z=A.properties.get("direction"),k=A.properties.get("color-use-theme")==="none",H=A.properties.get("color").toNonPremultipliedRenderColor(k?null:O.getLut(A.scope)).toArray01(),V=A.properties.get("intensity"),X=I.properties.get("color-use-theme")==="none",Y=I.properties.get("color").toNonPremultipliedRenderColor(X?null:O.getLut(I.scope)).toArray01(),W=I.properties.get("intensity"),re=[z.x,z.y,z.z],K=n.dK(Y,W),ae=n.dK(H,V);return{u_lighting_ambient_color:K,u_lighting_directional_dir:re,u_lighting_directional_color:ae,u_ground_radiance:xc(re,ae,K)}})(p,x,this.style);c.setLightsUniformValues(i,w)}}}uploadCommonUniforms(i,c,p,x,w){if(this.uploadCommonLightUniforms(i,c),this.terrain&&this.terrain.renderingToTexture)return;const A=this.style.fog;if(A){const I=A.getOpacity(this.transform.pitch),O=((z,k,H,V,X,Y,W,re,K,ae,ue,fe)=>{const xe=z.transform,ge=k.properties.get("color-use-theme")==="none",Te=k.properties.get("color").toNonPremultipliedRenderColor(ge?null:z.style.getLut(k.scope)).toArray01();Te[3]=V;const ye=z.frameCounter/1e3%1,[_e,Se]=k.properties.get("vertical-range");return{u_fog_matrix:H?xe.calculateFogTileMatrix(H):fe||z.identityMat,u_fog_range:k.getFovAdjustedRange(xe._fov),u_fog_color:Te,u_fog_horizon_blend:k.properties.get("horizon-blend"),u_fog_vertical_limit:[Math.min(_e,Se),Se],u_fog_temporal_offset:ye,u_frustum_tl:X,u_frustum_tr:Y,u_frustum_br:W,u_frustum_bl:re,u_globe_pos:K,u_globe_radius:ae,u_viewport:ue,u_globe_transition:n.aj(xe.zoom),u_is_globe:+(xe.projection.name==="globe")}})(this,A,p,I,this.transform.frustumCorners.TL,this.transform.frustumCorners.TR,this.transform.frustumCorners.BR,this.transform.frustumCorners.BL,this.transform.globeCenterInViewSpace,this.transform.globeRadius,[this.transform.width*n.o.devicePixelRatio,this.transform.height*n.o.devicePixelRatio],x);c.setFogUniformValues(i,O)}w&&c.setCutoffUniformValues(i,w.uniformValues)}setTileLoadedFlag(i){this.tileLoaded=i}saveCanvasCopy(){const i=this.canvasCopy();i&&(this.frameCopies.push(i),this.tileLoaded=!1)}canvasCopy(){const i=this.context.gl,c=i.createTexture();return i.bindTexture(i.TEXTURE_2D,c),i.copyTexImage2D(i.TEXTURE_2D,0,i.RGBA,0,0,i.drawingBufferWidth,i.drawingBufferHeight,0),c}getCanvasCopiesAndTimestamps(){return{canvasCopies:this.frameCopies,timeStamps:this.loadTimeStamps}}averageElevationNeedsEasing(){if(!this.transform._elevation)return!1;const i=this.style&&this.style.fog;return!!i&&i.getOpacity(this.transform.pitch)!==0}getBackgroundTiles(){const i=this._backgroundTiles,c=this._backgroundTiles={},p=this.transform.coveringTiles({tileSize:512});for(const x of p)c[x.key]=i[x.key]||new Hc(x,512,this.transform.tileZoom,this,void 0,this.worldview);return c}clearBackgroundTiles(){this._backgroundTiles={}}isSourceForClippingOrConflation(i,c){return!(!i.is3D(!(!this.terrain||!this.terrain.enabled))||i.type!=="clip"&&i.type!=="building"&&(i.minzoom&&i.minzoom>this.transform.zoom||(this.style._clipLayerPresent||i.sourceLayer!=="building"&&i.sourceLayer!=="procedural_buildings")&&(!c||c.type!=="batched-model")))}isTileAffectedByFog(i){if(!this.style||!this.style.fog)return!1;if(this.transform.projection.name==="globe")return!0;let c=this._cachedTileFogOpacities[i.key];return c||(this._cachedTileFogOpacities[i.key]=c=this.style.fog.getOpacityForTile(i)),c[0]>=lr||c[1]>=lr}setupDepthForOcclusion(i,c,p){const x=this.context,w=x.gl,A=!!p;var I;p||(p={u_dem:2,u_dem_prev:4,u_dem_tl:[0,0],u_dem_tl_prev:[0,0],u_dem_scale:0,u_dem_scale_prev:0,u_dem_size:0,u_dem_lerp:1,u_depth:3,u_depth_size_inv:[0,0],u_depth_range_unpack:[0,1],u_occluder_half_size:16,u_occlusion_depth_offset:-1e-4,u_exaggeration:0}),x.activeTexture.set(w.TEXTURE3),i&&this.depthFBO&&this.depthTexture?(this.depthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),p.u_depth_size_inv=[1/this.depthFBO.width,1/this.depthFBO.height],p.u_depth_range_unpack=[2/((I=this.depthRangeFor3D)[1]-I[0]),-1-2*I[0]/(I[1]-I[0])],p.u_occluder_half_size=.5*this.occlusionParams.occluderSize,p.u_occlusion_depth_offset=this.occlusionParams.depthOffset):this.emptyDepthTexture.bind(w.NEAREST,w.CLAMP_TO_EDGE),x.activeTexture.set(w.TEXTURE0),A||c.setTerrainUniformValues(x,p)}}function pd(g,i){let c=!1,p=null;const x=()=>{p=null,c&&(g(),p=setTimeout(x,i),c=!1)};return()=>(c=!0,p||x(),p)}class bp{constructor(i){this._hashName=i&&encodeURIComponent(i),n.aY(["_getCurrentHash","_onHashChange","_updateHash"],this),this._updateHash=pd(this._updateHashUnthrottled.bind(this),300)}addTo(i){return this._map=i,window.addEventListener("hashchange",this._onHashChange,!1),i.on("moveend",this._updateHash),this}remove(){return this._map?(this._map.off("moveend",this._updateHash),window.removeEventListener("hashchange",this._onHashChange,!1),clearTimeout(this._updateHash()),this._map=void 0,this):this}getHashString(){const i=this._map;if(!i)return"";const c=Rc(i);if(this._hashName){const p=this._hashName;let x=!1;const w=location.hash.slice(1).split("&").map((A=>{const I=A.split("=")[0];return I===p?(x=!0,`${I}=${c}`):A})).filter((A=>A));return x||w.push(`${p}=${c}`),`#${w.join("&")}`}return`#${c}`}_getCurrentHash(){const i=location.hash.replace("#","");if(this._hashName){let c;return i.split("&").map((p=>p.split("="))).forEach((p=>{p[0]===this._hashName&&(c=p)})),(c&&c[1]||"").split("/")}return i.split("/")}_onHashChange(){const i=this._map;if(!i)return!1;const c=this._getCurrentHash();if(c.length>=3&&!c.some((p=>isNaN(Number(p))))){const p=i.dragRotate.isEnabled()&&i.touchZoomRotate.isEnabled()?+(c[3]||0):i.getBearing();return i.jumpTo({center:[+c[2],+c[1]],zoom:+c[0],bearing:p,pitch:+(c[4]||0)}),!0}return!1}_updateHashUnthrottled(){history.replaceState(history.state,"",location.href.replace(/(#.+)?$/,this.getHashString()))}}function Rc(g,i){const c=g.getCenter(),p=Math.round(100*g.getZoom())/100,x=Math.ceil((p*Math.LN2+Math.log(512/360/.5))/Math.LN10),w=Math.pow(10,x),A=Math.round(c.lng*w)/w,I=Math.round(c.lat*w)/w,O=g.getBearing(),z=g.getPitch();let k=i?`/${A}/${I}/${p}`:`${p}/${I}/${A}`;return(O||z)&&(k+="/"+Math.round(10*O)/10),z&&(k+=`/${Math.round(z)}`),k}const fa={linearity:.3,easing:n.eK(0,0,.3,1)},Po=Object.assign({deceleration:2500,maxSpeed:1400},fa),Ea=Object.assign({deceleration:20,maxSpeed:1400},fa),il=Object.assign({deceleration:1e3,maxSpeed:360},fa),wp=Object.assign({deceleration:1e3,maxSpeed:90},fa);class Ll{constructor(i){this._map=i,this.clear()}clear(){this._inertiaBuffer=[]}record(i){this._drainInertiaBuffer(),this._inertiaBuffer.push({time:n.o.now(),settings:i})}_drainInertiaBuffer(){const i=this._inertiaBuffer,c=n.o.now();for(;i.length>0&&c-i[0].time>160;)i.shift()}_onMoveEnd(i){if(this._map._prefersReducedMotion()||(this._drainInertiaBuffer(),this._inertiaBuffer.length<2))return;const c={zoom:0,bearing:0,pitch:0,pan:new n.P(0,0),pinchAround:void 0,around:void 0};for(const{settings:w}of this._inertiaBuffer)c.zoom+=w.zoomDelta||0,c.bearing+=w.bearingDelta||0,c.pitch+=w.pitchDelta||0,w.panDelta&&c.pan._add(w.panDelta),w.around&&(c.around=w.around),w.pinchAround&&(c.pinchAround=w.pinchAround);const p=this._inertiaBuffer[this._inertiaBuffer.length-1].time-this._inertiaBuffer[0].time,x={};if(c.pan.mag()){const w=no(c.pan.mag(),p,Object.assign({},Po,i||{}));x.offset=c.pan.mult(w.amount/c.pan.mag()),x.center=this._map.transform.center,Lo(x,w)}if(c.zoom){const w=no(c.zoom,p,Ea);x.zoom=this._map.transform.zoom+w.amount,Lo(x,w)}if(c.bearing){const w=no(c.bearing,p,il);x.bearing=this._map.transform.bearing+n.aA(w.amount,-179,179),Lo(x,w)}if(c.pitch){const w=no(c.pitch,p,wp);x.pitch=this._map.transform.pitch+w.amount,Lo(x,w)}if(x.zoom||x.bearing){const w=c.pinchAround===void 0?c.around:c.pinchAround;x.around=w?this._map.unproject(w):this._map.getCenter()}return this.clear(),x.noMoveStart=!0,x}}function Lo(g,i){(!g.duration||g.duration<i.duration)&&(g.duration=i.duration,g.easing=i.easing)}function no(g,i,c){const{maxSpeed:p,linearity:x,deceleration:w}=c,A=n.aA(g*x/(i/1e3),-p,p),I=Math.abs(A)/(w*x);return{easing:c.easing,duration:1e3*I,amount:A*(I/2)}}class Un extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,p,x={}){const w=Ft(c.getCanvasContainer(),p),A=c.unproject(w);super(i,Object.assign({point:w,lngLat:A,originalEvent:p},x)),this._defaultPrevented=!1,this.target=c}}class yu extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c,p){const x=i==="touchend"?p.changedTouches:p.touches,w=Yt(c.getCanvasContainer(),x),A=w.map((O=>c.unproject(O))),I=w.reduce(((O,z,k,H)=>O.add(z.div(H.length))),new n.P(0,0));super(i,{points:w,point:I,lngLats:A,lngLat:c.unproject(I),originalEvent:p}),this._defaultPrevented=!1}}class sf extends n.z{preventDefault(){this._defaultPrevented=!0}get defaultPrevented(){return this._defaultPrevented}constructor(i,c){super("wheel",{originalEvent:c}),this._defaultPrevented=!1}}class Sp{constructor(i,c){this._map=i,this._clickTolerance=c.clickTolerance}reset(){this._mousedownPos=void 0}wheel(i){return this._firePreventable(new sf(this._map,i))}mousedown(i,c){return this._mousedownPos=c,this._firePreventable(new Un(i.type,this._map,i))}mouseup(i){this._map.fire(new Un(i.type,this._map,i))}preclick(i){const c=new MouseEvent("preclick",i);this._map.fire(new Un(c.type,this._map,c))}click(i,c){this._mousedownPos&&this._mousedownPos.dist(c)>=this._clickTolerance||(this.preclick(i),this._map.fire(new Un(i.type,this._map,i)))}dblclick(i){return this._firePreventable(new Un(i.type,this._map,i))}mouseover(i){this._map.fire(new Un(i.type,this._map,i))}mouseout(i){this._map.fire(new Un(i.type,this._map,i))}touchstart(i){return this._firePreventable(new yu(i.type,this._map,i))}touchmove(i){this._map.fire(new yu(i.type,this._map,i))}touchend(i){this._map.fire(new yu(i.type,this._map,i))}touchcancel(i){this._map.fire(new yu(i.type,this._map,i))}_firePreventable(i){if(this._map.fire(i),i.defaultPrevented)return{}}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Tp{constructor(i){this._map=i}reset(){this._delayContextMenu=!1,this._contextMenuEvent=void 0}mousemove(i){this._map.fire(new Un(i.type,this._map,i))}mousedown(){this._delayContextMenu=!0}mouseup(){this._delayContextMenu=!1,this._contextMenuEvent&&(this._map.fire(new Un("contextmenu",this._map,this._contextMenuEvent)),delete this._contextMenuEvent)}contextmenu(i){this._delayContextMenu?this._contextMenuEvent=i:this._map.fire(new Un(i.type,this._map,i)),this._map.listens("contextmenu")&&i.preventDefault()}isEnabled(){return!0}isActive(){return!1}enable(){}disable(){}}class Cn{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._container=i.getContainer(),this._clickTolerance=c.clickTolerance||1}isEnabled(){return!!this._enabled}isActive(){return!!this._active}enable(){this.isEnabled()||(this._enabled=!0)}disable(){this.isEnabled()&&(this._enabled=!1)}mousedown(i,c){this.isEnabled()&&i.shiftKey&&i.button===0&&(Ze(),this._startPos=this._lastPos=c,this._active=!0)}mousemoveWindow(i,c){if(!this._active)return;const p=c,x=this._startPos,w=this._lastPos;if(!x||!w||w.equals(p)||!this._box&&p.dist(x)<this._clickTolerance)return;this._lastPos=p,this._box||(this._box=ne("div","mapboxgl-boxzoom",this._container),this._container.classList.add("mapboxgl-crosshair"),this._fireEvent("boxzoomstart",i));const A=Math.min(x.x,p.x),I=Math.max(x.x,p.x),O=Math.min(x.y,p.y),z=Math.max(x.y,p.y);this._map._requestDomTask((()=>{this._box&&(this._box.style.transform=`translate(${A}px,${O}px)`,this._box.style.width=I-A+"px",this._box.style.height=z-O+"px")}))}mouseupWindow(i,c){if(!this._active)return;const p=this._startPos,x=c;if(p&&i.button===0){if(this.reset(),Ct(),p.x!==x.x||p.y!==x.y)return this._map.fire(new n.z("boxzoomend",{originalEvent:i})),{cameraAnimation:w=>w.fitScreenCoordinates(p,x,this._map.getBearing(),{linear:!1})};this._fireEvent("boxzoomcancel",i)}}keydown(i){this._active&&i.keyCode===27&&(this.reset(),this._fireEvent("boxzoomcancel",i))}blur(){this.reset()}reset(){this._active=!1,this._container.classList.remove("mapboxgl-crosshair"),this._box&&(this._box.remove(),this._box=null),$e(),delete this._startPos,delete this._lastPos}_fireEvent(i,c){return this._map.fire(new n.z(i,{originalEvent:c}))}}function vu(g,i){const c={};for(let p=0;p<g.length;p++)c[g[p].identifier]=i[p];return c}class Ap{constructor(i){this.reset(),this.numTouches=i.numTouches}reset(){this.centroid=void 0,this.startTime=0,this.touches={},this.aborted=!1}touchstart(i,c,p){(this.centroid||p.length>this.numTouches)&&(this.aborted=!0),this.aborted||(this.startTime===0&&(this.startTime=i.timeStamp),p.length===this.numTouches&&(this.centroid=(function(x){const w=new n.P(0,0);for(const A of x)w._add(A);return w.div(x.length)})(c),this.touches=vu(p,c)))}touchmove(i,c,p){if(this.aborted||!this.centroid)return;const x=vu(p,c);for(const w in this.touches){const A=x[w];(!A||A.dist(this.touches[w])>30)&&(this.aborted=!0)}}touchend(i,c,p){if((!this.centroid||i.timeStamp-this.startTime>500)&&(this.aborted=!0),p.length===0){const x=!this.aborted&&this.centroid;if(this.reset(),x)return x}}}class lf{constructor(i){this.singleTap=new Ap(i),this.numTaps=i.numTaps,this.reset()}reset(){this.lastTime=1/0,this.lastTap=void 0,this.count=0,this.singleTap.reset()}touchstart(i,c,p){this.singleTap.touchstart(i,c,p)}touchmove(i,c,p){this.singleTap.touchmove(i,c,p)}touchend(i,c,p){const x=this.singleTap.touchend(i,c,p);if(x){const w=i.timeStamp-this.lastTime<500,A=!this.lastTap||this.lastTap.dist(x)<30;if(w&&A||this.reset(),this.count++,this.lastTime=i.timeStamp,this.lastTap=x,this.count===this.numTaps)return this.reset(),x}}}class xu{constructor(){this._zoomIn=new lf({numTouches:1,numTaps:2}),this._zoomOut=new lf({numTouches:2,numTaps:1}),this.reset()}reset(){this._active=!1,this._zoomIn.reset(),this._zoomOut.reset()}touchstart(i,c,p){this._zoomIn.touchstart(i,c,p),this._zoomOut.touchstart(i,c,p)}touchmove(i,c,p){this._zoomIn.touchmove(i,c,p),this._zoomOut.touchmove(i,c,p)}touchend(i,c,p){const x=this._zoomIn.touchend(i,c,p),w=this._zoomOut.touchend(i,c,p);return x?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()+1,around:A.unproject(x)},{originalEvent:i})}):w?(this._active=!0,i.preventDefault(),setTimeout((()=>this.reset()),0),{cameraAnimation:A=>A.easeTo({duration:300,zoom:A.getZoom()-1,around:A.unproject(w)},{originalEvent:i})}):void 0}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}const cf={0:1,2:2},md={Control:"ctrlKey",Alt:"altKey",Shift:"shiftKey",Meta:"metaKey"};class uh{constructor(i){this.reset(),this._clickTolerance=i.clickTolerance||1}blur(){this.reset()}reset(){this._active=!1,this._moved=!1,this._lastPoint=void 0,this._eventButton=void 0}_correctButton(i,c){return!1}_move(i,c){return{}}mousedown(i,c){if(this._lastPoint)return;const p=hr(i);this._correctButton(i,p)&&(this._lastPoint=c,this._eventButton=p)}mousemoveWindow(i,c){const p=this._lastPoint;if(p){if(i.preventDefault(),this._eventButton!=null&&(function(x,w){const A=cf[w];return x.buttons===void 0||(x.buttons&A)!==A})(i,this._eventButton))this.reset();else if(this._moved||!(c.dist(p)<this._clickTolerance))return this._moved=!0,this._lastPoint=c,this._move(p,c)}}mouseupWindow(i){this._lastPoint&&hr(i)===this._eventButton&&(this._moved&&Ct(),this.reset())}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class hh extends uh{mousedown(i,c){super.mousedown(i,c),this._lastPoint&&(this._active=!0)}_correctButton(i,c){return c===0&&!i.ctrlKey}_move(i,c){return{around:c,panDelta:c.sub(i)}}}class gd extends uh{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?md[i.pitchRotateKey]:void 0}_correctButton(i,c){return this._pitchRotateKey?c===0&&i[this._pitchRotateKey]:c===0&&i.ctrlKey||c===2}_move(i,c){const p=.8*(c.x-i.x);if(p)return this._active=!0,{bearingDelta:p}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class Ep extends uh{constructor(i){super(i),this._pitchRotateKey=i.pitchRotateKey?md[i.pitchRotateKey]:void 0}_correctButton(i,c){return this._pitchRotateKey?c===0&&i[this._pitchRotateKey]:c===0&&i.ctrlKey||c===2}_move(i,c){const p=-.5*(c.y-i.y);if(p)return this._active=!0,{pitchDelta:p}}contextmenu(i){this._pitchRotateKey||i.preventDefault()}}class Cp{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._minTouches=1,this._clickTolerance=c.clickTolerance||1,this.reset(),n.aY(["_addTouchPanBlocker","_showTouchPanBlockerAlert"],this)}reset(){this._active=!1,this._touches={},this._sum=new n.P(0,0)}touchstart(i,c,p){return this._calculateTransform(i,c,p)}touchmove(i,c,p){if(this._active&&!(p.length<this._minTouches)){if(this._map._cooperativeGestures&&!this._map.isMoving()){if(p.length===1&&!n.eL())return void this._showTouchPanBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}return i.cancelable&&i.preventDefault(),this._calculateTransform(i,c,p)}}touchend(i,c,p){this._calculateTransform(i,c,p),this._active&&p.length<this._minTouches&&this.reset()}touchcancel(){this.reset()}_calculateTransform(i,c,p){p.length>0&&(this._active=!0);const x=vu(p,c),w=new n.P(0,0),A=new n.P(0,0);let I=0;for(const z in x){const k=x[z],H=this._touches[z];H&&(w._add(k),A._add(k.sub(H)),I++,x[z]=k)}if(this._touches=x,I<this._minTouches||!A.mag())return;const O=A.div(I);return this._sum._add(O),this._sum.mag()<this._clickTolerance?void 0:{around:w.div(I),panDelta:O}}enable(){this._enabled=!0,this._map._cooperativeGestures&&(this._addTouchPanBlocker(),this._el.classList.add("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page"))}disable(){this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove(),this._el.classList.remove("mapboxgl-touch-pan-blocker-override","mapboxgl-scrollable-page")),this.reset()}isEnabled(){return!!this._enabled}isActive(){return!!this._active}_addTouchPanBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-touch-pan-blocker",this._map._container),this._alertContainer.textContent=this._map._getUIString("TouchPanBlocker.Message"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showTouchPanBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-touch-pan-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-touch-pan-blocker-show"),this._alertContainer.removeAttribute("role")}),500)}}class so{constructor(){this.reset()}reset(){this._active=!1,this._firstTwoTouches=void 0}_start(i){}_move(i,c,p){return{}}touchstart(i,c,p){this._firstTwoTouches||p.length<2||(this._firstTwoTouches=[p[0].identifier,p[1].identifier],this._start([c[0],c[1]]))}touchmove(i,c,p){const x=this._firstTwoTouches;if(!x)return;i.preventDefault();const[w,A]=x,I=po(p,c,w),O=po(p,c,A);if(!I||!O)return;const z=this._aroundCenter?null:I.add(O).div(2);return this._move([I,O],z,i)}touchend(i,c,p){if(!this._firstTwoTouches)return;const[x,w]=this._firstTwoTouches,A=po(p,c,x),I=po(p,c,w);A&&I||(this._active&&Ct(),this.reset())}touchcancel(){this.reset()}enable(i){this._enabled=!0,this._aroundCenter=!!i&&i.around==="center"}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}function po(g,i,c){for(let p=0;p<g.length;p++)if(g[p].identifier===c)return i[p]}function _d(g,i){return Math.log2(g/i)}class zm extends so{reset(){super.reset(),this._distance=0,this._startDistance=0}_start(i){this._startDistance=this._distance=i[0].dist(i[1])}_move(i,c){const p=this._distance;if(this._distance=i[0].dist(i[1]),this._active||!(Math.abs(_d(this._distance,this._startDistance))<.1))return this._active=!0,{zoomDelta:_d(this._distance,p),pinchAround:c}}}function Ip(g,i){return 180*g.angleWith(i)/Math.PI}class Fm extends so{reset(){super.reset(),this._minDiameter=0,this._startVector=void 0,this._vector=void 0}_start(i){this._startVector=this._vector=i[0].sub(i[1]),this._minDiameter=i[0].dist(i[1])}_move(i,c){const p=this._vector;if(this._vector=i[0].sub(i[1]),p&&(this._active||!this._isBelowThreshold(this._vector)))return this._active=!0,{bearingDelta:Ip(this._vector,p),pinchAround:c}}_isBelowThreshold(i){this._minDiameter=Math.min(this._minDiameter,i.mag());const c=25/(Math.PI*this._minDiameter)*360,p=this._startVector;if(!p)return!1;const x=Ip(i,p);return Math.abs(x)<c}}function yd(g){return Math.abs(g.y)>Math.abs(g.x)}class vd extends so{constructor(i){super(),this._map=i}reset(){super.reset(),this._valid=void 0,this._firstMove=void 0,this._lastPoints=void 0}_start(i){this._lastPoints=i,yd(i[0].sub(i[1]))&&(this._valid=!1)}_move(i,c,p){const x=this._lastPoints;if(!x)return;const w=i[0].sub(x[0]),A=i[1].sub(x[1]);return this._map._cooperativeGestures&&!n.eL()&&p.touches.length<3||(this._valid=this.gestureBeginsVertically(w,A,p.timeStamp),!this._valid)?void 0:(this._lastPoints=i,this._active=!0,{pitchDelta:(w.y+A.y)/2*-.5})}gestureBeginsVertically(i,c,p){if(this._valid!==void 0)return this._valid;const x=i.mag()>=2,w=c.mag()>=2;if(!x&&!w)return;if(!x||!w)return this._firstMove==null&&(this._firstMove=p),p-this._firstMove<100&&void 0;const A=i.y>0==c.y>0;return yd(i)&&yd(c)&&A}}const Rp={panStep:100,bearingStep:15,pitchStep:10};class km{constructor(){const i=Rp;this._panStep=i.panStep,this._bearingStep=i.bearingStep,this._pitchStep=i.pitchStep,this._rotationDisabled=!1}blur(){this.reset()}reset(){this._active=!1}keydown(i){if(i.altKey||i.ctrlKey||i.metaKey)return;let c=0,p=0,x=0,w=0,A=0;switch(i.keyCode){case 61:case 107:case 171:case 187:c=1;break;case 189:case 109:case 173:c=-1;break;case 37:i.shiftKey?p=-1:(i.preventDefault(),w=-1);break;case 39:i.shiftKey?p=1:(i.preventDefault(),w=1);break;case 38:i.shiftKey?x=1:(i.preventDefault(),A=-1);break;case 40:i.shiftKey?x=-1:(i.preventDefault(),A=1);break;default:return}return this._rotationDisabled&&(p=0,x=0),{cameraAnimation:I=>{const O=I.getZoom();I.easeTo({duration:300,easeId:"keyboardHandler",easing:Nm,zoom:c?Math.round(O)+c*(i.shiftKey?2:1):O,bearing:I.getBearing()+p*this._bearingStep,pitch:I.getPitch()+x*this._pitchStep,offset:[-w*this._panStep,-A*this._panStep],center:I.getCenter()},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}disableRotation(){this._rotationDisabled=!0}enableRotation(){this._rotationDisabled=!1}}function Nm(g){return g*(2-g)}const Mp=4.000244140625,Dp=1/450;class Op{constructor(i,c){this._map=i,this._el=i.getCanvasContainer(),this._handler=c,this._delta=0,this._lastDelta=0,this._defaultZoomRate=.01,this._wheelZoomRate=Dp,n.aY(["_onTimeout","_addScrollZoomBlocker","_showBlockerAlert"],this)}setZoomRate(i){this._defaultZoomRate=i}setWheelZoomRate(i){this._wheelZoomRate=i}isEnabled(){return!!this._enabled}isActive(){return this._active||this._finishTimeout!==void 0}isZooming(){return!!this._zooming}enable(i){this.isEnabled()||(this._enabled=!0,this._aroundCenter=!!i&&i.around==="center",this._map._cooperativeGestures&&this._addScrollZoomBlocker())}disable(){this.isEnabled()&&(this._enabled=!1,this._map._cooperativeGestures&&(clearTimeout(this._alertTimer),this._alertContainer.remove()))}wheel(i){if(!this.isEnabled())return;if(this._map._cooperativeGestures){if(!(i.ctrlKey||i.metaKey||this.isZooming()||n.eL()))return void this._showBlockerAlert();this._alertContainer.style.visibility!=="hidden"&&(this._alertContainer.style.visibility="hidden",clearTimeout(this._alertTimer))}let c=i.deltaMode===WheelEvent.DOM_DELTA_LINE?40*i.deltaY:i.deltaY;const p=n.o.now(),x=p-(this._lastWheelEventTime||0);this._lastWheelEventTime=p,c!==0&&c%Mp==0?this._type="wheel":c!==0&&Math.abs(c)<4?this._type="trackpad":x>400?(this._type=null,this._lastValue=c,this._timeout=window.setTimeout(this._onTimeout,40,i)):this._type||(this._type=Math.abs(x*c)<200?"trackpad":"wheel",this._timeout&&(clearTimeout(this._timeout),this._timeout=null,c+=this._lastValue)),i.shiftKey&&c&&(c/=4),this._type&&(this._lastWheelEvent=i,this._delta-=c,this._active||this._start(i)),i.preventDefault()}_onTimeout(i){this._type="wheel",this._delta-=this._lastValue,this._active||this._start(i)}_start(i){if(!this._delta)return;this._frameId&&(this._frameId=null),this._active=!0,this.isZooming()||(this._zooming=!0),this._finishTimeout&&(clearTimeout(this._finishTimeout),delete this._finishTimeout);const c=Ft(this._el,i);this._aroundPoint=this._aroundCenter?this._map.transform.centerPoint:c,this._aroundCoord=this._map.transform.pointCoordinate3D(this._aroundPoint),this._targetZoom=void 0,this._frameId||(this._frameId=!0,this._handler._triggerRenderFrame())}renderFrame(){if(!this._frameId||(this._frameId=null,!this.isActive()))return;const i=this._map.transform;this._type==="wheel"&&i.projection.wrap&&(i._center.lng>=180||i._center.lng<=-180)&&(this._prevEase=null,this._easing=null,this._lastWheelEvent=null,this._lastWheelEventTime=0);const c=()=>i._terrainEnabled()&&this._aroundCoord?i.computeZoomRelativeTo(this._aroundCoord):i.zoom;if(this._delta!==0){const z=this._type==="wheel"&&Math.abs(this._delta)>Mp?this._wheelZoomRate:this._defaultZoomRate;let k=2/(1+Math.exp(-Math.abs(this._delta*z)));this._delta<0&&k!==0&&(k=1/k);const H=c(),V=Math.pow(2,H),X=typeof this._targetZoom=="number"?i.zoomScale(this._targetZoom):V;this._targetZoom=Math.min(i.maxZoom,Math.max(i.minZoom,i.scaleZoom(X*k))),this._type==="wheel"&&(this._startZoom=H,this._easing=this._smoothOutEasing(200)),this._lastDelta=this._delta,this._delta=0}const p=typeof this._targetZoom=="number"?this._targetZoom:c(),x=this._startZoom,w=this._easing;let A,I=!1;if(this._type==="wheel"&&x&&w){const z=Math.min((n.o.now()-this._lastWheelEventTime)/200,1),k=w(z);A=n.ak(x,p,k),z<1?this._frameId||(this._frameId=!0):I=!0}else A=p,I=!0;this._active=!0,I&&(this._active=!1,this._finishTimeout=window.setTimeout((()=>{this._zooming=!1,this._handler._triggerRenderFrame(),delete this._targetZoom,delete this._finishTimeout}),200));let O=A-c();return O*this._lastDelta<0&&(O=0),{noInertia:!0,needsRenderFrame:!I,zoomDelta:O,around:this._aroundPoint,aroundCoord:this._aroundCoord,originalEvent:this._lastWheelEvent}}_smoothOutEasing(i){let c=n.eM;if(this._prevEase){const p=this._prevEase,x=(n.o.now()-p.start)/p.duration,w=p.easing(x+.01)-p.easing(x),A=.27/Math.sqrt(w*w+1e-4)*.01,I=Math.sqrt(.0729-A*A);c=n.eK(A,I,.25,1)}return this._prevEase={start:n.o.now(),duration:i,easing:c},c}blur(){this.reset()}reset(){this._active=!1}_addScrollZoomBlocker(){this._map&&!this._alertContainer&&(this._alertContainer=ne("div","mapboxgl-scroll-zoom-blocker",this._map._container),this._alertContainer.textContent=/(Mac|iPad)/i.test(navigator.userAgent)?this._map._getUIString("ScrollZoomBlocker.CmdMessage"):this._map._getUIString("ScrollZoomBlocker.CtrlMessage"),this._alertContainer.style.fontSize=`${Math.max(10,Math.min(24,Math.floor(.05*this._el.clientWidth)))}px`)}_showBlockerAlert(){this._alertContainer.style.visibility="visible",this._alertContainer.classList.add("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.setAttribute("role","alert"),clearTimeout(this._alertTimer),this._alertTimer=window.setTimeout((()=>{this._alertContainer.classList.remove("mapboxgl-scroll-zoom-blocker-show"),this._alertContainer.removeAttribute("role")}),200)}}class Pp{constructor(i,c){this._clickZoom=i,this._tapZoom=c}enable(){this._clickZoom.enable(),this._tapZoom.enable()}disable(){this._clickZoom.disable(),this._tapZoom.disable()}isEnabled(){return this._clickZoom.isEnabled()&&this._tapZoom.isEnabled()}isActive(){return this._clickZoom.isActive()||this._tapZoom.isActive()}}class Vm{constructor(){this.reset()}reset(){this._active=!1}blur(){this.reset()}dblclick(i,c){return i.preventDefault(),{cameraAnimation:p=>{p.easeTo({duration:300,zoom:p.getZoom()+(i.shiftKey?-1:1),around:p.unproject(c)},{originalEvent:i})}}}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Um{constructor(){this._tap=new lf({numTouches:1,numTaps:1}),this.reset()}reset(){this._active=!1,this._swipePoint=void 0,this._swipeTouch=0,this._tapTime=0,this._tap.reset()}touchstart(i,c,p){this._swipePoint||(this._tapTime&&i.timeStamp-this._tapTime>500&&this.reset(),this._tapTime?p.length>0&&(this._swipePoint=c[0],this._swipeTouch=p[0].identifier):this._tap.touchstart(i,c,p))}touchmove(i,c,p){if(this._tapTime){if(this._swipePoint){if(p[0].identifier!==this._swipeTouch)return;const x=c[0],w=x.y-this._swipePoint.y;return this._swipePoint=x,i.preventDefault(),this._active=!0,{zoomDelta:w/128}}}else this._tap.touchmove(i,c,p)}touchend(i,c,p){this._tapTime?this._swipePoint&&p.length===0&&this.reset():this._tap.touchend(i,c,p)&&(this._tapTime=i.timeStamp)}touchcancel(){this.reset()}enable(){this._enabled=!0}disable(){this._enabled=!1,this.reset()}isEnabled(){return this._enabled}isActive(){return this._active}}class Lp{constructor(i,c,p){this._el=i,this._mousePan=c,this._touchPan=p}enable(i){this._inertiaOptions=i||{},this._mousePan.enable(),this._touchPan.enable(),this._el.classList.add("mapboxgl-touch-drag-pan")}disable(){this._mousePan.disable(),this._touchPan.disable(),this._el.classList.remove("mapboxgl-touch-drag-pan")}isEnabled(){return this._mousePan.isEnabled()&&this._touchPan.isEnabled()}isActive(){return this._mousePan.isActive()||this._touchPan.isActive()}}class jm{constructor(i,c,p){this._pitchWithRotate=i.pitchWithRotate,this._mouseRotate=c,this._mousePitch=p}enable(){this._mouseRotate.enable(),this._pitchWithRotate&&this._mousePitch.enable()}disable(){this._mouseRotate.disable(),this._mousePitch.disable()}isEnabled(){return this._mouseRotate.isEnabled()&&(!this._pitchWithRotate||this._mousePitch.isEnabled())}isActive(){return this._mouseRotate.isActive()||this._mousePitch.isActive()}}class hn{constructor(i,c,p,x){this._el=i,this._touchZoom=c,this._touchRotate=p,this._tapDragZoom=x,this._rotationDisabled=!1,this._enabled=!0}enable(i){this._touchZoom.enable(i),this._rotationDisabled||this._touchRotate.enable(i),this._tapDragZoom.enable(),this._el.classList.add("mapboxgl-touch-zoom-rotate")}disable(){this._touchZoom.disable(),this._touchRotate.disable(),this._tapDragZoom.disable(),this._el.classList.remove("mapboxgl-touch-zoom-rotate")}isEnabled(){return this._touchZoom.isEnabled()&&(this._rotationDisabled||this._touchRotate.isEnabled())&&this._tapDragZoom.isEnabled()}isActive(){return this._touchZoom.isActive()||this._touchRotate.isActive()||this._tapDragZoom.isActive()}disableRotation(){this._rotationDisabled=!0,this._touchRotate.disable()}enableRotation(){this._rotationDisabled=!1,this._touchZoom.isEnabled()&&this._touchRotate.enable()}}const fh=g=>g.zoom||g.drag||g.pitch||g.rotate;class Vg extends n.z{}class Mc{constructor(){this.constants=[1,1,.01],this.radius=0}setup(i,c){const p=n.av([],c,i);this.radius=n.ag(p[2]<0?n.eO([],p,this.constants):[p[0],p[1],0])}projectRay(i){n.eO(i,i,this.constants),n.aw(i,i),n.eP(i,i,this.constants);const c=n.c4([],i,this.radius);if(c[2]>0){const p=n.c4([],[0,0,1],n.bJ(c,[0,0,1])),x=n.c4([],n.aw([],[c[0],c[1],0]),this.radius),w=n.d7([],c,n.c4([],n.av([],n.d7([],x,p),c),2));c[0]=w[0],c[1]=w[1]}return c}}function uf(g){return g.panDelta&&g.panDelta.mag()||g.zoomDelta||g.bearingDelta||g.pitchDelta}class xd{constructor(i,c){this._map=i,this._el=this._map.getCanvasContainer(),this._handlers=[],this._handlersById={},this._changes=[],this._inertia=new Ll(i),this._bearingSnap=c.bearingSnap,this._previousActiveHandlers={},this._trackingEllipsoid=new Mc,this._dragOrigin=null,this._eventsInProgress={},this._addDefaultHandlers(c),n.aY(["handleEvent","handleWindowEvent"],this);const p=this._el;this._listeners=[[p,"touchstart",{passive:!0}],[p,"touchmove",{passive:!1}],[p,"touchend",void 0],[p,"touchcancel",void 0],[p,"mousedown",void 0],[p,"mousemove",void 0],[p,"mouseup",void 0],[document,"mousemove",{capture:!0}],[document,"mouseup",void 0],[p,"mouseover",void 0],[p,"mouseout",void 0],[p,"dblclick",void 0],[p,"click",void 0],[p,"keydown",{capture:!1}],[p,"keyup",void 0],[p,"wheel",{passive:!1}],[p,"contextmenu",void 0],[window,"blur",void 0]];for(const[x,w,A]of this._listeners){const I=x===document?this.handleWindowEvent:this.handleEvent;x.addEventListener(w,I,A)}}destroy(){for(const[i,c,p]of this._listeners){const x=i===document?this.handleWindowEvent:this.handleEvent;i.removeEventListener(c,x,p)}}_addDefaultHandlers(i){const c=this._map,p=c.getCanvasContainer();this._add("mapEvent",new Sp(c,i));const x=c.boxZoom=new Cn(c,i);this._add("boxZoom",x);const w=new xu,A=new Vm;c.doubleClickZoom=new Pp(A,w),this._add("tapZoom",w),this._add("clickZoom",A);const I=new Um;this._add("tapDragZoom",I);const O=c.touchPitch=new vd(c);this._add("touchPitch",O);const z=new gd(i),k=new Ep(i);c.dragRotate=new jm(i,z,k),this._add("mouseRotate",z,["mousePitch"]),this._add("mousePitch",k,["mouseRotate"]);const H=new hh(i),V=new Cp(c,i);c.dragPan=new Lp(p,H,V),this._add("mousePan",H),this._add("touchPan",V,["touchZoom","touchRotate"]);const X=new Fm,Y=new zm;c.touchZoomRotate=new hn(p,Y,X,I),this._add("touchRotate",X,["touchPan","touchZoom"]),this._add("touchZoom",Y,["touchPan","touchRotate"]),this._add("blockableMapEvent",new Tp(c));const W=c.scrollZoom=new Op(c,this);this._add("scrollZoom",W,["mousePan"]);const re=c.keyboard=new km;this._add("keyboard",re);for(const K of["boxZoom","doubleClickZoom","tapDragZoom","touchPitch","dragRotate","dragPan","touchZoomRotate","scrollZoom","keyboard"])i.interactive&&i[K]&&c[K].enable(i[K])}_add(i,c,p){this._handlers.push({handlerName:i,handler:c,allowed:p}),this._handlersById[i]=c}stop(i){if(!this._updatingCamera){for(const{handler:c}of this._handlers)c.reset();this._inertia.clear(),this._fireEvents({},{},i),this._changes=[],this._originalZoom=void 0}}isActive(){for(const{handler:i}of this._handlers)if(i.isActive())return!0;return!1}isZooming(){return!!this._eventsInProgress.zoom||this._map.scrollZoom.isZooming()}isRotating(){return!!this._eventsInProgress.rotate}isMoving(){return!!fh(this._eventsInProgress)||this.isZooming()}_isDragging(){return!!this._eventsInProgress.drag}_blockedByActive(i,c,p){for(const x in i)if(x!==p&&(!c||c.indexOf(x)<0))return!0;return!1}handleWindowEvent(i){this.handleEvent(i,`${i.type}Window`)}_getMapTouches(i){const c=[];for(const p of i)this._el.contains(p.target)&&c.push(p);return c}handleEvent(i,c){this._updatingCamera=!0;const p=i.type==="renderFrame",x=p?void 0:i,w={needsRenderFrame:!1},A={},I={},O=i.touches?this._getMapTouches(i.touches):void 0,z=O?Yt(this._el,O):p?void 0:Ft(this._el,i);for(const{handlerName:V,handler:X,allowed:Y}of this._handlers){if(!X.isEnabled())continue;let W;this._blockedByActive(I,Y,V)?X.reset():X[c||i.type]&&(W=X[c||i.type](i,z,O),this.mergeHandlerResult(w,A,W,V,x),W&&W.needsRenderFrame&&this._triggerRenderFrame()),(W||X.isActive())&&(I[V]=X)}const k={};for(const V in this._previousActiveHandlers)I[V]||(k[V]=x);this._previousActiveHandlers=I,(Object.keys(k).length||uf(w))&&(this._changes.push([w,A,k]),this._triggerRenderFrame()),(Object.keys(I).length||uf(w))&&this._map._stop(!0),this._updatingCamera=!1;const{cameraAnimation:H}=w;H&&(this._inertia.clear(),this._fireEvents({},{},!0),this._changes=[],H(this._map))}mergeHandlerResult(i,c,p,x,w){if(!p)return;Object.assign(i,p);const A={handlerName:x,originalEvent:p.originalEvent||w};p.zoomDelta!==void 0&&(c.zoom=A),p.panDelta!==void 0&&(c.drag=A),p.pitchDelta!==void 0&&(c.pitch=A),p.bearingDelta!==void 0&&(c.rotate=A)}_applyChanges(){const i={},c={},p={};for(const[x,w,A]of this._changes)x.panDelta&&(i.panDelta=(i.panDelta||new n.P(0,0))._add(x.panDelta)),x.zoomDelta&&(i.zoomDelta=(i.zoomDelta||0)+x.zoomDelta),x.bearingDelta&&(i.bearingDelta=(i.bearingDelta||0)+x.bearingDelta),x.pitchDelta&&(i.pitchDelta=(i.pitchDelta||0)+x.pitchDelta),x.around!==void 0&&(i.around=x.around),x.aroundCoord!==void 0&&(i.aroundCoord=x.aroundCoord),x.pinchAround!==void 0&&(i.pinchAround=x.pinchAround),x.noInertia&&(i.noInertia=x.noInertia),Object.assign(c,w),Object.assign(p,A);this._updateMapTransform(i,c,p),this._changes=[]}_updateMapTransform(i,c,p){const x=this._map,w=x.transform,A=ae=>[ae.x,ae.y,ae.z];if((ae=>{const ue=this._eventsInProgress.drag;return ue&&!this._handlersById[ue.handlerName].isActive()})()&&!uf(i)){const ae=w.zoom;w.cameraElevationReference="sea",this._originalZoom!=null&&w._orthographicProjectionAtLowPitch&&w.projection.name!=="globe"&&w.pitch===0?(w.cameraElevationReference="ground",w.zoom=this._originalZoom):(w.recenterOnTerrain(),w.cameraElevationReference="ground"),ae!==w.zoom&&this._map._update(!0)}if(w._isCameraConstrained&&x._stop(!0),!uf(i))return void this._fireEvents(c,p,!0);let{panDelta:I,zoomDelta:O,bearingDelta:z,pitchDelta:k,around:H,aroundCoord:V,pinchAround:X}=i;w._isCameraConstrained&&(O>0&&(O=0),w._isCameraConstrained=!1),X!==void 0&&(H=X),(O||(ae=>c[ae]&&!this._eventsInProgress[ae])("drag"))&&H&&(this._dragOrigin=A(w.pointCoordinate3D(H)),this._originalZoom=w.zoom,this._trackingEllipsoid.setup(w._camera.position,this._dragOrigin)),w.cameraElevationReference="sea",x._stop(!0),H=H||x.transform.centerPoint,z&&(w.bearing+=z),k&&(w.pitch+=k),w._updateCameraState();const Y=[0,0,0];if(I)if(w.projection.name==="mercator"){const ae=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(H).dir),ue=this._trackingEllipsoid.projectRay(w.screenPointToMercatorRay(H.sub(I)).dir);Y[0]=ue[0]-ae[0],Y[1]=ue[1]-ae[1]}else{const ae=w.pointCoordinate(H);if(w.projection.name==="globe"){I=I.rotate(-w.angle);const ue=w._pixelsPerMercatorPixel/w.worldSize;Y[0]=-I.x*n.eN(n.a$(ae.y))*ue,Y[1]=-I.y*n.eN(w.center.lat)*ue}else{const ue=w.pointCoordinate(H.sub(I));ae&&ue&&(Y[0]=ue.x-ae.x,Y[1]=ue.y-ae.y)}}const W=w.zoom,re=[0,0,0];if(O){const ae=A(V||w.pointCoordinate3D(H)),ue={dir:n.aw([],n.av([],ae,w._camera.position))};if(ue.dir[2]<0){const fe=w.zoomDeltaToMovement(ae,O);n.c4(re,ue.dir,fe)}}const K=n.d7(Y,Y,re);w._translateCameraConstrained(K),O&&Math.abs(w.zoom-W)>1e-4&&w.recenterOnTerrain(),w.cameraElevationReference="ground",this._map._update(),i.noInertia||this._inertia.record(i),this._fireEvents(c,p,!0)}_fireEvents(i,c,p){const x=fh(this._eventsInProgress),w=fh(i),A={};for(const k in i){const{originalEvent:H}=i[k];this._eventsInProgress[k]||(A[`${k}start`]=H),this._eventsInProgress[k]=i[k]}!x&&w&&this._fireEvent("movestart",w.originalEvent);for(const k in A)this._fireEvent(k,A[k]);w&&this._fireEvent("move",w.originalEvent);for(const k in i){const{originalEvent:H}=i[k];this._fireEvent(k,H)}const I={};let O;for(const k in this._eventsInProgress){const{handlerName:H,originalEvent:V}=this._eventsInProgress[k];this._handlersById[H].isActive()||(delete this._eventsInProgress[k],O=c[H]||V,I[`${k}end`]=O)}for(const k in I)this._fireEvent(k,I[k]);const z=fh(this._eventsInProgress);if(p&&(x||w)&&!z){this._updatingCamera=!0;const k=this._inertia._onMoveEnd(this._map.dragPan._inertiaOptions),H=V=>V!==0&&-this._bearingSnap<V&&V<this._bearingSnap;k?(H(k.bearing||this._map.getBearing())&&(k.bearing=0),this._map.easeTo(k,{originalEvent:O})):(this._map.fire(new n.z("moveend",{originalEvent:O})),H(this._map.getBearing())&&this._map.resetNorth()),this._updatingCamera=!1}}_fireEvent(i,c){this._map.fire(new n.z(i,c?{originalEvent:c}:{}))}_requestFrame(){return this._map.triggerRepaint(),this._map._renderTaskQueue.add((i=>{this._frameId=void 0,this.handleEvent(new Vg("renderFrame",{timeStamp:i})),this._applyChanges()}))}_triggerRenderFrame(){this._frameId===void 0&&(this._frameId=this._requestFrame())}}const Bp="map.setFreeCameraOptions(...) and map.getFreeCameraOptions() are not yet supported for non-mercator projections.";class nl extends n.E{constructor(i,c){super(),this._moving=!1,this._zooming=!1,this.transform=i,this._bearingSnap=c.bearingSnap,this._respectPrefersReducedMotion=c.respectPrefersReducedMotion!==!1,n.aY(["_renderFrameCallback"],this)}getCenter(){return new n.aR(this.transform.center.lng,this.transform.center.lat)}setCenter(i,c){return this.jumpTo({center:i},c)}panBy(i,c,p){return i=n.P.convert(i).mult(-1),this.panTo(this.transform.center,Object.assign({offset:i},c),p)}panTo(i,c,p){return this.easeTo(Object.assign({center:i},c),p)}getZoom(){return this.transform.zoom}setZoom(i,c){return this.jumpTo({zoom:i},c),this}zoomTo(i,c,p){return this.easeTo(Object.assign({zoom:i},c),p)}zoomIn(i,c){return this.zoomTo(this.getZoom()+1,i,c),this}zoomOut(i,c){return this.zoomTo(this.getZoom()-1,i,c),this}getBearing(){return this.transform.bearing}setBearing(i,c){return this.jumpTo({bearing:i},c),this}getPadding(){return this.transform.padding}setPadding(i,c){return this.jumpTo({padding:i},c),this}rotateTo(i,c,p){return this.easeTo(Object.assign({bearing:i},c),p)}resetNorth(i,c){return this.rotateTo(0,Object.assign({duration:1e3},i),c),this}resetNorthPitch(i,c){return this.easeTo(Object.assign({bearing:0,pitch:0,duration:1e3},i),c),this}snapToNorth(i,c){return Math.abs(this.getBearing())<this._bearingSnap?this.resetNorth(i,c):this}getPitch(){return this.transform.pitch}setPitch(i,c){return this.jumpTo({pitch:i},c),this}cameraForBounds(i,c){i=n.aI.convert(i);const p=c&&c.bearing||0,x=c&&c.pitch||0,w=i.getNorthWest(),A=i.getSouthEast();return this._cameraForBounds(this.transform,w,A,p,x,c)}_extendPadding(i){const c={top:0,right:0,bottom:0,left:0};return i==null?Object.assign({},c,this.transform.padding):typeof i=="number"?{top:i,bottom:i,right:i,left:i}:Object.assign({},c,i)}_extendCameraOptions(i){return(i=Object.assign({offset:[0,0],maxZoom:this.transform.maxZoom},i)).padding=this._extendPadding(i.padding),i}_minimumAABBFrustumDistance(i,c){const p=c.max[0]-c.min[0],x=c.max[1]-c.min[1];return p/x>i.aspect?p/(2*Math.tan(.5*i.fovX)*i.aspect):x/(2*Math.tan(.5*i.fovY)*i.aspect)}_cameraForBoundsOnGlobe(i,c,p,x,w,A){const I=i.clone(),O=this._extendCameraOptions(A);I.bearing=x,I.pitch=w;const z=n.aR.convert(c),k=n.aR.convert(p),H=.5*(z.lat+k.lat),V=.5*(z.lng+k.lng),X=n.eQ(H,V),Y=n.aw([],X),W=n.aw([],n.bI([],Y,[0,1,0])),re=n.bI([],W,Y),K=[W[0],W[1],W[2],0,re[0],re[1],re[2],0,Y[0],Y[1],Y[2],0,0,0,0,1],ae=[X,n.eQ(z.lat,z.lng),n.eQ(k.lat,z.lng),n.eQ(k.lat,k.lng),n.eQ(z.lat,k.lng),n.eQ(H,z.lng),n.eQ(H,k.lng),n.eQ(z.lat,V),n.eQ(k.lat,V)];let ue=n.d8.fromPoints(ae.map((je=>[n.bJ(W,je),n.bJ(re,je),n.bJ(Y,je)])));const fe=n.af([],ue.center,K);n.eR(fe)===0&&n.eS(fe,0,0,1),n.aw(fe,fe),n.c4(fe,fe,n.aD),I.center=n.eT(fe);const xe=I.getWorldToCameraMatrix(),ge=n.bl(new Float64Array(16),xe);ue=n.d8.applyTransform(ue,n.aB([],xe,K));const Te=this._extendAABB(ue,I,O,x);if(!Te)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");ue=Te,n.af(fe,fe,xe);const ye=.5*(ue.max[2]-ue.min[2]),_e=this._minimumAABBFrustumDistance(I,ue),Se=n.c4([],[0,0,1],ye),He=n.d7(Se,fe,Se),ze=_e+(I.pitch===0?0:n.bG(fe,He)),nt=I.globeCenterInViewSpace,Ge=n.av([],fe,[nt[0],nt[1],nt[2]]);n.aw(Ge,Ge),n.c4(Ge,Ge,ze);const tt=n.d7([],fe,Ge);n.af(tt,tt,ge);const It=n.eD/n.aD,qe=n.ag(tt),Oe=n.ce(Math.max(qe*It-n.eD,Number.EPSILON),0),ot=Math.min(I.zoomFromMercatorZAdjusted(Oe),O.maxZoom);return ot>.5*(n.cZ+n.cK)?(I.setProjection({name:"mercator"}),I.zoom=ot,this._cameraForBounds(I,c,p,x,w,A)):{center:I.center,zoom:ot,bearing:x,pitch:w}}_extendAABB(i,c,p,x){const w=.5*((p.padding.left||0)+(p.padding.right||0)),A=.5*((p.padding.top||0)+(p.padding.bottom||0)),I=A,O=w,z=w,k=A,H=c.width-(O+z),V=c.height-(I+k),X=n.av([],i.max,i.min),Y=Math.min(H/X[0],V/X[1]),W=Math.min(c.scaleZoom(c.scale*Y),p.maxZoom);if(isNaN(W))return null;const re=c.scale/c.zoomScale(W),K=new n.d8([i.min[0]-O*re,i.min[1]-k*re,i.min[2]],[i.max[0]+z*re,i.max[1]+I*re,i.max[2]]),ae=(typeof p.offset.x=="number"&&typeof p.offset.y=="number"?new n.P(p.offset.x,p.offset.y):n.P.convert(p.offset)).rotate(-n.an(x));return K.center[0]-=ae.x*re,K.center[1]+=ae.y*re,K}queryTerrainElevation(i,c){const p=this.transform.elevation;return p?(c=Object.assign({},{exaggerated:!0},c),p.getAtPoint(n.ae.fromLngLat(i),null,c.exaggerated)):null}_cameraForBounds(i,c,p,x,w,A){if(i.projection.name==="globe")return this._cameraForBoundsOnGlobe(i,c,p,x,w,A);const I=i.clone(),O=this._extendCameraOptions(A);I.bearing=x,I.pitch=w;const z=n.aR.convert(c),k=n.aR.convert(p),H=new n.aR(z.lng,k.lat),V=new n.aR(k.lng,z.lat),X=I.project(z),Y=I.project(k),W=this.queryTerrainElevation(z),re=this.queryTerrainElevation(k),K=this.queryTerrainElevation(H),ae=this.queryTerrainElevation(V),ue=[[X.x,X.y,Math.min(W||0,re||0,K||0,ae||0)],[Y.x,Y.y,Math.max(W||0,re||0,K||0,ae||0)]];let fe=n.d8.fromPoints(ue);const xe=I.getWorldToCameraMatrix(),ge=n.bl(new Float64Array(16),xe);fe=n.d8.applyTransform(fe,xe);const Te=this._extendAABB(fe,I,O,x);if(!Te)return void n.w("Map cannot fit within canvas with the given bounds, padding, and/or offset.");fe=Te;const ye=.5*n.av([],fe.max,fe.min)[2],_e=this._minimumAABBFrustumDistance(I,fe),Se=[0,0,1,0];n.aC(Se,Se,xe),n.eU(Se,Se);const He=n.c4([],Se,_e+ye),ze=n.d7([],fe.center,He);n.af(fe.center,fe.center,ge),n.af(ze,ze,ge);const nt=I.unproject(new n.P(fe.center[0],fe.center[1])),Ge=n.eV(I.projection,nt),tt=Math.pow(2,Ge),It=Math.min(I._zoomFromMercatorZ(ze[2]*I.pixelsPerMeter*tt/I.worldSize),O.maxZoom);return I.mercatorFromTransition&&It<.5*(n.cZ+n.cK)?(I.setProjection({name:"globe"}),I.zoom=It,this._cameraForBounds(I,c,p,x,w,A)):{center:nt,zoom:It,bearing:x,pitch:w}}fitBounds(i,c,p){const x=this.cameraForBounds(i,c);return this._fitInternal(x,c,p)}fitScreenCoordinates(i,c,p,x,w){const A=n.P.convert(i),I=n.P.convert(c),O=new n.P(Math.min(A.x,I.x),Math.min(A.y,I.y)),z=new n.P(Math.max(A.x,I.x),Math.max(A.y,I.y));if(this.transform.projection.name==="mercator"&&this.transform.anyCornerOffEdge(A,I))return this;const k=this.transform.pointLocation3D(O),H=this.transform.pointLocation3D(z),V=this.transform.pointLocation3D(new n.P(O.x,z.y)),X=this.transform.pointLocation3D(new n.P(z.x,O.y)),Y=[Math.min(k.lng,H.lng,V.lng,X.lng),Math.min(k.lat,H.lat,V.lat,X.lat)],W=[Math.max(k.lng,H.lng,V.lng,X.lng),Math.max(k.lat,H.lat,V.lat,X.lat)],re=x&&x.pitch?x.pitch:this.getPitch(),K=this._cameraForBounds(this.transform,Y,W,p,re,x);return this._fitInternal(K,x,w)}_fitInternal(i,c,p){return i?(c=Object.assign(i,c)).linear?this.easeTo(c,p):this.flyTo(c,p):this}jumpTo(i,c){this.stop();const p=i.preloadOnly?this.transform.clone():this.transform;let x=!1,w=!1,A=!1;"zoom"in i&&p.zoom!==+i.zoom&&(x=!0,p.zoom=+i.zoom),i.center!==void 0&&(p.center=n.aR.convert(i.center)),"bearing"in i&&p.bearing!==+i.bearing&&(w=!0,p.bearing=+i.bearing),"pitch"in i&&p.pitch!==+i.pitch&&(A=!0,p.pitch=+i.pitch);const I=typeof i.padding=="number"?this._extendPadding(i.padding):i.padding;if(i.padding!=null&&!p.isPaddingEqual(I))if(i.retainPadding===!1){const O=p.clone();O.padding=I,p.setLocationAtPoint(p.center,O.centerPoint)}else p.padding=I;return i.preloadOnly?(this._preloadTiles(p),this):(this.fire(new n.z("movestart",c)).fire(new n.z("move",c)),x&&this.fire(new n.z("zoomstart",c)).fire(new n.z("zoom",c)).fire(new n.z("zoomend",c)),w&&this.fire(new n.z("rotatestart",c)).fire(new n.z("rotate",c)).fire(new n.z("rotateend",c)),A&&this.fire(new n.z("pitchstart",c)).fire(new n.z("pitch",c)).fire(new n.z("pitchend",c)),this.fire(new n.z("moveend",c)))}getFreeCameraOptions(){return this.transform.projection.supportsFreeCamera||n.w(Bp),this.transform.getFreeCameraOptions()}setFreeCameraOptions(i,c){const p=this.transform;if(!p.projection.supportsFreeCamera)return n.w(Bp),this;this.stop();const x=p.zoom,w=p.pitch,A=p.bearing;p.setFreeCameraOptions(i);const I=x!==p.zoom,O=w!==p.pitch,z=A!==p.bearing;return this.fire(new n.z("movestart",c)).fire(new n.z("move",c)),I&&this.fire(new n.z("zoomstart",c)).fire(new n.z("zoom",c)).fire(new n.z("zoomend",c)),z&&this.fire(new n.z("rotatestart",c)).fire(new n.z("rotate",c)).fire(new n.z("rotateend",c)),O&&this.fire(new n.z("pitchstart",c)).fire(new n.z("pitch",c)).fire(new n.z("pitchend",c)),this.fire(new n.z("moveend",c)),this}easeTo(i,c){this._stop(!1,i.easeId),((i=Object.assign({offset:[0,0],duration:500,easing:n.eM},i)).animate===!1||this._prefersReducedMotion(i))&&(i.duration=0);const p=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),I=this.getPadding(),O="zoom"in i?+i.zoom:x,z="bearing"in i?this._normalizeBearing(i.bearing,w):w,k="pitch"in i?+i.pitch:A,H=this._extendPadding(i.padding),V=n.P.convert(i.offset);let X,Y,W;if(p.projection.name==="globe"){const Se=n.ae.fromLngLat(p.center),He=V.rotate(-p.angle);Se.x+=He.x/p.worldSize,Se.y+=He.y/p.worldSize;const ze=Se.toLngLat(),nt=n.aR.convert(i.center||ze);this._normalizeCenter(nt),X=p.centerPoint.add(He),Y=new n.P(Se.x,Se.y).mult(p.worldSize),W=new n.P(n.aF(nt.lng),n.aJ(nt.lat)).mult(p.worldSize).sub(Y)}else{X=p.centerPoint.add(V);const Se=p.pointLocation(X),He=n.aR.convert(i.center||Se);this._normalizeCenter(He),Y=p.project(Se),W=p.project(He).sub(Y)}const re=p.zoomScale(O-x);let K,ae;i.around&&(K=n.aR.convert(i.around),ae=p.locationPoint(K));const ue=this._zooming||O!==x,fe=this._rotating||w!==z,xe=this._pitching||k!==A,ge=!p.isPaddingEqual(H),Te=i.retainPadding===!1?p.clone():p,ye=Se=>He=>{if(ue&&(Se.zoom=n.ak(x,O,He)),fe&&(Se.bearing=n.ak(w,z,He)),xe&&(Se.pitch=n.ak(A,k,He)),ge&&(Te.interpolatePadding(I,H,He),X=Te.centerPoint.add(V)),K)Se.setLocationAtPoint(K,ae);else{const ze=Se.zoomScale(Se.zoom-x),nt=O>x?Math.min(2,re):Math.max(.5,re),Ge=Math.pow(nt,1-He),tt=Se.unproject(Y.add(W.mult(He*Ge)).mult(ze));Se.setLocationAtPoint(Se.renderWorldCopies?tt.wrap():tt,X)}return i.preloadOnly||this._fireMoveEvents(c),Se};if(i.preloadOnly){const Se=this._emulate(ye,i.duration,p);return this._preloadTiles(Se),this}const _e={moving:this._moving,zooming:this._zooming,rotating:this._rotating,pitching:this._pitching};return this._zooming=ue,this._rotating=fe,this._pitching=xe,this._padding=ge,this._easeId=i.easeId,this._prepareEase(c,i.noMoveStart,_e),this._ease(ye(p),(Se=>{p.cameraElevationReference==="sea"&&p.recenterOnTerrain(),this._afterEase(c,Se)}),i),this}_prepareEase(i,c,p={}){this._moving=!0,this.transform.cameraElevationReference="sea",this.transform._orthographicProjectionAtLowPitch&&this.transform.pitch===0&&this.transform.projection.name!=="globe"&&(this.transform.cameraElevationReference="ground"),c||p.moving||this.fire(new n.z("movestart",i)),this._zooming&&!p.zooming&&this.fire(new n.z("zoomstart",i)),this._rotating&&!p.rotating&&this.fire(new n.z("rotatestart",i)),this._pitching&&!p.pitching&&this.fire(new n.z("pitchstart",i))}_fireMoveEvents(i){this.fire(new n.z("move",i)),this._zooming&&this.fire(new n.z("zoom",i)),this._rotating&&this.fire(new n.z("rotate",i)),this._pitching&&this.fire(new n.z("pitch",i))}_afterEase(i,c){if(this._easeId&&c&&this._easeId===c)return;this._easeId=void 0,this.transform.cameraElevationReference="ground";const p=this._zooming,x=this._rotating,w=this._pitching;this._moving=!1,this._zooming=!1,this._rotating=!1,this._pitching=!1,this._padding=!1,p&&this.fire(new n.z("zoomend",i)),x&&this.fire(new n.z("rotateend",i)),w&&this.fire(new n.z("pitchend",i)),this.fire(new n.z("moveend",i))}flyTo(i,c){if(this._prefersReducedMotion(i)){const je=n.aH(i,["center","zoom","bearing","pitch","around","padding","retainPadding"]);return this.jumpTo(je,c)}this.stop(),i=Object.assign({offset:[0,0],speed:1.2,curve:1.42,easing:n.eM},i);const p=this.transform,x=this.getZoom(),w=this.getBearing(),A=this.getPitch(),I=this.getPadding(),O="zoom"in i?n.aA(+i.zoom,p.minZoom,p.maxZoom):x,z="bearing"in i?this._normalizeBearing(i.bearing,w):w,k="pitch"in i?+i.pitch:A,H=this._extendPadding(i.padding),V=p.zoomScale(O-x),X=n.P.convert(i.offset);let Y=p.centerPoint.add(X);const W=p.pointLocation(Y),re=n.aR.convert(i.center||W);this._normalizeCenter(re);const K=p.project(W),ae=p.project(re).sub(K);let ue=i.curve;const fe=Math.max(p.width,p.height),xe=fe/V,ge=ae.mag();if("minZoom"in i){const je=n.aA(Math.min(i.minZoom,x,O),p.minZoom,p.maxZoom),at=fe/p.zoomScale(je-x);ue=Math.sqrt(at/ge*2)}const Te=ue*ue;function ye(je){const at=(xe*xe-fe*fe+(je?-1:1)*Te*Te*ge*ge)/(2*(je?xe:fe)*Te*ge);return Math.log(Math.sqrt(at*at+1)-at)}function _e(je){return(Math.exp(je)-Math.exp(-je))/2}function Se(je){return(Math.exp(je)+Math.exp(-je))/2}const He=ye(0);let ze=function(je){return Se(He)/Se(He+ue*je)},nt=function(je){return fe*((Se(He)*(_e(at=He+ue*je)/Se(at))-_e(He))/Te)/ge;var at},Ge=(ye(1)-He)/ue;if(Math.abs(ge)<1e-6||!isFinite(Ge)){if(Math.abs(fe-xe)<1e-6)return this.easeTo(i,c);const je=xe<fe?-1:1;Ge=Math.abs(Math.log(xe/fe))/ue,nt=function(){return 0},ze=function(at){return Math.exp(je*ue*at)}}i.duration="duration"in i?+i.duration:1e3*Ge/("screenSpeed"in i?+i.screenSpeed/ue:+i.speed),i.maxDuration&&i.duration>i.maxDuration&&(i.duration=0);const tt=w!==z,It=k!==A,qe=!p.isPaddingEqual(H),Oe=i.retainPadding===!1?p.clone():p,ot=je=>at=>{const ht=at*Ge,wt=1/ze(ht);je.zoom=at===1?O:x+je.scaleZoom(wt),tt&&(je.bearing=n.ak(w,z,at)),It&&(je.pitch=n.ak(A,k,at)),qe&&(Oe.interpolatePadding(I,H,at),Y=Oe.centerPoint.add(X));const ft=at===1?re:je.unproject(K.add(ae.mult(nt(ht))).mult(wt));return je.setLocationAtPoint(je.renderWorldCopies?ft.wrap():ft,Y),je._updateCameraOnTerrain(),i.preloadOnly||this._fireMoveEvents(c),je};if(i.preloadOnly){const je=this._emulate(ot,i.duration,p);return this._preloadTiles(je),this}return this._zooming=!0,this._rotating=tt,this._pitching=It,this._padding=qe,this._prepareEase(c,!1),this._ease(ot(p),(()=>this._afterEase(c)),i),this}isEasing(){return!!this._easeFrameId}stop(){return this._stop()}_requestRenderFrame(i){}_cancelRenderFrame(i){}_stop(i,c){if(this._easeFrameId&&(this._cancelRenderFrame(this._easeFrameId),this._easeFrameId=void 0,this._onEaseFrame=void 0),this._onEaseEnd){const p=this._onEaseEnd;this._onEaseEnd=void 0,p.call(this,c)}if(!i){const p=this.handlers;p&&p.stop(!1)}return this}_ease(i,c,p){p.animate===!1||p.duration===0?(i(1),c()):(this._easeStart=n.o.now(),this._easeOptions=p,this._onEaseFrame=i,this._onEaseEnd=c,this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback))}_renderFrameCallback(){const i=Math.min((n.o.now()-this._easeStart)/this._easeOptions.duration,1),c=this._onEaseFrame;c&&c(this._easeOptions.easing(i)),i<1?this._easeFrameId=this._requestRenderFrame(this._renderFrameCallback):this.stop()}_normalizeBearing(i,c){i=n.bT(i,-180,180);const p=Math.abs(i-c);return Math.abs(i-360-c)<p&&(i-=360),Math.abs(i+360-c)<p&&(i+=360),i}_normalizeCenter(i){const c=this.transform;if(c.maxBounds||c.projection.name!=="globe"&&!c.renderWorldCopies)return;const p=i.lng-c.center.lng;i.lng+=p>180?-360:p<-180?360:0}_prefersReducedMotion(i){return this._respectPrefersReducedMotion&&n.o.prefersReducedMotion&&!(i&&i.essential)}_emulate(i,c,p){const x=Math.ceil(15*c/1e3),w=[],A=i(p.clone());for(let I=0;I<=x;I++){const O=A(I/x);w.push(O.clone())}return w}_preloadTiles(i,c){}}class hf{constructor(i={}){this.options=i,n.aY(["_toggleAttribution","_updateEditLink","_updateData","_updateCompact"],this)}getDefaultPosition(){return"bottom-right"}onAdd(i){const c=this.options&&this.options.compact,p=i._getUIString("AttributionControl.ToggleAttribution");this._map=i,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-attrib"),this._compactButton=ne("button","mapboxgl-ctrl-attrib-button",this._container),this._compactButton.type="button",this._compactButton.addEventListener("click",this._toggleAttribution),this._compactButton.setAttribute("aria-label",p);const x=ne("span","mapboxgl-ctrl-icon",this._compactButton);return x.setAttribute("aria-hidden","true"),x.setAttribute("title",p),this._innerContainer=ne("div","mapboxgl-ctrl-attrib-inner",this._container),c&&this._container.classList.add("mapboxgl-compact"),this._updateAttributions(),this._updateEditLink(),this._map.on("styledata",this._updateData),this._map.on("sourcedata",this._updateData),this._map.on("moveend",this._updateEditLink),c===void 0&&(this._map.on("resize",this._updateCompact),this._updateCompact()),this._container}onRemove(){this._container.remove(),this._map.off("styledata",this._updateData),this._map.off("sourcedata",this._updateData),this._map.off("moveend",this._updateEditLink),this._map.off("resize",this._updateCompact),this._map=void 0,this._attribHTML=void 0}_toggleAttribution(){this._container.classList.contains("mapboxgl-compact-show")?(this._container.classList.remove("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","false")):(this._container.classList.add("mapboxgl-compact-show"),this._compactButton.setAttribute("aria-expanded","true"))}_updateEditLink(){let i=this._editLink;i||(i=this._editLink=this._container.querySelector(".mapbox-improve-map"));const c=[{key:"owner",value:this.styleOwner},{key:"id",value:this.styleId},{key:"access_token",value:this._map._requestManager._customAccessToken||n.e.ACCESS_TOKEN}];if(i){const p=c.reduce(((x,w,A)=>(w.value&&(x+=`${w.key}=${w.value}${A<c.length-1?"&":""}`),x)),"?");i.href=`${n.e.FEEDBACK_URL}/${p}#${Rc(this._map,!0)}`,i.rel="noopener nofollow"}}_updateData(i){!i||(i.dataType!=="source"||i.sourceDataType!=="metadata"&&i.sourceDataType!=="visibility")&&i.dataType!=="style"||(this._updateAttributions(),this._updateEditLink())}_updateAttributions(){if(!this._map.style)return;let i=[];if(this._map.style.stylesheet){const x=this._map.style.stylesheet;this.styleOwner=x.owner,this.styleId=x.id}const c=this._map.style._mergedSourceCaches;for(const x in c){const w=c[x];if(w.used){const A=w.getSource();A.attribution&&i.indexOf(A.attribution)<0&&i.push(A.attribution)}}i.sort(((x,w)=>x.length-w.length)),i=i.filter(((x,w)=>{for(let A=w+1;A<i.length;A++)if(i[A].indexOf(x)>=0)return!1;return!0})),this.options.customAttribution&&(Array.isArray(this.options.customAttribution)?i=[...this.options.customAttribution,...i]:i.unshift(this.options.customAttribution));const p=i.join(" | ");p!==this._attribHTML&&(this._attribHTML=p,i.length?(this._innerContainer.innerHTML=p,this._container.classList.remove("mapboxgl-attrib-empty")):this._container.classList.add("mapboxgl-attrib-empty"),this._editLink=null)}_updateCompact(){this._map.getCanvasContainer().offsetWidth<=640?this._container.classList.add("mapboxgl-compact"):this._container.classList.remove("mapboxgl-compact","mapboxgl-compact-show")}}class ls{constructor(){n.aY(["_updateLogo","_updateCompact"],this)}onAdd(i){this._map=i,this._container=ne("div","mapboxgl-ctrl");const c=ne("a","mapboxgl-ctrl-logo");return c.target="_blank",c.rel="noopener nofollow",c.href="https://www.mapbox.com/",c.setAttribute("aria-label",this._map._getUIString("LogoControl.Title")),c.setAttribute("rel","noopener nofollow"),this._container.appendChild(c),this._container.style.display="none",this._map.on("sourcedata",this._updateLogo),this._updateLogo(),this._map.on("resize",this._updateCompact),this._updateCompact(),this._container}onRemove(){this._container.remove(),this._map.off("sourcedata",this._updateLogo),this._map.off("resize",this._updateCompact)}getDefaultPosition(){return"bottom-left"}_updateLogo(i){i&&i.sourceDataType!=="metadata"||(this._container.style.display=this._logoRequired()?"block":"none")}_logoRequired(){if(!this._map.style)return!0;const i=this._map.style._sourceCaches;if(Object.entries(i).length===0)return!0;for(const c in i){const p=i[c].getSource();if(p.hasOwnProperty("mapbox_logo")&&!p.mapbox_logo)return!1}return!0}_updateCompact(){const i=this._container.children;if(i.length){const c=i[0];this._map.getCanvasContainer().offsetWidth<250?c.classList.add("mapboxgl-compact"):c.classList.remove("mapboxgl-compact")}}}class Dc{constructor(){n.aY(["_onIndoorUpdate"],this)}onAdd(i){return this._map=i,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._map.indoor.on("indoorupdate",(c=>this._onIndoorUpdate({selectedFloorId:c.selectedFloorId,floors:c.floors}))),this._container}_createButton(i,c){const p=ne("button",i,this._container);return p.type="button",p.addEventListener("click",c),p}_createSeparator(){return ne("div","mapboxgl-ctrl-separator",this._container)}_setButtonTitle(i,c){this._map&&(i.setAttribute("aria-label",c),i.textContent=c)}onRemove(){this._container&&this._container.remove(),this._map&&this._map.indoor&&(this._map.indoor.off("indoorupdate",this._onIndoorUpdate),this._map=null)}getDefaultPosition(){return"right"}_onIndoorUpdate(i){if(!i||!i.floors)return void(this._container.style.display="none");const c=this._model;this._model=i,this._container.style.display="inline-block",this._container.style.borderRadius="8px";const p=i.floors.sort(((x,w)=>w.levelOrder-x.levelOrder));c?(Array.from(this._container.children).forEach((x=>x.remove())),this.addCurrentFloors(p)):this.addCurrentFloors(p)}addCurrentFloors(i){for(let c=0;c<i.length;c++){const p=i[c],x=this._createButton("mapboxgl-ctrl-level-button",(()=>{this._map._selectIndoorFloor(p.id),this._model&&(this._model.selectedFloorId=p.id),Array.from(this._container.children).forEach((w=>{w.classList.contains("mapboxgl-ctrl-level-button")&&w.classList.remove("mapboxgl-ctrl-level-button-selected")})),x.classList.add("mapboxgl-ctrl-level-button-selected")}));this._setButtonTitle(x,p.shortName),this._model&&p.id===this._model.selectedFloorId&&x.classList.add("mapboxgl-ctrl-level-button-selected"),this._container.append(x),c<i.length-1&&this._createSeparator()}}}class gi{constructor(){this._queue=[],this._id=0,this._cleared=!1,this._currentlyRunning=!1}add(i){const c=++this._id;return this._queue.push({callback:i,id:c,cancelled:!1}),c}remove(i){const c=this._currentlyRunning,p=c?this._queue.concat(c):this._queue;for(const x of p)if(x.id===i)return void(x.cancelled=!0)}run(i=0){const c=this._currentlyRunning=this._queue;this._queue=[];for(const p of c)if(!p.cancelled&&(p.callback(i),this._cleared))break;this._cleared=!1,this._currentlyRunning=!1}clear(){this._currentlyRunning&&(this._cleared=!0),this._queue=[]}}class Bl{constructor(i){this.jumpTo(i)}getValue(i){if(i<=this._startTime)return this._start;if(i>=this._endTime)return this._end;const c=n.dz((i-this._startTime)/(this._endTime-this._startTime));return this._start*(1-c)+this._end*c}isEasing(i){return i>=this._startTime&&i<=this._endTime}jumpTo(i){this._startTime=-1/0,this._endTime=-1/0,this._start=i,this._end=i}easeTo(i,c,p){this._start=this.getValue(c),this._end=i,this._startTime=c,this._endTime=c+p}}const bd={"AttributionControl.ToggleAttribution":"Toggle attribution","FullscreenControl.Enter":"Enter fullscreen","FullscreenControl.Exit":"Exit fullscreen","GeolocateControl.FindMyLocation":"Find my location","GeolocateControl.LocationNotAvailable":"Location not available","LogoControl.Title":"Mapbox homepage","Map.Title":"Map","NavigationControl.ResetBearing":"Reset bearing to north","NavigationControl.ZoomIn":"Zoom in","NavigationControl.ZoomOut":"Zoom out","ScrollZoomBlocker.CtrlMessage":"Use ctrl + scroll to zoom the map","ScrollZoomBlocker.CmdMessage":"Use ⌘ + scroll to zoom the map","TouchPanBlocker.Message":"Use two fingers to move the map"};class ff extends n.z{constructor(i,c,p,x){const{point:w,lngLat:A,originalEvent:I,target:O}=i;super(i.type,{point:w,lngLat:A,originalEvent:I,target:O}),this.preventDefault=()=>{i.preventDefault()},this.id=c,this.interaction=p,this.feature=x}}class df{constructor(i){this.map=i,this.interactionsByType=new Map,this.delegatedInteractions=new Map,this.typeById=new Map,this.filters=new Map,this.handleType=this.handleType.bind(this),this.handleMove=this.handleMove.bind(this),this.handleOut=this.handleOut.bind(this),this.hoveredFeatures=new Map,this.prevHoveredFeatures=new Map}add(i,c){if(this.typeById.has(i))throw new Error(`Interaction id "${i}" already exists.`);const p=c.filter;let x=c.type;p&&this.filters.set(i,n.b6(p)),x==="mouseover"&&(x="mouseenter"),x==="mouseout"&&(x="mouseleave");const w=this.interactionsByType.get(x)||new Map;x==="mouseenter"||x==="mouseleave"?(this.delegatedInteractions.size===0&&(this.map.on("mousemove",this.handleMove),this.map.on("mouseout",this.handleOut)),this.delegatedInteractions.set(i,c)):w.size===0&&this.map.on(x,this.handleType),w.size===0&&this.interactionsByType.set(x,w),w.set(i,c),this.typeById.set(i,x)}get(i){const c=this.typeById.get(i);if(!c)return;const p=this.interactionsByType.get(c);return p?p.get(i):void 0}remove(i){const c=this.typeById.get(i);if(!c)return;this.typeById.delete(i),this.filters.delete(i);const p=this.interactionsByType.get(c);p&&(p.delete(i),c==="mouseenter"||c==="mouseleave"?(this.delegatedInteractions.delete(i),this.delegatedInteractions.size===0&&(this.map.off("mousemove",this.handleMove),this.map.off("mouseout",this.handleOut))):p.size===0&&this.map.off(c,this.handleType))}queryTargets(i,c){const p=[];for(const[x,w]of c)w.target&&p.push({targetId:x,target:w.target,filter:this.filters.get(x)});return this.map.style.queryRenderedTargets(i,p,this.map.transform)}handleMove(i){this.prevHoveredFeatures=this.hoveredFeatures,this.hoveredFeatures=new Map;const c=this.queryTargets(i.point,Array.from(this.delegatedInteractions).reverse());c.length&&(i.type="mouseenter",this.handleType(i,c));const p=new Map;for(const[x,{feature:w}]of this.prevHoveredFeatures)this.hoveredFeatures.has(x)||p.set(w.id,w);p.size&&(i.type="mouseleave",this.handleType(i,Array.from(p.values())))}handleOut(i){const c=Array.from(this.hoveredFeatures.values()).map((({feature:p})=>p));c.length&&(i.type="mouseleave",this.handleType(i,c)),this.hoveredFeatures.clear()}handleType(i,c){const p=i.type==="mouseenter";if(p&&!this.interactionsByType.has(i.type))return void n.w("mouseenter interaction required for mouseleave to work.");const x=Array.from(this.interactionsByType.get(i.type)).reverse(),w=!!c;c=c||this.queryTargets(i.point,x);let A=!1;const I=new Set;for(const O of c){for(const[z,k]of x){if(!k.target)continue;const H=O.variants?O.variants[z]:null;if(H){for(const V of H){if(jc(V,O,I,z))continue;const X=new n.dt(O,V),Y=Uc(V,O,z);w&&(X.state=this.map.getFeatureState(X));const W=p?this.prevHoveredFeatures.get(Y):null,re=new ff(i,z,k,X),K=W?W.stop:k.handler(re);if(p&&this.hoveredFeatures.set(Y,{feature:O,stop:K}),K!==!1){A=!0;break}}if(A)break}}if(A)break}if(!A)for(const[O,z]of x){const{handler:k,target:H}=z;if(!H&&k(new ff(i,O,z,null))!==!1)break}}}function bu(g,i){if(Array.isArray(g)&&Array.isArray(i)){const c=new Set(g),p=new Set(i);return c.size===p.size&&g.every((x=>p.has(x)))}return n.by(g,i)}const pf={center:[0,0],zoom:0,bearing:0,pitch:0,minZoom:-2,maxZoom:22,minPitch:0,maxPitch:85,interactive:!0,scrollZoom:!0,boxZoom:!0,dragRotate:!0,dragPan:!0,keyboard:!0,doubleClickZoom:!0,touchZoomRotate:!0,touchPitch:!0,cooperativeGestures:!1,performanceMetricsCollection:!0,bearingSnap:7,clickTolerance:3,pitchWithRotate:!0,hash:!1,attributionControl:!0,antialias:!1,failIfMajorPerformanceCaveat:!1,preserveDrawingBuffer:!1,trackResize:!0,renderWorldCopies:!0,refreshExpiredTiles:!0,minTileCacheSize:null,maxTileCacheSize:null,localIdeographFontFamily:"sans-serif",localFontFamily:null,transformRequest:null,accessToken:null,fadeDuration:300,respectPrefersReducedMotion:!0,crossSourceCollisions:!0,collectResourceTiming:!1,testMode:!1,precompilePrograms:!0,scaleFactor:1,spriteFormat:"auto"},Ug={showCompass:!0,showZoom:!0,visualizePitch:!1};class wd{constructor(i,c,p=!1){this._clickTolerance=10,this.element=c,this.mouseRotate=new gd({clickTolerance:i.dragRotate._mouseRotate._clickTolerance}),this.map=i,p&&(this.mousePitch=new Ep({clickTolerance:i.dragRotate._mousePitch._clickTolerance})),n.aY(["mousedown","mousemove","mouseup","touchstart","touchmove","touchend","reset"],this),c.addEventListener("mousedown",this.mousedown),c.addEventListener("touchstart",this.touchstart,{passive:!1}),c.addEventListener("touchmove",this.touchmove),c.addEventListener("touchend",this.touchend),c.addEventListener("touchcancel",this.reset)}down(i,c){this.mouseRotate.mousedown(i,c),this.mousePitch&&this.mousePitch.mousedown(i,c),Ze()}move(i,c){const p=this.map,x=this.mouseRotate.mousemoveWindow(i,c),w=x&&x.bearingDelta;if(w&&p.setBearing(p.getBearing()+w),this.mousePitch){const A=this.mousePitch.mousemoveWindow(i,c),I=A&&A.pitchDelta;I&&p.setPitch(p.getPitch()+I)}}off(){const i=this.element;i.removeEventListener("mousedown",this.mousedown),i.removeEventListener("touchstart",this.touchstart),i.removeEventListener("touchmove",this.touchmove),i.removeEventListener("touchend",this.touchend),i.removeEventListener("touchcancel",this.reset),this.offTemp()}offTemp(){$e(),window.removeEventListener("mousemove",this.mousemove),window.removeEventListener("mouseup",this.mouseup)}mousedown(i){this.down(Object.assign({},i,{ctrlKey:!0,preventDefault:()=>i.preventDefault()}),Ft(this.element,i)),window.addEventListener("mousemove",this.mousemove),window.addEventListener("mouseup",this.mouseup)}mousemove(i){this.move(i,Ft(this.element,i))}mouseup(i){this.mouseRotate.mouseupWindow(i),this.mousePitch&&this.mousePitch.mouseupWindow(i),this.offTemp()}touchstart(i){i.targetTouches.length!==1?this.reset():(this._startPos=this._lastPos=Yt(this.element,i.targetTouches)[0],this.down({type:"mousedown",button:0,ctrlKey:!0,preventDefault:()=>i.preventDefault()},this._startPos))}touchmove(i){i.targetTouches.length!==1?this.reset():(this._lastPos=Yt(this.element,i.targetTouches)[0],this.move({preventDefault:()=>i.preventDefault()},this._lastPos))}touchend(i){i.targetTouches.length===0&&this._startPos&&this._lastPos&&this._startPos.dist(this._lastPos)<this._clickTolerance&&this.element.click(),this.reset()}reset(){this.mouseRotate.reset(),this.mousePitch&&this.mousePitch.reset(),delete this._startPos,delete this._lastPos,this.offTemp()}}function cs(g,i,c){if(g=new n.aR(g.lng,g.lat),i){const p=new n.aR(g.lng-360,g.lat),x=new n.aR(g.lng+360,g.lat),w=360*Math.ceil(Math.abs(g.lng-c.center.lng)/360),A=c.locationPoint3D(g).distSqr(i),I=i.x<0||i.y<0||i.x>c.width||i.y>c.height;c.locationPoint3D(p).distSqr(i)<A&&(I||Math.abs(p.lng-c.center.lng)<w)?g=p:c.locationPoint3D(x).distSqr(i)<A&&(I||Math.abs(x.lng-c.center.lng)<w)&&(g=x)}for(;Math.abs(g.lng-c.center.lng)>180;){const p=c.locationPoint3D(g);if(p.x>=0&&p.y>=0&&p.x<=c.width&&p.y<=c.height)break;g.lng>c.center.lng?g.lng-=360:g.lng+=360}return g}const mf={center:"translate(-50%,-50%)",top:"translate(-50%,0)","top-left":"translate(0,0)","top-right":"translate(-100%,0)",bottom:"translate(-50%,-100%)","bottom-left":"translate(0,-100%)","bottom-right":"translate(-100%,-100%)",left:"translate(0,-50%)",right:"translate(-100%,-50%)"},Ca={rotation:0,rotationAlignment:"auto",pitchAlignment:"auto",occludedOpacity:.2,altitude:0};class wu extends n.E{constructor(i,c){super(),(i instanceof HTMLElement||c)&&(i=Object.assign({element:i},c)),n.aY(["_update","_onMove","_onUp","_addDragHandler","_onMapClick","_onKeyPress","_clearFadeTimer"],this);const{anchor:p="center",color:x="#3FB1CE",scale:w=1,draggable:A=!1,clickTolerance:I=0,rotation:O=Ca.rotation,rotationAlignment:z=Ca.rotationAlignment,pitchAlignment:k=Ca.pitchAlignment,occludedOpacity:H=Ca.occludedOpacity,altitude:V=Ca.altitude}=i||{};this._anchor=p,this._color=x,this._scale=w,this._draggable=A,this._clickTolerance=I,this._rotation=O,this._rotationAlignment=z,this._pitchAlignment=k,this._occludedOpacity=H,this._altitude=V,this._state="inactive",this._isDragging=!1,this._updateMoving=()=>this._update(!0),i&&i.element?(this._element=i.element,this._offset=n.P.convert(i&&i.offset||[0,0])):(this._defaultMarker=!0,this._element=this._createDefaultMarker(),this._offset=n.P.convert(i&&i.offset||[0,-14])),this._element.hasAttribute("aria-label")||this._element.setAttribute("aria-label","Map marker"),this._element.hasAttribute("role")||this._element.setAttribute("role","img"),this._element.classList.add("mapboxgl-marker"),this._element.addEventListener("dragstart",(W=>{W.preventDefault()})),this._element.addEventListener("mousedown",(W=>{W.preventDefault()}));const X=this._element.classList;for(const W in mf)X.remove(`mapboxgl-marker-anchor-${W}`);X.add(`mapboxgl-marker-anchor-${this._anchor}`);const Y=i&&i.className?i.className.trim().split(/\s+/):[];X.add(...Y),this._popup=null}_createDefaultMarker(){const i=ne("div"),c=be("svg",{display:"block",height:41*this._scale+"px",width:27*this._scale+"px",viewBox:"0 0 27 41"},i);if(this._altitude===0){const p=be("radialGradient",{id:"shadowGradient"},be("defs",{},c));be("stop",{offset:"10%","stop-opacity":.4},p),be("stop",{offset:"100%","stop-opacity":.05},p),be("ellipse",{cx:13.5,cy:34.8,rx:10.5,ry:5.25,fill:"url(#shadowGradient)"},c)}return be("path",{fill:this._color,d:"M27,13.5C27,19.07 20.25,27 14.75,34.5C14.02,35.5 12.98,35.5 12.25,34.5C6.75,27 0,19.22 0,13.5C0,6.04 6.04,0 13.5,0C20.96,0 27,6.04 27,13.5Z"},c),be("path",{opacity:.25,d:"M13.5,0C6.04,0 0,6.04 0,13.5C0,19.22 6.75,27 12.25,34.5C13,35.52 14.02,35.5 14.75,34.5C20.25,27 27,19.07 27,13.5C27,6.04 20.96,0 13.5,0ZM13.5,1C20.42,1 26,6.58 26,13.5C26,15.9 24.5,19.18 22.22,22.74C19.95,26.3 16.71,30.14 13.94,33.91C13.74,34.18 13.61,34.32 13.5,34.44C13.39,34.32 13.26,34.18 13.06,33.91C10.28,30.13 7.41,26.31 5.02,22.77C2.62,19.23 1,15.95 1,13.5C1,6.58 6.58,1 13.5,1Z"},c),be("circle",{fill:"white",cx:13.5,cy:13.5,r:5.5},c),i}addTo(i){return i===this._map||(this.remove(),this._map=i,i.getCanvasContainer().appendChild(this._element),i.on("move",this._updateMoving),i.on("moveend",this._update),i.on("remove",this._clearFadeTimer),i._addMarker(this),this.setDraggable(this._draggable),this._update(),i.on("click",this._onMapClick)),this}remove(){const i=this._map;return i&&(i.off("click",this._onMapClick),i.off("move",this._updateMoving),i.off("moveend",this._update),i.off("mousedown",this._addDragHandler),i.off("touchstart",this._addDragHandler),i.off("mouseup",this._onUp),i.off("touchend",this._onUp),i.off("mousemove",this._onMove),i.off("touchmove",this._onMove),i.off("remove",this._clearFadeTimer),i._removeMarker(this),this._map=void 0),this._clearFadeTimer(),this._element.remove(),this._popup&&this._popup.remove(),this}getLngLat(){return this._lngLat}setLngLat(i){return this._lngLat=n.aR.convert(i),this._pos=null,this._popup&&this._popup.setLngLat(this._lngLat),this._update(!0),this}setAltitude(i){return i===this._altitude||(this._defaultMarker&&(this._altitude===0&&i!==0||this._altitude!==0&&i===0)&&(this._element=this._createDefaultMarker()),this._altitude=i||Ca.altitude,this._update()),this}getAltitude(){return this._altitude}getElement(){return this._element}setPopup(i){if(this._popup&&(this._popup.remove(),this._popup=null,this._element.removeAttribute("role"),this._element.removeEventListener("keypress",this._onKeyPress),this._originalTabIndex||this._element.removeAttribute("tabindex")),i){if(!("offset"in i.options)){const x=Math.sqrt(Math.pow(13.5,2)/2);i.options.offset=this._defaultMarker?{top:[0,0],"top-left":[0,0],"top-right":[0,0],bottom:[0,-38.1],"bottom-left":[x,-1*(38.1-13.5+x)],"bottom-right":[-x,-1*(38.1-13.5+x)],left:[13.5,-1*(38.1-13.5)],right:[-13.5,-1*(38.1-13.5)]}:this._offset}this._popup=i,i._marker=this,i._altitude=this._altitude,this._lngLat&&this._popup.setLngLat(this._lngLat),this._element.setAttribute("role","button"),this._originalTabIndex=this._element.getAttribute("tabindex"),this._originalTabIndex||this._element.setAttribute("tabindex","0"),this._element.addEventListener("keypress",this._onKeyPress),this._element.setAttribute("aria-expanded","false")}return this}_onKeyPress(i){const c=i.code,p=i.charCode||i.keyCode;c!=="Space"&&c!=="Enter"&&p!==32&&p!==13||this.togglePopup()}_onMapClick(i){const c=i.originalEvent.target,p=this._element;this._popup&&(c===p||p.contains(c))&&this.togglePopup()}getPopup(){return this._popup}togglePopup(){const i=this._popup;return i?(i.isOpen()?(i.remove(),this._element.setAttribute("aria-expanded","false")):this._map&&(i.addTo(this._map),this._element.setAttribute("aria-expanded","true")),this):this}_behindTerrain(){const i=this._map,c=this._pos;if(!i||!c)return!1;const p=i.unproject(c,this._altitude),x=i.getFreeCameraOptions();if(!x.position)return!1;const w=x.position.toLngLat();return w.distanceTo(p)<.9*w.distanceTo(this._lngLat)}_evaluateOpacity(){const i=this._map;if(!i)return;const c=this._pos;if(!c||c.x<0||c.x>i.transform.width||c.y<0||c.y>i.transform.height)return void this._clearFadeTimer();const p=i.unproject(c,this._altitude);let x;i._showingGlobe()&&n.eY(i.transform,this._lngLat)?x=0:(x=1-i._queryFogOpacity(p),i.transform._terrainEnabled()&&i.getTerrain()&&this._behindTerrain()&&(x*=this._occludedOpacity)),this._element.style.opacity=`${x}`,this._element.style.pointerEvents=x>0?"auto":"none",this._popup&&this._popup._setOpacity(x),this._fadeTimer=null}_clearFadeTimer(){this._fadeTimer&&(clearTimeout(this._fadeTimer),this._fadeTimer=null)}_updateDOM(){const i=this._pos;if(!i||!this._map)return;const c=this._offset.mult(this._scale);this._element.style.transform=`
            translate(${i.x}px,${i.y}px)
            ${mf[this._anchor]}
            ${this._calculateXYTransform()} ${this._calculateZTransform()}
            translate(${c.x}px,${c.y}px)
        `}_calculateXYTransform(){const i=this._pos,c=this._map,p=this.getPitchAlignment();if(!c||!i||p!=="map")return"";if(!c._showingGlobe()){const O=c.getPitch();return O?`rotateX(${O}deg)`:""}const x=n.cW(n.eZ(c.transform,this._lngLat)),w=i.sub(n.e_(c.transform)),A=Math.abs(w.x)+Math.abs(w.y);if(A===0)return"";const I=x/A;return`rotateX(${-w.y*I}deg) rotateY(${w.x*I}deg)`}_calculateZTransform(){const i=this._pos,c=this._map;if(!c||!i)return"";let p=0;const x=this.getRotationAlignment();if(x==="map")if(c._showingGlobe()){const w=c.project(new n.aR(this._lngLat.lng,this._lngLat.lat+.001),this._altitude),A=c.project(new n.aR(this._lngLat.lng,this._lngLat.lat-.001),this._altitude).sub(w);p=n.cW(Math.atan2(A.y,A.x))-90}else p=-c.getBearing();else if(x==="horizon"){const w=n.ah(4,6,c.getZoom()),A=n.e_(c.transform);A.y+=w*c.transform.height;const I=i.sub(A),O=n.cW(Math.atan2(I.y,I.x));p=(O>90?O-270:O+90)*(1-w)}return p+=this._rotation,p?`rotateZ(${p}deg)`:""}_update(i){cancelAnimationFrame(this._updateFrameId);const c=this._map;c&&(c.transform.renderWorldCopies&&(this._lngLat=cs(this._lngLat,this._pos,c.transform)),this._pos=c.project(this._lngLat,this._altitude),i===!0?this._updateFrameId=requestAnimationFrame((()=>{this._element&&this._pos&&this._anchor&&(this._pos=this._pos.round(),this._updateDOM())})):this._pos=this._pos.round(),c._requestDomTask((()=>{this._map&&(this._element&&this._pos&&this._anchor&&this._updateDOM(),(c._showingGlobe()||c.getTerrain()||c.getFog())&&!this._fadeTimer&&(this._fadeTimer=window.setTimeout(this._evaluateOpacity.bind(this),60)))})))}getOffset(){return this._offset}setOffset(i){return this._offset=n.P.convert(i),this._update(),this}addClassName(i){return this._element.classList.add(i),this}removeClassName(i){return this._element.classList.remove(i),this}toggleClassName(i){return this._element.classList.toggle(i)}_onMove(i){const c=this._map;if(!c)return;const p=this._pointerdownPos,x=this._positionDelta;if(p&&x){if(!this._isDragging){const w=this._clickTolerance||c._clickTolerance;if(i.point.dist(p)<w)return;this._isDragging=!0}this._pos=i.point.sub(x),this._lngLat=c.unproject(this._pos,this._altitude),this.setLngLat(this._lngLat),this._element.style.pointerEvents="none",this._state==="pending"&&(this._state="active",this.fire(new n.z("dragstart"))),this.fire(new n.z("drag"))}}_onUp(){this._element.style.pointerEvents="auto",this._positionDelta=null,this._pointerdownPos=null,this._isDragging=!1;const i=this._map;i&&(i.off("mousemove",this._onMove),i.off("touchmove",this._onMove)),this._state==="active"&&this.fire(new n.z("dragend")),this._state="inactive"}_addDragHandler(i){const c=this._map,p=this._pos;c&&p&&this._element.contains(i.originalEvent.target)&&(i.preventDefault(),this._positionDelta=i.point.sub(p),this._pointerdownPos=i.point,this._state="pending",c.on("mousemove",this._onMove),c.on("touchmove",this._onMove),c.once("mouseup",this._onUp),c.once("touchend",this._onUp))}setDraggable(i){this._draggable=!!i;const c=this._map;return c&&(i?(c.on("mousedown",this._addDragHandler),c.on("touchstart",this._addDragHandler)):(c.off("mousedown",this._addDragHandler),c.off("touchstart",this._addDragHandler))),this}isDraggable(){return this._draggable}setRotation(i){return this._rotation=i||Ca.rotation,this._update(),this}getRotation(){return this._rotation}setRotationAlignment(i){return this._rotationAlignment=i||Ca.rotationAlignment,this._update(),this}getRotationAlignment(){return this._rotationAlignment==="auto"||this._rotationAlignment==="horizon"&&this._map&&!this._map._showingGlobe()?"viewport":this._rotationAlignment}setPitchAlignment(i){return this._pitchAlignment=i||Ca.pitchAlignment,this._update(),this}getPitchAlignment(){return this._pitchAlignment==="auto"?this.getRotationAlignment():this._pitchAlignment}setOccludedOpacity(i){return this._occludedOpacity=i||Ca.occludedOpacity,this._update(),this}getOccludedOpacity(){return this._occludedOpacity}}const zl={positionOptions:{enableHighAccuracy:!1,maximumAge:0,timeout:6e3},fitBoundsOptions:{maxZoom:15},trackUserLocation:!1,showAccuracyCircle:!0,showUserLocation:!0,showUserHeading:!1},ol={maxWidth:100,unit:"metric"},Ls={kilometer:"km",meter:"m",mile:"mi",foot:"ft","nautical-mile":"nm"},Su={closeButton:!0,closeOnClick:!0,focusAfterOpen:!0,className:"",maxWidth:"240px",altitude:0},Bo=["a[href]","[tabindex]:not([tabindex='-1'])","[contenteditable]:not([contenteditable='false'])","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])"].join(", ");function mo(g=new n.P(0,0),i="bottom"){if(typeof g=="number"){const c=Math.round(Math.sqrt(.5*Math.pow(g,2)));switch(i){case"top":return new n.P(0,g);case"top-left":return new n.P(c,c);case"top-right":return new n.P(-c,c);case"bottom":return new n.P(0,-g);case"bottom-left":return new n.P(c,-c);case"bottom-right":return new n.P(-c,-c);case"left":return new n.P(g,0);case"right":return new n.P(-g,0)}return new n.P(0,0)}return g instanceof n.P||Array.isArray(g)?n.P.convert(g):n.P.convert(g[i]||[0,0])}return{version:C,supported:ie.supported,setRTLTextPlugin:n.f2,getRTLTextPluginStatus:n.f1,Map:class extends nl{constructor(g){L.mark(D.create);const i=g;if((g=Object.assign({},pf,g)).minZoom!=null&&g.maxZoom!=null&&g.minZoom>g.maxZoom)throw new Error("maxZoom must be greater than or equal to minZoom");if(g.minPitch!=null&&g.maxPitch!=null&&g.minPitch>g.maxPitch)throw new Error("maxPitch must be greater than or equal to minPitch");if(g.minPitch!=null&&g.minPitch<0)throw new Error("minPitch must be greater than or equal to 0");if(g.maxPitch!=null&&g.maxPitch>85)throw new Error("maxPitch must be less than or equal to 85");if(g.antialias&&n.eW(window)&&(g.antialias=!1,n.w("Antialiasing is disabled for this WebGL context to avoid browser bug: https://github.com/mapbox/mapbox-gl-js/issues/11609")),super(new la(g.minZoom,g.maxZoom,g.minPitch,g.maxPitch,g.renderWorldCopies,null,null),g),this._repaint=!!g.repaint,this._interactive=g.interactive,this._minTileCacheSize=g.minTileCacheSize,this._maxTileCacheSize=g.maxTileCacheSize,this._failIfMajorPerformanceCaveat=g.failIfMajorPerformanceCaveat,this._preserveDrawingBuffer=g.preserveDrawingBuffer,this._antialias=g.antialias,this._trackResize=g.trackResize,this._bearingSnap=g.bearingSnap,this._refreshExpiredTiles=g.refreshExpiredTiles,this._fadeDuration=g.fadeDuration,this._isInitialLoad=!0,this._crossSourceCollisions=g.crossSourceCollisions,this._collectResourceTiming=g.collectResourceTiming,this._language=this._parseLanguage(g.language),this._worldview=g.worldview,this._renderTaskQueue=new gi,this._domRenderTaskQueue=new gi,this._controls=[],this._markers=[],this._popups=[],this._mapId=n.b2(),this._locale=Object.assign({},bd,g.locale),this._clickTolerance=g.clickTolerance,this._cooperativeGestures=g.cooperativeGestures,this._performanceMetricsCollection=g.performanceMetricsCollection,this._tessellationStep=g.tessellationStep,this._containerWidth=0,this._containerHeight=0,this._showParseStatus=!0,this._precompilePrograms=g.precompilePrograms,this._scaleFactorChanged=!1,this._averageElevationLastSampledAt=-1/0,this._averageElevationExaggeration=0,this._averageElevation=new Bl(0),this._interactionRange=[1/0,-1/0],this._visibilityHidden=0,this._useExplicitProjection=!1,this._frameId=0,this._scaleFactor=g.scaleFactor,this._requestManager=new zi(g.transformRequest,g.accessToken,g.testMode),this._silenceAuthErrors=!!g.testMode,this._contextCreateOptions=g.contextCreateOptions?Object.assign({},g.contextCreateOptions):{},typeof g.container=="string"){const c=document.getElementById(g.container);if(!c)throw new Error(`Container '${g.container.toString()}' not found.`);this._container=c}else{if(!(g.container instanceof HTMLElement))throw new Error("Invalid type: 'container' must be a String or HTMLElement.");this._container=g.container}if(this._container.childNodes.length>0&&n.w("The map container element should be empty, otherwise the map's interactivity will be negatively impacted. If you want to display a message when WebGL is not supported, use the Mapbox GL Supported plugin instead."),g.maxBounds&&this.setMaxBounds(g.maxBounds),this._spriteFormat=g.spriteFormat,n.aY(["_onWindowOnline","_onWindowResize","_onVisibilityChange","_onMapScroll","_contextLost","_contextRestored"],this),this._setupContainer(),this._tp||(this._tp=new of),this._tp.registerParameter(this,["Debug"],"showOverdrawInspector"),this._tp.registerParameter(this,["Debug"],"showTileBoundaries"),this._tp.registerParameter(this,["Debug"],"showParseStatus"),this._tp.registerParameter(this,["Debug"],"repaint"),this._tp.registerParameter(this,["Debug"],"showTileAABBs"),this._tp.registerParameter(this,["Debug"],"showPadding"),this._tp.registerParameter(this,["Debug"],"showCollisionBoxes",{noSave:!0}),this._tp.registerParameter(this.transform,["Debug"],"freezeTileCoverage",{noSave:!0},(()=>{this._update()})),this._tp.registerParameter(this,["Debug","Wireframe"],"showTerrainWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers2DWireframe"),this._tp.registerParameter(this,["Debug","Wireframe"],"showLayers3DWireframe"),this._tp.registerParameter(this,["Scaling"],"_scaleFactor",{min:.1,max:10,step:.1},(()=>{this.setScaleFactor(this._scaleFactor)})),this._setupPainter(),this.painter===void 0)throw new Error("Failed to initialize WebGL.");if(this.on("move",(()=>this._update(!1))),this.on("moveend",(()=>this._update(!1))),this.on("zoom",(()=>this._update(!0))),this._fullscreenchangeEvent="onfullscreenchange"in document?"fullscreenchange":"webkitfullscreenchange",window.addEventListener("online",this._onWindowOnline,!1),window.addEventListener("resize",this._onWindowResize,!1),window.addEventListener("orientationchange",this._onWindowResize,!1),window.addEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.addEventListener("visibilitychange",this._onVisibilityChange,!1),this.handlers=new xd(this,g),this._localFontFamily=g.localFontFamily,this._localIdeographFontFamily=g.localIdeographFontFamily,(g.style||!g.testMode)&&this.setStyle(g.style||n.e.DEFAULT_STYLE,{config:g.config,localFontFamily:this._localFontFamily,localIdeographFontFamily:this._localIdeographFontFamily}),g.projection&&this.setProjection(g.projection),this.indoor=new Ju(this),g.hash&&(this._hash=new bp(typeof g.hash=="string"&&g.hash||void 0).addTo(this)),!this._hash||!this._hash._onHashChange()){i.center==null&&i.zoom==null||(this.transform._unmodified=!1),this.jumpTo({center:g.center,zoom:g.zoom,bearing:g.bearing,pitch:g.pitch});const c=g.bounds;c&&(this.resize(),this.fitBounds(c,Object.assign({},g.fitBoundsOptions,{duration:0})))}this.resize(),g.attributionControl&&this.addControl(new hf({customAttribution:g.customAttribution})),this._logoControl=new ls,this.addControl(this._logoControl,g.logoPosition),this.on("style.load",(()=>{this.transform.unmodified&&this.jumpTo(this.style.stylesheet),this._postStyleLoadEvent()})),this.on("data",(c=>{this._update(c.dataType==="style"),this.fire(new n.z(`${c.dataType}data`,c))})),this.on("dataloading",(c=>{this.fire(new n.z(`${c.dataType}dataloading`,c))})),this._interactions=new df(this)}_getMapId(){return this._mapId}addControl(g,i){if(i===void 0&&(i=g.getDefaultPosition?g.getDefaultPosition():"top-right"),!g||!g.onAdd)return this.fire(new n.y(new Error("Invalid argument to map.addControl(). Argument must be a control with onAdd and onRemove methods.")));const c=g.onAdd(this);this._controls.push(g);const p=this._controlPositions[i];return i.indexOf("bottom")!==-1?p.insertBefore(c,p.firstChild):p.appendChild(c),this}removeControl(g){if(!g||!g.onRemove)return this.fire(new n.y(new Error("Invalid argument to map.removeControl(). Argument must be a control with onAdd and onRemove methods.")));const i=this._controls.indexOf(g);return i>-1&&this._controls.splice(i,1),g.onRemove(this),this}hasControl(g){return this._controls.indexOf(g)>-1}getContainer(){return this._container}getCanvasContainer(){return this._canvasContainer}getCanvas(){return this._canvas}resize(g){if(this._updateContainerDimensions(),this._containerWidth===this.transform.width&&this._containerHeight===this.transform.height)return this;this._resizeCanvas(this._containerWidth,this._containerHeight),this.transform.resize(this._containerWidth,this._containerHeight),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight));const i=!this._moving;return i&&this.fire(new n.z("movestart",g)).fire(new n.z("move",g)),this.fire(new n.z("resize",g)),i&&this.fire(new n.z("moveend",g)),this}getBounds(){return this.transform.getBounds()}getMaxBounds(){return this.transform.getMaxBounds()||null}setMaxBounds(g){return this.transform.setMaxBounds(n.aI.convert(g)),this._update()}setMinZoom(g){if((g=g??-2)>=-2&&g<=this.transform.maxZoom)return this.transform.minZoom=g,this._update(),this.getZoom()<g?this.setZoom(g):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("minZoom must be between -2 and the current maxZoom, inclusive")}getMinZoom(){return this.transform.minZoom}setMaxZoom(g){if((g=g??22)>=this.transform.minZoom)return this.transform.maxZoom=g,this._update(),this.getZoom()>g?this.setZoom(g):this.fire(new n.z("zoomstart")).fire(new n.z("zoom")).fire(new n.z("zoomend")),this;throw new Error("maxZoom must be greater than the current minZoom")}getMaxZoom(){return this.transform.maxZoom}setMinPitch(g){if((g=g??0)<0)throw new Error("minPitch must be greater than or equal to 0");if(g>=0&&g<=this.transform.maxPitch)return this.transform.minPitch=g,this._update(),this.getPitch()<g?this.setPitch(g):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("minPitch must be between 0 and the current maxPitch, inclusive")}getMinPitch(){return this.transform.minPitch}setMaxPitch(g){if((g=g??85)>85)throw new Error("maxPitch must be less than or equal to 85");if(g>=this.transform.minPitch)return this.transform.maxPitch=g,this._update(),this.getPitch()>g?this.setPitch(g):this.fire(new n.z("pitchstart")).fire(new n.z("pitch")).fire(new n.z("pitchend")),this;throw new Error("maxPitch must be greater than or equal to minPitch")}getMaxPitch(){return this.transform.maxPitch}getScaleFactor(){return this._scaleFactor}setScaleFactor(g){return this._scaleFactor=g,this.painter.scaleFactor=g,this._tp.refreshUI(),this._scaleFactorChanged=!0,this.style._updateFilteredLayers((i=>i.type==="symbol")),this._update(!0),this}getRenderWorldCopies(){return this.transform.renderWorldCopies}setRenderWorldCopies(g){return this.transform.renderWorldCopies=g,this.transform.renderWorldCopies||this._forceMarkerAndPopupUpdate(!0),this._update()}getLanguage(){return this._language}_parseLanguage(g){return g==="auto"?navigator.language:Array.isArray(g)?g.length===0?void 0:g.map((i=>i==="auto"?navigator.language:i)):g}setLanguage(g){const i=this._parseLanguage(g);if(!this.style||i===this._language)return this;this._language=i,this.style.reloadSources();for(const c of this._controls)c._setLanguage&&c._setLanguage(this._language);return this}getWorldview(){return this._worldview}setWorldview(g){return this.style&&g!==this._worldview?(this._worldview=g,this._styleDirty=!0,this.style.reloadSources(),this):this}getProjection(){return this.transform.mercatorFromTransition?{name:"globe",center:[0,0]}:this.transform.getProjection()}_showingGlobe(){return this.transform.projection.name==="globe"}setProjection(g){return this._lazyInitEmptyStyle(),g?typeof g=="string"&&(g={name:g}):g=null,this._useExplicitProjection=!!g,this._prioritizeAndUpdateProjection(g,this.style.projection)}_updateProjectionTransition(){if(this.getProjection().name!=="globe")return;const g=this.transform,i=g.projection.name;let c;i==="globe"&&g.zoom>=n.cK?(g.setMercatorFromTransition(),c=!0):i==="mercator"&&g.zoom<n.cK&&(g.setProjection({name:"globe"}),c=!0),c&&(this.style.applyProjectionUpdate(),this.style._forceSymbolLayerUpdate(),this._update(!0))}_prioritizeAndUpdateProjection(g,i){return this._updateProjection(g||i||{name:"mercator"})}_updateProjection(g){let i;return i=g.name==="globe"&&this.transform.zoom>=n.cK?this.transform.setMercatorFromTransition():this.transform.setProjection(g),this.style.applyProjectionUpdate(),i&&(this.painter.clearBackgroundTiles(),this.style.clearSources(),this._update(!0),this._forceMarkerAndPopupUpdate(!0)),this}project(g,i){return this.transform.locationPoint3D(n.aR.convert(g),i)}unproject(g,i){return this.transform.pointLocation3D(n.P.convert(g),i)}isMoving(){return this._moving||this.handlers&&this.handlers.isMoving()||!1}isZooming(){return this._zooming||this.handlers&&this.handlers.isZooming()||!1}isRotating(){return this._rotating||this.handlers&&this.handlers.isRotating()||!1}_isDragging(){return this.handlers&&this.handlers._isDragging()||!1}_createDelegatedListener(g,i,c){const p=x=>{let w=[];if(Array.isArray(i)){const A=i.filter((I=>this.getLayer(I)));w=A.length?this.queryRenderedFeatures(x,{layers:A}):[]}else w=this.queryRenderedFeatures(x,{target:i});return w};if(g==="mouseenter"||g==="mouseover"){let x=!1;return{listener:c,targets:i,delegates:{mousemove:A=>{const I=p(A.point);I.length?x||(x=!0,c.call(this,new Un(g,this,A.originalEvent,{features:I}))):x=!1},mouseout:()=>{x=!1}}}}if(g==="mouseleave"||g==="mouseout"){let x=!1;return{listener:c,targets:i,delegates:{mousemove:I=>{p(I.point).length?x=!0:x&&(x=!1,c.call(this,new Un(g,this,I.originalEvent)))},mouseout:I=>{x&&(x=!1,c.call(this,new Un(g,this,I.originalEvent)))}}}}{const x=w=>{const A=p(w.point);A.length&&(w.features=A,c.call(this,w),delete w.features)};return{listener:c,targets:i,delegates:{[g]:x}}}}on(g,i,c){if(typeof i=="function"||c===void 0)return super.on(g,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const p=this._createDelegatedListener(g,i,c);this._delegatedListeners=this._delegatedListeners||{},this._delegatedListeners[g]=this._delegatedListeners[g]||[],this._delegatedListeners[g].push(p);for(const x in p.delegates)this.on(x,p.delegates[x]);return this}once(g,i,c){if(typeof i=="function"||c===void 0)return super.once(g,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const p=this._createDelegatedListener(g,i,c);for(const x in p.delegates)this.once(x,p.delegates[x]);return this}off(g,i,c){if(typeof i=="function"||c===void 0)return super.off(g,i);if(typeof i=="string"&&(i=[i]),!this._areTargetsValid(i))return this;const p=this._delegatedListeners?this._delegatedListeners[g]:void 0;return p&&(x=>{for(let w=0;w<x.length;w++){const A=x[w];if(A.listener===c&&bu(A.targets,i)){for(const I in A.delegates)this.off(I,A.delegates[I]);return x.splice(w,1),this}}})(p),this}queryRenderedFeatures(g,i){if(!this.style)return[];if(g===void 0||g instanceof n.P||Array.isArray(g)||i!==void 0||(i=g,g=void 0),g=g||[[0,0],[this.transform.width,this.transform.height]],!i){const w=this.style.queryRenderedFeatures(g,void 0,this.transform),A=this.style.queryRenderedFeatureset(g,void 0,this.transform);return w.concat(A)}let c=!0;if(i.target&&(c=this._isTargetValid(i.target),c&&!i.layers))return this.style.queryRenderedFeatureset(g,i,this.transform);let p=!0;if(i.layers&&Array.isArray(i.layers)){for(const w of i.layers)if(!this._isValidId(w)){p=!1;break}if(p&&!i.target)return this.style.queryRenderedFeatures(g,i,this.transform)}let x=[];return p&&(x=x.concat(this.style.queryRenderedFeatures(g,i,this.transform))),c&&(x=x.concat(this.style.queryRenderedFeatureset(g,i,this.transform))),x}querySourceFeatures(g,i){return!g||typeof g=="string"&&!this._isValidId(g)?[]:this.style.querySourceFeatures(g,i)}queryRasterValue(g,i,c){return this._isValidId(g)?this.style.queryRasterValue(g,i,c):Promise.resolve(null)}isPointOnSurface(g){const{name:i}=this.transform.projection;return i!=="globe"&&i!=="mercator"&&n.w(`${i} projection does not support isPointOnSurface, this API may behave unexpectedly.`),this.transform.isPointOnSurface(n.P.convert(g))}addInteraction(g,i){return this._interactions.add(g,i),this}removeInteraction(g){return this._interactions.remove(g),this}getCooperativeGestures(){return this._cooperativeGestures}setCooperativeGestures(g){return this._cooperativeGestures=g,this}setStyle(g,i){return i=Object.assign({},{localIdeographFontFamily:this._localIdeographFontFamily,localFontFamily:this._localFontFamily},i),this.style&&g&&i.diff!==!1&&i.localFontFamily===this._localFontFamily&&i.localIdeographFontFamily===this._localIdeographFontFamily&&!i.config?(this.style._diffStyle(g,((c,p)=>{if(c){const x=typeof c=="string"?c:c instanceof Error?c.message:c.error;n.w(`Unable to perform style diff: ${x}. Rebuilding the style from scratch.`),this._updateStyle(g,i)}else p&&this._update(!0)}),(()=>this._postStyleLoadEvent())),this):(this._localIdeographFontFamily=i.localIdeographFontFamily,this._localFontFamily=i.localFontFamily,this._updateStyle(g,i))}_getUIString(g){const i=this._locale[g];if(i==null)throw new Error(`Missing UI string '${g}'`);return i}_updateStyle(g,i){if(this.style&&(this.style.setEventedParent(null),this.style._remove(),this.style=void 0),g){const c=Object.assign({},i);i&&i.config&&(c.initialConfig=i.config,delete c.config),this.style=new ns(this,c).load(g),this.style.setEventedParent(this,{style:this.style})}return this._updateTerrain(),this}_lazyInitEmptyStyle(){this.style||(this.style=new ns(this,{}),this.style.setEventedParent(this,{style:this.style}),this.style.loadEmpty())}getStyle(){if(this.style)return this.style.serialize()}isStyleLoaded(){return this.style?this.style.loaded():(n.w("There is no style added to the map."),!1)}_isValidId(g){return g==null?(this.fire(new n.y(new Error("IDs can't be empty."))),!1):!n.dm(g)||(this.fire(new n.y(new Error(`IDs can't contain special symbols: "${g}".`))),!1)}_isTargetValid(g){return"featuresetId"in g?this._isValidId("importId"in g?g.importId:g.featuresetId):"layerId"in g&&this._isValidId(g.layerId)}_areTargetsValid(g){if(Array.isArray(g)){for(const i of g)if(!this._isValidId(i))return!1;return!0}return this._isTargetValid(g)}addSource(g,i){return this._isValidId(g)?(this._lazyInitEmptyStyle(),this.style.addSource(g,i),this._update(!0)):this}isSourceLoaded(g){return!!this._isValidId(g)&&!!this.style&&this.style._isSourceCacheLoaded(g)}areTilesLoaded(){return this.style.areTilesLoaded()}addSourceType(g,i,c){this._lazyInitEmptyStyle(),this.style.addSourceType(g,i,c)}removeSource(g){return this._isValidId(g)?(this.style.removeSource(g),this._updateTerrain(),this._update(!0)):this}getSource(g){return this._isValidId(g)?this.style.getOwnSource(g):null}addImage(g,i,{pixelRatio:c=1,sdf:p=!1,stretchX:x,stretchY:w,content:A}={}){this._lazyInitEmptyStyle();const I=n.I.from(g);if(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap){const{width:O,height:z,data:k}=n.o.getImageData(i);this.style.addImage(I,{data:new n.q({width:O,height:z},k),pixelRatio:c,stretchX:x,stretchY:w,content:A,sdf:p,version:0,usvg:!1})}else if(i.width===void 0||i.height===void 0)this.fire(new n.y(new Error("Invalid arguments to map.addImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));else{const{width:O,height:z}=i,k=i;this.style.addImage(I,{data:new n.q({width:O,height:z},new Uint8Array(k.data)),pixelRatio:c,stretchX:x,stretchY:w,content:A,sdf:p,usvg:!1,version:0,userImage:k}),k.onAdd&&k.onAdd(this,g)}}updateImage(g,i){this._lazyInitEmptyStyle();const c=n.I.from(g),p=this.style.getImage(c);if(!p)return void this.fire(new n.y(new Error("The map has no image with that id. If you are adding a new image use `map.addImage(...)` instead.")));const x=i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap?n.o.getImageData(i):i,{width:w,height:A,data:I}=x;if(w===void 0||A===void 0)return void this.fire(new n.y(new Error("Invalid arguments to map.updateImage(). The second argument must be an `HTMLImageElement`, `ImageData`, `ImageBitmap`, or object with `width`, `height`, and `data` properties with the same format as `ImageData`")));if(w!==(p.usvg?p.icon.usvg_tree.width:p.data.width)||A!==(p.usvg?p.icon.usvg_tree.height:p.data.height))return void this.fire(new n.y(new Error(`The width and height of the updated image (${w}, ${A})
                must be that same as the previous version of the image
                (${p.data.width}, ${p.data.height})`)));const O=!(i instanceof HTMLImageElement||ImageBitmap&&i instanceof ImageBitmap);let z=!1;p.usvg?(p.data=new n.q({width:w,height:A},new Uint8Array(I)),p.usvg=!1,p.icon=void 0,z=!0):p.data.replace(I,O),this.style.updateImage(c,p,z)}hasImage(g){return g?!!this.style&&!!this.style.getImage(n.I.from(g)):(this.fire(new n.y(new Error("Missing required image id"))),!1)}removeImage(g){this.style.removeImage(n.I.from(g))}loadImage(g,i){n.n(this._requestManager.transformRequest(g,n.R.Image),((c,p)=>{i(c,p instanceof HTMLImageElement?n.o.getImageData(p):p)}))}listImages(){return this.style.listImages().map((g=>g.name))}addModel(g,i){this._lazyInitEmptyStyle(),this.style.addModel(g,i)}hasModel(g){return g?this.style.hasModel(g):(this.fire(new n.y(new Error("Missing required model id"))),!1)}removeModel(g){this.style.removeModel(g)}listModels(){return this.style.listModels()}addLayer(g,i){return this._isValidId(g.id)?(this._lazyInitEmptyStyle(),this.style.addLayer(g,i),this._update(!0)):this}getSlot(g){const i=this.getLayer(g);return i&&i.slot||null}setSlot(g,i){return this.style.setSlot(g,i),this.style.mergeLayers(),this._update(!0)}addImport(g,i){return this.style.addImport(g,i).catch((c=>this.fire(new n.y(new Error("Failed to add import",c))))),this}updateImport(g,i){return typeof i!="string"&&i.id!==g?(this.removeImport(g),this.addImport(i)):(this.style.updateImport(g,i),this._update(!0))}removeImport(g){return this.style.removeImport(g),this}moveImport(g,i){return this.style.moveImport(g,i),this._update(!0)}moveLayer(g,i){return this._isValidId(g)?(this.style.moveLayer(g,i),this._update(!0)):this}removeLayer(g){return this._isValidId(g)?(this.style.removeLayer(g),this._update(!0)):this}getLayer(g){if(!this._isValidId(g))return null;const i=this.style.getOwnLayer(g);return i?i.type==="custom"?i.implementation:i.serialize():void 0}getSlots(){return this.style.getSlots()}setLayerZoomRange(g,i,c){return this._isValidId(g)?(this.style.setLayerZoomRange(g,i,c),this._update(!0)):this}setFilter(g,i,c={}){return this._isValidId(g)?(this.style.setFilter(g,i,c),this._update(!0)):this}getFilter(g){return this._isValidId(g)?this.style.getFilter(g):null}setPaintProperty(g,i,c,p={}){return this._isValidId(g)?(this.style.setPaintProperty(g,i,c,p),this._update(!0)):this}getPaintProperty(g,i){return this._isValidId(g)?this.style.getPaintProperty(g,i):null}setLayoutProperty(g,i,c,p={}){return this._isValidId(g)?(this.style.setLayoutProperty(g,i,c,p),this._update(!0)):this}getLayoutProperty(g,i){return this._isValidId(g)?this.style.getLayoutProperty(g,i):null}getGlyphsUrl(){return this.style.getGlyphsUrl()}setGlyphsUrl(g){return this.style.setGlyphsUrl(g),this._update(!0)}getSchema(g){return this.style.getSchema(g)}setSchema(g,i){return this.style.setSchema(g,i),this._update(!0)}getConfig(g){return this.style.getConfig(g)}setConfig(g,i){return this.style.setConfig(g,i),this._update(!0)}getConfigProperty(g,i){return this.style.getConfigProperty(g,i)}setConfigProperty(g,i,c){return this.style.setConfigProperty(g,i,c),this._update(!0)}getFeaturesetDescriptors(g){return this.style.getFeaturesetDescriptors(g)}setLights(g){if(this._lazyInitEmptyStyle(),g&&g.length===1&&g[0].type==="flat"){const i=g[0];i.properties?this.style.setFlatLight(i.properties,i.id,{}):this.style.setFlatLight({},"flat")}else this.style.setLights(g),this.painter.terrain&&(this.painter.terrain.invalidateRenderCache=!0);return this._update(!0)}getLights(){const g=this.style.getLights()||[];return g.length===0&&g.push({id:this.style.light.id,type:"flat",properties:this.style.getFlatLight()}),g}setLight(g,i={}){return console.log("The `map.setLight` function is deprecated, prefer using `map.setLights` with `flat` light type instead."),this.setLights([{id:"flat",type:"flat",properties:g}])}getLight(){return console.log("The `map.getLight` function is deprecated, prefer using `map.getLights` instead."),this.style.getFlatLight()}setTerrain(g){return this._lazyInitEmptyStyle(),!g&&this.transform.projection.requiresDraping?this.style.setTerrainForDraping():this.style.setTerrain(g),this._averageElevationLastSampledAt=-1/0,this._update(!0)}getTerrain(){return this.style?this.style.getTerrain():null}setFog(g){return this._lazyInitEmptyStyle(),this.style.setFog(g),this._update(!0)}getFog(){return this.style?this.style.getFog():null}setSnow(g){return this._lazyInitEmptyStyle(),this.style.setSnow(g),this._update(!0)}getSnow(){return this.style?this.style.getSnow():null}setRain(g){return this._lazyInitEmptyStyle(),this.style.setRain(g),this._update(!0)}getRain(){return this.style?this.style.getRain():null}setColorTheme(g){return this._lazyInitEmptyStyle(),this.style.setColorTheme(g),this._update(!0)}setImportColorTheme(g,i){return this._lazyInitEmptyStyle(),this.style.setImportColorTheme(g,i),this._update(!0)}setCamera(g){return this.style.setCamera(g),this._triggerCameraUpdate(g)}_triggerCameraUpdate(g){return this._update(this.transform.setOrthographicProjectionAtLowPitch(g["camera-projection"]==="orthographic"))}getCamera(){return this.style.camera}_queryFogOpacity(g){return this.style&&this.style.fog?this.style.fog.getOpacityAtLatLng(n.aR.convert(g),this.transform):0}setFeatureState(g,i){return g.source&&!this._isValidId(g.source)?this:(this.style.setFeatureState(g,i),this._update())}removeFeatureState(g,i){return g.source&&!this._isValidId(g.source)?this:(this.style.removeFeatureState(g,i),this._update())}getFeatureState(g){return g.source&&!this._isValidId(g.source)?null:this.style.getFeatureState(g)}_selectIndoorFloor(g){this.indoor.selectFloor(g)}_addIndoorControl(){this._indoorControl||(this._indoorControl=new Dc),this.addControl(this._indoorControl,"right")}_removeIndoorControl(){this._indoorControl&&this.removeControl(this._indoorControl)}_updateContainerDimensions(){if(!this._container)return;const g=this._container.getBoundingClientRect().width||400,i=this._container.getBoundingClientRect().height||300;let c,p,x,w=this._container;for(;w&&(!p||!x);){const A=window.getComputedStyle(w).transform;A&&A!=="none"&&(c=A.match(/matrix.*\((.+)\)/)[1].split(", "),c[0]&&c[0]!=="0"&&c[0]!=="1"&&(p=c[0]),c[3]&&c[3]!=="0"&&c[3]!=="1"&&(x=c[3])),w=w.parentElement}this._containerWidth=p?Math.abs(g/p):g,this._containerHeight=x?Math.abs(i/x):i}_detectMissingCSS(){window.getComputedStyle(this._missingCSSCanary).getPropertyValue("background-color")!=="rgb(250, 128, 114)"&&n.w("This page appears to be missing CSS declarations for Mapbox GL JS, which may cause the map to display incorrectly. Please ensure your page includes mapbox-gl.css, as described in https://www.mapbox.com/mapbox-gl-js/api/.")}_setupContainer(){const g=this._container;g.classList.add("mapboxgl-map"),(this._missingCSSCanary=ne("div","mapboxgl-canary",g)).style.visibility="hidden",this._detectMissingCSS();const i=this._canvasContainer=ne("div","mapboxgl-canvas-container",g);this._canvas=ne("canvas","mapboxgl-canvas",i),this._interactive&&(i.classList.add("mapboxgl-interactive"),this._canvas.setAttribute("tabindex","0")),this._canvas.addEventListener("webglcontextlost",this._contextLost,!1),this._canvas.addEventListener("webglcontextrestored",this._contextRestored,!1),this._canvas.setAttribute("aria-label",this._getUIString("Map.Title")),this._canvas.setAttribute("role","region"),this._updateContainerDimensions(),this._resizeCanvas(this._containerWidth,this._containerHeight);const c=this._controlContainer=ne("div","mapboxgl-control-container",g),p=this._controlPositions={};["top-left","top","top-right","right","bottom-right","bottom","bottom-left","left"].forEach((x=>{p[x]=ne("div",`mapboxgl-ctrl-${x}`,c)})),this._container.addEventListener("scroll",this._onMapScroll,!1)}_resizeCanvas(g,i){const c=n.o.devicePixelRatio||1;this._canvas.width=c*Math.ceil(g),this._canvas.height=c*Math.ceil(i),this._canvas.style.width=`${g}px`,this._canvas.style.height=`${i}px`}_addMarker(g){this._markers.push(g)}_removeMarker(g){const i=this._markers.indexOf(g);i!==-1&&this._markers.splice(i,1)}_addPopup(g){this._popups.push(g)}_removePopup(g){const i=this._popups.indexOf(g);i!==-1&&this._popups.splice(i,1)}_setupPainter(){const g=Object.assign({},ie.supported.webGLContextAttributes,{failIfMajorPerformanceCaveat:this._failIfMajorPerformanceCaveat,preserveDrawingBuffer:this._preserveDrawingBuffer,antialias:this._antialias||!1}),i=this._canvas.getContext("webgl2",g);i?(gl(i,!0),this.painter=new af(i,this._contextCreateOptions,this.transform,this._scaleFactor,this._tp,this._worldview),this.on("data",(c=>{c.dataType==="source"&&this.painter.setTileLoadedFlag(!0)})),n.k.testSupport(i)):this.fire(new n.y(new Error("Failed to initialize WebGL")))}_contextLost(g){g.preventDefault(),this._frame&&(this._frame.cancel(),this._frame=null),this.fire(new n.z("webglcontextlost",{originalEvent:g}))}_contextRestored(g){this._setupPainter(),this.painter.resize(Math.ceil(this._containerWidth),Math.ceil(this._containerHeight)),this._updateTerrain(),this.style&&(this.style.clearLayers(),this.style.imageManager.destroyAtlasTextures(),this.style.reloadModels(),this.style.clearSources()),this._update(),this.fire(new n.z("webglcontextrestored",{originalEvent:g}))}_onMapScroll(g){if(g.target===this._container)return this._container.scrollTop=0,this._container.scrollLeft=0,!1}idle(){return!this.isMoving()&&this.loaded()}loaded(){return!this._styleDirty&&!this._sourcesDirty&&!!this.style&&this.style.loaded()}frameReady(){return this.loaded()&&!this._placementDirty}_update(g){return this.style?(this._styleDirty=this._styleDirty||g,this._sourcesDirty=!0,this.triggerRepaint(),this):this}_requestRenderFrame(g){return this._update(),this._renderTaskQueue.add(g)}_cancelRenderFrame(g){this._renderTaskQueue.remove(g)}_requestDomTask(g){!this.loaded()||this.loaded()&&!this.isMoving()?g():this._domRenderTaskQueue.add(g)}_render(g){let i;this.fire(new n.z("renderstart")),++this._frameId;const c=this.painter.context.extTimerQuery,p=n.o.now(),x=this.painter.context.gl;if(this.listens("gpu-timing-frame")&&(i=x.createQuery(),x.beginQuery(c.TIME_ELAPSED_EXT,i)),this.painter.context.setDirty(),this.painter.setBaseState(),(this.isMoving()||this.isRotating()||this.isZooming())&&(this._interactionRange[0]=Math.min(this._interactionRange[0],performance.now()),this._interactionRange[1]=Math.max(this._interactionRange[1],performance.now())),this._renderTaskQueue.run(g),this._domRenderTaskQueue.run(g),this._removed)return;this._updateProjectionTransition();const w=this._isInitialLoad?0:this._fadeDuration;if(this.style&&this._styleDirty){this._styleDirty=!1;const z=this.transform.zoom,k=this.transform.pitch,H=n.o.now(),V=new n.ac(z,{now:H,fadeDuration:w,pitch:k,transition:this.style.transition,worldview:this._worldview});this.style.update(V)}this.style&&this.style.hasFogTransition()&&(this.style._markersNeedUpdate=!0,this._sourcesDirty=!0);let A=!1;this.style&&this._sourcesDirty?(this._sourcesDirty=!1,this.painter._updateFog(this.style),this._updateTerrain(),A=this._updateAverageElevation(p),this.style.updateSources(this.transform),this.style.updateImageProviders(),this.isMoving()||this._forceMarkerAndPopupUpdate()):A=this._updateAverageElevation(p);const I=this.style&&this.style._updatePlacement(this.painter,this.painter.transform,this.showCollisionBoxes,w,this._crossSourceCollisions,this.painter.replacementSource,this._scaleFactorChanged);if(this._scaleFactorChanged&&(this._scaleFactorChanged=!1),I&&(this._placementDirty=I.needsRerender),this.style&&this.painter.render(this.style,{showTileBoundaries:this.showTileBoundaries,showParseStatus:this.showParseStatus,wireframe:{terrain:this.showTerrainWireframe,layers2D:this.showLayers2DWireframe,layers3D:this.showLayers3DWireframe},showOverdrawInspector:this._showOverdrawInspector,showQueryGeometry:!!this._showQueryGeometry,showTileAABBs:this.showTileAABBs,rotating:this.isRotating(),zooming:this.isZooming(),moving:this.isMoving(),fadeDuration:w,isInitialLoad:this._isInitialLoad,showPadding:this.showPadding,gpuTiming:!!this.listens("gpu-timing-layer"),gpuTimingDeferredRender:!!this.listens("gpu-timing-deferred-render"),speedIndexTiming:this.speedIndexTiming}),this.fire(new n.z("render")),this.loaded()&&!this._loaded&&(this._loaded=!0,L.mark(D.load),this.fire(new n.z("load"))),this.style&&this.style.hasTransitions()&&(this._styleDirty=!0),this.style&&(this.style.snow||this.style.rain)&&(this._styleDirty=!0),this.style&&this.style.imageManager.hasPatternsInFlight()&&(this._styleDirty=!0),this.style&&!this.style.modelManager.isLoaded()&&(this._styleDirty=!0),this.style&&!this._placementDirty&&this.style._releaseSymbolFadeTiles(),i){const z=n.o.now()-p;x.endQuery(c.TIME_ELAPSED_EXT),setTimeout((()=>{const k=x.getQueryParameter(i,x.QUERY_RESULT)/1e6;x.deleteQuery(i),this.fire(new n.z("gpu-timing-frame",{cpuTime:z,gpuTime:k}))}),50)}if(this.listens("gpu-timing-layer")){const z=this.painter.collectGpuTimers();setTimeout((()=>{const k=this.painter.queryGpuTimers(z);this.fire(new n.z("gpu-timing-layer",{layerTimes:k}))}),50)}if(this.listens("gpu-timing-deferred-render")){const z=this.painter.collectDeferredRenderGpuQueries();setTimeout((()=>{const k=this.painter.queryGpuTimeDeferredRender(z);this.fire(new n.z("gpu-timing-deferred-render",{gpuTime:k}))}),50)}const O=this._sourcesDirty||this._styleDirty||this._placementDirty||A;if(O||this._repaint)this.triggerRepaint();else{const z=this.idle();if(z&&(A=this._updateAverageElevation(p,!0)),A)this.triggerRepaint();else if(this._triggerFrame(!1),z&&(this.fire(new n.z("idle")),this._isInitialLoad=!1,this.speedIndexTiming)){const k=this._calculateSpeedIndex();this.fire(new n.z("speedindexcompleted",{speedIndex:k})),this.speedIndexTiming=!1}}!this._loaded||this._fullyLoaded||O||(this._fullyLoaded=!0,L.mark(D.fullLoad),this._performanceMetricsCollection&&vi(this._requestManager._customAccessToken,{width:this.painter.width,height:this.painter.height,interactionRange:this._interactionRange,visibilityHidden:this._visibilityHidden,terrainEnabled:!!this.painter.style.getTerrain(),fogEnabled:!!this.painter.style.getFog(),projection:this.getProjection().name,zoom:this.transform.zoom,renderer:this.painter.context.renderer,vendor:this.painter.context.vendor}),this._authenticate())}_forceMarkerAndPopupUpdate(g){for(const i of this._markers)g&&!this.getRenderWorldCopies()&&(i._lngLat=i._lngLat.wrap()),i._update();for(const i of this._popups)!g||this.getRenderWorldCopies()||i._trackPointer||(i._lngLat=i._lngLat.wrap()),i._update()}_updateAverageElevation(g,i=!1){const c=x=>(this.transform.averageElevation=x,this._update(!1),!0);if(!this.painter.averageElevationNeedsEasing())return this.transform.averageElevation!==0&&c(0);const p=this.transform.elevation&&this.transform.elevation.exaggeration()!==this._averageElevationExaggeration;if(p||(i||g-this._averageElevationLastSampledAt>500)&&!this._averageElevation.isEasing(g)){const x=this.transform.averageElevation;let w=this.transform.sampleAverageElevation();this.transform.elevation!=null&&(this._averageElevationExaggeration=this.transform.elevation.exaggeration()),isNaN(w)?w=0:this._averageElevationLastSampledAt=g;const A=Math.abs(x-w);if(A>1){if(this._isInitialLoad||p)return this._averageElevation.jumpTo(w),c(w);this._averageElevation.easeTo(w,g,300)}else if(A>1e-4)return this._averageElevation.jumpTo(w),c(w)}return!!this._averageElevation.isEasing(g)&&c(this._averageElevation.getValue(g))}_authenticate(){Tn(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(g=>{if(g&&(g.message===ui||g.status===401)){const i=this.painter.context.gl;gl(i,!1),this._logoControl instanceof ls&&this._logoControl._updateLogo(),i&&i.clear(i.DEPTH_BUFFER_BIT|i.COLOR_BUFFER_BIT|i.STENCIL_BUFFER_BIT),this._silenceAuthErrors||this.fire(new n.y(new Error("A valid Mapbox access token is required to use Mapbox GL JS. To create an account or a new access token, visit https://account.mapbox.com/")))}})),oi(this._getMapId(),this._requestManager._skuToken,this._requestManager._customAccessToken,(()=>{}))}_postStyleLoadEvent(){this.style.globalId&&Cr(this._requestManager._customAccessToken,{map:this,style:this.style.globalId,importedStyles:this.style.getImportGlobalIds()})}_updateTerrain(){const g=this._isDragging();this.painter.updateTerrain(this.style,g)}_calculateSpeedIndex(){const g=this.painter.canvasCopy(),i=this.painter.getCanvasCopiesAndTimestamps();i.timeStamps.push(performance.now());const c=this.painter.context.gl,p=c.createFramebuffer();function x(w){c.framebufferTexture2D(c.FRAMEBUFFER,c.COLOR_ATTACHMENT0,c.TEXTURE_2D,w,0);const A=new Uint8Array(c.drawingBufferWidth*c.drawingBufferHeight*4);return c.readPixels(0,0,c.drawingBufferWidth,c.drawingBufferHeight,c.RGBA,c.UNSIGNED_BYTE,A),A}return c.bindFramebuffer(c.FRAMEBUFFER,p),this._canvasPixelComparison(x(g),i.canvasCopies.map(x),i.timeStamps)}_canvasPixelComparison(g,i,c){let p=c[1]-c[0];const x=g.length/4;for(let w=0;w<i.length;w++){const A=i[w];let I=0;for(let O=0;O<A.length;O+=4)A[O]===g[O]&&A[O+1]===g[O+1]&&A[O+2]===g[O+2]&&A[O+3]===g[O+3]&&(I+=1);p+=(c[w+2]-c[w+1])*(1-I/x)}return p}remove(){this._hash&&this._hash.remove();for(const i of this._controls)i.onRemove(this);this._controls=[],this._frame&&(this._frame.cancel(),this._frame=null),this._renderTaskQueue.clear(),this._domRenderTaskQueue.clear(),this.style&&this.style.destroy(),this.indoor.destroy(),this.painter.destroy(),this.handlers&&this.handlers.destroy(),this.handlers=void 0,this.setStyle(null),window.removeEventListener("resize",this._onWindowResize,!1),window.removeEventListener("orientationchange",this._onWindowResize,!1),window.removeEventListener(this._fullscreenchangeEvent,this._onWindowResize,!1),window.removeEventListener("online",this._onWindowOnline,!1),window.removeEventListener("visibilitychange",this._onVisibilityChange,!1);const g=this.painter.context.gl.getExtension("WEBGL_lose_context");g&&g.loseContext(),this._canvas.removeEventListener("webglcontextlost",this._contextLost,!1),this._canvas.removeEventListener("webglcontextrestored",this._contextRestored,!1),this._canvasContainer.remove(),this._controlContainer.remove(),this._missingCSSCanary.remove(),this._canvas=void 0,this._canvasContainer=void 0,this._controlContainer=void 0,this._missingCSSCanary=void 0,this._container.classList.remove("mapboxgl-map"),this._container.removeEventListener("scroll",this._onMapScroll,!1),qs.delete(this.painter.context.gl),ho.remove(),Rr.remove(),this._removed=!0,this.fire(new n.z("remove"))}triggerRepaint(){this._triggerFrame(!0)}_triggerFrame(g){this._renderNextFrame=this._renderNextFrame||g,this.style&&!this._frame&&(this._frame=n.o.frame((i=>{const c=!!this._renderNextFrame;this._frame=null,this._renderNextFrame=null,c&&this._render(i)})))}_preloadTiles(g){const i=this.style?this.style.getSourceCaches():[];return n.bw(i,((c,p)=>c._preloadTiles(g,p)),(()=>{this.triggerRepaint()})),this}_onWindowOnline(){this._update()}_onWindowResize(g){this._trackResize&&this.resize({originalEvent:g})._update()}_onVisibilityChange(){document.visibilityState==="hidden"&&this._visibilityHidden++}get showTileBoundaries(){return!!this._showTileBoundaries}set showTileBoundaries(g){this._showTileBoundaries!==g&&(this._showTileBoundaries=g,this._tp.refreshUI(),this._update())}get showParseStatus(){return!!this._showParseStatus}set showParseStatus(g){this._showParseStatus!==g&&(this._showParseStatus=g,this._tp.refreshUI(),this._update())}get showTerrainWireframe(){return!!this._showTerrainWireframe}set showTerrainWireframe(g){this._showTerrainWireframe!==g&&(this._showTerrainWireframe=g,this._tp.refreshUI(),this._update())}get showLayers2DWireframe(){return!!this._showLayers2DWireframe}set showLayers2DWireframe(g){this._showLayers2DWireframe!==g&&(this._showLayers2DWireframe=g,this._tp.refreshUI(),this._update())}get showLayers3DWireframe(){return!!this._showLayers3DWireframe}set showLayers3DWireframe(g){this._showLayers3DWireframe!==g&&(this._showLayers3DWireframe=g,this._tp.refreshUI(),this._update())}get speedIndexTiming(){return!!this._speedIndexTiming}set speedIndexTiming(g){this._speedIndexTiming!==g&&(this._speedIndexTiming=g,this._update())}get showPadding(){return!!this._showPadding}set showPadding(g){this._showPadding!==g&&(this._showPadding=g,this._tp.refreshUI(),this._update())}get showCollisionBoxes(){return!!this._showCollisionBoxes}set showCollisionBoxes(g){this._showCollisionBoxes!==g&&(this._showCollisionBoxes=g,this._tp.refreshUI(),g?this.style._generateCollisionBoxes():this._update())}get showOverdrawInspector(){return!!this._showOverdrawInspector}set showOverdrawInspector(g){this._showOverdrawInspector!==g&&(this._showOverdrawInspector=g,this._tp.refreshUI(),this._update())}get repaint(){return!!this._repaint}set repaint(g){this._repaint!==g&&(this._repaint=g,this._tp.refreshUI(),this.triggerRepaint())}get vertices(){return!!this._vertices}set vertices(g){this._vertices=g,this._update()}get showTileAABBs(){return!!this._showTileAABBs}set showTileAABBs(g){this._showTileAABBs!==g&&(this._showTileAABBs=g,this._tp.refreshUI(),g&&this._update())}_setCacheLimits(g,i){n.eX(g,i)}get version(){return C}},NavigationControl:class{constructor(g={}){this.options=Object.assign({},Ug,g),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this.options.showZoom&&(n.aY(["_setButtonTitle","_updateZoomButtons"],this),this._zoomInButton=this._createButton("mapboxgl-ctrl-zoom-in",(i=>{this._map&&this._map.zoomIn({},{originalEvent:i})})),ne("span","mapboxgl-ctrl-icon",this._zoomInButton).setAttribute("aria-hidden","true"),this._zoomOutButton=this._createButton("mapboxgl-ctrl-zoom-out",(i=>{this._map&&this._map.zoomOut({},{originalEvent:i})})),ne("span","mapboxgl-ctrl-icon",this._zoomOutButton).setAttribute("aria-hidden","true")),this.options.showCompass&&(n.aY(["_rotateCompassArrow"],this),this._compass=this._createButton("mapboxgl-ctrl-compass",(i=>{const c=this._map;c&&(this.options.visualizePitch?c.resetNorthPitch({},{originalEvent:i}):c.resetNorth({},{originalEvent:i}))})),this._compassIcon=ne("span","mapboxgl-ctrl-icon",this._compass),this._compassIcon.setAttribute("aria-hidden","true"))}_updateZoomButtons(){const g=this._map;if(!g)return;const i=g.getZoom(),c=i===g.getMaxZoom(),p=i===g.getMinZoom();this._zoomInButton.disabled=c,this._zoomOutButton.disabled=p,this._zoomInButton.setAttribute("aria-disabled",c.toString()),this._zoomOutButton.setAttribute("aria-disabled",p.toString())}_rotateCompassArrow(){const g=this._map;if(!g)return;const i=this.options.visualizePitch?`scale(${1/Math.pow(Math.cos(g.transform.pitch*(Math.PI/180)),.5)}) rotateX(${g.transform.pitch}deg) rotateZ(${g.transform.angle*(180/Math.PI)}deg)`:`rotate(${g.transform.angle*(180/Math.PI)}deg)`;g._requestDomTask((()=>{this._compassIcon&&(this._compassIcon.style.transform=i)}))}onAdd(g){return this._map=g,this.options.showZoom&&(this._setButtonTitle(this._zoomInButton,"ZoomIn"),this._setButtonTitle(this._zoomOutButton,"ZoomOut"),g.on("zoom",this._updateZoomButtons),this._updateZoomButtons()),this.options.showCompass&&(this._setButtonTitle(this._compass,"ResetBearing"),this.options.visualizePitch&&g.on("pitch",this._rotateCompassArrow),g.on("rotate",this._rotateCompassArrow),this._rotateCompassArrow(),this._handler=new wd(g,this._compass,this.options.visualizePitch)),this._container}onRemove(){const g=this._map;g&&(this._container.remove(),this.options.showZoom&&g.off("zoom",this._updateZoomButtons),this.options.showCompass&&(this.options.visualizePitch&&g.off("pitch",this._rotateCompassArrow),g.off("rotate",this._rotateCompassArrow),this._handler&&this._handler.off(),this._handler=void 0),this._map=void 0)}_createButton(g,i){const c=ne("button",g,this._container);return c.type="button",c.addEventListener("click",i),c}_setButtonTitle(g,i){if(!this._map)return;const c=this._map._getUIString(`NavigationControl.${i}`);g.setAttribute("aria-label",c),g.firstElementChild&&g.firstElementChild.setAttribute("title",c)}},GeolocateControl:class extends n.E{constructor(g={}){super();const i=navigator.geolocation;this.options=Object.assign({geolocation:i},zl,g),n.aY(["_onSuccess","_onError","_onZoom","_finish","_setupUI","_updateCamera","_updateMarker","_updateMarkerRotation","_onDeviceOrientation"],this),this._updateMarkerRotationThrottled=pd(this._updateMarkerRotation,20),this._numberOfWatches=0}onAdd(g){return this._map=g,this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkGeolocationSupport(this._setupUI),this._container}onRemove(){this._geolocationWatchID!==void 0&&(this.options.geolocation.clearWatch(this._geolocationWatchID),this._geolocationWatchID=void 0),this.options.showUserLocation&&this._userLocationDotMarker&&this._userLocationDotMarker.remove(),this.options.showAccuracyCircle&&this._accuracyCircleMarker&&this._accuracyCircleMarker.remove(),this._container.remove(),this._map.off("zoom",this._onZoom),this._map=void 0,this._numberOfWatches=0,this._noTimeout=!1}_checkGeolocationSupport(g){const i=(c=!!this.options.geolocation)=>{this._supportsGeolocation=c,g(c)};this._supportsGeolocation!==void 0?g(this._supportsGeolocation):navigator.permissions!==void 0?navigator.permissions.query({name:"geolocation"}).then((c=>i(c.state!=="denied"))).catch((()=>i())):i()}_isOutOfMapMaxBounds(g){const i=this._map.getMaxBounds(),c=g.coords;return!!i&&(c.longitude<i.getWest()||c.longitude>i.getEast()||c.latitude<i.getSouth()||c.latitude>i.getNorth())}_setErrorState(){switch(this._watchState){case"WAITING_ACTIVE":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"ACTIVE_LOCK":this._watchState="ACTIVE_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting");break;case"BACKGROUND":this._watchState="BACKGROUND_ERROR",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting")}}_onSuccess(g){if(this._map){if(this._isOutOfMapMaxBounds(g))return this._setErrorState(),this.fire(new n.z("outofmaxbounds",g)),this._updateMarker(),void this._finish();if(this.options.trackUserLocation)switch(this._lastKnownPosition=g,this._watchState){case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"BACKGROUND":case"BACKGROUND_ERROR":this._watchState="BACKGROUND",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background")}this.options.showUserLocation&&this._watchState!=="OFF"&&this._updateMarker(g),this.options.trackUserLocation&&this._watchState!=="ACTIVE_LOCK"||this._updateCamera(g),this.options.showUserLocation&&this._userLocationDotMarker.removeClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("geolocate",g)),this._finish()}}_updateCamera(g){const i=new n.aR(g.coords.longitude,g.coords.latitude),c=g.coords.accuracy,p=this._map.getBearing(),x=Object.assign({bearing:p},this.options.fitBoundsOptions);this._map.fitBounds(i.toBounds(c),x,{geolocateSource:!0})}_updateMarker(g){if(g){const i=new n.aR(g.coords.longitude,g.coords.latitude);this._accuracyCircleMarker.setLngLat(i).addTo(this._map),this._userLocationDotMarker.setLngLat(i).addTo(this._map),this._accuracy=g.coords.accuracy,this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}else this._userLocationDotMarker.remove(),this._accuracyCircleMarker.remove()}_updateCircleRadius(){const g=this._map.transform,i=n.ce(1,g._center.lat)*g.worldSize,c=Math.ceil(2*this._accuracy*i);this._circleElement.style.width=`${c}px`,this._circleElement.style.height=`${c}px`}_onZoom(){this.options.showUserLocation&&this.options.showAccuracyCircle&&this._updateCircleRadius()}_updateMarkerRotation(){this._userLocationDotMarker&&typeof this._heading=="number"?(this._userLocationDotMarker.setRotation(this._heading),this._userLocationDotMarker.addClassName("mapboxgl-user-location-show-heading")):(this._userLocationDotMarker.removeClassName("mapboxgl-user-location-show-heading"),this._userLocationDotMarker.setRotation(0))}_onError(g){if(this._map){if(this.options.trackUserLocation)if(g.code===1){this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this._geolocateButton.disabled=!0;const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i),this._geolocationWatchID!==void 0&&this._clearWatch()}else{if(g.code===3&&this._noTimeout)return;this._setErrorState()}this._watchState!=="OFF"&&this.options.showUserLocation&&this._userLocationDotMarker.addClassName("mapboxgl-user-location-dot-stale"),this.fire(new n.z("error",g)),this._finish()}}_finish(){this._timeoutId&&clearTimeout(this._timeoutId),this._timeoutId=void 0}_setupUI(g){if(this._map!==void 0){if(this._container.addEventListener("contextmenu",(i=>i.preventDefault())),this._geolocateButton=ne("button","mapboxgl-ctrl-geolocate",this._container),ne("span","mapboxgl-ctrl-icon",this._geolocateButton).setAttribute("aria-hidden","true"),this._geolocateButton.type="button",g===!1){n.w("Geolocation support is not available so the GeolocateControl will be disabled.");const i=this._map._getUIString("GeolocateControl.LocationNotAvailable");this._geolocateButton.disabled=!0,this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}else{const i=this._map._getUIString("GeolocateControl.FindMyLocation");this._geolocateButton.setAttribute("aria-label",i),this._geolocateButton.firstElementChild&&this._geolocateButton.firstElementChild.setAttribute("title",i)}this.options.trackUserLocation&&(this._geolocateButton.setAttribute("aria-pressed","false"),this._watchState="OFF"),this.options.showUserLocation&&(this._dotElement=ne("div","mapboxgl-user-location"),this._dotElement.appendChild(ne("div","mapboxgl-user-location-dot")),this._dotElement.appendChild(ne("div","mapboxgl-user-location-heading")),this._userLocationDotMarker=new wu({element:this._dotElement,rotationAlignment:"map",pitchAlignment:"map"}),this._circleElement=ne("div","mapboxgl-user-location-accuracy-circle"),this._accuracyCircleMarker=new wu({element:this._circleElement,pitchAlignment:"map"}),this.options.trackUserLocation&&(this._watchState="OFF"),this._map.on("zoom",this._onZoom)),this._geolocateButton.addEventListener("click",this.trigger.bind(this)),this._setup=!0,this.options.trackUserLocation&&this._map.on("movestart",(i=>{i.geolocateSource||this._watchState!=="ACTIVE_LOCK"||i.originalEvent&&i.originalEvent.type==="resize"||(this._watchState="BACKGROUND",this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this.fire(new n.z("trackuserlocationend")))}))}}_onDeviceOrientation(g){this._userLocationDotMarker&&(g.webkitCompassHeading?this._heading=g.webkitCompassHeading:g.absolute===!0&&(this._heading=-1*g.alpha),this._updateMarkerRotationThrottled())}trigger(){if(!this._setup)return n.w("Geolocate control triggered before added to a map"),!1;if(this.options.trackUserLocation){switch(this._watchState){case"OFF":this._watchState="WAITING_ACTIVE",this.fire(new n.z("trackuserlocationstart"));break;case"WAITING_ACTIVE":case"ACTIVE_LOCK":case"ACTIVE_ERROR":case"BACKGROUND_ERROR":this._numberOfWatches--,this._noTimeout=!1,this._watchState="OFF",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-active-error"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background-error"),this.fire(new n.z("trackuserlocationend"));break;case"BACKGROUND":this._watchState="ACTIVE_LOCK",this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-background"),this._lastKnownPosition&&this._updateCamera(this._lastKnownPosition),this.fire(new n.z("trackuserlocationstart"))}switch(this._watchState){case"WAITING_ACTIVE":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_LOCK":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active");break;case"ACTIVE_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-active-error");break;case"BACKGROUND":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background");break;case"BACKGROUND_ERROR":this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-background-error")}if(this._watchState==="OFF"&&this._geolocationWatchID!==void 0)this._clearWatch();else if(this._geolocationWatchID===void 0){let g;this._geolocateButton.classList.add("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","true"),this._numberOfWatches++,this._numberOfWatches>1?(g={maximumAge:6e5,timeout:0},this._noTimeout=!0):(g=this.options.positionOptions,this._noTimeout=!1),this._geolocationWatchID=this.options.geolocation.watchPosition(this._onSuccess,this._onError,g),this.options.showUserHeading&&this._addDeviceOrientationListener()}}else this.options.geolocation.getCurrentPosition(this._onSuccess,this._onError,this.options.positionOptions),this._timeoutId=window.setTimeout(this._finish,1e4);return!0}_addDeviceOrientationListener(){const g=()=>{"ondeviceorientationabsolute"in window?window.addEventListener("deviceorientationabsolute",this._onDeviceOrientation):window.addEventListener("deviceorientation",this._onDeviceOrientation)};typeof DeviceMotionEvent<"u"&&typeof DeviceMotionEvent.requestPermission=="function"?DeviceOrientationEvent.requestPermission().then((i=>{i==="granted"&&g()})).catch(console.error):g()}_clearWatch(){this.options.geolocation.clearWatch(this._geolocationWatchID),window.removeEventListener("deviceorientation",this._onDeviceOrientation),window.removeEventListener("deviceorientationabsolute",this._onDeviceOrientation),this._geolocationWatchID=void 0,this._geolocateButton.classList.remove("mapboxgl-ctrl-geolocate-waiting"),this._geolocateButton.setAttribute("aria-pressed","false"),this.options.showUserLocation&&this._updateMarker(null)}},AttributionControl:hf,ScaleControl:class{constructor(g={}){this.options=Object.assign({},ol,g),this._isNumberFormatSupported=(function(){try{return new Intl.NumberFormat("en",{style:"unit",unitDisplay:"short",unit:"meter"}),!0}catch{return!1}})(),n.aY(["_update","_setScale","setUnit"],this)}getDefaultPosition(){return"bottom-left"}_update(){const g=this.options.maxWidth||100,i=this._map,c=i._containerHeight/2,p=i._containerWidth/2-g/2,x=i.unproject([p,c]),w=i.unproject([p+g,c]),A=x.distanceTo(w);if(this.options.unit==="imperial"){const I=3.2808*A;I>5280?this._setScale(g,I/5280,"mile"):this._setScale(g,I,"foot")}else this.options.unit==="nautical"?this._setScale(g,A/1852,"nautical-mile"):A>=1e3?this._setScale(g,A/1e3,"kilometer"):this._setScale(g,A,"meter")}_setScale(g,i,c){this._map._requestDomTask((()=>{const p=(function(w){const A=Math.pow(10,`${Math.floor(w)}`.length-1);let I=w/A;return I=I>=10?10:I>=5?5:I>=3?3:I>=2?2:I>=1?1:(function(O){const z=Math.pow(10,Math.ceil(-Math.log(O)/Math.LN10));return Math.round(O*z)/z})(I),A*I})(i),x=p/i;this._container.innerHTML=this._isNumberFormatSupported&&c!=="nautical-mile"?new Intl.NumberFormat(this._language,{style:"unit",unitDisplay:"short",unit:c}).format(p):`${p}&nbsp;${Ls[c]}`,this._container.style.width=g*x+"px"}))}onAdd(g){return this._map=g,this._language=g.getLanguage(),this._container=ne("div","mapboxgl-ctrl mapboxgl-ctrl-scale",g.getContainer()),this._container.dir="auto",this._map.on("move",this._update),this._update(),this._container}onRemove(){this._container.remove(),this._map.off("move",this._update),this._map=void 0}_setLanguage(g){this._language=g,this._update()}setUnit(g){this.options.unit=g,this._update()}},FullscreenControl:class{constructor(g={}){this._fullscreen=!1,g&&g.container&&(g.container instanceof HTMLElement?this._container=g.container:n.w("Full screen control 'container' must be a DOM element.")),n.aY(["_onClickFullscreen","_changeIcon"],this),"onfullscreenchange"in document?this._fullscreenchange="fullscreenchange":"onwebkitfullscreenchange"in document&&(this._fullscreenchange="webkitfullscreenchange")}onAdd(g){return this._map=g,this._container||(this._container=this._map.getContainer()),this._controlContainer=ne("div","mapboxgl-ctrl mapboxgl-ctrl-group"),this._checkFullscreenSupport()?this._setupUI():(this._controlContainer.style.display="none",n.w("This device does not support fullscreen mode.")),this._controlContainer}onRemove(){this._controlContainer.remove(),this._map=null,document.removeEventListener(this._fullscreenchange,this._changeIcon)}_checkFullscreenSupport(){return!(!document.fullscreenEnabled&&!document.webkitFullscreenEnabled)}_setupUI(){const g=this._fullscreenButton=ne("button","mapboxgl-ctrl-fullscreen",this._controlContainer);ne("span","mapboxgl-ctrl-icon",g).setAttribute("aria-hidden","true"),g.type="button",this._updateTitle(),this._fullscreenButton.addEventListener("click",this._onClickFullscreen),document.addEventListener(this._fullscreenchange,this._changeIcon)}_updateTitle(){const g=this._getTitle();this._fullscreenButton.setAttribute("aria-label",g),this._fullscreenButton.firstElementChild&&this._fullscreenButton.firstElementChild.setAttribute("title",g)}_getTitle(){return this._map._getUIString(this._isFullscreen()?"FullscreenControl.Exit":"FullscreenControl.Enter")}_isFullscreen(){return this._fullscreen}_changeIcon(){(document.fullscreenElement||document.webkitFullscreenElement)===this._container!==this._fullscreen&&(this._fullscreen=!this._fullscreen,this._fullscreenButton.classList.toggle("mapboxgl-ctrl-shrink"),this._fullscreenButton.classList.toggle("mapboxgl-ctrl-fullscreen"),this._updateTitle())}_onClickFullscreen(){this._isFullscreen()?document.exitFullscreen?document.exitFullscreen():document.webkitCancelFullScreen&&document.webkitCancelFullScreen():this._container.requestFullscreen?this._container.requestFullscreen():this._container.webkitRequestFullscreen&&this._container.webkitRequestFullscreen()}},IndoorControl:Dc,Popup:class extends n.E{constructor(g){super(),this.options=Object.assign(Object.create(Su),g),this._altitude=this.options.altitude,n.aY(["_update","_onClose","remove","_onMouseEvent"],this),this._classList=new Set(g&&g.className?g.className.trim().split(/\s+/):[])}addTo(g){return this._map&&this.remove(),this._map=g,this.options.closeOnClick&&g.on("preclick",this._onClose),this.options.closeOnMove&&g.on("move",this._onClose),g.on("remove",this.remove),this._update(),g._addPopup(this),this._focusFirstElement(),this._trackPointer?(g.on("mousemove",this._onMouseEvent),g.on("mouseup",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")):g.on("move",this._update),this.fire(new n.z("open")),this}isOpen(){return!!this._map}remove(){this._content&&this._content.remove(),this._container&&(this._container.remove(),this._container=void 0);const g=this._map;return g&&(g.off("move",this._update),g.off("move",this._onClose),g.off("preclick",this._onClose),g.off("click",this._onClose),g.off("remove",this.remove),g.off("mousemove",this._onMouseEvent),g.off("mouseup",this._onMouseEvent),g.off("drag",this._onMouseEvent),g._canvasContainer&&g._canvasContainer.classList.remove("mapboxgl-track-pointer"),g._removePopup(this),this._map=void 0),this.fire(new n.z("close")),this}getLngLat(){return this._lngLat}setLngLat(g){this._lngLat=n.aR.convert(g),this._pos=null,this._trackPointer=!1,this._update();const i=this._map;return i&&(i.on("move",this._update),i.off("mousemove",this._onMouseEvent),i._canvasContainer.classList.remove("mapboxgl-track-pointer")),this}getAltitude(){return this._altitude}setAltitude(g){return this._altitude=g,this._update(),this}trackPointer(){this._trackPointer=!0,this._pos=null,this._update();const g=this._map;return g&&(g.off("move",this._update),g.on("mousemove",this._onMouseEvent),g.on("drag",this._onMouseEvent),g._canvasContainer.classList.add("mapboxgl-track-pointer")),this}getElement(){return this._container}setText(g){return this.setDOMContent(document.createTextNode(g))}setHTML(g){const i=document.createDocumentFragment(),c=document.createElement("body");let p;for(c.innerHTML=g;p=c.firstChild,p;)i.appendChild(p);return this.setDOMContent(i)}getMaxWidth(){return this._container&&this._container.style.maxWidth}setMaxWidth(g){return this.options.maxWidth=g,this._update(),this}setDOMContent(g){let i=this._content;if(i)for(;i.hasChildNodes();)i.firstChild&&i.removeChild(i.firstChild);else i=this._content=ne("div","mapboxgl-popup-content",this._container||void 0);if(i.appendChild(g),this.options.closeButton){const c=this._closeButton=ne("button","mapboxgl-popup-close-button",i);c.type="button",c.setAttribute("aria-label","Close popup"),c.innerHTML='<span aria-hidden="true">&#215;</span>',c.addEventListener("click",this._onClose)}return this._update(),this._focusFirstElement(),this}addClassName(g){return this._classList.add(g),this._updateClassList(),this}removeClassName(g){return this._classList.delete(g),this._updateClassList(),this}setOffset(g){return this.options.offset=g,this._update(),this}toggleClassName(g){let i;return this._classList.delete(g)?i=!1:(this._classList.add(g),i=!0),this._updateClassList(),i}_onMouseEvent(g){this._update(g.point)}_getAnchor(g){if(this.options.anchor)return this.options.anchor;const i=this._map,c=this._container,p=this._pos;if(!i||!c||!p)return"bottom";const x=c.offsetWidth,w=c.offsetHeight,A=p.x<x/2,I=p.x>i.transform.width-x/2;if(p.y+g<w)return A?"top-left":I?"top-right":"top";if(p.y>i.transform.height-w){if(A)return"bottom-left";if(I)return"bottom-right"}return A?"left":I?"right":"bottom"}_updateClassList(){const g=this._container;if(!g)return;const i=[...this._classList];i.push("mapboxgl-popup"),this._anchor&&i.push(`mapboxgl-popup-anchor-${this._anchor}`),this._trackPointer&&i.push("mapboxgl-popup-track-pointer"),g.className=i.join(" ")}_update(g){const i=this._map,c=this._content;if(!i||!this._lngLat&&!this._trackPointer||!c)return;let p=this._container;if(p||(p=this._container=ne("div","mapboxgl-popup",i.getContainer()),this._tip=ne("div","mapboxgl-popup-tip",p),p.appendChild(c)),this.options.maxWidth&&p.style.maxWidth!==this.options.maxWidth&&(p.style.maxWidth=this.options.maxWidth),i.transform.renderWorldCopies&&!this._trackPointer&&(this._lngLat=cs(this._lngLat,this._pos,i.transform)),!this._trackPointer||g){const x=this._pos=this._trackPointer&&g instanceof n.P?g:i.project(this._lngLat,this._altitude),w=mo(this.options.offset),A=this._anchor=this._getAnchor(w.y),I=mo(this.options.offset,A),O=x.add(I).round();i._requestDomTask((()=>{this._container&&A&&(this._container.style.transform=`${mf[A]} translate(${O.x}px,${O.y}px)`)}))}if(!this._marker&&i._showingGlobe()){const x=n.eY(i.transform,this._lngLat)?0:1;this._setOpacity(x)}this._updateClassList()}_focusFirstElement(){if(!this.options.focusAfterOpen||!this._container)return;const g=this._container.querySelector(Bo);g&&g.focus()}_onClose(){this.remove()}_setOpacity(g){this._container&&(this._container.style.opacity=`${g}`),this._content&&(this._content.style.pointerEvents=g?"auto":"none")}},Marker:wu,Style:ns,LngLat:n.aR,LngLatBounds:n.aI,Point:n.P,MercatorCoordinate:n.ae,FreeCameraOptions:Xd,Evented:n.E,config:n.e,prewarm:n.f0,clearPrewarmedResources:n.e$,get accessToken(){return n.e.ACCESS_TOKEN},set accessToken(g){n.e.ACCESS_TOKEN=g},get baseApiUrl(){return n.e.API_URL},set baseApiUrl(g){n.e.API_URL=g},get workerCount(){return n.f9.workerCount},set workerCount(g){n.f9.workerCount=g},get maxParallelImageRequests(){return n.e.MAX_PARALLEL_IMAGE_REQUESTS},set maxParallelImageRequests(g){n.e.MAX_PARALLEL_IMAGE_REQUESTS=g},clearStorage(g){n.f8(g)},get workerUrl(){return n.f7.workerUrl},set workerUrl(g){n.f7.workerUrl=g},get workerClass(){return n.f7.workerClass},set workerClass(g){n.f7.workerClass=g},get workerParams(){return n.f7.workerParams},set workerParams(g){n.f7.workerParams=g},get dracoUrl(){return n.f6()},set dracoUrl(g){n.f5(g)},get meshoptUrl(){return n.f4()},set meshoptUrl(g){n.f3(g)},setNow:n.o.setNow,restoreNow:n.o.restoreNow}}));var b=h;return b}))})(wv)),wv.exports}var rU=tU();const k_=Lw(rU),r3="mapbox://styles/mapbox/dark-v10",iU="https://basemaps.cartocdn.com/gl/positron-gl-style/style.json",nU=[7.8421,47.999];function oU({center:r=nU,zoom:e=13,style:o=r3,className:l="w-full h-96 rounded-lg",onMapLoad:h,onMapClick:m,children:b}){const n=Xe.useRef(null),C=Xe.useRef(null),[D,L]=Xe.useState(null),[U,q]=Xe.useState(!1),[Z,ie]=Xe.useState(null),ne=Xe.useRef(null),be=Xe.useRef(null),ve=Xe.useRef(null),we=Xe.useRef(null),Pe=Xe.useRef(!1);return Xe.useEffect(()=>{const Ze="pk.eyJ1IjoiaW5vdGkiLCJhIjoiY205MDhqbzFyMGs0dzJsczgzaHA1YWJscyJ9.AnUFZnF1NfhefBtsQLnvdA";if((o??r3).startsWith("mapbox://"),C.current||!n.current)return;k_.accessToken=Ze;const $e=new k_.Map({container:n.current,style:o,center:r,zoom:e,attributionControl:!1,logoPosition:"bottom-right"});C.current=$e,L($e),$e.addControl(new k_.NavigationControl,"top-right"),$e.addControl(new k_.GeolocateControl({positionOptions:{enableHighAccuracy:!0},trackUserLocation:!0,showUserHeading:!0}),"top-right");const xt=()=>{q(!0),be.current?.($e)};$e.on("load",xt);const Ct=Ft=>{if(!Pe.current){Pe.current=!0;try{$e.setStyle(iU),ie("Проблема со стилем/токеном Mapbox. Включён резервный стиль.");return}catch{}}ie("Ошибка загрузки карты. Проверьте токен или соединение.")};return $e.on("error",Ct),()=>{$e.off("load",xt),$e.off("error",Ct),ne.current&&($e.off("click",ne.current),ne.current=null),$e.remove(),C.current=null,L(null),q(!1)}},[o]),Xe.useEffect(()=>{be.current=h??null},[h]),Xe.useEffect(()=>{ve.current=m??null},[m]),Xe.useEffect(()=>{const Ze=C.current;if(!Ze||!U)return;const $e=xt=>{ve.current?.(xt)};return ne.current&&(Ze.off("click",ne.current),ne.current=null),ve.current&&(ne.current=$e,Ze.on("click",$e)),()=>{ne.current&&(Ze.off("click",ne.current),ne.current=null)}},[U]),Xe.useEffect(()=>{if(!C.current||!U)return;const Ze=we.current,$e=[r[0],r[1]];Ze&&Ze[0]===$e[0]&&Ze[1]===$e[1]||(C.current.jumpTo({center:$e}),we.current=$e)},[r[0],r[1],U]),Xe.useEffect(()=>{!C.current||!U||C.current.setZoom(e)},[e,U]),rt.jsxs("div",{className:`relative ${l}`,children:[rt.jsx("div",{ref:n,className:"w-full h-full rounded-lg overflow-hidden"}),!U&&rt.jsx("div",{className:"absolute inset-0 bg-zinc-900 flex items-center justify-center rounded-lg",children:rt.jsxs("div",{className:"text-center",children:[rt.jsx("div",{className:"w-8 h-8 border-2 border-emerald-400 border-t-transparent rounded-full animate-spin mx-auto mb-2"}),rt.jsx("p",{className:"text-zinc-400 text-sm",children:"Загрузка карты..."})]})}),!1,b&&rt.jsx("div",{className:"absolute inset-0 pointer-events-none",children:b})]})}function aU({listOpen:r,onToggleList:e,onCenterOnUser:o,isGeoLoading:l}){const h="flex items-center justify-center h-10 w-10 rounded-md border border-[color:var(--color-border-strong)]/60 bg-[color:var(--color-surface-elevated)] text-[color:var(--color-text-primary)] hover:border-[color:var(--color-cyan)]/70 hover:text-[color:var(--color-cyan)] transition";return rt.jsxs("div",{className:"flex flex-col gap-2",children:[rt.jsx("button",{type:"button",className:h,"aria-label":"Center on my location",onClick:o,disabled:l,title:l?"Locating…":"Center on me",children:rt.jsx(xF,{className:`h-5 w-5 ${l?"animate-pulse":""}`})}),rt.jsx("button",{type:"button",className:h,"aria-label":"Toggle points list",onClick:e,title:r?"Hide list":"Show list",children:rt.jsx(_F,{className:"h-5 w-5"})}),rt.jsx("button",{type:"button",className:h,"aria-label":"Crosshair",title:"Crosshair",onClick:()=>{},children:rt.jsx(dF,{className:"h-5 w-5"})})]})}function sU({selectedCategory:r,onChangeCategory:e,showCompleted:o,onToggleCompleted:l,searchQuery:h,onSearch:m}){const b=C=>`px-3 py-1.5 rounded-full text-xs uppercase tracking-[0.22em] border transition ${C?"bg-[color:var(--color-cyan)] text-[color:var(--color-bg)] border-[color:var(--color-cyan)]":"border-[color:var(--color-border-strong)]/60 text-[color:var(--color-text-muted)] hover:text-[color:var(--color-cyan)] hover:border-[color:var(--color-cyan)]/70"}`,n=C=>m(C.target.value);return rt.jsxs("div",{className:"flex flex-col gap-2 rounded-lg border border-[color:var(--color-border-strong)]/60 bg-[color:var(--color-surface-elevated)] p-2",children:[rt.jsxs("div",{className:"flex items-center gap-2",children:[rt.jsx("button",{className:b(r==="all"),onClick:()=>e("all"),children:"All"}),rt.jsx("button",{className:b(r==="quest"),onClick:()=>e("quest"),children:"Quests"}),rt.jsx("button",{className:b(r==="shop"),onClick:()=>e("shop"),children:"Shops"}),rt.jsx("button",{className:b(r==="npc"),onClick:()=>e("npc"),children:"NPCs"})]}),rt.jsxs("div",{className:"flex items-center gap-2",children:[rt.jsxs("label",{className:"inline-flex items-center gap-2 text-xs text-[color:var(--color-text-muted)]",children:[rt.jsx("input",{type:"checkbox",className:"h-4 w-4 rounded border-[color:var(--color-border-strong)]/60 bg-transparent",checked:o,onChange:C=>l(C.target.checked)}),"Show completed"]}),rt.jsx("input",{type:"text",value:h,onChange:n,placeholder:"Search…",className:"ml-auto w-48 rounded-md border border-[color:var(--color-border-strong)]/60 bg-transparent px-2 py-1 text-sm text-[color:var(--color-text-primary)] placeholder:text-[color:var(--color-text-muted)] focus:border-[color:var(--color-cyan)]/70 focus:outline-none"})]})]})}function lU({open:r,points:e,selectedId:o,onSelect:l,onClose:h}){return rt.jsx("div",{className:`fixed right-4 top-28 z-20 w-80 max-w-[90vw] transform transition ${r?"translate-x-0 opacity-100":"translate-x-4 opacity-0 pointer-events-none"}`,children:rt.jsxs("div",{className:"rounded-lg border border-[color:var(--color-border-strong)]/60 bg-[color:var(--color-surface-elevated)] shadow-xl",children:[rt.jsxs("div",{className:"flex items-center justify-between border-b border-[color:var(--color-border-strong)]/60 px-3 py-2",children:[rt.jsx("h3",{className:"text-sm font-semibold text-[color:var(--color-text-primary)]",children:"Points"}),rt.jsx("button",{type:"button",onClick:h,className:"rounded p-1 text-[color:var(--color-text-muted)] hover:text-[color:var(--color-cyan)]","aria-label":"Close list",children:rt.jsx(zF,{className:"h-4 w-4"})})]}),rt.jsxs("div",{className:"max-h-[52vh] overflow-auto p-2",children:[e.length===0&&rt.jsx("div",{className:"p-3 text-sm text-[color:var(--color-text-muted)]",children:"No points match filters"}),rt.jsx("ul",{className:"space-y-1",children:e.map(m=>{const b=m.id===o;return rt.jsx("li",{children:rt.jsxs("button",{type:"button",onClick:()=>l(m.id),className:`w-full rounded-md border px-3 py-2 text-left transition ${b?"border-[color:var(--color-cyan)]/60 bg-[color:var(--color-cyan)]/10 text-[color:var(--color-cyan)]":"border-[color:var(--color-border-strong)]/60 text-[color:var(--color-text-primary)] hover:border-[color:var(--color-cyan)]/70 hover:text-[color:var(--color-cyan)]"}`,children:[rt.jsx("div",{className:"text-sm font-medium",children:m.title}),rt.jsx("div",{className:"text-xs text-[color:var(--color-text-muted)]",children:m.category})]})},m.id)})})]})]})})}const cU=qv()(r=>({listOpen:!0,selectedCategory:"all",showCompleted:!0,searchQuery:"",toggleList:()=>r(e=>({listOpen:!e.listOpen})),setSelectedCategory:e=>r({selectedCategory:e}),setShowCompleted:e=>r({showCompleted:e}),setSearchQuery:e=>r({searchQuery:e})})),i3=[{id:"p1",title:"Training Grounds",coords:[7.8425,48.0008],category:"quest"},{id:"p2",title:"Blacksmith",coords:[7.8462,47.9975],category:"shop"},{id:"p3",title:"Guild Hall",coords:[7.8393,47.9998],category:"npc",isCompleted:!0}];function n3(){const r=$R("MapPage"),e=Xe.useRef(null),o=Xe.useRef([]),[l,h]=Xe.useState(null),{isLoading:m,error:b,position:n,startWatching:C,getCurrentPosition:D}=dk({accuracy:"balanced",watch:!0}),{listOpen:L,toggleList:U,selectedCategory:q,setSelectedCategory:Z,showCompleted:ie,setShowCompleted:ne,searchQuery:be,setSearchQuery:ve}=cU(),we=Xe.useMemo(()=>i3.filter(Yt=>!(q!=="all"&&Yt.category!==q||!ie&&Yt.isCompleted||be&&!Yt.title.toLowerCase().includes(be.toLowerCase()))),[q,ie,be]);Xe.useEffect(()=>{C()},[]);const Pe=Xe.useMemo(()=>{if(n?.lng!=null&&n?.lat!=null)return[n.lng,n.lat]},[n]),Ze=(Yt,hr)=>{const pr=e.current;pr&&pr.flyTo({center:Yt,zoom:hr??Math.max(pr.getZoom(),14),duration:800})},$e=()=>{o.current.forEach(Yt=>Yt.remove()),o.current=[]},xt=()=>{const Yt=e.current;if(Yt){$e();try{we.forEach(hr=>{const pr=new k_.Marker({color:hr.category==="quest"?"#22c55e":hr.category==="shop"?"#0ea5e9":"#f97316"}).setLngLat(hr.coords).setPopup(new k_.Popup({offset:12}).setHTML(`<div style="font-family: ui-sans-serif,system-ui; font-size: 12px">${hr.title}</div>`)).addTo(Yt);pr.getElement().addEventListener("click",()=>{h(hr.id)}),o.current.push(pr)})}catch(hr){r.error("Failed to render markers",hr)}}};Xe.useEffect(()=>{xt()},[we]),Xe.useEffect(()=>{if(!l)return;const Yt=i3.find(hr=>hr.id===l);Yt&&Ze(Yt.coords,16)},[l]);const Ct=Yt=>{e.current=Yt,r.info("Map loaded"),xt()},Ft=()=>{Pe?Ze(Pe,15):D()};return rt.jsx("div",{className:"relative min-h-screen bg-[color:var(--color-bg)] px-4 pb-8 pt-6",children:rt.jsxs("div",{className:"mx-auto max-w-6xl",children:[rt.jsx("div",{className:"mb-4 flex items-center justify-between",children:rt.jsxs("div",{children:[rt.jsx("div",{className:"badge-glow inline-flex bg-[linear-gradient(135deg,rgba(34,197,94,0.85),rgba(14,165,233,0.85))] text-[color:var(--color-bg)]",children:"Map"}),rt.jsx("h1",{className:"mt-2 text-2xl font-semibold text-[color:var(--color-text-primary)]",children:"World Map"}),b&&rt.jsx("p",{className:"mt-1 text-xs text-red-400",children:b})]})}),rt.jsxs("div",{className:"relative",children:[rt.jsx(oU,{center:Pe,zoom:13,className:"h-[70vh] w-full",onMapLoad:Ct,children:rt.jsxs("div",{className:"pointer-events-none absolute inset-0",children:[rt.jsx("div",{className:"pointer-events-auto absolute left-3 top-3 z-10",children:rt.jsx(sU,{selectedCategory:q,onChangeCategory:Z,showCompleted:ie,onToggleCompleted:ne,searchQuery:be,onSearch:ve})}),rt.jsx("div",{className:"pointer-events-auto absolute right-3 top-3 z-10",children:rt.jsx(aU,{listOpen:L,onToggleList:U,onCenterOnUser:Ft,isGeoLoading:m})})]})}),rt.jsx(lU,{open:L,points:we,selectedId:l,onSelect:Yt=>h(Yt),onClose:U})]})]})})}function uU(r){const e=new URLSearchParams(r),o={};return["gclid","gbraid","wbraid","gclsrc","utm_source","utm_medium","utm_campaign","utm_term","utm_content"].forEach(h=>{const m=e.get(h);m&&(o[h]=m)}),typeof document<"u"&&document.referrer&&(o.referrer=document.referrer),o}function hU(r,e){try{const o={...e,storedAt:Date.now()};localStorage.setItem(r,JSON.stringify(o))}catch{}}function fU(r){try{const e=localStorage.getItem(r);return e?JSON.parse(e)??null:null}catch{return null}}const o3="gw_google_params";function dU(){return Xe.useEffect(()=>{try{const r=uU(window.location.search);if(!Object.keys(r).some(o=>r[o]!==void 0)){const o=fU(o3);o?Fn.object("[Google] Stored UTM/GCLID params",o):Fn.info("[Google] No UTM/GCLID params found in URL or storage");return}Fn.object("[Google] UTM/GCLID params from URL",r),hU(o3,r)}catch(r){Fn.error("[Google] Failed to parse/log params",r)}},[]),null}Fn.info("[Auth] Using local admin auth");UO.createRoot(document.getElementById("root")).render(rt.jsx(sm.StrictMode,{children:rt.jsx(f4,{children:rt.jsxs(x5,{children:[rt.jsx(dU,{}),rt.jsx(t4,{children:rt.jsxs(OP,{children:[rt.jsx(uv,{path:"/",element:rt.jsx(JV,{})}),rt.jsx(uv,{path:"/enhanced-map",element:rt.jsx(n3,{})}),rt.jsx(uv,{path:"/map",element:rt.jsx(n3,{})})]})})]})})}));
